var J=(e,r="",n="?")=>{if(e===null)return[!1,`Parameter '${n}' is null`];if(typeof e>"u")return[!1,`Parameter '${n}' is undefined`];if(Number.isNaN(e))return[!1,`Parameter '${n}' is NaN`];if(typeof e!="number")return[!1,`Parameter '${n}' is not a number (${JSON.stringify(e)})`];switch(r){case"positive":{if(e<0)return[!1,`Parameter '${n}' must be at least zero (${e})`];break}case"negative":{if(e>0)return[!1,`Parameter '${n}' must be zero or lower (${e})`];break}case"aboveZero":{if(e<=0)return[!1,`Parameter '${n}' must be above zero (${e})`];break}case"belowZero":{if(e>=0)return[!1,`Parameter '${n}' must be below zero (${e})`];break}case"percentage":{if(e>1||e<0)return[!1,`Parameter '${n}' must be in percentage range (0 to 1). (${e})`];break}case"nonZero":{if(e===0)return[!1,`Parameter '${n}' must non-zero. (${e})`];break}case"bipolar":{if(e>1||e<-1)return[!1,`Parameter '${n}' must be in bipolar percentage range (-1 to 1). (${e})`];break}}return[!0]},P=(e,r="",n="?")=>{U(J(e,r,n))},U=e=>{if(e[0])return!1;throw new Error(e[1])},xg=(e,r="?")=>J(e,"percentage",r),bg=(e,r="?")=>{U(xg(e,r))},Tt=(e,r="",n="?")=>{const i=J(e,r,n);return i[0]?Number.isInteger(e)?[!0]:[!1,`Parameter ${n} is not an integer`]:i},le=(e,r="",n="?")=>{U(Tt(e,r,n))},Eg=(e,r="?")=>Array.isArray(e)?[!0]:[!1,`Parameter '${r}' is expected to be an array'`],Dg=(e,r="?")=>{U(Eg(e,r))};function or(e,r){U(Tt(e,"positive","decimalPlaces"));let n;if(e===0)n=Math.round;else{const i=Math.pow(10,e);n=s=>Math.floor(s*i)/i}return r===void 0?n:n(r)}var Gs=(e,r,n=!0)=>{U(J(e,"","v")),U(Tt(r,"","every"));let i=e/r;const s=i%1;return i=Math.floor(i),(s===.5&&n||s>.5)&&i++,r*i};function*Gl(e,r,n,i){U(J(e,"","start")),U(J(r,"","end")),U(J(n,"","steps"));const s=i?or(i):a=>a,o=(r-e)/(n-1);if(U(J(o,"","step")),!Number.isFinite(o))throw new TypeError("Calculated step value is infinite");for(let a=0;a<n;a++){const u=e+o*a;yield s(u)}}var fe=Math.random,Ag=Object.create,Io=Object.defineProperty,Cg=Object.getOwnPropertyDescriptor,Ul=Object.getOwnPropertyNames,Sg=Object.getPrototypeOf,Fg=Object.prototype.hasOwnProperty,Pg=(e,r)=>function(){return r||(0,e[Ul(e)[0]])((r={exports:{}}).exports,r),r.exports},E=(e,r)=>{for(var n in r)Io(e,n,{get:r[n],enumerable:!0})},Ng=(e,r,n,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of Ul(r))!Fg.call(e,s)&&s!==n&&Io(e,s,{get:()=>r[s],enumerable:!(i=Cg(r,s))||i.enumerable});return e},jo=(e,r,n)=>(n=e!=null?Ag(Sg(e)):{},Ng(Io(n,"default",{value:e,enumerable:!0}),e)),Hl=(e,r=0,n=360)=>(le(e,void 0,"v"),le(r,void 0,"min"),le(n,void 0,"max"),e===r||e===n?r:(e>0&&e<r&&(e+=r),e-=r,n-=r,e=e%n,e<0&&(e=n-Math.abs(e)+r),e+r)),ci=(e,r=0,n=1)=>{if(P(e,"","min"),P(r,"","min"),P(n,"","max"),e===r||e===n)return r;for(;(e<=r||e>=n)&&!(e===n||e===r);)e>n?e=r+(e-n):e<r&&(e=n-(r-e));return e},kg=(e,r,n,i,s)=>{let o=0;const a=Math.abs(s-i),u=Math.abs(r-i+s),l=Math.abs(i+(360-s)),c=Math.min(a,u,l);return c===l?o=i-n(c):c===u?o=i+n(c):i>s?o=i-n(c):o=i+n(c),Hl(o,e,r)},Sn={};E(Sn,{getCssVariable:()=>lc,goldenAngleColour:()=>lw,interpolate:()=>dw,opacity:()=>vn,randomHue:()=>Go,scale:()=>hw,toHex:()=>fw,toHsl:()=>uw,toRgb:()=>cw});function Lr(e,r,n){e.prototype=r.prototype=n,n.constructor=e}function Fn(e,r){var n=Object.create(e.prototype);for(var i in r)n[i]=r[i];return n}function Rt(){}var ar=.7,_r=1/ar,Cr="\\s*([+-]?\\d+)\\s*",dn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",et="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Mg=/^#([0-9a-f]{3,8})$/,$g=new RegExp(`^rgb\\(${Cr},${Cr},${Cr}\\)$`),Bg=new RegExp(`^rgb\\(${et},${et},${et}\\)$`),_g=new RegExp(`^rgba\\(${Cr},${Cr},${Cr},${dn}\\)$`),Tg=new RegExp(`^rgba\\(${et},${et},${et},${dn}\\)$`),zg=new RegExp(`^hsl\\(${dn},${et},${et}\\)$`),Rg=new RegExp(`^hsla\\(${dn},${et},${et},${dn}\\)$`),yl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Lr(Rt,Tr,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:vl,formatHex:vl,formatHex8:Ig,formatHsl:jg,formatRgb:pl,toString:pl});function vl(){return this.rgb().formatHex()}function Ig(){return this.rgb().formatHex8()}function jg(){return Jl(this).formatHsl()}function pl(){return this.rgb().formatRgb()}function Tr(e){var r,n;return e=(e+"").trim().toLowerCase(),(r=Mg.exec(e))?(n=r[1].length,r=parseInt(r[1],16),n===6?ml(r):n===3?new pe(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):n===8?Kn(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):n===4?Kn(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=$g.exec(e))?new pe(r[1],r[2],r[3],1):(r=Bg.exec(e))?new pe(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=_g.exec(e))?Kn(r[1],r[2],r[3],r[4]):(r=Tg.exec(e))?Kn(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=zg.exec(e))?xl(r[1],r[2]/100,r[3]/100,1):(r=Rg.exec(e))?xl(r[1],r[2]/100,r[3]/100,r[4]):yl.hasOwnProperty(e)?ml(yl[e]):e==="transparent"?new pe(NaN,NaN,NaN,0):null}function ml(e){return new pe(e>>16&255,e>>8&255,e&255,1)}function Kn(e,r,n,i){return i<=0&&(e=r=n=NaN),new pe(e,r,n,i)}function Lo(e){return e instanceof Rt||(e=Tr(e)),e?(e=e.rgb(),new pe(e.r,e.g,e.b,e.opacity)):new pe}function fi(e,r,n,i){return arguments.length===1?Lo(e):new pe(e,r,n,i??1)}function pe(e,r,n,i){this.r=+e,this.g=+r,this.b=+n,this.opacity=+i}Lr(pe,fi,Fn(Rt,{brighter(e){return e=e==null?_r:Math.pow(_r,e),new pe(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?ar:Math.pow(ar,e),new pe(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new pe(Qt(this.r),Qt(this.g),Qt(this.b),di(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:gl,formatHex:gl,formatHex8:Lg,formatRgb:wl,toString:wl}));function gl(){return`#${Xt(this.r)}${Xt(this.g)}${Xt(this.b)}`}function Lg(){return`#${Xt(this.r)}${Xt(this.g)}${Xt(this.b)}${Xt((isNaN(this.opacity)?1:this.opacity)*255)}`}function wl(){const e=di(this.opacity);return`${e===1?"rgb(":"rgba("}${Qt(this.r)}, ${Qt(this.g)}, ${Qt(this.b)}${e===1?")":`, ${e})`}`}function di(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Qt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Xt(e){return e=Qt(e),(e<16?"0":"")+e.toString(16)}function xl(e,r,n,i){return i<=0?e=r=n=NaN:n<=0||n>=1?e=r=NaN:r<=0&&(e=NaN),new Ye(e,r,n,i)}function Jl(e){if(e instanceof Ye)return new Ye(e.h,e.s,e.l,e.opacity);if(e instanceof Rt||(e=Tr(e)),!e)return new Ye;if(e instanceof Ye)return e;e=e.rgb();var r=e.r/255,n=e.g/255,i=e.b/255,s=Math.min(r,n,i),o=Math.max(r,n,i),a=NaN,u=o-s,l=(o+s)/2;return u?(r===o?a=(n-i)/u+(n<i)*6:n===o?a=(i-r)/u+2:a=(r-n)/u+4,u/=l<.5?o+s:2-o-s,a*=60):u=l>0&&l<1?0:a,new Ye(a,u,l,e.opacity)}function hn(e,r,n,i){return arguments.length===1?Jl(e):new Ye(e,r,n,i??1)}function Ye(e,r,n,i){this.h=+e,this.s=+r,this.l=+n,this.opacity=+i}Lr(Ye,hn,Fn(Rt,{brighter(e){return e=e==null?_r:Math.pow(_r,e),new Ye(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ar:Math.pow(ar,e),new Ye(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*r,s=2*n-i;return new pe($s(e>=240?e-240:e+120,s,i),$s(e,s,i),$s(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new Ye(bl(this.h),Zn(this.s),Zn(this.l),di(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=di(this.opacity);return`${e===1?"hsl(":"hsla("}${bl(this.h)}, ${Zn(this.s)*100}%, ${Zn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function bl(e){return e=(e||0)%360,e<0?e+360:e}function Zn(e){return Math.max(0,Math.min(1,e||0))}function $s(e,r,n){return(e<60?r+(n-r)*e/60:e<180?n:e<240?r+(n-r)*(240-e)/60:r)*255}var Yl=Math.PI/180,Xl=180/Math.PI,hi=18,Kl=.96422,Zl=1,Ql=.82521,ec=4/29,Sr=6/29,tc=3*Sr*Sr,Vg=Sr*Sr*Sr;function rc(e){if(e instanceof tt)return new tt(e.l,e.a,e.b,e.opacity);if(e instanceof pt)return nc(e);e instanceof pe||(e=Lo(e));var r=zs(e.r),n=zs(e.g),i=zs(e.b),s=Bs((.2225045*r+.7168786*n+.0606169*i)/Zl),o,a;return r===n&&n===i?o=a=s:(o=Bs((.4360747*r+.3850649*n+.1430804*i)/Kl),a=Bs((.0139322*r+.0971045*n+.7141733*i)/Ql)),new tt(116*s-16,500*(o-s),200*(s-a),e.opacity)}function Us(e,r,n,i){return arguments.length===1?rc(e):new tt(e,r,n,i??1)}function tt(e,r,n,i){this.l=+e,this.a=+r,this.b=+n,this.opacity=+i}Lr(tt,Us,Fn(Rt,{brighter(e){return new tt(this.l+hi*(e??1),this.a,this.b,this.opacity)},darker(e){return new tt(this.l-hi*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,r=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return r=Kl*_s(r),e=Zl*_s(e),n=Ql*_s(n),new pe(Ts(3.1338561*r-1.6168667*e-.4906146*n),Ts(-.9787684*r+1.9161415*e+.033454*n),Ts(.0719453*r-.2289914*e+1.4052427*n),this.opacity)}}));function Bs(e){return e>Vg?Math.pow(e,1/3):e/tc+ec}function _s(e){return e>Sr?e*e*e:tc*(e-ec)}function Ts(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function zs(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Og(e){if(e instanceof pt)return new pt(e.h,e.c,e.l,e.opacity);if(e instanceof tt||(e=rc(e)),e.a===0&&e.b===0)return new pt(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var r=Math.atan2(e.b,e.a)*Xl;return new pt(r<0?r+360:r,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Hs(e,r,n,i){return arguments.length===1?Og(e):new pt(e,r,n,i??1)}function pt(e,r,n,i){this.h=+e,this.c=+r,this.l=+n,this.opacity=+i}function nc(e){if(isNaN(e.h))return new tt(e.l,0,0,e.opacity);var r=e.h*Yl;return new tt(e.l,Math.cos(r)*e.c,Math.sin(r)*e.c,e.opacity)}Lr(pt,Hs,Fn(Rt,{brighter(e){return new pt(this.h,this.c,this.l+hi*(e??1),this.opacity)},darker(e){return new pt(this.h,this.c,this.l-hi*(e??1),this.opacity)},rgb(){return nc(this).rgb()}}));var ic=-.14861,Vo=1.78277,Oo=-.29227,Ti=-.90649,yn=1.97294,El=yn*Ti,Dl=yn*Vo,Al=Vo*Oo-Ti*ic;function qg(e){if(e instanceof er)return new er(e.h,e.s,e.l,e.opacity);e instanceof pe||(e=Lo(e));var r=e.r/255,n=e.g/255,i=e.b/255,s=(Al*i+El*r-Dl*n)/(Al+El-Dl),o=i-s,a=(yn*(n-s)-Oo*o)/Ti,u=Math.sqrt(a*a+o*o)/(yn*s*(1-s)),l=u?Math.atan2(a,o)*Xl-120:NaN;return new er(l<0?l+360:l,u,s,e.opacity)}function Js(e,r,n,i){return arguments.length===1?qg(e):new er(e,r,n,i??1)}function er(e,r,n,i){this.h=+e,this.s=+r,this.l=+n,this.opacity=+i}Lr(er,Js,Fn(Rt,{brighter(e){return e=e==null?_r:Math.pow(_r,e),new er(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ar:Math.pow(ar,e),new er(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*Yl,r=+this.l,n=isNaN(this.s)?0:this.s*r*(1-r),i=Math.cos(e),s=Math.sin(e);return new pe(255*(r+n*(ic*i+Vo*s)),255*(r+n*(Oo*i+Ti*s)),255*(r+n*(yn*i)),this.opacity)}}));var zi=e=>()=>e;function sc(e,r){return function(n){return e+n*r}}function Wg(e,r,n){return e=Math.pow(e,n),r=Math.pow(r,n)-e,n=1/n,function(i){return Math.pow(e+i*r,n)}}function qo(e,r){var n=r-e;return n?sc(e,n>180||n<-180?n-360*Math.round(n/360):n):zi(isNaN(e)?r:e)}function Gg(e){return(e=+e)==1?me:function(r,n){return n-r?Wg(r,n,e):zi(isNaN(r)?n:r)}}function me(e,r){var n=r-e;return n?sc(e,n):zi(isNaN(e)?r:e)}var yi=function e(r){var n=Gg(r);function i(s,o){var a=n((s=fi(s)).r,(o=fi(o)).r),u=n(s.g,o.g),l=n(s.b,o.b),c=me(s.opacity,o.opacity);return function(f){return s.r=a(f),s.g=u(f),s.b=l(f),s.opacity=c(f),s+""}}return i.gamma=e,i}(1);function Ug(e,r){r||(r=[]);var n=e?Math.min(r.length,e.length):0,i=r.slice(),s;return function(o){for(s=0;s<n;++s)i[s]=e[s]*(1-o)+r[s]*o;return i}}function Hg(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Jg(e,r){var n=r?r.length:0,i=e?Math.min(n,e.length):0,s=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)s[a]=Wo(e[a],r[a]);for(;a<n;++a)o[a]=r[a];return function(u){for(a=0;a<i;++a)o[a]=s[a](u);return o}}function Yg(e,r){var n=new Date;return e=+e,r=+r,function(i){return n.setTime(e*(1-i)+r*i),n}}function Ys(e,r){return e=+e,r=+r,function(n){return e*(1-n)+r*n}}function Xg(e,r){var n={},i={},s;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(s in r)s in e?n[s]=Wo(e[s],r[s]):i[s]=r[s];return function(o){for(s in n)i[s]=n[s](o);return i}}var Xs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Rs=new RegExp(Xs.source,"g");function Kg(e){return function(){return e}}function Zg(e){return function(r){return e(r)+""}}function Qg(e,r){var n=Xs.lastIndex=Rs.lastIndex=0,i,s,o,a=-1,u=[],l=[];for(e=e+"",r=r+"";(i=Xs.exec(e))&&(s=Rs.exec(r));)(o=s.index)>n&&(o=r.slice(n,o),u[a]?u[a]+=o:u[++a]=o),(i=i[0])===(s=s[0])?u[a]?u[a]+=s:u[++a]=s:(u[++a]=null,l.push({i:a,x:Ys(i,s)})),n=Rs.lastIndex;return n<r.length&&(o=r.slice(n),u[a]?u[a]+=o:u[++a]=o),u.length<2?l[0]?Zg(l[0].x):Kg(r):(r=l.length,function(c){for(var f=0,d;f<r;++f)u[(d=l[f]).i]=d.x(c);return u.join("")})}function Wo(e,r){var n=typeof r,i;return r==null||n==="boolean"?zi(r):(n==="number"?Ys:n==="string"?(i=Tr(r))?(r=i,yi):Qg:r instanceof Tr?yi:r instanceof Date?Yg:Hg(r)?Ug:Array.isArray(r)?Jg:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?Xg:Ys)(e,r)}function oc(e){return function(r,n){var i=e((r=hn(r)).h,(n=hn(n)).h),s=me(r.s,n.s),o=me(r.l,n.l),a=me(r.opacity,n.opacity);return function(u){return r.h=i(u),r.s=s(u),r.l=o(u),r.opacity=a(u),r+""}}}var ew=oc(qo),tw=oc(me);function rw(e,r){var n=me((e=Us(e)).l,(r=Us(r)).l),i=me(e.a,r.a),s=me(e.b,r.b),o=me(e.opacity,r.opacity);return function(a){return e.l=n(a),e.a=i(a),e.b=s(a),e.opacity=o(a),e+""}}function ac(e){return function(r,n){var i=e((r=Hs(r)).h,(n=Hs(n)).h),s=me(r.c,n.c),o=me(r.l,n.l),a=me(r.opacity,n.opacity);return function(u){return r.h=i(u),r.c=s(u),r.l=o(u),r.opacity=a(u),r+""}}}var nw=ac(qo),iw=ac(me);function uc(e){return function r(n){n=+n;function i(s,o){var a=e((s=Js(s)).h,(o=Js(o)).h),u=me(s.s,o.s),l=me(s.l,o.l),c=me(s.opacity,o.opacity);return function(f){return s.h=a(f),s.s=u(f),s.l=l(Math.pow(f,n)),s.opacity=c(f),s+""}}return i.gamma=r,i}(1)}var sw=uc(qo),ow=uc(me);function aw(e,r){r===void 0&&(r=e,e=Wo);for(var n=0,i=r.length-1,s=r[0],o=new Array(i<0?0:i);n<i;)o[n]=e(s,s=r[++n]);return function(a){var u=Math.max(0,Math.min(i-1,Math.floor(a*=i)));return o[u](a-u)}}var uw=e=>{const r=Ri(e);if(r===null)throw new Error(`Could not resolve colour ${e}`);if(fc(r))return r;if(dc(r)){const n=hn(r);return r.opacity?{...n,opacity:r.opacity}:n}throw new Error(`Could not resolve colour ${e}`)},lw=(e,r=.5,n=.75,i=1)=>{P(e,"positive","index"),P(r,"percentage","saturation"),P(n,"percentage","lightness"),P(i,"percentage","alpha");const s=e*137.508;return i===1?`hsl(${s},${r*100}%,${n*100}%)`:`hsl(${s},${r*100}%,${n*100}%,${i*100}%)`},Go=(e=fe)=>e()*360,cw=e=>{const r=Ri(e),n=r.rgb();return r.opacity<1?{r:n.r,g:n.g,b:n.b,opacity:r.opacity}:{r:n.r,g:n.g,b:n.b}},Ri=e=>{if(typeof e=="string"){const r=Tr(e);if(r!==null)return r;throw e.startsWith("hsl")&&e.indexOf("%")<=0?new Error(`Could not resolve CSS colour ${e}. HSL values should be in the form: hsl(0, 50%, 50%)`):new Error(`Could not resolve CSS colour ${e}`)}else{if(fc(e))return hn(e.h,e.s,e.l);if(dc(e))return fi(e.r,e.g,e.b)}throw new Error(`Could not resolve colour ${JSON.stringify(e)}`)},fw=e=>Ri(e).formatHex(),vn=(e,r)=>{const n=Ri(e);return n.opacity*=r,n.toString()},lc=(e,r="black",n)=>{n===void 0&&(n=document.body);const i=getComputedStyle(n).getPropertyValue(`--${e}`).trim();return i===void 0||i.length===0?r:i},dw=(e,r,n,i)=>{if(P(e,"percentage","amount"),typeof r!="string")throw new Error("Expected string for 'from' param");if(typeof n!="string")throw new Error("Expected string for 'to' param");let s;typeof i>"u"?s={}:typeof i=="string"?s={space:i}:s=i;const o=cc(s,[r,n]);if(o===void 0)throw new Error("Could not handle colour/space");return o(e)},cc=(e,r)=>{if(!Array.isArray(r))throw new Error("Expected one or more colours as parameters");let n;if(typeof e>"u"?n={}:typeof e=="string"?n={space:e}:n=e,!Array.isArray(r))throw new Error("Expected array for colours parameter");if(r.length<2)throw new Error("Interpolation expects at least two colours");const{space:i="rgb",long:s=!1}=n;let o;switch(i){case"lab":{o=rw;break}case"hsl":{o=s?tw:ew;break}case"hcl":{o=s?iw:nw;break}case"cubehelix":{o=s?ow:sw;break}case"rgb":o=yi;default:o=yi}return n.gamma&&(i==="rgb"||i==="cubehelix")&&(o=o.gamma(n.gamma)),r.length>2?aw(o,r):o(r[0],r[1])},hw=(e,r,...n)=>{if(P(e,"aboveZero","steps"),!Array.isArray(n))throw new Error("Expected one or more colours as parameters");const i=cc(r,n);if(i===void 0)throw new Error("Could not handle colour/space");const s=1/(e-1),o=[];let a=0;for(let u=0;u<e;u++)o.push(i(a)),a+=s,a>1&&(a=1);return o},fc=e=>!(e.h===void 0||e.s===void 0||e.l===void 0),dc=e=>!(e.r===void 0||e.g===void 0||e.b===void 0),Ne=(e,r=0,n=1)=>{if(Number.isNaN(e))throw new Error("'value' parameter is NaN");if(Number.isNaN(r))throw new Error("'min' parameter is NaN");if(Number.isNaN(n))throw new Error("'max' parameter is NaN");return e<r?r:e>n?n:e},Ks=(e,r)=>{if(!Number.isInteger(e))throw new TypeError(`v parameter must be an integer (${e})`);const n=Array.isArray(r)?r.length:r;if(!Number.isInteger(n))throw new TypeError(`length parameter must be an integer (${n}, ${typeof n})`);return e=Math.round(e),e<0?0:e>=n?n-1:e},yw={};E(yw,{IterableAsync:()=>Ii,comparerInverse:()=>Fw,defaultComparer:()=>Vr,defaultKeyer:()=>Nn,ifNaN:()=>eo,isFunction:()=>bw,isInteger:()=>Ko,isMap:()=>Aw,isPlainObject:()=>_c,isPlainObjectOrPrimitive:()=>Zo,isPowerOfTwo:()=>Tc,isSet:()=>Cw,jsComparer:()=>jc,numericComparer:()=>Ic,relativeDifference:()=>Ew,roundUpToMultiple:()=>zc,runningiOS:()=>Sw,toStringDefault:()=>ot});var Ii={};E(Ii,{chunks:()=>vc,concat:()=>pc,dropWhile:()=>mc,equals:()=>wc,every:()=>xc,fill:()=>bc,filter:()=>Ec,find:()=>Dc,flatten:()=>Ac,forEach:()=>Cc,fromArray:()=>Ho,fromFunction:()=>xw,fromFunctionAwaited:()=>ww,fromIterable:()=>Jo,map:()=>Sc,max:()=>Fc,min:()=>Pc,nextWithTimeout:()=>Yo,reduce:()=>Nc,repeat:()=>mw,slice:()=>kc,some:()=>Mc,toArray:()=>Xo,unique:()=>Qs,uniqueByValue:()=>$c,until:()=>gc,withDelay:()=>gw,zip:()=>Bc});function V(e,r){if(hc(e)){if(typeof e=="number")return e;let n=e.millis??0;return n+=(e.hours??0)*60*60*1e3,n+=(e.mins??0)*60*1e3,n+=(e.secs??0)*1e3,n}else{if(typeof r<"u")return r;throw new Error(`Not a valid interval: ${e}`)}}function hc(e){if(e===void 0||e===null)return!1;if(typeof e=="number")return!(Number.isNaN(e)||!Number.isFinite(e));if(typeof e!="object")return!1;const r="millis"in e,n="secs"in e,i="mins"in e,s="hours"in e;return r&&!J(e.millis)[0]||n&&!J(e.secs)[0]||i&&!J(e.mins)[0]||s&&!J(e.hours)[0]?!1:!!(r||n||s||i)}var Zs=e=>{switch(typeof e){case"string":return e;case"object":return JSON.stringify(e);default:return""+e}},Cl=e=>{if(typeof e=="string")return e;const r=new Set;return JSON.stringify(e,(n,i)=>(r.add(n),i)),JSON.stringify(e,[...r].sort())},G=(e,r)=>e===r,yc=(e,r)=>e===r?!0:Zs(e)===Zs(r),Uo=(e,r)=>e===r?!0:Cl(e)===Cl(r);(typeof window>"u"||!("requestAnimationFrame"in window))&&typeof window>"u"&&(globalThis.requestAnimationFrame=e=>{setTimeout(e,1)});var de=e=>{const r=V(e,1),n=e.signal,i=e.value;return P(r,"positive","timeoutMs"),r===0?new Promise(s=>requestAnimationFrame(o=>{s(i)})):new Promise((s,o)=>{const a=()=>{clearTimeout(u),n?(n.removeEventListener("abort",a),o(new Error(n.reason))):o(new Error("Cancelled"))};n&&n.addEventListener("abort",a);const u=setTimeout(()=>{if(n?.removeEventListener("abort",a),n?.aborted){o(new Error(n.reason));return}s(i)},r)})},vw=async(e,r=100)=>{for(;e();)await de(r)},H=e=>Symbol.asyncIterator in new Object(e),Pn=e=>Symbol.iterator in new Object(e),pw=(e,r)=>{const n=[],i=[];let s=!1;const o=c=>{n.length>0?n.shift()(...c):i.push(c)},a=()=>new Promise(c=>{if(i.length>0){const f=i.shift();c(...f)}else n.push(c)}),u=(...c)=>{o(c)};return e.addEventListener(r,u),{next:async()=>s?{done:!0,value:void 0}:{done:!1,value:await a()},return:async()=>(s=!0,e.removeEventListener(r,u),{done:!0,value:void 0}),throw:async c=>(s=!0,{done:!0,value:Promise.reject(new Error(c))})}};async function*Ho(e,r=1){for(const n of e)yield n,await de(r)}async function*Jo(e,r=1){for await(const n of e)yield n,await de(r)}async function*vc(e,r){let n=[];for await(const i of e)n.push(i),n.length===r&&(yield n,n=[]);n.length>0&&(yield n)}async function*pc(...e){for await(const r of e)yield*r}async function*mc(e,r){for await(const n of e)r(n)||(yield n)}var gc=async(e,r)=>{for await(const n of e){const i=await r();if(typeof i=="boolean"&&!i)break}},mw=async function*(e,r){const n=typeof r=="number"?r:Number.POSITIVE_INFINITY,i=typeof r=="number"?void 0:r;let s=n;for(;;){for await(const o of e())if(yield o,i?.aborted)break;if(Number.isFinite(n)&&(s--,s===0)||i?.aborted)break}};async function wc(e,r,n){const i=e[Symbol.asyncIterator](),s=r[Symbol.asyncIterator]();for(;;){const o=await i.next(),a=await s.next();if(n!==void 0){if(!n(o.value,a.value))return!1}else if(o.value!==a.value)return!1;if(o.done??a.done)return o.done&&a.done}}async function xc(e,r){for await(const n of e)if(!await r(n))return!1;return!0}async function*bc(e,r){for await(const n of e)yield r}async function*Ec(e,r){for await(const n of e)await r(n)&&(yield n)}async function Dc(e,r){for await(const n of e)if(await r(n))return n}async function*Ac(e){for await(const r of e)if(typeof r=="object"){if(Array.isArray(r))for(const n of r)yield n;else if(H(r))for await(const n of r)yield n;else if(Pn(r))for(const n of r)yield n}else yield r}async function Cc(e,r){for await(const n of e){const i=await r(n);if(typeof i=="boolean"&&!i)break}}async function*Sc(e,r){for await(const n of e)yield r(n)}async function*Fc(e,r=(n,i)=>n>i){let n;for await(const i of e){if(n===void 0){n=i,yield n;continue}r(i,n)&&(n=i,yield i)}}async function*Pc(e,r=(n,i)=>n>i){let n;for await(const i of e){if(n===void 0){n=i,yield n;continue}r(n,i)&&(n=i,yield i)}return n}async function Nc(e,r,n){for await(const i of e)n=r(n,i);return n}async function*kc(e,r=0,n=Number.POSITIVE_INFINITY){const i=e[Symbol.asyncIterator]();for(;r>0;r--,n--)await i.next();for await(const s of e)if(n-- >0)yield s;else break}async function*gw(e,r){for(const n of e)await de(r),yield n}async function Yo(e,r){const n=V(r,1e3),i=await Promise.race([(async()=>{await de({millis:n,signal:r.signal})})(),(async()=>await e.next())()]);if(i===void 0)throw new Error("Timeout");return i}async function Mc(e,r){for await(const n of e)if(await r(n))return!0;return!1}async function Xo(e,r=Number.POSITIVE_INFINITY){const n=[],i=e[Symbol.asyncIterator]();for(;n.length<r;){const s=await i.next();if(s.done)break;n.push(s.value)}return n}async function*ww(e){for(;;)yield await e()}function*xw(e){for(;;)yield e()}async function*Qs(e){const r=[],n=Array.isArray(e)?e:[e];for await(const i of n)for await(const s of i)r.includes(s)||(r.push(s),yield s)}async function*$c(e,r=Zs,n=new Set){for await(const i of e){const s=r(i);n.has(s)||(n.add(s),yield i)}}async function*Bc(...e){const r=e.map(n=>n[Symbol.asyncIterator]());for(;;){const n=await Promise.all(r.map(i=>i.next()));if(n.some(i=>i.done))return;yield n.map(i=>i.value)}}var bw=e=>e instanceof Function,_c=e=>{if(typeof e!="object"||e===null)return!1;const r=Object.getPrototypeOf(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Ko=e=>{if(e===void 0)return!1;if(typeof e=="string"){const r=Number.parseInt(e);return Number.isNaN(r)?!1:r.toString()===e.toString()}return typeof e=="number"?Number.isNaN(e)||!Number.isFinite(e)?!1:Math.round(e)===e:!1},Zo=e=>{const r=typeof e;return r==="symbol"||r==="function"?!1:r==="bigint"||r==="number"||r==="string"||r==="boolean"?!0:_c(e)},eo=(e,r)=>{if(Number.isNaN(e))return r;if(typeof e!="number")throw new TypeError(`v is not a number. Got: ${typeof e}`);return e},Tc=e=>Math.log2(e)%1===0,Ew=e=>r=>r/e,zc=(e,r)=>(U(J(e,"nonZero","v")),U(J(r,"nonZero","multiple")),Math.ceil(e/r)*r),Dw=Object.prototype.toString,Rc=e=>Dw.call(e),Aw=e=>Rc(e)==="[object Map]",Cw=e=>Rc(e)==="[object Set]",ot=e=>typeof e=="string"?e:JSON.stringify(e),Sw=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,Ic=(e,r)=>e===r?0:e>r?1:-1,jc=(e,r)=>{if(e===void 0&&r===void 0)return 0;if(e===void 0)return 1;if(r===void 0)return-1;const n=Sl(e),i=Sl(r);return n<i?-1:n>i?1:0},Vr=(e,r)=>typeof e=="number"&&typeof r=="number"?Ic(e,r):jc(e,r),Fw=e=>(r,n)=>e(r,n)*-1,Nn=e=>typeof e=="string"?e:JSON.stringify(e),Sl=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw new TypeError("Symbol cannot be converted to string");return JSON.stringify(e)},Pw={};E(Pw,{SimpleEventEmitter:()=>Le,eventRace:()=>Oc});var Nw=(e,r,n=G)=>{for(const i of e.entries()){const s=i[1];for(const o of s)if(n(o,r))return i}},kw=class{map;groupBy;valueEq;constructor(e=Nn,r=G,n=[]){this.groupBy=e,this.valueEq=r,this.map=new Map(n)}*entriesFlat(){for(const e of this.map.keys())for(const r of this.map.get(e))yield[e,r]}*entries(){for(const[e,r]of this.map.entries())yield[e,[...r]]}firstKeyByValue(e,r=G){const n=Nw(this,e,r);if(n)return n[0]}*get(e){const r=this.map.get(e);r&&(yield*r.values())}*keys(){yield*this.map.keys()}*valuesFlat(){for(const e of this.map)yield*e[1]}*keysAndCounts(){for(const e of this.map)yield[e[0],e[1].length]}has(e){return this.map.has(e)}hasKeyValue(e,r){const n=this.map.get(e);if(!n)return!1;for(const i of n)if(this.valueEq(i,r))return!0;return!1}debugString(){let e="";return[...this.map.keys()].every(n=>{const i=this.map.get(n);i!==void 0&&(e+=n+` (${i.length}) = ${JSON.stringify(i)}\r
`)}),e}get isEmpty(){return this.map.size===0}count(e){const r=this.map.get(e);return r?r.length:0}get lengthKeys(){return this.map.size}},Lc=class extends kw{addKeyedValues(e,...r){const n=this.map.get(e);n===void 0?this.map.set(e,r):this.map.set(e,[...n,...r])}addValue(...e){for(const r of e){const n=this.groupBy(r);this.addKeyedValues(n,r)}}deleteKeyValue(e,r){const n=this.map.get(e);if(n===void 0)return!1;const i=n.filter(s=>!this.valueEq(s,r));return this.map.set(e,i),i.length<n.length}deleteByValue(e){let r=!1;const n=[...this.map.entries()];for(const i of n)for(const s of i[1])this.valueEq(s,e)&&(r=!0,this.deleteKeyValue(i[0],e));return r}delete(e){const r=this.map.get(e);return!r||r.length===0?!1:(this.map.delete(e),!0)}clear(){this.map.clear()}},Vc=(e=Nn,r=G)=>new Lc(e,r),Oc=(e,r,n={})=>{const i=V(n.timeout,6e4),s=n.signal;let o=!1,a=!1,u;return new Promise((c,f)=>{const d=y=>{"type"in y?r.includes(y.type)?(o=!0,c(y),h()):console.warn(`eventRace: Got event '${y.type}' that is not in race list`):(console.warn("eventRace: Event data does not have expected 'type' field"),console.log(y))};for(const y of r)e.addEventListener(y,d);const h=()=>{if(!a){u!==void 0&&clearTimeout(u),u=void 0,a=!0;for(const y of r)e.removeEventListener(y,d)}};u=setTimeout(()=>{o||a||(h(),f(new Error(`eventRace: Events not fired within interval. Events: ${JSON.stringify(r)} Interval: ${i}`)))},i),s?.addEventListener("abort",()=>{o||a||(h(),f(new Error(`Abort signal received ${s.reason}`)))})})},Le=class{#e=Vc();fireEvent(e,r){const n=this.#e.get(e);for(const i of n)i(r,this)}addEventListener(e,r){this.#e.addKeyedValues(e,r)}removeEventListener(e,r){this.#e.deleteKeyValue(e,r)}clearEventListeners(){this.#e.clear()}},qc={};E(qc,{MassiveSet:()=>$w,immutable:()=>Mw,mutable:()=>Wc});var Wc=e=>new Gc(e),Gc=class extends Le{store=new Map;keyString;constructor(e){super(),this.keyString=e??Nn}get size(){return this.store.size}add(...e){let r=!1;for(const n of e){const i=this.has(n);this.store.set(this.keyString(n),n),super.fireEvent("add",{value:n,updated:i}),i||(r=!0)}return r}values(){return this.store.values()}clear(){this.store.clear(),super.fireEvent("clear",!0)}delete(e){const r=this.store.delete(this.keyString(e));return r&&super.fireEvent("delete",e),r}has(e){return this.store.has(this.keyString(e))}toArray(){return[...this.store.values()]}},Uc=class to{store;keyString;constructor(r,n){this.store=n??new Map,this.keyString=r??Nn}get size(){return this.store.size}add(...r){const n=new Map(this.store);for(const i of r){const s=this.keyString(i);n.set(s,i)}return new to(this.keyString,n)}delete(r){const n=new Map(this.store),i=this.keyString(r);return n.delete(i)?new to(this.keyString,n):this}has(r){const n=this.keyString(r);return this.store.has(n)}toArray(){return[...this.store.values()]}*values(){yield*this.store.values()}},Mw=(e=ot)=>new Uc(e),$w=class Hc{#e;#t;children=new Map;values=[];constructor(r=1,n=0){this.#e=n,this.#t=r}sizeLocal(){return this.values.length}sizeChildren(){return[...this.children.values()].length}sizeChildrenDeep(){let r=this.sizeChildren();for(const n of this.children.values())r+=n.sizeChildrenDeep();return r}size(){let r=this.values.length;for(const n of this.children.values())r+=n.size();return r}add(r){if(typeof r!="string")throw new Error(`Param 'value' must be a string. Got: ${typeof r}`);if(r.length===0)throw new Error("Param 'value' is empty");const n=this.#n(r,!0);if(n===this){this.hasLocal(r)||this.values.push(r);return}if(!n)throw new Error(`Could not create child set for: ${r}`);n.add(r)}remove(r){if(typeof r!="string")throw new Error(`Param 'value' must be a string. Got: ${typeof r}`);if(r.length===0)throw new Error("Param 'value' is empty");const n=this.#n(r,!1);return n===void 0?!1:n===this?this.hasLocal(r)?(this.values=this.values.filter(i=>i!==r),!0):!1:n.remove(r)}debugDump(){const r=this.#r();for(const n of r)console.log(n)}#r(r=0){const n=[];n.push(`Depth: ${this.#e} Max: ${this.#t}`);for(const[i,s]of this.children.entries()){const o=s.#r(r+1);n.push(` key: ${i}`);for(const a of o)n.push(" ".repeat(r+1)+a)}n.push(`Values: (${this.values.length})`);for(const i of this.values)n.push(` ${i}`);return n.map(i=>" ".repeat(r)+i)}#n(r,n){if(r===void 0)throw new Error("Param 'value' undefined");if(this.#e===this.#t)return this;if(r.length<=this.#e)return this;const i=r[this.#e];if(i===void 0)throw new Error(`Logic error. Depth: ${this.#e} Len: ${r.length}`);let s=this.children.get(i);return s===void 0&&n&&(s=new Hc(this.#t,this.#e+1),this.children.set(i,s)),s}hasLocal(r){for(const n of this.values)if(n===r)return!0;return!1}has(r){if(typeof r!="string")return!1;const n=this.#n(r,!1);return n===void 0?!1:n===this?this.hasLocal(r):n.has(r)}},Dt={};E(Dt,{additionalValues:()=>oo,average:()=>ta,averageWeighted:()=>df,chunks:()=>ix,compareValues:()=>Vi,compareValuesEqual:()=>yf,contains:()=>lx,containsDuplicateInstances:()=>gf,containsDuplicateValues:()=>ux,cycle:()=>Hw,dotProduct:()=>sf,ensureLength:()=>Kw,filterAB:()=>ax,filterBetween:()=>rf,flatten:()=>Yw,groupBy:()=>rx,guardArray:()=>Or,guardIndex:()=>vi,insertAt:()=>pf,interleave:()=>Xw,intersection:()=>Jw,isEqual:()=>wf,max:()=>af,maxFast:()=>lf,maxIndex:()=>Uw,mergeByKey:()=>sx,min:()=>of,minFast:()=>na,minIndex:()=>ra,minMaxAvg:()=>kn,randomElement:()=>Oi,randomElementWeightedSource:()=>Zw,randomIndex:()=>ia,randomPluck:()=>Qw,reducePairwise:()=>ox,remove:()=>vf,sample:()=>nx,shuffle:()=>pn,sortByNumericProperty:()=>Li,total:()=>uf,totalFast:()=>cf,unique:()=>mf,until:()=>tx,validNumbers:()=>zr,valuesEqual:()=>Qo,weight:()=>nf,without:()=>Mn,withoutUndefined:()=>ex,zip:()=>ff});var Bw=(e,r)=>{if(r=Math.round(r),e.has(r))return r;{let n=1;for(;n<1e3;){if(e.has(r-n))return r-n;if(e.has(r+n))return r+n;n++}throw new Error(`Could not find target ${r}`)}},Jc=(e,r)=>{for(const n of r)if(e.has(n))return e.get(n)},_w=(e,r,n,i)=>e.has(r)?[...e.values()].some(o=>i(o,n)):!1,Tw=(e,r,n=G)=>{for(const i of Object.entries(e))n(i[1],r)&&e.delete(i[0])},zw=(e,r)=>{for(const n of e.entries())if(r(n[1],n[0]))return n},Rw=(e,r,n=G)=>{for(const i of e.entries())if(n(i[1],r))return i},Yc=(e,r,...n)=>{const i=e===void 0?new Map:new Map(e);for(const s of n){const o=r(s);i.has(o)||i.set(o,s)}return i},Iw=(e,r)=>{const n=r??Vr;return[...e.entries()].sort((i,s)=>n(i[1],s[1]))},Xc=(e,r,n)=>{const i=typeof n>"u"?Vr:n;return[...e.entries()].sort((s,o)=>{const a=s[1],u=o[1];return i(a[r],u[r])})},Kc=(e,r,n)=>[...e.entries()].some(s=>n(s[1],r));function*Zc(e,r){for(const n of e.values())r(n)&&(yield n)}var ro=e=>[...e.values()],Qc=(e,r=ot,n=!1)=>{const i=new Map;for(const s of e){const o=r(s);if(i.has(o)&&!n)throw new Error(`id ${o} is already used and new data will overwrite it. `);i.set(o,s)}return i},jw=e=>{const r=new Map;if(Array.isArray(e))for(const n of e)no(r,n);else no(r,e);return r},no=(e,r)=>{const n=Object.entries(r);for(const[i,s]of n)e.set(i,s)},ef=(e,r)=>[...e.values()].find(n=>r(n)),Lw=(e,r)=>[...e.values()].some(n=>r(n)),Vw=(e,r)=>[...e].reduce((n,[i,s])=>{const o=r(s);return n[i]=o,n},{}),ji=(e,r)=>{if(e.length!==r.length)throw new Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((n,i)=>[n,r[i]]))},Ow=(e,r)=>new Map(Array.from(e,n=>[n[0],r(n[1],n[0])])),qw=e=>[...e].reduce((r,[n,i])=>(r[n]=i,r),{}),Ww=(e,r)=>[...e.entries()].map(n=>r(n[0],n[1])),Gw=(e,...r)=>{const n=new Map;for(const i of r)for(const[s,o]of i){let a=n.get(s);a=a?e(a,o):o,n.set(s,a)}return n},tf=(e,r=fe)=>{const n=[];let i=0;for(let s=0;s<e.length;s++)i+=e[s],n[s]=i;if(i!==1)throw new Error(`Weightings should add up to 1. Got: ${i}`);return()=>{const s=r();for(let o=0;o<n.length;o++)if(s<=n[o])return o;throw new Error("Bug: weightedIndex could not select index")}},Or=(e,r="?")=>{if(e===void 0)throw new TypeError(`Param '${r}' is undefined. Expected array.`);if(e===null)throw new TypeError(`Param '${r}' is null. Expected array.`);if(!Array.isArray(e))throw new TypeError(`Param '${r}' not an array as expected`)},vi=(e,r,n="index")=>{if(Or(e),le(r,"positive",n),r>e.length-1)throw new Error(`'${n}' ${r} beyond array max of ${e.length-1}`)},Qo=(e,r)=>{if(!Array.isArray(e))throw new Error("Param 'array' is not an array.");if(e.length===0)return!0;const n=r??yc,i=e[0];return!e.some(o=>!n(i,o))};function*ea(e,r=0,n=Number.POSITIVE_INFINITY){const i=e[Symbol.iterator]();for(;r>0;r--,n--)i.next();for(const s of e)if(n-- >0)yield s;else break}var rf=(e,r,n,i)=>{Or(e),typeof n>"u"&&(n=0),typeof i>"u"&&(i=e.length),vi(e,n,"startIndex"),vi(e,i-1,"endIndex");const s=[];for(let o=n;o<i;o++)r(e[o],o,e)&&s.push(e[o]);return s},kn=(e,r={})=>{if(e===void 0)throw new Error("'data' is undefined");if(!Array.isArray(e))if("next"in e){(r.startIndex||r.endIndex)&&(e=ea(e,r.startIndex,r.endIndex));let a=0,u=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,c=0;for(const f of e){if(typeof f!="number")throw new TypeError(`Generator should yield numbers. Got: ${typeof f}`);a+=f,c++,u=Math.min(u,f),l=Math.max(l,f)}return{avg:a/c,total:a,max:l,min:u}}else throw new Error("'data' parameter is neither array or iterable");if(e.length===0)return{total:0,min:0,max:0,avg:0};const n=r.startIndex??0,i=r.endIndex??e.length,s=rf(e,a=>typeof a=="number"&&!Number.isNaN(a),n,i),o=s.reduce((a,u)=>a+u,0);return{total:o,max:Math.max(...s),min:Math.min(...s),avg:o/s.length}},nf=(e,r)=>{const n=r??(i=>i);return zr(e).map((i,s)=>i*n(s/(zr.length-1)))},zr=e=>e.filter(r=>typeof r=="number"&&!Number.isNaN(r)),sf=e=>{let r=0;const n=e[0].length;for(let i=0;i<n;i++){let s=0;for(const[o,a]of e.entries())o===0?s=a[i]:s*=a[i];r+=s}return r},ta=e=>{if(e===void 0)throw new Error("data parameter is undefined");const r=zr(e);return r.reduce((i,s)=>i+s,0)/r.length},of=e=>Math.min(...zr(e)),Uw=e=>e.reduce((r,n,i,s)=>n>s[r]?i:r,0),ra=(...e)=>e.reduce((r,n,i,s)=>n<s[r]?i:r,0),af=e=>Math.max(...zr(e)),uf=e=>e.reduce((r,n)=>typeof n!="number"||Number.isNaN(n)||Number.isFinite(n)?r:r+n,0),lf=e=>{let r=Number.MIN_SAFE_INTEGER;for(const n of e)r=Math.max(r,n);return r},cf=e=>{let r=0;for(const n of e)r+=n;return r},na=e=>{let r=Number.MIN_SAFE_INTEGER;for(const n of e)r=Math.min(r,n);return r},Hw=e=>{const r=[...e];let n=0;const i=()=>(n++,n===r.length&&(n=0),o()),s=()=>(n--,n===-1&&(n=r.length-1),o()),o=()=>r.at(n);return{toArray:()=>[...r],next:i,prev:s,get current(){return o()},select:l=>{if(typeof l=="number")n=l;else{const c=r.indexOf(l);if(c===-1)throw new Error("Could not find value");n=c}}}},ff=(...e)=>{if(e.some(s=>!Array.isArray(s)))throw new Error("All parameters must be an array");const r=e.map(s=>s.length);if(!Qo(r))throw new Error("Arrays must be of same length");const n=[],i=r[0];for(let s=0;s<i;s++)n.push(e.map(o=>o[s]));return n},df=(e,r)=>{typeof r=="function"&&(r=nf(e,r));const n=ff(e,r),[i,s]=n.reduce((o,a)=>[o[0]+a[0]*a[1],o[1]+a[1]],[0,0]);return i/s},Li=(e,r)=>[...e].sort((n,i)=>{Or(e,"data");const s=n[r],o=i[r];return s<o?-1:s>o?1:0}),hf={};E(hf,{compareValues:()=>Vi,compareValuesEqual:()=>yf,max:()=>io,min:()=>so});var io=(e,r)=>{let n,i=Number.MIN_SAFE_INTEGER;for(const s of e){const o=r(s);o>=i&&(i=o,n=s)}return n},so=(e,r)=>{let n,i=Number.MAX_SAFE_INTEGER;for(const s of e){const o=r(s);o<=i&&(i=o,n=s)}return n},yf=(e,r,n=G)=>{const i=Vi(e,r,n);return i.a.length===0&&i.b.length===0},Vi=(e,r,n=G)=>{const i=[],s=[],o=[];for(const u of e){let l=!1;for(const c of r)if(n(u,c)){l=!0;break}l?i.push(u):s.push(u)}for(const u of r){let l=!1;for(const c of e)n(u,c)&&(l=!0);l||o.push(u)}const a=s.length===0&&o.length===0;return{shared:i,a:s,b:o,isSame:a}},Jw=(e,r,n=G)=>e.filter(i=>r.some(s=>n(i,s))),Yw=e=>[...e].flat(),Xw=(...e)=>{if(e.some(s=>!Array.isArray(s)))throw new Error("All parameters must be an array");const r=e.map(s=>s.length);if(!Qo(r))throw new Error("Arrays must be of same length");const n=[],i=r[0];for(let s=0;s<i;s++)for(const o of e)n.push(o[s]);return n},Kw=(e,r,n="undefined")=>{if(e===void 0)throw new Error("Data undefined");if(!Array.isArray(e))throw new Error("data is not an array");if(e.length===r)return[...e];if(e.length>r)return e.slice(0,r);const i=[...e],s=r-i.length;for(let o=0;o<s;o++)switch(n){case"undefined":{i.push(void 0);break}case"repeat":{i.push(e[o%e.length]);break}case"first":{i.push(e[0]);break}case"last":{i.push(e.at(-1));break}}return i},ia=(e,r=fe)=>Math.floor(r()*e.length),Zw=(e,r,n=fe)=>{if(e.length!==r.length)throw new Error("Lengths of 'array' and 'weightings' should be the same.");const i=tf(r,n);return()=>{const s=i();return e[s]}},Oi=(e,r=fe)=>(Or(e,"array"),e[Math.floor(r()*e.length)]),Qw=(e,r=!1,n=fe)=>{if(e===void 0)throw new Error("array is undefined");if(!Array.isArray(e))throw new Error("'array' param is not an array");if(e.length===0)return{value:void 0,array:[]};const i=ia(e,n);if(r)return{value:e[i],array:e.splice(i,1)};{const s=[...e];return s.splice(i,1),{value:e[i],array:s}}},pn=(e,r=fe)=>{const n=[...e];for(let i=n.length-1;i>0;i--){const s=Math.floor(r()*(i+1));[n[i],n[s]]=[n[s],n[i]]}return n},Mn=(e,r,n=G)=>{if(Array.isArray(r)){const i=[];for(const s of e)r.some(o=>n(s,o))||i.push(s);return i}else return e.filter(i=>!n(i,r))},ex=e=>e.filter(r=>r!==void 0),tx=(e,r,n)=>{const i=[];let s=n;for(const o of e){const[a,u]=r(o,s);if(a)break;s=u,i.push(o)}return i},vf=(e,r)=>{if(!Array.isArray(e))throw new TypeError("'data' parameter should be an array");return vi(e,r,"index"),[...e.slice(0,r),...e.slice(r+1)]},pf=(e,r,...n)=>{if(!Array.isArray(e))throw new TypeError("Param 'data' is not an arry");return[...e.slice(0,r),...n,...e.slice(r+1)]},rx=(e,r)=>{const n=new Map;for(const i of e){const s=r(i);let o=n.get(s);o||(o=[],n.set(s,o)),o.push(i)}return n},nx=(e,r)=>{let n=1;if(r<=1){const s=e.length*r;n=Math.round(e.length/s)}else n=r;if(le(n,"positive","amount"),n>e.length-1)throw new Error("Subsample steps exceeds array length");const i=[];for(let s=n-1;s<e.length;s+=n)i.push(e[s]);return i};function ix(e,r){const n=[];for(let i=0;i<e.length;i+=r)n.push(e.slice(i,i+r));return n}var sx=(e,r,...n)=>{const i=new Map;for(const s of n)for(const o of s){if(o===void 0)continue;const a=e(o);let u=i.get(a);u=u?r(u,o):o,i.set(a,u)}return[...i.values()]},ox=(e,r,n)=>{if(Or(e,"arr"),e.length<2)return n;for(let i=0;i<e.length-1;i++)n=r(n,e[i],e[i+1]);return n},ax=(e,r)=>{const n=[],i=[];for(const s of e)r(s)?n.push(s):i.push(s);return[n,i]},mf=(e,r=G)=>{const n=[];for(const i of e)if(Array.isArray(i))for(const s of oo(n,i,r))n.push(s);else return[...oo([],e,r)];return n},ux=(e,r=ot)=>{if(!Array.isArray(e))throw new Error("Parameter needs to be an array");try{const n=Qc(e,r)}catch{return!0}return!1},gf=e=>{if(!Array.isArray(e))throw new Error("Parameter needs to be an array");for(let r=0;r<e.length;r++)for(let n=0;n<e.length;n++)if(r!==n&&e[r]===e[n])return!0;return!1},wf=(e,r,n=G)=>{if(!Array.isArray(e))throw new Error("Parameter 'arrayA' is not actually an array");if(!Array.isArray(r))throw new Error("Parameter 'arrayB' is not actually an array");if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],r[i]))return!1;return!0},lx=(e,r,n=G)=>{if(!Array.isArray(e))throw new TypeError("Expects haystack parameter to be an array");if(!Array.isArray(r))throw new TypeError("Expects needles parameter to be an array");for(const i of r){let s=!1;for(const o of e)if(n(i,o)){s=!0;break}if(!s)return!1}return!0};function*oo(e,r,n=G){const i=[];for(const s of r)e.find(a=>n(a,s))||i.find(u=>n(u,s))||(i.push(s),yield s)}var cx={};E(cx,{Arcs:()=>mh,Beziers:()=>Td,Circles:()=>kf,Compound:()=>Yd,Convolve2d:()=>ch,CurveSimplification:()=>sh,Ellipses:()=>ih,Grids:()=>Ld,Layouts:()=>Nd,Lines:()=>Kt,Paths:()=>ln,Points:()=>S,Polar:()=>mn,QuadTree:()=>oh,Rects:()=>pi,Scaler:()=>Ai,Shapes:()=>Md,SurfacePoints:()=>Ah,Triangles:()=>nr,Vectors:()=>Si,Waypoints:()=>xf,degreeToRadian:()=>tr,radianToDegree:()=>sa,radiansFromAxisX:()=>fx});var xf={};E(xf,{fromPoints:()=>Pb,init:()=>Pd});var Kt={};E(Kt,{Empty:()=>vb,Placeholder:()=>pb,angleRadian:()=>wb,apply:()=>cd,asPoints:()=>Cb,bbox:()=>Cd,distance:()=>bd,divide:()=>dd,extendFromA:()=>Db,fromFlatArray:()=>Sb,fromNumbers:()=>Di,fromPoints:()=>Gi,fromPointsToPath:()=>Fb,getPointParameter:()=>Wi,guard:()=>qi,interpolate:()=>nt,isEmpty:()=>mb,isEqual:()=>ld,isLine:()=>at,isPlaceholder:()=>gb,isPolyLine:()=>ud,joinPointsToLines:()=>Ui,length:()=>_e,midpoint:()=>pd,multiply:()=>fd,nearest:()=>ma,normaliseByRect:()=>xb,parallel:()=>xd,perpendicularPoint:()=>wd,pointAtX:()=>Eb,pointsOf:()=>Ab,relativePosition:()=>Sd,rotate:()=>Fd,scaleFromMidpoint:()=>bb,slope:()=>ga,subtract:()=>yd,sum:()=>hd,toFlatArray:()=>Dd,toPath:()=>vt,toString:()=>Ed,toSvgString:()=>Ad,withinRange:()=>vd});var S={};E(S,{Empty:()=>cr,Placeholder:()=>ed,abs:()=>Yx,angle:()=>kr,apply:()=>Qx,bbox:()=>va,centroid:()=>td,clamp:()=>hb,clampMagnitude:()=>ad,compare:()=>sb,compareByX:()=>sd,convexHull:()=>ib,distance:()=>re,distanceToCenter:()=>Wx,distanceToExterior:()=>Zf,divide:()=>Ei,divider:()=>rb,dotProduct:()=>Qf,findMinimum:()=>Zt,from:()=>Zx,fromNumbers:()=>pa,getPointParameter:()=>Ae,guard:()=>R,guardNonZeroPoint:()=>Ff,interpolate:()=>Kx,invert:()=>fb,isEmpty:()=>Fr,isEqual:()=>wt,isNaN:()=>Ux,isNull:()=>Gx,isPlaceholder:()=>Pr,isPoint:()=>_,isPoint3d:()=>zt,leftmost:()=>Hx,multiply:()=>Ir,multiplyScalar:()=>tb,normalise:()=>od,normaliseByRect:()=>co,pipeline:()=>nd,pipelineApply:()=>eb,progressBetween:()=>yb,project:()=>lo,quantiseEvery:()=>nb,random:()=>lb,reduce:()=>id,relation:()=>oi,rightmost:()=>Jx,rotate:()=>xt,rotatePointArray:()=>ob,round:()=>ub,subtract:()=>Te,sum:()=>Rr,toArray:()=>rd,toIntegerValues:()=>db,toString:()=>bi,withinRange:()=>Xx,wrap:()=>cb});var mn={};E(mn,{clampMagnitude:()=>Af,divide:()=>bx,dotProduct:()=>Df,fromCartesian:()=>aa,guard:()=>ze,invert:()=>yx,isAntiParallel:()=>mx,isOpposite:()=>vx,isParallel:()=>px,isPolarCoord:()=>oa,multiply:()=>xx,normalise:()=>Ef,rotate:()=>bf,rotateDegrees:()=>gx,spiral:()=>hx,spiralRaw:()=>wx,toCartesian:()=>Bt,toPoint:()=>Sf,toString:()=>Cf});function tr(e){return Array.isArray(e)?e.map(r=>r*(Math.PI/180)):e*(Math.PI/180)}function sa(e){return Array.isArray(e)?e.map(r=>r*180/Math.PI):e*180/Math.PI}var fx=e=>Math.atan2(e.x,e.y),dx=Object.freeze({x:0,y:0}),oa=e=>!(e.distance===void 0||e.angleRadian===void 0),aa=(e,r)=>{e=Te(e,r);const n=Math.atan2(e.y,e.x);return Object.freeze({...e,angleRadian:n,distance:Math.hypot(e.x,e.y)})},Bt=(e,r,n)=>{if(oa(e)){if(r===void 0&&(r=cr),_(r))return Fl(e.distance,e.angleRadian,r);throw new Error("Expecting (Coord, Point). Second parameter is not a point")}else{if(typeof e=="object")throw new TypeError(`First param is an object, but not a Coord: ${JSON.stringify(e)}`);if(typeof e=="number"&&typeof r=="number"){if(n===void 0&&(n=cr),!_(n))throw new Error("Expecting (number, number, Point). Point param wrong type");return Fl(e,r,n)}else throw new TypeError(`Expecting parameters of (number, number). Got: (${typeof e}, ${typeof r}, ${typeof n}). a: ${JSON.stringify(e)}`)}};function*hx(e,r){let n=0;for(;;){const i=e*n++;yield{distance:r*i,angleRadian:i,step:n}}}var bf=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+r}),Ef=e=>{if(e.distance===0)throw new Error("Cannot normalise vector of length 0");return Object.freeze({...e,distance:1})},ze=(e,r="Point")=>{if(e===void 0)throw new Error(`'${r}' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e===null)throw new Error(`'${r}' is null. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.angleRadian===void 0)throw new Error(`'${r}.angleRadian' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.distance===void 0)throw new Error(`'${r}.distance' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(typeof e.angleRadian!="number")throw new TypeError(`'${r}.angleRadian' must be a number. Got ${e.angleRadian}`);if(typeof e.distance!="number")throw new TypeError(`'${r}.distance' must be a number. Got ${e.distance}`);if(e.angleRadian===null)throw new Error(`'${r}.angleRadian' is null`);if(e.distance===null)throw new Error(`'${r}.distance' is null`);if(Number.isNaN(e.angleRadian))throw new TypeError(`'${r}.angleRadian' is NaN`);if(Number.isNaN(e.distance))throw new Error(`'${r}.distance' is NaN`)},Df=(e,r)=>(ze(e,"a"),ze(r,"b"),e.distance*r.distance*Math.cos(r.angleRadian-e.angleRadian)),yx=e=>(ze(e,"c"),Object.freeze({...e,angleRadian:e.angleRadian-Math.PI})),vx=(e,r)=>(ze(e,"a"),ze(r,"b"),e.distance!==r.distance?!1:e.angleRadian===-r.angleRadian),px=(e,r)=>(ze(e,"a"),ze(r,"b"),e.angleRadian===r.angleRadian),mx=(e,r)=>(ze(e,"a"),ze(r,"b"),e.angleRadian===-r.angleRadian),gx=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+tr(r)}),wx=(e,r,n)=>{const i=r*e;return Object.freeze({distance:n*i,angleRadian:i})},xx=(e,r)=>(ze(e),P(r,"","amt"),Object.freeze({...e,distance:e.distance*r})),bx=(e,r)=>(ze(e),P(r,"","amt"),Object.freeze({...e,distance:e.distance/r})),Af=(e,r=1,n=0)=>{let i=e.distance;return i>r&&(i=r),i<n&&(i=n),Object.freeze({...e,distance:i})},Fl=(e,r,n=cr)=>(R(n),Object.freeze({x:n.x+e*Math.cos(r),y:n.y+e*Math.sin(r)})),Cf=(e,r)=>{if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=sa(e.angleRadian),i=r?e.distance.toFixed(r):e.distance,s=r?n.toFixed(r):n;return`(${i},${s})`},Sf=(e,r=dx)=>(ze(e,"v"),Object.freeze({x:r.x+e.distance*Math.cos(e.angleRadian),y:r.y+e.distance*Math.sin(e.angleRadian)}));function R(e,r="Point"){if(e===void 0)throw new Error(`'${r}' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e===null)throw new Error(`'${r}' is null. Expected {x,y} got ${JSON.stringify(e)}`);if(e.x===void 0)throw new Error(`'${r}.x' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e.y===void 0)throw new Error(`'${r}.y' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(typeof e.x!="number")throw new TypeError(`'${r}.x' must be a number. Got ${e.x}`);if(typeof e.y!="number")throw new TypeError(`'${r}.y' must be a number. Got ${e.y}`);if(e.x===null)throw new Error(`'${r}.x' is null`);if(e.y===null)throw new Error(`'${r}.y' is null`);if(Number.isNaN(e.x))throw new Error(`'${r}.x' is NaN`);if(Number.isNaN(e.y))throw new Error(`'${r}.y' is NaN`)}var Ff=(e,r="pt")=>(R(e,r),P(e.x,"nonZero",`${r}.x`),P(e.y,"nonZero",`${r}.y`),typeof e.z<"u"&&P(e.z,"nonZero",`${r}.z`),!0);function _(e){return!(e===void 0||e===null||e.x===void 0||e.y===void 0)}var zt=e=>!(e===void 0||e===null||e.x===void 0||e.y===void 0||e.z===void 0),Fr=e=>e.x===0&&e.y===0,Pr=e=>Number.isNaN(e.x)&&Number.isNaN(e.y),ur=(e,r="Dimension")=>{if(e===void 0)throw new Error(`${r} is undefined`);if(Number.isNaN(e))throw new Error(`${r} is NaN`);if(e<0)throw new Error(`${r} cannot be negative`)},Ve=(e,r="rect")=>{if(e===void 0)throw new Error("{$name} undefined");Be(e)&&R(e,r),ur(e.width,r+".width"),ur(e.height,r+".height")},ua=(e,r)=>{if(Ve(e),Be(e)&&r===void 0)return e;if(r===void 0)throw new Error("Unpositioned rect needs origin parameter");return Object.freeze({...e,...r})},la=(e,r="rect")=>{if(!Be(e))throw new Error(`Expected ${r} to have x,y`);Ve(e,r)},Ex=e=>e.width===0&&e.height===0,Nr=e=>Number.isNaN(e.width)&&Number.isNaN(e.height),Be=e=>e.x!==void 0&&e.y!==void 0,ke=e=>!(e===void 0||e.width===void 0||e.height===void 0),rt=e=>ke(e)&&Be(e);function re(e,r,n,i){const s=Ae(r,n,i);return R(s,"b"),R(e,"a"),zt(s)&&zt(e)?Math.hypot(s.x-e.x,s.y-e.y,s.z-e.z):Math.hypot(s.x-e.x,s.y-e.y)}var pi={};E(pi,{area:()=>qx,cardinal:()=>mi,center:()=>ya,clamp:()=>Kf,corners:()=>rr,distanceFromCenter:()=>Mx,distanceFromExterior:()=>ha,edges:()=>Pf,empty:()=>Uf,emptyPositioned:()=>Hf,fromCenter:()=>Yf,fromElement:()=>zx,fromNumbers:()=>$x,fromTopLeft:()=>_t,getEdgeX:()=>ao,getEdgeY:()=>uo,getRectPositioned:()=>ua,getRectPositionedParameter:()=>jx,guard:()=>Ve,guardDim:()=>ur,guardPositioned:()=>la,intersectsPoint:()=>lr,isEmpty:()=>Ex,isEqual:()=>Ix,isEqualSize:()=>Jf,isIntersecting:()=>Of,isPlaceholder:()=>Nr,isPositioned:()=>Be,isRect:()=>ke,isRectPositioned:()=>rt,lengths:()=>Vx,maxFromCorners:()=>Xf,multiply:()=>qf,multiplyScalar:()=>Bx,normaliseByRect:()=>Lx,perimeter:()=>Ox,placeholder:()=>xi,placeholderPositioned:()=>un,random:()=>_x,randomPoint:()=>Wf,subtract:()=>Gf,sum:()=>Tx,toArray:()=>Rx});var rr=(e,r)=>{const n=ua(e,r);return[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}]},Pf=(e,r)=>{const n=rr(e,r);return Ui(...n,n[0])},ao=(e,r)=>{switch(Ve(e),r){case"top":return _(e)?e.x:0;case"bottom":return _(e)?e.x:0;case"left":return _(e)?e.y:0;case"right":return _(e)?e.x+e.width:e.width}},uo=(e,r)=>{switch(Ve(e),r){case"top":return _(e)?e.y:0;case"bottom":return _(e)?e.y+e.height:e.height;case"left":return _(e)?e.y:0;case"right":return _(e)?e.y:0}},mi=(e,r)=>{const{x:n,y:i,width:s,height:o}=e;switch(r){case"nw":return Object.freeze({x:n,y:i});case"n":return Object.freeze({x:n+s/2,y:i});case"ne":return Object.freeze({x:n+s,y:i});case"sw":return Object.freeze({x:n,y:i+o});case"s":return Object.freeze({x:n+s/2,y:i+o});case"se":return Object.freeze({x:n+s,y:i+o});case"w":return Object.freeze({x:n,y:i+o/2});case"e":return Object.freeze({x:n+s,y:i+o/2});case"center":return Object.freeze({x:n+s/2,y:i+o/2});default:throw new Error(`Unknown direction: ${r}`)}},$n=(e,r="circle")=>{if(ue(e)&&R(e,"circle"),Number.isNaN(e.radius))throw new Error(`${r}.radius is NaN`);if(e.radius<=0)throw new Error(`${r}.radius must be greater than zero`)},gi=(e,r="circle")=>{if(!ue(e))throw new Error("Expected a positioned circle with x,y");$n(e,r)},Dx=e=>!!(Number.isNaN(e.radius)||ue(e)&&(Number.isNaN(e.x)||Number.isNaN(e.y))),Nf=e=>e.x!==void 0&&e.y!==void 0,qr=e=>e.radius!==void 0,ue=e=>qr(e)&&Nf(e),kf={};E(kf,{area:()=>Sx,bbox:()=>zf,center:()=>$f,circumference:()=>Tf,distanceCenter:()=>ca,distanceFromExterior:()=>fa,exteriorIntegerPoints:()=>Ax,guard:()=>$n,guardPositioned:()=>gi,interiorIntegerPoints:()=>Cx,interpolate:()=>Bf,intersectionLine:()=>Nx,isCircle:()=>qr,isCirclePositioned:()=>ue,isEqual:()=>Rf,isNaN:()=>Dx,isPositioned:()=>Nf,length:()=>_f,multiplyScalar:()=>Fx,nearest:()=>Lf,point:()=>Mf,randomPoint:()=>If,toPath:()=>Px,toPositioned:()=>da,toSvg:()=>jf});var ca=(e,r)=>(gi(e,"a"),ue(r)&&gi(r,"b"),re(e,r)),fa=(e,r)=>{if(gi(e,"a"),ue(r))return Math.max(0,ca(e,r)-e.radius-r.radius);if(_(r)){const n=re(e,r);return n<e.radius?0:n}else throw new Error("Second parameter invalid type")},da=(e,r,n)=>{if(ue(e))return e;const i=S.getPointParameter(r,n);return Object.freeze({...e,...i})};function*Ax(e){const{x:r,y:n,radius:i}=e;let s=i,o=0,a=1-r;for(;s>=o;)yield{x:s+r,y:o+n},yield{x:o+r,y:s+n},yield{x:-s+r,y:o+n},yield{x:-o+r,y:s+n},yield{x:-s+r,y:-o+n},yield{x:-o+r,y:-s+n},yield{x:s+r,y:-o+n},yield{x:o+r,y:-s+n},o++,a<0?a+=2*o+1:(s--,a+=2*(o-s+1))}function*Cx(e){const r=e.x-e.radius,n=e.x+e.radius,i=e.y-e.radius,s=e.y+e.radius;for(let o=r;o<n;o++)for(let a=i;a<s;a++)Math.abs(re(e,o,a))<=e.radius&&(yield{x:o,y:a})}var wi=Math.PI*2,Mf=(e,r,n)=>(n===void 0&&(n=ue(e)?e:{x:0,y:0}),{x:Math.cos(-r)*e.radius+n.x,y:Math.sin(-r)*e.radius+n.y}),$f=e=>ue(e)?Object.freeze({x:e.x,y:e.y}):Object.freeze({x:e.radius,y:e.radius}),Bf=(e,r)=>Mf(e,r*wi),_f=e=>Tf(e),Tf=e=>($n(e),wi*e.radius),Sx=e=>($n(e),Math.PI*e.radius*e.radius),zf=e=>ue(e)?Yf(e,e.radius*2,e.radius*2):{width:e.radius*2,height:e.radius*2},Rf=(e,r)=>e.radius!==r.radius?!1:ue(e)&&ue(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):(!ue(e)&&!ue(r),!1),If=(e,r={})=>{const n=ue(e)?e:{x:0,y:0},i=r.strategy??"uniform",s=r.margin??0,o=e.radius-s,a=r.randomSource??fe;switch(i){case"naive":return S.sum(n,mn.toCartesian(a()*o,a()*wi));case"uniform":return S.sum(n,mn.toCartesian(Math.sqrt(a())*o,a()*wi));default:throw new Error(`Unknown strategy '${i}'. Expects 'uniform' or 'naive'`)}};function Fx(e,r){if(ue(e)){const n=S.multiplyScalar(e,r);return Object.freeze({...e,...n,radius:e.radius*r})}else return Object.freeze({...e,radius:e.radius*r})}var jf=(e,r,n)=>{if(qr(e)){if(n!==void 0)return Is(e.radius,n,r);if(ue(e))return Is(e.radius,e,r);throw new Error("origin parameter needed for non-positioned circle")}else{if(n===void 0)throw new Error("origin parameter needed");return Is(e,n,r)}},Is=(e,r,n)=>{const{x:i,y:s}=r,o=n?"1":"0";return`
    M ${i}, ${s}
    m -${e}, 0
    a ${e},${e} 0 1,${o} ${e*2},0
    a ${e},${e} 0 1,${o} -${e*2},0
  `.split(`
`)},Lf=(e,r)=>{const n=i=>{const s=Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)),o=i.x+i.radius*((r.x-i.x)/s),a=i.y+i.radius*((r.y-i.y)/s);return{x:o,y:a}};if(Array.isArray(e)){const i=e.map(o=>n(o)),s=i.map(o=>S.distance(o,r));return Object.freeze(i[Dt.minIndex(...s)])}else return Object.freeze(n(e))},Px=e=>($n(e),Object.freeze({...e,nearest:r=>Lf(e,r),interpolate:r=>Bf(e,r),bbox:()=>zf(e),length:()=>_f(e),toSvgString:(r=!0)=>jf(e,r),relativePosition:(r,n)=>{throw new Error("Not implemented")},distanceToPoint:r=>{throw new Error("Not implemented")},kind:"circular"})),Nx=(e,r)=>{const n={x:r.b.x-r.a.x,y:r.b.y-r.a.y},i={x:r.a.x-e.x,y:r.a.y-e.y},s=(n.x*i.x+n.y*i.y)*-2,o=2*(n.x*n.x+n.y*n.y),a=Math.sqrt(s*s-2*o*(i.x*i.x+i.y*i.y-e.radius*e.radius));if(Number.isNaN(a))return[];const u=(s-a)/o,l=(s+a)/o,c=[];return u<=1&&u>=0&&c.push({x:r.a.x+n.x*u,y:r.a.y+n.y*u}),l<=1&&l>=0&&c.push({x:r.a.x+n.x*l,y:r.a.y+n.y*l}),c},kx=(e,r)=>{const n=Te(r,e),i=Math.hypot(n.y,n.x);if(i>e.radius+r.radius)return[];if(i<Math.abs(e.radius-r.radius))return[];if(Rf(e,r))return[];const s=(e.radius*e.radius-r.radius*r.radius+i*i)/(2*i),o={x:e.x+n.x*s/i,y:e.y+n.y*s/i},a=Math.sqrt(e.radius*e.radius-s*s),u={x:-n.y*(a/i),y:n.x*(a/i)};return[Rr(o,u),Te(o,u)]},Vf=(e,r)=>{const n=e.x-Math.max(r.x,Math.min(e.x,r.x+r.width)),i=e.y-Math.max(r.y,Math.min(e.y,r.y+r.height));return n*n+i*i<e.radius*e.radius},Pl=(e,r)=>kx(e,r).length===2;function lr(e,r,n){Ve(e,"rect");let i=0,s=0;if(typeof r=="number"){if(n===void 0)throw new Error("x and y coordinate needed");i=r,s=n}else i=r.x,s=r.y;if(Be(e)){if(i-e.x>e.width||i<e.x||s-e.y>e.height||s<e.y)return!1}else if(i>e.width||i<0||s>e.height||s<0)return!1;return!0}var Of=(e,r)=>{if(!rt(e))throw new Error("a parameter should be RectPositioned");if(ue(r))return Vf(r,e);if(_(r))return lr(e,r);throw new Error(`Unknown shape for b: ${JSON.stringify(r)}`)},ha=(e,r)=>{if(la(e,"rect"),R(r,"pt"),lr(e,r))return 0;const n=Math.max(e.x-r.x,0,r.x-e.x+e.width),i=Math.max(e.y-r.y,0,r.y-e.y+e.height);return Math.hypot(n,i)},Mx=(e,r)=>re(ya(e),r);function $x(e,r,n,i){if(n===void 0||i===void 0){if(typeof e!="number")throw new Error("width is not an number");if(typeof r!="number")throw new TypeError("height is not an number");return Object.freeze({width:e,height:r})}if(typeof e!="number")throw new Error("x is not an number");if(typeof r!="number")throw new Error("y is not an number");if(typeof n!="number")throw new Error("width is not an number");if(typeof i!="number")throw new Error("height is not an number");return Object.freeze({x:e,y:r,width:n,height:i})}function qf(e,r,n){if(Ve(e,"a"),ke(r))return rt(e)?Object.freeze({...e,x:e.x*r.width,y:e.y*r.height,width:e.width*r.width,height:e.height*r.height}):Object.freeze({...e,width:e.width*r.width,height:e.height*r.height});if(typeof r!="number")throw new TypeError(`Expected second parameter of type Rect or number. Got ${JSON.stringify(r)}`);return n===void 0&&(n=r),rt(e)?Object.freeze({...e,x:e.x*r,y:e.y*n,width:e.width*r,height:e.height*n}):Object.freeze({...e,width:e.width*r,height:e.height*n})}function Bx(e,r){return Be(e)?Object.freeze({...e,x:e.x*r,y:e.y*r,width:e.width*r,height:e.height*r}):Object.freeze({...e,width:e.width*r,height:e.height*r})}var _x=e=>(e===void 0&&(e=fe),Object.freeze({x:e(),y:e(),width:e(),height:e()})),Wf=(e,r={})=>{const n=r.randomSource??fe,i=r.margin??{x:0,y:0},s=n()*(e.width-i.x-i.x),o=n()*(e.height-i.y-i.y),a={x:s+i.x,y:o+i.y};return Be(e)?Rr(a,e):Object.freeze(a)};function Gf(e,r,n){if(e===void 0)throw new Error("First parameter undefined");if(typeof r=="number"){const i=n??0;return Object.freeze({...e,width:e.width-r,height:e.height-i})}else return Object.freeze({...e,width:e.width-r.width,height:e.height-r.height})}function Tx(e,r,n){if(e===void 0)throw new Error("First parameter undefined");if(typeof r=="number"){const i=n??0;return Object.freeze({...e,width:e.width+r,height:e.height+i})}else return Object.freeze({...e,width:e.width+r.width,height:e.height+r.height})}var Uf=Object.freeze({width:0,height:0}),Hf=Object.freeze({x:0,y:0,width:0,height:0}),xi=Object.freeze({width:Number.NaN,height:Number.NaN}),un=Object.freeze({x:Number.NaN,y:Number.NaN,width:Number.NaN,height:Number.NaN}),zx=e=>({width:e.clientWidth,height:e.clientHeight}),Jf=(e,r)=>{if(e===void 0)throw new Error("a undefined");if(r===void 0)throw new Error("b undefined");return e.width===r.width&&e.height===r.height};function Rx(e){if(Be(e))return[e.x,e.y,e.width,e.height];if(ke(e))return[e.width,e.height];throw new Error(`rect param is not a rectangle. Got: ${JSON.stringify(e)}`)}var Ix=(e,r)=>Be(e)&&Be(r)?wt(e,r)?e.width===r.width&&e.height===r.height:!1:!Be(e)&&!Be(r)?e.width===r.width&&e.height===r.height:!1,Yf=(e,r,n)=>{R(e,"origin"),ur(r,"width"),ur(n,"height");const i=r/2,s=n/2;return{x:e.x-i,y:e.y-s,width:r,height:n}},Xf=(e,r,n,i)=>{if(e.y>n.y)throw new Error("topLeft.y greater than bottomRight.y");if(e.y>i.y)throw new Error("topLeft.y greater than bottomLeft.y");const s=r.x-e.x,o=n.x-i.x,a=Math.abs(i.y-e.y),u=Math.abs(n.y-r.y);return{x:Math.min(e.x,i.x),y:Math.min(r.y,e.y),width:Math.max(s,o),height:Math.max(a,u)}};function jx(e,r,n,i){if(typeof e=="number")if(typeof r=="number"){if(typeof n=="number"&&typeof i=="number")return{x:e,y:r,width:n,height:i};if(ke(n))return{x:e,y:r,width:n.width,height:n.height};throw new TypeError("If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect")}else throw new TypeError("If parameter 'a' is a number, expect following parameters to be: y,w,h");else{if(rt(e))return e;if(ke(e)){if(typeof r=="number"&&typeof n=="number")return{width:e.width,height:e.height,x:r,y:n};if(_(r))return{width:e.width,height:e.height,x:r.x,y:r.y};throw new TypeError("If param 'a' is a Rect, expects following parameters to be x,y")}else if(_(e)){if(typeof r=="number"&&typeof n=="number")return{x:e.x,y:e.y,width:r,height:n};if(ke(r))return{x:e.x,y:e.y,width:r.width,height:r.height};throw new TypeError("If parameter 'a' is a Point, expect following params to be: Rect or width,height")}}throw new TypeError("Expect a first parameter to be x,RectPositioned,Rect or Point")}var Kf=(e,r)=>Object.freeze({...e,width:Math.min(e.width,r.width),height:Math.min(e.height,r.height)}),_t=(e,r,n)=>(ur(r,"width"),ur(n,"height"),R(e,"origin"),{x:e.x,y:e.y,width:r,height:n}),Lx=(e,r,n)=>{let i;if(n===void 0)if(ke(r))n=r.height,i=r.width;else throw new Error("Expects rectangle or width and height parameters for normaliseBy");else if(typeof r=="number")i=r;else throw new TypeError("Expects rectangle or width and height parameters for normaliseBy");return Be(e)?Object.freeze({x:e.x/i,y:e.y/n,width:e.width/i,height:e.height/n}):Object.freeze({width:e.width/i,height:e.height/n})},ya=(e,r)=>(Ve(e),r===void 0&&_(e)?r=e:r===void 0&&(r={x:0,y:0}),ua(e,r),Object.freeze({x:r.x+e.width/2,y:r.y+e.height/2})),Vx=e=>(la(e,"rect"),Pf(e).map(r=>_e(r))),Ox=e=>(Ve(e),e.height+e.height+e.width+e.width),qx=e=>(Ve(e),e.height*e.width),Wx=(e,r)=>{if(rt(r))return ha(r,e);if(ue(r))return fa(r,e);if(_(r))return re(e,r);throw new Error("Unknown shape")},Zf=(e,r)=>{if(rt(r))return ha(r,e);if(ue(r))return fa(r,e);if(_(r))return re(e,r);throw new Error("Unknown shape")};function Ae(e,r,n){if(e===void 0)return{x:0,y:0};if(Array.isArray(e)){if(e.length===0)return Object.freeze({x:0,y:0});if(e.length===1)return Object.freeze({x:e[0],y:0});if(e.length===2)return Object.freeze({x:e[0],y:e[1]});if(e.length===3)return Object.freeze({x:e[0],y:e[1],z:e[2]});throw new Error(`Expected array to be 1-3 elements in length. Got ${e.length}.`)}if(_(e))return e;if(typeof e!="number"||typeof r!="number")throw new TypeError(`Expected point or x,y as parameters. Got: a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`);return Object.freeze(typeof n=="number"?{x:e,y:r,z:n}:{x:e,y:r})}var Qf=(...e)=>{const r=e.map(n=>rd(n));return sf(r)},cr={x:0,y:0},ed=Object.freeze({x:Number.NaN,y:Number.NaN}),Gx=e=>e.x===null&&e.y===null,Ux=e=>Number.isNaN(e.x)||Number.isNaN(e.y),Zt=(e,...r)=>{if(r.length===0)throw new Error("No points provided");let n=r[0];for(const i of r)n=e(n,i);return n},Hx=(...e)=>Zt((r,n)=>r.x<=n.x?r:n,...e),Jx=(...e)=>Zt((r,n)=>r.x>=n.x?r:n,...e),Yx=e=>({...e,x:Math.abs(e.x),y:Math.abs(e.y)}),kr=(e,r,n)=>(R(e,"a"),r===void 0?Math.atan2(e.y,e.x):(R(r,"b"),n===void 0?Math.atan2(r.y-e.y,r.x-e.x):(R(n,"c"),Math.atan2(r.y-e.y,r.x-e.x)-Math.atan2(n.y-e.y,n.x-e.x)))),td=(...e)=>{if(!Array.isArray(e))throw new Error("Expected list of points");const r=e.reduce((n,i)=>{if(i===void 0)return n;if(Array.isArray(i))throw new TypeError("'points' list contains an array. Did you mean: centroid(...myPoints)?");if(!_(i))throw new Error(`'points' contains something which is not a point: ${JSON.stringify(i)}`);return{x:n.x+i.x,y:n.y+i.y}},{x:0,y:0});return Object.freeze({x:r.x/e.length,y:r.y/e.length})},va=(...e)=>{const r=Zt((c,f)=>c.x<f.x?c:f,...e),n=Zt((c,f)=>c.x>f.x?c:f,...e),i=Zt((c,f)=>c.y<f.y?c:f,...e),s=Zt((c,f)=>c.y>f.y?c:f,...e),o={x:r.x,y:i.y},a={x:n.x,y:i.y},u={x:n.x,y:s.y},l={x:r.x,y:s.y};return Xf(o,a,u,l)},rd=e=>[e.x,e.y];function bi(e,r){if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=r?e.x.toFixed(r):e.x,i=r?e.y.toFixed(r):e.y;if(e.z===void 0)return`(${n},${i})`;{const s=r?e.z.toFixed(r):e.z;return`(${n},${i},${s})`}}var wt=(...e)=>{if(e===void 0)throw new Error("parameter 'p' is undefined");if(e.length<2)return!0;for(let r=1;r<e.length;r++)if(e[r].x!==e[0].x||e[r].y!==e[0].y)return!1;return!0},Xx=(e,r,n)=>{R(e,"a"),R(r,"b"),typeof n=="number"?(P(n,"positive","maxRange"),n={x:n,y:n}):R(n,"maxRange");const i=Math.abs(r.x-e.x),s=Math.abs(r.y-e.y);return i<=n.x&&s<=n.y},Kx=(e,r,n,i=!1)=>nt(e,r,n,i),Zx=(e,r)=>{if(Array.isArray(e)){if(e.length!==2)throw new Error("Expected array of length two, got "+e.length);return Object.freeze({x:e[0],y:e[1]})}else{if(e===void 0)e=0;else if(Number.isNaN(e))throw new Error("x is NaN");if(r===void 0)r=0;else if(Number.isNaN(r))throw new Error("y is NaN");return Object.freeze({x:e,y:r})}},pa=(...e)=>{const r=[];if(Array.isArray(e[0]))for(const n of e){if(n.length%2!==0)throw new Error("coords array should be even-numbered");r.push(Object.freeze({x:n[0],y:n[1]}))}else{if(e.length%2!==0)throw new Error("Expected even number of elements: [x,y,x,y...]");for(let n=0;n<e.length;n+=2)r.push(Object.freeze({x:e[n],y:e[n+1]}))}return r};function Te(e,r,n,i){if(_(e))return R(e,"a"),_(r)?(R(r,"b"),Object.freeze({...e,x:e.x-r.x,y:e.y-r.y})):(n===void 0&&(n=r),Object.freeze({...e,x:e.x-r,y:e.y-n}));if(P(e,"","a"),typeof r!="number")throw new TypeError("Second parameter is expected to by y value");if(P(r,"","b"),Number.isNaN(n))throw new Error("Third parameter is NaN");if(Number.isNaN(i))throw new Error("Fourth parameter is NaN");return n===void 0&&(n=0),i===void 0&&(i=0),Object.freeze({x:e-n,y:r-i})}var Qx=(e,r)=>Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y")}),eb=(e,...r)=>nd(...r)(e),nd=(...e)=>r=>e.reduce((n,i)=>i(n),r),id=(e,r,n)=>{n===void 0&&(n={x:0,y:0});let i=n;for(const s of e)i=r(s,i);return i},Rr=function(e,r,n,i){if(e===void 0)throw new TypeError("a missing");let s,o;if(_(e))if(s=e,r===void 0&&(r=cr),_(r))o=r;else{if(r===void 0)throw new Error("Expects x coordinate");o={x:r,y:n??r}}else if(!_(r)){if(r===void 0)throw new Error("Expected number as second param");if(s={x:e,y:r},n===void 0)throw new Error("Expects x coordiante");o={x:n,y:i??0}}if(s===void 0)throw new Error(`ptA missing. a: ${JSON.stringify(e)}`);if(o===void 0)throw new Error(`ptB missing. b: ${JSON.stringify(r)}`);return R(s,"a"),R(o,"b"),Object.freeze({x:s.x+o.x,y:s.y+o.y})};function Ir(e,r,n){if(R(e,"a"),typeof r=="number")return typeof n>"u"&&(n=r),P(n,"","y"),P(r,"","x"),Object.freeze({x:e.x*r,y:e.y*n});if(_(r))return R(r,"b"),Object.freeze({x:e.x*r.x,y:e.y*r.y});if(ke(r))return Ve(r,"rect"),Object.freeze({x:e.x*r.width,y:e.y*r.height});throw new Error(`Invalid arguments. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)}var tb=(e,r)=>zt(e)?Object.freeze({...e,x:e.x*r,y:e.y*r,z:e.z*r}):Object.freeze({...e,x:e.x*r,y:e.y*r});function Ei(e,r,n,i){if(_(e))return R(e,"a"),_(r)?Object.freeze({x:e.x/r.x,y:e.y/r.y}):ke(r)?(Ve(r,"rect"),Object.freeze({x:e.x/r.width,y:e.y/r.height})):(n===void 0&&(n=r),R(e),P(r,"nonZero","x"),P(n,"nonZero","y"),Object.freeze({x:e.x/r,y:e.y/n}));if(typeof r!="number")throw new TypeError("expected second parameter to be y1 coord");return P(e,"positive","x1"),P(r,"positive","y1"),n===void 0&&(n=1),i===void 0&&(i=n),P(n,"nonZero","x2"),P(i,"nonZero","y2"),Object.freeze({x:e/n,y:r/i})}function rb(e,r,n){const i=Ae(e,r,n);return Ff(i,"divisor"),(s,o,a)=>{const u=Ae(s,o,a);return typeof u.z>"u"?Object.freeze({x:u.x/i.x,y:u.y/i.y}):Object.freeze({x:u.x/i.x,y:u.y/i.y,z:u.z/(i.z??1)})}}var nb=(e,r,n=!0)=>Object.freeze({x:Gs(e.x,r.x,n),y:Gs(e.y,r.y,n)}),ib=(...e)=>{const r=[...e].sort(sd);if(r.length===1)return r;const n=o=>{const a=[];for(const u of o){for(;a.length>=2;){const l=a.at(-1),c=a.at(-2);if((l.x-c.x)*(u.y-c.y)>=(l.y-c.y)*(u.x-c.x))a.pop();else break}a.push(u)}return a.pop(),a},i=n(r),s=n(r.reverse());return i.length===1&&s.length===1&&wt(s[0],i[0])?i:[...i,...s]},sb=(e,r)=>e.x<r.x&&e.y<r.y?-2:e.x>r.x&&e.y>r.y?2:e.x<r.x||e.y<r.y?-1:e.x>r.x||e.y>r.y?1:e.x===r.x&&e.x===r.y?0:Number.NaN,sd=(e,r)=>e.x-r.x||e.y-r.y,lo=(e,r,n)=>{const i=Math.cos(n)*r+e.x,s=Math.sin(n)*r+e.y;return{x:i,y:s}};function xt(e,r,n){n===void 0&&(n={x:0,y:0}),R(n,"origin"),P(r,"","amountRadian");const i=Array.isArray(e);if(r===0)return e;i||(e=[e]);const s=e;for(const[l,c]of s.entries())R(c,`pt[${l}]`);const u=s.map(l=>aa(l,n)).map(l=>bf(l,r)).map(l=>Bt(l,n));return i?u:u[0]}var ob=(e,r)=>{const n=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],i=[];for(const[s,o]of e.entries())i[s]=[n[0][0]*o[0]+n[0][1]*o[1],n[1][0]*o[0]+n[1][1]*o[1]];return i},ab=(e,r)=>{if(_(e)&&(r=e.y,e=e.x),r===void 0)throw new Error("Expected y");return Math.hypot(e,r)},od=(e,r)=>{const n=Ae(e,r),i=ab(n);return i===0?cr:Object.freeze({...n,x:n.x/i,y:n.y/i})},ub=(e,r,n)=>{const i=Ae(e,r);return n=n??r,n=n??2,Object.freeze({...i,x:or(n,i.x),y:or(n,i.y)})};function co(e,r,n,i){if(_(e)){if(typeof r=="number"&&n!==void 0)P(r,"positive","width"),P(n,"positive","height");else{if(!ke(r))throw new Error("Expected second parameter to be a rect");n=r.height,r=r.width}return Object.freeze({x:e.x/r,y:e.y/n})}else{if(P(e,"positive","x"),typeof r!="number")throw new TypeError("Expecting second parameter to be a number (width)");if(typeof n!="number")throw new TypeError("Expecting third parameter to be a number (height)");if(P(r,"positive","y"),P(n,"positive","width"),i===void 0)throw new Error("Expected height parameter");return P(i,"positive","height"),Object.freeze({x:e/n,y:r/i})}}var lb=e=>(e===void 0&&(e=fe),Object.freeze({x:e(),y:e()})),cb=(e,r,n)=>(r===void 0&&(r={x:1,y:1}),n===void 0&&(n={x:0,y:0}),R(e,"pt"),R(r,"ptMax"),R(n,"ptMin"),Object.freeze({x:ci(e.x,n.x,r.x),y:ci(e.y,n.y,r.y)})),fb=(e,r="both")=>{switch(r){case"both":return zt(e)?Object.freeze({...e,x:e.x*-1,y:e.y*-1,z:e.z*-1}):Object.freeze({...e,x:e.x*-1,y:e.y*-1});case"x":return Object.freeze({...e,x:e.x*-1});case"y":return Object.freeze({...e,y:e.y*-1});case"z":{if(zt(e))return Object.freeze({...e,z:e.z*-1});throw new Error("pt parameter is missing z")}default:throw new Error("Unknown what parameter. Expecting 'both', 'x' or 'y'")}},db=(e,r=Math.round)=>(R(e,"pt"),Object.freeze({x:r(e.x),y:r(e.y)})),ad=(e,r=1,n=0)=>{const i=re(e);let s=1;return i>r?s=r/i:i<n&&(s=n/i),s===1?e:Ir(e,s,s)};function hb(e,r,n,i){if(_(e))return r===void 0&&(r=0),n===void 0&&(n=1),P(r,"","min"),P(n,"","max"),Object.freeze({x:Ne(e.x,r,n),y:Ne(e.y,r,n)});if(r===void 0)throw new Error("Expected y coordinate");return n===void 0&&(n=0),i===void 0&&(i=1),P(e,"","x"),P(r,"","y"),P(n,"","min"),P(i,"","max"),Object.freeze({x:Ne(e,n,i),y:Ne(r,n,i)})}var oi=(e,r)=>{const n=Ae(e,r);let i=0,s=0,o=0,a=performance.now(),u=n;return(c,f)=>{const d=Ae(c,f);i+=d.x,s+=d.y,o++;const h=re(d,n),y=re(d,u),v=performance.now(),m=y/(v-a);return a=v,u=d,Object.freeze({angle:kr(d,n),distanceFromStart:h,distanceFromLast:y,speed:m,centroid:td(d,n),average:{x:i/o,y:s/o}})}},yb=(e,r,n)=>{const i=Te(e,r),s=Te(n,r);return zt(i)&&zt(s)?(i.x*s.x+i.y*s.y+i.z*s.z)/(s.x*s.x+s.y*s.y+s.z*s.z):(i.x*s.x+i.y*s.y)/(s.x*s.x+s.y*s.y)},vb=Object.freeze({a:Object.freeze({x:0,y:0}),b:Object.freeze({x:0,y:0})}),pb=Object.freeze({a:Object.freeze({x:Number.NaN,y:Number.NaN}),b:Object.freeze({x:Number.NaN,y:Number.NaN})}),mb=e=>Fr(e.a)&&Fr(e.b),gb=e=>Pr(e.a)&&Pr(e.b),at=e=>!(e===void 0||e.a===void 0||e.b===void 0||!_(e.a)||!_(e.b)),ud=e=>Array.isArray(e)?!e.some(n=>!at(n)):!1,ld=(e,r)=>wt(e.a,r.a)&&wt(e.b,r.b),cd=(e,r)=>Object.freeze({...e,a:r(e.a),b:r(e.b)}),qi=(e,r="line")=>{if(e===void 0)throw new Error(`${r} undefined`);if(e.a===void 0)throw new Error(`${r}.a undefined. Expected {a:Point, b:Point}. Got: ${JSON.stringify(e)}`);if(e.b===void 0)throw new Error(`${r}.b undefined. Expected {a:Point, b:Point} Got: ${JSON.stringify(e)}`)},wb=(e,r)=>{let n;if(at(e))n=e.a,r=e.b;else if(n=e,r===void 0)throw new Error("b point must be provided");return Math.atan2(r.y-n.y,r.x-n.x)},fd=(e,r)=>Object.freeze({...e,a:Ir(e.a,r),b:Ir(e.b,r)}),dd=(e,r)=>Object.freeze({...e,a:Ei(e.a,r),b:Ei(e.b,r)}),hd=(e,r)=>Object.freeze({...e,a:Rr(e.a,r),b:Rr(e.b,r)}),yd=(e,r)=>Object.freeze({...e,a:Te(e.a,r),b:Te(e.b,r)}),xb=(e,r,n)=>Object.freeze({...e,a:co(e.a,r,n),b:co(e.b,r,n)}),vd=(e,r,n)=>bd(e,r)<=n;function _e(e,r){if(ud(e))return e.reduce((u,l)=>_e(l)+u,0);if(e===void 0)throw new TypeError("Parameter 'aOrLine' is undefined");const[n,i]=Wi(e,r),s=i.x-n.x,o=i.y-n.y;if(n.z!==void 0&&i.z!==void 0){const a=i.z-n.z;return Math.hypot(s,o,a)}else return Math.hypot(s,o)}var pd=(e,r)=>{const[n,i]=Wi(e,r);return nt(.5,n,i)},Wi=(e,r)=>{let n;if(at(e))r=e.b,n=e.a;else if(n=e,r===void 0)throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${JSON.stringify(n)} b: ${JSON.stringify(r)}`);return R(n,"a"),R(n,"b"),[n,r]},ma=(e,r)=>{const n=i=>{const{a:s,b:o}=i,a={x:o.x-s.x,y:o.y-s.y},u={x:r.x-s.x,y:r.y-s.y},l=a.x*a.x+a.y*a.y;let c=u.x*a.x+u.y*a.y;const f=Math.min(1,Math.max(0,c/l));return c=(o.x-s.x)*(r.y-s.y)-(o.y-s.y)*(r.x-s.x),{x:s.x+a.x*f,y:s.y+a.y*f}};if(Array.isArray(e)){const i=e.map(o=>n(o)),s=i.map(o=>re(o,r));return Object.freeze(i[ra(...s)])}else return Object.freeze(n(e))},ga=(e,r)=>{let n;if(at(e))n=e.a,r=e.b;else if(n=e,r===void 0)throw new Error("b parameter required");if(r===void 0)throw new TypeError("Second point missing");return(r.y-n.y)/(r.x-n.x)},md=e=>({x:e.b.x-e.a.x,y:e.b.y-e.a.y}),gd=e=>{const r=_e(e),n=md(e);return{x:n.x/r,y:n.y/r}},wd=(e,r,n=0)=>{const i=nt(n,e),s=gd(e);return{x:i.x-s.y*r,y:i.y+s.x*r}},xd=(e,r)=>{const n=md(e),i=gd(e),s={x:e.a.x-i.y*r,y:e.a.y+i.x*r};return{a:s,b:{x:s.x+n.x,y:s.y+n.y}}},bb=(e,r)=>{const n=nt(r/2,e),i=nt(.5+r/2,e);return{a:n,b:i}},Eb=(e,r)=>{const n=e.a.y+(r-e.a.x)*ga(e);return Object.freeze({x:r,y:n})},Db=(e,r)=>{const n=_e(e);return Object.freeze({...e,a:e.a,b:Object.freeze({x:e.b.x+(e.b.x-e.a.x)/n*r,y:e.b.y+(e.b.y-e.a.y)/n*r})})};function*Ab(e){const{a:r,b:n}=e;let i=Math.floor(r.x),s=Math.floor(r.y);const o=Math.floor(n.x),a=Math.floor(n.y),u=Math.abs(o-i),l=-Math.abs(a-s),c=i<o?1:-1,f=s<a?1:-1;let d=u+l;for(;yield{x:i,y:s},!(i===o&&s===a);){const h=2*d;h>=l&&(d+=l,i+=c),h<=u&&(d+=u,s+=f)}}var bd=(e,r)=>{if(Array.isArray(e)){const n=e.map(i=>fo(i,r));return na(n)}else return fo(e,r)},fo=(e,r)=>{if(qi(e,"line"),R(r,"point"),_e(e)===0)return _e(e.a,r);const n=ma(e,r);return _e(n,r)};function nt(e,r,n,i){typeof n=="boolean"&&(i=n,n=void 0),i?P(e,"","amount"):bg(e,"amount");const[s,o]=Wi(r,n),a=_e(s,o),u=a*(1-e);if(a===0&&u===0)return Object.freeze({...o});const l=o.x-u*(o.x-s.x)/a,c=o.y-u*(o.y-s.y)/a;return Object.freeze({...o,x:l,y:c})}function Ed(e,r){if(at(e))qi(e,"a"),r=e.b,e=e.a;else if(r===void 0)throw new Error("Expect second point if first is a point");return bi(e)+"-"+bi(r)}var Di=(e,r,n,i)=>{if(Number.isNaN(e))throw new Error("x1 is NaN");if(Number.isNaN(n))throw new Error("x2 is NaN");if(Number.isNaN(r))throw new Error("y1 is NaN");if(Number.isNaN(i))throw new Error("y2 is NaN");return Gi({x:e,y:r},{x:n,y:i})},Dd=(e,r)=>{if(at(e))return[e.a.x,e.a.y,e.b.x,e.b.y];if(_(e)&&_(r))return[e.x,e.y,r.x,r.y];throw new Error("Expected single line parameter, or a and b points")};function*Cb(e){for(const r of e)yield r.a,yield r.b}var Ad=(e,r)=>[`M${e.x} ${e.y} L ${r.x} ${r.y}`],Sb=e=>{if(!Array.isArray(e))throw new Error("arr parameter is not an array");if(e.length!==4)throw new Error("array is expected to have length four");return Di(e[0],e[1],e[2],e[3])},Gi=(e,r)=>(R(e,"a"),R(r,"b"),e=Object.freeze({...e}),r=Object.freeze({...r}),Object.freeze({a:e,b:r})),Ui=(...e)=>{const r=[];let n=e[0];for(let i=1;i<e.length;i++)r.push(Gi(n,e[i])),n=e[i];return r},Fb=(e,r)=>vt(Gi(e,r)),Cd=e=>va(e.a,e.b),Sd=(e,r)=>{const n=re(e.a,r),i=_e(e);return n/i},vt=e=>{const{a:r,b:n}=e;return Object.freeze({...e,length:()=>_e(r,n),interpolate:i=>nt(i,r,n),relativePosition:i=>Sd(e,i),bbox:()=>Cd(e),toString:()=>Ed(r,n),toFlatArray:()=>Dd(r,n),toSvgString:()=>Ad(r,n),toPoints:()=>[r,n],rotate:(i,s)=>vt(Fd(e,i,s)),nearest:i=>ma(e,i),sum:i=>vt(hd(e,i)),divide:i=>vt(dd(e,i)),multiply:i=>vt(fd(e,i)),subtract:i=>vt(yd(e,i)),midpoint:()=>pd(r,n),distanceToPoint:i=>fo(e,i),parallel:i=>xd(e,i),perpendicularPoint:(i,s)=>wd(e,i,s),slope:()=>ga(e),withinRange:(i,s)=>vd(e,i,s),isEqual:i=>ld(e,i),apply:i=>vt(cd(e,i)),kind:"line"})},Fd=(e,r,n)=>r===void 0||r===0?e:(n===void 0&&(n=.5),typeof n=="number"&&(n=nt(n,e.a,e.b)),Object.freeze({...e,a:xt(e.a,r,n),b:xt(e.b,r,n)})),Pb=(e,r={})=>{const n=Ui(...e);return Pd(n.map(i=>vt(i)),r)},Pd=(e,r={})=>{const n=r.maxDistanceFromLine??.1;return s=>{const a=e.map((l,c)=>{const f=l.nearest(s),d=re(s,f);return{positionRelative:l.relativePosition(f,n),path:l,index:c,nearest:f,distance:d,rank:Number.MAX_SAFE_INTEGER}}).filter(l=>l.distance<=n),u=Dt.sortByNumericProperty(a,"distance");for(let l=0;l<u.length;l++)u[l].rank=l;return u}},Nd={};E(Nd,{CirclePacking:()=>kd});var kd={};E(kd,{random:()=>Bb});var Md={};E(Md,{arrow:()=>$b,center:()=>kb,isIntersecting:()=>Bd,randomPoint:()=>_d,starburst:()=>Mb});var Nb=(e,r,n)=>{const i=ca(e,r);if(qr(r))return i<Math.abs(e.radius-r.radius);if(_(r))return n===void 0?i<=e.radius:i<Math.abs(e.radius-n);throw new Error("b parameter is expected to be CirclePositioned or Point")},$d=(e,r,n)=>wt(e,r)||Nb(e,r,n)?!0:qr(r)?Pl(e,r):rt(r)?Vf(e,r):_(r)&&n!==void 0?Pl(e,{...r,radius:n}):!1,Bd=(e,r)=>{if(ue(e))return $d(e,r);if(rt(e))return Of(e,r);throw new Error(`a or b are unknown shapes. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)},_d=(e,r={})=>{if(ue(e))return If(e,r);if(rt(e))return Wf(e,r);throw new Error("Unknown shape. Only CirclePositioned and RectPositioned are supported.")},kb=e=>{if(e===void 0)return Object.freeze({x:.5,y:.5});if(ke(e))return ya(e);if(nr.isTriangle(e))return nr.centroid(e);if(qr(e))return $f(e);throw new Error(`Unknown shape: ${JSON.stringify(e)}`)},Mb=(e,r=5,n,i=S.Empty,s)=>{le(r,"positive","points");const o=Math.PI*2/r,a=o/2,u=s?.initialAngleRadian??-Math.PI/2;n===void 0&&(n=e/2);let l=u;const c=[];for(let f=0;f<r;f++){const d=Bt(e,l,i),h=Bt(n,l-a,i),y=Bt(n,l+a,i);c.push(h,d),f+1<r&&c.push(y),l+=o}return c},$b=(e,r,n={})=>{const i=n.tailLength??10,s=n.tailThickness??Math.max(i/5,5),o=n.angleRadian??0,a=n.arrowSize??Math.max(i/5,15),u=Math.PI/2;let l,c;if(r==="tip")l=nr.equilateralFromVertex(e,a,u),c=rr(_t({x:l.a.x-i,y:e.y-s/2},i,s));else if(r==="middle"){const d=i+a/2,h=s/2;l=nr.equilateralFromVertex({x:e.x+a*1.2,y:e.y},a,u),c=rr(_t({x:e.x-d,y:e.y-h},i+a,s))}else c=rr(_t({x:e.x,y:e.y-s/2},i,s)),l=nr.equilateralFromVertex({x:e.x+i+a*.7,y:e.y},a,u);return S.rotate([c[0],c[1],l.a,l.b,l.c,c[2],c[3]],o,e)},Bb=(e,r,n={})=>{if(!Array.isArray(e))throw new Error("Parameter 'circles' is not an array");const i=n.attempts??2e3,s=Li(e,"radius"),o=[],a=(u,l)=>o.some(c=>$d(c,u,l));for(;s.length>0;){const u=s.pop();if(!u)break;const l={...n,margin:{x:u.radius,y:u.radius}};for(let c=0;c<i;c++){const f=_d(r,l);if(!a(f,u.radius)){o.push(Object.freeze({...u,...f}));break}}}return o},ln={};E(ln,{getEnd:()=>Hb,getStart:()=>Ub});var Td={};E(Td,{computeQuadraticSimple:()=>Ob,cubic:()=>qb,isCubicBezier:()=>wa,isQuadraticBezier:()=>Wr,quadratic:()=>jd,quadraticBend:()=>Vb,quadraticSimple:()=>Mr,quadraticToSvgString:()=>Id,toPath:()=>ai});var{abs:en,cos:yt,sin:wr,acos:_b,atan2:tn,sqrt:kt,pow:Ie}=Math;function rn(e){return e<0?-Ie(-e,1/3):Ie(e,1/3)}var zd=Math.PI,Qn=2*zd,Mt=zd/2,Tb=1e-6,js=Number.MAX_SAFE_INTEGER||9007199254740991,Ls=Number.MIN_SAFE_INTEGER||-9007199254740991,zb={x:0,y:0,z:0},D={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,r){const n=r(e);let i=n.x*n.x+n.y*n.y;return typeof n.z<"u"&&(i+=n.z*n.z),kt(i)},compute:function(e,r,n){if(e===0)return r[0].t=0,r[0];const i=r.length-1;if(e===1)return r[i].t=1,r[i];const s=1-e;let o=r;if(i===0)return r[0].t=e,r[0];if(i===1){const u={x:s*o[0].x+e*o[1].x,y:s*o[0].y+e*o[1].y,t:e};return n&&(u.z=s*o[0].z+e*o[1].z),u}if(i<4){let u=s*s,l=e*e,c,f,d,h=0;i===2?(o=[o[0],o[1],o[2],zb],c=u,f=s*e*2,d=l):i===3&&(c=u*s,f=u*e*3,d=s*l*3,h=e*l);const y={x:c*o[0].x+f*o[1].x+d*o[2].x+h*o[3].x,y:c*o[0].y+f*o[1].y+d*o[2].y+h*o[3].y,t:e};return n&&(y.z=c*o[0].z+f*o[1].z+d*o[2].z+h*o[3].z),y}const a=JSON.parse(JSON.stringify(r));for(;a.length>1;){for(let u=0;u<a.length-1;u++)a[u]={x:a[u].x+(a[u+1].x-a[u].x)*e,y:a[u].y+(a[u+1].y-a[u].y)*e},typeof a[u].z<"u"&&(a[u].z=a[u].z+(a[u+1].z-a[u].z)*e);a.splice(a.length-1,1)}return a[0].t=e,a[0]},computeWithRatios:function(e,r,n,i){const s=1-e,o=n,a=r;let u=o[0],l=o[1],c=o[2],f=o[3],d;if(u*=s,l*=e,a.length===2)return d=u+l,{x:(u*a[0].x+l*a[1].x)/d,y:(u*a[0].y+l*a[1].y)/d,z:i?(u*a[0].z+l*a[1].z)/d:!1,t:e};if(u*=s,l*=2*s,c*=e*e,a.length===3)return d=u+l+c,{x:(u*a[0].x+l*a[1].x+c*a[2].x)/d,y:(u*a[0].y+l*a[1].y+c*a[2].y)/d,z:i?(u*a[0].z+l*a[1].z+c*a[2].z)/d:!1,t:e};if(u*=s,l*=1.5*s,c*=3*s,f*=e*e*e,a.length===4)return d=u+l+c+f,{x:(u*a[0].x+l*a[1].x+c*a[2].x+f*a[3].x)/d,y:(u*a[0].y+l*a[1].y+c*a[2].y+f*a[3].y)/d,z:i?(u*a[0].z+l*a[1].z+c*a[2].z+f*a[3].z)/d:!1,t:e}},derive:function(e,r){const n=[];for(let i=e,s=i.length,o=s-1;s>1;s--,o--){const a=[];for(let u=0,l;u<o;u++)l={x:o*(i[u+1].x-i[u].x),y:o*(i[u+1].y-i[u].y)},r&&(l.z=o*(i[u+1].z-i[u].z)),a.push(l);n.push(a),i=a}return n},between:function(e,r,n){return r<=e&&e<=n||D.approximately(e,r)||D.approximately(e,n)},approximately:function(e,r,n){return en(e-r)<=(n||Tb)},length:function(e){const n=D.Tvalues.length;let i=0;for(let s=0,o;s<n;s++)o=.5*D.Tvalues[s]+.5,i+=D.Cvalues[s]*D.arcfn(o,e);return .5*i},map:function(e,r,n,i,s){const o=n-r,a=s-i,u=e-r,l=u/o;return i+a*l},lerp:function(e,r,n){const i={x:r.x+e*(n.x-r.x),y:r.y+e*(n.y-r.y)};return r.z!==void 0&&n.z!==void 0&&(i.z=r.z+e*(n.z-r.z)),i},pointToString:function(e){let r=e.x+"/"+e.y;return typeof e.z<"u"&&(r+="/"+e.z),r},pointsToString:function(e){return"["+e.map(D.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,r,n){const i=r.x-e.x,s=r.y-e.y,o=n.x-e.x,a=n.y-e.y,u=i*a-s*o,l=i*o+s*a;return tn(u,l)},round:function(e,r){const n=""+e,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+r))},dist:function(e,r){const n=e.x-r.x,i=e.y-r.y;return kt(n*n+i*i)},closest:function(e,r){let n=Ie(2,63),i,s;return e.forEach(function(o,a){s=D.dist(r,o),s<n&&(n=s,i=a)}),{mdist:n,mpos:i}},abcratio:function(e,r){if(r!==2&&r!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const n=Ie(e,r)+Ie(1-e,r),i=n-1;return en(i/n)},projectionratio:function(e,r){if(r!==2&&r!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const n=Ie(1-e,r),i=Ie(e,r)+n;return n/i},lli8:function(e,r,n,i,s,o,a,u){const l=(e*i-r*n)*(s-a)-(e-n)*(s*u-o*a),c=(e*i-r*n)*(o-u)-(r-i)*(s*u-o*a),f=(e-n)*(o-u)-(r-i)*(s-a);return f==0?!1:{x:l/f,y:c/f}},lli4:function(e,r,n,i){const s=e.x,o=e.y,a=r.x,u=r.y,l=n.x,c=n.y,f=i.x,d=i.y;return D.lli8(s,o,a,u,l,c,f,d)},lli:function(e,r){return D.lli4(e,e.c,r,r.c)},makeline:function(e,r){return new Hi(e.x,e.y,(e.x+r.x)/2,(e.y+r.y)/2,r.x,r.y)},findbbox:function(e){let r=js,n=js,i=Ls,s=Ls;return e.forEach(function(o){const a=o.bbox();r>a.x.min&&(r=a.x.min),n>a.y.min&&(n=a.y.min),i<a.x.max&&(i=a.x.max),s<a.y.max&&(s=a.y.max)}),{x:{min:r,mid:(r+i)/2,max:i,size:i-r},y:{min:n,mid:(n+s)/2,max:s,size:s-n}}},shapeintersections:function(e,r,n,i,s){if(!D.bboxoverlap(r,i))return[];const o=[],a=[e.startcap,e.forward,e.back,e.endcap],u=[n.startcap,n.forward,n.back,n.endcap];return a.forEach(function(l){l.virtual||u.forEach(function(c){if(c.virtual)return;const f=l.intersects(c,s);f.length>0&&(f.c1=l,f.c2=c,f.s1=e,f.s2=n,o.push(f))})}),o},makeshape:function(e,r,n){const i=r.points.length,s=e.points.length,o=D.makeline(r.points[i-1],e.points[0]),a=D.makeline(e.points[s-1],r.points[0]),u={startcap:o,forward:e,back:r,endcap:a,bbox:D.findbbox([o,e,r,a])};return u.intersections=function(l){return D.shapeintersections(u,u.bbox,l,l.bbox,n)},u},getminmax:function(e,r,n){if(!n)return{min:0,max:0};let i=js,s=Ls,o,a;n.indexOf(0)===-1&&(n=[0].concat(n)),n.indexOf(1)===-1&&n.push(1);for(let u=0,l=n.length;u<l;u++)o=n[u],a=e.get(o),a[r]<i&&(i=a[r]),a[r]>s&&(s=a[r]);return{min:i,mid:(i+s)/2,max:s,size:s-i}},align:function(e,r){const n=r.p1.x,i=r.p1.y,s=-tn(r.p2.y-i,r.p2.x-n),o=function(a){return{x:(a.x-n)*yt(s)-(a.y-i)*wr(s),y:(a.x-n)*wr(s)+(a.y-i)*yt(s)}};return e.map(o)},roots:function(e,r){r=r||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=e.length-1,i=D.align(e,r),s=function($){return 0<=$&&$<=1};if(n===2){const $=i[0].y,T=i[1].y,Y=i[2].y,ie=$-2*T+Y;if(ie!==0){const te=-kt(T*T-$*Y),se=-$+T,ye=-(te+se)/ie,K=-(-te+se)/ie;return[ye,K].filter(s)}else if(T!==Y&&ie===0)return[(2*T-Y)/(2*T-2*Y)].filter(s);return[]}const o=i[0].y,a=i[1].y,u=i[2].y,l=i[3].y;let c=-o+3*a-3*u+l,f=3*o-6*a+3*u,d=-3*o+3*a,h=o;if(D.approximately(c,0)){if(D.approximately(f,0))return D.approximately(d,0)?[]:[-h/d].filter(s);const $=kt(d*d-4*f*h),T=2*f;return[($-d)/T,(-d-$)/T].filter(s)}f/=c,d/=c,h/=c;const y=(3*d-f*f)/3,v=y/3,m=(2*f*f*f-9*f*d+27*h)/27,g=m/2,x=g*g+v*v*v;let F,M,j,A,C;if(x<0){const $=-y/3,T=$*$*$,Y=kt(T),ie=-m/(2*Y),te=ie<-1?-1:ie>1?1:ie,se=_b(te),ye=rn(Y),K=2*ye;return j=K*yt(se/3)-f/3,A=K*yt((se+Qn)/3)-f/3,C=K*yt((se+2*Qn)/3)-f/3,[j,A,C].filter(s)}else{if(x===0)return F=g<0?rn(-g):-rn(g),j=2*F-f/3,A=-F-f/3,[j,A].filter(s);{const $=kt(x);return F=rn(-g+$),M=rn(g+$),[F-M-f/3].filter(s)}}},droots:function(e){if(e.length===3){const r=e[0],n=e[1],i=e[2],s=r-2*n+i;if(s!==0){const o=-kt(n*n-r*i),a=-r+n,u=-(o+a)/s,l=-(-o+a)/s;return[u,l]}else if(n!==i&&s===0)return[(2*n-i)/(2*(n-i))];return[]}if(e.length===2){const r=e[0],n=e[1];return r!==n?[r/(r-n)]:[]}return[]},curvature:function(e,r,n,i,s){let o,a,u,l,c=0,f=0;const d=D.compute(e,r),h=D.compute(e,n),y=d.x*d.x+d.y*d.y;if(i?(o=kt(Ie(d.y*h.z-h.y*d.z,2)+Ie(d.z*h.x-h.z*d.x,2)+Ie(d.x*h.y-h.x*d.y,2)),a=Ie(y+d.z*d.z,3/2)):(o=d.x*h.y-d.y*h.x,a=Ie(y,3/2)),o===0||a===0)return{k:0,r:0};if(c=o/a,f=a/o,!s){const v=D.curvature(e-.001,r,n,i,!0).k,m=D.curvature(e+.001,r,n,i,!0).k;l=(m-c+(c-v))/2,u=(en(m-c)+en(c-v))/2}return{k:c,r:f,dk:l,adk:u}},inflections:function(e){if(e.length<4)return[];const r=D.align(e,{p1:e[0],p2:e.slice(-1)[0]}),n=r[2].x*r[1].y,i=r[3].x*r[1].y,s=r[1].x*r[2].y,o=r[3].x*r[2].y,a=18*(-3*n+2*i+3*s-o),u=18*(3*n-i-3*s),l=18*(s-n);if(D.approximately(a,0)){if(!D.approximately(u,0)){let h=-l/u;if(0<=h&&h<=1)return[h]}return[]}const c=2*a;if(D.approximately(c,0))return[];const f=u*u-4*a*l;if(f<0)return[];const d=Math.sqrt(f);return[(d-u)/c,-(u+d)/c].filter(function(h){return 0<=h&&h<=1})},bboxoverlap:function(e,r){const n=["x","y"],i=n.length;for(let s=0,o,a,u,l;s<i;s++)if(o=n[s],a=e[o].mid,u=r[o].mid,l=(e[o].size+r[o].size)/2,en(a-u)>=l)return!1;return!0},expandbox:function(e,r){r.x.min<e.x.min&&(e.x.min=r.x.min),r.y.min<e.y.min&&(e.y.min=r.y.min),r.z&&r.z.min<e.z.min&&(e.z.min=r.z.min),r.x.max>e.x.max&&(e.x.max=r.x.max),r.y.max>e.y.max&&(e.y.max=r.y.max),r.z&&r.z.max>e.z.max&&(e.z.max=r.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,r,n){const i=e.bbox(),s=r.bbox(),o=1e5,a=n||.5;if(i.x.size+i.y.size<a&&s.x.size+s.y.size<a)return[(o*(e._t1+e._t2)/2|0)/o+"/"+(o*(r._t1+r._t2)/2|0)/o];let u=e.split(.5),l=r.split(.5),c=[{left:u.left,right:l.left},{left:u.left,right:l.right},{left:u.right,right:l.right},{left:u.right,right:l.left}];c=c.filter(function(d){return D.bboxoverlap(d.left.bbox(),d.right.bbox())});let f=[];return c.length===0||(c.forEach(function(d){f=f.concat(D.pairiteration(d.left,d.right,a))}),f=f.filter(function(d,h){return f.indexOf(d)===h})),f},getccenter:function(e,r,n){const i=r.x-e.x,s=r.y-e.y,o=n.x-r.x,a=n.y-r.y,u=i*yt(Mt)-s*wr(Mt),l=i*wr(Mt)+s*yt(Mt),c=o*yt(Mt)-a*wr(Mt),f=o*wr(Mt)+a*yt(Mt),d=(e.x+r.x)/2,h=(e.y+r.y)/2,y=(r.x+n.x)/2,v=(r.y+n.y)/2,m=d+u,g=h+l,x=y+c,F=v+f,M=D.lli8(d,h,m,g,y,v,x,F),j=D.dist(M,e);let A=tn(e.y-M.y,e.x-M.x),C=tn(r.y-M.y,r.x-M.x),$=tn(n.y-M.y,n.x-M.x),T;return A<$?((A>C||C>$)&&(A+=Qn),A>$&&(T=$,$=A,A=T)):$<C&&C<A?(T=$,$=A,A=T):$+=Qn,M.s=A,M.e=$,M.r=j,M},numberSort:function(e,r){return e-r}},Vs=class Rd{constructor(r){this.curves=[],this._3d=!1,r&&(this.curves=r,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(r){return D.pointsToString(r.points)}).join(", ")+"]"}addCurve(r){this.curves.push(r),this._3d=this._3d||r._3d}length(){return this.curves.map(function(r){return r.length()}).reduce(function(r,n){return r+n})}curve(r){return this.curves[r]}bbox(){const r=this.curves;for(var n=r[0].bbox(),i=1;i<r.length;i++)D.expandbox(n,r[i].bbox());return n}offset(r){const n=[];return this.curves.forEach(function(i){n.push(...i.offset(r))}),new Rd(n)}},{abs:nn,min:Nl,max:kl,cos:Rb,sin:Ib,acos:jb,sqrt:sn}=Math,Lb=Math.PI,Hi=class oe{constructor(r){let n=r&&r.forEach?r:Array.from(arguments).slice(),i=!1;if(typeof n[0]=="object"){i=n.length;const y=[];n.forEach(function(v){["x","y","z"].forEach(function(m){typeof v[m]<"u"&&y.push(v[m])})}),n=y}let s=!1;const o=n.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const a=this._3d=!s&&(o===9||o===12)||r&&r[0]&&typeof r[0].z<"u",u=this.points=[];for(let y=0,v=a?3:2;y<o;y+=v){var l={x:n[y],y:n[y+1]};a&&(l.z=n[y+2]),u.push(l)}const c=this.order=u.length-1,f=this.dims=["x","y"];a&&f.push("z"),this.dimlen=f.length;const d=D.align(u,{p1:u[0],p2:u[c]}),h=D.dist(u[0],u[c]);this._linear=d.reduce((y,v)=>y+nn(v.y),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(r,n,i,s){if(typeof s>"u"&&(s=.5),s===0)return new oe(n,n,i);if(s===1)return new oe(r,n,n);const o=oe.getABC(2,r,n,i,s);return new oe(r,o.A,i)}static cubicFromPoints(r,n,i,s,o){typeof s>"u"&&(s=.5);const a=oe.getABC(3,r,n,i,s);typeof o>"u"&&(o=D.dist(n,a.C));const u=o*(1-s)/s,l=D.dist(r,i),c=(i.x-r.x)/l,f=(i.y-r.y)/l,d=o*c,h=o*f,y=u*c,v=u*f,m={x:n.x-d,y:n.y-h},g={x:n.x+y,y:n.y+v},x=a.A,F={x:x.x+(m.x-x.x)/(1-s),y:x.y+(m.y-x.y)/(1-s)},M={x:x.x+(g.x-x.x)/s,y:x.y+(g.y-x.y)/s},j={x:r.x+(F.x-r.x)/s,y:r.y+(F.y-r.y)/s},A={x:i.x+(M.x-i.x)/(1-s),y:i.y+(M.y-i.y)/(1-s)};return new oe(r,j,A,i)}static getUtils(){return D}getUtils(){return oe.getUtils()}static get PolyBezier(){return Vs}valueOf(){return this.toString()}toString(){return D.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const r=this.points,n=r[0].x,i=r[0].y,s=["M",n,i,this.order===2?"Q":"C"];for(let o=1,a=r.length;o<a;o++)s.push(r[o].x),s.push(r[o].y);return s.join(" ")}setRatios(r){if(r.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=r,this._lut=[]}verify(){const r=this.coordDigest();r!==this._print&&(this._print=r,this.update())}coordDigest(){return this.points.map(function(r,n){return""+n+r.x+r.y+(r.z?r.z:0)}).join("")}update(){this._lut=[],this.dpoints=D.derive(this.points,this._3d),this.computedirection()}computedirection(){const r=this.points,n=D.angle(r[0],r[this.order],r[1]);this.clockwise=n>0}length(){return D.length(this.derivative.bind(this))}static getABC(r=2,n,i,s,o=.5){const a=D.projectionratio(o,r),u=1-a,l={x:a*n.x+u*s.x,y:a*n.y+u*s.y},c=D.abcratio(o,r);return{A:{x:i.x+(i.x-l.x)/c,y:i.y+(i.y-l.y)/c},B:i,C:l,S:n,E:s}}getABC(r,n){n=n||this.get(r);let i=this.points[0],s=this.points[this.order];return oe.getABC(this.order,i,n,s,r)}getLUT(r){if(this.verify(),r=r||100,this._lut.length===r+1)return this._lut;this._lut=[],r++,this._lut=[];for(let n=0,i,s;n<r;n++)s=n/(r-1),i=this.compute(s),i.t=s,this._lut.push(i);return this._lut}on(r,n){n=n||5;const i=this.getLUT(),s=[];for(let o=0,a,u=0;o<i.length;o++)a=i[o],D.dist(a,r)<n&&(s.push(a),u+=o/i.length);return s.length?t/=s.length:!1}project(r){const n=this.getLUT(),i=n.length-1,s=D.closest(n,r),o=s.mpos,a=(o-1)/i,u=(o+1)/i,l=.1/i;let c=s.mdist,f=a,d=f,h;c+=1;for(let y;f<u+l;f+=l)h=this.compute(f),y=D.dist(r,h),y<c&&(c=y,d=f);return d=d<0?0:d>1?1:d,h=this.compute(d),h.t=d,h.d=c,h}get(r){return this.compute(r)}point(r){return this.points[r]}compute(r){return this.ratios?D.computeWithRatios(r,this.points,this.ratios,this._3d):D.compute(r,this.points,this._3d,this.ratios)}raise(){const r=this.points,n=[r[0]],i=r.length;for(let s=1,o,a;s<i;s++)o=r[s],a=r[s-1],n[s]={x:(i-s)/i*o.x+s/i*a.x,y:(i-s)/i*o.y+s/i*a.y};return n[i]=r[i-1],new oe(n)}derivative(r){return D.compute(r,this.dpoints[0],this._3d)}dderivative(r){return D.compute(r,this.dpoints[1],this._3d)}align(){let r=this.points;return new oe(D.align(r,{p1:r[0],p2:r[r.length-1]}))}curvature(r){return D.curvature(r,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return D.inflections(this.points)}normal(r){return this._3d?this.__normal3(r):this.__normal2(r)}__normal2(r){const n=this.derivative(r),i=sn(n.x*n.x+n.y*n.y);return{t:r,x:-n.y/i,y:n.x/i}}__normal3(r){const n=this.derivative(r),i=this.derivative(r+.01),s=sn(n.x*n.x+n.y*n.y+n.z*n.z),o=sn(i.x*i.x+i.y*i.y+i.z*i.z);n.x/=s,n.y/=s,n.z/=s,i.x/=o,i.y/=o,i.z/=o;const a={x:i.y*n.z-i.z*n.y,y:i.z*n.x-i.x*n.z,z:i.x*n.y-i.y*n.x},u=sn(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=u,a.y/=u,a.z/=u;const l=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:r,x:l[0]*n.x+l[1]*n.y+l[2]*n.z,y:l[3]*n.x+l[4]*n.y+l[5]*n.z,z:l[6]*n.x+l[7]*n.y+l[8]*n.z}}hull(r){let n=this.points,i=[],s=[],o=0;for(s[o++]=n[0],s[o++]=n[1],s[o++]=n[2],this.order===3&&(s[o++]=n[3]);n.length>1;){i=[];for(let a=0,u,l=n.length-1;a<l;a++)u=D.lerp(r,n[a],n[a+1]),s[o++]=u,i.push(u);n=i}return s}split(r,n){if(r===0&&n)return this.split(n).left;if(n===1)return this.split(r).right;const i=this.hull(r),s={left:this.order===2?new oe([i[0],i[3],i[5]]):new oe([i[0],i[4],i[7],i[9]]),right:this.order===2?new oe([i[5],i[4],i[2]]):new oe([i[9],i[8],i[6],i[3]]),span:i};return s.left._t1=D.map(0,0,1,this._t1,this._t2),s.left._t2=D.map(r,0,1,this._t1,this._t2),s.right._t1=D.map(r,0,1,this._t1,this._t2),s.right._t2=D.map(1,0,1,this._t1,this._t2),n?(n=D.map(n,r,1,0,1),s.right.split(n).left):s}extrema(){const r={};let n=[];return this.dims.forEach(function(i){let s=function(a){return a[i]},o=this.dpoints[0].map(s);r[i]=D.droots(o),this.order===3&&(o=this.dpoints[1].map(s),r[i]=r[i].concat(D.droots(o))),r[i]=r[i].filter(function(a){return a>=0&&a<=1}),n=n.concat(r[i].sort(D.numberSort))}.bind(this)),r.values=n.sort(D.numberSort).filter(function(i,s){return n.indexOf(i)===s}),r}bbox(){const r=this.extrema(),n={};return this.dims.forEach(function(i){n[i]=D.getminmax(this,i,r[i])}.bind(this)),n}overlaps(r){const n=this.bbox(),i=r.bbox();return D.bboxoverlap(n,i)}offset(r,n){if(typeof n<"u"){const i=this.get(r),s=this.normal(r),o={c:i,n:s,x:i.x+s.x*n,y:i.y+s.y*n};return this._3d&&(o.z=i.z+s.z*n),o}if(this._linear){const i=this.normal(0),s=this.points.map(function(o){const a={x:o.x+r*i.x,y:o.y+r*i.y};return o.z&&i.z&&(a.z=o.z+r*i.z),a});return[new oe(s)]}return this.reduce().map(function(i){return i._linear?i.offset(r)[0]:i.scale(r)})}simple(){if(this.order===3){const s=D.angle(this.points[0],this.points[3],this.points[1]),o=D.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&o<0||s<0&&o>0)return!1}const r=this.normal(0),n=this.normal(1);let i=r.x*n.x+r.y*n.y;return this._3d&&(i+=r.z*n.z),nn(jb(i))<Lb/3}reduce(){let r,n=0,i=0,s=.01,o,a=[],u=[],l=this.extrema().values;for(l.indexOf(0)===-1&&(l=[0].concat(l)),l.indexOf(1)===-1&&l.push(1),n=l[0],r=1;r<l.length;r++)i=l[r],o=this.split(n,i),o._t1=n,o._t2=i,a.push(o),n=i;return a.forEach(function(c){for(n=0,i=0;i<=1;)for(i=n+s;i<=1+s;i+=s)if(o=c.split(n,i),!o.simple()){if(i-=s,nn(n-i)<s)return[];o=c.split(n,i),o._t1=D.map(n,0,1,c._t1,c._t2),o._t2=D.map(i,0,1,c._t1,c._t2),u.push(o),n=i;break}n<1&&(o=c.split(n,1),o._t1=D.map(n,0,1,c._t1,c._t2),o._t2=c._t2,u.push(o))}),u}translate(r,n,i){i=typeof i=="number"?i:n;const s=this.order;let o=this.points.map((a,u)=>(1-u/s)*n+u/s*i);return new oe(this.points.map((a,u)=>({x:a.x+r.x*o[u],y:a.y+r.y*o[u]})))}scale(r){const n=this.order;let i=!1;if(typeof r=="function"&&(i=r),i&&n===2)return this.raise().scale(i);const s=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):r,i?i(1):r);const a=i?i(0):r,u=i?i(1):r,l=[this.offset(0,10),this.offset(1,10)],c=[],f=D.lli4(l[0],l[0].c,l[1],l[1].c);if(!f)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(d){const h=c[d*n]=D.copy(o[d*n]);h.x+=(d?u:a)*l[d].n.x,h.y+=(d?u:a)*l[d].n.y}),i?([0,1].forEach(function(d){if(!(n===2&&d)){var h=o[d+1],y={x:h.x-f.x,y:h.y-f.y},v=i?i((d+1)/n):r;i&&!s&&(v=-v);var m=sn(y.x*y.x+y.y*y.y);y.x/=m,y.y/=m,c[d+1]={x:h.x+v*y.x,y:h.y+v*y.y}}}),new oe(c)):([0,1].forEach(d=>{if(n===2&&d)return;const h=c[d*n],y=this.derivative(d),v={x:h.x+y.x,y:h.y+y.y};c[d+1]=D.lli4(h,v,f,o[d+1])}),new oe(c))}outline(r,n,i,s){if(n=n===void 0?r:n,this._linear){const A=this.normal(0),C=this.points[0],$=this.points[this.points.length-1];let T,Y,ie;i===void 0&&(i=r,s=n),T={x:C.x+A.x*r,y:C.y+A.y*r},ie={x:$.x+A.x*i,y:$.y+A.y*i},Y={x:(T.x+ie.x)/2,y:(T.y+ie.y)/2};const te=[T,Y,ie];T={x:C.x-A.x*n,y:C.y-A.y*n},ie={x:$.x-A.x*s,y:$.y-A.y*s},Y={x:(T.x+ie.x)/2,y:(T.y+ie.y)/2};const se=[ie,Y,T],ye=D.makeline(se[2],te[0]),K=D.makeline(te[2],se[0]),Ot=[ye,new oe(te),K,new oe(se)];return new Vs(Ot)}const o=this.reduce(),a=o.length,u=[];let l=[],c,f=0,d=this.length();const h=typeof i<"u"&&typeof s<"u";function y(A,C,$,T,Y){return function(ie){const te=T/$,se=(T+Y)/$,ye=C-A;return D.map(ie,0,1,A+te*ye,A+se*ye)}}o.forEach(function(A){const C=A.length();h?(u.push(A.scale(y(r,i,d,f,C))),l.push(A.scale(y(-n,-s,d,f,C)))):(u.push(A.scale(r)),l.push(A.scale(-n))),f+=C}),l=l.map(function(A){return c=A.points,c[3]?A.points=[c[3],c[2],c[1],c[0]]:A.points=[c[2],c[1],c[0]],A}).reverse();const v=u[0].points[0],m=u[a-1].points[u[a-1].points.length-1],g=l[a-1].points[l[a-1].points.length-1],x=l[0].points[0],F=D.makeline(g,v),M=D.makeline(m,x),j=[F].concat(u).concat([M]).concat(l);return new Vs(j)}outlineshapes(r,n,i){n=n||r;const s=this.outline(r,n).curves,o=[];for(let a=1,u=s.length;a<u/2;a++){const l=D.makeshape(s[a],s[u-a],i);l.startcap.virtual=a>1,l.endcap.virtual=a<u/2-1,o.push(l)}return o}intersects(r,n){return r?r.p1&&r.p2?this.lineIntersects(r):(r instanceof oe&&(r=r.reduce()),this.curveintersects(this.reduce(),r,n)):this.selfintersects(n)}lineIntersects(r){const n=Nl(r.p1.x,r.p2.x),i=Nl(r.p1.y,r.p2.y),s=kl(r.p1.x,r.p2.x),o=kl(r.p1.y,r.p2.y);return D.roots(this.points,r).filter(a=>{var u=this.get(a);return D.between(u.x,n,s)&&D.between(u.y,i,o)})}selfintersects(r){const n=this.reduce(),i=n.length-2,s=[];for(let o=0,a,u,l;o<i;o++)u=n.slice(o,o+1),l=n.slice(o+2),a=this.curveintersects(u,l,r),s.push(...a);return s}curveintersects(r,n,i){const s=[];r.forEach(function(a){n.forEach(function(u){a.overlaps(u)&&s.push({left:a,right:u})})});let o=[];return s.forEach(function(a){const u=D.pairiteration(a.left,a.right,i);u.length>0&&(o=o.concat(u))}),o}arcs(r){return r=r||.5,this._iterate(r,[])}_error(r,n,i,s){const o=(s-i)/4,a=this.get(i+o),u=this.get(s-o),l=D.dist(r,n),c=D.dist(r,a),f=D.dist(r,u);return nn(c-l)+nn(f-l)}_iterate(r,n){let i=0,s=1,o;do{o=0,s=1;let a=this.get(i),u,l,c,f,d=!1,h=!1,y,v=s,m=1;do if(h=d,f=c,v=(i+s)/2,u=this.get(v),l=this.get(s),c=D.getccenter(a,u,l),c.interval={start:i,end:s},d=this._error(c,a,i,s)<=r,y=h&&!d,y||(m=s),d){if(s>=1){if(c.interval.end=m=1,f=c,s>1){let x={x:c.x+c.r*Rb(c.e),y:c.y+c.r*Ib(c.e)};c.e+=D.angle({x:c.x,y:c.y},x,this.get(1))}break}s=s+(s-i)/2}else s=v;while(!y&&o++<100);if(o>=100)break;f=f||c,n.push(f),i=m}while(s<1);return n}},Wr=e=>e.quadratic!==void 0,wa=e=>e.cubic1!==void 0&&e.cubic2!==void 0,Vb=(e,r,n=0)=>Mr(e,r,n),Mr=(e,r,n=0)=>{if(Number.isNaN(n))throw new Error("bend is NaN");if(n<-1||n>1)throw new Error("Expects bend range of -1 to 1");const i=nt(.5,e,r);let s=i;r.y<e.y?s=n>0?{x:Math.min(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.max(e.x,r.x),y:Math.max(e.y,r.y)}:s=n>0?{x:Math.max(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.min(e.x,r.x),y:Math.max(e.y,r.y)};const o=nt(Math.abs(n),i,s);return jd(e,r,o)},Ob=(e,r,n,i)=>{const s=Mr(e,r,n);return new Hi(s.a,s.quadratic,s.b).compute(i)},Id=(e,r,n)=>[`M ${e.x} ${e.y} Q ${n.x} ${n.y} ${r.x} ${r.y}`],ai=e=>{if(wa(e))return Wb(e);if(Wr(e))return Gb(e);throw new Error("Unknown bezier type")},qb=(e,r,n,i)=>({a:Object.freeze(e),b:Object.freeze(r),cubic1:Object.freeze(n),cubic2:Object.freeze(i)}),Wb=e=>{const{a:r,cubic1:n,cubic2:i,b:s}=e,o=new Hi(r,n,i,s);return Object.freeze({...e,length:()=>o.length(),interpolate:a=>o.compute(a),nearest:a=>{throw new Error("not implemented")},bbox:()=>{const{x:a,y:u}=o.bbox(),l=a.size,c=u.size;if(l===void 0)throw new Error("x.size not present on calculated bbox");if(c===void 0)throw new Error("x.size not present on calculated bbox");return _t({x:a.min,y:u.min},l,c)},relativePosition:(a,u)=>{throw new Error("Not implemented")},distanceToPoint:a=>{throw new Error("Not implemented")},toSvgString:()=>["brrup"],kind:"bezier/cubic"})},jd=(e,r,n)=>({a:Object.freeze(e),b:Object.freeze(r),quadratic:Object.freeze(n)}),Gb=e=>{const{a:r,b:n,quadratic:i}=e,s=new Hi(r,i,n);return Object.freeze({...e,length:()=>s.length(),interpolate:o=>s.compute(o),nearest:o=>{throw new Error("not implemented")},bbox:()=>{const{x:o,y:a}=s.bbox(),u=o.size,l=a.size;if(u===void 0)throw new Error("x.size not present on calculated bbox");if(l===void 0)throw new Error("x.size not present on calculated bbox");return _t({x:o.min,y:a.min},u,l)},distanceToPoint:o=>{throw new Error("Not implemented")},relativePosition:(o,a)=>{throw new Error("Not implemented")},toString:()=>s.toString(),toSvgString:()=>Id(r,n,i),kind:"bezier/quadratic"})},Ub=function(e){if(Wr(e))return e.a;if(at(e))return e.a;throw new Error(`Unknown path type ${JSON.stringify(e)}`)},Hb=function(e){if(Wr(e))return e.b;if(at(e))return e.b;throw new Error(`Unknown path type ${JSON.stringify(e)}`)},Ld={};E(Ld,{access1dArray:()=>h1,allDirections:()=>Ji,array2dUpdater:()=>y1,asRectangles:()=>Kb,cellAtPoint:()=>Gd,cellEquals:()=>Od,cellFromIndex:()=>p1,cellKeyString:()=>Vd,cellMiddle:()=>e1,cells:()=>Ur,crossDirections:()=>Ud,getLine:()=>t1,getVectorFromCardinal:()=>Yi,guardCell:()=>it,indexFromCell:()=>Xi,inside:()=>qd,isEqual:()=>Xb,neighbours:()=>Hd,offset:()=>Gr,offsetCardinals:()=>r1,rectangleForCell:()=>Wd,rows:()=>d1,simpleLine:()=>n1,toArray:()=>Zb,visitArray:()=>v1,visitFor:()=>c1,visitNeigbours:()=>Qb,visitor:()=>yr,visitorBreadth:()=>o1,visitorColumn:()=>f1,visitorDepth:()=>s1,visitorRandom:()=>u1,visitorRandomContiguous:()=>a1,visitorRow:()=>l1});var Jb=e=>e===void 0?!1:"x"in e&&"y"in e,Yb=e=>!(e===void 0||e[1]===void 0),Xb=(e,r)=>{if(r===void 0||e===void 0)return!1;if("rows"in e&&"cols"in e)if("rows"in r&&"cols"in r){if(e.rows!==r.rows||e.cols!==r.cols)return!1}else return!1;if("size"in e)if("size"in r){if(e.size!==r.size)return!1}else return!1;return!0},Vd=e=>`Cell{${e.x},${e.y}}`,Od=(e,r)=>r===void 0||e===void 0?!1:e.x===r.x&&e.y===r.y,it=(e,r="Param",n)=>{if(e===void 0)throw new Error(r+" is undefined. Expecting {x,y}");if(e.x===void 0)throw new Error(r+".x is undefined");if(e.y===void 0)throw new Error(r+".y is undefined");if(Number.isNaN(e.x))throw new Error(r+".x is NaN");if(Number.isNaN(e.y))throw new Error(r+".y is NaN");if(!Number.isInteger(e.x))throw new TypeError(r+".x is non-integer");if(!Number.isInteger(e.y))throw new TypeError(r+".y is non-integer");if(n!==void 0&&!qd(n,e))throw new Error(`${r} is outside of grid. Cell: ${e.x},${e.y} Grid: ${n.cols}, ${n.rows}`)},Bn=(e,r="Param")=>{if(e===void 0)throw new Error(`${r} is undefined. Expecting grid.`);if(!("rows"in e))throw new Error(`${r}.rows is undefined`);if(!("cols"in e))throw new Error(`${r}.cols is undefined`);if(!Number.isInteger(e.rows))throw new TypeError(`${r}.rows is not an integer`);if(!Number.isInteger(e.cols))throw new TypeError(`${r}.cols is not an integer`)},qd=(e,r)=>!(r.x<0||r.y<0||r.x>=e.cols||r.y>=e.rows),Wd=(e,r)=>{it(r);const n=e.size,i=r.x*n,s=r.y*n;return _t({x:i,y:s},n,n)};function*Kb(e){for(const r of Ur(e))yield Wd(e,r)}var Zb=(e,r)=>{const n=[];for(let i=0;i<e.rows;i++)if(n[i]=Array.from({length:e.cols}),r)for(let s=0;s<e.cols;s++)n[i][s]=r;return n},Gd=(e,r)=>{const n=e.size;if(P(n,"positive","grid.size"),r.x<0||r.y<0)return;const i=Math.floor(r.x/n),s=Math.floor(r.y/n);if(!(i>=e.cols)&&!(s>=e.rows))return{x:i,y:s}},Ji=Object.freeze(["n","ne","nw","e","s","se","sw","w"]),Ud=Object.freeze(["n","e","s","w"]),Hd=(e,r,n="undefined",i)=>{const s=i??Ji,o=s.map(a=>Gr(e,r,Yi(a),n));return ji(s,o)};function*Qb(e,r,n="undefined",i){const o=(i??Ji).map(a=>Gr(e,r,Yi(a),n));for(const a of o)a!==void 0&&(yield a)}var e1=(e,r)=>{it(r);const n=e.size,i=r.x*n,s=r.y*n;return Object.freeze({x:i+n/2,y:s+n/2})},t1=(e,r)=>{it(e),it(r);let n=e.x,i=e.y;const s=Math.abs(r.x-n),o=Math.abs(r.y-i),a=n<r.x?1:-1,u=i<r.y?1:-1;let l=s-o;const c=[];for(;c.push(Object.freeze({x:n,y:i})),!(n===r.x&&i===r.y);){const f=2*l;f>-o&&(l-=o,n+=a),f<s&&(l+=s,i+=u)}return c},r1=(e,r,n,i="stop")=>{Bn(e,"grid"),it(r,"start"),le(n,"aboveZero","steps");const s=Ji,o=s.map(u=>Yi(u,n)),a=s.map((u,l)=>Gr(e,r,o[l],i));return ji(s,a)},Yi=(e,r=1)=>{let n;switch(e){case"n":{n={x:0,y:-1*r};break}case"ne":{n={x:1*r,y:-1*r};break}case"e":{n={x:1*r,y:0};break}case"se":{n={x:1*r,y:1*r};break}case"s":{n={x:0,y:1*r};break}case"sw":{n={x:-1*r,y:1*r};break}case"w":{n={x:-1*r,y:0};break}case"nw":{n={x:-1*r,y:-1*r};break}default:n={x:0,y:0}}return Object.freeze(n)},n1=function(e,r,n=!1){const i=[];if(e.x===r.x){const s=n?r.y+1:r.y;for(let o=e.y;o<s;o++)i.push({x:e.x,y:o})}else if(e.y===r.y){const s=n?r.x+1:r.x;for(let o=e.x;o<s;o++)i.push({x:o,y:e.y})}else throw new Error(`Only does vertical and horizontal: ${e.x},${e.y} - ${r.x},${r.y}`);return i},Gr=function(e,r,n,i="undefined"){it(r,"start",e),it(n),Bn(e,"grid");let s=r.x,o=r.y;switch(i){case"wrap":{s+=n.x%e.cols,o+=n.y%e.rows,s<0?s=e.cols+s:s>=e.cols&&(s-=e.cols),o<0?o=e.rows+o:o>=e.rows&&(o-=e.rows);break}case"stop":{s+=n.x,o+=n.y,s=Ks(s,e.cols),o=Ks(o,e.rows);break}case"undefined":{if(s+=n.x,o+=n.y,s<0||o<0||s>=e.cols||o>=e.rows)return;break}case"unbounded":{s+=n.x,o+=n.y;break}default:throw new Error(`Unknown BoundsLogic case ${i}`)}return Object.freeze({x:s,y:o})},i1=(e,r,n,i)=>{const s=Hd(e,r,i,n);return Object.entries(s).filter(a=>Yb(a))},yr=function*(e,r,n,i={}){Bn(r,"grid"),it(n,"start",r);const s=i.visited??Wc(Vd),o=e.options??((c,f)=>i1(c,f,Ud,"undefined"));if(!Jb(n))throw new Error("'start' parameter is undefined or not a cell");let a=[n],u=[],l;for(;a.length>0;){if(l===void 0){const c=a.pop();if(c===void 0)break;l=c}if(!s.has(l)){s.add(l),yield l;const c=o(r,l).filter(f=>f[1]===void 0?!1:!s.has(f[1]));if(c.length===0)l!==void 0&&(a=a.filter(f=>Od(f,l)));else for(const f of c)f!==void 0&&f[1]!==void 0&&u.push(f)}if(u=u.filter(c=>!s.has(c[1])),u.length===0)l=void 0;else{const c=e.select(u);c!==void 0&&(a.push(c[1]),l=c[1])}}},s1=(e,r,n={})=>yr({select:i=>i.at(-1)},e,r,n),o1=(e,r,n={})=>yr({select:i=>i[0]},e,r,n),Jd=e=>Oi(e),a1=(e,r,n={})=>yr({select:Jd},e,r,n),u1=(e,r,n={})=>yr({options:(i,s)=>{const o=[];for(const a of Ur(i,s))o.push(["n",a]);return o},select:Jd},e,r,n),l1=(e,r,n={})=>{r||(r={x:0,y:0});const{reversed:i=!1}=n;return yr({select:u=>u.find(l=>l[0]===(i?"w":"e")),options:(u,l)=>(i?l.x>0?l={x:l.x-1,y:l.y}:l.y>0?l={x:u.cols-1,y:l.y-1}:l={x:u.cols-1,y:u.rows-1}:l.x<u.rows-1?l={x:l.x+1,y:l.y}:l.y<u.rows-1?l={x:0,y:l.y+1}:l={x:0,y:0},[[i?"w":"e",l]])},e,r,n)},c1=(e,r,n,i)=>{le(n,"","steps");const s={reversed:n<0};n=Math.abs(n);let o=r,a=i(e,r,s);a.next();let u=0;for(;u<n;){u++;const{value:l}=a.next();if(l)o=l,s.debug&&console.log(`stepsMade: ${u} cell: ${o.x}, ${o.y} reverse: ${s.reversed}`);else if(n>=e.cols*e.rows)n-=e.cols*e.rows,u=0,a=i(e,r,s),a.next(),o=r,s.debug&&console.log(`resetting visitor to ${n}`);else throw new Error("Value not received by visitor")}return o},f1=(e,r,n={})=>{const{reversed:i=!1}=n;return yr({select:o=>o.find(a=>a[0]===(i?"n":"s")),options:(o,a)=>(i?a.y>0?a={x:a.x,y:a.y-1}:a.x===0?a={x:o.cols-1,y:o.rows-1}:a={x:a.x-1,y:o.rows-1}:a.y<o.rows-1?a={x:a.x,y:a.y+1}:a.x<o.cols-1?a={x:a.x+1,y:0}:a={x:0,y:0},[[i?"n":"s",a]])},e,r,n)},d1=function*(e,r){r||(r={x:0,y:0});let n=r.y,i=[];for(const s of Ur(e,r))s.y===n?i.push(s):(yield i,i=[s],n=s.y);i.length>0&&(yield i)},Ur=function*(e,r){r||(r={x:0,y:0}),Bn(e,"grid"),it(r,"start",e);let{x:n,y:i}=r,s=!0;do yield{x:n,y:i},n++,n===e.cols&&(i++,n=0),i===e.rows&&(i=0,n=0),n===r.x&&i===r.y&&(s=!1);while(s)},h1=(e,r)=>{const n={cols:r,rows:Math.ceil(e.length/r)};return(s,o)=>{const a=Xi(n,s,o);if(a!==void 0)return e[a]}},y1=(e,r)=>(i,s)=>{const o=Gd(e,s);if(o===void 0)throw new Error(`Position does not exist. Pos: ${JSON.stringify(s)} Grid: ${JSON.stringify(e)}`);r[o.y][o.x]=i};function*v1(e,r,n,i){if(typeof e>"u")throw new TypeError("First parameter is undefined, expected an array");if(e===null)throw new Error("First parameter is null, expected an array");if(!Array.isArray(e))throw new Error("First parameter should be an array");if(le(r,"aboveZero","cols"),e.length===0)return;const s=i?.boundsWrap??"stop",o=Math.ceil(e.length/r),a={cols:r,rows:o};n===void 0&&(n=Ur);const u=n(a,{x:0,y:0},i);for(const l of u){const c=Xi(a,l,s);if(c===void 0)return;yield[e[c],c]}}var Xi=(e,r,n)=>{if(Bn(e,"grid"),r.x<0)switch(n){case"stop":{r={...r,x:0};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r=Gr(e,{x:0,y:r.y},{x:r.x,y:0},"wrap");break}}if(r.y<0)switch(n){case"stop":{r={...r,y:0};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r={...r,y:e.rows+r.y};break}}if(r.x>=e.cols)switch(n){case"stop":{r={...r,x:e.cols-1};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r={...r,x:r.x%e.cols};break}}if(r.y>=e.rows)switch(n){case"stop":{r={...r,y:e.rows-1};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r={...r,y:r.y%e.rows};break}}return r.y*e.cols+r.x},p1=(e,r)=>{let n=0;return n=typeof e=="number"?e:e.cols,le(n,"aboveZero","colsOrGrid"),{x:r%n,y:Math.floor(r/n)}},Yd={};E(Yd,{bbox:()=>Qd,computeDimensions:()=>Ki,distanceToPoint:()=>Kd,fromPaths:()=>nh,guardContinuous:()=>th,interpolate:()=>Xd,relativePosition:()=>Zd,setSegment:()=>m1,toString:()=>eh,toSvgString:()=>rh});var m1=(e,r,n)=>{const i=[...e.segments];return i[r]=n,nh(...i)},Xd=(e,r,n,i)=>{i===void 0&&(i=Ki(e));const s=r*(n?i.totalWidth:i.totalLength);let o=0;const a=n?i.widths:i.lengths;for(const[u,l]of a.entries())if(o+l>=s){let f=(s-o)/l;return f>1&&(f=1),e[u].interpolate(f)}else o+=l;return{x:0,y:0}},Kd=(e,r)=>{if(e.length===0)return 0;let n=e.map((i,s)=>({path:i,index:s,distance:i.distanceToPoint(r)}));if(n=Li(n,"distance"),n.length===0)throw new Error("Could not look up distances");return n[0].distance},Zd=(e,r,n,i)=>{i===void 0&&(i=Ki(e));let s=e.map((c,f)=>({path:c,index:f,distance:c.distanceToPoint(r)}));if(s=Li(s,"distance"),s.length<0)throw new Error("Point does not intersect with path");const o=s[0];if(o.distance>n)throw new Error(`Point does not intersect with path. Minimum distance: ${o.distance}, threshold: ${n}`);const a=o.path.relativePosition(r,n);let u=0;for(let c=0;c<o.index;c++)u+=i.lengths[c];u+=i.lengths[o.index]*a;const l=u/i.totalLength;return console.log(`acc: ${u} rel: ${l} on path: ${a} path: ${o.index}`),l},Ki=e=>{const r=e.map(o=>o.bbox().width),n=e.map(o=>o.length());let i=0,s=0;for(const o of n)i+=o;for(const o of r)s+=o;return{totalLength:i,totalWidth:s,widths:r,lengths:n}},Qd=e=>{const n=e.map(i=>i.bbox()).flatMap(i=>rr(i));return S.bbox(...n)},eh=e=>e.map(r=>r.toString()).join(", "),th=e=>{let r=ln.getEnd(e[0]);for(let n=1;n<e.length;n++){const i=ln.getStart(e[n]);if(!S.isEqual(i,r))throw new Error("Path index "+n+" does not start at prior path end. Start: "+i.x+","+i.y+" expected: "+r.x+","+r.y);r=ln.getEnd(e[n])}},rh=e=>e.flatMap(r=>r.toSvgString()),nh=(...e)=>{th(e);const r=Ki(e);return Object.freeze({segments:e,length:()=>r.totalLength,nearest:n=>{throw new Error("not implemented")},interpolate:(n,i=!1)=>Xd(e,n,i,r),relativePosition:(n,i)=>Zd(e,n,i,r),distanceToPoint:n=>Kd(e,n),bbox:()=>Qd(e),toString:()=>eh(e),toSvgString:()=>rh(e),kind:"compound"})},ih={};E(ih,{fromDegrees:()=>g1});var g1=(e,r,n=0,i=0,s=360)=>({radiusX:e,radiusY:r,rotation:tr(n),startAngle:tr(i),endAngle:tr(s)}),sh={};E(sh,{rdpPerpendicularDistance:()=>yo,rdpShortestDistance:()=>ho});var ho=(e,r=.1)=>{const n=e[0],i=e.at(-1);if(e.length<3)return e;let s=-1,o=0;for(let a=1;a<e.length-1;a++){const u=x1(e[a],n,i);u>o&&(o=u,s=a)}if(o>r){const a=e.slice(0,s+1),u=e.slice(s),l=ho(a,r),c=ho(u,r);return[...l.slice(0,-1),...c]}else return[n,i]},yo=(e,r=.1)=>{const n=e[0],i=e.at(-1);if(e.length<3)return e;let s=-1,o=0;for(let a=1;a<e.length-1;a++){const u=w1(e[a],n,i);u>o&&(o=u,s=a)}if(o>r){const a=e.slice(0,s+1),u=e.slice(s),l=yo(a,r),c=yo(u,r);return[...l.slice(0,-1),...c]}else return[n,i]};function w1(e,r,n){let i,s,o;return r.x==n.x?i=Math.abs(e.x-r.x):(s=(n.y-r.y)/(n.x-r.x),o=r.y-s*r.x,i=Math.abs(s*e.x-e.y+o)/Math.sqrt(Math.pow(s,2)+1)),i}var x1=(e,r,n)=>{const i=re(r,n);if(i==0)return re(e,r);const s=((e.x-r.x)*(n.x-r.x)+(e.y-r.y)*(n.y-r.y))/i;return s<0?re(e,r):s>1?re(e,n):re(e,{x:r.x+s*(n.x-r.x),y:r.y+s*(n.y-r.y)})},oh={};E(oh,{Direction:()=>ah,QuadTreeNode:()=>uh,quadTree:()=>b1});var ah=(e=>(e[e.Nw=0]="Nw",e[e.Ne=1]="Ne",e[e.Sw=2]="Sw",e[e.Se=3]="Se",e))(ah||{}),b1=(e,r=[],n={})=>{const i={maxItems:n.maxItems??4,maxLevels:n.maxLevels??4},s=new uh(void 0,e,0,i);for(const o of r)s.add(o);return s},uh=class lh{constructor(r,n,i,s){this.boundary=n,this.level=i,this.opts=s,this.#r=r}#e=[];#t=[];#r;getLengthChildren(){return this.#t.length}*parents(){let r=this;for(;r.#r!==void 0;)yield r.#r,r=r.#r}getParent(){return this.#r}*children(){for(const r of this.#t)yield r}getValue(){return this.#e}getIdentity(){return this}direction(r){return this.#t[r]}add(r){if(!Bd(this.boundary,r))return!1;if(this.#t.length>0){for(const n of this.#t)n.add(r);return!0}if(this.#e.push(r),this.#e.length>this.opts.maxItems&&this.level<this.opts.maxLevels){this.#t.length===0&&this.#n();for(const n of this.#e)for(const i of this.#t)i.add(n);this.#e=[]}return!0}couldHold(r){return lr(this.boundary,r)}#n(){const r=this.boundary.width/2,n=this.boundary.height/2,i=this.boundary.x,s=this.boundary.y,a=pa(i+r,s,i,s,i,s+n,i+r,s+n).map(u=>_t(u,r,n));this.#t=a.map(u=>new lh(this,u,this.level+1,this.opts))}},Ai={};E(Ai,{scaler:()=>E1});var E1=(e="both",r)=>{const n=r??xi;let i=1,s=1,o={x:1,y:1};const a=()=>{switch(e){case"height":return{x:s,y:s};case"width":return{x:i,y:i};case"min":return{x:Math.min(i,s),y:Math.min(i,s)};case"max":return{x:Math.max(i,s),y:Math.max(i,s)};default:return{x:i,y:s}}},u=(d,h,y,v)=>{let m=Number.NaN,g=Number.NaN,x=n.width,F=n.height;if(typeof d=="number")if(m=d,typeof h=="number"){if(g=h,y===void 0)return[m,g,x,F];if(ke(y))x=y.width,F=y.height;else if(typeof y=="number")if(x=y,typeof v=="number")F=v;else throw new TypeError("Missing final height value");else throw new Error("Missing valid output range")}else if(ke(h))x=h.width,F=h.height;else throw new Error("Expected input y or output Rect to follow first number parameter");else if(_(d)){if(m=d.x,g=d.y,h===void 0)return[m,g,x,F];if(ke(h))x=h.width,F=h.height;else if(typeof h=="number")if(x=h,typeof y=="number")F=y;else throw new TypeError("Expected height as third parameter after Point and output width");else throw new TypeError("Expected Rect or width as second parameter when first parameter is a Point")}else throw new Error("Expected input Point or x value as first parameter");return[m,g,x,F]},l=(d,h,y,v)=>{const m=u(d,h,y,v);return f(!0,...m)},c=(d,h,y,v)=>{const m=u(d,h,y,v);return f(!1,...m)},f=(d,h,y,v,m)=>{if(Number.isNaN(v))throw new Error("Output width range missing");if(Number.isNaN(m))throw new Error("Output height range missing");return(v!==i||m!==s)&&(i=v,s=m,o=a()),d?{x:h*o.x,y:y*o.y}:{x:h/o.x,y:y/o.y}};return{rel:c,abs:l,width:n.width,height:n.height}},ch={};E(ch,{boxBlurKernel:()=>F1,convolve:()=>yh,convolveCell:()=>hh,convolveImage:()=>D1,edgeDetectionKernel:()=>C1,gaussianBlur3Kernel:()=>P1,gaussianBlur5Kernel:()=>N1,identityKernel:()=>A1,kernel2dToArray:()=>vh,multiply:()=>_n,rgbReducer:()=>ph,sharpenKernel:()=>S1,unsharpMasking5Kernel:()=>k1});var fh={};E(fh,{accessor:()=>dh});var dh=e=>{const r={rows:e.width,cols:e.height},n=e.data;return(s,o)=>{const a=Xi(r,s,o);if(a===void 0)return;const u=a*4;return{r:n[u],g:n[u+1],b:n[u+2],opacity:n[u+3]}}},_n=(e,r)=>{const n=e.length,i=e[0].length,s=[];for(let o=0;o<n;o++){s[o]=[];for(let a=0;a<i;a++)s[o][a]=e[o][a]*r}return s};function hh(e,r,n,i,s){const o=r.map(a=>{const u=Gr(n,e,a[0],"stop");return u?[a[1],i(u,"undefined")]:[a[1],void 0]});return s(o)}function*D1(e,r){const n={rows:r.width,cols:r.height},i=dh(r);yield*yh(e,n,i,Ur(n),ph)}function*yh(e,r,n,i,s,o){if(!o){const u=e.length,l=e[0].length;o={x:Math.floor(u/2),y:Math.floor(l/2)}}const a=vh(e,o);for(const u of i){const l=hh(u,a,r,n,s);yield[u,l]}}var vh=(e,r)=>{const n=[],i=e.length,s=e[0].length;r||(r={x:Math.floor(i/2),y:Math.floor(s/2)});for(let o=0;o<i;o++)for(let a=0;a<s;a++)n.push([{x:o-r.x,y:a-r.y},e[o][a]]);return n},ph=e=>{let r=0,n=0,i=0;for(const o of e){const a=o[1],u=o[0];a!==void 0&&a.opacity!==0&&u!==0&&(r+=a.r*u,n+=a.g*u,i+=a.b*u)}return{r,g:n,b:i,opacity:255}},A1=[[0,0,0],[0,1,0],[0,0,0]],C1=[[0,-1,0],[-1,4,-1],[0,-1,0]],S1=[[0,-1,0],[-1,5,-1],[0,-1,0]],F1=_n([[1,1,1],[1,1,1],[1,1,1]],1/9),P1=_n([[1,2,1],[2,4,2],[1,2,1]],1/16),N1=_n([[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,16,4],[1,4,6,4,1]],1/256),k1=_n([[1,4,6,4,1],[4,16,24,16,4],[6,24,-476,24,6],[4,16,24,16,4],[1,4,6,4,1]],-1/256),mh={};E(mh,{bbox:()=>bh,distanceCenter:()=>B1,fromDegrees:()=>M1,guard:()=>xa,interpolate:()=>ba,isArc:()=>gh,isEqual:()=>_1,isPositioned:()=>mt,length:()=>xh,point:()=>Ci,toLine:()=>wh,toPath:()=>$1,toSvg:()=>Eh});var gh=e=>e.startRadian!==void 0&&e.endRadian!==void 0,mt=e=>e.x!==void 0&&e.y!==void 0,Ml=Math.PI*2;function M1(e,r,n,i){const s={radius:e,startRadian:tr(r),endRadian:tr(n)};if(_(i)){R(i);const o={...s,x:i.x,y:i.y};return Object.freeze(o)}else return Object.freeze(s)}var wh=e=>Kt.fromPoints(Ci(e,e.startRadian),Ci(e,e.endRadian)),Ci=(e,r,n)=>{if(r>e.endRadian)throw new Error("angleRadian beyond end angle of arc");if(r<e.startRadian)throw new Error("angleRadian beyond start angle of arc");return n===void 0&&(n=mt(e)?e:{x:0,y:0}),{x:Math.cos(r)*e.radius+n.x,y:Math.sin(r)*e.radius+n.y}},xa=e=>{if(e===void 0)throw new Error("Arc is undefined");if(mt(e)&&R(e,"arc"),e.radius===void 0)throw new Error(`Arc radius is undefined (${JSON.stringify(e)})`);if(typeof e.radius!="number")throw new Error("Radius must be a number");if(Number.isNaN(e.radius))throw new Error("Radius is NaN");if(e.radius<=0)throw new Error("Radius must be greater than zero");if(e.startRadian===void 0)throw new Error("Arc is missing 'startRadian' field");if(e.endRadian===void 0)throw new Error("Arc is missing 'startRadian' field");if(Number.isNaN(e.endRadian))throw new Error("Arc endRadian is NaN");if(Number.isNaN(e.startRadian))throw new Error("Arc endRadian is NaN");if(e.startRadian>=e.endRadian)throw new Error("startRadian is expected to be les than endRadian")},ba=(e,r,n)=>(xa(r),Ci(r,r.startRadian+(r.endRadian-r.startRadian)*e,n)),$1=e=>(xa(e),Object.freeze({...e,nearest:r=>{throw new Error("not implemented")},interpolate:r=>ba(r,e),bbox:()=>bh(e),length:()=>xh(e),toSvgString:()=>Eh(e),relativePosition:(r,n)=>{throw new Error("Not implemented")},distanceToPoint:r=>{throw new Error("Not implemented")},kind:"arc"})),xh=e=>Ml*e.radius*((e.startRadian-e.endRadian)/Ml),bh=e=>{if(mt(e)){const r=ba(.5,e),n=wh(e);return va(r,n.a,n.b)}else return{width:e.radius*2,height:e.radius*2}},Eh=(e,r,n,i,s)=>{if(gh(e))return mt(e)?ei(e,e.radius,e.startRadian,e.endRadian,r):_(r)?ei(r,e.radius,e.startRadian,e.endRadian,n):ei({x:0,y:0},e.radius,e.startRadian,e.endRadian);if(n===void 0)throw new Error("startAngle undefined");if(i===void 0)throw new Error("endAngle undefined");if(_(e)){if(typeof r=="number"&&typeof n=="number"&&typeof i=="number")return ei(e,r,n,i,s);throw new TypeError("Expected (point, number, number, number). Missing a number param.")}else throw new Error("Expected (point, number, number, number). Missing first point.")},ei=(e,r,n,i,s)=>{(s===void 0||typeof s!="object")&&(s={});const o=i-n===360,a=Bt(r,i-.01,e),u=Bt(r,n,e),{largeArc:l=!1,sweep:c=!1}=s,f=[`
    M ${a.x} ${a.y}
    A ${r} ${r} 0 ${l?"1":"0"} ${c?"1":"0"} ${u.x} ${u.y},
  `];return o&&f.push("z"),f},B1=(e,r)=>re(e,r),_1=(e,r)=>e.radius!==r.radius?!1:mt(e)&&mt(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):!(!(!mt(e)&&!mt(r))||e.endRadian!==r.endRadian||e.startRadian!==r.startRadian),Si={};E(Si,{clampMagnitude:()=>W1,divide:()=>J1,dotProduct:()=>q1,fromLineCartesian:()=>I1,fromLinePolar:()=>j1,fromPointPolar:()=>Dh,fromRadians:()=>z1,multiply:()=>H1,normalise:()=>L1,quadrantOffsetAngle:()=>V1,subtract:()=>U1,sum:()=>G1,toCartesian:()=>At,toPolar:()=>Tn,toRadians:()=>R1,toString:()=>O1});var T1=Object.freeze({x:0,y:0}),ui=Math.PI*2,Fi=Math.PI,z1=e=>Object.freeze({x:Math.cos(e),y:Math.sin(e)}),R1=e=>Math.atan2(e.y,e.x),Dh=(e,r="",n=T1)=>{e=Te(e,n);let i=Math.atan2(e.y,e.x);return r==="unipolar"&&i<0?i+=ui:r==="bipolar"&&(i>Fi?i-=ui:i<=-Fi&&(i+=ui)),Object.freeze({distance:re(e),angleRadian:i})},I1=e=>Te(e.b,e.a),j1=e=>{qi(e,"line");const r=Te(e.b,e.a);return Dh(r)},Ke=e=>!!oa(e),fr=e=>!!_(e),L1=e=>{if(Ke(e))return Ef(e);if(fr(e))return od(e);throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},V1=e=>e.x>=0&&e.y>=0?0:e.x<0&&e.y>=0||e.x<0&&e.y<0?Fi:ui,Tn=(e,r=cr)=>{if(Ke(e))return e;if(fr(e))return aa(e,r);throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},At=e=>{if(Ke(e))return Sf(e);if(fr(e))return e;throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},O1=(e,r)=>{if(Ke(e))return Cf(e,r);if(fr(e))return bi(e,r);throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},q1=(e,r)=>{if(Ke(e)&&Ke(r))return Df(e,r);if(fr(e)&&fr(r))return Qf(e,r);throw new Error("Expected two polar/Cartesian vectors.")},W1=(e,r=1,n=0)=>{if(Ke(e))return Af(e,r,n);if(fr(e))return ad(e,r,n);throw new Error("Expected either polar or Cartesian vector")},G1=(e,r)=>{const n=Ke(e);e=At(e),r=At(r);const i=Rr(e,r);return n?Tn(i):i},U1=(e,r)=>{const n=Ke(e);e=At(e),r=At(r);const i=Te(e,r);return n?Tn(i):i},H1=(e,r)=>{const n=Ke(e);e=At(e),r=At(r);const i=Ir(e,r);return n?Tn(i):i},J1=(e,r)=>{const n=Ke(e);e=At(e),r=At(r);const i=Ei(e,r);return n?Tn(i):i},Ah={};E(Ah,{circleRings:()=>iE,circleVogelSpiral:()=>nE,sphereFibonacci:()=>sE});var st=(e,r,n,i,s,o)=>Zi(r,n,i,s,o)(e),Zi=(e,r,n,i,s)=>{const o=i??1,a=n??0;return u=>{if(e===r)return o;let l=(u-e)/(r-e);return s!==void 0&&(l=s(l)),l*(o-a)+a}},Y1=(e,r,n,i,s,o)=>{if(s===void 0&&(s=1),i===void 0&&(i=0),r===n)return s;const a=st(e,r,n,i,s,o);return Ne(a,i,s)},X1=(e,r,n=1)=>(U(J(e,"percentage","v")),U(J(r,"percentage","outMin")),U(J(n,"percentage","outMax")),st(e,0,1,r,n)),K1=(e,r,n)=>Ch(r,n)(e),Ch=(e,r)=>n=>(U(J(n,"percentage","v")),st(n,0,1,e,r)),Ea=Math.cos,Da=Math.sin,Z1=Math.asin,Aa=Math.sqrt,Q1=Math.pow,Ca=Math.PI,eE=Math.PI*2,tE=Ca*(3-Aa(5)),rE=(1+Aa(5))/2;function*nE(e,r={}){const n=r.maxPoints??5e3,i=r.density??.95,s=r.rotation??0,o=da(e??{radius:1,x:0,y:0}),a=o.radius;let u=o.radius*st(i,0,1,.3,.01);r.spacing&&(u=r.spacing);let l=0,c=0,f=0;for(;c<n&&l<a;)l=u*c**.5,f=s+c*2*Ca/rE,yield Object.freeze({x:o.x+l*Ea(f),y:o.y+l*Da(f)}),c++}function*iE(e,r={}){const n=r.rings??5,i=da(e??{radius:1,x:0,y:0}),s=1/n,o=r.rotation??0;let a=1;yield Object.freeze({x:i.x,y:i.y});for(let u=s;u<=1;u+=s){const l=Math.round(Ca/Z1(1/(2*a)));for(const c of Gl(0,eE,l+1))yield Object.freeze({x:i.x+u*Ea(c+o)*i.radius,y:i.y+u*Da(c+o)*i.radius});a++}}function*sE(e=100,r=0,n){const i=2/e,s=n??{x:0,y:0,z:0,radius:1};for(let o=0;o<e;o++){const a=o*i-1+i/2,u=Aa(1-Q1(a,2)),l=(o+1)%e*tE+r,c=Ea(l)*u,f=Da(l)*u;yield Object.freeze({x:s.x+c*s.radius,y:s.y+a*s.radius,z:s.z+f*s.radius})}}var nr={};E(nr,{Empty:()=>VE,Equilateral:()=>Ph,Isosceles:()=>kh,Placeholder:()=>OE,Right:()=>Nh,angles:()=>zn,anglesDegrees:()=>JE,apply:()=>GE,area:()=>Fh,barycentricCoord:()=>Th,barycentricToCartestian:()=>oD,bbox:()=>_h,centroid:()=>ns,corners:()=>vo,edges:()=>Qi,equilateralFromVertex:()=>nD,fromFlatArray:()=>sD,fromPoints:()=>Fa,fromRadius:()=>tD,guard:()=>Oe,innerCircle:()=>eD,intersectsPoint:()=>aD,isAcute:()=>ZE,isEmpty:()=>qE,isEqual:()=>HE,isEquilateral:()=>YE,isIsosceles:()=>XE,isOblique:()=>KE,isObtuse:()=>QE,isPlaceholder:()=>WE,isRightAngle:()=>Bh,isTriangle:()=>UE,lengths:()=>Sa,outerCircle:()=>oE,perimeter:()=>Sh,rotate:()=>uD,rotateByVertex:()=>rD,toFlatArray:()=>iD});var Oe=(e,r="t")=>{if(e===void 0)throw new Error("{$name} undefined");R(e.a,r+".a"),R(e.b,r+".b"),R(e.c,r+".c")},Qi=e=>(Oe(e),Ui(e.a,e.b,e.c,e.a)),Sh=e=>(Oe(e),Qi(e).reduce((r,n)=>r+_e(n),0)),Fh=e=>{Oe(e,"t");const r=Qi(e).map(i=>_e(i)),n=(r[0]+r[1]+r[2])/2;return Math.sqrt(n*(n-r[0])*(n-r[1])*(n-r[2]))},oE=e=>{const[r,n,i]=Qi(e).map(a=>_e(a)),s=ns(e);return{radius:r*n*i/Math.sqrt((r+n+i)*(-r+n+i)*(r-n+i)*(r+n-i)),...s}},Ph={};E(Ph,{area:()=>hE,centerFromA:()=>uE,centerFromB:()=>lE,centerFromC:()=>cE,circumcircle:()=>yE,fromCenter:()=>aE,height:()=>fE,incircle:()=>es,perimeter:()=>dE});var $l=Math.PI*4/3,Bl=Math.PI*2/3,It=e=>typeof e=="number"?e:e.length,aE=(e,r,n)=>{r||(r=Object.freeze({x:0,y:0}));const i=It(e)/Math.sqrt(3),s=n??Math.PI*1.5,o={x:i*Math.cos(s)+r.x,y:i*Math.sin(s)+r.y},a={x:i*Math.cos(s+$l)+r.x,y:i*Math.sin(s+$l)+r.y},u={x:i*Math.cos(s+Bl)+r.x,y:i*Math.sin(s+Bl)+r.y};return Object.freeze({a,b:o,c:u})},uE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=It(e),{radius:i}=es(e);return{x:r.x+n/2,y:r.y-i}},lE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const{radius:n}=es(e);return{x:r.x,y:r.y+n*2}},cE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=It(e),{radius:i}=es(e);return{x:r.x-n/2,y:r.y-i}},fE=e=>Math.sqrt(3)/2*It(e),dE=e=>It(e)*3,hE=e=>Math.pow(It(e),2)*Math.sqrt(3)/4,yE=e=>({radius:Math.sqrt(3)/3*It(e)}),es=e=>({radius:Math.sqrt(3)/6*It(e)}),Nh={};E(Nh,{adjacentFromHypotenuse:()=>FE,adjacentFromOpposite:()=>PE,angleAtPointA:()=>xE,angleAtPointB:()=>bE,area:()=>wE,circumcircle:()=>DE,fromA:()=>vE,fromB:()=>pE,fromC:()=>mE,height:()=>ts,hypotenuseFromAdjacent:()=>kE,hypotenuseFromOpposite:()=>NE,hypotenuseSegments:()=>rs,incircle:()=>AE,medians:()=>EE,oppositeFromAdjacent:()=>CE,oppositeFromHypotenuse:()=>SE,perimeter:()=>gE,resolveLengths:()=>qe});var vE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=qe(e),i=rs(e),s=ts(e),o={x:r.x,y:r.y},a={x:r.x+n.hypotenuse,y:r.y},u={x:r.x+i[1],y:r.y-s};return{a:o,b:a,c:u}},pE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=qe(e),i=rs(e),s=ts(e),o={x:r.x,y:r.y},a={x:r.x-n.hypotenuse,y:r.y},u={x:r.x-i[0],y:r.y-s};return{a,b:o,c:u}},mE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=rs(e),i=ts(e),s={x:r.x,y:r.y},o={x:r.x-n[1],y:r.y+i},a={x:r.x+n[0],y:r.y+i};return{a:o,b:a,c:s}},qe=e=>{const r=e.adjacent,n=e.opposite,i=e.hypotenuse;if(r!==void 0&&n!==void 0)return{...e,adjacent:r,opposite:n,hypotenuse:Math.hypot(r,n)};if(r&&i)return{...e,adjacent:r,hypotenuse:i,opposite:i*i-r*r};if(n&&i)return{...e,hypotenuse:i,opposite:n,adjacent:i*i-n*n};if(e.opposite&&e.hypotenuse&&e.adjacent)return e;throw new Error("Missing at least two edges")},ts=e=>{const r=qe(e),n=r.opposite*r.opposite/r.hypotenuse,i=r.adjacent*r.adjacent/r.hypotenuse;return Math.sqrt(n*i)},rs=e=>{const r=qe(e),n=r.opposite*r.opposite/r.hypotenuse,i=r.adjacent*r.adjacent/r.hypotenuse;return[n,i]},gE=e=>{const r=qe(e);return r.adjacent+r.hypotenuse+r.opposite},wE=e=>{const r=qe(e);return r.opposite*r.adjacent/2},xE=e=>{const r=qe(e);return Math.acos((r.adjacent*r.adjacent+r.hypotenuse*r.hypotenuse-r.opposite*r.opposite)/(2*r.adjacent*r.hypotenuse))},bE=e=>{const r=qe(e);return Math.acos((r.opposite*r.opposite+r.hypotenuse*r.hypotenuse-r.adjacent*r.adjacent)/(2*r.opposite*r.hypotenuse))},EE=e=>{const r=qe(e),n=r.adjacent*r.adjacent,i=r.hypotenuse*r.hypotenuse,s=r.opposite*r.opposite;return[Math.sqrt(2*(n+i)-s)/2,Math.sqrt(2*(i+s)-n)/2,Math.sqrt(2*(s+n)-i)/2]},DE=e=>({radius:qe(e).hypotenuse/2}),AE=e=>{const r=qe(e);return{radius:(r.adjacent+r.opposite-r.hypotenuse)/2}},CE=(e,r)=>Math.tan(e)*r,SE=(e,r)=>Math.sin(e)*r,FE=(e,r)=>Math.cos(e)*r,PE=(e,r)=>r/Math.tan(e),NE=(e,r)=>r/Math.sin(e),kE=(e,r)=>r/Math.cos(e),kh={};E(kh,{apexAngle:()=>ME,area:()=>_E,baseAngle:()=>Mh,circumcircle:()=>TE,fromA:()=>IE,fromB:()=>jE,fromC:()=>LE,fromCenter:()=>RE,height:()=>jt,incircle:()=>$h,legHeights:()=>$E,medians:()=>zE,perimeter:()=>BE});var Mh=e=>Math.acos(e.base/(2*e.legs)),ME=e=>{const r=e.legs*e.legs,n=e.base*e.base;return Math.acos((2*r-n)/(2*r))},jt=e=>{const r=e.legs*e.legs,n=e.base*e.base;return Math.sqrt((4*r-n)/4)},$E=e=>{const r=Mh(e);return e.base*Math.sin(r)},BE=e=>2*e.legs+e.base,_E=e=>jt(e)*e.base/2,TE=e=>{const r=jt(e),n=r*r,i=e.base*e.base;return{radius:(4*n+i)/(8*r)}},$h=e=>{const r=jt(e);return{radius:e.base*r/(2*e.legs+e.base)}},zE=e=>{const r=e.legs*e.legs,n=e.base*e.base,i=Math.sqrt(r+2*n)/2,s=Math.sqrt(4*r-n)/2;return[i,i,s]},RE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=jt(e),i=$h(e).radius,s=n-i,o={x:r.x-e.base/2,y:r.y+i},a={x:r.x+e.base/2,y:r.y+i},u={x:r.x,y:r.y-s};return{a:o,b:a,c:u}},IE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=jt(e),i={x:r.x,y:r.y},s={x:r.x+e.base,y:r.y},o={x:r.x+e.base/2,y:r.y-n};return{a:i,b:s,c:o}},jE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=jt(e),i={x:r.x,y:r.y},s={x:r.x-e.base,y:r.y},o={x:r.x-e.base/2,y:r.y-n};return{a:s,b:i,c:o}},LE=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=jt(e),i={x:r.x,y:r.y},s={x:r.x-e.base/2,y:r.y+n},o={x:r.x+e.base/2,y:r.y+n};return{a:s,b:o,c:i}},_l=Math.PI*2,VE=Object.freeze({a:{x:0,y:0},b:{x:0,y:0},c:{x:0,y:0}}),OE=Object.freeze({a:{x:Number.NaN,y:Number.NaN},b:{x:Number.NaN,y:Number.NaN},c:{x:Number.NaN,y:Number.NaN}}),qE=e=>Fr(e.a)&&Fr(e.b)&&Fr(e.c),WE=e=>Pr(e.a)&&Pr(e.b)&&Pr(e.c),GE=(e,r)=>Object.freeze({...e,a:r(e.a,"a"),b:r(e.b,"b"),c:r(e.c,"c")}),UE=e=>{if(e===void 0)return!1;const r=e;return!(!_(r.a)||!_(r.b)||!_(r.c))},HE=(e,r)=>wt(e.a,r.a)&&wt(e.b,r.b)&&wt(e.c,r.c),vo=e=>(Oe(e),[e.a,e.b,e.c]),Sa=e=>(Oe(e),[re(e.a,e.b),re(e.b,e.c),re(e.c,e.a)]),zn=e=>(Oe(e),[kr(e.a,e.b),kr(e.b,e.c),kr(e.c,e.a)]),JE=e=>(Oe(e),sa(zn(e))),YE=e=>{Oe(e);const[r,n,i]=Sa(e);return r===n&&n===i},XE=e=>{const[r,n,i]=Sa(e);return r===n||n===i||i===r},Bh=e=>zn(e).includes(Math.PI/2),KE=e=>!Bh(e),ZE=e=>!zn(e).some(r=>r>=Math.PI/2),QE=e=>zn(e).some(r=>r>Math.PI/2),ns=e=>{Oe(e);const r=id([e.a,e.b,e.c],(i,s)=>({x:i.x+s.x,y:i.y+s.y}));return{x:r.x/3,y:r.y/3}},eD=e=>{const r=ns(e),n=Sh(e)/2;return{radius:Fh(e)/n,...r}},tD=(e,r,n={})=>{P(r,"positive","radius"),R(e,"origin");const i=n.initialAngleRadian??0,o=[i,i+_l*1/3,i+_l*2/3].map(a=>Bt(r,a,e));return Fa(o)},rD=(e,r,n="b")=>{const i=n==="a"?e.a:n==="b"?e.b:e.c;return Object.freeze({a:xt(e.a,r,i),b:xt(e.b,r,i),c:xt(e.c,r,i)})},nD=(e,r=10,n=Math.PI/2)=>{e||(e=Object.freeze({x:0,y:0}));const i=lo(e,r,Math.PI- -n/2),s=lo(e,r,Math.PI-n/2);return{a:i,b:e,c:s}},iD=e=>(Oe(e),[e.a.x,e.a.y,e.b.x,e.b.y,e.c.x,e.c.y]),sD=e=>{if(!Array.isArray(e))throw new Error("coords expected as array");if(e.length!==6)throw new Error(`coords array expected with 6 elements. Got ${e.length}`);return Fa(pa(...e))},Fa=e=>{if(!Array.isArray(e))throw new Error("points expected as array");if(e.length!==3)throw new Error(`points array expected with 3 elements. Got ${e.length}`);return{a:e[0],b:e[1],c:e[2]}},_h=(e,r=0)=>{const{a:n,b:i,c:s}=e,o=Math.min(n.x,i.x,s.x)-r,a=Math.max(n.x,i.x,s.x)+r,u=Math.min(n.y,i.y,s.y)-r,l=Math.max(n.y,i.y,s.y)+r;return{x:o,y:u,width:a-o,height:l-u}},Th=(e,r,n)=>{const i=Ae(r,n),s=(l,c,f,d)=>(f.y-d.y)*l+(d.x-f.x)*c+f.x*d.y-d.x*f.y,o=s(i.x,i.y,e.b,e.c)/s(e.a.x,e.a.y,e.b,e.c),a=s(i.x,i.y,e.c,e.a)/s(e.b.x,e.b.y,e.c,e.a),u=s(i.x,i.y,e.a,e.b)/s(e.c.x,e.c.y,e.a,e.b);return{a:o,b:a,c:u}},oD=(e,r)=>{Oe(e);const{a:n,b:i,c:s}=e,o=n.x*r.a+i.x*r.b+s.x*r.c,a=n.y*r.a+i.y*r.b+s.y*r.c;if(n.z&&i.z&&s.z){const u=n.z*r.a+i.z*r.b+s.z*r.c;return Object.freeze({x:o,y:a,z:u})}else return Object.freeze({x:o,y:a})},aD=(e,r,n)=>{const i=_h(e),s=Ae(r,n);if(!lr(i,s))return!1;const o=Th(e,s);return 0<=o.a&&o.a<=1&&0<=o.b&&o.b<=1&&0<=o.c&&o.c<=1},uD=(e,r,n)=>r===void 0||r===0?e:(n===void 0&&(n=ns(e)),Object.freeze({...e,a:xt(e.a,r,n),b:xt(e.b,r,n),c:xt(e.c,r,n)})),Pa={};E(Pa,{Elements:()=>Pi,applyOpts:()=>St,applyPathOpts:()=>ka,applyStrokeOpts:()=>Lt,clear:()=>fD,createEl:()=>is,createOrResolve:()=>Ct,getBounds:()=>dD,makeHelper:()=>yD,remove:()=>Uh,setBounds:()=>hD});var lD=(e,r,n)=>{const i=is("marker",e);if(r.markerWidth&&i.setAttribute("markerWidth",r.markerWidth?.toString()),r.markerHeight&&i.setAttribute("markerHeight",r.markerHeight?.toString()),r.orient?i.setAttribute("orient",r.orient.toString()):i.setAttribute("orient","auto-start-reverse"),r.viewBox&&i.setAttribute("viewBox",r.viewBox.toString()),r.refX&&i.setAttribute("refX",r.refX.toString()),r.refY&&i.setAttribute("refY",r.refY.toString()),n){const s=n();i.appendChild(s)}return i},Os=(e,r,n)=>{if(e===null)return"(elem null)";const i=e.ownerSVGElement;if(i===null)throw new Error("parent for elem is null");const s=Ct(i,"defs","defs");let o=s.querySelector(`#${r.id}`);if(o!==null)return`url(#${r.id})`;if(r.id==="triangle")r={...r,strokeStyle:"transparent"},r.markerHeight||(r={...r,markerHeight:6}),r.markerWidth||(r={...r,markerWidth:6}),r.refX||(r={...r,refX:r.markerWidth}),r.refY||(r={...r,refY:r.markerHeight}),(!r.fillStyle||r.fillStyle==="none")&&(r={...r,fillStyle:"black"}),r.viewBox||(r={...r,viewBox:"0 0 10 10"}),o=lD(r.id,r,()=>{const a=is("path");return a.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),r&&St(a,r),a});else throw new Error(`Do not know how to make ${r.id}`);return o.id=r.id,s.appendChild(o),`url(#${r.id})`},Pi={};E(Pi,{circle:()=>jh,circleUpdate:()=>Ih,grid:()=>Gh,group:()=>cD,groupUpdate:()=>Lh,line:()=>Ni,lineUpdate:()=>Vh,path:()=>zh,pathUpdate:()=>Rh,text:()=>Wh,textPath:()=>qh,textPathUpdate:()=>Oh,textUpdate:()=>Na});var Tl=e=>e>=0&&e<=1?e*100+"%":e.toString(),zh=(e,r,n,i)=>{const s=Ct(r,"path",i),o=typeof e=="string"?e:e.join(`
`);return s.setAttributeNS(null,"d",o),r.append(s),Rh(s,n)},Rh=(e,r)=>(r&&St(e,r),r&&Lt(e,r),e),Ih=(e,r,n)=>(e.setAttributeNS(null,"cx",r.x.toString()),e.setAttributeNS(null,"cy",r.y.toString()),e.setAttributeNS(null,"r",r.radius.toString()),n&&St(e,n),n&&Lt(e,n),e),jh=(e,r,n,i)=>{const s=Ct(r,"circle",i);return Ih(s,e,n)},cD=(e,r,n)=>{const i=Ct(r,"g",n);return Lh(i,e)},Lh=(e,r)=>{for(const n of r)n.parentNode!==e&&e.append(n);return e},Ni=(e,r,n,i)=>{const s=Ct(r,"line",i);return Vh(s,e,n)},Vh=(e,r,n)=>(e.setAttributeNS(null,"x1",r.a.x.toString()),e.setAttributeNS(null,"y1",r.a.y.toString()),e.setAttributeNS(null,"x2",r.b.x.toString()),e.setAttributeNS(null,"y2",r.b.y.toString()),n&&St(e,n),n&&ka(e,n),n&&Lt(e,n),e),Oh=(e,r,n)=>(n?.method&&e.setAttributeNS(null,"method",n.method),n?.side&&e.setAttributeNS(null,"side",n.side),n?.spacing&&e.setAttributeNS(null,"spacing",n.spacing),n?.startOffset&&e.setAttributeNS(null,"startOffset",Tl(n.startOffset)),n?.textLength&&e.setAttributeNS(null,"textLength",Tl(n.textLength)),r&&(e.textContent=r),n&&St(e,n),n&&Lt(e,n),e),qh=(e,r,n,i,s,o)=>{const a=Ct(n,"text",s,"-text");Na(a,void 0,void 0,i);const u=Ct(a,"textPath",o);return u.setAttributeNS(null,"href",e),Oh(u,r,i)},Na=(e,r,n,i)=>(r&&(e.setAttributeNS(null,"x",r.x.toString()),e.setAttributeNS(null,"y",r.y.toString())),n&&(e.textContent=n),i&&(St(e,i),i&&Lt(e,i),i.anchor&&e.setAttributeNS(null,"text-anchor",i.anchor),i.align&&e.setAttributeNS(null,"alignment-baseline",i.align),(i.userSelect??!0)||(e.style.userSelect="none",e.style.webkitUserSelect="none")),e),Wh=(e,r,n,i,s)=>{const o=Ct(r,"text",s);return Na(o,n,e,i)},Gh=(e,r,n,i,s,o={})=>{o.strokeStyle||(o={...o,strokeStyle:lc("bg-dim","silver")}),o.strokeWidth||(o={...o,strokeWidth:1});const a=is("g");St(a,o),ka(a,o),Lt(a,o);let u=0;for(;u<s;){const c=Di(0,u,i,u);Ni(c,a),u+=n}let l=0;for(;l<i;){const c=Di(l,0,l,s);Ni(c,a),l+=n}return e.append(a),a},Ct=(e,r,n,i)=>{let s=null;if(n!==void 0&&(s=typeof n=="string"?e.querySelector(n):n),s===null){const o=document.createElementNS("http://www.w3.org/2000/svg",r);return e.append(o),n&&typeof n=="string"&&n.startsWith("#")&&(o.id=i!==void 0&&!n.endsWith(i)?n.slice(1)+i:n.slice(1)),o}return s},Uh=(e,r)=>{if(typeof r=="string"){const n=e.querySelector(r);if(n===null)return;n.remove()}else r.remove()},fD=e=>{let r=e.lastElementChild;for(;r;)r.remove(),r=e.lastElementChild},is=(e,r)=>{const n=document.createElementNS("http://www.w3.org/2000/svg",e);return r&&(n.id=r),n},ka=(e,r)=>{r.markerEnd&&e.setAttribute("marker-end",Os(e,r.markerEnd)),r.markerStart&&e.setAttribute("marker-start",Os(e,r.markerStart)),r.markerMid&&e.setAttribute("marker-mid",Os(e,r.markerMid))},St=(e,r)=>{r.fillStyle&&e.setAttributeNS(null,"fill",r.fillStyle),r.opacity&&e.setAttributeNS(null,"opacity",r.opacity.toString())},Lt=(e,r)=>{r.strokeStyle&&e.setAttributeNS(null,"stroke",r.strokeStyle),r.strokeWidth&&e.setAttributeNS(null,"stroke-width",r.strokeWidth.toString()),r.strokeDash&&e.setAttribute("stroke-dasharray",r.strokeDash),r.strokeLineCap&&e.setAttribute("stroke-linecap",r.strokeLineCap)},dD=e=>{const r=e.getAttributeNS(null,"width"),n=r===null?0:Number.parseFloat(r),i=e.getAttributeNS(null,"height"),s=i===null?0:Number.parseFloat(i);return{width:n,height:s}},hD=(e,r)=>{e.setAttributeNS(null,"width",r.width.toString()),e.setAttributeNS(null,"height",r.height.toString())},yD=(e,r)=>(r&&(St(e,r),Lt(e,r)),{remove:i=>{Uh(e,i)},text:(i,s,o,a)=>Wh(i,e,s,o,a),textPath:(i,s,o,a,u)=>qh(i,s,e,o,a,u),line:(i,s,o)=>Ni(i,e,s,o),circle:(i,s,o)=>jh(i,e,s,o),path:(i,s,o)=>zh(i,e,s,o),grid:(i,s,o,a,u)=>Gh(e,i,s,o,a,u),query:i=>e.querySelector(i),get width(){const i=e.getAttributeNS(null,"width");return i===null?0:Number.parseFloat(i)},set width(i){e.setAttributeNS(null,"width",i.toString())},get parent(){return e},get height(){const i=e.getAttributeNS(null,"height");return i===null?0:Number.parseFloat(i)},set height(i){e.setAttributeNS(null,"height",i.toString())},clear:()=>{for(;e.firstChild;)e.lastChild.remove()}}),Hh=(e,r)=>(n,i)=>{let s=e.get(n);return s!==void 0||(s=r(n,i),e.set(n,s)),s},Jh=(e,r)=>async(n,i)=>{let s=e.get(n);if(s!==void 0)return s;if(s=await r(n,i),s===void 0)throw new Error("fn returned undefined");return e.set(n,s),s},Ma=class{seenCount;storeIntermediate;resetAfterSamples;sampleLimit;id;debug;constructor(e={}){this.id=e.id??"tracker",this.debug=e.debug??!1,this.sampleLimit=e.sampleLimit??-1,this.resetAfterSamples=e.resetAfterSamples??-1,this.storeIntermediate=e.storeIntermediate??(this.sampleLimit>-1||this.resetAfterSamples>-1),this.seenCount=0,this.debug&&console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`)}reset(){this.seenCount=0,this.onReset()}seen(...e){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples?this.reset():this.sampleLimit>0&&this.seenCount>this.sampleLimit*2&&(this.seenCount=this.trimStore(this.sampleLimit),this.onTrimmed()),this.seenCount+=e.length;const r=this.filterData(e);return this.computeResults(r)}},Yh=class{store;gog;constructor(e){this.store=new Map,this.gog=Jh(this.store,e)}get size(){return this.store.size}has(e){return this.store.has(e)}async seen(e,...r){return(await this.getTrackedValue(e,...r)).seen(...r)}async getTrackedValue(e,...r){if(e===null)throw new Error("id parameter cannot be null");if(e===void 0)throw new Error("id parameter cannot be undefined");return await this.gog(e,r[0])}delete(e){this.store.delete(e)}reset(){this.store=new Map}*ids(){yield*this.store.keys()}*tracked(){yield*this.store.values()}*trackedByAge(){const e=[...this.store.values()];e.sort((r,n)=>{const i=r.elapsed,s=n.elapsed;return i===s?0:i>s?-1:1});for(const r of e)yield r}*valuesByAge(){for(const e of this.trackedByAge())yield e.last}*last(){for(const e of this.store.values())yield e.last}*initialValues(){for(const e of this.store.values())yield e.initial}get(e){return this.store.get(e)}},Xh=class extends Ma{values;timestamps;constructor(e){super(e),this.values=[],this.timestamps=[]}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.timestamps=this.timestamps.slice(-e),this.values.length)}onTrimmed(){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw new Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(e){const n={value:e.at(-1),at:performance.now()},i=e.map(s=>({at:performance.now(),value:s}));if(this.storeIntermediate)this.values.push(...e),this.timestamps.push(...i.map(s=>s.at));else switch(this.values.length){case 0:{this.values.push(n.value),this.timestamps.push(n.at);break}case 2:{this.values[1]=n.value,this.timestamps[1]=n.at;break}case 1:{this.values.push(n.value),this.timestamps.push(n.at);break}}return i}},$a=class extends Xh{total=0;min=Number.MAX_SAFE_INTEGER;max=Number.MIN_SAFE_INTEGER;constructor(e){super(e)}get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.total=0,super.onReset()}onTrimmed(){this.min=na(this.values),this.max=lf(this.values),this.total=cf(this.values)}computeResults(e){if(e.some(i=>Number.isNaN(i)))throw new Error("Cannot add NaN");const r=e.map(i=>i.value);return this.total=r.reduce((i,s)=>i+s,this.total),this.min=Math.min(...r,this.min),this.max=Math.max(...r,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}},cn=(e={})=>new $a(e),vD=(e,r,n)=>{const i=r.length+n.length,s=e.capacity??i,o=i-s,a=e.discardPolicy??"additions";switch(a){case"additions":return r.length===0?n.slice(0,n.length-o):r.length===e.capacity?r:[...r,...n.slice(0,o-1)];case"newer":{if(o>=r.length)return r.length===0?[...n.slice(0,s-1),n.at(-1)]:n.slice(Math.max(0,n.length-s),Math.min(n.length,s)+1);{const u=Math.max(1,n.length-r.length),l=n.slice(n.length-u,n.length);return[...r.slice(0,Math.min(r.length,s-1)),...l]}}case"older":return[...r,...n].slice(o);default:throw new Error(`Unknown overflow policy ${a}`)}},Kh=(e,r,...n)=>{if(e===void 0)throw new Error("opts parameter undefined");const i=r.length+n.length,s=e.capacity&&i>e.capacity,o=s?vD(e,r,n):[...r,...n];if(e.capacity&&o.length!==e.capacity&&s)throw new Error(`Bug! Expected return to be at capacity. Return len: ${o.length} capacity: ${e.capacity} opts: ${JSON.stringify(e)}`);if(!e.capacity&&o.length!==i)throw new Error(`Bug! Return length not expected. Return len: ${o.length} expected: ${i} opts: ${JSON.stringify(e)}`);return o},Zh=(e,r)=>{if(r.length===0)throw new Error("Queue is empty");return r.slice(1)},po=(e,r)=>r[0],Qh=(e,r)=>r.length===0,e0=(e,r)=>e.capacity?r.length>=e.capacity:!1,Re=class{opts;data;eq;constructor(e={},r=[]){if(e===void 0)throw new Error("opts parameter undefined");this.opts=e,this.data=r,this.eq=e.eq??G}clear(){this.data=[]}at(e){if(e>=this.data.length)throw new Error("Index outside bounds of queue");const r=this.data.at(e);if(r===void 0)throw new Error("Index appears to be outside range of queue");return r}toArray(){return[...this.data]}enqueue(...e){return this.data=Kh(this.opts,this.data,...e),this.data.length}dequeue(){const e=po(this.opts,this.data);if(e!==void 0)return this.data=Zh(this.opts,this.data),e}remove(e,r){const n=this.data.length;return this.data=Mn(this.data,e,r??this.eq),this.data.length!==n}removeWhere(e){const r=this.data.length;return this.data=this.data.filter(n=>e(n)),r-this.data.length}get isEmpty(){return Qh(this.opts,this.data)}get isFull(){return e0(this.opts,this.data)}get length(){return this.data.length}get peek(){return po(this.opts,this.data)}};function t0(e={},...r){return new Re({...e},[...r])}var br=(e,r="log",n)=>i=>{i===void 0?i="(undefined)":typeof i=="object"&&(i=JSON.stringify(i));const s=n??e;switch(r){case"log":{console.log(`%c${e} ${i}`,`color: ${n0(s)}`);break}case"warn":{console.warn(e,i);break}case"error":{console.error(e,i);break}}},r0=(e,r=!0,n)=>r?{log:br(e,"log",n),warn:br(e,"warn",n),error:br(e,"error",n)}:{log:i=>{},warn:br(e,"warn",n),error:br(e,"error",n)},Ba=(e,r={})=>{if(e===void 0||typeof e=="boolean"&&!e)return s=>{};const n=r.category??"",i=r.kind??void 0;return typeof e=="boolean"?s=>{const o=typeof s=="string"?{msg:s}:s,a=o.kind??i,u=o.category??n;let l=o.msg;switch(u&&(l=`[${u}] ${l}`),a){case"error":{console.error(l);break}case"warn":{console.warn(l);break}case"info":{console.info(l);break}default:console.log(l)}}:e},pD=0,n0=Hh(new Map,()=>`hsl(${++pD*137.508},50%,75%)`),je=e=>typeof e=="string"?e:e instanceof Error?e.message:e,xe={};E(xe,{WithEvents:()=>ss,cloneState:()=>mo,done:()=>wo,driver:()=>gD,fromList:()=>RD,fromListBidirectional:()=>ID,init:()=>os,isValidTransition:()=>E0,next:()=>b0,normaliseTargets:()=>w0,possible:()=>gn,possibleTargets:()=>ja,reset:()=>go,to:()=>wn,validateMachine:()=>g0,validateTransition:()=>as});var mD=async(e,r={},n)=>{const i=[],s=r.rank??Vr;let o=Array.isArray(e)?e:[e];r.shuffle&&(o=pn(o));for(let a=0;a<o.length;a++){const u=o[a];let l;if(typeof u=="function"?l=await u(n):l=u,l!==void 0&&(i.push(l),i.sort(s)),typeof r.stop<"u"&&r.stop(l,i))break}return r.filter?i.filter(r.filter):i};async function gD(e,r){const n=Array.isArray(r)?{handlers:r}:r,i=Ba(n.debug,{category:"StateMachineDriver"}),s=new Map;for(const l of n.handlers){const c=Array.isArray(l.if)?l.if:[l.if];for(const f of c){if(typeof f!="string")throw new TypeError(`Expected single or array of strings for the 'if' field. Got: '${typeof f}'.`);if(s.has(f))throw new Error(`Multiple handlers defined for state '${f}'. There should be at most one.`);s.set(f,l)}}const o={rank:(l,c)=>Vr(l.score??0,c.score??0),shuffle:n.shuffleHandlers??!1};let a=os(e);for(const[l]of s)if(typeof a.machine[l]>"u"&&l!=="__fallback")throw new Error(`StateMachineDriver handler references a state ('${l}') which is not defined on the machine. Therefore this handler will never run.'`);return{reset:()=>{a=go(a)},getValue:()=>a.value,run:async()=>{i(`Run. State: ${a.value}`);const l=a.value;let c=s.get(l);if(c===void 0&&(i(`  No handler for state '${l}', trying __fallback`),c=s.get("__fallback")),c===void 0){i("  No __fallback handler");return}const f=c.resultChoice==="first"?{...o,stop:y=>y?"reset"in y||"next"in y&&y.next!==void 0:!1}:o,d=await mD(c.then,f,a);i(`  In state '${a.value}' results: ${d.length}. Choice: ${c.resultChoice}`);let h;switch(c.resultChoice??"highest"){case"highest":{h=d.at(-1);break}case"first":{h=d[0];break}case"lowest":{h=d.at(0);break}case"random":{h=Oi(d);break}default:throw new Error(`Unknown 'resultChoice' option: ${c.resultChoice}. Expected highest, first, lowest or random`)}return i(`  Chosen result: ${JSON.stringify(h)}`),h?.reset?a=go(a):h&&h.next&&(typeof h.next=="boolean"?a=b0(a):(i(JSON.stringify(d)),a=wn(a,h.next))),a},to:l=>(a=wn(a,l),a)}}var wD={};E(wD,{DispatchList:()=>l0,Elapsed:()=>bt,RequestResponseMatch:()=>kD,StateMachine:()=>xe,TaskQueue:()=>MD,backoffGenerator:()=>d0,continuously:()=>vr,debounce:()=>AD,delay:()=>SD,delayLoop:()=>f0,everyNth:()=>PD,forEach:()=>p0,forEachAsync:()=>m0,frequencyTimer:()=>Ft,frequencyTimerSource:()=>o0,hasElapsed:()=>s0,interval:()=>c0,intervalToMs:()=>V,isInterval:()=>hc,msElapsedTimer:()=>ut,relativeTimer:()=>Rn,repeat:()=>v0,repeatAwait:()=>y0,retryFunction:()=>Ra,retryTask:()=>Ia,runOnce:()=>ND,sleep:()=>de,sleepWhile:()=>vw,throttle:()=>CD,ticksElapsedTimer:()=>_a,timeout:()=>In,updateOutdated:()=>DD,waitFor:()=>za});var i0={};E(i0,{frequencyTimer:()=>Ft,frequencyTimerSource:()=>o0,hasElapsed:()=>s0,msElapsedTimer:()=>ut,relativeTimer:()=>Rn,ticksElapsedTimer:()=>_a});function s0(e){const r=Rn(V(e,0),{timer:ut()});return()=>r.isDone}var o0=e=>()=>Ft(e,{timer:ut()}),Rn=(e,r={})=>{const n=r.clampValue??!1,i=r.wrapValue??!1;if(n&&i)throw new Error("clampValue and wrapValue cannot both be enabled");let s=1;const o=r.timer??ut(),a=()=>{let u=o.elapsed/(e*s);return n?u=Ne(u):i&&u>=1&&(u=u%1),u};return{mod(u){s=u},get isDone(){return a()>=1},get elapsed(){return a()},reset:()=>{o.reset()}}},Ft=(e,r={})=>{const n=r.timer??ut(),i=e/1e3;let s=1;const o=()=>{const a=n.elapsed*(i*s),u=a-Math.floor(a);if(u<0)throw new Error(`Unexpected cycle fraction less than 0. Elapsed: ${a} f: ${u}`);if(u>1)throw new Error(`Unexpected cycle fraction more than 1. Elapsed: ${a} f: ${u}`);return u};return{mod:a=>{s=a},reset:()=>{n.reset()},get isDone(){return o()>=1},get elapsed(){return o()}}},ut=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e}}},_a=()=>{let e=0;return{reset:()=>{e=0},get elapsed(){return++e}}},bt={};E(bt,{infinity:()=>ED,interval:()=>xD,once:()=>bD,progress:()=>u0,since:()=>a0,toString:()=>Ta});var a0=()=>{const e=performance.now();return()=>performance.now()-e},xD=()=>{let e=performance.now();return()=>{const r=performance.now(),n=r-e;return e=r,n}},bD=()=>{const e=Date.now();let r=0;return()=>(r===0&&(r=Date.now()-e),r)},ED=()=>()=>Number.POSITIVE_INFINITY;function u0(e,r={}){const n=V(e);if(!n)throw new Error("duration invalid");const i={...r,timer:ut()},s=Rn(n,i);return()=>s.elapsed}var Ta=(e,r=2)=>{let n=0;if(typeof e=="function"){const s=e();return Ta(s)}else typeof e=="number"?n=e:typeof e=="object"&&(n=V(n));let i=V(n);return typeof i>"u"?"(undefined)":i<1e3?`${or(r,i)}ms`:(i/=1e3,i<120?`${i.toFixed(1)}secs`:(i/=60,i<60?`${i.toFixed(2)}mins`:(i/=60,`${i.toFixed(2)}hrs`)))},l0=class{#e;#t=0;#r=Math.floor(Math.random()*100);constructor(){this.#e=[]}isEmpty(){return this.#e.length===0}add(e,r={}){this.#t++;const n=r.once??!1,i={id:this.#r+"-"+this.#t,handler:e,once:n};return this.#e.push(i),i.id}remove(e){const r=this.#e.length;return this.#e=this.#e.filter(n=>n.id!==e),this.#e.length!==r}notify(e){for(const r of this.#e)r.handler(e),r.once&&this.remove(r.id)}clear(){this.#e=[]}},c0=async function*(e,r={}){let n=!1;const i=typeof r=="number"?{fixed:r}:r,s=i.signal,o=i.delay??"before";let a=V(i.fixed)??V(i.minimum,0),u=performance.now();const l=i.minimum?V(i.minimum):void 0,c=async()=>{const d=performance.now()-u;if(typeof l<"u"&&(a=Math.max(0,l-d)),a&&await de({millis:a,signal:s}),u=performance.now(),s?.aborted)throw new Error(`Signal aborted ${s.reason}`)};Array.isArray(e)&&(e=e.values());const f=typeof e=="object"&&"next"in e&&typeof e.next=="function";try{for(;!n;){if(o==="before"&&await c(),typeof e=="function"){const d=await e();if(typeof d>"u")return;yield d}else if(f){const d=await e.next();if(d.done)return;yield d.value}else throw new Error("produce param does not seem to return a value/Promise and is not a generator?");o==="after"&&await c()}}finally{n=!0}},In=(e,r)=>{if(e===void 0)throw new Error("callback parameter is undefined");const n=V(r);le(n,"aboveZero","interval");let i,s=0,o=0,a="idle";const u=()=>{s=0,globalThis.clearTimeout(i),a="idle"},l=async(f=r,d)=>new Promise((y,v)=>{s=performance.now();const m=V(f),g=Tt(m,"aboveZero","altTimeoutMs");if(!g[0]){v(new Error(g[1]));return}switch(a){case"scheduled":{c();break}}a="scheduled",i=globalThis.setTimeout(async()=>{if(a!=="scheduled"){console.warn("Timeout skipping execution since state is not 'scheduled'"),u();return}const x=d??[];o++,a="running",await e(performance.now()-s,...x),a="idle",u(),y()},m)}),c=()=>{a!=="idle"&&u()};return{start:l,cancel:c,get runState(){return a},get startCount(){return o}}},DD=(e,r,n="slow")=>{let i=0,s,o=r;return()=>new Promise(async(a,u)=>{const l=performance.now()-i;if(s===void 0||l>o)try{i=performance.now(),s=await e(l),o=r}catch(c){n==="fast"?(s=void 0,i=0):n==="backoff"&&(o=Math.floor(o*1.2)),u(c);return}a(s)})},vr=(e,r,n={})=>{let i=V(r,0);le(i,"positive","interval"),n.signal;const s=n.fireBeforeWait??!1,o=n.onStartCalled;let a=!1,u="idle",l=0,c=0,f=performance.now(),d=r??0,h=!1,y;const v=()=>{y!==void 0&&(globalThis.clearTimeout(y),y=void 0)},m=j=>{i===0?typeof requestAnimationFrame>"u"?y=globalThis.setTimeout(j,0):(y=void 0,requestAnimationFrame(j)):y=globalThis.setTimeout(j,i)},g=()=>{h||(h=!0,u!=="idle"&&(u="idle",c=0,v()))},x=async()=>{if(n.signal?.aborted&&(u="idle"),u==="idle")return;u="running",l++;const j=e(c++,performance.now()-f),A=typeof j=="object"?await j:j;if(!h){if(u="scheduled",A!==void 0&&!A){g();return}h||m(x)}},F=()=>{if(a)throw new Error("Disposed");if(h=!1,o!==void 0)switch(o(c,performance.now()-f)){case"cancel":{g();return}case"reset":{M();return}case"dispose":{a=!0,g();return}}u==="idle"&&(f=performance.now(),u="scheduled",s?x():m(x))},M=()=>{if(a)throw new Error("Disposed");h=!1,u!=="idle"&&g(),F()};return{start:F,reset:M,cancel:g,get interval(){return d},get runState(){return u},get startCount(){return l},set interval(j){const A=V(j,0);le(A,"positive","interval"),i=A,d=j},get isDisposed(){return a},get elapsedMs(){return performance.now()-f}}},AD=(e,r)=>{const n=In(e,r);return(...i)=>{n.start(void 0,i)}},CD=(e,r)=>{let n=0;return async(...i)=>{const s=performance.now()-n;if(s>=r){const o=e(s,...i);typeof o=="object"&&await o,n=performance.now()}}},za=(e,r,n)=>{let i,s=!1;const o=a=>{i!==void 0&&(window.clearTimeout(i),i=void 0),a?r(a):s=!0,n!==void 0&&n(s)};return i=globalThis.setTimeout(()=>{i=void 0;try{r(`Timeout after ${e}ms`)}finally{n!==void 0&&n(s)}},e),o},SD=async(e,r)=>{const n=typeof r=="number"?{millis:r}:r,i=n.delay??"before";(i==="before"||i==="both")&&await de(n);const s=Promise.resolve(await e());return(i==="after"||i==="both")&&await de(n),s};async function*FD(){let e,r=new Promise(s=>e=s),n=0;const i=()=>{e&&e(),r=new Promise(s=>e=s)};try{for(;;)n=globalThis.requestAnimationFrame(i),yield await r}finally{e&&e(),globalThis.cancelAnimationFrame(n)}}async function*f0(e){const r=V(e);if(typeof r>"u")throw new Error("timeout is undefined");if(r<0)throw new Error("Timeout is less than zero");if(r===0)return yield*FD();let n,i=new Promise(a=>n=a),s;const o=()=>{n&&n(),i=new Promise(a=>n=a)};try{for(;;)s=globalThis.setTimeout(o,r),yield await i}finally{n&&n(),s!==void 0&&globalThis.clearTimeout(s),s=void 0}}var PD=(e,r)=>{le(e,"positive","nth");let n=0;return(...i)=>++n===e?(n=0,r&&r(...i),!0):!1},ND=e=>{let r=!1,n=!1;return()=>(r||(r=!0,n=e()),n)};function*d0(e={}){const r=e.startAt??1;let n=e.limitAttempts??Number.MAX_SAFE_INTEGER;const i=e.limitValue,s=e.power??1.1;let o=r;for(le(n,"aboveZero","limitAttempts"),P(r,"","startAt"),P(n,"","limitAttempts"),i!==void 0&&P(i,"","limitValue"),P(s,"","power");n>0;){if(i&&o>=i)return;n--,yield o,o+=Math.pow(o,s)}}var Ra=(e,r={})=>Ia({async probe(){try{const i=await e();return i===void 0?{value:r.taskValueFallback,success:!1}:{value:i,success:!0}}catch(i){return{success:!1,message:je(i)}}}},r),Ia=async(e,r={})=>{const n=r.abort,i=Ba(r.log),s=r.predelayMs??0,o=a0();let a=0;const u=r.startAt??1e3,l=r.limitAttempts??Number.MAX_SAFE_INTEGER,c=d0({...r,startAt:u,limitAttempts:l});if(u<=0)throw new Error("Param 'initialValue' must be above zero");if(s>0)try{await de({millis:s,signal:n})}catch(f){return{success:!1,attempts:a,value:r.taskValueFallback,elapsed:o(),message:je(f)}}for(const f of c){a++;const d=await e.probe(a);if(d.success)return{success:d.success,value:d.value,attempts:a,elapsed:o()};if(i({msg:`retry attempts: ${a} t: ${Ta(f)}`}),a>=l)break;try{await de({millis:f,signal:n})}catch(h){return{success:!1,attempts:a,value:r.taskValueFallback,message:je(h),elapsed:o()}}}return{message:`Giving up after ${a} attempts.`,success:!1,attempts:a,value:r.taskValueFallback,elapsed:o()}},kD=class extends Le{timeoutMs;whenUnmatchedResponse;keyRequest;keyResponse;#e=new Map;#t;constructor(e={}){if(super(),typeof window>"u"&&(globalThis.window={setTimeout,clearTimeout}),this.timeoutMs=e.timeoutMs??1e3,this.whenUnmatchedResponse=e.whenUnmatchedResponse??"throw",this.#t=vr(()=>this.#r(),this.timeoutMs*2),e.key){if(e.keyRequest)throw new Error("Cannot set 'keyRequest' when 'key' is set ");if(e.keyResponse)throw new Error("Cannot set 'keyResponse' when 'key' is set ");this.keyRequest=e.key,this.keyResponse=e.key}else{if(!e.keyRequest||!e.keyResponse)throw new Error("Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set");this.keyRequest=e.keyRequest,this.keyResponse=e.keyResponse}}#r(){const e=[...this.#e.values()],r=Date.now();for(const n of e)if(n.expiresAt<=r){n.promiseReject&&n.promiseReject("Request timeout");const i=n.callback;i&&setTimeout(()=>{i(!0,"Request timeout")},1),this.fireEvent("completed",{request:n.req,response:"Request timeout",success:!1}),this.#e.delete(n.id)}return this.debugDump(),this.#e.size>0}debugDump(){const e=[...this.#e.values()],r=Date.now();for(const n of e){const i=r-n.expiresAt;console.log(`${n.id} Expires in: ${Math.floor(i/1e3)}s`)}}request(e,r){if(r!==void 0){this.#i(e,r);return}return this.#n(e)}requestAndForget(e){const r=this.keyRequest(e);if(this.#e.has(r))throw new Error(`Already a request pending with id '${r}'`);const n={expiresAt:Date.now()+this.timeoutMs,id:r,req:e};this.#e.set(r,n),this.#t.start()}#n(e){const r=this.keyRequest(e);if(this.#e.has(r))throw new Error(`Already a request pending with id '${r}'`);return new Promise((i,s)=>{const o={expiresAt:Date.now()+this.timeoutMs,id:r,req:e,promiseResolve:i,promiseReject:s};this.#e.set(r,o),this.#t.start()})}#i(e,r){const n=this.keyRequest(e);if(this.#e.has(n))throw new Error(`Already a request pending with id '${n}'`);const i={expiresAt:Date.now()+this.timeoutMs,id:n,req:e,callback:r};this.#e.set(n,i),this.#t.start()}response(e,r){const n=this.keyResponse(e),i=this.#e.get(n);if(!i){if(this.whenUnmatchedResponse==="throw")throw new Error(`Unmatched response with id: '${n}'`,{cause:e});return!1}return r?i.expiresAt=Date.now()+this.timeoutMs:this.#e.delete(n),i.promiseResolve&&i.promiseResolve(e),i.callback&&i.callback(!1,e),this.fireEvent("match",{request:i.req,response:e}),r||this.fireEvent("completed",{request:i.req,response:e,success:!0}),!0}},MD=class h0{static instance=new h0;_timer=0;_queue;_startDelayMs;_intervalMs;constructor(r={}){this._startDelayMs=r.startDelayMs??500,this._intervalMs=r.intervalMs??100,this._queue=t0()}add(r){this._queue.enqueue(r),this._timer===0&&this.schedule(this._startDelayMs)}schedule(r){if(this._queue.length===0){this._timer=0;return}this._timer===0&&(this._timer=setTimeout(()=>{this.processQueue()},r))}async processQueue(){const r=this._queue.dequeue();if(this._timer=0,r!==void 0)try{await r(),this._timer=0,this.schedule(this._intervalMs)}catch(n){console.error(n)}}};function y0(e,r){return typeof e=="number"?_D(e,r):$D(e,r)}function v0(e,r){return typeof e=="number"?TD(e,r):BD(e,r)}async function*$D(e,r){let n=0,i=0;for(;e(n,i);){n++;const s=await r(n,i);s!==void 0&&(yield s,i++)}}function*BD(e,r){let n=0,i=0;for(;e(n,i);){n++;const s=r(n,i);s!==void 0&&(yield s,i++)}}async function*_D(e,r){P(e,"positive","count");let n=0,i=0;for(;e-- >0;){i++;const s=await r(i,n);s!==void 0&&(yield s,n++)}}function*TD(e,r){P(e,"positive","count");let n=0,i=0;for(;e-- >0;){i++;const s=r(i,n);s!==void 0&&(yield s,n++)}}var p0=(e,r)=>{for(const n of e){const i=r(n);if(typeof i=="boolean"&&!i)break}},m0=async function(e,r,n){if(Array.isArray(e))for(const i of e){const s=await r(i);if(n&&await de(n),typeof s=="boolean"&&!s)break}else for await(const i of e){const s=await r(i);if(n&&await de(n),typeof s=="boolean"&&!s)break}};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Flow:{StateMachine:xe,Timer:i0,forEach:p0,forEachAsync:m0,repeatAwait:y0,repeat:v0}})}catch{}var ss=class extends Le{#e;#t;#r;#n=!1;#i=!1;#s=bt.infinity();constructor(e,r={}){super(),this.#r=r.debug??!1,this.#e=os(e,r.initial),this.#t=mo(this.#e)}#o(e){this.#i!==e&&(this.#i=e,e?(this.#n=!0,setTimeout(()=>{this.#n&&(this.#n=!1,this.fireEvent("stop",{state:this.#e.value}))},2)):this.#n=!1)}get statesPossible(){return gn(this.#e)}get statesDefined(){return Object.keys(this.#e.machine)}next(){const e=gn(this.#e);return e.length===0?null:(this.state=e[0],e[0])}get isDone(){return wo(this.#e)}reset(){this.#o(!1),this.#e=mo(this.#t),this.#s=bt.since()}validateTransition(e){as(this.#e,e)}isValid(e){return E0(this.#e,e)}set state(e){const r=this.#e.value;e!==this.#e.value&&(this.#e=wn(this.#e,e),this.#r&&console.log(`StateMachine: ${r} -> ${e}`),this.#s=bt.since(),setTimeout(()=>{this.fireEvent("change",{newState:e,priorState:r})},1),wo(this.#e)&&this.#o(!0))}get state(){return this.#e.value}get changedAt(){return this.#s()}get elapsed(){return this.#s()}},mo=e=>Object.freeze({value:e.value,visited:[...e.visited],machine:e.machine}),os=(e,r)=>{const[n,i]=g0(e);if(!n)throw new Error(i);const s=r??Object.keys(n.states)[0];if(n.states[s]===void 0)throw new TypeError("Initial state not found");const o=zD(n.states);if(o===void 0)throw new Error("Could not normalise transitions");return Object.freeze({value:s,visited:[],machine:Object.fromEntries(o)})},go=e=>os(e.machine),g0=e=>e===void 0?[void 0,"Parameter undefined"]:e===null?[void 0,"Parameter null"]:"states"in e?[e,""]:typeof e=="object"?[{states:e},""]:[void 0,`Unexpected type: ${typeof e}. Expected object`],wo=e=>gn(e).length===0,ja=e=>{x0(e);const r=e.machine[e.value];return r.length===1&&r[0].state===null?[]:r},gn=e=>ja(e).map(n=>n.state),w0=e=>{const r=n=>{if(n===null)return{state:null};if(typeof n=="string")return{state:n};if(typeof n=="object"&&"state"in n){const i=n.state;if(typeof i!="string")throw new TypeError(`Target 'state' field is not a string. Got: ${typeof i}`);return"preconditions"in n?{state:i,preconditions:n.preconditions}:{state:i}}else throw new Error(`Unexpected type: ${typeof n}. Expected string or object with 'state' field.`)};if(Array.isArray(e)){let n=!1;const i=e.map(s=>{const o=r(s);if(!o)throw new Error("Invalid target");return n=n||o.state===null,o});if(n&&i.length>1)throw new Error("Cannot have null as an possible state");return i}else{const n=r(e);return n?[n]:void 0}},zD=e=>{const r=new Map;for(const[n,i]of Object.entries(e)){if(typeof n>"u")throw new TypeError("Top-level undefined state");if(typeof i>"u")throw new TypeError(`Undefined target state for ${n}`);if(r.has(n))throw new Error(`State defined twice: ${n}`);if(n.includes(" "))throw new Error("State names cannot contain spaces");r.set(n,[])}for(const[n,i]of Object.entries(e)){const s=w0(i);if(s===void 0)throw new Error("Could not normalise target");if(s!==null){const o=new Set;for(const a of s){if(o.has(a.state))throw new Error(`Target state '${a.state}' already exists for '${n}'`);if(o.add(a.state),a.state!==null&&!r.has(a.state))throw new Error(`Target state '${a.state}' is not defined as a top-level state. Defined under: '${n}'`)}r.set(n,s)}}return r},x0=e=>{if(e===void 0)throw new TypeError("Parameter 'state' is undefined");if(typeof e.value!="string")throw new TypeError("Existing state is not a string")},wn=(e,r)=>(x0(e),as(e,r),Object.freeze({value:r,machine:e.machine,visited:mf([e.visited,[e.value]])})),b0=e=>{const r=ja(e).at(0);if(!r||r.state===null)throw new Error(`Not possible to move to a next state from '${e.value}`);return wn(e,r.state)},E0=(e,r)=>{try{return as(e,r),!0}catch{return!1}},as=(e,r)=>{if(r===null)throw new Error("Cannot transition to null state");if(r===void 0)throw new Error("Cannot transition to undefined state");if(typeof r!="string")throw new TypeError(`Parameter 'toState' should be a string. Got: ${typeof r}`);const n=gn(e);if(n.length===0)throw new Error("Machine is in terminal state");if(!n.includes(r))throw new Error(`Target state '${r}' not available at current state '${e.value}'. Possible states: ${n.join(", ")}`)},RD=(...e)=>{const r={};if(!Array.isArray(e))throw new Error("Expected array of strings");if(e.length<=2)throw new Error("Expects at least two states");for(let n=0;n<e.length;n++){const i=e[n];if(typeof i!="string")throw new TypeError(`Expected array of strings. Got type '${typeof i}' at index ${n}`);r[i]=n===e.length-1?null:e[n+1]}return r},ID=(...e)=>{const r={};if(!Array.isArray(e))throw new Error("Expected array of strings");if(e.length<2)throw new Error("Expects at least two states");for(const[n,i]of e.entries()){if(typeof i!="string")throw new TypeError(`Expected array of strings. Got type '${typeof i}' at index ${n}`);r[i]=[]}for(let n=0;n<e.length;n++){const i=r[e[n]];n===e.length-1?e.length>1?i.push(e[n-1]):r[e[n]]=null:(i.push(e[n+1]),n>0&&i.push(e[n-1]))}return r},La=(e=5)=>((typeof e=="number"?{length:e}:e).source??fe)().toString(36).slice(2,length+2),jD={};E(jD,{abbreviate:()=>D0,afterMatch:()=>jn,beforeAfterMatch:()=>Oa,beforeMatch:()=>Va,between:()=>LD,betweenChomp:()=>VD,countCharsFromStart:()=>GD,htmlEntities:()=>HD,indexOfCharCode:()=>bn,lineSpan:()=>qD,omitChars:()=>En,random:()=>La,splitByLength:()=>A0,splitRanges:()=>WD,startsEnds:()=>UD,toStringAbbreviate:()=>xn,unwrap:()=>OD,wildcard:()=>JD});var D0=(e,r=15)=>{if(U(Tt(r,"aboveZero","maxLength")),typeof e!="string")throw new Error("Parameter 'source' is not a string");if(e.length>r&&e.length>3){if(r>15){const n=Math.round((r-2)/2);return e.slice(0,n)+"..."+e.slice(-n)}return e.slice(0,r)+"..."}return e},xn=(e,r=20)=>e===void 0?"(undefined)":e===null?"(null)":D0(JSON.stringify(e),r),LD=(e,r,n,i=!0)=>{const s=e.indexOf(r);if(s<0)return;n===void 0&&(n=r);const o=i?e.lastIndexOf(n):e.indexOf(n,s+1);if(!(o<0))return e.slice(s+1,o)},VD=(e,r,n,i=!0)=>{if(typeof e!="string")throw new Error("Parameter 'source' is not a string");if(typeof r!="string")throw new Error("Parameter 'start' is not a string");if(n!==void 0&&typeof n!="string")throw new Error("Parameter 'end' is not a string");const s=e.indexOf(r);if(s<0)return[e,void 0];n===void 0&&(n=r);const o=i?e.lastIndexOf(n):e.indexOf(n,s+1);if(o<0)return[e,void 0];const a=e.slice(s+1,o);return[e.slice(0,s)+e.slice(o+1),a]},bn=(e,r,n=0,i=e.length-1)=>{for(let s=n;s<=i;s++)if(e.codePointAt(s)===r)return s;return-1},En=(e,r,n)=>e.slice(0,r)+e.slice(r+n),A0=(e,r)=>{if(U(Tt(r,"aboveZero","length")),e===null)throw new Error("source parameter null");if(typeof e!="string")throw new TypeError("source parameter not a string");const n=Math.ceil(e.length/r),i=[];let s=0;for(let o=0;o<n;o++)i.push(e.slice(s,s+r)),s+=r;return i},Va=(e,r,n={})=>Oa(e,r,n)[0],jn=(e,r,n={})=>Oa(e,r,n)[1],Oa=(e,r,n={})=>{if(e===void 0)throw new Error("Param 'source' is undefined");let i=n.fallback;const s=n.ifNoMatch??(i?"fallback":"original");if(s==="original"&&(i=e),s==="fallback"&&i===void 0)throw new Error("Fallback must be provided");const o=n.startPos??void 0,u=n.fromEnd??!1?e.lastIndexOf(r,o):e.indexOf(r,o);if(u<0&&s==="throw")throw new Error(`Match '${r}' not found in source.`);return u<0&&s==="original"?[e,e]:u<0&&s==="fallback"?[i,i]:[e.slice(0,u),e.slice(Math.max(0,u+r.length))]},OD=(e,...r)=>{let n=!1;do{n=!1;for(const i of r)e.startsWith(i)&&e.endsWith(i)&&(e=e.slice(i.length,e.length-i.length*2+1),n=!0)}while(n);return e},qD=(e,r,n)=>{let i=-1,s=-1;for(const[o,a]of e.entries())if(i=o,a.text.length!==0&&r<a.end)break;for(let o=i;o<e.length;o++){const a=e[o];if(s=o,n===a.end){s=o+1;break}if(n<a.end)break}return{length:s-i,start:i,end:s}},WD=(e,r)=>{let n=0,i="";const s=[];let o=0;for(let a=0;a<e.length;a++)if(e.indexOf(r,a)===a){const u=a;s.push({text:i,start:n,end:u,index:o}),n=u+1,i="",o++}else i+=e.charAt(a);return n<e.length&&s.push({text:i,start:n,index:o,end:e.length}),s},GD=(e,...r)=>{let n=0;for(let i=0;i<e.length&&r.includes(e.charAt(i));i++)n++;return n},UD=(e,r,n=r)=>e.startsWith(r)&&e.endsWith(n),HD=e=>e.replaceAll(/[&<>\u00A0-\u9999]/g,r=>`&#${r.codePointAt(0)};`),JD=e=>{const r=i=>i.replaceAll(/([!$()*+./:=?[\\\]^{|}])/g,"\\$1");e=e.split("*").map(i=>r(i)).join(".*"),e="^"+e+"$";const n=new RegExp(e);return i=>n.test(i)},YD={};E(YD,{AudioAnalysers:()=>F0,AudioVisualisers:()=>P0,Bluetooth:()=>C0,Camera:()=>_0,Codec:()=>qa,Espruino:()=>k0,FrameProcessor:()=>fA,Serial:()=>M0,StringReceiveBuffer:()=>Wa,StringWriteBuffer:()=>Ga,VideoFile:()=>z0,genericStateTransitionsInstance:()=>Ya,reconnectingWebsocket:()=>dA});var C0={};E(C0,{NordicBleDevice:()=>S0,defaultOpts:()=>Ln});var qa=class{enc=new TextEncoder;dec=new TextDecoder("utf-8");toBuffer(e){return this.enc.encode(e)}fromBuffer(e){return this.dec.decode(e)}},Wa=class{constructor(e,r=`
`){this.onData=e,this.separator=r}buffer="";stream;async close(){const e=this.stream;e&&(await e.abort(),await e.close())}clear(){this.buffer=""}writable(){return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){const e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}addImpl(e){const r=e.indexOf(this.separator);if(r<0)return this.buffer+=e,"";const n=e.substring(0,r);try{this.onData(this.buffer+n),e=e.substring(n.length+this.separator.length)}catch(i){console.warn(i)}return this.buffer="",e}add(e){for(;e.length>0;)e=this.addImpl(e)}},Ga=class{constructor(e,r={}){this.dataHandler=e,this.chunkSize=r.chunkSize??-1,this.writer=vr(async()=>{await this.onWrite()},r.interval??10)}paused=!1;queue=new Re;writer;stream;closed=!1;chunkSize;async close(){if(this.closed)return;const e=this.stream?.getWriter();e?.releaseLock(),await e?.close(),this.closed=!0}clear(){if(this.closed)throw new Error("Buffer closed");this.queue=new Re}writable(){if(this.closed)throw new Error("Buffer closed");return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){const e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}async onWrite(){if(this.queue.isEmpty)return!1;if(this.paused)return console.warn("WriteBuffer.onWrite: paused..."),!0;const e=this.queue.dequeue();return e===void 0?!1:(await this.dataHandler(e),!0)}get isClosed(){return this.closed}add(e){if(this.closed)throw new Error("Buffer closed");this.chunkSize>0?this.queue.enqueue(...A0(e,this.chunkSize)):this.queue.enqueue(e),this.writer.start()}},XD=class extends Le{constructor(e,r){super(),this.device=e,this.config=r,this.verboseLogging=r.debug,this.txBuffer=new Ga(async n=>{await this.writeInternal(n)},r),this.rxBuffer=new Wa(n=>{this.fireEvent("data",{data:n})}),this.codec=new qa,this.states=new ss(Ya,{initial:"ready"}),this.states.addEventListener("change",n=>{this.fireEvent("change",n),this.verbose(`${n.priorState} -> ${n.newState}`),n.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())}),e.addEventListener("gattserverdisconnected",()=>{this.isClosed||(this.verbose("GATT server disconnected"),this.states.state="closed")}),this.verbose(`ctor ${e.name} ${e.id}`)}states;codec;rx;tx;gatt;verboseLogging=!1;rxBuffer;txBuffer;get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw new Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async writeInternal(e){this.verbose(`writeInternal ${e}`);const r=this.tx;if(r===void 0)throw new Error("Unexpectedly without tx characteristic");try{await r.writeValue(this.codec.toBuffer(e))}catch(n){this.warn(n)}}disconnect(){this.states.state==="connected"&&this.gatt?.disconnect()}async connect(){const e=this.config.connectAttempts??3;this.states.state="connecting",this.verbose("connect");const r=this.device.gatt;if(r===void 0)throw new Error("Gatt not available on device");await Ra(async()=>{this.verbose("connect.retry");const n=await r.connect();this.verbose("Getting primary service");const i=await n.getPrimaryService(this.config.service);this.verbose("Getting characteristics");const s=await i.getCharacteristic(this.config.rxGattCharacteristic),o=await i.getCharacteristic(this.config.txGattCharacteristic);return s.addEventListener("characteristicvaluechanged",a=>{this.onRx(a)}),this.rx=s,this.tx=o,this.gatt=r,this.states.state="connected",await s.startNotifications(),!0},{limitAttempts:e,startAt:200})}onRx(e){if(this.rx===void 0)return;const n=e.target.value;if(n===void 0)return;let i=this.codec.fromBuffer(n.buffer);const s=bn(i,19),o=bn(i,17);o&&s<o&&(this.verbose("Tx plz start"),i=En(i,o,1),this.txBuffer.paused=!1),s&&s>o&&(this.verbose("Tx plz stop"),i=En(i,s,1),this.txBuffer.paused=!0),this.rxBuffer.add(i)}verbose(e){this.verboseLogging&&console.info(`${this.config.name}`,e)}log(e){console.log(`${this.config.name}`,e)}warn(e){console.warn(`${this.config.name}`,e)}},Ln={chunkSize:20,service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",txGattCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",rxGattCharacteristic:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",name:"NordicDevice",connectAttempts:5,debug:!1},S0=class extends XD{constructor(e,r={}){super(e,{...Ln,...r})}},F0={};E(F0,{AudioAnalyser:()=>us,basic:()=>KD,freq:()=>ZD,peakLevel:()=>QD});var P0={};E(P0,{default:()=>N0});var N0=class{freqMaxRange=200;audio;parent;lastPointer={x:0,y:0};pointerDown=!1;pointerClicking=!1;pointerClickDelayMs=100;pointerDelaying=!1;waveTracker;freqTracker;el;constructor(e,r){this.audio=r,this.parent=e,this.waveTracker=cn(),this.freqTracker=cn(),e.innerHTML=`
    <section>
      <button id="rendererComponentToggle"></button>
      <div>
        <h1>Visualiser</h1>
        <div style="display:flex; flex-wrap: wrap">
          <div class="visPanel">
            <h2>Frequency distribution</h2>
            <br />
            <canvas id="rendererComponentFreqData" height="200" width="400"></canvas>
          </div>
          <div class="visPanel">
            <h2>Waveform</h2>
            <button id="rendererComponentWaveReset">Reset</button>
            <div>
              Press and hold on wave to measure
            </div>
            <br />
            <canvas id="rendererComponentWaveData" height="200" width="400"></canvas>
          </div>
        </div>
      </div>
    </section>
    `,this.el=e.children[0],document.getElementById("rendererComponentToggle")?.addEventListener("click",()=>{this.setExpanded(!this.isExpanded())}),this.el.addEventListener("pointermove",n=>this.onPointer(n)),this.el.addEventListener("pointerup",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),this.el.addEventListener("pointerdown",()=>{this.pointerDelaying=!0,setTimeout(()=>{this.pointerDelaying&&(this.pointerDelaying=!1,this.pointerDown=!0)},this.pointerClickDelayMs)}),this.el.addEventListener("pointerleave",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),document.getElementById("rendererComponentWaveReset")?.addEventListener("click",()=>{this.clear()})}renderFreq(e){if(!this.isExpanded()||!e)return;const r=document.getElementById("rendererComponentFreqData");if(r===null)throw new Error("Cannot find canvas element");const n=r.getContext("2d");if(n===null)throw new Error("Cannot create drawing context");const i=e.length,s=r.clientWidth,o=r.clientHeight;n.clearRect(0,0,s,o);const a=this.getPointerRelativeTo(r),u=s/i,l=Dt.minMaxAvg(e);for(let c=0;c<i;c++){if(!Number.isFinite(e[c]))continue;const d=(e[c]-l.min)/this.freqMaxRange,h=Math.abs(o*d),y=o-h,v=c/i*360,m=c*u;if(n.fillStyle="hsl("+v+", 100%, 50%)",a.y>0&&a.y<=o&&a.x>=m&&a.x<=m+u){this.freqTracker.id!==c.toString()&&(this.freqTracker=cn({id:c.toString()})),this.freqTracker.seen(e[c]);const g=this.freqTracker.getMinMaxAvg();n.fillStyle="black",this.audio&&n.fillText(`Frequency (${c}) at pointer: ${this.audio.getFrequencyAtIndex(c).toLocaleString("en")} - ${this.audio.getFrequencyAtIndex(c+1).toLocaleString("en")}`,2,10),n.fillText(`Raw value: ${e[c].toFixed(2)}`,2,20),n.fillText(`Min: ${g.min.toFixed(2)}`,2,40),n.fillText(`Max: ${g.max.toFixed(2)}`,60,40),n.fillText(`Avg: ${g.avg.toFixed(2)}`,120,40)}n.fillRect(m,y,u,h)}}isExpanded(){const e=this.el.querySelector("div");if(e===null)throw new Error("contents div not found");return e.style.display===""}setExpanded(e){const r=this.el.querySelector("div"),n=this.el.querySelector("button");if(n===null)throw new Error("Button element not found");if(r===null)throw new Error("Contents element not found");e?(r.style.display="",n.innerText=""):(r.style.display="none",n.innerText="")}clear(){this.clearCanvas(document.getElementById("rendererComponentFreqData")),this.clearCanvas(document.getElementById("rendererComponentWaveData"))}clearCanvas(e){if(e===null)throw new Error("Canvas is null");const r=e.getContext("2d");if(r===null)throw new Error("Cannot create drawing context");r.fillStyle="white",r.fillRect(0,0,e.clientWidth,e.clientHeight)}renderWave(e,r=!0){if(!this.isExpanded()||!e)return;const n=document.getElementById("rendererComponentWaveData");if(n===null)throw new Error("Cannot find wave canvas");const i=n.getContext("2d");if(i===null)throw new Error("Cannot create drawing context for wave");const s=n.clientWidth,o=n.clientHeight,a=this.getPointerRelativeTo(n),u=20,l=60,c=e.length;i.fillStyle="white",i.fillRect(0,0,l,u);const f=s/c;i.fillStyle="rgba(255, 255, 255, 0.03)",i.fillRect(0,20,s,o),i.fillStyle="red",r?i.fillRect(0,o/2,s,1):i.fillRect(0,o-1,s,1),i.lineWidth=1,i.strokeStyle="black",i.beginPath();let d=0;for(let h=0;h<c;h++){const y=e[h]*o,v=r?o/2-y:o-y;h===0?i.moveTo(d,v):i.lineTo(d,v),d+=f,this.pointerDown&&this.waveTracker.seen(e[h])}if(i.lineTo(s,r?o/2:o),i.stroke(),this.pointerDown){const h=this.waveTracker.getMinMaxAvg();i.fillStyle="rgba(255,255,0,1)",i.fillRect(l,0,150,20),i.fillStyle="black",i.fillText("Min: "+h.min.toFixed(2),60,10),i.fillText("Max: "+h.max.toFixed(2),110,10),i.fillText("Avg: "+h.avg.toFixed(2),160,10)}else this.waveTracker.reset();a.y>0&&a.y<=o&&a.x>=0&&a.x<=s&&(i.fillStyle="black",i.fillText("Level: "+(1-a.y/o).toFixed(2),2,10))}getPointerRelativeTo(e){const r=e.getBoundingClientRect();return{x:this.lastPointer.x-r.left-window.scrollX,y:this.lastPointer.y-r.top-window.scrollY}}onPointer(e){this.lastPointer={x:e.pageX,y:e.pageY},e.preventDefault()}},KD=(e,r={})=>new us((n,i)=>{const s=new Float32Array(n.frequencyBinCount),o=new Float32Array(n.fftSize);n.getFloatFrequencyData(s),n.getFloatTimeDomainData(o),e(s,o,i)},r),ZD=(e,r={})=>new us((n,i)=>{const s=new Float32Array(n.frequencyBinCount);n.getFloatFrequencyData(s),e(s,i)},r),QD=(e,r={})=>new us((n,i)=>{const s=new Float32Array(n.fftSize);n.getFloatTimeDomainData(s),e(Dt.maxFast(s),i)},r),us=class{showVis;fftSize;smoothingTimeConstant;#e=!1;debug;#t=!1;visualiser;audioCtx;analyserNode;analyse;constructor(e,r={}){if(this.showVis=r.showVis??!1,this.fftSize=r.fftSize??1024,this.debug=r.debug??!1,this.smoothingTimeConstant=r.smoothingTimeConstant??.8,le(this.fftSize,"positive","opts.fftSize"),P(this.smoothingTimeConstant,"percentage","opts.smoothingTimeConstant"),!Tc(this.fftSize))throw new Error(`fftSize must be a power of two from 32 to 32768 (${this.fftSize})`);if(this.fftSize<32)throw new Error("fftSize must be at least 32");if(this.fftSize>32768)throw new Error("fftSize must be no greater than 32768");this.analyse=e,this.paused=!1,this.init();const n=document.getElementById("audio-visualiser");if(n){const i=new N0(n,this);i.setExpanded(this.showVis),this.visualiser=i}}init(){if(this.#t){this.debug&&console.debug("Init already in progress");return}this.#t=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.onMicSuccess(e)}).catch(e=>{this.#t=!1,console.error(e)})}get paused(){return this.#e}set paused(e){e!==this.#e&&(this.#e=e,e?this.debug&&console.log("Paused"):(this.debug&&console.log("Unpaused"),window.requestAnimationFrame(this.analyseLoop.bind(this))))}setup(e,r){const n=e.createAnalyser();return n.fftSize=this.fftSize,n.smoothingTimeConstant=this.smoothingTimeConstant,e.createMediaStreamSource(r).connect(n),n}onMicSuccess(e){try{const r=new AudioContext;r.addEventListener("statechange",()=>{this.debug&&console.log(`Audio context state: ${r.state}`)}),this.audioCtx=r,this.analyserNode=this.setup(r,e),window.requestAnimationFrame(this.analyseLoop.bind(this))}catch(r){this.#t=!1,console.error(r)}}analyseLoop(){if(this.paused){this.debug&&console.log("Paused");return}const e=this.analyserNode;if(e===void 0){console.warn("Analyser undefined");return}try{this.analyse(e,this)}catch(r){console.error(r)}window.requestAnimationFrame(this.analyseLoop.bind(this))}getFrequencyRangeMax(e,r,n){const i=this.sliceByFrequency(e,r,n);return Dt.max(i)}sliceByFrequency(e,r,n){const i=this.getIndexForFrequency(e),s=this.getIndexForFrequency(r);return n.slice(i,s)}getFrequencyAtIndex(e){const r=this.analyserNode,n=this.audioCtx;if(r===void 0)throw new Error("Analyser not available");if(n===void 0)throw new Error("Audio context not available");if(le(e,"positive","index"),e>r.frequencyBinCount)throw new Error(`Index ${e} exceeds frequency bin count ${r.frequencyBinCount}`);return e*n.sampleRate/(r.frequencyBinCount*2)}getIndexForFrequency(e){const r=this.analyserNode;if(r===void 0)throw new Error("Analyser not available");const n=r.context.sampleRate/2,i=Math.round(e/n*r.frequencyBinCount);return i<0?0:i>=r.frequencyBinCount?r.frequencyBinCount-1:i}},k0={};E(k0,{EspruinoBleDevice:()=>ls,EspruinoSerialDevice:()=>B0,bangle:()=>rA,connectBle:()=>iA,deviceEval:()=>Ha,puck:()=>tA,serial:()=>nA});var ls=class extends S0{evalTimeoutMs;evalReplyBluetooth=!0;constructor(e,r={}){super(e,r),this.evalTimeoutMs=r.evalTimeoutMs??5*1e3}async writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},n){const i=r.debug??!1;return Ha(e,r,this,"Bluetooth.println",i,n??(o=>{this.warn(o)}))}},M0={};E(M0,{Device:()=>$0});var eA=class extends Le{states;codec;verboseLogging=!1;name;connectAttempts;chunkSize;rxBuffer;txBuffer;constructor(e={}){super(),this.verboseLogging=e.debug??!1,this.chunkSize=e.chunkSize??1024,this.connectAttempts=e.connectAttempts??3,this.name=e.name??"JsonDevice",this.txBuffer=new Ga(async r=>{await this.writeInternal(r)},e),this.rxBuffer=new Wa(r=>{this.fireEvent("data",{data:r})}),this.codec=new qa,this.states=new ss(Ya,{initial:"ready"}),this.states.addEventListener("change",r=>{this.fireEvent("change",r),this.verbose(`${r.priorState} -> ${r.newState}`),r.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())})}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw new Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async close(){this.states.state==="connected"&&this.onClosed()}async connect(){const e=this.connectAttempts;this.states.state="connecting",await this.onPreConnect(),await Ra(async()=>(await this.onConnectAttempt(),this.states.state="connected",!0),{limitAttempts:e,startAt:200})}onRx(e){const r=e.target.value;if(r===void 0)return;let n=this.codec.fromBuffer(r.buffer);const i=bn(n,19),s=bn(n,17);s&&i<s&&(this.verbose("Tx plz start"),n=En(n,s,1),this.txBuffer.paused=!1),i&&i>s&&(this.verbose("Tx plz stop"),n=En(n,i,1),this.txBuffer.paused=!0),this.rxBuffer.add(n)}verbose(e){this.verboseLogging&&console.info(`${this.name}`,e)}log(e){console.log(`${this.name}`,e)}warn(e){console.warn(`${this.name}`,e)}},$0=class extends eA{constructor(e={}){super(e),this.config=e,this.abort=new AbortController;const r=e.eol??`\r
`;this.baudRate=e.baudRate??9600,e.name===void 0&&(this.name="Serial.Device"),this.rxBuffer.separator=r}port;tx;abort;baudRate;async writeInternal(e){if(this.tx===void 0)throw new Error("tx not ready");try{this.tx.write(e)}catch(r){this.warn(r)}}onClosed(){this.tx?.releaseLock(),this.abort.abort("closing port"),this.states.state="closed"}onPreConnect(){return Promise.resolve()}async onConnectAttempt(){let e={};const r={baudRate:this.baudRate};this.config.filters&&(e={filters:[...this.config.filters]}),this.port=await navigator.serial.requestPort(e),this.port.addEventListener("disconnect",a=>{this.close()}),await this.port.open(r);const n=this.port.writable,i=new TextEncoderStream;n!==null&&(i.readable.pipeTo(n,{signal:this.abort.signal}).catch(a=>{console.log("Serial.onConnectAttempt txText pipe:"),console.log(a)}),this.tx=i.writable.getWriter());const s=this.port.readable,o=new TextDecoderStream;s!==null&&(s.pipeTo(o.writable,{signal:this.abort.signal}).catch(a=>{console.log("Serial.onConnectAttempt rxR pipe:"),console.log(a)}),o.readable.pipeTo(this.rxBuffer.writable(),{signal:this.abort.signal}).catch(a=>{console.log("Serial.onConnectAttempt rxText pipe:"),console.log(a);try{this.port?.close()}catch(u){console.log(u)}}))}},B0=class extends $0{evalTimeoutMs;evalReplyBluetooth=!1;constructor(e){super(e),e===void 0&&(e={}),this.evalTimeoutMs=e.evalTimeoutMs??5*1e3}async disconnect(){return super.close()}writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},n){const i=r.debug??!1;return Ha(e,r,this,"USB.println",i,n??(o=>{this.warn(o)}))}},tA=async(e={})=>{const r=e.name??"Puck",n=e.debug??!1,i=await navigator.bluetooth.requestDevice({filters:Ua(e,"Puck.js"),optionalServices:[Ln.service]});console.log(i.name);const s=new ls(i,{name:r,debug:n});return await s.connect(),s},rA=async(e={})=>{const r=e.name??"Bangle",n=e.debug??!1,i=await navigator.bluetooth.requestDevice({filters:Ua(e,"Bangle.js"),optionalServices:[Ln.service]});console.log(i.name);const s=new ls(i,{name:r,debug:n});return await s.connect(),s},nA=async(e={})=>{const r=new B0(e);return await r.connect(),r},Ua=(e,r)=>{const n=[];return e.filters?n.push(...e.filters):e.name?(n.push({name:e.name}),console.info(`Filtering Bluetooth devices by name '${e.name}'`)):n.push({namePrefix:r}),n},iA=async(e={})=>{const r=await navigator.bluetooth.requestDevice({filters:Ua(e,"Puck.js"),optionalServices:[Ln.service]}),n=new ls(r,{name:"Espruino",...e});return await n.connect(),n},Ha=async(e,r={},n,i,s,o)=>{const a=r.timeoutMs??n.evalTimeoutMs,u=r.assumeExclusive??!0;if(typeof e!="string")throw new TypeError("code parameter should be a string");return new Promise((l,c)=>{const f=La(5),d=m=>{try{let g=m.data;g.startsWith(">{")&&g.endsWith("}")&&(g=g.slice(1));const x=JSON.parse(g);"reply"in x?x.reply===f?(y(),"result"in x&&l(x.result)):o(`Expected reply ${f}, got ${x.reply}`):o(`Expected packet, missing 'reply' field. Got: ${m.data}`)}catch(g){u?y(m.data):o(g)}},h=m=>{m.newState!=="connected"&&y(`State changed to '${m.newState}', aborting`)};n.addEventListener("data",d),n.addEventListener("change",h);const y=za(a,m=>{c(new Error(m))},()=>{n.removeEventListener("data",d),n.removeEventListener("change",h)}),v=`${i}(JSON.stringify({reply:"${f}", result:JSON.stringify(${e})}))
`;s&&o(v),n.write(v)})},_0={};E(_0,{dumpDevices:()=>oA,start:()=>T0});var sA=1e4,oA=async(e="videoinput")=>{const r=await navigator.mediaDevices.enumerateDevices();for(const n of r)n.kind===e&&(console.log(n.label),console.log(` Kind: ${n.kind}`),console.log(` Device id: ${n.deviceId}`))},T0=async(e={})=>{const r=document.createElement("VIDEO");r.style.display="none",r.playsInline=!0,r.muted=!0,r.classList.add("ixfx-camera"),document.body.append(r);let n=()=>{};const i=()=>{try{n()}catch{}r.remove()};try{return n=(await aA(r,e)).dispose,{videoEl:r,dispose:i}}catch(s){throw console.error(s),i(),s}},aA=async(e,r={})=>{if(e===void 0)throw new Error("videoEl undefined");if(e===null)throw new Error("videoEl null");const n=r.max,i=r.min,s=r.ideal,o={audio:!1,video:{width:{},height:{}}};r.facingMode==="front"&&(r={...r,facingMode:"user"}),r.facingMode==="back"&&(r={...r,facingMode:"environment"}),r.facingMode&&(o.video.facingMode=r.facingMode),r.deviceId&&(o.video.deviceId=r.deviceId),s&&(o.video.width={...o.video.width,ideal:s.width},o.video.height={...o.video.height,ideal:s.height}),n&&(o.video.width={...o.video.width,max:n.width},o.video.height={...o.video.height,max:n.height}),i&&(o.video.width={...o.video.width,min:i.width},o.video.height={...o.video.height,min:i.height});const a=za(r.startTimeoutMs??sA,u=>{throw new Error(`Camera getUserMedia failed: ${u}`)});try{const u=await navigator.mediaDevices.getUserMedia(o),l=()=>{e.pause();const d=u.getTracks();for(const h of d)h.stop()};e.srcObject=u,a();const c={videoEl:e,dispose:l};return new Promise((d,h)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{d(c)}).catch(y=>{h(y)})})})}catch(u){throw a(je(u)),u}},z0={};E(z0,{start:()=>R0});var R0=async e=>{const r=document.createElement("VIDEO");r.style.display="none",r.playsInline=!0,r.muted=!0,r.classList.add("ixfx-video"),document.body.appendChild(r);let n=()=>{};const i=()=>{try{n()}catch{}r.remove()};try{return n=(await uA(r,e)).dispose,{videoEl:r,dispose:i}}catch(s){throw console.error(s),i(),s}},uA=async(e,r)=>{if(e===void 0)throw new Error("videoEl undefined");if(e===null)throw new Error("videoEl null");const n=URL.createObjectURL(r);e.src=n,e.loop=!0;const s={videoEl:e,dispose:()=>{e.pause()}};return new Promise((a,u)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{a(s)}).catch(l=>{u(l)})})})},Ja={};E(Ja,{capture:()=>cA,frames:()=>lA,manualCapture:()=>I0});async function*lA(e,r={}){const n=r.maxIntervalMs??0,i=r.showCanvas??!1;let s=r.canvasEl,o,a;o=a=0,s===void 0&&(s=document.createElement("CANVAS"),s.classList.add("ixfx-frames"),i||(s.style.display="none"),document.body.appendChild(s));const u=()=>{s!==void 0&&(o=e.videoWidth,a=e.videoHeight,s.width=o,s.height=a)};let l=null;const c=f0(n);for await(const f of c){if((o===0||a===0)&&u(),o===0||a===0)continue;if(l===null&&(l=s.getContext("2d")),l===null)return;l.drawImage(e,0,0,o,a),yield l.getImageData(0,0,o,a)}}var cA=(e,r={})=>{const n=r.maxIntervalMs??0,i=r.showCanvas??!1,s=r.onFrame,o=e.videoWidth,a=e.videoHeight,u=document.createElement("CANVAS");u.classList.add("ixfx-capture"),i||(u.style.display="none"),u.width=o,u.height=a;let l=null,c;r.workerScript&&(c=new Worker(r.workerScript));const f=c||s;!f&&!i&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");const d=vr(()=>{if(l===null&&(l=u.getContext("2d")),l===null)return;l.drawImage(e,0,0,o,a);let h;if(f&&(h=l.getImageData(0,0,o,a)),c&&c.postMessage({pixels:h.data.buffer,width:o,height:a,channels:4},[h.data.buffer]),s)try{s(h)}catch(y){console.error(y)}},n);return{start:()=>d.start(),cancel:()=>d.cancel(),canvasEl:u}},I0=(e,r={})=>{const n=r.showCanvas??!1,i=e.videoWidth,s=e.videoHeight,o=r.canvasEl!==void 0;let a=r.canvasEl;return a||(a=document.createElement("CANVAS"),a.classList.add("ixfx-capture"),document.body.append(a),n||(a.style.display="none")),a.width=i,a.height=s,{canvasEl:a,capture:()=>{let f;if(f||(f=a?.getContext("2d",{willReadFrequently:!0})),!f)throw new Error("Could not create graphics context");f.drawImage(e,0,0,i,s);const d=f.getImageData(0,0,i,s);return d.currentTime=e.currentTime,r.postCaptureDraw&&r.postCaptureDraw(f,i,s),d},dispose:()=>{if(!o)try{a?.remove()}catch{}}}},fA=class{_source;_state;_teardownNeeded=!1;_cameraConstraints;_cameraStartResult;_videoSourceCapture;_videoFile;_videoStartResult;_showCanvas;_showPreview;_postCaptureDraw;_timer;_captureCanvasEl;constructor(e={}){this._state="ready",this._source="",this._timer=performance.now(),this._showCanvas=e.showCanvas??!1,this._showPreview=e.showPreview??!1,this._cameraConstraints=e.cameraConstraints??void 0,this._captureCanvasEl=e.captureCanvasEl??void 0,this._postCaptureDraw=e.postCaptureDraw}showPreview(e){if(this._state==="disposed")throw new Error("Disposed");let r;switch(this._source){case"camera":{r=this._cameraStartResult?.videoEl,r!==void 0&&(r.style.display=e?"block":"none");break}}this._showPreview=e}showCanvas(e){if(this._state==="disposed")throw new Error("Disposed");let r;if(this._source==="camera"||this._source==="video")r=this._videoSourceCapture?.canvasEl,r!==void 0&&(r.style.display=e?"block":"none");else throw new Error(`Source not implemented: ${this._source}`);this._showCanvas=e}getCapturer(){if(this._state==="disposed")throw new Error("Disposed");if(this._source==="camera"||this._source==="video")return this._videoSourceCapture;throw new Error(`Source kind not supported ${this._source}`)}async useCamera(e){if(this._state==="disposed")throw new Error("Disposed");this._source="camera",this._teardownNeeded&&this.teardown(),e&&this._cameraConstraints,await this.init()}async useVideo(e){if(this._state==="disposed")throw new Error("Disposed");this._source="video",this._teardownNeeded&&this.teardown(),this._videoFile=e,await this.init()}async initCamera(){const e=await T0(this._cameraConstraints);if(e===void 0)throw new Error("Could not start camera");this._cameraStartResult=e,this.postInit(e)}async initVideo(){if(!this._videoFile)throw new Error("Video file not defined");const e=await R0(this._videoFile);this._videoStartResult=e,this.postInit(e)}async postInit(e){this._showPreview&&(e.videoEl.style.display="block"),this._videoSourceCapture=I0(e.videoEl,{postCaptureDraw:this._postCaptureDraw,showCanvas:this._showCanvas,canvasEl:this._captureCanvasEl}),this._teardownNeeded=!0,this._cameraStartResult=e}dispose(){this._state!=="disposed"&&(this.teardown(),this._state="disposed")}async init(){switch(this._timer=performance.now(),this._source){case"camera":{await this.initCamera();break}case"video":{await this.initVideo();break}}this._state="initialised"}teardown(){if(this._teardownNeeded){switch((this._source==="camera"||this._source==="video")&&this._videoSourceCapture?.dispose(),this._source){case"camera":{this._cameraStartResult?.dispose();break}case"video":{this._videoStartResult?.dispose();break}}this._teardownNeeded=!1}}getFrame(){if(this._state==="disposed")throw new Error("Disposed");switch(this._source){case"camera":return this.getFrameCamera();case"video":return this.getFrameCamera();default:throw new Error(`source type unhandled ${this._source}`)}}getTimestamp(){return performance.now()-this._timer}getFrameCamera(){return this._videoSourceCapture?.capture()}},dA=(e,r={})=>{const n=V(r.startDelay,2e3),i=V(r.maxDelay,n*10),s=V(r.checkStateMs,5e3);if(n>i)throw new Error("startDelay should be less than maxDelay");if(s<0)throw new Error("Param 'checkState' should be above zero");let o=!0,a=xe.init({closed:"connecting",open:"closed",connecting:["closed","open"]}),u;const l=g=>{r.onError?r.onError(g):(console.log("rw on error",g),console.error(` error: ${g.error}`),console.error(` type: ${g.type}`),console.error(` error msg: ${g.message}`))},c=g=>{r.onMessage&&r.onMessage(g.data)},f=async()=>{if(a.value==="connecting")throw new Error("Cannot connect twice");a=xe.to(a,"connecting"),u!==void 0&&(u.removeEventListener("error",l),r.onMessage&&u.removeEventListener("message",c),u=void 0);const g=await Ia({async probe(F){try{const M=new WebSocket(e);return(await Oc(M,["open","error"],{timeout:1e3})).type==="open"?{success:!0,value:M}:{success:!1,value:void 0}}catch(M){return{success:!1,message:je(M)}}}},{predelayMs:n,limitAttempts:r.limitAttempts});u=g.value;let x=!1;return g.success&&u?(u.addEventListener("error",l),r.onMessage&&u.addEventListener("message",c),x=!0,a=xe.to(a,"open"),r.onConnected&&r.onConnected()):a=xe.to(a,"closed"),x},d=g=>{if(u)u.readyState===u.OPEN?u.send(g):h();else throw new Error("Not connected")},h=()=>{a.value!=="closed"&&(a.value==="open"&&(a=xe.to(a,"closed"),r.onDisconnected&&r.onDisconnected()),o&&a.value!=="connecting"&&(console.log("Scheduling connect"),setTimeout(()=>{f()},100)))},y=()=>u?u.readyState===u.OPEN:!1,v=()=>{o=!1,a=xe.to(a,"closed"),u?.close(),r.onDisconnected&&r.onDisconnected()},m=()=>(o=!0,a.value==="open"?Promise.resolve(!0):a.value==="connecting"?Promise.resolve(!1):f());return f(),setInterval(()=>{if(u)switch(u.readyState){case u.CLOSED:{a.value==="open"&&h();break}}},s),{send:d,isConnected:y,close:v,open:m}},Ya=Object.freeze({ready:"connecting",connecting:["connected","closed"],connected:["closed"],closed:"connecting"}),hA={};E(hA,{arrayElement:()=>Oi,arrayIndex:()=>ia,defaultRandom:()=>fe,float:()=>H0,floatSource:()=>cs,gaussian:()=>FA,gaussianSource:()=>U0,hue:()=>Go,integer:()=>Qa,integerSource:()=>Za,integerUniqueGen:()=>MA,minutesMs:()=>NA,minutesMsSource:()=>J0,secondsMs:()=>kA,secondsMsSource:()=>Y0,shortGuid:()=>PA,string:()=>La,weighted:()=>CA,weightedIndex:()=>tf,weightedInteger:()=>SA,weightedIntegerSource:()=>G0,weightedSource:()=>W0});var cs=(e=1)=>{const r=typeof e=="number"?{max:e}:e;let n=r.max,i=r.min??0;const s=r.source??fe;if(U(J(i,"","min")),U(J(n,"","max")),!r.min&&n<0&&(i=n,n=0),i>n)throw new Error(`Min is greater than max. Min: ${i} max: ${n}`);return()=>s()*(n-i)+i};function*j0(e,r=0){if(le(e,"","amount"),le(r,"","offset"),e===0)return;let n=0;do yield e<0?-n+r:n+r;while(n++<Math.abs(e)-1)}var Xa={};E(Xa,{crossfade:()=>wA,fromCubicBezier:()=>gA,functions:()=>Ka,gaussian:()=>q0,get:()=>fs,getEasings:()=>xA,mix:()=>O0,tick:()=>mA,time:()=>pA,weightedAverage:()=>AA});var zl=Math.PI*2;function Hr(e,r,n,i){const s=n===void 0?e:r,o=n===void 0||typeof n=="object"?r:n,u=(i!==void 0?i:typeof n=="number"?{}:n)?.limits??"clamp";P(s,"","a"),P(o,"","b");const l=c=>(u==="clamp"?c=Ne(c):u==="wrap"&&(c>1?c=c%1:c<0&&(c=1+c%1)),P(c,"","amount"),(1-c)*s+c*o);return n===void 0||typeof n=="object"?l:l(e)}var yA=(e,r=0,n=1,i=0)=>{let s=i;return(o,a)=>{if(o!==void 0&&(n=o),a!==void 0&&(r=a),s>=1)return n;const u=Hr(s,r,n);return s+=e,u}},vA=(e,r=0,n=1)=>{const i=u0(e,{clampValue:!0});return(s,o)=>{const a=i();return s!==void 0&&(n=s),o!==void 0&&(r=o),a>=1?n:Hr(a,r,n)}},L0=(e,r,n)=>{const i=ci(n-r,0,zl);return Hr(e,r,r+(i>Math.PI?i-zl:i))},an=Math.sqrt,ae=Math.pow,Rl=Math.cos,Jt=Math.PI,on=Math.sin,pA=function(e,r){return V0(e,r,ut)},mA=function(e,r){return V0(e,r,_a)},V0=function(e,r,n){const i=typeof e=="function"?e:fs(e);if(i===void 0)throw typeof e=="string"?new Error(`Easing function not found: ${e}`):new Error("Easing function not found");const s=Rn(r,{timer:n(),clampValue:!0});let o=1;return{get isDone(){return s.isDone},get runState(){return s.isDone?"idle":"scheduled"},get startCount(){return o},compute:()=>{const a=s.elapsed;return i(a)},reset:()=>{s.reset(),o++}}},gA=(e,r)=>n=>{const i=1-n,s=i*i,o=n*n,a=o*n;return 3*e*s*n+3*r*i*o+a},O0=(e,r,n,i)=>Hr(r,n(e),i(e)),wA=(e,r,n)=>O0(e,e,r,n),fs=function(e){if(e===null)throw new Error("easingName is null");if(e===void 0)throw new Error("easingName is undefined");const r=e.toLocaleLowerCase(),n=Object.entries(Ka).find(([i,s])=>i.toLocaleLowerCase()===r);return n===void 0?n:n[1]};function*xA(){yield*Object.keys(Ka)}var q0=(e=.4)=>{const r=1/an(2*Jt),n=.5;return i=>{const s=r/e;let o=-2.5,a=(i-n)/e;a*=a,o*=a;const u=s*ae(Math.E,o);return u>1?1:u<0?0:u}},ti=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bA=e=>e*e*e*e*e,EA=e=>1-ae(1-e,5),DA=e=>e*(1-e)*4,AA=(e,r,n)=>(e*(n-1)+r)/n,Ka={smoothstep:e=>e*e*(3-2*e),smootherstep:e=>(e*(e*6-15)+10)*e*e*e,arch:DA,bell:q0(),sineIn:e=>1-Rl(e*Jt/2),sineOut:e=>on(e*Jt/2),quadIn:e=>e*e,quadOut:e=>1-(1-e)*(1-e),sineInOut:e=>-(Rl(Jt*e)-1)/2,quadInOut:e=>e<.5?2*e*e:1-ae(-2*e+2,2)/2,cubicIn:e=>e*e*e,cubicOut:e=>1-ae(1-e,3),quartIn:e=>e*e*e*e,quartOut:e=>1-ae(1-e,4),quintIn:bA,quintOut:EA,expoIn:e=>e===0?0:ae(2,10*e-10),expoOut:e=>e===1?1:1-ae(2,-10*e),quintInOut:e=>e<.5?16*e*e*e*e*e:1-ae(-2*e+2,5)/2,expoInOut:e=>e===0?0:e===1?1:e<.5?ae(2,20*e-10)/2:(2-ae(2,-20*e+10))/2,circIn:e=>1-an(1-ae(e,2)),circOut:e=>an(1-ae(e-1,2)),backIn:e=>2.70158*e*e*e-1.70158*e*e,backOut:e=>1+2.70158*ae(e-1,3)+1.70158*ae(e-1,2),circInOut:e=>e<.5?(1-an(1-ae(2*e,2)))/2:(an(1-ae(-2*e+2,2))+1)/2,backInOut:e=>{const n=2.5949095;return e<.5?ae(2*e,2)*((n+1)*2*e-n)/2:(ae(2*e-2,2)*((n+1)*(e*2-2)+n)+2)/2},elasticIn:e=>{const r=2*Jt/3;return e===0?0:e===1?1:-ae(2,10*e-10)*on((e*10-10.75)*r)},elasticOut:e=>{const r=2*Jt/3;return e===0?0:e===1?1:ae(2,-10*e)*on((e*10-.75)*r)+1},bounceIn:e=>1-ti(1-e),bounceOut:ti,elasticInOut:e=>{const r=2*Jt/4.5;return e===0?0:e===1?1:e<.5?-(ae(2,20*e-10)*on((20*e-11.125)*r))/2:ae(2,-20*e+10)*on((20*e-11.125)*r)/2+1},bounceInOut:e=>e<.5?(1-ti(1-2*e))/2:(1+ti(2*e-1))/2},CA=(e="quadIn")=>W0(e)(),W0=(e="quadIn")=>{const r=typeof e=="string"?{easing:e}:e,n=r.source??fe,i=r.easing??"quadIn",s=fs(i);if(s===void 0)throw new Error(`Easing function '${i}' not found.`);return()=>{const a=n();return s(a)}},G0=e=>{const r=typeof e=="number"?{max:e}:e,n=r.source??fe,i=r.max,s=r.min??0,o=r.easing??"quadIn";if(typeof i>"u")throw new Error("max field is undefined");if(typeof o!="string")throw new TypeError("easing field expected to be string");U(J(i));const a=fs(o);if(a===void 0)throw new Error(`Easing '${o}' not found`);if(U(J(s)),i<=s)throw new Error("Max should be greater than min");return()=>{const l=Ne(a(n()));return Math.floor(l*(i-s))+s}},SA=e=>G0(e)(),FA=(e=1)=>U0(e)(),U0=(e=1)=>{const i=()=>{const s=Il(),o=Il();let a=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*o);return a=a/10+.5,a>1||a<0?a=i():(a=Math.pow(a,e),a*=1,a+=0),a};return i},Il=(e=fe)=>{let r=0;for(;r===0;)r=e();return r},Za=e=>{if(typeof e>"u")throw new TypeError("maxOrOptions is undefined");const r=typeof e=="number"?{max:e}:e;let n=Math.floor(r.max),i=Math.floor(r.min??0);!r.min&&n<0&&(n=1,i=r.max);const s=r.source??fe;if(i>n)throw new Error(`Min value is greater than max (min: ${i} max: ${n})`);if(U(J(i,"","min")),U(J(n,"","max")),n===i)throw new Error(`Max and min values cannot be the same (${n})`);const o=Math.abs(n-i);return()=>Math.floor(s()*o)+i},Qa=e=>Za(e)(),H0=(e=1)=>cs(e)(),PA=(e={})=>{const r=e.source??fe,n=Math.trunc(r()*46656),i=Math.trunc(r()*46656),s=`000${n.toString(36)}`.slice(-3),o=`000${i.toString(36)}`.slice(-3);return s+o},J0=e=>{const r=typeof e=="number"?{max:e}:e,n=(r.min??0)*60*1e3,i=r.max*60*1e3;return Za({...r,max:i,min:n})},NA=e=>J0(e)(),Y0=e=>{const r=typeof e=="number"?{max:e}:e,n=(r.min??0)*1e3,i=r.max*1e3;return()=>Qa({...r,max:i,min:n})},kA=e=>Y0(e)();function*MA(e){const r=typeof e=="number"?{max:e}:e,n=r.min??0,i=r.max,s=r.source??fe,o=r.loop??!1;if(U(Tt(n,"","min")),U(Tt(i,"","max")),n>i)throw new Error(`Min value is greater than max. Min: ${n} Max: ${i}`);const a=[...j0(i-n,n)];let u=pn(a),l=0;for(;;){if(l===u.length)if(o)u=pn(a,s);else return;yield u[l++]}}var X=e=>{if(typeof e=="string"){const n=document.querySelector(e);if(n===null)throw e.startsWith("#")?new Error(`Query '${e}' did not match anything. Try '#id', 'div', or '.class'`):new Error(`Query '${e}' did not match anything. Did you mean '#${e}?`);e=n}else{if(e===null)throw new Error("Param 'domQueryOrEl' is null");if(e===void 0)throw new Error("Param 'domQueryOrEl' is undefined")}return e},pr=e=>e===void 0?[]:e===null?[]:Array.isArray(e)?e:typeof e=="string"?[...document.querySelectorAll(e)]:[e],X0={};E(X0,{button:()=>K0,buttonCreate:()=>TA,checkbox:()=>BA,numeric:()=>_A,select:()=>zA,textAreaKeyboard:()=>$A});var $A=e=>{e.addEventListener("keydown",r=>{const n=e.value,i=e.selectionStart,s=e.selectionEnd;if(r.key==="Tab"&&r.shiftKey)return e.value.substring(i-2,i)==="  "&&(e.value=n.slice(0,Math.max(0,i-2))+n.slice(Math.max(0,s))),e.selectionStart=e.selectionEnd=i-2,r.preventDefault(),!1;if(r.key==="Tab")return e.value=n.slice(0,Math.max(0,i))+"  "+n.slice(Math.max(0,s)),e.selectionStart=e.selectionEnd=i+2,r.preventDefault(),!1})},BA=(e,r)=>{const n=X(e);return r&&n.addEventListener("change",()=>{r(n.checked)}),{get checked(){return n.checked},set checked(i){n.checked=i}}},_A=(e,r,n)=>{const i=X(e),s=n?"change":"input";return r&&i.addEventListener(s,()=>{r(Number.parseInt(i.value))}),{get value(){return Number.parseInt(i.value)},set value(o){i.value=o.toString()}}},K0=(e,r)=>{const n=X(e),i=()=>{r&&n.addEventListener("click",r)},s=()=>{r&&n.removeEventListener("click",r)};return i(),{get title(){return n.textContent},set title(o){n.textContent=o},dispose(o=!1){s(),o&&n.remove()},onClick(o){s(),r=o,i()},click(){r&&r()},set disabled(o){n.disabled=o},get el(){return n}}},TA=(e,r)=>{const n=document.createElement("button"),i=K0(n,r);return i.title=e,i},zA=(e,r,n={})=>{const i=X(e),{placeholderOpt:s,shouldAddChoosePlaceholder:o=!1,autoSelectAfterChoice:a=-1}=n,u=()=>{r!==void 0&&r(i.value),a>=0&&(i.selectedIndex=a)};return r&&i.addEventListener("change",l=>{u()}),{set disabled(l){i.disabled=l},get value(){return i.value},get index(){return i.selectedIndex},get isSelectedPlaceholder(){return(o||n.placeholderOpt!==void 0)&&i.selectedIndex===0},setOpts(l,c){i.options.length=0,o?l=["-- Choose --",...l]:s!==void 0&&(l=[s,...l]);let f=0;for(const[d,h]of l.entries()){const y=document.createElement("option");y.value=h,y.innerHTML=h,c!==void 0&&h===c&&(f=d),i.options.add(y)}i.selectedIndex=f},select(l=0,c=!1){i.selectedIndex=l,c&&r&&u()}}},Z0={};E(Z0,{getSorter:()=>Q0,isPrimitive:()=>Qe,isPrimitiveOrObject:()=>RA,minMaxAvg:()=>IA});function Qe(e){return typeof e=="number"||typeof e=="string"||typeof e=="bigint"||typeof e=="boolean"}function RA(e){return!!(Qe(e)||typeof e=="object")}var ri=(e,r=!1)=>n=>{const i=n.toSorted((s,o)=>Vr(s[e],o[e]));return r?i.reverse():i},Q0=e=>{switch(e){case"value":return ri(1,!1);case"value-reverse":return ri(1,!0);case"key":return ri(0,!1);case"key-reverse":return ri(0,!0);default:throw new Error(`Unknown sorting value '${e}'. Expecting: value, value-reverse, key or key-reverse`)}},IA=(e,r)=>{const n=r??(s=>s[1]),i=e.map(s=>n(s));return kn(i)},ey={};E(ey,{chunks:()=>ny,chunksOverlapping:()=>VA,concat:()=>iy,dropWhile:()=>sy,equals:()=>ay,every:()=>uy,fill:()=>ly,filter:()=>fy,find:()=>dy,first:()=>LA,flatten:()=>hy,forEach:()=>cy,fromArray:()=>ds,fromIterable:()=>wy,last:()=>ry,map:()=>eu,max:()=>yy,min:()=>vy,reduce:()=>py,repeat:()=>OA,slice:()=>ea,some:()=>my,toArray:()=>xy,unique:()=>xo,uniqueByValue:()=>ty,until:()=>oy,yieldNumber:()=>jA,zip:()=>gy});function*ty(e,r=ot,n=new Set){for(const i of e){const s=r(i);n.has(s)||(n.add(s),yield i)}}function jA(e,r){return()=>{const n=e.next().value;return n===void 0?r:n}}function LA(e){for(const r of e)return r}function ry(e){let r;for(const n of e)r=n;return r}function*VA(e,r){if(r<=1)throw new Error("Size should be at least 2");let n=[];for(const i of e)n.push(i),n.length===r&&(yield n,n=[n.at(-1)]);n.length<=1||n.length>0&&(yield n)}function*ny(e,r){let n=[];for(const i of e)n.push(i),n.length===r&&(yield n,n=[]);n.length>0&&(yield n)}function*iy(...e){for(const r of e)yield*r}function*sy(e,r){for(const n of e)r(n)||(yield n)}var oy=(e,r)=>{for(const n of e){const i=r();if(typeof i=="boolean"&&!i)break}};function ay(e,r,n){for(;;){const i=e.next(),s=r.next();if(n!==void 0){if(!n(i.value,s.value))return!1}else if(i.value!==s.value)return!1;if(i.done??s.done)return i.done&&s.done}}function uy(e,r){for(const n of e)if(!r(n))return!1;return!0}function*ly(e,r){for(const n of e)yield r}function cy(e,r){for(const n of e){const i=r(n);if(typeof i=="boolean"&&!i)break}}function*fy(e,r){for(const n of e)r(n)&&(yield n)}function dy(e,r){for(const n of e)if(r(n))return n}function*hy(e){for(const r of e)if(typeof r=="object"){if(Array.isArray(r))for(const n of r)yield n;else if(Pn(r))for(const n of r)yield n}else yield r}function*eu(e,r){for(const n of e)yield r(n)}function*yy(e,r=(n,i)=>n>i){let n;for(const i of e){if(n===void 0){n=i,yield n;continue}r(i,n)&&(n=i,yield n)}return n}function*vy(e,r=(n,i)=>n>i){let n;for(const i of e)n===void 0&&(n=i,yield n),r(n,i)&&(n=i,yield n)}function py(e,r,n){for(const i of e)n=r(n,i);return n}function my(e,r){for(const n of e)if(r(n))return!0;return!1}function*OA(e,r){const n=typeof r=="number"?r:Number.POSITIVE_INFINITY,i=typeof r=="number"?void 0:r;let s=n;for(;;){for(const o of e())if(yield o,i?.aborted)break;if(Number.isFinite(n)&&(s--,s===0)||i?.aborted)break}}function*xo(e){const r=[];let n=[];n=Array.isArray(e)?e:[e];for(const i of n)for(const s of i)r.includes(s)||(r.push(s),yield s)}function*gy(...e){const r=e.map(n=>n[Symbol.iterator]());for(;;){const n=r.map(i=>i.next());if(n.some(i=>i.done))return;yield n.map(i=>i.value)}}function*wy(e){for(const r of e)yield r}function xy(e,r=Number.POSITIVE_INFINITY){const n=[];for(const i of e){if(n.length===r)break;n.push(i)}return n}function*ds(e){for(const r of e)yield r}var qA=(e,r,n)=>{const i=r.length+n.length,s=e.discardPolicy??"additions",o=e.capacity??i,a=i-o;switch(e.debug&&console.log(`Stack.push: stackLen: ${r.length} potentialLen: ${i} toRemove: ${a} policy: ${s}`),s){case"additions":return e.debug&&console.log(`Stack.push:DiscardAdditions: stackLen: ${r.length} slice: ${i-o} toAddLen: ${n.length}`),r.length===e.capacity?r:[...r,...n.slice(0,n.length-a)];case"newer":return a>=r.length?n.slice(Math.max(0,n.length-o),Math.min(n.length,o)+1):(e.debug&&console.log(` from orig: ${JSON.stringify(r.slice(0,r.length-a))}`),[...r.slice(0,r.length-a),...n.slice(0,Math.min(n.length,o-a+1))]);case"older":return[...r,...n].slice(a);default:throw new Error(`Unknown discard policy ${s}`)}},by=(e,r,...n)=>{const i=r.length+n.length;return e.capacity&&i>e.capacity?qA(e,r,n):[...r,...n]},Ey=(e,r)=>{if(r.length===0)throw new Error("Stack is empty");return r.slice(0,-1)},bo=(e,r)=>r.at(-1),Dy=(e,r)=>r.length===0,Ay=(e,r)=>e.capacity?r.length>=e.capacity:!1,Jr=class{opts;data;constructor(e={},r=[]){this.opts=e,this.data=r}push(...e){return e.length===0?this.data.length:(this.data=by(this.opts,this.data,...e),this.data.length)}forEach(e){this.data.forEach(e)}forEachFromTop(e){[...this.data].reverse().forEach(e)}pop(){const e=bo(this.opts,this.data);return this.data=Ey(this.opts,this.data),e}get isEmpty(){return Dy(this.opts,this.data)}get isFull(){return Ay(this.opts,this.data)}get peek(){return bo(this.opts,this.data)}get length(){return this.data.length}},WA=(e={},...r)=>new Jr({...e},[...r]),Cy={};E(Cy,{add:()=>au,addValue:()=>Mi,asDynamicTraversable:()=>jr,breadthFirst:()=>nu,children:()=>JA,childrenLength:()=>eC,compare:()=>GA,computeMaxDepth:()=>ZA,createNode:()=>Vn,depthFirst:()=>HA,findAnyChildByValue:()=>KA,findChildByValue:()=>XA,followValue:()=>_y,fromPlainObject:()=>My,getRoot:()=>ou,hasAnyChild:()=>hs,hasAnyParent:()=>ki,hasChild:()=>Fy,hasParent:()=>Ny,nodeDepth:()=>YA,parents:()=>su,queryByValue:()=>Py,remove:()=>ru,root:()=>ys,rootWrapped:()=>QA,setChildren:()=>By,stripParentage:()=>tu,throwTreeTest:()=>Sy,toStringDeep:()=>uu,treeTest:()=>iu,value:()=>tC,wrap:()=>$t});var GA=(e,r,n)=>lu(jr(e),jr(r),n),tu=e=>({value:e.value,childrenStore:e.childrenStore.map(n=>tu(n))}),xr=e=>"wraps"in e?e.wraps:e,UA=e=>"wraps"in e?e:$t(e),$t=e=>({*children(){for(const r of e.childrenStore)yield $t(r)},getValue:()=>e.value,getIdentity:()=>e,*queryValue(r){for(const n of Py(r,xr(e)))yield $t(n)},getParent:()=>e.parent===void 0?void 0:$t(e.parent),hasParent:r=>Ny(e,xr(r)),hasAnyParent:r=>ki(e,xr(r)),hasChild:r=>Fy(xr(r),e),hasAnyChild:r=>hs(xr(r),e),remove:()=>{ru(e)},addValue:r=>{const n=Mi(r,e);return $t(n)},add:r=>(au(xr(r),e),UA(r)),wraps:e}),ru=e=>{const r=e.parent;r!==void 0&&(e.parent=void 0,r.childrenStore=Mn(r.childrenStore,e))};function*HA(e){if(!ys)return;const r=new Jr;r.push(...e.childrenStore);let n=r.pop();for(;n&&(yield n,n&&r.push(...n.childrenStore),!r.isEmpty);)n=r.pop()}function*nu(e){if(!e)return;const r=new Re;r.enqueue(...e.childrenStore);let n=r.dequeue();for(;n&&(yield n,n&&r.enqueue(...n.childrenStore),!r.isEmpty);)n=r.dequeue()}function iu(e,r=[]){if(e.parent===e)return[!1,"Root has itself as parent",e];if(r.includes(e))return[!1,"Same node instance is appearing further in tree",e];if(r.push(e),gf(e.childrenStore))return[!1,"Children list contains duplicates",e];for(const n of e.childrenStore){if(n.parent!==e)return[!1,"Member of childrenStore does not have .parent set",n];if(hs(e,n))return[!1,"Child has parent as its own child",n];const i=iu(n,r);if(!i[0])return i}return[!0,"",e]}function Sy(e){const r=iu(e);if(!r[0])throw new Error(`${r[1]} Node: ${xn(r[2].value,30)}`,{cause:r[2]})}function*JA(e){for(const r of e.childrenStore)yield r}function*su(e){let r=e.parent;for(;r;)yield r,r=r.parent}function YA(e){return[...su(e)].length}var Fy=(e,r)=>{for(const n of r.childrenStore)if(n===e)return!0;return!1},XA=(e,r,n=G)=>{for(const i of r.childrenStore)if(n(e,i.value))return i};function*Py(e,r,n=G){for(const i of r.childrenStore)n(e,i.value)&&(yield i)}var hs=(e,r)=>{for(const n of nu(r))if(n===e)return!0;return!1},KA=(e,r,n=G)=>{for(const i of nu(r))if(n(i.value,e))return i},ou=e=>e.parent?ou(e.parent):e,ki=(e,r)=>{for(const n of su(e))if(n===r)return!0;return!1},Ny=(e,r)=>e.parent===r,ZA=e=>ky(e,0),ky=(e,r=0)=>{let n=r;for(const i of e.childrenStore)n=Math.max(n,ky(i,r+1));return n},au=(e,r)=>{$y(e,r);const n=e.parent;r.childrenStore=[...r.childrenStore,e],e.parent=r,n&&(n.childrenStore=Mn(n.childrenStore,e))},Mi=(e,r)=>Vn(e,r),ys=e=>Vn(e),My=(e,r="",n,i=[])=>{const s=Object.entries(e);n=n===void 0?ys():Mi({label:r,value:e},n);for(const o of s){const a=o[1];i.includes(a)||(i.push(a),typeof o[1]=="object"?My(a,o[0],n,i):Mi({label:o[0],value:a},n))}return n},QA=e=>$t(Vn(e)),Vn=(e,r)=>{const n={childrenStore:[],parent:r,value:e};return r!==void 0&&(r.childrenStore=[...r.childrenStore,n]),n},eC=e=>e.childrenStore.length,tC=e=>e.value,jr=e=>({*children(){for(const n of e.childrenStore)yield jr(n)},getParent(){if(e.parent!==void 0)return jr(e.parent)},getValue(){return e.value},getIdentity(){return e}}),$y=(e,r)=>{if(r===e)throw new Error("Cannot add self as child");if(e.parent!==r){if(ki(r,e))throw new Error("Child contains parent (1)",{cause:e});if(ki(e,r))throw new Error("Parent already contains child",{cause:e});if(hs(r,e))throw new Error("Child contains parent (2)",{cause:e})}},By=(e,r)=>{for(const n of r)$y(n,e);e.childrenStore=[...r];for(const n of r)n.parent=e},uu=(e,r=0)=>{const n=`${"  ".repeat(r)} + ${e.value?JSON.stringify(e.value):"-"}`;return e.childrenStore.length>0?n+`
`+e.childrenStore.map(i=>uu(i,r+1)).join(`
`):n};function*_y(e,r,n=1){for(const i of e.childrenStore){const s=i.value;s!==void 0&&r(s,n)&&(yield i.value,yield*_y(i,r,n+1))}}var lu=(e,r,n=Uo,i)=>{const s=Ty(e,r,n),o=rC(e,r,n),a={valueChanged:!s,a:e,b:r,added:o.added,removed:o.removed,childChanged:!1},u={value:a,childrenStore:[],parent:i},l=o.identical.map(f=>lu(f[0],f[1],n,u)),c=jl(a)||l.some(f=>jl(f.value));return By(u,l),u.toString=()=>zy(u,0),u.value.childChanged=c,Sy(u),u},jl=e=>e===void 0?!1:!!(e.valueChanged||e.childChanged||e.added.length>0||e.removed.length>0),rC=(e,r,n=Uo)=>{const i=[...e.children()],s=[...r.children()],o=[],a=[];for(const l of i){let c=-1;for(const[f,d]of s.entries())if(Ty(l,d,n)){o.push([l,d]),c=f;break}c===-1?a.push(l):s.splice(c,1)}return{added:[...s],identical:o,removed:a}},Ty=(e,r,n)=>!!(e.getIdentity()===r.getIdentity()||n(e.getValue(),r.getValue())),ni=e=>JSON.stringify(e.getValue()),zy=(e,r=0)=>{if(e===void 0)return"(undefined)";let n=nC(e.value,r);for(const i of e.childrenStore)n+=zy(i,r+2);return n},nC=(e,r)=>{const n=" ".repeat(r);if(e===void 0)return`${n}(undefined)`;const i=[];if(i.push(`a: ${ni(e.a)} b: ${ni(e.b)}`),e.valueChanged?i.push(`Value changed. Child changed: ${e.childChanged}`):i.push(`Value unchanged. Child changed: ${e.childChanged}`),e.added.length>0){i.push("Added:");for(const s of e.added)i.push(" - "+ni(s))}if(e.removed.length>0){i.push(`Removed: ${e.removed.length}`);for(const s of e.removed)i.push(" - "+ni(s))}return i.push(`----
`),i.map(s=>n+s).join(`
`)},Ry={};E(Ry,{asDynamicTraversable:()=>fu,children:()=>Yr,create:()=>du,createSimplified:()=>uC,createWrapped:()=>aC,depthFirst:()=>cu,getByPath:()=>oC,prettyPrint:()=>Iy,prettyPrintEntries:()=>iC,toStringDeep:()=>jy,traceByPath:()=>Ly});function iC(e){if(e.length===0)return"(empty)";let r="";for(const[n,i]of e.entries())r+="  ".repeat(n),r+=i.name+" = "+JSON.stringify(i.nodeValue)+`
`;return r}var Iy=(e,r=0,n={})=>{const i=n.name??"node",s=lC(e,i),o=`${"  ".repeat(r)} + name: ${s.name} value: ${JSON.stringify(s.nodeValue)}`,a=[...Yr(e,n)];return a.length>0?o+`
`+a.map(u=>Iy(u.nodeValue,r+1,{...n,name:u.name})).join(`
`):o},jy=(e,r=0)=>{let n=" ".repeat(r)+" "+e.value?.name;if(e.value!==void 0){if("sourceValue"in e.value&&"nodeValue"in e.value){let i=xn(e.value?.sourceValue,20);const s=xn(e.value?.nodeValue,20);i=i===s?"":"source: "+i,n+=` = ${s} ${i}`}else"value"in e.value&&e.value.value!==void 0&&(n+=` = ${e.value.value}`);"ancestors"in e.value&&(n+=` (ancestors: ${e.value.ancestors.join(", ")})`)}n+=`
`;for(const i of e.childrenStore)n+=jy(i,r+1);return n};function*Yr(e,r={}){const n=r.filter??"none",i=s=>n==="none"?[!0,Qe(s)]:n==="leaves"&&Qe(s)?[!0,!0]:n==="branches"&&!Qe(s)?[!0,!1]:[!1,Qe(s)];if(Array.isArray(e))for(const[s,o]of e.entries()){const a=i(o);a[0]&&(yield{name:s.toString(),sourceValue:o,nodeValue:a[1]?o:void 0})}else if(typeof e=="object"){const s="entries"in e?e.entries():Object.entries(e);for(const[o,a]of s){const u=i(a);u[0]&&(yield{name:o,sourceValue:a,nodeValue:u[1]?a:void 0})}}}function*cu(e,r={},n=[]){for(const i of Yr(e,r))yield{...i,ancestors:[...n]},yield*cu(i.sourceValue,r,[...n,i.name])}function sC(e,r){for(const n of Yr(r))if(n.name===e)return n}function oC(e,r,n={}){const i=ry(Ly(e,r,n));if(!i)throw new Error(`Could not trace path: ${e} `);return i}function*Ly(e,r,n={}){const i=n.separator??".",s=e.split(i),o=[];for(const a of s){const u=sC(a,r);if(!u){yield{name:a,sourceValue:void 0,nodeValue:void 0,ancestors:o};return}r=u.sourceValue,yield{...u,ancestors:[...o]},o.push(a)}}var fu=(e,r={},n=[],i)=>{const s=r.name??"object",o={*children(){for(const a of Yr(e,r))yield fu(a.sourceValue,{...r,name:a.name},[...n,s],o)},getParent(){return i},getValue(){return{name:s,value:e,ancestors:n}},getIdentity(){return e}};return o},aC=(e,r)=>$t(du(e,r)),du=(e,r={})=>{const i=r.valuesAtLeaves??!1?s=>{if(Qe(s))return s}:s=>s;return Vy(e,i(e),r,[])},Vy=(e,r,n={},i)=>{const s=n.name??"object_ci",o=ys({name:s,value:r,ancestors:[...i]});i=[...i,s];for(const a of Yr(e,n)){const u=n.valuesAtLeaves?a.nodeValue:a.sourceValue;au(Vy(a.sourceValue,u,{...n,name:a.name},i),o)}return o},uC=(e,r={})=>tu(du(e,r));function lC(e,r=""){return"name"in e&&"nodeValue"in e&&"sourceValue"in e?e:"name"in e?{name:e.name,nodeValue:e,sourceValue:e}:{name:r,nodeValue:e,sourceValue:e}}var Oy={};E(Oy,{FromObject:()=>Ry,Mutable:()=>Cy,Pathed:()=>qy,Traverse:()=>Yy,compare:()=>lu,isTraversable:()=>rv,isTreeNode:()=>tv,toTraversable:()=>AC});var qy={};E(qy,{addValueByPath:()=>Wy,childrenLengthByPath:()=>fC,clearValuesByPath:()=>Uy,create:()=>cC,removeByPath:()=>Gy,valueByPath:()=>Hy,valuesByPath:()=>yu});var cC=(e={})=>{let r;return{add:(d,h)=>{const y=Wy(d,h,r,e);r===void 0&&(r=ou(y))},prettyPrint:()=>r===void 0?"(empty)":uu(r),remove:d=>r===void 0?!1:Gy(d,r,e),getValue:d=>{if(r!==void 0)return Hy(d,r,e)},getValues:d=>r===void 0?[]:yu(d,r,e),hasPath:d=>r===void 0?!1:$r(d,r,e)!==void 0,childrenLength:d=>{if(r===void 0)return 0;const h=$r(d,r,e);return h===void 0?0:h.childrenStore.length},getNode:d=>r===void 0?void 0:$r(d,r,e),clearValues:d=>r===void 0?!1:Uy(d,r,e)}},Wy=(e,r,n,i={})=>{const s=i.separator??".",o=i.duplicates??"overwrite",a=r.split(s);let u=0;for(const l of a){const c=u===a.length-1,f=hu(l,n);if(f===void 0)n=Vn({value:c?e:void 0,label:l},n);else if(n=f,c)switch(o){case"ignore":break;case"allow":{const d=Jy(n);n.value={values:[...d,e],label:l};break}case"overwrite":{n.value={value:e,label:l};break}}else n=f;u++}if(n===void 0)throw new Error("Could not create tree");return n},Gy=(e,r,n={})=>{if(r===void 0)return!1;const i=$r(e,r,n);return i===void 0?!1:(ru(i),!0)},Uy=(e,r,n={})=>{if(r===void 0)return!1;const i=$r(e,r,n);return i===void 0?!1:(i.value={label:i.value?.label??"",value:void 0},!0)},fC=(e,r,n={})=>{if(r===void 0)return 0;const i=$r(e,r,n);return i===void 0?0:i.childrenStore.length},hu=(e,r)=>{if(r!==void 0){if(e===void 0)throw new Error("Parameter 'label' cannot be undefined");if(r.value?.label===e)return r;for(const n of r.childrenStore)if(n.value?.label===e)return n}},Hy=(e,r,n={})=>{const i=yu(e,r,n);if(i.length!==0){if(i.length>1)throw new Error("Multiple values at path. Use getValues instead");return i[0]}},Jy=e=>e.value===void 0?[]:"values"in e.value?e.value.values:"value"in e.value?e.value.value===void 0?[]:[e.value.value]:[],$r=(e,r,n={})=>{const i=n.separator??".",s=e.split(i);let o=r;for(const a of s)if(o=hu(a,o),o===void 0)return;return o},yu=(e,r,n={})=>{const i=n.separator??".",s=e.split(i);let o=r;for(const a of s)if(o=hu(a,o),o===void 0)return[];return Jy(o)},Yy={};E(Yy,{breadthFirst:()=>Xr,childrenLength:()=>dC,couldAddChild:()=>pC,depthFirst:()=>gu,find:()=>bC,findAnyChildByValue:()=>xC,findAnyParentByValue:()=>vC,findByValue:()=>EC,findChildByValue:()=>Zy,findParentByValue:()=>mu,followValue:()=>Qy,hasAnyChild:()=>Eo,hasAnyChildValue:()=>mC,hasAnyParent:()=>hC,hasAnyParentValue:()=>yC,hasChild:()=>Xy,hasChildValue:()=>Ky,hasParent:()=>vu,hasParentValue:()=>pu,parents:()=>wC,siblings:()=>gC,toString:()=>DC,toStringDeep:()=>ev});var dC=e=>[...e.children()].length,hC=(e,r,n)=>vu(e,r,n,Number.MAX_SAFE_INTEGER),yC=(e,r,n)=>pu(e,r,n,Number.MAX_SAFE_INTEGER),vC=(e,r,n)=>mu(e,r,n,Number.MAX_SAFE_INTEGER),vu=(e,r,n=G,i=0)=>{if(i<0)return!1;const s=e.getParent();return s===void 0?!1:n(s,r)||n(s.getIdentity(),r.getIdentity())?!0:vu(s,r,n,i-1)},pu=(e,r,n=G,i=0)=>{if(i<0)return!1;const s=e.getParent();return s===void 0?!1:n(s.getValue(),r)?!0:pu(s,r,n,i-1)},mu=(e,r,n=G,i=0)=>{if(i<0)return;const s=e.getParent();if(s!==void 0)return n(s.getValue(),r)?s:mu(s,r,n,i-1)},pC=(e,r,n=G)=>{if(n(e,r))throw new Error("Child equals parent");if(Eo(e,r,n))throw new Error("Circular. Parent already has child");if(Eo(r,e,n))throw new Error("Prospective child has parent as child relation")},Eo=(e,r,n=G)=>Xy(e,r,n,Number.MAX_SAFE_INTEGER),mC=(e,r,n=G)=>Ky(e,r,n,Number.MAX_SAFE_INTEGER),Xy=(e,r,n=G,i=0)=>{if(i<0)return!1;if(n(e,r)||n(e.getIdentity(),r.getIdentity()))return!0;for(const s of Xr(e,i))if(n(s,r)||n(s.getIdentity(),r.getIdentity()))return!0;return!1},Ky=(e,r,n=G,i=0)=>{if(i<0)return!1;if(n(e.getValue(),r))return!0;for(const s of Xr(e,i))if(n(s.getValue(),r))return!0;return!1};function*gC(e){const r=e.getParent();if(r!==void 0)for(const n of r.children())n!==e&&(yield n)}function*wC(e){let r=e.getParent();for(;r!==void 0;)yield r,r=r.getParent()}var xC=(e,r,n=G)=>Zy(e,r,n,Number.MAX_SAFE_INTEGER),Zy=(e,r,n=G,i=0)=>{if(!(i<0)){if(n(e.getValue(),r))return e;for(const s of Xr(e,i))if(n(s.getValue(),r))return s}};function*gu(e){if(!e)return;const r=new Jr;let n=e;for(;n;){const i=[...n.children()];if(r.push(...i),r.isEmpty)break;n=r.pop(),n&&(yield n)}}function*Xr(e,r=Number.MAX_SAFE_INTEGER){if(!e)return;const n=new Re;let i=e;for(;i;){if(r<0)return;for(const s of i.children())yield s,n.enqueue(s);i=n.dequeue(),r--}}function bC(e,r,n="breadth"){if(r(e))return e;const i=n==="breadth"?Xr:gu;for(const s of i(e))if(r(s))return s}function EC(e,r,n="breadth"){if(r(e.getValue()))return e;const i=n==="breadth"?Xr:gu;for(const s of i(e))if(r(s.getValue()))return s}function*Qy(e,r,n=1){for(const i of e.children())r(i.getValue(),n)&&(yield i.getValue(),yield*Qy(i,r,n+1))}function ev(e,r=0){if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=e.getValue();let i=typeof n;Array.isArray(n)&&(i="array");let s="  ".repeat(r)+`value: ${JSON.stringify(n)} (${i})
`;for(const o of e.children())s+=ev(o,r+1);return s}function DC(...e){let r="";for(const n of e){const i=n.getValue(),s=xn(i),o=[...n.children()],a=n.getParent();let u=typeof i;Array.isArray(i)&&(u="array"),r+=`value: ${s} (${u}) kids: ${o.length} parented: ${a?"y":"n"}
`}return r}var AC=e=>{if(rv(e))return e;if(tv(e))return jr(e);if(typeof e=="object")return fu(e);throw new Error("Parameter 'node' not convertible")},tv=e=>!!("parent"in e&&"childrenStore"in e&&"value"in e&&Array.isArray(e.childrenStore)),rv=e=>"children"in e&&"getParent"in e&&"getValue"in e&&"getIdentity"in e,wu={};E(wu,{QueueMutable:()=>Re,immutable:()=>CC,mutable:()=>t0,priority:()=>SC});var nv=class Do{opts;data;constructor(r={},n=[]){if(r===void 0)throw new Error("opts parameter undefined");this.opts=r,this.data=n}forEach(r){for(let n=this.data.length-1;n>=0;n--)r(this.data[n])}forEachFromFront(r){this.data.forEach(r)}enqueue(...r){return new Do(this.opts,Kh(this.opts,this.data,...r))}dequeue(){return new Do(this.opts,Zh(this.opts,this.data))}get isEmpty(){return Qh(this.opts,this.data)}get isFull(){return e0(this.opts,this.data)}get length(){return this.data.length}get peek(){return po(this.opts,this.data)}},CC=(e={},...r)=>(e={...e},new nv(e,[...r])),iv=class extends Re{constructor(e={}){e.eq===void 0&&(e={...e,eq:(r,n)=>G(r.item,n.item)}),super(e)}enqueueWithPriority(e,r){super.enqueue({item:e,priority:r})}changePriority(e,r,n=!1,i){if(e===void 0)throw new Error("Item cannot be undefined");let s;for(const o of this.data)if(i){if(i(o.item,e)){s=o;break}}else if(this.eq(o,{item:e,priority:0})){s=o;break}if(s===void 0&&!n)throw new Error(`Item not found in priority queue. Item: ${JSON.stringify(e)}`);s!==void 0&&this.remove(s),this.enqueueWithPriority(e,r)}dequeueMax(){const e=io(this.data,r=>r.priority);if(e!==void 0)return this.remove(e),e.item}dequeueMin(){const e=so(this.data,r=>r.priority);if(e!==void 0)return this.remove(e),e.item}peekMax(){const e=io(this.data,r=>r.priority);if(e!==void 0)return e.item}peekMin(){const e=so(this.data,r=>r.priority);if(e!==void 0)return e.item}};function SC(e={}){return new iv(e)}var Dn={};E(Dn,{ExpiringMap:()=>sv,MapOfMutableImpl:()=>vs,MapOfSimpleMutable:()=>Lc,NumberMap:()=>dv,addKeepingExisting:()=>Yc,addObject:()=>no,deleteByValue:()=>Tw,expiringMap:()=>FC,filter:()=>Zc,find:()=>ef,firstEntryByIterablePredicate:()=>zw,firstEntryByIterableValue:()=>Rw,fromIterable:()=>Qc,fromObject:()=>jw,getClosestIntegerKey:()=>Bw,getFromKeys:()=>Jc,getOrGenerate:()=>Jh,getOrGenerateSync:()=>Hh,hasAnyValue:()=>Kc,hasKeyValue:()=>_w,immutable:()=>Je,mapOfSimpleMutable:()=>Vc,mapToArray:()=>Ww,mapToObjectTransform:()=>Vw,mergeByKey:()=>Gw,mutable:()=>_C,ofArrayMutable:()=>hv,ofCircularMutable:()=>fv,ofSetMutable:()=>TC,some:()=>Lw,sortByValue:()=>Iw,sortByValueProperty:()=>Xc,toArray:()=>ro,toObject:()=>qw,transformMap:()=>Ow,zipKeyValue:()=>ji});var FC=(e={})=>new sv(e),sv=class extends Le{capacity;store;evictPolicy;autoDeleteElapsedMs;autoDeletePolicy;constructor(e={}){if(super(),this.capacity=e.capacity??-1,le(this.capacity,"nonZero","capacity"),this.store=new Map,e.evictPolicy&&this.capacity<=0)throw new Error("evictPolicy is set, but no capacity limit is set");this.evictPolicy=e.evictPolicy??"none",this.autoDeleteElapsedMs=e.autoDeleteElapsedMs??-1,this.autoDeletePolicy=e.autoDeletePolicy??"none",this.autoDeleteElapsedMs>0&&setInterval(()=>{this.#e()},Math.max(1e3,this.autoDeleteElapsedMs*2))}get keyLength(){return this.store.size}*entries(){for(const e of this.store.entries())yield[e[0],e[1].value]}*values(){for(const e of this.store.values())yield e.value}*keys(){yield*this.store.keys()}elapsedSet(e){const r=this.store.get(e);return r&&Date.now()-r.lastSet}elapsedGet(e){const r=this.store.get(e);return r&&Date.now()-r.lastGet}has(e){return this.store.has(e)}get(e){const r=this.store.get(e);if(r)return r.value}delete(e){const r=this.store.get(e);if(!r)return!1;const n=this.store.delete(e);return this.fireEvent("removed",{key:e,value:r.value}),n}clear(){this.store.clear()}touch(e){const r=this.store.get(e);return r?(this.store.set(e,{...r,lastSet:Date.now(),lastGet:Date.now()}),!0):!1}findEvicteeKey(){if(this.evictPolicy==="none")return;let e="";if(this.evictPolicy==="oldestGet")e="lastGet";else if(this.evictPolicy==="oldestSet")e="lastSet";else throw new Error(`Unknown eviction policy ${this.evictPolicy}`);return Xc(this.store,e)[0][0]}#e(){this.autoDeletePolicy!=="none"&&this.deleteWithElapsed(this.autoDeleteElapsedMs,this.autoDeletePolicy)}deleteWithElapsed(e,r){const n=[...this.store.entries()],i=[],s=V(e,1e3),o=Date.now();for(const a of n){const u=o-a[1].lastGet,l=o-a[1].lastSet;(r==="get"?u:r==="set"?l:Math.max(u,l))>=s&&i.push([a[0],a[1].value])}for(const a of i){this.store.delete(a[0]);const u={key:a[0],value:a[1]};this.fireEvent("expired",u),this.fireEvent("removed",u)}return i}set(e,r){const n=this.store.get(e);if(n){this.store.set(e,{...n,lastSet:performance.now()});return}if(this.keyLength===this.capacity&&this.capacity>0){const i=this.findEvicteeKey();if(!i)throw new Error(`ExpiringMap full (capacity: ${this.capacity})`);const s=this.store.get(i);if(this.store.delete(i),s){const o={key:i,value:s.value};this.fireEvent("expired",o),this.fireEvent("removed",o)}}this.store.set(e,{lastGet:0,lastSet:Date.now(),value:r}),this.fireEvent("newKey",{key:e,value:r})}},PC={};E(PC,{Arrays:()=>Dt,Iterables:()=>hf,Maps:()=>Dn,QueueImmutable:()=>nv,QueueMutable:()=>Re,Queues:()=>wu,SetStringImmutable:()=>Uc,SetStringMutable:()=>Gc,Sets:()=>qc,StackImmutable:()=>$i,StackMutable:()=>Jr,Stacks:()=>uv,Trees:()=>Oy,circularArray:()=>av});var NC=class ov extends Array{#e;#t;constructor(r=0){super(),le(r,"positive","capacity"),this.#e=r,this.#t=0}add(r){const n=ov.from(this);return n[this.#t]=r,n.#e=this.#e,this.#e>0?n.#t=this.#t+1===this.#e?0:this.#t+1:n.#t=this.#t+1,n}get pointer(){return this.#t}get isFull(){return this.#e===0?!1:this.length===this.#e}},av=e=>new NC(e),uv={};E(uv,{immutable:()=>kC,mutable:()=>WA});var $i=class Ao{opts;data;constructor(r={},n=[]){this.opts=r,this.data=n}push(...r){return new Ao(this.opts,by(this.opts,this.data,...r))}pop(){return new Ao(this.opts,Ey(this.opts,this.data))}forEach(r){this.data.forEach(r)}forEachFromTop(r){[...this.data].reverse().forEach(r)}get isEmpty(){return Dy(this.opts,this.data)}get isFull(){return Ay(this.opts,this.data)}get peek(){return bo(this.opts,this.data)}get length(){return this.data.length}},kC=(e={},...r)=>new $i({...e},[...r]),MC=(e,r)=>{const n=new Map(e.entries());for(const i of r){if(i[0]===void 0)throw new Error("key cannot be undefined");if(i[1]===void 0)throw new Error("value cannot be undefined");n.set(i[0],i[1])}return n},$C=(e,r)=>{const n=new Map(e.entries());for(const i of r){if(i.key===void 0)throw new Error("key cannot be undefined");if(i.value===void 0)throw new Error("value cannot be undefined");n.set(i.key,i.value)}return n},BC=(e,r)=>e.has(r),fn=(e,...r)=>{if(e===void 0)throw new Error("map parameter is undefined");if(r===void 0)throw new Error("data parameter i.s undefined");if(r.length===0)return e;const n=r[0];return typeof n.key<"u"&&typeof n.value<"u"?$C(e,r):MC(e,r)},lv=(e,r,n)=>{const i=new Map(e.entries());return i.set(r,n),i},cv=(e,r)=>{const n=new Map(e.entries());return n.delete(r),n},Je=e=>{if(e===void 0)return Je([]);if(Array.isArray(e))return Je(fn(new Map,...e));const r=e;return{add:(...n)=>{const i=fn(r,...n);return Je(i)},set:(n,i)=>{const s=lv(r,n,i);return Je(s)},get:n=>r.get(n),delete:n=>Je(cv(r,n)),clear:()=>Je(),has:n=>r.has(n),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0}},_C=(...e)=>{let r=fn(new Map,...e);return{add:(...n)=>{r=fn(r,...n)},delete:n=>{r=cv(r,n)},clear:()=>{r=fn(new Map)},set:(n,i)=>{r=lv(r,n,i)},get:n=>r.get(n),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0,has:n=>BC(r,n)}},vs=class extends Le{#e=new Map;groupBy;type;constructor(e,r={}){super(),this.type=e,this.groupBy=r.groupBy??ot}get typeName(){return this.type.name}get lengthKeys(){return this.#e.size}get lengthMax(){let e=0;for(const r of this.#e.values())e=Math.max(e,this.type.count(r));return e}debugString(){const e=[...this.#e.keys()];let r=`Keys: ${e.join(", ")}\r
`;for(const n of e){const i=this.#e.get(n);if(i===void 0)r+=` - ${n} (undefined)\r
`;else{const s=this.type.toArray(i);s!==void 0&&(r+=` - ${n} (${this.type.count(i)}) = ${JSON.stringify(s)}\r
`)}}return r}get isEmpty(){return this.#e.size===0}clear(){this.#e.clear(),super.fireEvent("clear",!0)}addKeyedValues(e,...r){const n=this.#e.get(e);n===void 0?(this.#e.set(e,this.type.add(void 0,r)),super.fireEvent("addedKey",{key:e}),super.fireEvent("addedValues",{values:r})):(this.#e.set(e,this.type.add(n,r)),super.fireEvent("addedValues",{values:r}))}set(e,r){return this.addKeyedValues(e,...r),this}addValue(...e){for(const r of e)this.addKeyedValues(this.groupBy(r),r)}hasKeyValue(e,r,n){const i=this.#e.get(e);return i===void 0?!1:this.type.has(i,r,n)}has(e){return this.#e.has(e)}deleteKeyValue(e,r){const n=this.#e.get(e);return n===void 0?!1:this.deleteKeyValueFromMap(n,e,r)}deleteKeyValueFromMap(e,r,n){const i=this.type.count(e),s=this.type.without(e,n),o=s.length;return this.#e.set(r,this.type.add(void 0,s)),i>o}deleteByValue(e){let r=!1;return[...this.#e.keys()].filter(n=>{const i=this.#e.get(n);if(!i)throw new Error("Bug: map could not be accessed");this.deleteKeyValueFromMap(i,n,e)&&(r=!0,this.count(n)===0&&this.delete(n))}),r}delete(e){return this.#e.get(e)===void 0?!1:(this.#e.delete(e),this.fireEvent("deleteKey",{key:e}),!0)}firstKeyByValue(e,r=G){return[...this.#e.keys()].find(s=>{const o=this.#e.get(s);if(o===void 0)throw new Error("Bug: map could not be accessed");return this.type.has(o,e,r)})}count(e){const r=this.#e.get(e);return r===void 0?0:this.type.count(r)}*get(e){const r=this.#e.get(e);r!==void 0&&(yield*this.type.iterable(r))}*valuesFor(e){const r=this.#e.get(e);r!==void 0&&(yield*this.type.iterable(r))}getSource(e){return this.#e.get(e)}*keys(){yield*this.#e.keys()}*entriesFlat(){for(const e of this.#e.entries())for(const r of this.type.iterable(e[1]))yield[e[0],r]}*valuesFlat(){for(const e of this.#e.entries())yield*this.type.iterable(e[1])}*entries(){for(const[e,r]of this.#e.entries()){const n=[...this.type.iterable(r)];yield[e,n]}}*keysAndCounts(){for(const e of this.keys())yield[e,this.count(e)]}merge(e){for(const r of e.keys()){const n=e.get(r);this.addKeyedValues(r,...n)}}get size(){return this.#e.size}get[Symbol.toStringTag](){return this.#e[Symbol.toStringTag]}},TC=e=>{const r=e?.hash??ot,n=(o,a)=>r(o)===r(a),i={get name(){return"set"},iterable:o=>o.values(),add:(o,a)=>Yc(o,r,...a),count:o=>o.size,find:(o,a)=>ef(o,a),filter:(o,a)=>Zc(o,a),toArray:o=>ro(o),has:(o,a)=>Kc(o,a,n),without:(o,a)=>Mn(ro(o),a,n)};return new vs(i,e)},fv=e=>{const r=G,n={get name(){return"circular"},add:(i,s)=>{i===void 0&&(i=av(e.capacity));for(const o of s)i=i.add(o);return i},count:i=>i.length,find:(i,s)=>i.find(s),filter:(i,s)=>i.filter(s),toArray:i=>i,iterable:i=>i.values(),has:(i,s)=>i.find(o=>r(o,s))!==void 0,without:(i,s)=>i.filter(o=>!r(o,s))};return new vs(n,e)},dv=class extends Map{defaultValue;constructor(e=0){super(),this.defaultValue=e}get(e){const r=super.get(e);return r===void 0?this.defaultValue:r}reset(e){return super.set(e,this.defaultValue),this.defaultValue}multiply(e,r){let i=super.get(e)??this.defaultValue;return i*=r,super.set(e,i),i}add(e,r=1){let i=super.get(e)??this.defaultValue;return i+=r,super.set(e,i),i}subtract(e,r=1){let i=super.get(e)??this.defaultValue;return i-=r,super.set(e,i),i}},hv=(e={})=>{const r=e.convertToString,n=typeof r>"u"?G:(a,u)=>r(a)===r(u),i=e.comparer??n,s={get name(){return"array"},add:(a,u)=>a===void 0?[...u]:[...a,...u],iterable:a=>a.values(),count:a=>a.length,find:(a,u)=>a.find(l=>u(l)),filter:(a,u)=>a.filter(l=>u(l)),toArray:a=>a,has:(a,u)=>a.some(l=>i(l,u)),without:(a,u)=>a.filter(l=>!i(l,u))};return new vs(s,e)},xu=Pg({"node_modules/json5/dist/index.js"(e,r){(function(n,i){typeof e=="object"&&typeof r<"u"?r.exports=i():typeof define=="function"&&define.amd?define(i):n.JSON5=i()})(e,function(){function n(p,w){return w={exports:{}},p(w,w.exports),w.exports}var i=n(function(p){var w=p.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=w)}),s=n(function(p){var w=p.exports={version:"2.6.5"};typeof __e=="number"&&(__e=w)});s.version;var o=function(p){return typeof p=="object"?p!==null:typeof p=="function"},a=function(p){if(!o(p))throw TypeError(p+" is not an object!");return p},u=function(p){try{return!!p()}catch{return!0}},l=!u(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),c=i.document,f=o(c)&&o(c.createElement),d=function(p){return f?c.createElement(p):{}},h=!l&&!u(function(){return Object.defineProperty(d("div"),"a",{get:function(){return 7}}).a!=7}),y=function(p,w){if(!o(p))return p;var k,N;if(typeof(k=p.toString)=="function"&&!o(N=k.call(p))||typeof(k=p.valueOf)=="function"&&!o(N=k.call(p)))return N;throw TypeError("Can't convert object to primitive value")},v=Object.defineProperty,m=l?Object.defineProperty:function(w,k,N){if(a(w),k=y(k),a(N),h)try{return v(w,k,N)}catch{}if("get"in N||"set"in N)throw TypeError("Accessors not supported!");return"value"in N&&(w[k]=N.value),w},g={f:m},x=function(p,w){return{enumerable:!(p&1),configurable:!(p&2),writable:!(p&4),value:w}},F=l?function(p,w,k){return g.f(p,w,x(1,k))}:function(p,w,k){return p[w]=k,p},M={}.hasOwnProperty,j=function(p,w){return M.call(p,w)},A=0,C=Math.random(),$=function(p){return"Symbol(".concat(p,")_",(++A+C).toString(36))},T=n(function(p){var w="__core-js_shared__",k=i[w]||(i[w]={});(p.exports=function(N,B){return k[N]||(k[N]=B!==void 0?B:{})})("versions",[]).push({version:s.version,mode:"global",copyright:" 2019 Denis Pushkarev (zloirock.ru)"})}),Y=T("native-function-to-string",Function.toString),ie=n(function(p){var w=$("src"),k="toString",N=(""+Y).split(k);s.inspectSource=function(B){return Y.call(B)},(p.exports=function(B,O,W,Fe){var he=typeof W=="function";he&&(j(W,"name")||F(W,"name",O)),B[O]!==W&&(he&&(j(W,w)||F(W,w,B[O]?""+B[O]:N.join(String(O)))),B===i?B[O]=W:Fe?B[O]?B[O]=W:F(B,O,W):(delete B[O],F(B,O,W)))})(Function.prototype,k,function(){return typeof this=="function"&&this[w]||Y.call(this)})}),te=function(p){if(typeof p!="function")throw TypeError(p+" is not a function!");return p},se=function(p,w,k){if(te(p),w===void 0)return p;switch(k){case 1:return function(N){return p.call(w,N)};case 2:return function(N,B){return p.call(w,N,B)};case 3:return function(N,B,O){return p.call(w,N,B,O)}}return function(){return p.apply(w,arguments)}},ye="prototype",K=function(p,w,k){var N=p&K.F,B=p&K.G,O=p&K.S,W=p&K.P,Fe=p&K.B,he=B?i:O?i[w]||(i[w]={}):(i[w]||{})[ye],Gt=B?s:s[w]||(s[w]={}),mr=Gt[ye]||(Gt[ye]={}),Ue,Ze,Pe,gr;B&&(k=w);for(Ue in k)Ze=!N&&he&&he[Ue]!==void 0,Pe=(Ze?he:k)[Ue],gr=Fe&&Ze?se(Pe,i):W&&typeof Pe=="function"?se(Function.call,Pe):Pe,he&&ie(he,Ue,Pe,p&K.U),Gt[Ue]!=Pe&&F(Gt,Ue,gr),W&&mr[Ue]!=Pe&&(mr[Ue]=Pe)};i.core=s,K.F=1,K.G=2,K.S=4,K.P=8,K.B=16,K.W=32,K.U=64,K.R=128;var Ot=K,Ym=Math.ceil,Xm=Math.floor,ul=function(p){return isNaN(p=+p)?0:(p>0?Xm:Ym)(p)},Km=function(p){if(p==null)throw TypeError("Can't call method on  "+p);return p},Zm=function(p){return function(w,k){var N=String(Km(w)),B=ul(k),O=N.length,W,Fe;if(!(B<0||B>=O))return W=N.charCodeAt(B),W<55296||W>56319||B+1===O||(Fe=N.charCodeAt(B+1))<56320||Fe>57343?W:(W-55296<<10)+(Fe-56320)+65536}},Qm=Zm();Ot(Ot.P,"String",{codePointAt:function(w){return Qm(this,w)}}),s.String.codePointAt;var eg=Math.max,tg=Math.min,rg=function(p,w){return p=ul(p),p<0?eg(p+w,0):tg(p,w)},ll=String.fromCharCode,cl=String.fromCodePoint;Ot(Ot.S+Ot.F*(!!cl&&cl.length!=1),"String",{fromCodePoint:function(w){for(var k=arguments,N=[],B=arguments.length,O=0,W;B>O;){if(W=+k[O++],rg(W,1114111)!==W)throw RangeError(W+" is not a valid code point");N.push(W<65536?ll(W):ll(((W-=65536)>>10)+55296,W%1024+56320))}return N.join("")}}),s.String.fromCodePoint;var ng=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,ig=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,sg=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Ss={Space_Separator:ng,ID_Start:ig,ID_Continue:sg},ce={isSpaceSeparator:function(w){return typeof w=="string"&&Ss.Space_Separator.test(w)},isIdStartChar:function(w){return typeof w=="string"&&(w>="a"&&w<="z"||w>="A"&&w<="Z"||w==="$"||w==="_"||Ss.ID_Start.test(w))},isIdContinueChar:function(w){return typeof w=="string"&&(w>="a"&&w<="z"||w>="A"&&w<="Z"||w>="0"&&w<="9"||w==="$"||w==="_"||w===""||w===""||Ss.ID_Continue.test(w))},isDigit:function(w){return typeof w=="string"&&/[0-9]/.test(w)},isHexDigit:function(w){return typeof w=="string"&&/[0-9A-Fa-f]/.test(w)}},Fs,Se,ct,Un,Pt,Ge,ve,Ps,Zr,og=function(w,k){Fs=String(w),Se="start",ct=[],Un=0,Pt=1,Ge=0,ve=void 0,Ps=void 0,Zr=void 0;do ve=ag(),cg[Se]();while(ve.type!=="eof");return typeof k=="function"?Ns({"":Zr},"",k):Zr};function Ns(p,w,k){var N=p[w];if(N!=null&&typeof N=="object")if(Array.isArray(N))for(var B=0;B<N.length;B++){var O=String(B),W=Ns(N,O,k);W===void 0?delete N[O]:Object.defineProperty(N,O,{value:W,writable:!0,enumerable:!0,configurable:!0})}else for(var Fe in N){var he=Ns(N,Fe,k);he===void 0?delete N[Fe]:Object.defineProperty(N,Fe,{value:he,writable:!0,enumerable:!0,configurable:!0})}return k.call(p,w,N)}var L,z,Qr,ft,q;function ag(){for(L="default",z="",Qr=!1,ft=1;;){q=dt();var p=fl[L]();if(p)return p}}function dt(){if(Fs[Un])return String.fromCodePoint(Fs.codePointAt(Un))}function b(){var p=dt();return p===`
`?(Pt++,Ge=0):p?Ge+=p.length:Ge++,p&&(Un+=p.length),p}var fl={default:function(){switch(q){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":b();return;case"/":b(),L="comment";return;case void 0:return b(),Q("eof")}if(ce.isSpaceSeparator(q)){b();return}return fl[Se]()},comment:function(){switch(q){case"*":b(),L="multiLineComment";return;case"/":b(),L="singleLineComment";return}throw ee(b())},multiLineComment:function(){switch(q){case"*":b(),L="multiLineCommentAsterisk";return;case void 0:throw ee(b())}b()},multiLineCommentAsterisk:function(){switch(q){case"*":b();return;case"/":b(),L="default";return;case void 0:throw ee(b())}b(),L="multiLineComment"},singleLineComment:function(){switch(q){case`
`:case"\r":case"\u2028":case"\u2029":b(),L="default";return;case void 0:return b(),Q("eof")}b()},value:function(){switch(q){case"{":case"[":return Q("punctuator",b());case"n":return b(),qt("ull"),Q("null",null);case"t":return b(),qt("rue"),Q("boolean",!0);case"f":return b(),qt("alse"),Q("boolean",!1);case"-":case"+":b()==="-"&&(ft=-1),L="sign";return;case".":z=b(),L="decimalPointLeading";return;case"0":z=b(),L="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":z=b(),L="decimalInteger";return;case"I":return b(),qt("nfinity"),Q("numeric",1/0);case"N":return b(),qt("aN"),Q("numeric",NaN);case'"':case"'":Qr=b()==='"',z="",L="string";return}throw ee(b())},identifierNameStartEscape:function(){if(q!=="u")throw ee(b());b();var w=ks();switch(w){case"$":case"_":break;default:if(!ce.isIdStartChar(w))throw dl();break}z+=w,L="identifierName"},identifierName:function(){switch(q){case"$":case"_":case"":case"":z+=b();return;case"\\":b(),L="identifierNameEscape";return}if(ce.isIdContinueChar(q)){z+=b();return}return Q("identifier",z)},identifierNameEscape:function(){if(q!=="u")throw ee(b());b();var w=ks();switch(w){case"$":case"_":case"":case"":break;default:if(!ce.isIdContinueChar(w))throw dl();break}z+=w,L="identifierName"},sign:function(){switch(q){case".":z=b(),L="decimalPointLeading";return;case"0":z=b(),L="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":z=b(),L="decimalInteger";return;case"I":return b(),qt("nfinity"),Q("numeric",ft*(1/0));case"N":return b(),qt("aN"),Q("numeric",NaN)}throw ee(b())},zero:function(){switch(q){case".":z+=b(),L="decimalPoint";return;case"e":case"E":z+=b(),L="decimalExponent";return;case"x":case"X":z+=b(),L="hexadecimal";return}return Q("numeric",ft*0)},decimalInteger:function(){switch(q){case".":z+=b(),L="decimalPoint";return;case"e":case"E":z+=b(),L="decimalExponent";return}if(ce.isDigit(q)){z+=b();return}return Q("numeric",ft*Number(z))},decimalPointLeading:function(){if(ce.isDigit(q)){z+=b(),L="decimalFraction";return}throw ee(b())},decimalPoint:function(){switch(q){case"e":case"E":z+=b(),L="decimalExponent";return}if(ce.isDigit(q)){z+=b(),L="decimalFraction";return}return Q("numeric",ft*Number(z))},decimalFraction:function(){switch(q){case"e":case"E":z+=b(),L="decimalExponent";return}if(ce.isDigit(q)){z+=b();return}return Q("numeric",ft*Number(z))},decimalExponent:function(){switch(q){case"+":case"-":z+=b(),L="decimalExponentSign";return}if(ce.isDigit(q)){z+=b(),L="decimalExponentInteger";return}throw ee(b())},decimalExponentSign:function(){if(ce.isDigit(q)){z+=b(),L="decimalExponentInteger";return}throw ee(b())},decimalExponentInteger:function(){if(ce.isDigit(q)){z+=b();return}return Q("numeric",ft*Number(z))},hexadecimal:function(){if(ce.isHexDigit(q)){z+=b(),L="hexadecimalInteger";return}throw ee(b())},hexadecimalInteger:function(){if(ce.isHexDigit(q)){z+=b();return}return Q("numeric",ft*Number(z))},string:function(){switch(q){case"\\":b(),z+=ug();return;case'"':if(Qr)return b(),Q("string",z);z+=b();return;case"'":if(!Qr)return b(),Q("string",z);z+=b();return;case`
`:case"\r":throw ee(b());case"\u2028":case"\u2029":fg(q);break;case void 0:throw ee(b())}z+=b()},start:function(){switch(q){case"{":case"[":return Q("punctuator",b())}L="value"},beforePropertyName:function(){switch(q){case"$":case"_":z=b(),L="identifierName";return;case"\\":b(),L="identifierNameStartEscape";return;case"}":return Q("punctuator",b());case'"':case"'":Qr=b()==='"',L="string";return}if(ce.isIdStartChar(q)){z+=b(),L="identifierName";return}throw ee(b())},afterPropertyName:function(){if(q===":")return Q("punctuator",b());throw ee(b())},beforePropertyValue:function(){L="value"},afterPropertyValue:function(){switch(q){case",":case"}":return Q("punctuator",b())}throw ee(b())},beforeArrayValue:function(){if(q==="]")return Q("punctuator",b());L="value"},afterArrayValue:function(){switch(q){case",":case"]":return Q("punctuator",b())}throw ee(b())},end:function(){throw ee(b())}};function Q(p,w){return{type:p,value:w,line:Pt,column:Ge}}function qt(p){for(var w=0,k=p;w<k.length;w+=1){var N=k[w],B=dt();if(B!==N)throw ee(b());b()}}function ug(){var p=dt();switch(p){case"b":return b(),"\b";case"f":return b(),"\f";case"n":return b(),`
`;case"r":return b(),"\r";case"t":return b(),"	";case"v":return b(),"\v";case"0":if(b(),ce.isDigit(dt()))throw ee(b());return"\0";case"x":return b(),lg();case"u":return b(),ks();case`
`:case"\u2028":case"\u2029":return b(),"";case"\r":return b(),dt()===`
`&&b(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw ee(b());case void 0:throw ee(b())}return b()}function lg(){var p="",w=dt();if(!ce.isHexDigit(w)||(p+=b(),w=dt(),!ce.isHexDigit(w)))throw ee(b());return p+=b(),String.fromCodePoint(parseInt(p,16))}function ks(){for(var p="",w=4;w-- >0;){var k=dt();if(!ce.isHexDigit(k))throw ee(b());p+=b()}return String.fromCodePoint(parseInt(p,16))}var cg={start:function(){if(ve.type==="eof")throw Wt();Ms()},beforePropertyName:function(){switch(ve.type){case"identifier":case"string":Ps=ve.value,Se="afterPropertyName";return;case"punctuator":Hn();return;case"eof":throw Wt()}},afterPropertyName:function(){if(ve.type==="eof")throw Wt();Se="beforePropertyValue"},beforePropertyValue:function(){if(ve.type==="eof")throw Wt();Ms()},beforeArrayValue:function(){if(ve.type==="eof")throw Wt();if(ve.type==="punctuator"&&ve.value==="]"){Hn();return}Ms()},afterPropertyValue:function(){if(ve.type==="eof")throw Wt();switch(ve.value){case",":Se="beforePropertyName";return;case"}":Hn()}},afterArrayValue:function(){if(ve.type==="eof")throw Wt();switch(ve.value){case",":Se="beforeArrayValue";return;case"]":Hn()}},end:function(){}};function Ms(){var p;switch(ve.type){case"punctuator":switch(ve.value){case"{":p={};break;case"[":p=[];break}break;case"null":case"boolean":case"numeric":case"string":p=ve.value;break}if(Zr===void 0)Zr=p;else{var w=ct[ct.length-1];Array.isArray(w)?w.push(p):Object.defineProperty(w,Ps,{value:p,writable:!0,enumerable:!0,configurable:!0})}if(p!==null&&typeof p=="object")ct.push(p),Array.isArray(p)?Se="beforeArrayValue":Se="beforePropertyName";else{var k=ct[ct.length-1];k==null?Se="end":Array.isArray(k)?Se="afterArrayValue":Se="afterPropertyValue"}}function Hn(){ct.pop();var p=ct[ct.length-1];p==null?Se="end":Array.isArray(p)?Se="afterArrayValue":Se="afterPropertyValue"}function ee(p){return Jn(p===void 0?"JSON5: invalid end of input at "+Pt+":"+Ge:"JSON5: invalid character '"+hl(p)+"' at "+Pt+":"+Ge)}function Wt(){return Jn("JSON5: invalid end of input at "+Pt+":"+Ge)}function dl(){return Ge-=5,Jn("JSON5: invalid identifier character at "+Pt+":"+Ge)}function fg(p){console.warn("JSON5: '"+hl(p)+"' in strings is not valid ECMAScript; consider escaping")}function hl(p){var w={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(w[p])return w[p];if(p<" "){var k=p.charCodeAt(0).toString(16);return"\\x"+("00"+k).substring(k.length)}return p}function Jn(p){var w=new SyntaxError(p);return w.lineNumber=Pt,w.columnNumber=Ge,w}var dg=function(w,k,N){var B=[],O="",W,Fe,he="",Gt;if(k!=null&&typeof k=="object"&&!Array.isArray(k)&&(N=k.space,Gt=k.quote,k=k.replacer),typeof k=="function")Fe=k;else if(Array.isArray(k)){W=[];for(var mr=0,Ue=k;mr<Ue.length;mr+=1){var Ze=Ue[mr],Pe=void 0;typeof Ze=="string"?Pe=Ze:(typeof Ze=="number"||Ze instanceof String||Ze instanceof Number)&&(Pe=String(Ze)),Pe!==void 0&&W.indexOf(Pe)<0&&W.push(Pe)}}return N instanceof Number?N=Number(N):N instanceof String&&(N=String(N)),typeof N=="number"?N>0&&(N=Math.min(10,Math.floor(N)),he="          ".substr(0,N)):typeof N=="string"&&(he=N.substr(0,10)),gr("",{"":w});function gr(Z,Ee){var I=Ee[Z];switch(I!=null&&(typeof I.toJSON5=="function"?I=I.toJSON5(Z):typeof I.toJSON=="function"&&(I=I.toJSON(Z))),Fe&&(I=Fe.call(Ee,Z,I)),I instanceof Number?I=Number(I):I instanceof String?I=String(I):I instanceof Boolean&&(I=I.valueOf()),I){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof I=="string")return Yn(I);if(typeof I=="number")return String(I);if(typeof I=="object")return Array.isArray(I)?gg(I):pg(I)}function Yn(Z){for(var Ee={"'":.1,'"':.2},I={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},ge="",He=0;He<Z.length;He++){var De=Z[He];switch(De){case"'":case'"':Ee[De]++,ge+=De;continue;case"\0":if(ce.isDigit(Z[He+1])){ge+="\\x00";continue}}if(I[De]){ge+=I[De];continue}if(De<" "){var Ut=De.charCodeAt(0).toString(16);ge+="\\x"+("00"+Ut).substring(Ut.length);continue}ge+=De}var ht=Gt||Object.keys(Ee).reduce(function(Nt,Ht){return Ee[Nt]<Ee[Ht]?Nt:Ht});return ge=ge.replace(new RegExp(ht,"g"),I[ht]),ht+ge+ht}function pg(Z){if(B.indexOf(Z)>=0)throw TypeError("Converting circular structure to JSON5");B.push(Z);var Ee=O;O=O+he;for(var I=W||Object.keys(Z),ge=[],He=0,De=I;He<De.length;He+=1){var Ut=De[He],ht=gr(Ut,Z);if(ht!==void 0){var Nt=mg(Ut)+":";he!==""&&(Nt+=" "),Nt+=ht,ge.push(Nt)}}var Ht;if(ge.length===0)Ht="{}";else{var Xn;if(he==="")Xn=ge.join(","),Ht="{"+Xn+"}";else{var wg=`,
`+O;Xn=ge.join(wg),Ht=`{
`+O+Xn+`,
`+Ee+"}"}}return B.pop(),O=Ee,Ht}function mg(Z){if(Z.length===0)return Yn(Z);var Ee=String.fromCodePoint(Z.codePointAt(0));if(!ce.isIdStartChar(Ee))return Yn(Z);for(var I=Ee.length;I<Z.length;I++)if(!ce.isIdContinueChar(String.fromCodePoint(Z.codePointAt(I))))return Yn(Z);return Z}function gg(Z){if(B.indexOf(Z)>=0)throw TypeError("Converting circular structure to JSON5");B.push(Z);var Ee=O;O=O+he;for(var I=[],ge=0;ge<Z.length;ge++){var He=gr(String(ge),Z);I.push(He!==void 0?He:"null")}var De;if(I.length===0)De="[]";else if(he===""){var Ut=I.join(",");De="["+Ut+"]"}else{var ht=`,
`+O,Nt=I.join(ht);De=`[
`+O+Nt+`,
`+Ee+"]"}return B.pop(),O=Ee,De}},hg={parse:og,stringify:dg},yg=hg,vg=yg;return vg})}}),Yt={};E(Yt,{applyChanges:()=>zC,compareData:()=>pv,compareKeys:()=>vv,getField:()=>gv,getPaths:()=>wv,getPathsAndData:()=>No,isEmptyEntries:()=>IC,isEqualContextString:()=>yv,keysToNumbers:()=>RC,map:()=>Fo,mapKeys:()=>Po,updateByPath:()=>mv});var Ll=jo(xu()),yv=(e,r,n)=>Ll.default.stringify(e)===Ll.default.stringify(r),vv=(e,r)=>Vi(Object.keys(e),Object.keys(r)),pv=(e,r,n={})=>{if(e===void 0)return[{path:n.pathPrefix??"",value:r}];if(r===void 0)return[{path:n.pathPrefix??"",previous:e,value:void 0}];const i=n.pathPrefix??"",s=n.deepEntries??!1,o=n.eq??yv,a=n.includeMissingFromA??!1,u=[];if(Qe(e)&&Qe(r))return e!==r&&u.push({path:n.pathPrefix??"",value:r,previous:e}),u;const l=d=>{if(s){const h=[];for(const y in d){const v=d[y];Zo(v)&&h.push([y,v])}return h}else return Object.entries(d)},c=l(e),f=new Set;for(const[d,h]of c)if(f.add(d),typeof h=="object")u.push(...pv(h,r[d],{...n,pathPrefix:d+"."}));else{const y=i+d;if(d in r){const v=r[d];o(h,v,y)||u.push({path:y,previous:h,value:v})}else u.push({path:y,previous:h,value:void 0})}if(a){const d=l(r);for(const[h,y]of d)f.has(h)||u.push({path:i+h,previous:void 0,value:y})}return u},zC=(e,r)=>{for(const n of r)e=mv(e,n.path,n.value);return e},mv=(e,r,n,i=!1)=>{if(r===void 0)throw new Error("Parameter 'path' is undefined");if(typeof r!="string")throw new Error(`Parameter 'path' should be a string. Got: ${typeof r}`);if(e===void 0)throw new Error("Parameter 'target' is undefined");if(e===null)throw new Error("Parameter 'target' is null");const s=r.split(".");return Co(e,s,n,i)},Co=(e,r,n,i)=>{if(r.length===0){if(i)return n;if(Array.isArray(e)&&!Array.isArray(n))throw new Error(`Expected array value, got: '${JSON.stringify(n)}'. Set allowShapeChange=true to ignore.`);if(!Array.isArray(e)&&Array.isArray(n))throw new Error(`Unexpected array value, got: '${JSON.stringify(n)}'. Set allowShapeChange=true to ignore.`);if(typeof e!=typeof n)throw new Error(`Cannot reassign object type. (${typeof e} -> ${typeof n}). Set allowShapeChange=true to ignore.`);if(typeof e=="object"&&!Array.isArray(e)){const a=vv(e,n);if(a.a.length>0)throw new Error(`New value is missing key(s): ${a.a.join(",")}`);if(a.b.length>0)throw new Error(`New value cannot add new key(s): ${a.b.join(",")}`)}return n}const s=r.shift();if(!s)return n;if(Ko(s)&&Array.isArray(e)){const a=Number.parseInt(s);if(a>=e.length&&!i)throw new Error(`Array index ${a.toString()} is outside of the existing length of ${e.length.toString()}. Use allowShapeChange=true to permit this.`);const u=[...e];return u[a]=Co(u[a],r,n,i),u}else if(s in e){const a={...e};return a[s]=Co(a[s],r,n,i),a}else throw new Error(`Path ${s} not found in data`)},gv=(e,r)=>{if(typeof r!="string")throw new Error(`Parameter 'path' ought to be a string. Got: '${typeof r}'`);if(r.length===0)throw new Error("Parameter 'path' is empty");if(e===void 0)throw new Error("Parameter 'object' is undefined");if(e===null)throw new Error("Parameter 'object' is null");const n=r.split(".");return So(e,n)},So=(e,r)=>{if(e===void 0)throw new Error("Parameter 'object' is undefined");if(r.length===0)throw new Error("Path run out");const n=r.shift();if(!n)throw new Error("Unexpected empty split path");if(Ko(n)&&Array.isArray(e)){const s=Number.parseInt(n);return r.length===0?e[s]:So(e[s],r)}else{if(n in e)return r.length===0?e[n]:So(e[n],r);throw new Error(`Path '${n}' not found in data`)}},Fo=(e,r)=>{const i=Object.entries(e).map(([s,o],a)=>[s,r(o,s,a)]);return Object.fromEntries(i)},RC=(e,r="throw")=>{const n={};for(const i of Object.entries(e)){const s=Number.parseInt(i[0]);if(Number.isNaN(s))switch(r){case"throw":throw new TypeError(`Cannot convert key '${i[0]}' to an integer`);case"ignore":continue;case"keep":{n[i[0]]=i[1];continue}default:throw new Error("Param 'onInvalidKey' should be: 'throw', 'ignore' or 'keep'.")}n[s]=i[1]}return n},IC=e=>[...Object.entries(e)].length===0,Po=(e,r)=>{const n={};for(const i of Object.entries(e)){const s=r(i[0]);n[s]=i[1]}return n},wv=(e,r=!1)=>{if(e===void 0)throw new Error("Parameter 'object' is undefined");if(e===null)return[];const n=[],i=cu(e);for(const s of i){if(s.nodeValue===void 0&&r)continue;let o=s.name;s.ancestors.length>0&&(o=s.ancestors.join(".")+"."+o),n.push(o)}return n},No=(e,r=Number.MAX_SAFE_INTEGER,n="")=>{if(e===null)return[];if(e===void 0)return[];const i=[];return xv(e,n,i,r),i},xv=(e,r,n,i)=>{if(i<=0)return n;if(typeof e=="object")for(const s of Object.entries(e)){const o=(r.length>0?r+".":"")+s[0];n.push({path:o,value:s[1]}),xv(s[1],o,n,i-1)}return n},ii=(e,r,n=G)=>{if(!Array.isArray(e))throw new Error("Param 'a' is not an array");if(!Array.isArray(r))throw new Error("Param 'b' is not an array");const i=bv(e,r,!1,n);if(!i.isArray)throw new Error("Change set does not have arrays as parameters");const s=a=>{if(a.startsWith("_"))return Number.parseInt(a.slice(1));throw new Error(`Unexpected key '${a}'`)};return{...i,added:Po(i.added,s),changed:Po(i.changed,s),removed:i.removed.map(a=>s(a)),summary:i.summary.map(a=>[a[0],s(a[1]),a[2]])}},bv=(e,r,n=!1,i=G)=>{const s=Object.entries(e),o=Object.entries(r),a=new Set,u={},l={},c={},f=[],d=Array.isArray(e),h=new Array;let y=!1;for(const v of s){const m=d?`_${v[0]}`:v[0],g=v[1],x=r[v[0]];if(a.add(v[0]),x===void 0){y=!0,n&&!d?(u[m]=x,h.push(["mutate",m,x])):(f.push(m),h.push(["del",m,g]));continue}if(typeof g=="object"){const F=bv(g,x,n,i);F.hasChanged&&(y=!0),c[m]=F;const M=F.summary.map(j=>[j[0],m+"."+j[1],j[2]]);h.push(...M)}else i(g,x)||(u[m]=x,y=!0,h.push(["mutate",m,x]))}if(!n||d)for(const v of o){const m=d?`_${v[0]}`:v[0];a.has(v[0])||(l[m]=v[1],y=!0,h.push(["add",m,v[1]]))}return{changed:u,added:l,removed:f,children:c,hasChanged:y,isArray:d,summary:h}},jC={};E(jC,{Dom:()=>qv,From:()=>hr,Ops:()=>Qu,annotate:()=>ms,annotateElapsed:()=>Cu,batch:()=>Su,cache:()=>uF,cloneFromFields:()=>Sv,combineLatestToArray:()=>Fu,combineLatestToObject:()=>gs,count:()=>n2,debounce:()=>Pu,field:()=>Nu,filter:()=>ku,hasLast:()=>qn,isDisposable:()=>ps,isReactive:()=>bu,isTrigger:()=>Dv,isTriggerFunction:()=>Du,isTriggerGenerator:()=>Au,isTriggerValue:()=>Eu,isWrapped:()=>Ev,manual:()=>dm,messageHasValue:()=>be,messageIsDoneSignal:()=>lt,messageIsSignal:()=>On,opify:()=>Er,pipe:()=>Fv,prepare:()=>t2,resolveSource:()=>Ce,resolveTriggerValue:()=>Av,run:()=>aF,singleFromArray:()=>Pv,split:()=>Mu,splitLabelled:()=>$u,switcher:()=>Bu,symbol:()=>Vv,syncToArray:()=>ws,syncToObject:()=>_u,takeNextValue:()=>lF,throttle:()=>Tu,timeoutTrigger:()=>zu,to:()=>cF,toArray:()=>Lu,toArrayOrThrow:()=>Ov,toGenerator:()=>r2,transform:()=>Gn,withValue:()=>Nv,wrap:()=>we});function On(e){return e.value!==void 0?!1:"signal"in e&&e.signal!==void 0}function lt(e){return e.value!==void 0?!1:"signal"in e&&e.signal==="done"}function be(e){return e.value!==void 0}var qn=e=>bu(e)?e.last()!==void 0:!1,bu=e=>typeof e!="object"?!1:"on"in e&&"value"in e,ps=e=>"isDisposed"in e&&"dispose"in e,Ev=e=>!(typeof e!="object"||!("source"in e)||!("annotateElapsed"in e)),Er=(e,...r)=>n=>e(n,...r),Eu=e=>"value"in e,Du=e=>"fn"in e,Au=e=>Pn(e),Dv=e=>typeof e!="object"?!1:!!(Eu(e)||Du(e)||Au(e));function Av(e){if(Eu(e))return[e.value,!1];if(Du(e)){const r=e.fn();return r===void 0?[void 0,!0]:[r,!1]}if(Au(e)){const r=e.gen.next();return r.done?[void 0,!0]:[r.value,!1]}throw new Error("Invalid trigger. Missing 'value' or 'fn' fields")}function Cv(e,r={}){const n=r.maximumRepeats??Number.MAX_SAFE_INTEGER,i=r.closeOnError??!0,s=V(r.interval,1),o=r.interval!==void 0,a=V(r.predelay,1),u=r.lazy??"very",l=r.signal,c=new AbortController,f=m=>{c.abort(m)};let d=0;if(r.maximumRepeats&&!o)throw new Error("'maximumRepeats' has no purpose if 'loop' is not set to true");const h=m=>{v.dispose(m),y.cancel()},y=vr(async()=>{a&&await de(a);try{if(l?.aborted)return h(`Signal (${l.aborted})`),!1;const m=await e(f);v.set(m),d++}catch(m){if(i)return h(`Function error: ${je(m)}`),!1;v.signal("warn",je(m))}if(!o)return h("fromFunction done"),!1;if(c.signal.aborted)return h(`callback function aborted (${c.signal.reason})`),!1;if(d>=n)return h(`Maximum repeats reached ${n.toString()}`),!1},s),v=Wn({lazy:u,onStart(){y.start()},onStop(){y.cancel()}});return u==="never"&&y.start(),v}function ko(e,r={}){const n=r.lazy??"very",i=r.traceLifecycle?y=>{console.log(`Rx.From.Generator ${y}`)}:y=>{},s=V(r.readInterval,5),o=V(r.readTimeout,5*60*1e3),a=r.whenStopped??"continue";let u,l,c=xe.init({idle:["wait_for_next"],wait_for_next:["processing_result","stopping","disposed"],processing_result:["queued","disposed","stopping"],queued:["wait_for_next","disposed","stopping"],stopping:"idle",disposed:null},"idle");const f=()=>{i("onExternalSignal"),l?.abort(r.signal?.reason)};r.signal&&r.signal.addEventListener("abort",f,{once:!0});const d=async()=>{i(`read. State: ${c.value}`),l=new AbortController;try{c=xe.to(c,"wait_for_next");const y=await Yo(u,{signal:l.signal,millis:o});if(c=xe.to(c,"processing_result"),l?.abort("nextWithTimeout completed"),y.done&&(i("read v.done true"),h.dispose("Generator complete"),c=xe.to(c,"disposed")),c.value==="stopping"){i("read. sm.value = stopping"),c=xe.to(c,"idle");return}if(c.value==="disposed"){i("read. sm.value = disposed");return}h.set(y.value)}catch(y){h.dispose(`Generator error: ${y.toString()}`);return}c.value==="processing_result"?(c=xe.to(c,"queued"),i(`scheduling read. State: ${c.value}`),setTimeout(d,s)):c=xe.to(c,"idle")},h=Wn({...r,lazy:n,onStart(){i(`onStart state: ${c.value} whenStopped: ${a}`),c.value==="idle"&&((c.value==="idle"&&a==="reset"||u===void 0)&&(u=H(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]()),d())},onStop(){i(`onStop state: ${c.value} whenStopped: ${a}`),c=xe.to(c,"stopping"),a==="reset"&&(i("onStop reiniting iterator"),u=H(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]())},onDispose(y){i(`onDispose (${y})`),l?.abort(`Rx.fromGenerator disposed (${y})`),r.signal&&r.signal.removeEventListener("abort",f)}});return h}var Ce=(e,r={})=>{if(bu(e))return e;const n=r.generator??{lazy:"initial",interval:5},i=r.function??{lazy:"very"};if(Array.isArray(e))return ko(e.values(),n);if(typeof e=="function")return Cv(e,i);if(typeof e=="object"){if(Ev(e))return e.source;if(Pn(e)||H(e))return ko(e,n)}throw new TypeError(`Unable to resolve source. Supports: array, Reactive, Async/Iterable. Got type: ${typeof e}`)},We=(e,r)=>{const n=r.lazy??"initial",i=r.disposeIfSourceDone??!0,s=r.onValue??(f=>{}),o=Ce(e);let a;const u=()=>{a===void 0&&(r.onStart&&r.onStart(),a=o.on(f=>{On(f)?f.signal==="done"?(l(),i&&c.dispose(`Upstream source has completed (${f.context??""})`)):c.through(f):be(f)&&s(f.value)}))},l=()=>{a!==void 0&&(a(),a=void 0,r.onStop&&r.onStop())},c=Wn({...r,lazy:n,onStart(){u()},onStop(){l()}});return c};function Wn(e){const r=e.lazy??"initial",n=e.onStop??(()=>{}),i=e.onStart??(()=>{}),s=Me({...e,onFirstSubscribe(){r!=="never"&&i()},onNoSubscribers(){r==="very"&&n()}});return r==="never"&&i(),s}function Me(e={}){let r,n=!1,i=!1,s=!0;const o=e.onFirstSubscribe??void 0,a=e.onNoSubscribers??void 0,u=()=>{r!==void 0&&r.isEmpty&&(s||(s=!0,i=!1,a&&a()))},l=c=>{if(n)throw new Error("Disposed, cannot subscribe");r===void 0&&(r=new l0);const f=r.add(c);return s=!1,i||(i=!0,o&&setTimeout(()=>{o()},10)),()=>{r?.remove(f),u()}};return{dispose:c=>{n||(r?.notify({value:void 0,signal:"done",context:`Disposed: ${c}`}),n=!0,e.onDispose&&e.onDispose(c))},isDisposed:()=>n,reset:()=>{r?.clear(),u()},set:c=>{if(n)throw new Error("Disposed, cannot set");r?.notify({value:c})},through:c=>{if(n)throw new Error("Disposed, cannot through");r?.notify(c)},signal:(c,f)=>{if(n)throw new Error("Disposed, cannot signal");r?.notify({signal:c,value:void 0,context:f})},on:c=>l(c),value:c=>l(d=>{be(d)&&c(d.value)})}}var Vt=e=>({on:e.on,dispose:e.dispose,isDisposed:e.isDisposed,value:e.value});function ms(e,r,n={}){const i=We(e,{...n,onValue(s){const o=r(s);i.set(o)}});return Vt(i)}var Cu=e=>{let r=0;return ms(e,n=>{const i=r===0?0:Date.now()-r;return r=Date.now(),{...n,elapsedMs:i}})};function Su(e,r={}){const n=new Re,i=r.quantity??0,s=r.returnRemainder??!0,o={...r,onStop(){if(s&&!n.isEmpty){const c=n.toArray();n.clear(),a.set(c)}},onValue(c){n.enqueue(c),i>0&&n.length>=i&&u(),l!==void 0&&l.runState==="idle"&&l.start()}},a=We(e,o),u=()=>{if(n.isEmpty)return;l!==void 0&&l.start();const c=n.toArray();n.clear(),a.set(c)},l=r.elapsed?In(u,r.elapsed):void 0;return Vt(a)}function Gn(e,r,n={}){const i=We(e,{lazy:"initial",...n,onValue(s){const o=r(s);i.set(o)}});return Vt(i)}var Sv=e=>Gn(e,r=>{const n=[];for(const i in r){const s=r[i];Zo(s)&&n.push([i,s])}return Object.fromEntries(n)});function Fu(e,r={}){const n=Me(),i=r.onSourceDone??"break",s=[],o=e.map(f=>Ce(f)),a=()=>{},u=o.map(f=>a),l=o.map(f=>!1),c=()=>{for(const f of u)f()};for(const[f,d]of o.entries())s[f]=void 0,u[f]=d.on(h=>{if(lt(h)){if(l[f]=!0,u[f](),u[f]=a,i==="break"){c(),n.dispose("Source has completed and 'break' is set");return}l.includes(!1)||(c(),n.dispose("All sources completed"))}else be(h)&&(s[f]=h.value,n.set([...s]))});return{on:n.on,value:n.value}}function gs(e,r={}){const n=r.disposeSources??!0,i=Me(),s=r.onSourceDone??"break",o=new Map;for(const[c,f]of Object.entries(e)){const d={source:Ce(f),done:!1,data:void 0,off:()=>{}};o.set(c,d)}const a=()=>Dn.some(o,c=>!c.done),u=()=>{for(const c of o.values())c.off()},l=()=>{const c={};for(const[f,d]of o)c[f]=d.data;return c};for(const c of o.values())c.off=c.source.on(f=>{if(lt(f)){if(c.done=!0,c.off(),c.off=()=>{},s==="break"){u(),i.dispose("Source has completed and 'break' is behaviour");return}a()||(u(),i.dispose("All sources completed"))}else be(f)&&(c.data=f.value,i.set(l()))});return{on:i.on,value:i.value,dispose(c){if(u(),i.dispose(c),n)for(const f of o.values())ps(f.source)&&f.source.dispose("Part of disposed mergeToObject")},isDisposed(){return i.isDisposed()}}}function Pu(e,r={}){const n=V(r.elapsed,50);let i;const s=In(()=>{const a=i;a&&(o.set(a),i=void 0)},n),o=We(e,{...r,onValue(a){i=a,s.start()}});return Vt(o)}function Nu(e,r,n={}){const i="missingFieldDefault"in n,s=We(e,{disposeIfSourceDone:!0,...n,onValue(o){r in o?s.set(o[r]):i&&s.set(n.missingFieldDefault)}});return Vt(s)}function ku(e,r,n){const i=We(e,{...n,onValue(s){r(s)&&i.set(s)}});return Vt(i)}var Fv=(...e)=>{const r=Me(),n=[],i=s=>{for(const o of e)ps(o)&&!o.isDisposed&&o.dispose(s);for(const o of n)o();r.dispose(s)};for(let s=0;s<e.length;s++)n.push(e[s].on(o=>{const a=s===e.length-1;be(o)?a?r.set(o.value):e[s+1].set(o.value):lt(o)&&i("Upstream disposed")}));return{on:r.on,value:r.value,dispose(s){i(s)},isDisposed(){return r.isDisposed()}}};function Pv(e,r={}){const n=r.order??"default";if(!r.at&&!r.predicate)throw new Error("Options must have 'predicate' or 'at' fields");let i=o=>o;n==="random"?i=pn:typeof n=="function"&&(i=o=>o.toSorted(n));const s=We(e,{onValue(o){if(o=i(o),r.predicate)for(const a of o)r.predicate(a)&&s.set(a);else r.at&&s.set(o.at(r.at))}});return s}var Mu=(e,r={})=>{const n=r.quantity??2,i=[],s=Ce(e);for(let o=0;o<n;o++)i.push(We(s,{disposeIfSourceDone:!0,lazy:"initial"}));return i},$u=(e,r)=>{const n=Ce(e),i={};for(const s of r)i[s]=We(n,{lazy:"initial",disposeIfSourceDone:!0});return i},Bu=(e,r,n={})=>{const i=n.match??"first",s=Ce(e);let o=!1;const a={};for(const c of Object.keys(r))a[c]=Me();const u=()=>{if(!o){l(),o=!0;for(const c of Object.values(a))c.dispose("switcher source dispose")}},l=s.on(c=>{if(be(c)){for(const[f,d]of Object.entries(r))if(d(c.value)&&(a[f].set(c.value),i==="first"))break}else lt(c)&&u()});return a};function ws(e,r={}){const n=r.onSourceDone??"break",i=r.finalValue??"undefined",s=V(r.maximumWait,2e3);let o;const a=[],u=e.map(g=>({finalData:void 0,done:!1,source:Ce(g),unsub:()=>{}})),l=()=>{for(const g of u)g.unsub(),g.unsub=()=>{}},c=()=>{for(let g=0;g<a.length;g++)if(!(n==="allow"&&u[g].done)&&a[g]===void 0)return!1;return!0},f=()=>u.some(g=>!g.done),d=()=>{for(let g=0;g<a.length;g++)i==="last"&&u[g].done||(a[g]=void 0)},h=()=>{y(`Sync timeout exceeded (${s.toString()})`)},y=g=>{o&&clearTimeout(o),l(),m.dispose(g)},v=()=>{o=setTimeout(h,s);for(const[g,x]of u.entries())a[g]=void 0,x.unsub=x.source.on(F=>{if(On(F)){if(F.signal==="done"){if(x.finalData=a[g],x.unsub(),x.done=!0,x.unsub=()=>{},i==="undefined"&&(a[g]=void 0),n==="break"){y(`Source '${g.toString()}' done, and onSourceDone:'break' is set`);return}if(!f()){y("All sources done");return}}return}a[g]=F.value,c()&&(m.set([...a]),d(),o&&clearTimeout(o),o=setTimeout(h,s))})},m=Me({onFirstSubscribe(){l(),v()},onNoSubscribers(){o&&clearTimeout(o),l()}});return{on:m.on,value:m.value}}function _u(e,r={}){const n=Object.keys(e),i=Object.values(e),s=ws(i,r);return Gn(s,a=>ji(n,a))}function Tu(e,r={}){const n=V(r.elapsed,0);let i=performance.now(),s;const o=We(e,{...r,onValue(u){s=u,a()}}),a=()=>{const u=performance.now();n>0&&u-i>n&&(i=u,s!==void 0&&o.set(s))};return Vt(o)}function zu(e,r){let n;const i=r.immediate??!0,s=r.repeat??!1,o=V(r.interval,1e3);if(!Dv(r))throw new Error("Param 'options' does not contain trigger 'value' or 'fn' fields");const a=()=>{const[l,c]=Av(r);if(c)u.dispose("Trigger completed");else{if(u.isDisposed())return;u.set(l),s&&(n=setTimeout(a,o))}},u=We(e,{disposeIfSourceDone:!0,onValue(l){n&&clearTimeout(n),n=setTimeout(a,o),u.set(l)},onDispose(){console.log("disposing"),n&&clearTimeout(n)}});return i&&!n&&(n=setTimeout(a,o)),u}function Nv(e,r){let n=r.initial;const i=We(e,{...r,onValue(o){n=o,i.set(o)}});return{...Vt(i),last(){return n}}}var kv={};E(kv,{adjacentVertices:()=>ju,areAdjacent:()=>YC,bfs:()=>XC,clone:()=>ZC,connect:()=>Tv,connectTo:()=>$o,createVertex:()=>Mv,dfs:()=>zv,disconnect:()=>_v,distance:()=>$v,distanceDefault:()=>HC,dumpGraph:()=>VC,edges:()=>Bv,getCycles:()=>jv,getOrCreate:()=>Mo,getOrFail:()=>UC,graph:()=>Rv,graphFromVertices:()=>Iv,hasNoOuts:()=>WC,hasOnlyOuts:()=>GC,hasOut:()=>dr,isAcyclic:()=>QC,pathDijkstra:()=>KC,toAdjacencyMatrix:()=>LC,topologicalSort:()=>e2,transitiveReduction:()=>Lv,updateGraphVertex:()=>xs,vertexHasOut:()=>qC,vertices:()=>Iu});var Ru=class{rows=[];rowLabels=[];colLabels=[];labelColumns(...e){this.colLabels=e}labelColumn(e,r){this.colLabels[e]=r}getColumnLabelIndex(e){for(const[r,n]of this.colLabels.entries())if(n===e)return r}print(){console.table([...this.rowsWithLabelsObject()])}*rowsWithLabelsArray(){for(let e=0;e<this.rows.length;e++)yield this.getRowWithLabelsArray(e)}asArray(){const e=[];for(const r of this.rows)r===void 0?e.push([]):e.push([...r]);return e}get rowCount(){return this.rows.length}get columnCount(){const e=this.rows.map(r=>r.length);return Math.max(...e)}*rowsWithLabelsObject(){for(let e=0;e<this.rows.length;e++)yield this.getRowWithLabelsObject(e)}labelRows(...e){this.rowLabels=e}appendRow(...e){this.rows.push(e)}getRowWithLabelsArray(e){const r=this.rows.at(e);if(r!==void 0)return r.map((n,i)=>[this.colLabels.at(i),n])}getRowWithLabelsObject(e){const r=this.rows.at(e);if(r===void 0)return;const n={};for(let i=0;i<this.colLabels.length;i++){const s=this.colLabels.at(i)??i.toString();n[s]=r[i]}return n}getOrCreateRow(e){let r=this.rows.at(e);return r===void 0&&(r=[],this.rows[e]=r),r}row(e){return this.rows.at(e)}set(e,r,n){const i=this.getOrCreateRow(e);i[r]=n}get(e,r){const n=this.getOrCreateRow(e),i=typeof r=="number"?r:this.getColumnLabelIndex(r);if(i===void 0)throw new Error(`Column not found: ${r}`);return n[i]}setRow(e,r,n){const i=this.getOrCreateRow(e);for(let s=0;s<r;s++)i[s]=n}},Mv=e=>({id:e,out:[]});function LC(e){const r=[...e.vertices.values()],n=new Ru;n.labelColumns(...r.map(i=>i.id)),n.labelRows(...r.map(i=>i.id));for(let i=0;i<r.length;i++){n.setRow(i,r.length,!1);const s=r[i];for(const[o,a]of r.entries())s.out.some(u=>u.id===a.id)&&n.set(i,o,!0)}return n}var VC=e=>OC(e).join(`
`),OC=e=>{const r=[],n="vertices"in e?e.vertices.values():e;for(const i of n){const s=JC(i);r.push(...s.map(o=>` ${o}`))}return r},$v=(e,r)=>r.weight!==void 0?r.weight:1;function*Bv(e){const r=[...e.vertices.values()];for(const n of r)for(const i of n.out)yield i}function*Iu(e){const r=[...e.vertices.values()];for(const n of r)yield n}function*ju(e,r){if(r===void 0)return;const n=typeof r=="string"?e.vertices.get(r):r;if(n===void 0)throw new Error(`Vertex not found ${JSON.stringify(r)}`);for(const i of n.out){const s=e.vertices.get(i.id);if(s===void 0)throw new Error(`Could not find vertex: ${i.id}`);yield s}}var qC=(e,r)=>{if(e===void 0)return!1;const n=typeof r=="string"?r:r.id;return e.out.some(i=>i.id===n)},WC=(e,r)=>{const n=typeof r=="string"?e.vertices.get(r):r;return n===void 0?!1:n.out.length===0},GC=(e,r,...n)=>{const i=Et(e,r),s=n.map(o=>Et(e,o));if(s.length!==i.out.length)return!1;for(const o of s)if(!dr(e,i,o))return!1;return!0},dr=(e,r,n)=>{const i=Et(e,r),s=typeof n=="string"?n:n.id;return i.out.some(o=>o.id===s)},Mo=(e,r)=>{const n=e.vertices.get(r);if(n!==void 0)return{graph:e,vertex:n};const i=Mv(r);return{graph:xs(e,i),vertex:i}},UC=(e,r)=>{const n=e.vertices.get(r);if(n===void 0)throw new Error(`Vertex '${r}' not found in graph`);return n},xs=(e,r)=>({...e,vertices:e.vertices.set(r.id,r)}),HC=(e,r)=>r.weight!==void 0?r.weight:1;function _v(e,r,n){const i=Et(e,r),s=Et(e,n);return dr(e,i,s)?xs(e,{...i,out:i.out.filter(o=>o.id!==s.id)}):e}function $o(e,r,n,i){const s=Mo(e,r);e=s.graph;const o=Mo(e,n);e=o.graph;const a={id:n,weight:i};return dr(e,s.vertex,o.vertex)||(e=xs(e,{...s.vertex,out:[...s.vertex.out,a]})),{graph:e,edge:a}}function Tv(e,r){const{to:n,weight:i,from:s}=r,o=r.bidi??!1,a=Array.isArray(n)?n:[n];for(const u of a)e=$o(e,s,u,i).graph;if(!o)return e;for(const u of a)e=$o(e,u,s,i).graph;return e}var JC=e=>{const r=[e.id],n=i=>i.weight===void 0?i.id:`${i.id} (${i.weight})`;for(const i of e.out)r.push(` -> ${n(i)}`);return e.out.length===0&&(r[0]+=" (terminal)"),r};function YC(e,r,n){if(dr(e,r,n.id)||dr(e,n,r.id))return!0}function Et(e,r){const n=typeof r=="string"?e.vertices.get(r):r;if(n===void 0)throw new Error(`Id not found ${r}`);return n}function*XC(e,r,n){const i=Et(e,r),s=n===void 0?void 0:Et(e,n),o=new Re,a=new Set;for(o.enqueue(i);!o.isEmpty;){const u=o.dequeue();if(yield u,s!==void 0&&s===u)return;for(const l of ju(e,u))a.has(l.id)||(a.add(l.id),o.enqueue(Et(e,l.id)))}}function*zv(e,r){const n=Et(e,r),i=new Jr,s=new Set;for(i.push(n);!i.isEmpty;){const o=i.pop();if(o!==void 0&&!s.has(o.id)){s.add(o.id),yield o;for(const a of o.out){const u=e.vertices.get(a.id);u&&i.push(u)}}}}var KC=(e,r)=>{const n=typeof r=="string"?e.vertices.get(r):r;if(n===void 0)throw new Error("source vertex not found");const i=new Map,s=new Map;i.set(n.id,0);const o=new iv,a=[...e.vertices.values()];for(const l of a)l.id!==n.id&&(i.set(l.id,Number.MAX_SAFE_INTEGER),s.set(l.id,null)),o.enqueueWithPriority(l.id,Number.MAX_SAFE_INTEGER);for(;!o.isEmpty;){const l=o.dequeueMin();if(l===void 0)throw new Error("Bug. Queue unexpectedly empty");const c=e.vertices.get(l);for(const f of c.out){const d=i.get(l)+$v(e,f);d<i.get(f.id)&&(i.set(f.id,d),s.set(f.id,c),o.changePriority(f.id,d,!0))}}return{distances:i,previous:s,pathTo:l=>{const c=[];for(;l!==n.id;){const f=s.get(l);if(f==null)throw new Error(`Id not present: ${l}`);c.push({id:l,weight:i.get(l)}),l=f.id}return c}}},ZC=e=>({vertices:Je([...e.vertices.entries()])}),Rv=(...e)=>{let r={vertices:Je()};for(const n of e)r=Tv(r,n);return r};function QC(e){return jv(e).length===0}function e2(e){const r=new dv(0);for(const o of Bv(e))r.add(o.id,1);const n=new Re;let i=0;for(const o of Iu(e))r.get(o.id)===0&&n.enqueue(o),i++;const s=[];for(;!n.isEmpty;){const o=n.dequeue();s.push(o);for(const a of o.out)r.subtract(a.id,1)===0&&n.enqueue(e.vertices.get(a.id))}if(s.length!==i)throw new Error("Graph contains cycles");return Iv(s)}function Iv(e){const r=eu(e,i=>[i.id,i]);return{vertices:Je([...r])}}function jv(e){let r=0;const n=new Jr,i=new Map,s=[];for(const a of e.vertices.values())i.set(a.id,{...a,lowlink:Number.NaN,index:Number.NaN,onStack:!1});const o=a=>{a.index=r,a.lowlink=r,r++,n.push(a),a.onStack=!0;for(const u of a.out){const l=i.get(u.id);Number.isNaN(l.index)?(o(l),a.lowlink=Math.min(a.lowlink,l.lowlink)):l.onStack&&(a.lowlink=Math.min(a.lowlink,l.lowlink))}if(a.lowlink===a.index){const u=[];let l;for(;a!==l;)l=n.pop(),l.onStack=!1,u.push({id:l.id,out:l.out});u.length>1&&s.push(u)}};for(const a of i.values())Number.isNaN(a.index)&&o(a);return s}function Lv(e){for(const r of Iu(e))for(const n of ju(e,r))for(const i of zv(e,n))if(n.id!==i.id&&dr(e,r,i)){const s=_v(e,r,i);return Lv(s)}return e}function t2(e){let r=Rv();const n=Me();return{graph:r,on:n.on,value:n.value}}var Vv=Symbol("Rx");async function Lu(e,r={}){const n=r.limit??Number.MAX_SAFE_INTEGER,i=V(r.maximumWait,10*1e3),s=r.underThreshold??"partial",o=[],a=Ce(e);return new Promise((l,c)=>{const f=()=>{if(clearTimeout(d),h(),o.length<n&&s==="throw"){c(new Error(`Threshold not reached. Wanted: ${n} got: ${o.length}. Maximum wait: ${i}`));return}if(o.length<n&&s==="fill")for(let y=0;y<n;y++)o[y]===void 0&&(o[y]=r.fillValue);l(o)},d=setTimeout(()=>{f()},i),h=a.on(y=>{lt(y)?f():be(y)&&(o.push(y.value),o.length===n&&f())})})}async function Ov(e,r={}){const n=r.limit??Number.MAX_SAFE_INTEGER,i=r.maximumWait??5*1e3,s=await Lu(e,{limit:n,maximumWait:i,underThreshold:"partial"});if(r.limit&&s.length<r.limit)throw new Error(`Threshold not reached. Wanted: ${r.limit}, got ${s.length}`);return s}async function*r2(e){const r=Ce(e);let n=u=>{},i=u=>{};const s=()=>new Promise((u,l)=>{n=u,i=l});let o=s(),a=!0;for(r.on(u=>{be(u)?(n(u.value),o=s()):lt(u)&&(a=!1,i("Source has completed"))});a;)yield await o}function we(e){return{source:Ce(e),annotate:r=>{const n=ms(e,r);return we(n)},annotateElapsed:()=>we(Cu(e)),batch:r=>we(Su(e,r)),debounce:(r={})=>we(Pu(e,r)),field:(r,n={})=>{const i=Nu(e,r,n);return we(i)},filter:(r,n)=>we(ku(e,r,n)),combineLatestToArray:(r,n={})=>{const i=[e,...r];return we(Fu(i,n))},combineLatestToObject:(r,n)=>{const i=n.name??"source",s={...r};return s[i]=e,we(gs(s,n))},split:(r={})=>Mu(e,r).map(i=>we(i)),splitLabelled:(...r)=>{const n=$u(e,r);return Fo(n,s=>we(s))},switcher:(r,n={})=>{const i=Bu(e,r,n);return Fo(i,o=>we(o))},syncToArray:(r,n={})=>{const i=[e,...r].map(o=>Ce(o)),s=ws(i,n);return we(s)},syncToObject:(r,n={})=>{const i=n.name??"source",s={...r};return s[i]=e,we(_u(s,n))},throttle:(r={})=>we(Tu(e,r)),transform:(r,n={})=>we(Gn(e,r,n)),timeoutTrigger:r=>we(zu(e,r)),toArray:r=>Lu(e,r),toArrayOrThrow:r=>Ov(e,r),value:r=>{Ce(e).on(i=>{be(i)&&r(i.value)})}}}function n2(e={}){const r=e.lazy??"initial",n=V(e.interval,1e3),i=e.amount??1,s=e.offset??0;let o=0,a=s;const u=f=>{c.dispose(f)},l=vr(()=>{if(e.signal?.aborted)return u(`Aborted (${e.signal.reason})`),!1;if(c.set(a),a+=1,o++,o>=i)return u("Limit reached"),!1},n),c=Wn({onStart(){l.start()},onStop(){l.cancel()},onDispose(){l.cancel()},lazy:r});return c}var qv={};E(qv,{bind:()=>um,bindDiffUpdate:()=>YS,bindElement:()=>Zu,bindHtml:()=>US,bindText:()=>GS,bindUpdate:()=>JS,elements:()=>XS,fromDomQuery:()=>WS,win:()=>KS});function*i2(e,r="."){for(;e.length>0;){yield e;const n=jn(e,r);if(n===e)break;e=n}}function*s2(e,r="."){for(;e.length>0;){yield e;const n=Va(e,r,{ifNoMatch:"original",fromEnd:!0});if(n===e)break;e=n}}var o2={};E(o2,{Bipolar:()=>sp,Correlate:()=>lp,FrequencyMutable:()=>Gv,Graphs:()=>Xv,IntervalTracker:()=>Hv,Normalise:()=>Wv,NumberTracker:()=>$a,PointTracker:()=>Vu,Pool:()=>fp,PrimitiveTracker:()=>Xh,Table:()=>Ru,TrackedPointMap:()=>Jv,TrackedValueMap:()=>Yh,TrackerBase:()=>Ma,clamp:()=>Ne,clampIndex:()=>Ks,fieldResolve:()=>ip,fieldResolver:()=>F2,flip:()=>li,frequencyMutable:()=>l2,interpolate:()=>Hr,interpolateAngle:()=>L0,interpolatorInterval:()=>vA,interpolatorStepped:()=>yA,intervalTracker:()=>v2,movingAverage:()=>d2,movingAverageLight:()=>Uv,movingAverageTimed:()=>f2,noiseFilter:()=>y2,numberTracker:()=>cn,piPi:()=>z2,pointTracker:()=>m2,pointsTracker:()=>Yv,pull:()=>P2,scale:()=>st,scaleClamped:()=>Y1,scalePercent:()=>K1,scalePercentages:()=>X1,scaler:()=>Zi,scalerPercent:()=>Ch,trackUnique:()=>C2,trackUniqueInstances:()=>np,wrap:()=>ci,wrapInteger:()=>Hl,wrapRange:()=>kg});var Wv={};E(Wv,{array:()=>u2,stream:()=>a2});var a2=(e,r)=>{let n=e??Number.MAX_SAFE_INTEGER,i=r??Number.MIN_SAFE_INTEGER;return P(e),P(r),s=>(P(s),n=Math.min(n,s),i=Math.max(i,s),st(s,n,i))},u2=(e,r,n)=>{if(!Array.isArray(e))throw new Error("values param should be an array");const i=kn(e),s=r??i.min,o=n??i.max;return e.map(a=>Ne(st(a,s,o)))},Gv=class extends Le{#e;#t;constructor(e){super(),this.#e=new Map,e===void 0&&(e=r=>{if(r===void 0)throw new Error("Cannot create key for undefined");return typeof r=="string"?r:JSON.stringify(r)}),this.#t=e}clear(){this.#e.clear(),this.fireEvent("change",{context:this})}keys(){return this.#e.keys()}values(){return this.#e.values()}toArray(){return[...this.#e.entries()]}debugString(){let e="";for(const[r,n]of this.#e.entries())e+=`${r}: ${n}, `;return e.endsWith(", ")?e.slice(0,Math.max(0,e.length-2)):e}frequencyOf(e){if(typeof e=="string")return this.#e.get(e);const r=this.#t(e);return this.#e.get(r)}relativeFrequencyOf(e){let r;if(typeof e=="string")r=this.#e.get(e);else{const i=this.#t(e);r=this.#e.get(i)}if(r===void 0)return;const n=this.minMaxAvg();return r/n.total}entries(){return[...this.#e.entries()]}minMaxAvg(){return Z0.minMaxAvg(this.entries())}entriesSorted(e="value"){return Q0(e)(this.entries())}add(...e){if(e===void 0)throw new Error("value parameter is undefined");const r=e.map(n=>this.#t(n));for(const n of r){const i=this.#e.get(n)??0;this.#e.set(n,i+1)}this.fireEvent("change",{context:this})}},l2=e=>new Gv(e),c2=e=>{let r=!1;const n=In(()=>{r||(n.start(),e.whatToCall(e.fallback()))},e.interval);return e.abort&&e.abort.addEventListener("abort",i=>{r=!0,n.cancel()}),n.start(),i=>{if(r)throw new Error("AbortSignal has been fired");n.start(),e.whatToCall(i)}},Uv=(e=3)=>{P(e,"aboveZero","scaling");let r=0,n=0;return i=>(J(i,"","v")[0]&&i!==void 0&&(n++,r=r+(i-r)/Math.min(n,e)),r)},f2=e=>{const r=Uv(),n=c2({...e,whatToCall:i=>{r(i)},fallback(){return e.default??0}});return i=>(n(i),r())},d2=(e=100,r)=>{const n=new Re({capacity:e,discardPolicy:"older"});return i=>(J(i)[0]&&i!==void 0&&n.enqueue(i),r===void 0?ta(n.data):df(n.data,r))},h2=Math.PI*2,Vl=(e,r)=>{const n=h2*r*e;return n/(n+1)},Ol=(e,r,n)=>e*r+(1-e)*n,y2=(e=1,r=0,n=1)=>{let i=0,s=0,o=0;return(u,l)=>{l===void 0&&(l=performance.now());const c=l-o,f=Vl(c,n),d=(u-i)/c,h=Ol(f,d,s),y=e+r*Math.abs(h),v=Vl(c,y),m=Ol(v,u,i);return i=m,s=h,o=l,m}},Hv=class extends $a{lastMark=0;mark(){this.lastMark>0&&this.seen(performance.now()-this.lastMark),this.lastMark=performance.now()}},v2=e=>new Hv(e),p2=class extends Ma{values;constructor(e={}){super(e),this.values=[]}onTrimmed(){}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.values.length)}onReset(){this.values=[]}filterData(e){const r=e.map(i=>"at"in i?i:{...i,at:Date.now()}),n=r.at(-1);if(this.storeIntermediate)this.values.push(...r);else switch(this.values.length){case 0:{this.values.push(n);break}case 1:{this.values.push(n);break}case 2:{this.values[1]=n;break}}return r}get last(){return this.values.length===1?this.values[0]:this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){return Date.now()-this.values[0].at}},Vu=class extends p2{initialRelation;lastResult;constructor(e={}){super(e)}onTrimmed(){this.initialRelation=void 0}get x(){return this.last.x}get y(){return this.last.y}onReset(){super.onReset(),this.lastResult=void 0,this.initialRelation=void 0}seenEvent(e){if("getCoalescedEvents"in e){const n=e.getCoalescedEvents().map(i=>({x:i.clientX,y:i.clientY}));return this.seen(...n)}else return this.seen({x:e.clientX,y:e.clientY})}computeResults(e){const r=this.last,n=this.values.at(-2);if(this.initialRelation===void 0&&this.initial)this.initialRelation=oi(this.initial);else if(this.initialRelation===void 0)throw new Error("Bug: No initialRelation, and this.inital is undefined?");const i=oi(n===void 0?r:n),s=this.initialRelation(r),o=n===void 0?0:Kt.length(n,r)/(r.at-n.at),a={...i(r),speed:o},u={fromInitial:s,fromLast:a,values:[...this.values]};return this.lastResult=u,u}get line(){return this.values.length===1?[]:Kt.joinPointsToLines(...this.values)}get vectorPolar(){return Si.fromLinePolar(this.lineStartEnd)}get vectorCartesian(){return Si.fromLineCartesian(this.lineStartEnd)}get lineStartEnd(){const e=this.initial;return this.values.length<2||!e?Kt.Empty:{a:e,b:this.last}}distanceFromStart(){const e=this.initial;return this.values.length>=2&&e!==void 0?re(e,this.last):0}difference(){const e=this.initial;return this.values.length>=2&&e!==void 0?Te(this.last,e):ed}angleFromStart(){const e=this.initial;if(e!==void 0&&this.values.length>2)return kr(e,this.last)}get length(){if(this.values.length===1)return 0;const e=this.line;return Kt.length(e)}},Jv=class extends Yh{constructor(e={}){super((r,n)=>{if(n===void 0)throw new Error("Requires start point");const i=new Vu({...e,id:r});return i.seen(n),i})}seenEvent(e){if("getCoalescedEvents"in e){const n=e.getCoalescedEvents().map(i=>super.seen(i.pointerId.toString(),i));return Promise.all(n)}else return Promise.all([super.seen(e.pointerId.toString(),e)])}},Yv=(e={})=>new Jv(e),m2=(e={})=>new Vu(e),li=e=>(typeof e=="function"&&(e=e()),P(e,"percentage","v"),1-e),Xv={};E(Xv,{Directed:()=>kv,Undirected:()=>Kv});var Kv={};E(Kv,{adjacentVertices:()=>D2,connect:()=>rp,connectTo:()=>tp,createVertex:()=>Zv,dumpGraph:()=>x2,edgesForVertex:()=>A2,getConnection:()=>Ou,getOrCreate:()=>Bo,graph:()=>g2,hasConnection:()=>ep,toAdjacencyMatrix:()=>w2,updateGraphVertex:()=>Qv});var Zv=e=>({id:e}),Qv=(e,r)=>({...e,vertices:e.vertices.set(r.id,r)}),Bo=(e,r)=>{const n=e.vertices.get(r);if(n!==void 0)return{graph:e,vertex:n};const i=Zv(r);return{graph:Qv(e,i),vertex:i}};function Bi(e,r){const n=typeof r=="string"?e.vertices.get(r):r;if(n===void 0)throw new Error(`Id not found ${r}`);return n}var ep=(e,r,n)=>Ou(e,r,n)!==void 0,Ou=(e,r,n)=>{const i=Bi(e,r),s=Bi(e,n);for(const o of e.edges)if(o.a==i.id&&o.b===s.id||o.a==s.id&&o.b===i.id)return o};function tp(e,r,n,i){e=Bo(e,r).graph,e=Bo(e,n).graph;let a=Ou(e,r,n);return a!==void 0?{graph:e,edge:a}:(a={a:r,b:n,weight:i},{graph:{...e,edges:[...e.edges,a]},edge:a})}function rp(e,r){const{a:n,weight:i,b:s}=r,o=Array.isArray(s)?s:[s];for(const a of o)e=tp(e,n,a,i).graph;return e}var g2=(...e)=>{let r={vertices:Je(),edges:[]};for(const n of e)r=rp(r,n);return r};function w2(e){const r=[...e.vertices.values()],n=new Ru;n.labelColumns(...r.map(i=>i.id)),n.labelRows(...r.map(i=>i.id));for(let i=0;i<r.length;i++){n.setRow(i,r.length,!1);const s=r[i];for(const[o,a]of r.entries())ep(e,s,a)&&n.set(i,o,!0)}return n}var x2=e=>b2(e).join(`
`),b2=e=>{const r=[];r.push(`Vertices: ${[...e.vertices.values()].map(n=>n.id).join(", ")}`),r.push("Edges:");for(const n of e.edges)r.push(E2(n));return r},E2=e=>{const r=e.weight?` (${e.weight})`:"";return`${e.a} <-> ${e.b}${r}`};function*D2(e,r){if(r===void 0)return;if((typeof r=="string"?e.vertices.get(r):r)===void 0)throw new Error(`Vertex not found ${JSON.stringify(r)}`);for(const i of e.edges)i.a===r?yield Bi(e,i.b):i.b===r&&(yield Bi(e,i.a))}function*A2(e,r){if(r===void 0)return;if((typeof r=="string"?e.vertices.get(r):r)===void 0)throw new Error(`Vertex not found ${JSON.stringify(r)}`);for(const i of e.edges)i.a===r?yield i:i.b===r&&(yield i)}var C2=(e=ot)=>{const r=new Set;return n=>{if(n===null)throw new TypeError("Param 'value' cannot be null");if(n===void 0)throw new TypeError("Param 'value' cannot be undefined");const i=typeof n=="string"?n:e(n);return r.has(i)?!1:(r.add(i),!0)}},np=()=>{const e=new Set;return r=>{if(r===null)throw new TypeError("Param 'value' cannot be null");if(r===void 0)throw new TypeError("Param 'value' cannot be undefined");return e.has(r)?!1:(e.add(r),!0)}};async function S2(e){return typeof e=="object"&&"next"in e?(await e.next()).value:typeof e=="function"?await e():e}async function ip(e){const r=[];for(const n of Object.entries(e)){const i=n[0],s=n[1],o=await S2(s);r.push([i,o])}return Object.fromEntries(r)}function F2(e){return()=>ip(e)}function P2(e){const r={},n={},i={};for(const[f,d]of Object.entries(e))if(Array.isArray(d)||Qe(d))n[f]=d;else if(typeof d=="function")i[f]=d;else try{console.log(`pull: ${f}`);const h=Ce(d);r[f]=h}catch{n[f]=d}const s=gs(r,{onSourceDone:"allow"});let o;const a=s.value(f=>{o=f}),u=async()=>{const f={};for(const[d,h]of Object.entries(i))f[d]=await h();return f};return{compute:async()=>({...n,...o,...await u()}),dispose:()=>{a(),s.dispose("ResolveFields.dispose")}}}var sp={};E(sp,{clamp:()=>ir,fromScalar:()=>N2,immutable:()=>Dr,random:()=>$2,randomSource:()=>ap,scale:()=>k2,scaleClamped:()=>M2,toScalar:()=>op,towardZero:()=>up});var Dr=(e=0)=>{const r=typeof e=="number"?e:e.value;if(r>1)throw new Error("Cannot be larger than 1");if(r<-1)throw new Error("Cannot be smaller than -1");if(Number.isNaN(r))throw new Error("startingValue is NaN");const n=r;return{[Symbol.toPrimitive](i){return i==="number"?n:i==="string"?n.toString():!0},value:n,towardZero:i=>Dr(up(n,i)),add:i=>Dr(ir(n+i)),multiply:i=>Dr(ir(n*i)),inverse:()=>Dr(-n),interpolate:(i,s)=>Dr(ir(Hr(i,n,s))),asScalar:()=>op(n)}},op=e=>{if(typeof e!="number")throw new Error(`Expected v to be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw new Error("Parameter is NaN");return(e+1)/2},N2=e=>(P(e,"percentage","v"),e*2-1),k2=(e,r,n)=>ir(Zi(r,n,-1,1)(e)),M2=(e,r,n)=>Zi(r,n,-1,1)(e),ap=e=>{const r=cs(e);return()=>r()*2-1},$2=e=>ap(e)(),ir=e=>{if(typeof e!="number")throw new Error(`Parameter must be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw new Error("v parameter is NaN");return e>1?1:e<-1?-1:e},up=(e,r)=>{if(typeof e!="number")throw new Error(`Parameter 'v' must be a number. Got: ${typeof e}`);if(typeof r!="number")throw new Error(`Parameter 'amt' must be a number. Got: ${typeof r}`);if(r<0)throw new Error("Parameter 'amt' must be positive");return e<0?(e+=r,e>0&&(e=0)):e>0&&(e-=r,e<0&&(e=0)),e},lp={};E(lp,{align:()=>cp,alignById:()=>_2});var B2=(e,r)=>e.score>r.score?-1:e.score<r.score?1:0,cp=(e,r,n,i={})=>{const s=i.matchThreshold??0,o=i.debug??!1,a=new Map,u=[],l=new Map;r?.forEach((c,f)=>{if(c===void 0)throw new Error(`'lastData' contains undefined (index: ${f})`);l.set(c.id,c)});for(let c=0;c<n.length;c++){const f=n[c];if(!r||r.length===0){o&&console.debug(`Correlate.align() new id: ${f.id}`),u.push(f);continue}const d=Array.from(l.values()).map(y=>({id:y.id,score:y===null?-1:e(y,f),last:y}));if(d.length===0){o&&console.debug(`Correlate.align() no valid last values id: ${f.id}`),u.push(f);continue}d.sort(B2);const h=d[0];if(h.score<s){o&&console.debug(`Correlate.align() new item does not reach threshold. Top score: ${h.score} id: ${f.id}`),u.push(f);continue}o&&h.id!==f.id&&console.log(`Correlate.align() Remapped ${f.id} -> ${h.id} (score: ${h.score})`),a.set(h.id,{...f,id:h.id}),l.delete(h.id)}return u.forEach(c=>a.set(c.id,c)),Array.from(a.values())},_2=(e,r={})=>{let n=[];return s=>(n=cp(e,n,s,r),[...n])},fp={};E(fp,{Pool:()=>yp,PoolUser:()=>dp,Resource:()=>hp,create:()=>T2});var dp=class extends Le{constructor(e,r){super(),this.key=e,this.resource=r,this._lastUpdate=performance.now(),this._pool=r.pool,this._userExpireAfterMs=this._pool.userExpireAfterMs,this._state="idle",this._pool.log.log(`PoolUser ctor key: ${this.key}`)}_lastUpdate;_pool;_state;_userExpireAfterMs;toString(){return this.isDisposed?"PoolUser. State: disposed":`PoolUser. State: ${this._state} Elapsed: ${performance.now()-this._lastUpdate} Data: ${JSON.stringify(this.resource.data)}`}keepAlive(){if(this._state==="disposed")throw new Error("PoolItem disposed");this._lastUpdate=performance.now()}_dispose(e,r){if(this._state==="disposed")return;const n=this.resource;this._state="disposed",n._release(this),this._pool.log.log(`PoolUser dispose key: ${this.key} reason: ${e}`),this.fireEvent("disposed",{data:r,reason:e}),super.clearEventListeners()}release(e){if(this.isDisposed)throw new Error("User disposed");const n=this.resource.data;this._pool.log.log(`PoolUser release key: ${this.key} reason: ${e}`),this.fireEvent("released",{data:n,reason:e}),this._dispose(`release-${e}`,n)}get data(){if(this.isDisposed)throw new Error("User disposed");return this.resource.data}get isExpired(){return this._userExpireAfterMs>0?performance.now()>this._lastUpdate+this._userExpireAfterMs:!1}get elapsed(){return performance.now()-this._lastUpdate}get isDisposed(){return this._state==="disposed"}get isValid(){return!(this.isDisposed||this.isExpired||this.resource.isDisposed)}},hp=class{constructor(e,r){if(this.pool=e,r===void 0)throw new Error("Parameter 'data' is undefined");if(e===void 0)throw new Error("Parameter 'pool' is undefined");this.#t=r,this.#s=0,this.#i=e.resourcesWithoutUserExpireAfterMs,this.#n=e.capacityPerResource,this.#r=[],this.#e="idle"}#e;#t;#r;#n;#i;#s;get data(){if(this.#e==="disposed")throw new Error("Resource disposed");return this.#t}updateData(e){if(this.#e==="disposed")throw new Error("Resource disposed");if(e===void 0)throw new Error("Parameter 'data' is undefined");this.#t=e}toString(){return`Resource (expired: ${this.isExpiredFromUsers} users: ${this.#r.length}, state: ${this.#e}) data: ${JSON.stringify(this.data)}`}_assign(e){if(this.#r.find(n=>n===e||n.key===e.key))throw new Error("User instance already assigned to resource");this.#r.push(e),this.#s=performance.now()}_release(e){this.#r=this.#r.filter(r=>r!==e),this.pool._release(e),this.#s=performance.now()}get hasUserCapacity(){return this.usersCount<this.#n}get usersCount(){return this.#r.length}get isExpiredFromUsers(){return this.#i<=0||this.#r.length>0?!1:performance.now()>this.#i+this.#s}get isDisposed(){return this.#e==="disposed"}dispose(e){if(this.#e==="disposed")return;const r=this.#t;this.#e="disposed",this.pool.log.log(`Resource disposed (${e})`);for(const n of this.#r)n._dispose(`resource-${e}`,r);this.#r=[],this.#s=performance.now(),this.pool._releaseResource(this,e),this.pool.freeResource&&this.pool.freeResource(r)}},yp=class{_resources;_users;capacity;userExpireAfterMs;resourcesWithoutUserExpireAfterMs;capacityPerResource;fullPolicy;generateResource;freeResource;log;constructor(e={}){this.capacity=e.capacity??-1,this.fullPolicy=e.fullPolicy??"error",this.capacityPerResource=e.capacityPerResource??1,this.userExpireAfterMs=e.userExpireAfterMs??-1,this.resourcesWithoutUserExpireAfterMs=e.resourcesWithoutUserExpireAfterMs??-1,this.generateResource=e.generate,this.freeResource=e.free,this._users=new Map,this._resources=[],this.log=r0("Pool",e.debug??!1);const r=Math.max(this.userExpireAfterMs,this.resourcesWithoutUserExpireAfterMs);r>0&&setInterval(()=>{this.maintain()},r*1.1)}dumpToString(){let e=`Pool
    capacity: ${this.capacity} userExpireAfterMs: ${this.userExpireAfterMs} capacityPerResource: ${this.capacityPerResource}
    resources count: ${this._resources.length}`;const r=this._resources.map(n=>n.toString()).join(`\r
	`);e+=`\r
Resources:\r
	`+r,e+=`\r
Users: \r
`;for(const[n,i]of this._users.entries())e+=`	k: ${n} v: ${i.toString()}\r
`;return e}getUsersByLongestElapsed(){return[...this._users.values()].sort((e,r)=>{const n=e.elapsed,i=r.elapsed;return n===i?0:n<i?1:-1})}getResourcesSortedByUse(){return[...this._resources].sort((e,r)=>e.usersCount===r.usersCount?0:e.usersCount<r.usersCount?-1:1)}addResource(e){if(e===void 0)throw new Error("Cannot add undefined resource");if(e===null)throw new Error("Cannot add null resource");if(this.capacity>0&&this._resources.length===this.capacity)throw new Error(`Capacity limit (${this.capacity}) reached. Cannot add more.`);this.log.log(`Adding resource: ${JSON.stringify(e)}`);const r=new hp(this,e);return this._resources.push(r),r}maintain(){let e=!1;const r=[];for(const i of this._resources)i.isDisposed?(this.log.log(`Maintain, disposed resource: ${JSON.stringify(i.data)}`),r.push(i)):i.isExpiredFromUsers&&(this.log.log(`Maintain, expired resource: ${JSON.stringify(i.data)}`),r.push(i));if(r.length>0){for(const i of r)i.dispose("diposed/expired");e=!0}const n=[];for(const[i,s]of this._users.entries())s.isValid||(this.log.log(`Maintain. Invalid user: ${s.key} (Disposed: ${s.isDisposed} Expired: ${s.isExpired} Resource disposed: ${s.resource.isDisposed})`),n.push(i),s._dispose("invalid",s.data));for(const i of n)this._users.delete(i),e=!0;e&&this.log.log(`End: resource len: ${this._resources.length} users: ${this.usersLength}`)}*resources(){const e=[...this._resources];for(const r of e)yield r}*values(){const e=[...this._resources];for(const r of e)yield r.data}release(e,r){const n=this._users.get(e);n&&n.release(r??"Pool.release")}_release(e){this._users.delete(e.key)}_releaseResource(e,r){this._resources=this._resources.filter(n=>n!==e)}hasResource(e){return this._resources.find(n=>n.data===e)!==void 0}hasUser(e){return this._users.has(e)}_assign(e,r){const n=new dp(e,r);return this._users.set(e,n),r._assign(n),n}_findUser(e){const r=this.getResourcesSortedByUse();if(r.length>0&&r[0].hasUserCapacity)return this._assign(e,r[0]);if(this.generateResource&&(this.capacity<0||this._resources.length<this.capacity)){this.log.log(`capacity: ${this.capacity} resources: ${this._resources.length}`);const n=this.addResource(this.generateResource());return this._assign(e,n)}}get usersLength(){return[...this._users.values()].length}useValue(e){return this.use(e).resource.data}use(e){const r=this._users.get(e);if(r)return r.keepAlive(),r;this.maintain();const n=this._findUser(e);if(n)return n;if(this.fullPolicy==="error")throw new Error(`Pool is fully used (fullPolicy: ${this.fullPolicy}, capacity: ${this.capacity})`);if(this.fullPolicy==="evictOldestUser"){const i=this.getUsersByLongestElapsed();if(i.length>0){this.release(i[0].key,"evictedOldestUser");const s=this._findUser(e);if(s)return s}}throw new Error(`Pool is fully used (${this.fullPolicy})`)}},T2=(e={})=>new yp(e),z2=Math.PI*2,R2={};E(R2,{BipolarView:()=>Ip,Colour:()=>Sn,Drawing:()=>bs,ImageDataGrid:()=>fh,Palette:()=>Xu,Plot2:()=>Uu,PlotOld:()=>jp,SceneGraph:()=>Hu,Svg:()=>Pa,Video:()=>Ja,scaleCanvas:()=>kp});var bs={};E(bs,{arc:()=>mp,bezier:()=>wp,circle:()=>Wu,connectedPoints:()=>Es,copyToImg:()=>W2,dot:()=>Xe,drawingStack:()=>Ar,ellipse:()=>O2,getContext:()=>pp,line:()=>Gu,lineThroughPoints:()=>V2,makeHelper:()=>I2,paths:()=>gp,pointLabels:()=>Ds,rect:()=>bp,textBlock:()=>Ep,textBlockAligned:()=>J2,textHeight:()=>H2,textRect:()=>As,textWidth:()=>_i,translatePoint:()=>q2,triangle:()=>U2});var vp=Math.PI*2,pp=e=>{if(e===null)throw new Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw new Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");const r=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?X(e).getContext("2d"):e;if(r===null)throw new Error("Could not create 2d context for canvas");return r},I2=(e,r)=>{const n=pp(e);return{paths(i,s){gp(n,i,s)},line(i,s){Gu(n,i,s)},rect(i,s){bp(n,i,s)},bezier(i,s){wp(n,i,s)},connectedPoints(i,s){Es(n,i,s)},pointLabels(i,s){Ds(n,i,s)},dot(i,s){Xe(n,i,s)},circle(i,s){Wu(n,i,s)},arc(i,s){mp(n,i,s)},textBlock(i,s){s.bounds===void 0&&r!==void 0&&(s={...s,bounds:{...r,x:0,y:0}}),Ep(n,i,s)}}},qu=e=>j2(e.strokeStyle,e.fillStyle),$e=(e,r={},...n)=>{if(e===void 0)throw new Error("ctx undefined");const i=Ar(e).push(qu(r),...n);return i.apply(),i},mp=(e,r,n={})=>{$e(e,n);const i=o=>{e.beginPath(),e.arc(o.x,o.y,o.radius,o.startRadian,o.endRadian),e.stroke()},s=Array.isArray(r)?r:[r];for(const o of s)i(o)},j2=(e,r)=>i=>{r&&(i.fillStyle=r),e&&(i.strokeStyle=e)},L2=(e,r,n)=>s=>{e&&(s.lineWidth=e),r&&(s.lineJoin=r),n&&(s.lineCap=n)},Ar=(e,r)=>(r===void 0&&(r=new $i),{push:(...o)=>{r===void 0&&(r=new $i);const a=r.push(...o);for(const u of o)u(e);return Ar(e,a)},pop:()=>{const o=r?.pop();return Ar(e,o)},apply:()=>{if(r===void 0)return Ar(e);for(const o of r.data)o(e);return Ar(e,r)}}),V2=(e,r,n)=>{$e(e,n),e.moveTo(r[0].x,r[0].y);for(const[i,s]of r.entries()){if(i+2>=r.length)continue;const o=r[i+1],a={x:(s.x+o.x)/2,y:(s.y+o.y)/2},u=(a.x+s.x)/2,l=(a.x+o.x)/2;e.quadraticCurveTo(u,o.y,a.x,a.y),e.quadraticCurveTo(l,o.y,o.x,o.y)}},Wu=(e,r,n={})=>{$e(e,n);const i=s=>{e.beginPath(),e.arc(s.x,s.y,s.radius,0,vp),n.strokeStyle&&e.stroke(),n.fillStyle&&e.fill()};if(Array.isArray(r))for(const s of r)i(s);else i(r)},O2=(e,r,n={})=>{$e(e,n);const i=o=>{e.beginPath();const a=o.rotation??0,u=o.startAngle??0,l=o.endAngle??vp;e.ellipse(o.x,o.y,o.radiusX,o.radiusY,a,u,l),n.strokeStyle&&e.stroke(),n.fillStyle&&e.fill()},s=Array.isArray(r)?r:[r];for(const o of s)i(o)},gp=(e,r,n={})=>{$e(e,n);const i=s=>{if(Wr(s))xp(e,s,n);else if(at(s))Gu(e,s,n);else throw new Error(`Unknown path type ${JSON.stringify(s)}`)};if(Array.isArray(r))for(const s of r)i(s);else i(r)},Es=(e,r,n={})=>{const i=n.loop??!1;if(Dg(r),r.length!==0){for(const[s,o]of r.entries())R(o,`Index ${s}`);$e(e,n),n.lineWidth&&(e.lineWidth=n.lineWidth),e.beginPath(),e.moveTo(r[0].x,r[0].y);for(const s of r)e.lineTo(s.x,s.y);i&&e.lineTo(r[0].x,r[0].y),(n.strokeStyle||n.strokeStyle===void 0&&n.fillStyle===void 0)&&e.stroke(),n.fillStyle&&e.fill()}},Ds=(e,r,n={},i)=>{if(r.length!==0){for(const[s,o]of r.entries())R(o,`Index ${s}`);$e(e,n);for(const[s,o]of r.entries()){const a=i!==void 0&&s<i.length?i[s]:s.toString();e.fillText(a.toString(),o.x,o.y)}}},q2=(e,r)=>{const n=e.getTransform();return{x:r.x*n.a+r.y*n.c+n.e,y:r.x*n.b+r.y*n.d+n.f}},W2=e=>{const r=document.createElement("img");return r.src=e.toDataURL("image/jpeg"),r},Xe=(e,r,n)=>{n===void 0&&(n={});const i=n.radius??10;if($e(e,n),e.beginPath(),Array.isArray(r))for(const s of r)e.arc(s.x,s.y,i,0,2*Math.PI);else{const s=r;e.arc(s.x,s.y,i,0,2*Math.PI)}(n.filled||!n.outlined)&&e.fill(),n.outlined&&e.stroke()},wp=(e,r,n)=>{Wr(r)?xp(e,r,n):wa(r)&&G2(e,r,n)},G2=(e,r,n={})=>{let i=$e(e,n);const{a:s,b:o,cubic1:a,cubic2:u}=r,l=n.debug??!1;e.beginPath(),e.moveTo(s.x,s.y),e.bezierCurveTo(a.x,a.y,u.x,u.y,o.x,o.y),e.stroke(),l&&(i=i.push(qu({...n,strokeStyle:vn(n.strokeStyle??"silver",.6),fillStyle:vn(n.fillStyle??"yellow",.4)})),i.apply(),e.moveTo(s.x,s.y),e.lineTo(a.x,a.y),e.stroke(),e.moveTo(o.x,o.y),e.lineTo(u.x,u.y),e.stroke(),e.fillText("a",s.x+5,s.y),e.fillText("b",o.x+5,o.y),e.fillText("c1",a.x+5,a.y),e.fillText("c2",u.x+5,u.y),Xe(e,a,{radius:3}),Xe(e,u,{radius:3}),Xe(e,s,{radius:3}),Xe(e,o,{radius:3}),i=i.pop(),i.apply())},xp=(e,r,n={})=>{const{a:i,b:s,quadratic:o}=r,a=n.debug??!1;let u=$e(e,n);e.beginPath(),e.moveTo(i.x,i.y),e.quadraticCurveTo(o.x,o.y,s.x,s.y),e.stroke(),a&&(u=u.push(qu({...n,strokeStyle:vn(n.strokeStyle??"silver",.6),fillStyle:vn(n.fillStyle??"yellow",.4)})),Es(e,[i,o,s]),e.fillText("a",i.x+5,i.y),e.fillText("b",s.x+5,s.y),e.fillText("h",o.x+5,o.y),Xe(e,o,{radius:3}),Xe(e,i,{radius:3}),Xe(e,s,{radius:3}),u=u.pop(),u.apply())},Gu=(e,r,n={})=>{const i=n.debug??!1,s=L2(n.lineWidth,n.lineJoin,n.lineCap);$e(e,n,s);const o=a=>{const{a:u,b:l}=a;e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(l.x,l.y),i&&(e.fillText("a",u.x,u.y),e.fillText("b",l.x,l.y),Xe(e,u,{radius:5,strokeStyle:"black"}),Xe(e,l,{radius:5,strokeStyle:"black"})),e.stroke()};if(Array.isArray(r))for(const a of r)o(a);else o(r)},U2=(e,r,n={})=>{$e(e,n);const i=s=>{Es(e,vo(s),{...n,loop:!0}),n.debug&&Ds(e,vo(s),void 0,["a","b","c"])};if(Array.isArray(r))for(const s of r)i(s);else i(r)},bp=(e,r,n={})=>{$e(e,n);const i=n.filled??n.fillStyle!==void 0,s=n.stroked??n.strokeStyle!==void 0,o=a=>{const u="x"in a?a.x:0,l="y"in a?a.y:0;i&&e.fillRect(u,l,a.width,a.height),(s??!0)&&e.strokeRect(u,l,a.width,a.height),n.debug&&Ds(e,rr(a),void 0,["NW","NE","SE","SW"])};if(Array.isArray(r))for(const a of r)o(a);else o(r)},_i=(e,r,n=0,i)=>As(e,r,n,i).width,As=(e,r,n=0,i)=>{if(r==null||r.length===0)return Uf;const s=e.measureText(r);return{width:i?zc(s.width,i)+n:s.width+n,height:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+n+n}},H2=(e,r,n=0)=>As(e,r,n).height,Ep=(e,r,n)=>{$e(e,n);const i=n.anchorPadding??0,s=n.anchor,o=n.bounds??{x:0,y:0,width:1e6,height:1e6},a=r.map(y=>e.measureText(y)),u=a.map(y=>y.width),l=a.map(y=>y.actualBoundingBoxAscent+y.actualBoundingBoxDescent),c=Math.max(...u),f=l.reduce((y,v)=>y+v,0);let{x:d,y:h}=s;s.x+c>o.width?d=o.width-(c+i):d-=i,d<o.x&&(d=o.x+i),s.y+f>o.height?h=o.height-(f+i):h-=i,h<o.y&&(h=o.y+i);for(const[y,v]of r.entries())e.fillText(v,d,h),h+=l[y]},J2=(e,r,n)=>{const{bounds:i}=n,{horiz:s="left",vert:o="top"}=n,a=typeof r=="string"?[r]:r;$e(e,n),e.save(),e.translate(i.x,i.y),e.textAlign="left",e.textBaseline="top";const u=i.width/2,l=i.height/2,c=a.map(y=>e.measureText(y)),f=c.map(y=>y.actualBoundingBoxAscent+y.actualBoundingBoxDescent),d=f.reduce((y,v)=>y+v,0);let h=0;o==="center"?h=l-d/2:o==="bottom"&&(h=i.height-d);for(const[y,v]of a.entries()){let m=0;s==="center"?m=u-c[y].width/2:s==="right"&&(m=i.width-c[y].width),e.fillText(v,m,h),h+=f[y]}e.restore()},Uu={};E(Uu,{AxisX:()=>zp,AxisY:()=>Rp,Legend:()=>Tp,Plot:()=>nS,PlotArea:()=>_p,Series:()=>Bp});var Hu={};E(Hu,{Box:()=>Sp,CanvasBox:()=>Kr,CanvasLayoutState:()=>Pp,CanvasMeasureState:()=>Fp,LayoutState:()=>Cp,MeasureState:()=>Ap,boxRectFromPx:()=>Y2,boxRectFromRectPx:()=>X2,boxUnitFromPx:()=>gt});var gt=e=>({type:"px",value:e}),Y2=(e,r,n,i)=>({x:gt(e),y:gt(r),width:gt(n),height:gt(i)}),X2=e=>({x:gt(e.x),y:gt(e.y),width:gt(e.width),height:gt(e.height)}),si=(e,r)=>e.type==="px"&&r.type==="px"?e.value===r.value:!1,K2=(e,r)=>e===void 0&&r===void 0?!0:!(e===void 0||r===void 0||e.x&&r.x&&!si(e.x,r.x)||e.y&&r.y&&!si(e.y,r.y)||e.width&&r.width&&!si(e.width,r.width)||e.height&&r.height&&!si(e.height,r.height)),Dp=class{bounds;pass;constructor(e){this.bounds=e,this.pass=0}resolveToPx(e,r,n){if(e===void 0&&n!==void 0)return n;if(e!==void 0){if(e.type===void 0)throw new TypeError("Expected 'type' and 'value' fields. Type is missing");if(e.value===void 0)throw new TypeError("Expected 'type' and 'value' fields. Value is missing");if(e.type==="px")return e.value;if(e.type==="pc")return e.value*r;throw new Error(`Unknown unit type: ${e.type}`)}}resolveBox(e){if(e===void 0)return;const r=this.resolveToPx(e.x,this.bounds.width),n=this.resolveToPx(e.y,this.bounds.height),i=this.resolveToPx(e.width,this.bounds.width),s=this.resolveToPx(e.height,this.bounds.height);if(!i||!s)throw new TypeError("Expected width and height");if(r===void 0&&n===void 0)return Object.freeze({width:i,height:s});if(!r||!n)throw new TypeError("Expected x and y");return Object.freeze({x:r,y:n,width:i,height:s})}},Ap=class extends Dp{measurements;constructor(e){super(e),this.measurements=new Map}getActualSize(e){const r=this.measurements.get(e);if(r!==void 0&&!Nr(r.actual))return r.actual}whatIsMeasured(){return[...this.measurements.keys()]}},Cp=class extends Dp{layouts;constructor(e){super(e),this.layouts=new Map}},Sp=class{canvasRegion=un;_desiredRect;_measuredSize;_layoutPosition;children=[];_parent;_idMap=new Map;debugLayout=!1;_visible=!0;_ready=!0;takesSpaceWhenInvisible=!1;_needsMeasuring=!0;_needsLayoutX=!0;_needsDrawing=!0;debugHue=Go();id;constructor(e,r){this.id=r,this._parent=e,e?.onChildAdded(this)}hasChild(e){const r=this.children.find(i=>i===e),n=this.children.find(i=>i.id===e.id);return r!==void 0||n!==void 0}notify(e,r){this.onNotify(e,r);for(const n of this.children)n.notify(e,r)}*getChildren(){return this.children.entries()}onNotify(e,r){}onChildAdded(e){if(e.hasChild(this))throw new Error("Recursive");if(e===this)throw new Error("Cannot add self as child");if(this.hasChild(e))throw new Error("Child already present");this.children.push(e),this._idMap.set(e.id,e),this.layoutInvalidated("Box.onChildAdded")}setReady(e,r=!1){if(this._ready=e,r)for(const n of this.children)n.setReady(e,r)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.layoutInvalidated("Box.set visible"))}get desiredRegion(){return this._desiredRect}set desiredRegion(e){K2(e,this._desiredRect)||(this._desiredRect=e,this.layoutInvalidated("set desiredRegion"))}layoutInvalidated(e){if(e===void 0)debugger;this.debugLog(`layoutInvalidated ${e}`),this._needsMeasuring=!0,this._needsLayoutX=!0,this._needsDrawing=!0,this.notifyChildLayoutNeeded()}drawingInvalidated(e){this._needsDrawing=!0}notifyChildLayoutNeeded(){this._needsDrawing=!0,this._needsLayoutX=!0,this._needsMeasuring=!0,this._parent!==void 0&&this._parent.notifyChildLayoutNeeded()}get root(){return this._parent===void 0?this:this._parent.root}measurePreflight(){}measureApply(e){this._needsMeasuring=!1;const r=this._measuredSize===void 0?!0:!Jf(e.actual,this._measuredSize);r&&(this._needsLayoutX=!0),this._measuredSize={width:e.actual.width,height:e.actual.height};for(const n of e.children)n!==void 0&&n.ref.measureApply(n);return r&&this.root.notify("measureApplied",this),r}layoutApply(e){this._needsLayoutX=!1;const r=this._layoutPosition===void 0?!0:!S.isEqual(e.actual,this._layoutPosition);this._layoutPosition={x:e.actual.x,y:e.actual.y};for(const n of e.children)n!==void 0&&n.ref.layoutApply(n);return r&&this.root.notify("layoutApplied",this),r}debugLog(e){this.debugLayout&&console.log(this.id,e)}layoutStart(e,r,n,i){const s={ref:this,actual:S.Empty,children:[]};r.layouts.set(this.id,s);const o=this.layoutSelf(e,r,i);if(this.root.notify("laidout",this),o!==void 0&&(s.actual=o,s.children=this.children.map(a=>a.layoutStart(e,r,n,s)),!(Dt.withoutUndefined(s.children).length<this.children.length)))return s}layoutSelf(e,r,n){const i=r.resolveBox(this._desiredRect),s=i===void 0?0:"x"in i?i.x:0,o=i===void 0?0:"y"in i?i.y:0;if(s===void 0)debugger;if(o===void 0)debugger;return{x:s,y:o}}measureStart(e,r,n){this.measurePreflight();const i={ref:this,actual:xi,children:[]};if(e.measurements.set(this.id,i),!this._visible&&!this.takesSpaceWhenInvisible)i.actual=Hf;else{let s=this._measuredSize;if((this._needsMeasuring||this._measuredSize===void 0)&&(s=this.measureSelf(e,n),this.root.notify("measured",this)),typeof s=="string")return;if(s===void 0)return;i.actual=s}if(i.children=this.children.map(s=>s.measureStart(e,r,i)),!(Dt.withoutUndefined(i.children).length<this.children.length))return i}measureSelf(e,r){let n=xi;const i=r?r.actual:e.bounds,s=e.resolveBox(this._desiredRect);return n=s?Kf(s,i):i,Nr(n)?"Box.measureSelf - No size for box?":n}update(e,r=!1){if(e===void 0)throw new Error("context is undefined");if(!this._needsMeasuring&&!this._needsLayoutX&&!r)return;const[n,i]=this.updateBegin(e);let s=5,o=!1,a=!1;if(this._needsMeasuring||r){for(;s--;){const u=this.measureStart(n,r);if(u!==void 0){if(this.measureApply(u),!this._ready)return;o=!0}}o||this.debugLog("Ran out of measurement attempts")}if(this._needsLayoutX||r){const u=this.layoutStart(n,i,r);u===void 0?this.debugLog("Warning: could not layout"):(this.layoutApply(u),a=!0)}this.updateComplete(o,a)}},Fp=class extends Ap{ctx;constructor(e,r){if(super(e),this.ctx=r,r===void 0)throw new Error("ctx is undefined")}},Pp=class extends Cp{ctx;constructor(e,r){if(super(e),this.ctx=r,r===void 0)throw new Error("ctx is undefined")}},Kr=class Np extends Sp{bounds;constructor(r,n,i){super(r,n),this.bounds=i,this.debugLog(`CanvasBox ctor bounds: ${JSON.stringify(i)}`)}static fromCanvas(r){return new Np(void 0,"canvas-box",r.getBoundingClientRect())}addEventHandlers(r){r.addEventListener("pointermove",n=>{const i={x:n.offsetX,y:n.offsetY};this.notifyPointerMove(i)}),r.addEventListener("pointerleave",n=>{this.notifyPointerLeave()}),r.addEventListener("click",n=>{const i={x:n.offsetX,y:n.offsetY};this.notifyClick(i)})}onClick(r){}notifyClick(r){if(!Nr(this.canvasRegion)&&lr(this.canvasRegion,r)){const n=S.subtract(r,this.canvasRegion.x,this.canvasRegion.y);this.onClick(n);for(const i of this.children)i.notifyClick(n)}}notifyPointerLeave(){this.onPointerLeave();for(const r of this.children)r.notifyPointerLeave()}notifyPointerMove(r){if(!Nr(this.canvasRegion)&&lr(this.canvasRegion,r)){const n=S.subtract(r,this.canvasRegion.x,this.canvasRegion.y);this.onPointerMove(n);for(const i of this.children)i.notifyPointerMove(n)}}onPointerLeave(){}onPointerMove(r){}update(r,n=!1){super.update(r,n),this.draw(r,n)}getBounds(){return this.bounds===void 0&&this._parent?this._parent.bounds:this.bounds}updateBegin(r){if(r===void 0)throw new Error("Context is undefined");let n=this.getBounds();return n===void 0&&(this.debugLog("No bounds for element or parent, using canvas bounds"),n={x:0,y:0,width:r.canvas.width,height:r.canvas.height}),[new Fp(n,r),new Pp(n,r)]}updateComplete(r,n){this.canvasRegion=un}measureApply(r){const n=super.measureApply(r);return n&&(this.canvasRegion=un),n}layoutApply(r){const n=super.layoutApply(r);return n&&(this.canvasRegion=un),n}draw(r,n=!1){if(this._needsDrawing||n){if(Nr(this.canvasRegion)){if(this._layoutPosition===void 0||this._measuredSize===void 0)return;this.canvasRegion={x:this._layoutPosition.x,y:this._layoutPosition.y,width:this._measuredSize.width,height:this._measuredSize.height}}this._needsLayoutX||this._needsMeasuring,r.save();const i=this.canvasRegion;r.translate(i.x,i.y),this.debugLayout&&(r.lineWidth=1,r.strokeStyle=`hsl(${this.debugHue}, 100%, 50%)`,r.strokeRect(0,0,i.width,i.height),r.fillStyle=r.strokeStyle,r.fillText(this.id,10,10,i.width),r.beginPath(),r.moveTo(0,0),r.lineTo(i.width,i.height),r.stroke()),this.drawSelf(r),this._needsDrawing=!1,r.restore()}for(const i of this.children)i.draw(r,n)}drawSelf(r){}},kp=e=>{const r=X(e),n=window.devicePixelRatio;return r.style.width=r.width+"px",r.style.height=r.height+"px",r.width*=devicePixelRatio,r.height*=devicePixelRatio,{ctx:(()=>{const s=r.getContext("2d");if(s===null)throw new Error("Could not get drawing context");return s.save(),s.scale(n,n),s})(),element:r,bounds:r.getBoundingClientRect()}},Mp={};E(Mp,{resizeObservable:()=>Ju,themeChange:()=>Z2,windowResize:()=>An});var An=e=>Qu.debounce({elapsed:e??100})(hr.event(window,"resize")),Z2=()=>hr.observable(r=>{const n=new MutationObserver(s=>{r.set(s)}),i={attributeFilter:["class"],attributes:!0};return n.observe(document.documentElement,i),()=>{n.disconnect()}}),Ju=(e,r)=>{if(e===null)throw new Error("elem parameter is null. Expected element to observe");if(e===void 0)throw new Error("elem parameter is undefined. Expected element to observe");const n=hr.observable(i=>{const s=new ResizeObserver(o=>{i.set(o)});return s.observe(e),()=>{s.unobserve(e)}});return Qu.debounce({elapsed:r??100})(n)},Yu=(e,r,n=100)=>{const i=X(e);if(i.nodeName!=="CANVAS")throw new Error(`Expected HTML element with node name CANVAS, not ${i.nodeName}`);const s=i.parentElement;if(s===null)throw new Error("Element has no parent");const o=i.getContext("2d");if(o===null)throw new Error("Could not create drawing context");return i.style.width="100%",i.style.height="100%",Ju(s,n).value(u=>{const l=u.find(d=>d.target===s);if(l===void 0)return;const c=l.contentRect.width,f=l.contentRect.height;if(i.setAttribute("width",i.offsetWidth+"px"),i.setAttribute("height",i.offsetHeight+"px"),r!==void 0){const d={min:Math.min(c,f),max:Math.max(c,f),width:c,height:f,center:{x:c/2,y:f/2}};r({ctx:o,el:i,bounds:d})}})},Q2=(e,r,n=!1)=>{if(e==null)throw new Error("domQueryOrEl is null or undefined");const i=X(e);if(i.nodeName!=="CANVAS")throw new Error(`Expected HTML element with node name CANVAS, not ${i.nodeName}`);const s=i.getContext("2d");if(s===null)throw new Error("Could not create drawing context");const o=()=>{const u=window.innerWidth,l=window.innerHeight;if(i.width=u,i.height=l,r!==void 0){const c={min:Math.min(u,l),max:Math.max(u,l),width:u,height:l,center:{x:u/2,y:l/2}};r({ctx:s,el:i,bounds:c})}};n||(i.style.top="0",i.style.left="0",i.style.zIndex="-100",i.style.position="fixed");const a=An();return a.value(o),o(),a},$p=class{data;series;dirty=!1;type="array";_range;constructor(e){this.series=e,this.data=[],this.dirty=!0}clear(){this.set([]),this._range=void 0}set(e){this.data=e,this.dirty=!0}get length(){return this.data.length}get range(){if(!this.dirty&&this._range!==void 0)return this._range;this.dirty=!1;const e=kn(this.data);return this._range===void 0||e.max!==this._range.max||e.min!==this._range.min?(this._range=e,{...this._range,changed:!0}):{...this._range,changed:!1}}add(e){this.data=[...this.data,e],this.dirty=!0}},eS=class extends $p{desiredDataPointMinWidth=5;add(e){const r=this.series.lastPxPerPt;if(r>-1&&r<this.desiredDataPointMinWidth){const n=Math.floor(this.desiredDataPointMinWidth/r),i=[...this.data.slice(n),e];super.set(i)}else super.add(e)}},Bp=class{constructor(e,r,n,i){if(this.plot=n,this.name=e,this.drawingStyle=i.drawingStyle??"line",this.colour=i.colour,this.width=i.width??3,this.axisRange=i.axisRange??{min:Number.NaN,max:Number.NaN},this._visualRange={...this.axisRange},this._visualRangeStretch=i.visualRangeStretch??!0,r==="array")this.source=new $p(this);else if(r==="stream")this.source=new eS(this);else throw new Error("Unknown sourceType. Expected array|stream")}name;colour;source;drawingStyle;width=3;dataHitPoint;tooltip;precision=2;axisRange;lastPxPerPt=-1;_visualRange;_visualRangeStretch;formatValue(e){return e.toFixed(this.precision)}get visualRange(){let e=this._visualRange;const r=this.source.range;let n=!1;if(r.changed)if(this._visualRangeStretch){const i=Math.min(eo(e.min,r.min),r.min),s=Math.max(eo(e.max,r.max),r.max);(i!==e.min||s!==e.max)&&(e={min:i,max:s},n=!0)}else tS(r,e)||(e=r,n=!0);return this._visualRange=e,{...e,changed:n}}scaleValue(e){if(this.source===void 0)return e;const r=this.visualRange;return r.changed&&this.plot.notify("range-change",this.plot.plotArea),r.min==r.max?.5:st(e,r.min,r.max)}add(e){P(e,"","value"),this.source.add(e),this.plot.plotArea.drawingInvalidated("Series.add")}clear(){this.source.clear(),this._visualRange={...this.axisRange},this.plot.plotArea.layoutInvalidated("Series.clear")}},_p=class extends Kr{constructor(e,r){super(e,"PlotArea",r),this.plot=e}paddingPx=5;piPi=Math.PI*2;pointerDistanceThreshold=20;lastRangeChange=0;pointer;clear(){this.lastRangeChange=0,this.pointer=void 0}measureSelf(e,r){const n=e.getActualSize("AxisY"),i=this.paddingPx,s=e.getActualSize("Legend"),o=s?.height??0,a=e.getActualSize("AxisX"),u=a?.height??0;return n?s?a?{width:e.bounds.width-n.width-this.paddingPx,height:e.bounds.height-o-u-i}:"No AxisX":"No Legend":`No AxisY. Measured: ${e.whatIsMeasured().join(", ")}`}layoutSelf(e,r,n){const i=e.getActualSize("AxisY"),s=this.paddingPx;return{x:i?.width??0,y:s}}onNotify(e,r){e==="measureApplied"&&r===this.plot.axisY&&this.layoutInvalidated("PlotArea.onNotify measureApplied to axisY"),e==="laidout"&&r===this.plot.legend&&this.layoutInvalidated("PlotArea.onNotify laidout to legend")}onPointerLeave(){for(const e of this.plot.series.values())e.tooltip=void 0;this.pointer=void 0,this.plot.legend.drawingInvalidated("PlotArea.onPointerLeave")}onPointerMove(e){this.pointer=e,this.plot.legend.drawingInvalidated("PlotArea.onPointerMove")}measurePreflight(){this.updateTooltip()}updateTooltip(){const e=this.pointer;if(e!==void 0){for(const r of this.plot.series.values()){if(e===void 0){r.tooltip=void 0;return}if(r.dataHitPoint===void 0)return;const n=r.dataHitPoint(e);if(n[0]===void 0||n[1]>this.pointerDistanceThreshold)return;r.tooltip=r.formatValue(n[0].value)}this.plot.legend.drawingInvalidated("PlotArea.updateTooltip")}}drawSelf(e){if(this.plot.frozen)return;const r=this.plot.seriesArray();e.clearRect(0,-1,this.canvasRegion.width,this.canvasRegion.height);for(const n of r)if(n.source.type==="array"||n.source.type==="stream"){const i=n.source;if(i.data===void 0)return;const s=[...i.data];this.drawDataSet(n,s,e)}else console.warn(`Unknown data source type ${n.source.type}`)}computeY(e,r){const n=e.scaleValue(r);return li(n)*this.canvasRegion.height+this.paddingPx}drawDataSet(e,r,n){const i=this.paddingPx+e.width,s=Gf(this.canvasRegion,i*2,i*3.5),o=s.width/r.length;e.lastPxPerPt=o;let a=i;n.strokeStyle=e.colour,n.lineWidth=e.width;const u=[];if(e.dataHitPoint=l=>{const c=u.map(h=>Zf(l,h)),f=ra(...c);return[u[f],c[f]]},e.drawingStyle==="line"){let l=0;n.beginPath();for(let c=0;c<r.length;c++){const f=Ne(e.scaleValue(r[c]));l=i+this.paddingPx+s.height*li(f),u.push({x:a,y:l,index:c,value:r[c]}),c==0?n.moveTo(a+o/2,l):n.lineTo(a+o/2,l),l>this.canvasRegion.height&&console.warn(`${l} h: ${this.canvasRegion.height}`),a+=o}n.strokeStyle=e.colour,n.stroke()}else if(e.drawingStyle==="dotted"){let l=0;n.fillStyle=e.colour;for(let c=0;c<r.length;c++){const f=e.scaleValue(r[c]);l=i+s.height*li(f),n.beginPath(),n.arc(a+o/2,l,e.width,0,this.piPi),n.fill(),u.push({radius:e.width,x:a,y:l,index:c,value:r[c]}),a+=o}}else if(e.drawingStyle==="bar"){n.fillStyle=e.colour;const l=Math.ceil(o*.1);for(let c=0;c<r.length;c++){const f=e.scaleValue(r[c]),d=s.height*f,h={x:a+l,y:s.height-d+i,width:o-l,height:d,index:c,value:r[c]};n.fillRect(h.x,h.y,h.width,h.height),u.push(h),a+=o}}}},Tp=class extends Kr{constructor(e,r){super(e,"Legend",r),this.plot=e}sampleSize={width:10,height:10};padding=3;widthSnapping=20;labelMeasurements=new Map;clear(){}layoutSelf(e,r,n){const s=e.getActualSize("AxisY")?.width??0,o=this._measuredSize?.height??0;return{x:s,y:r.bounds.height-o}}measureSelf(e,r){const n=this.plot.seriesArray(),i=this.sampleSize,s=this.padding,o=this.widthSnapping,a=e.ctx,l=e.measurements.get("AxisY")?.actual.width??0;let c=s,f=s;const d=e.bounds.width-l-s;let h=0;for(const y of n){const v=c;c+=i.width+s,a.textBaseline="middle";const m=As(a,y.name,s,o);c+=_i(a,y.name,s,o),y.tooltip&&(c+=_i(a,y.tooltip,s,o));const g={width:10,height:10,x:v,y:f};this.labelMeasurements.set(y.name,g),h=Math.min(i.height+s+s,m.height+s+s),c+=s,c>d&&(c=s,f+=h)}return{width:d,height:f+h}}drawSelf(e){const r=this.plot.seriesArray(),n=this.sampleSize,i=this.padding;this.debugLog("drawSelf"),e.clearRect(0,0,this.canvasRegion.width,this.canvasRegion.height);for(const s of r){const o=this.labelMeasurements.get(s.name);if(o===void 0)continue;let a=o.x;e.fillStyle=s.colour,e.fillRect(a,o.y,n.width,n.height),a+=n.width+i,e.textBaseline="middle",e.fillStyle=this.plot.legendTextColour,e.fillText(s.name,a,o.y+n.height/2),s.tooltip&&(e.fillStyle=this.plot.legendTextColour,e.fillText(s.tooltip,o.x,o.y+n.height/2))}}onNotify(e,r){this.debugLog(`onNotify ${e} source: ${r.id}`),e==="measureApplied"&&r===this._parent.axisY&&this.layoutInvalidated("Legend.onNotify measureApplied to axisY")}},zp=class extends Kr{constructor(e,r){super(e,"AxisX",r),this.plot=e}paddingPx=2;colour;clear(){}onNotify(e,r){e==="measureApplied"&&r===this.plot.axisY&&this.layoutInvalidated("AxisX.onNotify measureApplied to axisY")}drawSelf(e){const r=this.plot,n=this.canvasRegion,i=r.axisStrokeWidth,s=this.colour??r.axisStrokeColour;e.strokeStyle=s,e.clearRect(0,0,n.width,n.height),e.beginPath(),e.lineWidth=i,e.moveTo(0,i/2),e.lineTo(n.width,i/2),e.stroke()}measureSelf(e,r){const n=this.plot,i=this.paddingPx,o=e.measurements.get("AxisY")?.actual.width??0,u=n.axisStrokeWidth+0+i+i;return{width:e.bounds.width-o-i,height:u}}layoutSelf(e,r,n){const i=e.measurements.get("AxisY"),o=e.getActualSize("Legend")?.height??0,a=i?.actual.width??0,u=this._measuredSize?.height??0;return{x:a,y:e.bounds.height-u-o}}},tS=(e,r)=>e.max===r.max&&e.min===r.min,rS=e=>e.max===e.min,Rp=class extends Kr{constructor(e,r){super(e,"AxisY",r),this.plot=e,this.lastRange={min:0,max:0}}_maxDigits=1;seriesToShow;paddingPx=2;colour;lastRange;lastPlotAreaHeight=0;clear(){this.lastRange={min:0,max:0},this.lastPlotAreaHeight=0}measurePreflight(){}onNotify(e,r){const n=this.plot.plotArea;if(e==="range-change"){this.drawingInvalidated("range-change");return}e==="measureApplied"&&r===n&&n.canvasRegion.height!==this.lastPlotAreaHeight&&(this.lastPlotAreaHeight=n.canvasRegion.height,this.drawingInvalidated("AxisY.onNotify height change"))}measureSelf(e){if(e.ctx===void 0)throw new Error("opts.ctx is undefined");const r=this.paddingPx;let n=this.plot.axisStrokeWidth+r;const i=this.getSeries();if(i!==void 0){const o=i.visualRange;this._maxDigits=Math.ceil(o.max).toString().length+i.precision+1;const a="9".repeat(this._maxDigits);n+=_i(e.ctx,a,r*2)}return{width:e.resolveToPx(this.desiredRegion?.width,n,n),height:e.bounds.height}}layoutSelf(e,r,n){return{x:0,y:0}}drawSelf(e){const r=this.getSeries();if(r===void 0){if(this.seriesToShow===void 0)return;console.warn(`Plot AxisY series '${this.seriesToShow}' is missing.`)}else this.seriesAxis(r,e)}getSeries(){return this.seriesToShow===void 0?this.plot.seriesArray()[0]:this.plot.series.get(this.seriesToShow)}seriesAxis(e,r){const n=this.plot,i=n.plotArea,s=this.canvasRegion,o=this.paddingPx,a=e.visualRange,u=n.axisStrokeWidth,l=this.colour??n.axisStrokeColour;if(r.strokeStyle=l,r.fillStyle=l,Number.isNaN(a.min)&&Number.isNaN(a.max))return;this.lastRange=a,r.clearRect(0,0,s.width,s.height),r.beginPath(),r.lineWidth=u;const c=s.width-u/2;r.moveTo(c,i.paddingPx+u),r.lineTo(c,i.canvasRegion.height+o+u+u),r.stroke(),r.textBaseline="top";const f=s.width-o*4;r.fillStyle=n.axisTextColour,rS(a)?(this.debugLog("rangeSinglePoint"),qs(r,e.formatValue(a.max),d=>[f-d.width,i.computeY(e,a.max)-o*4])):(qs(r,e.formatValue(a.max),d=>[f-d.width,i.computeY(e,a.max)+u/2]),qs(r,e.formatValue(a.min),d=>[f-d.width,i.computeY(e,a.min)-5]))}},qs=(e,r,n)=>{if(e===void 0)throw new Error("ctx is undefined");const i=e.measureText(r),s=n(i);e.fillText(r,s[0],s[1])},nS=class extends Kr{plotArea;legend;axisX;axisY;axisStrokeColour;axisTextColour;legendTextColour;axisStrokeWidth;series;_frozen=!1;_canvasEl;_ctx;defaultSeriesOpts;constructor(e,r={}){const{ctx:n,element:i,bounds:s}=kp(e);super(void 0,"Plot"),this._canvasEl=i,this._ctx=n,r.autoSize&&Yu(i,o=>{this.drawingInvalidated("resize"),this.layoutInvalidated("resize"),this.update(o.ctx,!0)}),this.axisStrokeColour=r.axisStrokeColour??"black",this.axisTextColour=r.axisTextColour??"black",this.legendTextColour=r.legendTextColour??"black",this.axisStrokeWidth=r.axisStrokeWidth??3,this.series=new Map,this.plotArea=new _p(this,s),this.legend=new Tp(this,s),this.axisX=new zp(this,s),this.axisY=new Rp(this,s)}update(e,r=!1){e===void 0&&(e=this._ctx),super.update(e,r)}clearSeries(){for(const e of this.series.values())e.clear();this.update()}clear(){this.series=new Map,this.plotArea.clear(),this.legend.clear(),this.axisX.clear(),this.axisY.clear(),this.layoutInvalidated("Plot.clear"),this.drawingInvalidated("Plot.clear"),this.update()}get frozen(){return this._frozen}set frozen(e){this._frozen=e,e?(this._canvasEl.classList.add("frozen"),this._canvasEl.title="Plot frozen. Tap to unfreeze"):(this._canvasEl.title="",this._canvasEl.classList.remove("frozen"))}seriesArray(){return[...this.series.values()]}get seriesLength(){return this.series.size}plot(e){const r=wv(e,!0);let n=!1;for(const i of r){let s=this.series.get(i);s===void 0&&(s=this.createSeries(i,"stream"),s.drawingStyle="line",n=!0),s.add(gv(e,i))}n&&this.legend.layoutInvalidated("new series"),this.update()}createSeriesFromObject(e,r=""){const n=Object.keys(e),i=s=>{const o=e[s];return typeof o=="object"?this.createSeriesFromObject(o,`${r}${s}.`):typeof o=="number"?[this.createSeries(s,"stream")]:[]};return n.flatMap(s=>i(s))}createSeries(e,r="array",n){const i=this.seriesLength;if(e===void 0&&(e=`series-${i}`),this.series.has(e))throw new Error(`Series name '${e}' already in use`);let s={colour:`hsl(${i*25%360}, 70%,50%)`,...n};this.defaultSeriesOpts&&(s={...this.defaultSeriesOpts,...s});const o=new Bp(e,r,this,s);return this.series.set(e,o),this.setReady(!0,!0),this.plotArea.drawingInvalidated("Plot.createSeries"),o}},Xu={};E(Xu,{create:()=>iS});var iS=e=>new sS(e),sS=class{#e=new Map;#t=new Map;fallbacks;#r=0;#n;constructor(e){e!==void 0?this.fallbacks=e:this.fallbacks=["red","blue","green","orange"],this.#n=document.body}setElementBase(e){this.#n=e}add(e,r){this.#e.set(e,r)}alias(e,r){this.#t.set(e,r)}get(e,r){const n=this.#t.get(e);n!==void 0&&(e=n);const i=this.#e.get(e);if(i!==void 0)return i;const s="--"+e;let o=getComputedStyle(this.#n).getPropertyValue(s).trim();if(o===void 0||o.length===0){if(r!==void 0)return r;o=this.fallbacks[this.#r],this.#r++,this.#r===this.fallbacks.length&&(this.#r=0)}return o}getOrAdd(e,r){if(this.has(e))return this.get(e);const n=this.get(e,r);return this.add(e,n),n}has(e){return this.#e.has(e)}},Ip={};E(Ip,{init:()=>oS});function ql(e,r,n){const i=e.getAttribute(r);return i===null?n:Number.parseInt(i)}var oS=(e,r={})=>{const n=document.querySelector(e);if(!n)throw new Error(`Element query could not be found (${e})`);const i=r.labels??["x","y"],s=r.labelPrecision??2,o=r.asPercentages??!1,a=r.showWhiskers??!0,u=r.showDot??!0,l=r.showLabels??!0,c=r.axisColour??"silver",f=r.bgColour??"white",d=r.whiskerColour??"black",h=r.dotColour??d,y=r.labelColour??c,v=r.axisWidth??1*window.devicePixelRatio,m=r.dotRadius??5*window.devicePixelRatio,g=r.padding??10*window.devicePixelRatio,x=r.whiskerSize??5*window.devicePixelRatio,F=r.width??ql(n,"width",200)*window.devicePixelRatio,M=r.height??ql(n,"height",200)*window.devicePixelRatio;n.width=F,n.height=M,n.style.width=F/window.devicePixelRatio+"px",n.style.height=M/window.devicePixelRatio+"px";const j=M/2,A=F/2,C=n.getContext("2d");if(!C)throw new Error("Could not create drawing context");window.devicePixelRatio>=2&&(C.font="20px sans-serif");const Y=o?te=>Math.round(te*100)+"%":te=>te.toFixed(s);l?(i[0]=i[0]+":",i[1]=i[1]+":"):(i[0]="",i[1]="");const ie=r.renderBackground??((te,se,ye)=>{te.fillStyle=f,te.fillRect(0,0,se,ye)});return(te,se)=>{te=ir(te),se=ir(se),ie(C,F,M),C.fillStyle=y,C.textBaseline="top",C.save(),C.translate(A,j),C.rotate(-Math.PI/2),C.fillText((i[1]+" "+Y(se)).trim(),-A+g,1),C.restore(),C.fillText((i[0]+" "+Y(te)).trim(),g,A+2),C.strokeStyle=c,C.lineWidth=v,C.beginPath(),C.moveTo(g,j),C.lineTo(F-g,j),C.moveTo(A,g),C.lineTo(A,M-g),C.stroke(),C.closePath();const ye=(M-g-g)/2*-se,K=(F-g-g)/2*te;C.save(),C.translate(A,j),u&&Wu(C,{radius:m,x:K,y:ye},{fillStyle:h}),a&&(C.strokeStyle=d,C.beginPath(),C.moveTo(0,ye-x),C.lineTo(0,ye+x),C.moveTo(K-x,0),C.lineTo(K+x,0),C.stroke(),C.closePath()),C.restore()}},jp={};E(jp,{add:()=>Lp,calcScale:()=>Ku,defaultAxis:()=>_o,draw:()=>Br,drawValue:()=>Vp,plot:()=>vS});var aS=Math.PI*2,_o=e=>({endWith:"none",lineWidth:1,namePosition:"none",name:e,showLabels:e==="y",showLine:!0,textSize:e==="y"?20:10}),Ku=(e,r,n)=>{const i=[];for(const s of e.keys()){const o=[...e.get(s)];if(o.length===0)break;let{min:a,max:u}=kn(o),l=u-a,c;n!==void 0&&(c=n[s]),c==null&&(c=r.defaultSeriesVariable?Sn.getCssVariable("accent",r.defaultSeriesColour):r.defaultSeriesColour),l===0&&(l=a,a=a-l/2,u=u+l/2),i.push({min:a,max:u,range:l,name:s,colour:c})}return i},Lp=(e,r,n="")=>{e.addKeyedValues(n,r)},Vp=(e,r,n)=>{const i={...n,translucentPlot:!0,leadingEdgeDot:!1};Br(r,i),n={...n,highlightIndex:e,leadingEdgeDot:!0,translucentPlot:!1,style:"none",clearCanvas:!1},Br(r,n)},uS=(e,r,n)=>Ku(e,n,n.seriesColours).map(i=>({...i,range:r[1]-r[0],min:r[0],max:r[1]})),Br=(e,r)=>{const{x:n,y:i,ctx:s,canvasSize:o}=r,a=r.margin,u=r.y.scaleRange?uS(e,r.y.scaleRange,r):Ku(e,r,r.seriesColours);r.clearCanvas&&s.clearRect(0,0,o.width,o.height),r.debug&&(s.strokeStyle="orange",s.strokeRect(0,0,o.width,o.height)),s.translate(a,a);const l=r.plotSize??qp(o,r),c={height:l.height+a+a,width:l.width};if(i.showLabels||i.showLine){for(const d of u)i.allowedSeries!==void 0&&!i.allowedSeries.includes(d.name)||lS(d,c,r);u.length>0&&i.showLine&&cS(c,u[0],r)}if((n.showLabels||n.showLine)&&u.length>0){const d=i.labelRange?i.labelRange[0]:u[0].min;dS(l.width,sr(d,u[0],l.height)+a+n.lineWidth,r)}const f={...r,plotSize:l};bs.translatePoint(s,r.pointer);for(const d of u){const h=e.getSource(d.name);if(h===void 0)continue;let y=e.typeName==="circular"?h.pointer-1:h.length-1;r.highlightIndex!==void 0&&(y=r.highlightIndex),s.save(),s.translate(0,a+a),hS(d,h,l,f,y),s.restore()}r.showLegend&&(s.save(),s.translate(0,l.height+a+a+a),l.width,r.x.textSize+a+a,fS(u,r),s.restore()),s.resetTransform()},lS=(e,r,n)=>{const{ctx:i,y:s,digitsPrecision:o,margin:a}=n,{height:u}=r;n.debug&&(i.strokeStyle="purple",i.strokeRect(0,0,s.textSize,u+a)),i.fillStyle=e.colour.length>0?e.colour:"white",s.colour&&(i.fillStyle=s.colour);const l=s.labelRange?s.labelRange[0]:e.min,c=s.labelRange?s.labelRange[1]:e.max,f=s.labelRange?c-l:e.range,d=l+f/2,h=n.textHeight/2;i.textBaseline="top",i.fillText(l.toFixed(o),0,sr(l,e,u)-h),i.fillText(d.toFixed(o),0,sr(d,e,u)-h),i.fillText(c.toFixed(o),0,sr(c,e,u)-a),i.translate(s.textSize+a,0)},cS=(e,r,n)=>{if(r===void 0)throw new Error("series undefined");const{ctx:i,y:s}=n,{height:o}=e,a=s.labelRange?s.labelRange[0]:r.min,u=s.labelRange?s.labelRange[1]:r.max,l=sr(a,r,o),c=sr(u,r,o);i.translate(s.lineWidth,0),i.lineWidth=s.lineWidth,i.beginPath(),i.moveTo(0,l),i.lineTo(0,c),i.strokeStyle=r.colour,s.colour&&(i.strokeStyle=s.colour),i.stroke(),i.translate(s.lineWidth,0)},fS=(e,r,n)=>{const{ctx:i}=r,s=10;let o=0;const a=r.margin*3,u=r.margin;i.lineWidth=r.lineWidth;for(const l of e){i.moveTo(o,a),i.strokeStyle=l.colour,i.lineTo(o+s,a),i.stroke(),o+=s+r.margin;let c=l.name;l.lastValue&&(c+=" "+l.lastValue.toFixed(r.digitsPrecision));const f=i.measureText(c);i.fillStyle=l.colour,i.fillText(c,o,u),o+=f.width}},dS=(e,r,n)=>{const{ctx:i,x:s,y:o}=n;s.showLine&&(s.colour&&(i.strokeStyle=s.colour),i.lineWidth=s.lineWidth,i.beginPath(),i.moveTo(0,r),i.lineTo(e,r),i.stroke())},hS=(e,r,n,i,s)=>{const{ctx:o,lineWidth:a,translucentPlot:u=!1,margin:l,x:c}=i,f=i.style??"connected",d=n.height-l;let h=1;if(c.scaleRange){const x=c.scaleRange[1]-c.scaleRange[0];h=n.width/x}else h=i.capacity===0?n.width/r.length:n.width/i.capacity;const y=i.coalesce&&h<0?Math.floor(1/h):1;let v=0,m;i.debug&&(o.strokeStyle="green",o.strokeRect(0,0,n.width,n.height));const g=x=>u?Sn.opacity(x,.2):x;f==="dots"?o.fillStyle=g(e.colour):f==="none"||(o.beginPath(),o.lineWidth=a,o.strokeStyle=g(e.colour));for(let x=0;x<r.length;x+=y){const F=sr(r[x],e,d)-1;f==="dots"?(o.beginPath(),o.arc(v,F,a,0,aS),o.fill()):f==="none"||(x==0&&o.moveTo(v,F),o.lineTo(v,F)),x===s&&(m={x:v,y:F},e.lastValue=r[x]),v+=h}f==="connected"&&o.stroke(),m!==void 0&&i.leadingEdgeDot&&(o.beginPath(),o.fillStyle=g(e.colour),o.arc(m.x,m.y,3,0,2*Math.PI),o.fill())},sr=(e,r,n)=>(1-(e-r.min)/r.range)*n,Op=(e,r,n,i)=>{let s=e;n.showLabels&&(s+=n.textSize),n.showLine&&(s+=n.lineWidth),(n.showLabels||n.showLine)&&(s+=e+e);const o=e,a=e+e;let u=e+e;return u+=r.showLabels?r.textSize:e,r.showLine&&(u+=r.lineWidth),(r.showLabels||r.showLine)&&(u+=e),i&&(u+=r.textSize),{left:s,right:o,top:a,bottom:u}},qp=(e,r)=>{const{width:n,height:i}=e,s=Op(r.margin,r.x,r.y,r.showLegend);return{width:n-s.left-s.right,height:i-s.top-s.bottom}},yS=(e,r)=>{const{width:n,height:i}=e,s=Op(r.margin,r.x,r.y,r.showLegend);return{width:n+s.left+s.right,height:i+s.top+s.bottom}},vS=(e,r)=>{if(e===null)throw new Error("parentElOrQuery is null. Expected string or element");const n=X(e);let i,s=!0,o=r.plotSize,a;n.nodeName==="CANVAS"?(i=n,s=!1,a={width:i.width,height:i.height}):(i=document.createElement("CANVAS"),n.append(i),o=r.plotSize,a={width:i.width,height:i.height});const u={x:0,y:0},l=x=>{u.x=x.offsetX,u.y=x.offsetY};i.addEventListener("pointermove",l);const c=i.getContext("2d"),f=r.capacity??10,d=f>0?fv({capacity:f}):hv(),h=c.measureText("Xy"),y=r.coalesce??!0;if(c===null)throw new Error("Drawing context not available");let v=_o("x");r.x&&(v={...v,...r.x});let m=_o("y");r.y&&(m={...m,...r.y});let g={...r,y:m,x:v,pointer:u,capacity:f,coalesce:y,plotSize:o,canvasSize:a,ctx:c,textHeight:r.textHeight??h.actualBoundingBoxAscent+h.actualBoundingBoxDescent,style:r.style??"connected",defaultSeriesColour:r.defaultSeriesColour??"yellow",margin:3,clearCanvas:!0,leadingEdgeDot:!0,debug:r.debug??!1,digitsPrecision:r.digitsPrecision??2,lineWidth:r.lineWidth??2,showLegend:r.showLegend??!1};if(o){const x=yS(o,g);i.width=x.width,i.height=x.height,g.canvasSize=x}return r.autoSizeCanvas&&Yu(i,x=>{const F=x.bounds;g={...g,plotSize:qp(F,g),canvasSize:F},Br(d,g)}),{drawValue:x=>{Vp(x,d,g)},dispose:()=>{i.removeEventListener("pointermove",l),s&&i.remove()},add:(x,F="",M=!1)=>{Lp(d,x,F),!M&&Br(d,g)},draw:()=>{Br(d,g)},clear:()=>{d.clear()}}};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{SceneGraph:Hu,Plot2:Uu,Drawing:bs,Svg:Pa,Palette:Xu,Colour:Sn,Video:Ja}})}catch{}var pS={};E(pS,{CanvasHelper:()=>qS,DataDisplay:()=>TS,DataTable:()=>Qp,DragDrop:()=>im,Forms:()=>X0,Rx:()=>Mp,Variables:()=>sm,byId:()=>kS,cardinalPosition:()=>wS,clear:()=>SS,copyToClipboard:()=>FS,createAfter:()=>AS,createIn:()=>CS,cycleCssClass:()=>ES,defaultErrorHandler:()=>IS,el:()=>$S,elRequery:()=>MS,fullSizeCanvas:()=>Q2,fullSizeElement:()=>nm,getTranslation:()=>DS,inlineConsole:()=>LS,insertSorted:()=>PS,log:()=>Wp,parentSize:()=>zS,parentSizeCanvas:()=>Yu,pointScaler:()=>Gp,pointerVisualise:()=>RS,positionFn:()=>Up,positionFromMiddle:()=>bS,positionRelative:()=>xS,query:()=>zo,reconcileChildren:()=>NS,resolveEl:()=>X,resolveEls:()=>pr,setCssClass:()=>Jp,setCssDisplay:()=>Xp,setCssToggle:()=>Yp,setHtml:()=>Kp,setText:()=>Zp,viewportToSpace:()=>Hp});var mS=(e,r)=>{const n=document.createElement("style");n.textContent=r;let i;return e.shadowRoot?(i=e.shadowRoot,i.innerHTML=""):i=e.attachShadow({mode:"open"}),i.append(n),i},Wp=(e,r={})=>{const{capacity:n=0,monospaced:i=!0,timestamp:s=!1,collapseDuplicates:o=!0,css:a=""}=r;let u=0,l,c=0;const f=X(e),h=mS(f,`
  .log {
    font-family: ${i?'Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", Monaco, "Courier New", Courier, monospace':"normal"};
    background-color: var(--code-background-color);
    padding: var(--padding1, 0.2em);
    overflow-y: auto;
    height:100%;
  }
  .timestamp {
    margin-right: 0.5em;
    opacity: 0.5;
    font-size: 70%;
    align-self: center;
  }
  .line {
    display: flex;
    padding-bottom: 0.1em;
    padding-top: 0.1em;
  }
  .line:hover {
  
  }
  .error {
    color: red;
  }
  .badge {
    border: 1px solid currentColor;
    align-self: center;
    font-size: 70%;
    padding-left: 0.2em;
    padding-right: 0.2em;
    border-radius: 1em;
    margin-left: 0.5em;
    margin-right: 0.5em;
  }
  .msg {
    flex: 1;
    word-break: break-word;
  }
  ${a}
  `),y=document.createElement("div");y.className="log",h.append(y);const v=A=>{const C=document.createElement("div");if(typeof A=="string")C.innerHTML=A;else if(A instanceof Error){const $=A.stack;C.innerHTML=$===void 0?A.toString():$.toString()}else C.innerHTML=A;C.classList.add("error"),F(C),l=void 0,c=0};let m=0;const g=(A="")=>{const C=x(A);return C&&(C.classList.add("warning"),C)},x=(A="")=>{let C;const $=window.performance.now()-m;if(!(r.minIntervalMs&&$<r.minIntervalMs))if(m=window.performance.now(),typeof A=="object"?C=JSON.stringify(A):A===void 0?C="(undefined)":A===null?C="(null)":typeof A=="number"?(Number.isNaN(C)&&(C="(NaN)"),C=A.toString()):C=A,C.length===0){const T=document.createElement("hr");l=void 0,F(T)}else if(C===l&&o){const T=y.firstElementChild;let Y=T.querySelector(".badge");return Y===null&&(Y=document.createElement("div"),Y.className="badge",T.insertAdjacentElement("beforeend",Y)),T!==null&&(Y.textContent=(++c).toString()),T}else{const T=document.createElement("div");return T.textContent=C,F(T),l=C,T}},F=A=>{if(s){const C=document.createElement("div"),$=document.createElement("div");$.className="timestamp",$.textContent=new Date().toLocaleTimeString(),C.append($,A),A.classList.add("msg"),C.classList.add("line"),A=C}else A.classList.add("line","msg");if(r.reverse?y.append(A):y.insertBefore(A,y.firstChild),n>0&&++u>n*2)for(;u>n;)y.lastChild?.remove(),u--;r.reverse&&(y.scrollTop=y.scrollHeight),c=0};return{error:v,log:x,warn:g,append:F,clear:()=>{y.innerHTML="",l=void 0,c=0,u=0},dispose:()=>{y.remove()},get isEmpty(){return u===0}}},gS=jo(xu()),Gp=(e="viewport")=>{switch(e){case"viewport":return(r,n)=>{const i=Ae(r,n);return Object.freeze({x:i.x/window.innerWidth,y:i.y/window.innerHeight})};case"screen":return(r,n)=>{const i=Ae(r,n);return Object.freeze({x:i.x/screen.width,y:i.y/screen.height})};case"document":return(r,n)=>{const i=Ae(r,n);return Object.freeze({x:i.x/document.body.scrollWidth,y:i.y/document.body.scrollHeight})};default:throw new Error(`Unknown 'reference' parameter: ${JSON.stringify(e)}`)}},Up=(e,r={})=>{const n=r.target??"viewport",i=r.relative??!1,s=r.anchor??"nw",o=X(e),a=Hp(n);if(i){const u=Gp(n);return()=>u(a(mi(o.getBoundingClientRect(),s)))}else return()=>a(mi(o.getBoundingClientRect(),s))},wS=(e,r="nw")=>{const n=X(e);return mi(n.getBoundingClientRect(),r)},xS=(e,r="viewport")=>Up(e,{relative:!0,target:r})(),Hp=(e="viewport")=>{switch(e){case"screen":return(r,n)=>{const i=Ae(r,n);return Object.freeze({x:i.x+window.screenX,y:i.y+window.screenY})};case"document":return(r,n)=>{const i=Ae(r,n);return Object.freeze({x:i.x+window.scrollX,y:i.y+window.scrollY})};case"viewport":return(r,n)=>{const i=Ae(r,n);return Object.freeze({x:i.x,y:i.y})};default:throw new Error(`Unexpected target coordinate space: ${e}. Expected: viewport, document or screen`)}},bS=(e,r,n="window")=>{if(!e)throw new Error("domQueryOrEl is null or undefined");const i=X(e),s=Ir(r,window.innerWidth,window.innerHeight),o=i.getBoundingClientRect(),a=Te(s,o.width/2,o.height/2);i.style.transform=`translate(${a.x}px, ${a.y}px)`},ES=(e,r)=>{if(!(e===null||!e)){if(!Array.isArray(r))throw new TypeError("List should be an array of strings");for(let n=0;n<r.length;n++)if(e.classList.contains(r[n])){e.classList.remove(r[n]),n+1<r.length?e.classList.add(r[n+1]):e.classList.add(r[0]);return}e.classList.add(r[0])}},DS=e=>{const r=X(e),i=window.getComputedStyle(r).transform;if(i==="none"||typeof i>"u")return{x:0,y:0,z:0};const s=i.includes("3d")?"3d":"2d",o=i.match(/matrix.*\((.+)\)/)[1].split(", ");return s==="2d"?{x:Number.parseFloat(o[4]),y:Number.parseFloat(o[5]),z:0}:s==="3d"?{x:Number.parseFloat(o[12]),y:Number.parseFloat(o[13]),z:Number.parseFloat(o[14])}:{x:0,y:0,z:0}},AS=(e,r)=>{const n=document.createElement(r);return e.parentElement?.insertBefore(n,e.nextSibling),n},CS=(e,r)=>{const n=document.createElement(r);return e.append(n),n},SS=e=>{let r=e.lastElementChild;for(;r;)r.remove(),r=e.lastElementChild},FS=e=>new Promise((n,i)=>{const s=gS.default.stringify(e);navigator.clipboard.writeText(JSON.stringify(s)).then(()=>{n(!0)},o=>{console.warn("Could not copy to clipboard"),console.log(s),i(new Error(o))})}),PS=(e,r)=>{const n=r.getAttribute("data-sort")??"";let i,s;for(const o of e.children){const a=o.getAttribute("data-sort")??"";if(n>=a&&(i=o),n<=a&&(s=o),i!==void 0&&s!==void 0)break}i!==void 0?i.insertAdjacentElement("afterend",r):s===void 0?e.append(r):s.insertAdjacentElement("beforebegin",r)},NS=(e,r,n)=>{if(e===null)throw new Error("parentEl is null");if(e===void 0)throw new Error("parentEl is undefined");const i=new Set;for(const[o,a]of r){const u=`c-${o}`,l=e.querySelector(`#${u}`),c=n(a,l);l!==c&&(c.id=u,e.append(c)),i.add(u)}const s=[];for(const o of e.children)i.has(o.id)||s.push(o);for(const o of s)o.remove()},Jp=(e,r,n)=>{const i=pr(e);if(i.length!==0)for(const s of i)r?s.classList.add(n):s.classList.remove(n)},Yp=(e,r)=>{const n=pr(e);if(n.length!==0)for(const i of n)i.classList.toggle(r)},Xp=(e,r)=>{const n=pr(e);if(n.length!==0)for(const i of n)i.style.display=r},kS=e=>{const r=document.getElementById(e);if(r===null)throw new Error(`HTML element with id '${e}' not found`);return r},Kp=(e,r)=>{const n=pr(e);if(n.length!==0){typeof r=="number"&&(r=r.toString());for(const i of n)i.innerHTML=r}},Zp=(e,r)=>{const n=pr(e);if(n.length!==0){typeof r=="number"&&(r=r.toString());for(const i of n)i.textContent=r}},MS=e=>{},$S=e=>{const r=pr(e);return{text:n=>{Zp(r,n)},html:n=>{Kp(r,n)},cssDisplay:n=>{Xp(r,n)},cssClass:(n,i)=>{Jp(r,n,i)},cssToggle:n=>{Yp(r,n)},el:()=>r[0],els:()=>r}},Qp={};E(Qp,{fromList:()=>_S,fromObject:()=>rm});var em=jo(xu()),BS=(e,r)=>{if(e===null)return"(null)";if(e===void 0)return"(undefined)";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return`"${e}"`;if(typeof e=="number"){let n=e;return r.roundNumbers!==void 0&&(n=or(r.roundNumbers,e)),r.precision!==void 0?n.toFixed(r.precision):n.toString()}return typeof e=="object"?tm(e,r):em.default.stringify(e)},tm=(e,r)=>{let n='<div style="display:grid; grid-template-columns: repeat(2, 1fr)">';for(const i of Object.entries(e)){const s=BS(i[1],r);n+=`<div class="label" style="display:table-cell">${i[0]}</div>
      <div class="data" style="display:table-cell">${s}</div>`}return n+="</div>",n},_S=(e,r)=>{const n=X(e);let i=document.createElement("DIV");n.append(i);const s=()=>i?(i.remove(),i=void 0,!0):!1,o=a=>{const u=new Set;for(const[c,f]of a){const d=`table-${c}`;u.add(d);let h=n.querySelector(`#${d}`);if(h===null){if(h=document.createElement("table"),!h)throw new Error("Could not create table element");h.id=d,n.append(h)}To(h,f)}const l=Array.from(n.querySelectorAll("table"));for(const c of l)u.has(c.id)||c.remove()};return r&&o(r),{update:o,remove:s}},To=(e,r,n={})=>{const i=n.precision??2,s=n.idPrefix??"",o=n.objectsAsTables??!1;if(r===void 0){e.innerHTML="";return}const a=new Set;for(const[l,c]of Object.entries(r)){const f=`${s}-row-${l}`;a.add(f);let d=e.querySelector(`tr[data-key='${f}']`);if(d===null){d=document.createElement("tr"),e.append(d),d.setAttribute("data-key",f);const v=document.createElement("td");v.textContent=l,v.classList.add("label"),d.append(v)}let h=d.querySelector(`td[data-key='${f}-val']`);h===null&&(h=document.createElement("td"),h.classList.add("data"),h.setAttribute("data-key",`${f}-val`),d.append(h));let y;n.formatter&&(y=n.formatter(c,l)),y===void 0&&(typeof c=="object"?y=o?tm(c,n):em.default.stringify(c):typeof c=="number"?y=n.roundNumbers?Math.round(c).toString():c.toFixed(i):typeof c=="boolean"?y=c?"true":"false":typeof c=="string"?y=`"${c}"`:y=JSON.stringify(c)),h.innerHTML=y}const u=Array.from(e.querySelectorAll("tr"));for(const l of u){const c=l.getAttribute("data-key");a.has(c)||l.remove()}},rm=(e,r,n)=>{const i=X(e),s=n?.idPrefix??Math.floor(Math.random()*1e3).toString();let o=document.createElement("table");i.append(o);const a=()=>o?(o.remove(),o=void 0,!0):!1;return r&&To(o,r,n),{remove:a,update:l=>{if(!o)throw new Error("Table disposed");To(o,l,{...n,idPrefix:s})}}},TS=class{dataTable;constructor(e={}){const r=e.theme??"dark";if(document.querySelector("#ixfx-data-display")!==null)throw new Error("DataDisplay already loaded on this page");const i=document.createElement("div");i.id="ixfx-data-display",i.classList.add(`theme-${r}`);const s=document.createElement("style");s.textContent=`
    #ixfx-data-display {
      background: white;
      color: black;
      border: 2px solid hsl(0deg 0.61% 90%);
      border-radius: 4px;
      z-index: 1000;
      opacity: 40%;
      padding: 1em;
      font-family: monospace;
      position: fixed;
      right: 1em;
      top: 1em;
    }
    #ixfx-data-display.theme-dark {
      background: black;
      color: white;
      border: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display:hover {
      opacity: 100%;
    }
    #ixfx-data-display table {
      border-collapse: collapse;
    }
    #ixfx-data-display tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 90%);
    }
    #ixfx-data-display.dark tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display td {
      padding-bottom: 0.4em;
      padding-top: 0.4em;
    }
    #ixfx-data-display .label {
      color: hsl(0deg 0.61% 60%);
      text-align: right;
      padding-right: 0.5em;
    }
    #ixfx-data-display.theme-dark .label {
      color: gray;
    }
    `,i.style.display="inline-block",document.body.append(s),document.body.append(i),this.dataTable=rm(i,void 0,{objectsAsTables:!0,roundNumbers:2})}update(e){this.dataTable.update(e)}},nm=(e,r)=>{const n=X(e),i=An(),s=()=>{const o=window.innerWidth,a=window.innerHeight;if(n.setAttribute("width",o.toString()),n.setAttribute("height",a.toString()),r!==void 0){const u={min:Math.min(o,a),max:Math.max(o,a),width:o,height:a,center:{x:o/2,y:a/2}};r({el:n,bounds:u})}};return i.value(s),s(),i},zS=(e,r,n=100)=>{const i=X(e),s=i.parentElement;if(s===null)throw new Error("Element has no parent");return Ju(s,n).value(a=>{const u=a.find(f=>f.target===s);if(u===void 0)return;const l=u.contentRect.width,c=u.contentRect.height;if(i.setAttribute("width",l+"px"),i.setAttribute("height",c+"px"),r!==void 0){const f={min:Math.min(l,c),max:Math.max(l,c),width:l,height:c,center:{x:l/2,y:c/2}};r({el:i,bounds:f})}})},RS=(e,r={})=>{const n=r.touchRadius??45,i=r.touchRadius??20,s=r.trace??!1,o=r.hue??100,a=`hsla(${o}, 100%, 10%, 10%)`;let u=o;const l=X(e),c=Yv({storeIntermediate:s}),f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.id="pointerVis",f.style.zIndex="-1000",f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.width="100%",f.style.height="100%",f.style.boxSizing="border-box",f.style.border="3px solid red",f.style.pointerEvents="none",f.style.touchAction="none",nm(f);let d=0;const h=v=>{const m=v.pointerId.toString();c.delete(m),u=o,f.querySelector(`#pv-start-${m}`)?.remove();for(let g=0;g<d+10;g++)f.querySelector(`#pv-progress-${m}-${g}`)?.remove();d=0},y=async v=>{const m=v.pointerId.toString(),g={x:v.x,y:v.y},x=v.pointerType;if(v.type==="pointermove"&&!c.has(m))return;const F=await c.seen(v.pointerId.toString(),{x:v.clientX,y:v.clientY});if(F.values.length===1){const A=Pi.circle({...F.values[0],radius:x==="touch"?n:i},f,{fillStyle:a},`#pv-start-${m}`);A.style.pointerEvents="none",A.style.touchAction="none"}const M=`hsla(${u}, 100%, 50%, 50%)`,j=Pi.circle({...g,radius:x==="touch"?n:i},f,{fillStyle:M},`#pv-progress-${m}-${F.values.length}`);j.style.pointerEvents="none",j.style.touchAction="none",u+=1,d=F.values.length};document.body.append(f),l.addEventListener("pointerdown",y),l.addEventListener("pointermove",y),l.addEventListener("pointerup",h),l.addEventListener("pointerleave",h),l.addEventListener("contextmenu",v=>{v.preventDefault()})},IS=()=>{let e=!0;const r=document.createElement("div");r.style.color="black",r.style.border="2px solid red",r.style.backgroundColor="hsl(0, 80%, 90%)",r.style.padding="1em",r.style.display="none",r.style.top="1em",r.style.left="1em",r.style.position="absolute",r.style.fontFamily="monospace";const n=document.createElement("div");n.style.maxWidth="50vw",n.style.maxHeight="50vh",n.style.overflowY="scroll",r.innerHTML="<h1>Error</h1>",r.append(n);const i=l=>{l.style.padding="0.3em",l.style.marginTop="1em"},s=document.createElement("button");s.textContent="Close",s.addEventListener("click",()=>{u()});const o=document.createElement("button");o.textContent="Stop displaying errors",o.addEventListener("click",()=>{e=!1,u()}),i(s),i(o),r.append(s),r.append(o),document.body.append(r);const a=l=>{r.style.display="inline",n.innerHTML+=l.stack?`<pre>${l.stack}</pre>`:`<p>${je(l)}</p>`},u=()=>{r.style.display="none"};return window.onerror=(l,c,f,d,h)=>{e&&(h?(console.log(h),a(h)):(console.log(l),a(l)))},window.addEventListener("unhandledrejection",l=>{console.log(l.reason),e&&a(l.reason)}),{show:a,hide:u}},im={};E(im,{draggable:()=>jS});var jS=(e,r)=>{let n=S.Placeholder,i;const s=()=>{e.classList.contains("drag-sel")&&e.classList.remove("drag-sel")},o=d=>{e.classList.contains("drag-sel")?e.classList.remove("drag-sel"):e.classList.add("drag-sel"),d.stopPropagation()};e.ownerDocument.addEventListener("click",s),e.addEventListener("click",o);const a=()=>{e.classList.remove("drag-progress"),e.ownerDocument.removeEventListener("pointermove",l),e.ownerDocument.removeEventListener("pointerup",c),e.ownerDocument.removeEventListener("pointercancel",f)},u=()=>{console.log("drag dispose"),e.classList.contains("drag-progress")?f(void 0,"dispose"):a(),e.ownerDocument.removeEventListener("click",s),e.removeEventListener("click",o)},l=d=>{d.preventDefault(),d.stopPropagation();const y={delta:S.isPlaceholder(n)?{x:d.offsetX,y:d.offsetY}:{x:d.x-n.x,y:d.y-n.y},initial:n,token:i};typeof r.progress<"u"&&!r.progress(y)&&f(void 0,"discontinued")},c=d=>{a();const h={x:d.x-n.x,y:d.y-n.y},y={initial:n,token:i,delta:h};typeof r.success<"u"&&r.success(y)},f=(d,h="pointercancel")=>{a();const y={token:i,initial:n,delta:{x:-1,y:-1}};typeof r.abort<"u"&&r.abort(h,y)};return e.addEventListener("pointerdown",d=>{if(!e.classList.contains("drag-sel"))return;n={x:d.x,y:d.y};const y=typeof r.start>"u"?{allow:!0,token:i}:r.start();y.allow&&(i=y.token,e.classList.add("drag-progress"),e.ownerDocument.addEventListener("pointermove",l),e.ownerDocument.addEventListener("pointerup",c),e.ownerDocument.addEventListener("pointercancel",f))}),u},LS=(e={})=>{const r={log:console.log,error:console.error,warn:console.warn},n=document.createElement("DIV");n.id="ixfx-log",n.style.position="fixed",n.style.left="0px",n.style.top="0px",n.style.pointerEvents="none",n.style.display="none",document.body.prepend(n);const i=Wp(n,e),s=o=>{n.style.display="block"};console.error=(o,...a)=>{i.error(o),a.length>0&&i.error(a),r.error(o,...a),s()},console.warn=(o,...a)=>{i.warn(o),a.length>0&&i.warn(a),s()},console.log=(o,...a)=>{i.log(o),a.length>0&&i.log(a),r.log(o,...a),s()},window.onerror=(o,a,u,l,c)=>{const f=a===void 0?"":jn(a,"/",{fromEnd:!0}),d=je(c);i.error(d+` (${f}:${u})`),s()}},sm={};E(sm,{parseAsAttributes:()=>VS,setFromVariables:()=>OS});var VS=e=>e.map(r=>{let n;Array.isArray(r)&&(n=r[1],r=r[0]);const i=r.indexOf("-");if(i<0)throw new Error("Simple expression expects form of: 'elementid-attribute'");return{variable:r,attribute:r.slice(i+1),id:r.slice(0,i),defaultValue:n}}),OS=(e,...r)=>{const n=X(e),i=window.getComputedStyle(n);for(const s of r){const o=jn(s.variable,"--");let a=i.getPropertyValue(`--${o}`);if(a===null||a.length===0){if(s.defaultValue===void 0)continue;a=s.defaultValue}let u,l;if("query"in s&&s.query!==void 0?u=s.query:"id"in s&&s.id!==void 0?u=`#${s.id}`:"element"in s&&s.element!==void 0&&(l=Array.isArray(s.element)?s.element:[s.element]),u===void 0){if(l===void 0)throw new Error("Missing query, id or element")}else l=[...n.querySelectorAll(u)];if(l!==null&&l!==void 0)if(s.attribute)for(const c of l)c.setAttribute(s.attribute,a);else if(s.field)for(const c of l)c[s.field]=a;else throw new Error(`Neither 'attribute' or 'field' to set is defined in option (${JSON.stringify(s)})`)}},qS=class extends Le{el;opts;#e;#t=pi.empty;#r;constructor(e,r={}){if(super(),!e)throw new Error("Param 'domQueryOrEl' is null or undefined");if(this.el=X(e),this.el.nodeName!=="CANVAS")throw new Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);this.opts={fill:r.fill??"none",height:r.height??-1,width:r.width??-1,zIndex:r.zIndex??-1,scaleBy:r.scaleBy??"both",onResize:r.onResize,clearOnResize:r.clearOnResize??!0,draw:r.draw,skipCss:r.skipCss??!1},this.#e=Ai.scaler("both"),this.#a()}#n(e=!1){if(this.#r===void 0||e){const r=this.ratio,n=this.el.getContext("2d");if(n===null)throw new Error("Could not create drawing context");this.#r=n,n.setTransform(1,0,0,1,0,0),n.scale(r,r)}return this.#r}#i(e){pi.guard(e,"logicalSize");const r=window.devicePixelRatio||1;this.#e=Ai.scaler(this.opts.scaleBy,e);const n=qf(e,r,r);this.el.width=n.width,this.el.height=n.height,this.el.style.width=e.width.toString()+"px",this.el.style.height=e.height.toString()+"px",this.#n(!0),this.opts.clearOnResize&&this.ctx.clearRect(0,0,this.width,this.height),this.#t=e;const i=this.opts.onResize;i&&setTimeout(()=>{i(this.ctx,this.size,this)},100),this.fireEvent("resize",{ctx:this.ctx,size:this.#t,helper:this})}#s(){const e=this.el.parentElement;if(!e)return;const r=e.getBoundingClientRect();this.#i({width:r.width,height:r.height})}#o(){this.#i({width:window.innerWidth,height:window.innerHeight})}#a(){switch(this.opts.fill){case"viewport":{this.opts.skipCss||(this.el.style.position="absolute",this.el.style.left="0px",this.el.style.top="0px",this.el.style.zIndex=this.opts.zIndex.toString()),An().value(()=>{this.#o()}),this.#o();break}case"parent":{if(!this.el.parentElement)throw new Error("Canvas element has no parent?!");this.opts.skipCss||(this.el.style.position="relative",this.el.style.left="0px",this.el.style.top="0px"),An().value(()=>{this.#s()}),this.#s();break}case"none":{let{width:r,height:n}=this.el.getBoundingClientRect();this.opts.width>0&&(r=this.opts.width),this.opts.height>0&&(n=this.opts.height);const i={width:r,height:n};this.#i(i);break}default:throw new Error("Unknown 'fill' value. Expecting: 'none', 'viewport' or 'fill'")}const e=this.opts.draw;if(e){const r=()=>{e(this.ctx,this.#t,this),requestAnimationFrame(r)};setTimeout(()=>{r()},100)}}clear(){this.#r&&this.#r.clearRect(0,0,this.width,this.height)}get ctx(){if(this.#r===void 0)throw new Error("Context not available");return this.#n()}get width(){return this.#t.width}get height(){return this.#t.height}get size(){return this.#t}get ratio(){return window.devicePixelRatio||1}get dimensionMin(){return Math.min(this.width,this.height)}get dimensionMax(){return Math.max(this.width,this.height)}get toAbsolute(){return this.#e.abs}get toRelative(){return this.#e.rel}get center(){return{x:this.width/2,y:this.height/2}}};async function*zo(e,r={}){if(typeof e=="string")return zo([e],r);if(typeof e=="object"&&"nodeName"in e)return zo([e],r);const i=r??!1?np():s=>!0;if(Array.isArray(e))for(const s of e)if(typeof s=="string")for(const o of document.querySelectorAll(s)){const a=o;i(a)&&(yield a)}else i(s)&&(yield s);else for await(const s of e)if(typeof s=="string")for(const o of document.querySelectorAll(s))i(o)&&(yield o);else i(s)&&(yield s)}function Cn(e,r={}){const n=r.eq??Yt.isEqualContextString,i=Me(),s=Me();let o=e,a=!1;const u=d=>{if(o!==void 0){const h=Yt.compareData(o,d,{...r,includeMissingFromA:!0});if(h.length===0)return;s.set(h)}o=d,i.set(d)},l=d=>{if(o===void 0)o=d;else{const h=Yt.compareData(d,o);if(h.length===0)return;o={...o,...d},s.set(h)}i.set(o)};return{dispose:d=>{a||(s.dispose(d),i.dispose(d),a=!0)},isDisposed(){return a},updateField:(d,h)=>{if(o===void 0)throw new Error("Cannot update value when it has not already been set");const y=Yt.getField(o,d);if(n(y,h,d))return;let v=Yt.compareData(y,h,{...r,includeMissingFromA:!0});v=v.map(g=>g.path.length>0?{...g,path:d+"."+g.path}:{...g,path:d});const m=Yt.updateByPath(o,d,h,!0);o=m,s.set(v),i.set(m)},last:()=>o,on:i.on,value:i.value,onDiff:s.on,set:u,update:l}}function WS(e){const r=[...document.querySelectorAll(e)];return Cn(r)}var GS=(e,r,n={})=>Zu(e,r,{...n,elField:"textContent"}),US=(e,r,n={})=>Zu(e,r,{...n,elField:"innerHTML"}),Zu=(e,r,...n)=>{if(r===null)throw new Error("Param 'elOrQuery' is null");if(r===void 0)throw new Error("Param 'elOrQuery' is undefined");const i=X(r);let s=[];n.length===0?s.push({elField:"textContent"}):s=[...n];const o=s.map(a=>"element"in a?a:{...a,element:i});return um(e,...o)},HS=(e,r)=>{const n=om(e);return i=>{n(i,r)}},om=e=>{if(e.elField!==void 0||e.cssVariable===void 0&&e.attribName===void 0&&e.cssProperty===void 0&&e.textContent===void 0&&e.htmlContent===void 0){const r=e.elField??"textContent";return(n,i)=>{i[r]=n}}if(e.attribName!==void 0){const r=e.attribName;return(n,i)=>{i.setAttribute(r,n)}}if(e.textContent)return(r,n)=>{n.textContent=r};if(e.htmlContent)return(r,n)=>{n.innerHTML=r};if(e.cssVariable!==void 0){let r=e.cssVariable;return r.startsWith("--")||(r="--"+r),(n,i)=>{i.style.setProperty(r,n)}}return e.cssProperty!==void 0?(r,n)=>{n.style[e.cssProperty]=r}:(r,n)=>{}},am=e=>{if(!(!e.transform&&!e.transformValue)){if(e.transformValue){if(e.sourceField===void 0)throw new Error("Expects 'sourceField' to be set when 'transformValue' is set");return r=>{const n=r[e.sourceField];return e.transformValue(n)}}else if(e.transform){if(e.sourceField!==void 0)throw new Error("If 'transform' is set, 'sourceField' is ignored");return r=>e.transform(r)}}},um=(e,...r)=>{const n=r.map(a=>{if(a.element&&a.element!==void 0)return a;if(a.query)return{...a,element:X(a.query)};throw new Error(`Unable to resolve element. Missing 'element' or 'query' values on bind. ${JSON.stringify(a)}`)}),i=n.map(a=>({update:HS(a,a.element),transformer:am(a),sourceField:a.sourceField})),s=a=>{for(const u of i)if(u.transformer)u.update(u.transformer(a));else{const l=u.sourceField?a[u.sourceField]:a;typeof l=="object"?(u.sourceField,u.update(JSON.stringify(l))):u.update(l)}},o=e.on(a=>{be(a)?s(a.value):On(a)&&console.warn(a)});return qn(e)&&s(e.last()),{remove:a=>{if(o(),a)for(const u of n)u.element.remove()}}},JS=(e,r,n)=>{const i=X(r),s=a=>{n(a,i)},o=e.on(a=>{be(a)?(console.log(a),s(a.value)):console.warn(a)});return qn(e)&&s(e.last()),{remove:a=>{o(),a&&i.remove()}}},YS=(e,r,n,i={})=>{if(r===null)throw new Error("Param 'elOrQuery' is null");if(r===void 0)throw new Error("Param 'elOrQuery' is undefined");const s=X(r);i.binds;const o=l=>{n(l,s)},a=e.onDiff(l=>{be(l)?o(l.value):console.warn(l)}),u=()=>{qn(e)&&i.initial&&i.initial(e.last(),s)};return u(),{refresh:()=>{u()},remove:l=>{a(),l&&s.remove()}}},XS=(e,r)=>{const n=r.container?X(r.container):document.body,i=r.defaultTag??"div",s=new Map,o=new Map;for(const[d,h]of Object.entries(r.binds??{})){const y=h.tagName??i;o.set(d,{...h,update:om(h),transform:am(h),tagName:y,path:d})}const a=d=>{const h=Jc(o,i2(d));if(h!==void 0)return h;if(!d.includes("."))return o.get("_root")};function*u(d){for(const h of s2(d))o.has(h)&&(yield o.get(h));o.has("_root")&&d.includes(".")&&(yield o.get("_root"))}const l=(d,h)=>{const y=Ws(d);console.log(`Rx.Dom.elements.create: ${d} rooted: ${y} value: ${JSON.stringify(h)}`);const v=a(Ws(d));let m=i;v?.tagName&&(m=v.tagName);const g=document.createElement(m);g.setAttribute("data-path",d),c(d,g,h);let x;for(const F of u(y))if(F?.nestChildren){const M=Va(d,"."),j=F.path.replace("_root",M);if(x=s.get(j),x!==void 0)break}(x??n).append(g),s.set(d,g),console.log(`Added el: ${d}`)},c=(d,h,y)=>{console.log(`Rx.dom.update path: ${d} value:`,y);const v=a(Ws(d));v===void 0?(typeof y=="object"&&(y=JSON.stringify(y)),h.textContent=y):(v.transform&&(y=v.transform(y)),v.update(y,h))},f=d=>{const h=new Re({},d);let y=h.dequeue();const v=new Set;for(;y!==void 0;){const m=y.path;if(y.previous===void 0){console.log(`Rx.Dom.elements.changes no previous. path: ${m}`),l(m,y.value);const g=No(y.value,Number.MAX_SAFE_INTEGER,m);console.log(g);for(const x of g)v.has(x.path)||(h.enqueue(x),v.add(x.path))}else if(y.value===void 0){const g=s.get(m);g===void 0?console.warn(`No element to delete? ${m} `):(console.log(`Rx.Dom.elements.changes delete ${m}`),g.remove())}else{const g=s.get(m);g===void 0?(console.warn(`Rx.Dom.elements.changes No element to update ? ${m} `),l(m,y.value)):c(m,g,y.value)}y=h.dequeue()}};if(e.onDiff(d=>{d.value&&(console.log(`Rx.Dom.elements diff ${JSON.stringify(d.value)} `),f(d.value))}),qn(e)){const d=e.last();f(No(d,1))}},Ws=e=>{const r=jn(e,".");return r===e?"_root":"_root."+r};function KS(){const e=()=>({width:window.innerWidth,height:window.innerHeight}),r=hr.event(window,"resize",{lazy:"very",transform:()=>e()}),n=hr.event(window,"pointermove",{lazy:"very",transform:s=>{if(s===void 0)return{x:0,y:0};const o=s;return{x:o.x,y:o.y}}});return{dispose:(s="Reactive.win.dispose")=>{r.dispose(s),n.dispose(s)},size:r,pointer:n}}var hr={};E(hr,{array:()=>lm,arrayObject:()=>QS,boolean:()=>eF,event:()=>tF,func:()=>Cv,iterator:()=>ko,number:()=>nF,object:()=>Cn,objectProxy:()=>cm,objectProxySymbol:()=>iF,observable:()=>sF,observableWritable:()=>fm,of:()=>ZS,pinged:()=>rF});var ZS=(e,r={})=>{if(Array.isArray(e))return lm(e,r)},lm=(e,r={})=>{const n=r.lazy??"initial",i=r.signal,s=r.whenStopped??"continue",o=r.debugLifecycle??!1,a=[...e];if(n!=="very"&&s==="reset")throw new Error(`whenStopped:'reset' has no effect with 'lazy:${n}'. Use lazy:'very' instead.`);const u=V(r.interval,5);let l=0,c=a[0];const f=Wn({...r,lazy:n,onStart(){o&&console.log("Rx.readFromArray:onStart"),d.start()},onStop(){o&&console.log(`Rx.readFromArray:onStop. whenStopped: ${s} index: ${l}`),d.cancel(),s==="reset"&&(l=0)}}),d=vr(()=>{if(i?.aborted)return f.dispose(`Signalled (${i.reason})`),!1;if(c=a[l],l++,f.set(c),l===a.length)return f.dispose("Source array complete"),!1},u);return n||d.start(),{isDone(){return l===a.length},last(){return c},on:f.on,value:f.value}};function QS(e=[],r={}){const n=r.eq??yc,i=Me(),s=Me();let o=e,a=!1;const u=m=>{ii(o,m,n),o=m,i.set([...m])},l=(m,g)=>{o[m]=g,i.set([...o])},c=m=>{o=[...o,m],i.set([...o]);const g=["add",o.length-1,m];s.set([g])},f=m=>{const g=vf(o,m);if(g.length===o.length)return;const x=ii(o,g,n);o=g,i.set([...o]),s.set(x.summary)},d=m=>{const g=o.filter(M=>!m(M)),x=o.length-g.length,F=ii(o,g,n);return o=g,i.set([...o]),s.set(F.summary),x},h=(m,g)=>{const x=pf(o,m,g),F=ii(o,x,n);o=x,i.set([...o]),s.set(F.summary)};return{dispose:m=>{a||(i.dispose(m),a=!0)},isDisposed(){return a},last:()=>o,on:i.on,onArray:s.on,value:i.value,setAt:l,push:c,deleteAt:f,deleteWhere:d,insertAt:h,set:u}}function eF(e){let r=e;const n=Me(),i=s=>{r=s,n.set(s)};return{dispose:n.dispose,isDisposed:n.isDisposed,last:()=>r,on:n.on,value:n.value,set:i}}function tF(e,r,n={}){if(e===null)throw new Error("Param 'target' is null");const i=n.transform,s=i?i():void 0,o=n.debugLifecycle??!1,a=n.debugFiring??!1,u=s?Cn(s,{deepEntries:!0}):Cn(void 0,{deepEntries:!0}),l=n.lazy??!1;let c=!1,f=!1;const d=v=>{a&&console.log(`Reactive.event '${r}' firing '${JSON.stringify(v)}`),u.set(i?i(v):v)},h=()=>{c&&(c=!1,e.removeEventListener(r,d),o&&console.log(`Reactive.event remove '${r}'`))},y=()=>{c||(c=!0,e.addEventListener(r,d),o&&console.log(`Reactive.event add '${r}'`))};return l||y(),{last:()=>(l&&y(),u.last()),dispose:v=>{f||(f=!0,h(),u.dispose(v))},isDisposed(){return f},on:v=>(l&&y(),u.on(v)),value:v=>(l&&y(),u.value(v))}}function rF(e,r,n={}){const i=n.closeOnError??!0,s=n.lazy??"initial",o=new AbortController,a=h=>{o.abort(h)};let u;n.signal&&n.signal.addEventListener("abort",h=>{f(`Signal received (${n.signal?.reason})`)});const l=Me({onFirstSubscribe(){s!=="never"&&u===void 0&&c()},onNoSubscribers(){s==="very"&&u!==void 0&&(u(),u=void 0)}}),c=()=>{u=e.on(h=>{lt(h)?f("Upstream closed"):On(h)?l.signal(h.signal):be(h)&&d(h.value)})},f=h=>{l.dispose(h),u&&u()},d=async h=>{try{const y=await r(h,a);if(l.set(y),o.signal.aborted)return f(`callback function aborted (${o.signal.reason})`),!1}catch(y){if(i)return f(`Function error: ${je(y)}`),!1;l.signal("warn",je(y))}};return s==="never"&&c(),l}function nF(e){let r=e;const n=Me(),i=s=>{r=s,n.set(s)};return{dispose:n.dispose,isDisposed:n.isDisposed,last:()=>r,on:n.on,value:n.value,set:i}}var cm=e=>{const r=Cn(e);return{proxy:new Proxy(e,{set(i,s,o,a){const u=Array.isArray(i);if(u&&s==="length")return!0;if(typeof s=="string"&&r.updateField(s,o),u&&typeof s=="string"){const l=Number.parseInt(s);if(!Number.isNaN(l))return i[l]=o,!0}return i[s]=o,!0}}),rx:r}},iF=e=>{const{proxy:r,rx:n}=cm(e),i=r;return i[Vv]=n,i};function sF(e){const r=fm(e);return{on:r.on,value:r.value}}function fm(e){let r=()=>{};const n=dm({onFirstSubscribe(){r=e(n)},onNoSubscribers(){r&&r()}});return{...n,value:i=>n.on(s=>{be(s)&&i(s.value)})}}function dm(e={}){const r=Me(e);return{set(n){r.set(n)},on:r.on,value:r.value}}var Qu={annotate:e=>Er(ms,e),annotateElapsed:()=>Er(Cu),batch:e=>r=>Su(r,e),cloneFromFields:()=>e=>Sv(e),combineLatestToArray:(e={})=>r=>Fu(r,e),combineLatestToObject:(e={})=>r=>gs(r,e),debounce:e=>r=>Pu(r,e),field:(e,r)=>n=>Nu(n,e,r),filter:e=>Er(ku,e),pipe:(...e)=>r=>{const i=[Ce(r),...e];return Fv(...i)},singleFromArray:(e={})=>r=>Pv(r,e),split:(e={})=>r=>Mu(r,e),splitLabelled:e=>r=>$u(r,e),switcher:(e,r={})=>n=>Bu(n,e,r),syncToArray:(e={})=>r=>ws(r,e),syncToObject:(e={})=>r=>_u(r,e),throttle:e=>Er(Tu,e),timeoutTrigger:e=>r=>zu(r,e),transform:e=>r=>Gn(r,e),withValue:e=>Er(Nv,e)},oF=(...e)=>r=>{for(const n of e)r=n(r);return r};function aF(e,...r){return oF(...r)(e)}function uF(e,r){let n=r;return e.value(i=>{n=i}),{...e,last(){return n},reset(){n=void 0}}}async function lF(e,r=1e3){const n=Ce(e);let i=()=>{},s;return new Promise((a,u)=>{i=n.on(l=>{s&&clearTimeout(s),be(l)?(i(),a(l.value)):lt(l)&&(u(new Error(`Source closed. ${l.context??""}`)),i())}),s=setTimeout(()=>{s=void 0,i(),u(new Error(`Timeout waiting for value (${JSON.stringify(r)})`))},V(r))})}var cF=(e,r,n,i=!1)=>{const s=e.on(o=>{be(o)?r.set(n(o.value)):lt(o)?(s(),i&&(ps(r)?r.dispose(`Source closed (${o.context??""})`):console.warn("Reactive.to cannot close 'b' reactive since it is not disposable"))):console.warn(`Unsupported message: ${JSON.stringify(o)}`)});return s},hm=function(e=.1,r,n,i,s){return r===void 0&&(r=0),n===void 0&&(n=1),i===void 0&&(i=r),P(e,"bipolar","interval"),P(n,"bipolar","end"),P(i,"bipolar","offset"),P(r,"bipolar","start"),el(e,r,n,i,s)},el=function*(e,r,n,i,s){if(r===void 0)throw new Error("Parameter 'lower' is undefined");if(e===void 0)throw new Error("Parameter 'interval' is undefined");if(n===void 0)throw new Error("Parameter 'upper' is undefined");if(s===void 0&&e<=1&&e>=0?s=10/e:s===void 0&&(s=1234),Number.isNaN(e))throw new Error("interval parameter is NaN");if(Number.isNaN(r))throw new Error("lower parameter is NaN");if(Number.isNaN(n))throw new Error("upper parameter is NaN");if(Number.isNaN(i))throw new Error("upper parameter is NaN");if(r>=n)throw new Error("lower must be less than upper");if(e===0)throw new Error("Interval cannot be zero");const o=n-r;if(Math.abs(e)>=o)throw new Error(`Interval should be between -${o} and ${o}`);let a=e>0;if(n=Math.floor(n*s),r=Math.floor(r*s),e=Math.floor(Math.abs(e*s)),e===0)throw new Error(`Interval is zero (rounding: ${s})`);if(i=i===void 0?r:Math.floor(i*s),i>n||i<r)throw new Error(`Start (${i/s}) must be within lower (${r/s}) and upper (${n/s})`);let u=i;yield u/s;let l=!0;for(;;)u=u+(a?e:-e),a&&u>=n?(a=!1,u=n,u===n&&l&&(u=r,a=!0)):!a&&u<=r&&(a=!0,u=r,u===r&&l&&(u=n,a=!1)),yield u/s,l=!1},ym=e=>{const{relative:r,absolute:n}=e,i=e.clamped??!1,s=e.source??fe;if(n!==void 0)return o=>{const a=s()*n*2-n,u=o+a;return i?Ne(u,0,o):u};if(r!==void 0)return o=>{const a=o*r,u=s()*a*2-a,l=o+u;return i?Ne(l,0,o):l};throw new Error("Either absolute or relative fields expected")},vm=(e={})=>{const r=e.clamped??!0;let n=s=>0;if(e.absolute!==void 0){P(e.absolute,r?"percentage":"bipolar","opts.absolute");const s=cs({min:-e.absolute,max:e.absolute,source:e.source});n=o=>o+s()}else{if(e.relative===void 0)throw new TypeError("Either absolute or relative jitter amount is required.");{const s=e.relative??.1;P(s,r?"percentage":"bipolar","opts.relative"),n=o=>o+H0({min:-Math.abs(s*o),max:Math.abs(s*o),source:e.source})}}return s=>{P(s,r?"percentage":"bipolar","value");let o=n(s);return r&&(o=Ne(o)),o}},fF={};E(fF,{Easings:()=>Xa,Envelopes:()=>tl,Forces:()=>nl,Oscillators:()=>ol,adsr:()=>rl,adsrIterable:()=>mm,defaultAdsrOpts:()=>pm,jitter:()=>vm,jitterAbsolute:()=>ym,perSecond:()=>zF,pingPong:()=>el,pingPongPercent:()=>hm});var tl={};E(tl,{adsr:()=>rl,adsrIterable:()=>mm,defaultAdsrOpts:()=>pm});var pm=()=>({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1}),dF=Object.freeze({attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null}),hF=class extends Le{#e;#t;#r;#n;#i;attackDuration;decayDuration;releaseDuration;decayDurationTotal;shouldLoop;constructor(e){super(),this.attackDuration=e.attackDuration??300,this.decayDuration=e.decayDuration??500,this.releaseDuration=e.releaseDuration??1e3,this.shouldLoop=e.shouldLoop??!1,this.#e=new ss(dF,{initial:"attack"}),this.#e.addEventListener("change",r=>{r.newState==="release"&&this.#i&&this.#r?.reset(),super.fireEvent("change",r)}),this.#e.addEventListener("stop",r=>{super.fireEvent("complete",r)}),this.#t=ut,this.#n=this.#i=!1,this.decayDurationTotal=this.attackDuration+this.decayDuration}switchState(){if(this.#r===void 0)return!1;let e=this.#r.elapsed;const r=this.#i&&!this.#n;let n=!1;do switch(n=!1,this.#e.state){case"attack":{(e>this.attackDuration||r)&&(this.#e.next(),n=!0);break}case"decay":{(e>this.decayDurationTotal||r)&&(this.#e.next(),n=!0);break}case"sustain":{(!this.#n||r)&&(e=0,this.#e.next(),this.#r.reset(),n=!0);break}case"release":{e>this.releaseDuration&&(this.#e.next(),n=!0);break}case"complete":this.shouldLoop&&this.trigger(this.#i)}while(n);return n}computeRaw(e=!0){if(this.#r===void 0)return[void 0,0,this.#e.state];e&&this.switchState();const r=this.#e.state,n=this.#r.elapsed;let i=0;const s=this.#e.state;switch(s){case"attack":{i=n/this.attackDuration;break}case"decay":{i=(n-this.attackDuration)/this.decayDuration;break}case"sustain":{i=1;break}case"release":{i=Math.min(n/this.releaseDuration,1);break}case"complete":return[void 0,1,r];default:throw new Error(`State machine in unknown state: ${s}`)}return[s,i,r]}get isDone(){return this.#e.isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),this.#e.reset(),this.#r=this.#t(),this.#n=e,this.#i=e}compute(){}release(){this.isDone||!this.#i||(this.#n=!1,this.compute())}},yF=class extends hF{attackPath;decayPath;releasePath;initialLevel;peakLevel;releaseLevel;sustainLevel;attackBend;decayBend;releaseBend;initialLevelOverride;retrigger;releasedAt;constructor(e){super(e),this.initialLevel=e.initialLevel??0,this.peakLevel=e.peakLevel??1,this.releaseLevel=e.releaseLevel??0,this.sustainLevel=e.sustainLevel??.75,this.retrigger=e.retrigger??!0,this.attackBend=e.attackBend??0,this.releaseBend=e.releaseBend??0,this.decayBend=e.decayBend??0;const r=1;this.attackPath=ai(Mr({x:0,y:this.initialLevel},{x:r,y:this.peakLevel},-this.attackBend)),this.decayPath=ai(Mr({x:0,y:this.peakLevel},{x:r,y:this.sustainLevel},-this.decayBend)),this.releasePath=ai(Mr({x:0,y:this.sustainLevel},{x:r,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){const[e,r,n]=this.compute();!Number.isNaN(r)&&r>0&&(this.initialLevelOverride=r)}}get value(){return this.compute(!0)[1]}compute(e=!0){const[r,n]=super.computeRaw(e);if(r===void 0)return[void 0,Number.NaN,Number.NaN];let i;switch(r){case"attack":{i=this.attackPath.interpolate(n).y,this.initialLevelOverride!==void 0&&(i=st(i,0,1,this.initialLevelOverride,1)),this.releasedAt=i;break}case"decay":{i=this.decayPath.interpolate(n).y,this.releasedAt=i;break}case"sustain":{i=this.sustainLevel,this.releasedAt=i;break}case"release":{i=this.releasePath.interpolate(n).y,this.releasedAt!==void 0&&(i=st(i,0,this.sustainLevel,0,this.releasedAt));break}case"complete":{i=this.releaseLevel,this.releasedAt=void 0;break}default:throw new Error(`Unknown state: ${r}`)}return[r,i,n]}},rl=e=>new yF(e);async function*mm(e){const r=rl(e.env),n=e.sampleRateMs??100;r.trigger();for await(const i of c0(()=>{if(!r.isDone)return r.value},{fixed:n,signal:e.signal}))yield i}var nl={};E(nl,{accelerationForce:()=>xF,angleFromAccelerationForce:()=>xm,angleFromVelocityForce:()=>bm,angularForce:()=>wm,apply:()=>wF,attractionForce:()=>mF,computeAccelerationToTarget:()=>Em,computeAttractionForce:()=>gm,computePositionFromAngle:()=>Dm,computePositionFromVelocity:()=>sl,computeVelocity:()=>il,constrainBounce:()=>pF,guard:()=>vF,magnitudeForce:()=>bF,nullForce:()=>EF,orientationForce:()=>PF,pendulumForce:()=>CF,springForce:()=>AF,targetForce:()=>gF,velocityForce:()=>DF});var vF=(e,r="t")=>{if(e===void 0)throw new Error(`Parameter ${r} is undefined. Expected ForceAffected`);if(e===null)throw new Error(`Parameter ${r} is null. Expected ForceAffected`);if(typeof e!="object")throw new TypeError(`Parameter ${r} is type ${typeof e}. Expected object of shape ForceAffected`)},pF=(e,r=1)=>{e||(e={width:1,height:1});const n=ao(e,"left"),i=ao(e,"right"),s=uo(e,"top"),o=uo(e,"bottom");return a=>{const u=sl(a.position??S.Empty,a.velocity??S.Empty);let l=a.velocity??S.Empty,{x:c,y:f}=u;return c>i?(c=i,l=S.invert(S.multiply(l,r),"x")):c<n&&(c=n,l=S.invert(S.multiply(l,r),"x")),f>o?(f=o,l=S.multiply(S.invert(l,"y"),r)):u.y<s&&(f=s,l=S.invert(S.multiply(l,r),"y")),Object.freeze({...a,position:{x:c,y:f},velocity:l})}},mF=(e,r,n={})=>i=>{let s=i.acceleration??S.Empty;for(const o of e){if(o===i)continue;const a=gm(o,i,r,n);s=S.sum(s,a)}return{...i,acceleration:s}},gm=(e,r,n,i={})=>{if(e.position===void 0)throw new Error("attractor.position not set");if(r.position===void 0)throw new Error("attractee.position not set");const s=i.min??.01,o=i.max??.7,a=S.normalise(S.subtract(e.position,r.position)),u=Ne(S.distance(a),s,o);return S.multiply(a,n*(e.mass??1)*(r.mass??1)/(u*u))},gF=(e,r={})=>i=>{const s=Em(e,i.position??{x:.5,y:.5},r);return{...i,acceleration:S.sum(i.acceleration??S.Empty,s)}},wF=(e,...r)=>{if(e===void 0)throw new Error("t parameter is undefined");for(const o of r)o!=null&&(e=typeof o=="function"?o(e):{...e,acceleration:S.sum(e.acceleration??S.Empty,o)});const n=il(e.acceleration??S.Empty,e.velocity??S.Empty),i=sl(e.position??S.Empty,n);return{...e,position:i,velocity:n,acceleration:S.Empty}},xF=(e,r="ignored")=>n=>Object.freeze({...n,acceleration:Cs(e,n,r)}),Cs=(e,r,n="ignored")=>{let i;switch(n){case"dampen":{i=s=>S.divide(e,s,s);break}case"multiply":{i=s=>S.multiply(e,s,s);break}case"ignored":{i=s=>e;break}default:throw new Error(`Unknown 'mass' parameter '${n}. Expected 'dampen', 'multiply' or 'ignored'`)}return S.sum(r.acceleration??S.Empty,i(r.mass??1))},bF=(e,r="ignored")=>n=>{if(n.velocity===void 0)return n;const i=S.distance(S.normalise(n.velocity)),s=e*i*i,o=S.multiply(S.invert(n.velocity),s);return Object.freeze({...n,acceleration:Cs(o,n,r)})},EF=e=>e,DF=(e,r)=>{const n=S.pipeline(S.invert,i=>S.multiply(i,e));return i=>{if(i.velocity===void 0)return i;const s=n(i.velocity);return Object.freeze({...i,acceleration:Cs(s,i,r)})}},wm=()=>e=>{const r=e.angularAcceleration??0,n=e.angularVelocity??0,i=e.angle??0,s=n+r,o=i+s;return Object.freeze({...e,angle:o,angularVelocity:s,angularAcceleration:0})},xm=(e=20)=>r=>{const n=r.acceleration??S.Empty;return Object.freeze({...r,angularAcceleration:n.x*e})},bm=(e=1)=>r=>{const n=S.angle(r.velocity??S.Empty);return Object.freeze({...r,angle:e<1?L0(e,r.angle??0,n):n})},AF=(e,r=.5,n=2e-4,i=.999)=>s=>{const o=S.subtract(s.position??S.Empty,e),a=S.distance(o),u=Math.abs(r-a),l=S.pipelineApply(o,S.normalise,h=>S.multiply(h,-n*u)),c=Cs(l,s,"dampen"),f=il(c??S.Empty,s.velocity??S.Empty),d=S.multiply(f,i,i);return{...s,velocity:d,acceleration:S.Empty}},CF=(e,r={})=>n=>{e||(e={x:0,y:0});const i=r.length??S.distance(e,n.position??S.Empty),s=r.speed??.001,o=r.damping??.995;let a=n.angle;a===void 0&&(n.position?a=S.angle(e,n.position)-Math.PI/2:a=0);const u=-1*s/i*Math.sin(a),l=(n.angularVelocity??0)+u;return a+=l,Object.freeze({angularVelocity:l*o,angle:a,position:Dm(i,a+Math.PI/2,e)})},il=(e,r,n)=>{const i=S.sum(r,e);return n===void 0?i:S.clampMagnitude(i,n)},Em=(e,r,n={})=>{const i=n.diminishBy??.001,s=S.subtract(e,r);return n.range&&S.compare(S.abs(s),n.range)===-2?S.Empty:S.multiply(s,i)},sl=(e,r)=>S.sum(e,r),Dm=(e,r,n)=>mn.toCartesian(e,r,n),SF=wm(),FF=xm(),PF=(e=.5)=>{const r=bm(e);return n=>(n=SF(n),n=FF(n),n=r(n),n)},ol={};E(ol,{saw:()=>_F,sine:()=>MF,sineBipolar:()=>$F,spring:()=>kF,square:()=>TF,triangle:()=>BF});var Am=Math.PI*2,NF=(e={},r=0,n=1)=>{const i=e.mass??1,s=e.stiffness??100,o=e.soft??!1,a=e.damping??10,u=e.velocity??.1,l=n-r;if(o||1<=a/(2*Math.sqrt(s*i))){const c=-Math.sqrt(s/i),f=-c*l-u;return d=>n-(l+d*f)*Math.E**(d*c)}else{const c=Math.sqrt(4*i*s-a**2),f=(a*l-2*i*u)/c,d=.5*c/i,h=-(.5*a)/i;return y=>n-(Math.cos(y*d)*l+Math.sin(y*d)*f)*Math.E**(y*h)}};function*kF(e={},r){r===void 0?r=ut():typeof r=="number"&&(r=Ft(r));const n=NF(e,0,1);let i=e.countdown??10;for(;i>0;){const s=n(r.elapsed/1e3);yield s,s===1?i--:i=100}}function*MF(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=Ft(e));;)yield(Math.sin(e.elapsed*Am)+1)/2}function*$F(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=Ft(e));;)yield Math.sin(e.elapsed*Am)}function*BF(e){for(typeof e=="number"&&(e=Ft(e));;){let r=e.elapsed;r<.5?r*=2:r=2-r*2,yield r}}function*_F(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=Ft(e));;)yield e.elapsed}function*TF(e){for(typeof e=="number"&&(e=Ft(e));;)yield e.elapsed<.5?0:1}var zF=(e,r={})=>{const n=e/1e3,i=r.min??Number.MIN_SAFE_INTEGER,s=r.max??Number.MAX_SAFE_INTEGER;let o=performance.now();return()=>{const a=performance.now(),u=a-o;o=a;const l=n*u;return l>s?s:l<i?i:l}};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Modulation:{Forces:nl,Envelopes:tl,Oscillators:ol,Easings:Xa}})}catch{}var RF={};E(RF,{applyToValues:()=>GF,average:()=>LF,count:()=>j0,filter:()=>HF,isApproximately:()=>WF,isValid:()=>Sm,jitter:()=>vm,jitterAbsolute:()=>ym,linearSpace:()=>Gl,max:()=>OF,min:()=>VF,numericPercent:()=>jF,numericRange:()=>Cm,numericRangeRaw:()=>IF,pingPong:()=>el,pingPongPercent:()=>hm,quantiseEvery:()=>Gs,randomUniqueInteger:()=>Qa,round:()=>or,total:()=>qF,tracker:()=>UF});var IF=function*(e,r=0,n,i=!1){if(e<=0)throw new Error("Interval is expected to be above zero");n===void 0&&(n=Number.MAX_SAFE_INTEGER);let s=r;do for(;s<n;)yield s,s+=e;while(i)},Cm=function*(e,r=0,n,i=!1,s){P(e,"nonZero");const o=e<0;if(n!==void 0){if(o&&r<n)throw new Error(`Interval of ${e} will never go from ${r} to ${n}`);if(!o&&r>n)throw new Error(`Interval of ${e} will never go from ${r} to ${n}`)}s=s??1e3,n===void 0?n=Number.MAX_SAFE_INTEGER:n*=s,e=e*s;do{let a=r*s;for(;!o&&a<=n||o&&a>=n;)yield a/s,a+=e}while(i)},jF=function(e=.01,r=!1,n=0,i=1){return P(e,"percentage","interval"),P(n,"percentage","start"),P(i,"percentage","end"),Cm(e,n,i,r)};function LF(...e){return ta(e)}var VF=(...e)=>of(e),OF=(...e)=>af(e),qF=(...e)=>uf(e);function WF(e,r,n){U(J(r,"percentage","rangePercent")),U(J(e,"","baseValue"));const i=e*r,s=o=>{try{U(J(o,"","v"));let a=Math.abs(o-e);return Math.abs(e)<=2&&(a=or(5,a)),a<=i}catch{return!1}};return n===void 0?s:s(n)}var Sm=e=>!(typeof e!="number"||Number.isNaN(e)),GF=(e,r)=>{const n={...e};for(const[i,s]of Object.entries(e))typeof s=="number"?n[i]=r(s):n[i]=s;return n},UF=e=>cn(e);function*HF(e){for(const r of e)Sm(r)&&(yield r)}var JF={};E(JF,{Async:()=>Ii,Chains:()=>Fm,Sync:()=>ey,chunks:()=>bP,combineLatestToArray:()=>pP,concat:()=>AP,dropWhile:()=>wP,equals:()=>RP,every:()=>zP,fill:()=>DP,filter:()=>EP,find:()=>CP,flatten:()=>NP,forEach:()=>SP,fromArray:()=>PP,fromEvent:()=>pw,fromIterable:()=>jP,isAsyncIterable:()=>H,isIterable:()=>Pn,map:()=>FP,max:()=>gP,min:()=>mP,reduce:()=>MP,slice:()=>$P,some:()=>kP,toArray:()=>TP,unique:()=>BP,uniqueByValue:()=>_P,until:()=>xP,zip:()=>IP});var Fm={};E(Fm,{Dom:()=>Pm,Links:()=>km,addToArray:()=>eP,asArray:()=>tP,asCallback:()=>rP,asPromise:()=>nP,asValue:()=>iP,combineLatestToArray:()=>Jm,combineLatestToObject:()=>cP,fromArray:()=>sP,fromEvent:()=>oP,fromFunction:()=>Hm,fromIterable:()=>aP,isGenFactoryNoInput:()=>Ro,lazy:()=>uP,mergeFlat:()=>lP,oncePromise:()=>Nm,resolveToAsyncGen:()=>al,resolveToGen:()=>ne,run:()=>dP,runN:()=>fP,single:()=>hP,syncToArray:()=>yP,tick:()=>vP});var Pm={};E(Pm,{perValue:()=>ZF,query:()=>QF});function Ro(e){return"_type"in e?e._type==="GenFactoryNoInput":!1}function*YF(e){yield e}var Nm=(e,r)=>new Promise(n=>{const i=(...s)=>{e.removeEventListener(r,i),n(s)};e.addEventListener(r,i)});async function*XF(e){yield e,await de(1)}function ne(e){if(Array.isArray(e)){const r=e.values();return r._name="arrayInput",r}else{if(typeof e=="number"||typeof e=="boolean"||typeof e=="string")return YF(e);if(typeof e=="function")return e()}return e}function al(e){if(e!==void 0)return Array.isArray(e)?Ho(e):typeof e=="number"||typeof e=="boolean"||typeof e=="string"?XF(e):typeof e=="function"?e():H(e)?e:Jo(e)}var KF=e=>{const r=e??(i=>i),n=new Map;return{has(i){return n.has(r(i))},get(i){return n.get(r(i))},set(i,s){n.set(r(i),s)},entries(){return n.entries()},delete(i){n.delete(i)}}};function ZF(e={}){const r=e.byReference,n=e.tagName??"div";if(r&&e.key)throw new Error("byReference and key options are mutually exclusive");const i=r?void 0:e.key??ot,s=KF(i),o=e.parentEl??document.body,a=X(o),u=new Set;async function*l(c){for await(const f of ne(c)){let d=s.get(f);d||(d=document.createElement(n),s.set(f,d),e.beforeInsert&&e.beforeInsert(d),a.append(d),e.afterInsert&&e.afterInsert(d)),u.add(d),yield{el:d,value:f}}for(const[f,d]of s.entries())u.has(d)||(e.beforeRemove&&e.beforeRemove(d),d.remove(),s.delete(f))}return l._name="dom.perValue",l}function QF(e={}){const r=e.baseElement??document;async function*n(i){const s=ne(i);for await(const o of s)for(const a of r.querySelectorAll(o))yield a}return n._name="dom.query",n}var km={};E(km,{average:()=>Om,chunk:()=>Wm,debounce:()=>zm,delay:()=>Tm,drop:()=>Um,duration:()=>_m,filter:()=>Gm,flatten:()=>Bm,max:()=>jm,min:()=>Im,rank:()=>Lm,rankArray:()=>Vm,take:()=>$m,tally:()=>Rm,total:()=>qm,transform:()=>Mm});function Mm(e){async function*r(n){n=ne(n);for await(const i of n)yield e(i)}return r._name="transform",r}function $m(e){async function*r(n){n=ne(n);let i=0;for await(const s of n){if(++i>e)break;yield s}}return r._name="take",r}function Bm(e){async function*r(n){n=ne(n);for await(const i of n)yield e(i)}return r._name="flatten",r}function _m(e){const r=V(e,0);async function*n(i){i=ne(i);const s=bt.since();for await(const o of i){if(s()>r)break;yield o}}return n._name="duration",n}function Tm(e){const r=V(e.before,0),n=V(e.after,0);async function*i(s){s=ne(s);for await(const o of s)r>0&&await de(r),yield o,n>0&&await de(n)}return i._name="delay",i}function zm(e){const r=V(e,0);async function*n(i){i=ne(i);let s=bt.since();for await(const o of i)s()<r||(yield o,s=bt.since())}return n._name="debounce",n}function Rm(){async function*e(r){r=ne(r);let n=0;for await(const i of r)yield++n}return e._name="tally",e}function Im(){async function*e(r){r=ne(r);let n=Number.MAX_SAFE_INTEGER;for await(const i of r){const s=Array.isArray(i)?i:[i];for(const o of s){if(typeof o!="number")break;n=Math.min(o,n),yield n}}}return e._name="min",e}function jm(){async function*e(r){r=ne(r);let n=Number.MIN_SAFE_INTEGER;for await(const i of r){const s=Array.isArray(i)?i:[i];for(const o of s){if(typeof o!="number")break;n=Math.max(o,n),yield n}}}return e._name="max",e}function Lm(e,r={}){const n=r.includeType,i=r.emitEqualRanked??!1,s=r.emitRepeatHighest??!1;async function*o(a){a=ne(a);let u;for await(const l of a){let c=!1;if(!(n&&typeof l!==n)){if(u===void 0)u=l,c=!0;else{const f=e(l,u);f=="a"?(u=l,c=!0):(f==="eq"&&i||s)&&(c=!0)}c&&(yield u)}}}return o._name="rank",o}function Vm(e,r={}){const n=r.includeType,i=r.emitEqualRanked??!1,s=r.emitRepeatHighest??!1,o=r.withinArrays??!1;async function*a(u){u=ne(u);let l;for await(const c of u){let f=!1;o&&(l=void 0);for(const d of c)if(!(n&&typeof d!==n))if(l===void 0)l=d,f=!0;else{const h=e(d,l);h=="a"?(l=d,f=!0):(h==="eq"&&i||s)&&(f=!0)}f&&l&&(yield l)}}return a._name="rankArray",a}function Om(){async function*e(r){r=ne(r);let n=0,i=0;for await(const s of r){if(typeof s!="number")break;i++,n+=s,yield n/i}}return e._name="average",e}function qm(){async function*e(r){r=ne(r);let n=0;for await(const i of r){if(typeof i!="number")break;n+=i,yield n}}return e._name="average",e}function Wm(e,r=!0){le(e,"aboveZero","size");async function*n(i){i=ne(i);let s=[];for await(const o of i)s.push(o),s.length>=e&&(yield s,s=[]);r&&s.length>0&&(yield s)}return n._name="chunk",n}function Gm(e){async function*r(n){n=ne(n);for await(const i of n)e(i)&&(yield i)}return r._name="filter",r}function Um(e){async function*r(n){n=ne(n);for await(const i of n)e(i)||(yield i)}return r._name="drop",r}async function eP(e,r){const n=typeof r=="function"?r():r;for await(const i of n)e.push(i)}async function tP(e){const r=typeof e=="function"?e():e;return Xo(r)}async function rP(e,r,n){const i=typeof e=="function"?e():e;for await(const s of i)r(s);n&&n()}function nP(e){let r;const n=typeof e=="function"?e():e;async function i(){const s=await n.next();if(!s.done)return r=s.value,r}return i}function iP(e,r){let n=r,i=!1;const s=typeof e=="function"?e():e;function o(){return i||(i=!0,s.next().then(a=>{n=a.value,i=!1}).catch(a=>{throw i=!1,a})),n}return o}function sP(e,r=5){async function*n(){for(const i of e)await de(r),yield i}return n._name="fromArray",n._type="GenFactoryNoInput",n}function oP(e,r){async function*n(){for(;;)yield await Nm(e,r)}return n._name="fromEvent",n._type="GenFactoryNoInput",n}function Hm(e){async function*r(){for(;;){const n=await e();if(n===void 0)break;yield n}}return r._name="fromFunction",r._type="GenFactoryNoInput",r}function aP(e){async function*r(){for await(const n of e)yield n}return r._name="fromIterable",r._type="GenFactoryNoInput",r}var Wl=e=>e._name;function uP(){const e=[];let r;const n=s=>{s===void 0&&(s=r);let o=al(s);for(const a of e)if(o===void 0)if(Ro(a))o=a();else throw new Error(`Function '${Wl(a)}' requires input. Provide it to the function, or call 'input' earlier.`);else o=a(o);return o},i={rankArray:(s,o)=>(e.push(Vm(s,o)),i),rank:(s,o)=>(e.push(Lm(s,o)),i),transform:s=>(e.push(Mm(s)),i),flatten:s=>(e.push(Bm(s)),i),drop:s=>(e.push(Um(s)),i),delay:s=>(e.push(Tm(s)),i),duration:s=>(e.push(_m(s)),i),debounce:s=>(e.push(zm(s)),i),fromFunction:s=>(e.push(Hm(s)),i),take:s=>(e.push($m(s)),i),chunk:(s,o=!0)=>(e.push(Wm(s,o)),i),filter:s=>(e.push(Gm(o=>s(o))),i),min:()=>(e.push(Im()),i),max:()=>(e.push(jm()),i),average:()=>(e.push(Om()),i),total:()=>(e.push(qm()),i),tally:()=>(e.push(Rm()),i),input(s){return r=s,i},asGenerator:n,asAsync(s){let o=s??r;for(const a of e)if(o===void 0&&Ro(a))o=a();else{if(o===void 0)throw new Error(`Function '${Wl(a)}' needs input. Pass in data calling 'asAsync', or call 'input' earlier`);o=a(o)}return i},asArray:async s=>{const o=n(s);return await Ii.toArray(o)},firstOutput:async s=>(await n(s).next()).value,lastOutput:async s=>{const o=n(s);let a;for await(const u of o)a=u;return a}};return i}async function*lP(...e){const r=e.map(u=>al(u)),n=wu.mutable();let i=0;const s=async u=>{if(u===void 0){i++;return}const l=await u.next();l.done?i++:(n.enqueue(l.value),setTimeout(()=>s(u),1))};for(const u of r)setTimeout(()=>s(u),1);const o=10;let a=1;for(;i<r.length;){const u=n.dequeue();u===void 0?a=Math.min(a+1,10):(yield u,a=1),await de(o*a)}}async function*Jm(e,r={}){const n=r.onSourceDone??"break",i=r.finalValue??"undefined",s=r.afterEmit??"last",o=e.map((f,d)=>({waiting:void 0,index:d,gen:ne(f),done:!1,lastValue:void 0})),a=()=>!o.some(f=>!f.done),u=()=>o.some(f=>f.waiting!==void 0),l=f=>!f.some(d=>d!==void 0);let c=[];for(;;){const f=[];for(const v of o){if(v.done)continue;if(v.waiting!==void 0){f.push(v.waiting);continue}const m=Promise.resolve((async()=>{if(v.done)return v;const g=await v.gen.next();return v.waiting=void 0,g.done?(v.done=!0,i==="undefined"&&(v.lastValue=void 0)):v.lastValue=g.value,v})());v.waiting=m,f.push(m)}if((await Promise.race(f)).done&&n==="break")break;const h=o.map(v=>v.lastValue);if(h.length===0)return;const y=l(h);if(y&&!u())return;if(!wf(c,h)&&!y&&(c=h,yield h),s==="undefined")for(const v of o)v.waiting===void 0&&(v.lastValue=void 0);if(a())break}}async function*cP(e,r={}){const n=r.onSourceDone??"break",i=r.finalValue??"undefined",s=r.afterEmit??"last",o=new Map;for(const[d,h]of Object.entries(e))o.set(d,{gen:ne(h),done:!1,lastValue:void 0,waiting:void 0,key:d});const a=()=>!Dn.some(o,d=>!d.done),u=()=>Dn.some(o,d=>d.waiting!==void 0),l=d=>{for(const h of Object.values(d))if(h!==void 0)return!1;return!0},c=()=>{const d={};for(const[h,y]of o)d[h]=y.lastValue;return d};let f;for(;;){const d=[];for(const m of o.values()){if(m.done)continue;if(m.waiting!==void 0){d.push(m.waiting);continue}const g=Promise.resolve((async()=>{if(m.done)return m;const x=await m.gen.next();return m.waiting=void 0,x.done?(m.done=!0,i==="undefined"&&(m.lastValue=void 0)):m.lastValue=x.value,m})());m.waiting=g,d.push(g)}if((await Promise.race(d)).done&&n==="break")break;const y=c(),v=l(y);if(v&&!u())return;if(!Uo(f,y)&&!v&&(f=y,yield y),s==="undefined")for(const m of o.values())m.waiting===void 0&&(m.lastValue=void 0);if(a())break}}async function*fP(...e){let r;for(const n of e)r=typeof n=="function"?n(r??[]):ne(n);if(r!==void 0)for await(const n of r)yield n}async function*dP(e,r,n,i,s,o,a){let u;const l=arguments;for(const c of l)typeof c=="function"?u=c(u??[]):u=ne(c);if(u!==void 0)for await(const c of u)yield c}async function hP(e,r){return(await e([r]).next()).value}async function*yP(e,r={}){const n=r.onSourceDone??"break",i=V(r.maximumWait,2e3),s=r.finalValue??"undefined",o=e.map(f=>({seq:0,lastValue:void 0,gen:ne(f),done:!1})),a={millis:i};let u=0;const l=()=>!o.some(f=>!f.done);let c=!0;for(;c;){u++;for(const f of o){if(f.done){f.seq=u;continue}const d=await Yo(f.gen,a);if(d.done){if(f.done=!0,f.seq=u,s==="undefined"&&(f.lastValue=void 0),n==="break")return}else f.lastValue=d.value,f.seq=u}if(c){const f=o.filter(d=>d.seq===u).map(d=>d.lastValue);if(f.length===0||!f.some(d=>d!==void 0))return;yield f}l()&&(c=!1)}}function vP(e){const r=V(e.interval,0),n=e.asClockTime??!1,i=e.loops??Number.MAX_SAFE_INTEGER;let s=0;const o=V(e.elapsed,Number.MAX_SAFE_INTEGER);async function*a(){const u=bt.since();for(;s<i&&u()<o;){yield n?Date.now():u();const l=s*r-u();await de(Math.max(0,r+l)),s++}}return a._name="timestamp",a._type="GenFactoryNoInput",a}function pP(e,r={}){return Jm(e,r)}function mP(e,r=(n,i)=>n>i){return H(e)?Pc(e,r):vy(e,r)}function gP(e,r=(n,i)=>n>i){return H(e)?Fc(e,r):yy(e,r)}function wP(e,r){return H(e)?mc(e,r):sy(e,r)}function xP(e,r){if(H(e))return gc(e,r);oy(e,r)}function bP(e,r){return H(e)?vc(e,r):ny(e,r)}function EP(e,r){return H(e)?Ec(e,r):fy(e,r)}function DP(e,r){return H(e)?bc(e,r):ly(e,r)}function AP(...e){return H(e[0])?pc(...e):iy(...e)}function CP(e,r){return H(e)?Dc(e,r):dy(e,r)}function SP(e,r){if(H(e))return Cc(e,r);cy(e,r)}function FP(e,r){return H(e)?Sc(e,r):eu(e,r)}function PP(e,r){return r===void 0?ds(e):Ho(e,r)}function NP(e){return H(e)?Ac(e):hy(e)}function kP(e,r){return H(e)?Mc(e,r):my(e,r)}function MP(e,r,n){return H(e)?Nc(e,r,n):py(e,r,n)}function $P(e,r=0,n=Number.POSITIVE_INFINITY){return H(e)?kc(e,r,n):ea(e,n)}function BP(e){return Array.isArray(e)?e.length===0?ds([]):H(e[0])?Qs(e):xo(e):H(e)?Qs(e):xo(e)}function*_P(e,r=ot,n=new Set){return H(e)?$c(e,r,n):ty(e,r,n)}function TP(e,r=Number.POSITIVE_INFINITY){return H(e)?Xo(e,r):xy(e,r)}function zP(e,r){return H(e)?xc(e,r):uy(e,r)}function RP(e,r,n){return H(e)&&H(r)?wc(e,r,n):ay(e,r,n)}function IP(...e){return e.length===0?ds([]):H(e[0])?Bc(...e):gy(...e)}function jP(e,r){return H(e)||r!==void 0?Jo(e,r):wy(e)}var LP={};E(LP,{getErrorMessage:()=>je,logColours:()=>n0,logSet:()=>r0,logger:()=>br,resolveLogOption:()=>Ba});export{Td as B,Sn as C,bs as D,X0 as F,Ld as G,jp as P,ss as S,rl as a,K0 as b,FS as c,pm as d,Dt as e,Wp as l,X as r,zA as s};
