import { c as createComponent, r as renderTemplate, a as renderComponent, u as unescapeHTML } from './astro/server__cawITtY.mjs';
import 'kleur/colors';
import { $ as $$MainLayout } from './MainLayout_BFrOPY-O.mjs';

const html = "<div class=\"tip\">\n<ul>\n<li>API Reference <a href=\"https://clinth.github.io/ixfx/classes/Data.Pool.Pool.html\">Data.Pool class</a></li>\n<li>Parent <a href=\"https://clinth.github.io/ixfx/modules/Data.html\">Data module</a></li>\n</ul></div>\n<p>The <a href=\"https://clinth.github.io/ixfx/classes/Data.Pool.Pool.html\">Pool</a> class does the housekeeping of managing a limited set of resources which are shared by ‘users’. All resources in the Pool are meant to be the same kind of object.</p>\n<p>An example is an audio sketch driven by TensorFlow. We might want to allocate a sound oscillator per detected human body. A naive implementation would be to make an oscillator for each detected body. However, because poses appear/disappear unpredictably, it’s a lot of extra work to maintain the binding between pose and oscillator.</p>\n<p>Instead, we might use the <a href=\"https://clinth.github.io/ixfx/classes/Data.Pool.Pool.html\">Pool</a> to allocate oscillators to poses. This will allow us to limit resources and clean up automatically if they haven’t been used for a while.</p>\n<p>Resources can be added manually with <code>addResource()</code>, or automatically by providing a <code>generate()</code> function in the Pool options. They can then be accessed via a <em>user key</em>. This is meant to associated with a single ‘user’ of a resource. For example, if we are associating oscillators with TensorFlow poses, the ‘user key’ might be the id of the pose.</p>\n<h2 id=\"in-action-manual-resources\">In action: manual resources</h2>\n<p>The Pool is created, and resources added:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Pool } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'https://unpkg.com/ixfx/dist/data.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> pool</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Pool.</span><span style=\"color:#B392F0\">create</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  capacity: oscillators.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Remove 'users' if they haven't been seen after one second</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  userExpireAfterMs: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // If the capacity is reached, re-use the oscillator from the</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // last-seen pose</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  fullPolicy: </span><span style=\"color:#9ECBFF\">`evictOldestUser`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Add a bunch of pre-made oscillators as resources</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> osc</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> oscillators) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  pool.</span><span style=\"color:#B392F0\">addResource</span><span style=\"color:#E1E4E8\">(osc);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<p>To access a resource value, call <code>useValue()</code> with a <em>userKey</em>. In this case, we have a function <code>onData</code> that is called when there is a set of poses to process.</p>\n<p>What we want to do is find the oscillator previously associated with that particular pose. If there hasn’t been an allocation for that pose, we want to pick a free one or reclaim an existing one. It’s all that book-keeping that Pool handles for you via <code>useValue</code>.</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#6A737D\">// New poses come in</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#B392F0\"> onData</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">poses</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // For each pose</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> pose</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> poses) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Get an oscillator for it</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> osc</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> pool.</span><span style=\"color:#B392F0\">useValue</span><span style=\"color:#E1E4E8\">(pose.id);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Do something with the resource...</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    osc.filterCutoff </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> ...</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"in-action-automatically-generating-resources\">In action: automatically generating resources</h2>\n<p>In this example, we will generate Pool resources on-demand. The Pool will create them (with the <code>generate()</code> function we provide) and automatically free them when they are unused.</p>\n<p>First we create the Pool, providing <em>generate</em> and <em>free</em> functions which are responsible for creating and destroying resources. Here HTML elements are the resources being managed.</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Pool } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'https://unpkg.com/ixfx/dist/data.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> pool</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Pool.</span><span style=\"color:#B392F0\">create</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  capacity: </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  userExpireAfterMs: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  resourcesWithoutUserExpireAfterMs: </span><span style=\"color:#79B8FF\">10000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  fullPolicy: </span><span style=\"color:#9ECBFF\">`evictOldestUser`</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Generate a new resource (in this example, a HTML element)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  generate</span><span style=\"color:#E1E4E8\">: () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> el</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> document.</span><span style=\"color:#B392F0\">createElement</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`DIV`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    el.classList.</span><span style=\"color:#B392F0\">add</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`pool-item`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    document.</span><span style=\"color:#B392F0\">getElementById</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`items`</span><span style=\"color:#E1E4E8\">)?.</span><span style=\"color:#B392F0\">append</span><span style=\"color:#E1E4E8\">(el);</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Whatever is returned is stored and yielded via `useValue` on-demand</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> el;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }, </span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  /**</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">   * Delete the HTML element when resource is freed</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">   * </span><span style=\"color:#F97583\">@param</span><span style=\"color:#B392F0\"> {HTMLElement}</span><span style=\"color:#E1E4E8\"> el</span><span style=\"color:#6A737D\"> </span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">   */</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  free</span><span style=\"color:#E1E4E8\">:(</span><span style=\"color:#FFAB70\">el</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    el.</span><span style=\"color:#B392F0\">remove</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Now we can use resources from the pool, for example assigning a HTML element per key down.</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#B392F0\"> useState</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#79B8FF\">keysDown</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> state;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> key</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> keysDown) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Allocate a HTML element for each key held down</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> el</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> pool.</span><span style=\"color:#B392F0\">useValue</span><span style=\"color:#E1E4E8\">(key);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Set the text of the element to be the key</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    el.innerText </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> key;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"></span></code></pre>\n<p>This is implemented in the <a href=\"https://github.com/ClintH/ixfx-demos/tree/main/data/pool-key\">pool-key</a> demo, below.</p>\n<demo-element title=\"Pool key\" src=\"/data/pool-key/\">\n<h2 id=\"creating\">Creating</h2>\n<p>Create a Pool and provide some <a href=\"https://clinth.github.io/ixfx/types/Data.Pool.Opts.html\">options</a></p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> pool</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Pool.</span><span style=\"color:#B392F0\">create</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  capacity: </span><span style=\"color:#79B8FF\">3</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Overview of options, all of which are optional.</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>option</th><th>info</th></tr></thead><tbody><tr><td>capacity</td><td>Maximum number of resources. Defaults to 0, no limit</td></tr><tr><td>capacityPerResource</td><td>Maximum number of users per resource. Defaults to 0, no limit</td></tr><tr><td>debug</td><td>If true, additional logging will be printed</td></tr><tr><td>free</td><td>A function that takes a single value. Call when a resource is removed from pool. Meant for cleaning up a value, where necessary.</td></tr><tr><td>fullPolicy</td><td>’error’ (throws an error when pool is full) or ‘evictOldestUser’, removing oldest user of a resource. Defaults to ‘error’</td></tr><tr><td>generate</td><td>A function that returns a value. Used for generating resources on demand</td></tr><tr><td>resourcesWithout UsersExpireAfterMs</td><td>If provided, an unused resource will be removed after this period</td></tr><tr><td>userExpireAfterMs</td><td>If provided, a user will be marked as expired if it hasn’t been updated</td></tr></tbody></table>\n<h2 id=\"accessing-resources\">Accessing resources</h2>\n<p>A resource can be accessed by a <em>user key</em>, returning a <a href=\"https://clinth.github.io/ixfx/classes/Data.Pool.PoolUser.html\">PoolUser</a> instance.</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> u</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> pool.</span><span style=\"color:#B392F0\">use</span><span style=\"color:#E1E4E8\">(key); </span></span>\n<span class=\"line\"></span></code></pre>\n<p>As described earlier, the user key is some unique reference for ‘owner’ of that pool resource. The idea is that if the same logical owner accesses the resource again, it always is using the same key. As far as the Pool is concerned, a different key means a different user, thus allocating a different resource.</p>\n<p><code>useValue(key)</code> returns the resource value rather than the <code>PoolUser</code> instance, if that’s all you care about.</p>\n<p>When using resources managed by the Pool, it is important that all access to them happens via the Pool. Don’t cache references to resources, always access them via <code>use()</code> or <code>useValue()</code>.</p>\n<p>The <a href=\"https://clinth.github.io/ixfx/classes/Data.Pool.PoolUser.html\">PoolUser</a> instance returned by <code>use()</code> has a <em>disposed</em> event handler. This allows you to be notified if you have lost ownership of a resource. It is also called if the resource itself has been cleaned up.</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> u</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> pool.</span><span style=\"color:#B392F0\">use</span><span style=\"color:#E1E4E8\">(key);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">u.</span><span style=\"color:#B392F0\">addEventListener</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`disposed`</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">evt</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#79B8FF\">data</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">reason</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> evt;</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // 'reason' is a string describing why it was disposed</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // 'data' is the data of the resource</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // You might do some clean up</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">})</span></span>\n<span class=\"line\"></span></code></pre>\n<p>Resources can be manually released:</p>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">pool.</span><span style=\"color:#B392F0\">release</span><span style=\"color:#E1E4E8\">(userKey);</span></span>\n<span class=\"line\"></span></code></pre>\n<p>When releasing, the resource is freed for user under a different key. If there are no more users of a resource and the Pool option <code>resourcesWithoutUsersExpireAfterMs</code> is set, the resource will be freed.</p>\n<h2 id=\"misc\">Misc.</h2>\n<pre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"js\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Returns true if this resouce is in the pool</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">pool.</span><span style=\"color:#B392F0\">hasResource</span><span style=\"color:#E1E4E8\">(res); </span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Returns true if `userKey` is a user of some resource</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">pool.</span><span style=\"color:#B392F0\">hasUser</span><span style=\"color:#E1E4E8\">(userKey);</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Iterate over all Resource instances in the pool</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">pool.</span><span style=\"color:#B392F0\">resources</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Iterate over all values (ie something originally added to the pool)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">pool.</span><span style=\"color:#B392F0\">values</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span></code></pre></demo-element>";

				const frontmatter = {"title":"Pool","layout":"../../layouts/MainLayout.astro","setup":"import { DemoElement } from '../../components/DemoElement.ts';\n"};
				const file = "/Users/af4766/repos/ixfx-docs/src/pages/data/pool.md";
				const url = "/data/pool";
				function rawContent() {
					return "\n<div class=\"tip\">\n<ul>\n<li>API Reference <a href=\"https://clinth.github.io/ixfx/classes/Data.Pool.Pool.html\">Data.Pool class</a></li>\n<li>Parent <a href=\"https://clinth.github.io/ixfx/modules/Data.html\">Data module</a></li>\n</div>\n\nThe [Pool](https://clinth.github.io/ixfx/classes/Data.Pool.Pool.html) class does the housekeeping of managing a limited set of resources which are shared by 'users'. All resources in the Pool are meant to be the same kind of object.\n\nAn example is an audio sketch driven by TensorFlow. We might want to allocate a sound oscillator per detected human body. A naive implementation would be to make an oscillator for each detected body. However, because poses appear/disappear unpredictably, it's a lot of extra work to maintain the binding between pose and oscillator.\n\nInstead, we might use the [Pool](https://clinth.github.io/ixfx/classes/Data.Pool.Pool.html) to allocate oscillators to poses. This will allow us to limit resources and clean up automatically if they haven't been used for a while.\n\nResources can be added manually with `addResource()`, or automatically by providing a `generate()` function in the Pool options. They can then be accessed via a _user key_. This is meant to associated with a single 'user' of a resource. For example, if we are associating oscillators with TensorFlow poses, the 'user key' might be the id of the pose.\n\n## In action: manual resources\n\nThe Pool is created, and resources added:\n\n```js\nimport { Pool } from 'https://unpkg.com/ixfx/dist/data.js';\nconst pool = Pool.create({\n  capacity: oscillators.length,\n  // Remove 'users' if they haven't been seen after one second\n  userExpireAfterMs: 1000,\n  // If the capacity is reached, re-use the oscillator from the\n  // last-seen pose\n  fullPolicy: `evictOldestUser`\n});\n\n// Add a bunch of pre-made oscillators as resources\nfor (const osc of oscillators) {\n  pool.addResource(osc);\n}\n```\n\nTo access a resource value, call `useValue()` with a _userKey_. In this case, we have a function `onData` that is called when there is a set of poses to process.\n\nWhat we want to do is find the oscillator previously associated with that particular pose. If there hasn't been an allocation for that pose, we want to pick a free one or reclaim an existing one. It's all that book-keeping that Pool handles for you via `useValue`.\n\n```js\n// New poses come in\nconst onData = (poses) => {\n  // For each pose\n  for (const pose of poses) {\n    // Get an oscillator for it\n    const osc = pool.useValue(pose.id);\n\n    // Do something with the resource...\n    osc.filterCutoff = ...\n  }\n}\n```\n\n## In action: automatically generating resources\n\nIn this example, we will generate Pool resources on-demand. The Pool will create them (with the `generate()` function we provide) and automatically free them when they are unused.\n\nFirst we create the Pool, providing _generate_ and _free_ functions which are responsible for creating and destroying resources. Here HTML elements are the resources being managed.\n\n```js\nimport { Pool } from 'https://unpkg.com/ixfx/dist/data.js';\n\nconst pool = Pool.create({\n  capacity: 10,\n  userExpireAfterMs: 1000,\n  resourcesWithoutUserExpireAfterMs: 10000,\n  fullPolicy: `evictOldestUser`,\n  // Generate a new resource (in this example, a HTML element)\n  generate: () => {\n    const el = document.createElement(`DIV`);\n    el.classList.add(`pool-item`);\n    document.getElementById(`items`)?.append(el);\n    // Whatever is returned is stored and yielded via `useValue` on-demand\n    return el;\n  }, \n  /**\n   * Delete the HTML element when resource is freed\n   * @param {HTMLElement} el \n   */\n  free:(el) => {\n    el.remove();\n  }\n});\n```\n\nNow we can use resources from the pool, for example assigning a HTML element per key down.\n\n```js\nconst useState = () => {\n  const { keysDown } = state;\n\n  for (const key of keysDown) {\n    // Allocate a HTML element for each key held down\n    const el = pool.useValue(key);\n\n    // Set the text of the element to be the key\n    el.innerText = key;\n  }\n};\n```\n\nThis is implemented in the [pool-key](https://github.com/ClintH/ixfx-demos/tree/main/data/pool-key) demo, below.\n\n<demo-element title=\"Pool key\" src=\"/data/pool-key/\" />\n\n## Creating\n\nCreate a Pool and provide some [options](https://clinth.github.io/ixfx/types/Data.Pool.Opts.html)\n\n```js\nconst pool = Pool.create({\n  capacity: 3\n})\n```\n\nOverview of options, all of which are optional.\n\n| option     | info |\n| ------     | ---- |\n| capacity | Maximum number of resources. Defaults to 0, no limit\n| capacityPerResource | Maximum number of users per resource. Defaults to 0, no limit |\n| debug | If true, additional logging will be printed |\n| free | A function that takes a single value. Call when a resource is removed from pool. Meant for cleaning up a value, where necessary. |\n| fullPolicy | 'error' (throws an error when pool is full) or 'evictOldestUser', removing oldest user of a resource. Defaults to 'error' |\n| generate | A function that returns a value. Used for generating resources on demand |\n| resourcesWithout UsersExpireAfterMs | If provided, an unused resource will be removed after this period |\n| userExpireAfterMs | If provided, a user will be marked as expired if it hasn't been updated |\n\n## Accessing resources\n\nA resource can be accessed by a _user key_, returning a [PoolUser](https://clinth.github.io/ixfx/classes/Data.Pool.PoolUser.html) instance.\n\n```js\nconst u = pool.use(key); \n```\n\nAs described earlier, the user key is some unique reference for 'owner' of that pool resource. The idea is that if the same logical owner accesses the resource again, it always is using the same key. As far as the Pool is concerned, a different key means a different user, thus allocating a different resource.\n\n`useValue(key)` returns the resource value rather than the `PoolUser` instance, if that's all you care about.\n\nWhen using resources managed by the Pool, it is important that all access to them happens via the Pool. Don't cache references to resources, always access them via `use()` or `useValue()`.\n\nThe [PoolUser](https://clinth.github.io/ixfx/classes/Data.Pool.PoolUser.html) instance returned by `use()` has a _disposed_ event handler. This allows you to be notified if you have lost ownership of a resource. It is also called if the resource itself has been cleaned up.\n\n```js\nconst u = pool.use(key);\nu.addEventListener(`disposed`, evt => {\n  const { data, reason } = evt;\n  // 'reason' is a string describing why it was disposed\n  // 'data' is the data of the resource\n  // You might do some clean up\n})\n```\n\nResources can be manually released:\n\n```js\npool.release(userKey);\n```\n\nWhen releasing, the resource is freed for user under a different key. If there are no more users of a resource and the Pool option `resourcesWithoutUsersExpireAfterMs` is set, the resource will be freed.\n\n## Misc.\n\n```js\n// Returns true if this resouce is in the pool\npool.hasResource(res); \n// Returns true if `userKey` is a user of some resource\npool.hasUser(userKey);\n// Iterate over all Resource instances in the pool\npool.resources();\n// Iterate over all values (ie something originally added to the pool)\npool.values();\n```";
				}
				function compiledContent() {
					return html;
				}
				function getHeadings() {
					return [{"depth":2,"slug":"in-action-manual-resources","text":"In action: manual resources"},{"depth":2,"slug":"in-action-automatically-generating-resources","text":"In action: automatically generating resources"},{"depth":2,"slug":"creating","text":"Creating"},{"depth":2,"slug":"accessing-resources","text":"Accessing resources"},{"depth":2,"slug":"misc","text":"Misc."}];
				}

				const Content = createComponent((result, _props, slots) => {
					const { layout, ...content } = frontmatter;
					content.file = file;
					content.url = url;

					return renderTemplate`${renderComponent(result, 'Layout', $$MainLayout, {
								file,
								url,
								content,
								frontmatter: content,
								headings: getHeadings(),
								rawContent,
								compiledContent,
								'server:root': true,
							}, {
								'default': () => renderTemplate`${unescapeHTML(html)}`
							})}`;
				});

export { Content, compiledContent, Content as default, file, frontmatter, getHeadings, rawContent, url };
