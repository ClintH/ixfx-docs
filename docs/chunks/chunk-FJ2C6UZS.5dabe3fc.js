import{g as Qe,f as le,C as V,a as fe,i as ge,b as et,o as I,r as tt,m as it,c as Y,p as oe,d as st,e as rt,h as at,j as nt,A as ve,k as he,P as G,l as lt,n as ot,q as ye,s as me,t as ht,u as dt,v as ut,w as de,x as ct,y as U,R as ft,z as gt,D as vt,E as yt,F as mt,G as wt,H as St,I as xt,J as pt,K as bt,L as Pt,M as O,N as At,O as kt,Q as Et,S as _t,T as Tt}from"./chunk-QOZ2BRCA.9bf98e98.js";import{_ as p,a as d,b as W,c as $,d as A,e as Ct}from"./chunk-6SYKIMQH.63e605dc.js";import{s as ue,m as zt,a as Lt}from"./chunk-25KFP6OF.fcfc3207.js";import{r as we,p as Se}from"./chunk-BSJKVIJG.f7604bb7.js";import{a as Rt,n as Nt}from"./chunk-U4IZE4J2.1410a545.js";import{S as Mt}from"./chunk-4X2SZKK7.4dbfee46.js";var K={};p(K,{Elements:()=>xe,applyOpts:()=>P,applyPathOpts:()=>Q,applyStrokeOpts:()=>E,createEl:()=>F,createOrResolve:()=>k,getBounds:()=>Bt,makeHelper:()=>It,remove:()=>ze,setBounds:()=>Dt});var Wt=(e,t,s)=>{const i=F("marker",e);if(t.markerWidth&&i.setAttribute("markerWidth",t.markerWidth?.toString()),t.markerHeight&&i.setAttribute("markerHeight",t.markerHeight?.toString()),t.orient?i.setAttribute("orient",t.orient.toString()):i.setAttribute("orient","auto-start-reverse"),t.viewBox&&i.setAttribute("viewBox",t.viewBox.toString()),t.refX&&i.setAttribute("refX",t.refX.toString()),t.refY&&i.setAttribute("refY",t.refY.toString()),s){const r=s();i.appendChild(r)}return i},q=(e,t,s)=>{if(e===null)return"(elem null)";const i=e.ownerSVGElement;if(i===null)throw new Error("parent for elem is null");const r=k(i,"defs","defs");let a=r.querySelector(`#${t.id}`);if(a!==null)return`url(#${t.id})`;if(t.id==="triangle")t={...t,strokeStyle:"transparent"},t.markerHeight||(t={...t,markerHeight:6}),t.markerWidth||(t={...t,markerWidth:6}),t.refX||(t={...t,refX:t.markerWidth}),t.refY||(t={...t,refY:t.markerHeight}),(!t.fillStyle||t.fillStyle==="none")&&(t={...t,fillStyle:"black"}),t.viewBox||(t={...t,viewBox:"0 0 10 10"}),a=Wt(t.id,t,()=>{const n=F("path");return n.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t&&P(n,t),n});else throw new Error(`Do not know how to make ${t.id}`);return a.id=t.id,r.appendChild(a),`url(#${t.id})`},xe={};p(xe,{circle:()=>Ae,circleUpdate:()=>Pe,grid:()=>Ce,line:()=>H,lineUpdate:()=>ke,path:()=>pe,pathUpdate:()=>be,text:()=>Te,textPath:()=>_e,textPathUpdate:()=>Ee,textUpdate:()=>Z});var ce=e=>e>=0&&e<=1?e*100+"%":e.toString(),pe=(e,t,s,i)=>{const r=k(t,"path",i),a=typeof e=="string"?e:e.join(`
`);return r.setAttributeNS(null,"d",a),t.appendChild(r),be(r,s)},be=(e,t)=>(t&&P(e,t),t&&E(e,t),e),Pe=(e,t,s)=>(e.setAttributeNS(null,"cx",t.x.toString()),e.setAttributeNS(null,"cy",t.y.toString()),e.setAttributeNS(null,"r",t.radius.toString()),s&&P(e,s),s&&E(e,s),e),Ae=(e,t,s,i)=>{const r=k(t,"circle",i);return Pe(r,e,s)},H=(e,t,s,i)=>{const r=k(t,"line",i);return ke(r,e,s)},ke=(e,t,s)=>(e.setAttributeNS(null,"x1",t.a.x.toString()),e.setAttributeNS(null,"y1",t.a.y.toString()),e.setAttributeNS(null,"x2",t.b.x.toString()),e.setAttributeNS(null,"y2",t.b.y.toString()),s&&P(e,s),s&&Q(e,s),s&&E(e,s),e),Ee=(e,t,s)=>(s?.method&&e.setAttributeNS(null,"method",s.method),s?.side&&e.setAttributeNS(null,"side",s.side),s?.spacing&&e.setAttributeNS(null,"spacing",s.spacing),s?.startOffset&&e.setAttributeNS(null,"startOffset",ce(s.startOffset)),s?.textLength&&e.setAttributeNS(null,"textLength",ce(s.textLength)),t&&(e.textContent=t),s&&P(e,s),s&&E(e,s),e),_e=(e,t,s,i,r)=>{const a=k(s,"text",r+"-text");Z(a,void 0,void 0,i);const n=k(a,"textPath",r);return n.setAttributeNS(null,"href",e),Ee(n,t,i)},Z=(e,t,s,i)=>(t&&(e.setAttributeNS(null,"x",t.x.toString()),e.setAttributeNS(null,"y",t.y.toString())),s&&(e.textContent=s),i&&(P(e,i),i&&E(e,i),i.anchor&&e.setAttributeNS(null,"text-anchor",i.anchor),i.align&&e.setAttributeNS(null,"alignment-baseline",i.align)),e),Te=(e,t,s,i,r)=>{const a=k(t,"text",r);return Z(a,s,e,i)},Ce=(e,t,s,i,r,a={})=>{a.strokeStyle||(a={...a,strokeStyle:Qe("bg-dim","silver")}),a.strokeWidth||(a={...a,strokeWidth:1});const n=F("g");P(n,a),Q(n,a),E(n,a);let l=0;for(;l<r;){const h=le(0,l,i,l);H(h,n),l+=s}let o=0;for(;o<i;){const h=le(o,0,o,r);H(h,n),o+=s}return e.appendChild(n),n},k=(e,t,s)=>{let i=null;if(s!==void 0&&(typeof s=="string"?i=e.querySelector(s):i=s),i===null){const r=document.createElementNS("http://www.w3.org/2000/svg",t);return e.appendChild(r),s&&typeof s=="string"&&s.startsWith("#")&&(r.id=s.substring(1)),r}return i},ze=(e,t)=>{if(typeof t=="string"){const s=e.querySelector(t);if(s===null)return;s.remove()}else t.remove()},F=(e,t)=>{const s=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&(s.id=t),s},Q=(e,t)=>{t.markerEnd&&e.setAttribute("marker-end",q(e,t.markerEnd)),t.markerStart&&e.setAttribute("marker-end",q(e,t.markerStart)),t.markerMid&&e.setAttribute("marker-end",q(e,t.markerMid))},P=(e,t)=>{t.fillStyle&&e.setAttributeNS(null,"fill",t.fillStyle)},E=(e,t)=>{t.strokeStyle&&e.setAttributeNS(null,"stroke",t.strokeStyle),t.strokeWidth&&e.setAttributeNS(null,"stroke-width",t.strokeWidth.toString()),t.strokeDash&&e.setAttribute("stroke-dasharray",t.strokeDash),t.strokeLineCap&&e.setAttribute("stroke-linecap",t.strokeLineCap)},Bt=e=>{const t=e.getAttributeNS(null,"width"),s=t===null?0:parseFloat(t),i=e.getAttributeNS(null,"height"),r=i===null?0:parseFloat(i);return{width:s,height:r}},Dt=(e,t)=>{e.setAttributeNS(null,"width",t.width.toString()),e.setAttributeNS(null,"height",t.height.toString())},It=(e,t)=>(t&&(P(e,t),E(e,t)),{remove:i=>ze(e,i),text:(i,r,a,n)=>Te(i,e,r,a,n),textPath:(i,r,a,n)=>_e(i,r,e,a,n),line:(i,r,a)=>H(i,e,r,a),circle:(i,r,a)=>Ae(i,e,r,a),path:(i,r,a)=>pe(i,e,r,a),grid:(i,r,a,n,l)=>Ce(e,i,r,a,n,l),query:i=>e.querySelector(i),get width(){const i=e.getAttributeNS(null,"width");return i===null?0:parseFloat(i)},set width(i){e.setAttributeNS(null,"width",i.toString())},get parent(){return e},get height(){const i=e.getAttributeNS(null,"height");return i===null?0:parseFloat(i)},set height(i){e.setAttributeNS(null,"height",i.toString())},clear:()=>{for(;e.firstChild;)e.removeChild(e.lastChild)}}),Yt={};p(Yt,{Colour:()=>V,Drawing:()=>X,Palette:()=>ne,Plot:()=>re,Plot2:()=>Ue,SceneGraph:()=>$e,Svg:()=>K,Video:()=>Ke});var X={};p(X,{arc:()=>Ne,bezier:()=>Be,circle:()=>Me,connectedPoints:()=>te,copyToImg:()=>$t,dot:()=>x,drawingStack:()=>C,ellipse:()=>Xt,getCtx:()=>Re,line:()=>se,lineThroughPoints:()=>Ft,makeHelper:()=>Ht,paths:()=>We,pointLabels:()=>ie,rect:()=>Ie,textBlock:()=>Ye,textBlockAligned:()=>jt,textWidth:()=>z,translatePoint:()=>Ut});var Le=Math.PI*2,Re=e=>{if(e===null)throw Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");const t=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?we(e).getContext("2d"):e;if(t===null)throw new Error("Could not create 2d context for canvas");return t},Ht=(e,t)=>{const s=Re(e);return{paths(i,r){We(s,i,r)},line(i,r){se(s,i,r)},rect(i,r){Ie(s,i,r)},bezier(i,r){Be(s,i,r)},connectedPoints(i,r){te(s,i,r)},pointLabels(i,r){ie(s,i,r)},dot(i,r){x(s,i,r)},circle(i,r){Me(s,i,r)},arc(i,r){Ne(s,i,r)},textBlock(i,r){r.bounds===void 0&&t!==void 0&&(r={...r,bounds:{...t,x:0,y:0}}),Ye(s,i,r)}}},ee=e=>Vt(e.strokeStyle,e.fillStyle),m=(e,t={})=>{if(e===void 0)throw Error("ctx undefined");const s=C(e).push(ee(t));return s.apply(),s},Ne=(e,t,s={})=>{m(e,s);const i=r=>{e.beginPath(),e.arc(r.x,r.y,r.radius,r.startRadian,r.endRadian),e.stroke()};Array.isArray(t)?t.forEach(i):i(t)},Vt=(e,t)=>i=>{t&&(i.fillStyle=t),e&&(i.strokeStyle=e)},C=(e,t)=>(t===void 0&&(t=ue()),{push:a=>{t===void 0&&(t=ue());const n=t.push(a);return a(e),C(e,n)},pop:()=>{const a=t?.pop();return C(e,a)},apply:()=>t===void 0?C(e):(t.forEach(a=>a(e)),C(e,t))}),Ft=(e,t,s)=>{m(e,s),e.moveTo(t[0].x,t[0].y),t.forEach((i,r)=>{if(r+2>=t.length)return;const a=t[r+1],n={x:(i.x+a.x)/2,y:(i.y+a.y)/2},l=(n.x+i.x)/2,o=(n.x+a.x)/2;e.quadraticCurveTo(l,a.y,n.x,n.y),e.quadraticCurveTo(o,a.y,a.x,a.y)})},Me=(e,t,s={})=>{m(e,s);const i=r=>{e.beginPath(),e.arc(r.x,r.y,r.radius,0,Le),s.strokeStyle&&e.stroke(),s.fillStyle&&e.fill()};Array.isArray(t)?t.forEach(i):i(t)},Xt=(e,t,s={})=>{m(e,s);const i=r=>{e.beginPath();const a=r.rotation??0,n=r.startAngle??0,l=r.endAngle??Le;e.ellipse(r.x,r.y,r.radiusX,r.radiusY,a,n,l),s.strokeStyle&&e.stroke(),s.fillStyle&&e.fill()};Array.isArray(t)?t.forEach(i):i(t)},We=(e,t,s={})=>{m(e,s);const i=r=>{if(ge(r))De(e,r,s);else if(ht(r))se(e,r,s);else throw new Error(`Unknown path type ${JSON.stringify(r)}`)};Array.isArray(t)?t.forEach(i):i(t)},te=(e,t,s={})=>{const i=s.loop??!1;Rt(t),t.length!==0&&(t.forEach((r,a)=>fe(r,`Index ${a}`)),m(e,s),e.beginPath(),e.moveTo(t[0].x,t[0].y),t.forEach(r=>e.lineTo(r.x,r.y)),i&&e.lineTo(t[0].x,t[0].y),e.stroke())},ie=(e,t,s={},i)=>{t.length!==0&&(t.forEach((r,a)=>fe(r,`Index ${a}`)),m(e,s),t.forEach((r,a)=>{const n=i!==void 0&&a<i.length?i[a]:a.toString();e.fillText(n.toString(),r.x,r.y)}))},Ut=(e,t)=>{const s=e.getTransform();return{x:t.x*s.a+t.y*s.c+s.e,y:t.x*s.b+t.y*s.d+s.f}},$t=e=>{const t=document.createElement("img");return t.src=e.toDataURL("image/jpeg"),t},x=(e,t,s)=>{s===void 0&&(s={});const i=s.radius??10;if(m(e,s),e.beginPath(),Array.isArray(t))t.forEach(r=>{e.arc(r.x,r.y,i,0,2*Math.PI)});else{const r=t;e.arc(r.x,r.y,i,0,2*Math.PI)}(s.filled||!s.outlined)&&e.fill(),s.outlined&&e.stroke()},Be=(e,t,s)=>{ge(t)?De(e,t,s):et(t)&&qt(e,t,s)},qt=(e,t,s={})=>{let i=m(e,s);const{a:r,b:a,cubic1:n,cubic2:l}=t,o=s.debug??!1;e.beginPath(),e.moveTo(r.x,r.y),e.bezierCurveTo(n.x,n.y,l.x,l.y,a.x,a.y),e.stroke(),o&&(i=i.push(ee({...s,strokeStyle:I(s.strokeStyle??"silver",.6),fillStyle:I(s.fillStyle??"yellow",.4)})),i.apply(),e.moveTo(r.x,r.y),e.lineTo(n.x,n.y),e.stroke(),e.moveTo(a.x,a.y),e.lineTo(l.x,l.y),e.stroke(),e.fillText("a",r.x+5,r.y),e.fillText("b",a.x+5,a.y),e.fillText("c1",n.x+5,n.y),e.fillText("c2",l.x+5,l.y),x(e,n,{radius:3}),x(e,l,{radius:3}),x(e,r,{radius:3}),x(e,a,{radius:3}),i=i.pop(),i.apply())},De=(e,t,s={})=>{const{a:i,b:r,quadratic:a}=t,n=s.debug??!1;let l=m(e,s);e.beginPath(),e.moveTo(i.x,i.y),e.quadraticCurveTo(a.x,a.y,r.x,r.y),e.stroke(),n&&(l=l.push(ee({...s,strokeStyle:I(s.strokeStyle??"silver",.6),fillStyle:I(s.fillStyle??"yellow",.4)})),te(e,[i,a,r]),e.fillText("a",i.x+5,i.y),e.fillText("b",r.x+5,r.y),e.fillText("h",a.x+5,a.y),x(e,a,{radius:3}),x(e,i,{radius:3}),x(e,r,{radius:3}),l=l.pop(),l.apply())},se=(e,t,s={})=>{const i=s.debug??!1;m(e,s);const r=a=>{const{a:n,b:l}=a;e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(l.x,l.y),i&&(e.fillText("a",n.x,n.y),e.fillText("b",l.x,l.y),x(e,n,{radius:5,strokeStyle:"black"}),x(e,l,{radius:5,strokeStyle:"black"})),e.stroke()};Array.isArray(t)?t.forEach(r):r(t)},Ie=(e,t,s={})=>{m(e,s);const i=r=>{s.filled&&e.fillRect(r.x,r.y,r.width,r.height),e.strokeRect(r.x,r.y,r.width,r.height),s.debug&&ie(e,dt(r),void 0,["NW","NE","SE","SW"])};Array.isArray(t)?t.forEach(i):i(t)},z=(e,t,s=0,i)=>{if(t==null||t.length===0)return 0;const r=e.measureText(t);return i?tt(r.width,i)+s:r.width+s},Ye=(e,t,s)=>{m(e,s);const i=s.anchorPadding??0,r=s.anchor,a=s.bounds??{x:0,y:0,width:1e6,height:1e6},n=t.map(g=>e.measureText(g)),l=n.map(g=>g.width),o=n.map(g=>g.actualBoundingBoxAscent+g.actualBoundingBoxDescent),h=Math.max(...l),c=o.reduce((g,y)=>g+y,0);let{x:f,y:u}=r;r.x+h>a.width?f=a.width-(h+i):f-=i,f<a.x&&(f=a.x+i),r.y+c>a.height?u=a.height-(c+i):u-=i,u<a.y&&(u=a.y+i),t.forEach((g,y)=>{e.fillText(g,f,u),u+=o[y]})},jt=(e,t,s)=>{const{bounds:i}=s,{horiz:r="left",vert:a="top"}=s;let n;typeof t=="string"?n=[t]:n=t,m(e,s),e.save(),e.translate(i.x,i.y),e.textAlign="left",e.textBaseline="top";const l=i.width/2,o=i.height/2,h=n.map(g=>e.measureText(g)),c=h.map(g=>g.actualBoundingBoxAscent+g.actualBoundingBoxDescent),f=c.reduce((g,y)=>g+y,0);let u=0;a==="center"?u=o-f/2:a==="bottom"&&(u=i.height-f),n.forEach((g,y)=>{let S=0;r==="center"?S=l-h[y].width/2:r==="right"&&(S=i.width-h[y].width),e.fillText(n[y],S,u),u+=c[y]}),e.restore()},re={};p(re,{add:()=>He,calcScale:()=>ae,defaultAxis:()=>J,draw:()=>L,drawValue:()=>Ve,plot:()=>ii});var Gt=Math.PI*2,J=e=>({endWith:"none",lineWidth:1,namePosition:"none",name:e,showLabels:e==="y",showLine:!0,textSize:e==="y"?20:10}),ae=(e,t,s)=>{const i=e.keys(),r=[];return i.forEach(a=>{const n=e.get(a);if(n===void 0)return;let{min:l,max:o}=it(n),h=o-l,c;s!==void 0&&(c=s[a]),c==null&&(t.defaultSeriesVariable?c=V.getCssVariable("accent",t.defaultSeriesColour):c=t.defaultSeriesColour),h===0&&(h=l,l=l-h/2,o=o+h/2),r.push({min:l,max:o,range:h,name:a,colour:c})}),r},He=(e,t,s="")=>{e.addKeyedValues(s,t)},Ve=(e,t,s)=>{const i={...s,translucentPlot:!0,leadingEdgeDot:!1};L(t,i),s={...s,highlightIndex:e,leadingEdgeDot:!0,translucentPlot:!1,style:"none",clearCanvas:!1},L(t,s)},Ot=(e,t,s)=>ae(e,s,s.seriesColours).map(i=>({...i,range:t[1]-t[0],min:t[0],max:t[1]})),L=(e,t)=>{const{x:s,y:i,ctx:r,canvasSize:a}=t,n=t.margin,l=t.y.scaleRange?Ot(e,t.y.scaleRange,t):ae(e,t,t.seriesColours);t.clearCanvas&&r.clearRect(0,0,a.width,a.height),t.debug&&(r.strokeStyle="orange",r.strokeRect(0,0,a.width,a.height)),r.translate(n,n);const o=t.plotSize??Xe(a,t),h={height:o.height+n+n,width:o.width};if((i.showLabels||i.showLine)&&(l.forEach(f=>{i.allowedSeries!==void 0&&!i.allowedSeries.includes(f.name)||Jt(f,h,t)}),l.length>0&&i.showLine&&Kt(h,l[0],t)),(s.showLabels||s.showLine)&&l.length>0){const f=i.labelRange?i.labelRange[0]:l[0].min;Qt(o.width,_(f,l[0],o.height)+n+s.lineWidth,t)}const c={...t,plotSize:o};X.translatePoint(r,t.pointer),l.forEach(f=>{const u=e.getSource(f.name);if(u===void 0)return;let g=e.typeName==="circular"?u.pointer-1:u.length-1;t.highlightIndex!==void 0&&(g=t.highlightIndex),r.save(),r.translate(0,n+n),ei(f,u,o,c,g),r.restore()}),t.showLegend&&(r.save(),r.translate(0,o.height+n+n+n),o.width,t.x.textSize+n+n,Zt(l,t),r.restore()),r.resetTransform()},Jt=(e,t,s)=>{const{ctx:i,y:r,digitsPrecision:a,margin:n}=s,{height:l}=t;s.debug&&(i.strokeStyle="purple",i.strokeRect(0,0,r.textSize,l+n)),i.fillStyle=e.colour.length>0?e.colour:"white",r.colour&&(i.fillStyle=r.colour);const o=r.labelRange?r.labelRange[0]:e.min,h=r.labelRange?r.labelRange[1]:e.max,c=r.labelRange?h-o:e.range,f=o+c/2,u=s.textHeight/2;i.textBaseline="top",i.fillText(o.toFixed(a),0,_(o,e,l)-u),i.fillText(f.toFixed(a),0,_(f,e,l)-u),i.fillText(h.toFixed(a),0,_(h,e,l)-n),i.translate(r.textSize+n,0)},Kt=(e,t,s)=>{if(t===void 0)throw new Error("series undefined");const{ctx:i,y:r}=s,{height:a}=e,n=r.labelRange?r.labelRange[0]:t.min,l=r.labelRange?r.labelRange[1]:t.max,o=_(n,t,a),h=_(l,t,a);i.translate(r.lineWidth,0),i.lineWidth=r.lineWidth,i.beginPath(),i.moveTo(0,o),i.lineTo(0,h),i.strokeStyle=t.colour,r.colour&&(i.strokeStyle=r.colour),i.stroke(),i.translate(r.lineWidth,0)},Zt=(e,t,s)=>{const{ctx:i}=t,r=10;let a=0;const n=t.margin*3,l=t.margin;i.lineWidth=t.lineWidth,e.forEach(o=>{i.moveTo(a,n),i.strokeStyle=o.colour,i.lineTo(a+r,n),i.stroke(),a+=r+t.margin;let h=o.name;o.lastValue&&(h+=" "+o.lastValue.toFixed(t.digitsPrecision));const c=i.measureText(h);i.fillStyle=o.colour,i.fillText(h,a,l),a+=c.width})},Qt=(e,t,s)=>{const{ctx:i,x:r,y:a}=s;!r.showLine||(r.colour&&(i.strokeStyle=r.colour),i.lineWidth=r.lineWidth,i.beginPath(),i.moveTo(0,t),i.lineTo(e,t),i.stroke())},ei=(e,t,s,i,r)=>{const{ctx:a,lineWidth:n,translucentPlot:l=!1,margin:o,x:h}=i,c=i.style??"connected",f=s.height-o;let u=1;if(h.scaleRange){const v=h.scaleRange[1]-h.scaleRange[0];u=s.width/v}else i.capacity===0?u=s.width/t.length:u=s.width/i.capacity;const g=i.coalesce&&u<0?Math.floor(1/u):1;let y=0,S;i.debug&&(a.strokeStyle="green",a.strokeRect(0,0,s.width,s.height));const w=v=>l?V.opacity(v,.2):v;c==="dots"?a.fillStyle=w(e.colour):c==="none"||(a.beginPath(),a.lineWidth=n,a.strokeStyle=w(e.colour));for(let v=0;v<t.length;v+=g){let b=_(t[v],e,f)-1;c==="dots"?(a.beginPath(),a.arc(y,b,n,0,Gt),a.fill()):c==="none"||(v==0&&a.moveTo(y,b),a.lineTo(y,b)),v===r&&(S={x:y,y:b},e.lastValue=t[v]),y+=u}c==="connected"&&a.stroke(),S!==void 0&&i.leadingEdgeDot&&(a.beginPath(),a.fillStyle=w(e.colour),a.arc(S.x,S.y,3,0,2*Math.PI),a.fill())},_=(e,t,s)=>(1-(e-t.min)/t.range)*s,Fe=(e,t,s,i)=>{let r=e;s.showLabels&&(r+=s.textSize),s.showLine&&(r+=s.lineWidth),(s.showLabels||s.showLine)&&(r+=e+e);let a=e,n=e+e,l=e+e;return t.showLabels?l+=t.textSize:l+=e,t.showLine&&(l+=t.lineWidth),(t.showLabels||t.showLine)&&(l+=e),i&&(l+=t.textSize),{left:r,right:a,top:n,bottom:l}},Xe=(e,t)=>{const{width:s,height:i}=e,r=Fe(t.margin,t.x,t.y,t.showLegend);return{width:s-r.left-r.right,height:i-r.top-r.bottom}},ti=(e,t)=>{const{width:s,height:i}=e,r=Fe(t.margin,t.x,t.y,t.showLegend);return{width:s+r.left+r.right,height:i+r.top+r.bottom}},ii=(e,t)=>{if(e===null)throw new Error("parentElOrQuery is null. Expected string or element");const s=we(e);let i,r=!0,a=t.plotSize,n;s.nodeName==="CANVAS"?(i=s,r=!1,n={width:i.width,height:i.height}):(i=document.createElement("CANVAS"),s.append(i),a=t.plotSize,n={width:i.width,height:i.height});const l={x:0,y:0},o=v=>{l.x=v.offsetX,l.y=v.offsetY};i.addEventListener("pointermove",o);const h=i.getContext("2d"),c=t.capacity??10,f=c>0?zt({capacity:c}):Lt(),u=h.measureText("Xy"),g=t.coalesce??!0;if(h===null)throw new Error("Drawing context not available");let y=J("x");t.x&&(y={...y,...t.x});let S=J("y");t.y&&(S={...S,...t.y});let w={...t,y:S,x:y,pointer:l,capacity:c,coalesce:g,plotSize:a,canvasSize:n,ctx:h,textHeight:t.textHeight??u.actualBoundingBoxAscent+u.actualBoundingBoxDescent,style:t.style??"connected",defaultSeriesColour:t.defaultSeriesColour??"yellow",margin:3,clearCanvas:!0,leadingEdgeDot:!0,debug:t.debug??!1,digitsPrecision:t.digitsPrecision??2,lineWidth:t.lineWidth??2,showLegend:t.showLegend??!1};if(a){const v=ti(a,w);i.width=v.width,i.height=v.height,w.canvasSize=v}return t.autoSizeCanvas&&Se(i,v=>{const b=v.bounds;w={...w,plotSize:Xe(b,w),canvasSize:b},L(f,w)}),{drawValue:v=>{Ve(v,f,w)},dispose:()=>{i.removeEventListener("pointermove",o),r&&i.remove()},add:(v,b="",Ze=!1)=>{He(f,v,b),!Ze&&L(f,w)},draw:()=>{L(f,w)},clear:()=>{f.clear()}}},Ue={};p(Ue,{Plot:()=>ui});var $e={};p($e,{Box:()=>je,CanvasBox:()=>R,CanvasMeasureState:()=>Ge,MeasureState:()=>qe});var B=(e,t)=>e.type==="px"&&t.type==="px"?e.value===t.value:!1,si=(e,t)=>e===void 0&&t===void 0?!0:!(e===void 0||t===void 0||e.x&&t.x&&!B(e.x,t.x)||e.y&&t.y&&!B(e.y,t.y)||e.width&&t.width&&!B(e.width,t.width)||e.height&&t.height&&!B(e.height,t.height)),qe=class{constructor(e){d(this,"bounds"),d(this,"pass"),d(this,"measurements"),this.bounds=e,this.pass=0,this.measurements=new Map}getSize(e){const t=this.measurements.get(e);if(t!==void 0&&!Y(t.size))return t.size}resolveToPx(e,t){if(e===void 0)return t;if(e.type==="px")return e.value;throw new Error(`Unknown unit type ${e.type}`)}},je=class{constructor(e,t){d(this,"visual",oe),d(this,"_desiredSize"),d(this,"_lastMeasure"),d(this,"children",[]),d(this,"_parent"),d(this,"_idMap",new Map),d(this,"debugLayout",!1),d(this,"_visible",!0),d(this,"_ready",!0),d(this,"takesSpaceWhenInvisible",!1),d(this,"needsDrawing",!0),d(this,"_needsLayout",!0),d(this,"debugHue",st()),d(this,"id"),this.id=t,this._parent=e,e?.onChildAdded(this)}hasChild(e){const t=this.children.find(i=>i===e),s=this.children.find(i=>i.id===e.id);return t!==void 0||s!==void 0}notify(e,t){this.onNotify(e,t),this.children.forEach(s=>s.notify(e,t))}onNotify(e,t){}onChildAdded(e){if(e.hasChild(this))throw new Error("Recursive");if(e===this)throw new Error("Cannot add self as child");if(this.hasChild(e))throw new Error("Child already present");this.children.push(e),this._idMap.set(e.id,e)}setReady(e,t=!1){this._ready=e,t&&this.children.forEach(s=>s.setReady(e,t))}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.onLayoutNeeded())}get desiredSize(){return this._desiredSize}set desiredSize(e){si(e,this._desiredSize)||(this._desiredSize=e,this.onLayoutNeeded())}onLayoutNeeded(){this.notifyChildLayoutNeeded()}notifyChildLayoutNeeded(){this._needsLayout=!0,this.needsDrawing=!0,this._parent!==void 0?this._parent.notifyChildLayoutNeeded():this.update()}get root(){return this._parent===void 0?this:this._parent.root}measurePreflight(){}measureApply(e,t){let s=!0;return this._needsLayout=!1,rt(e.size,this.visual)&&(s=!1),at(e.size)?this.visual=e.size:this.visual={x:0,y:0,width:e.size.width,height:e.size.height},e.children.forEach(i=>{i!==void 0&&i.ref.measureApply(i,t)}),(s||t)&&(this.needsDrawing=!0,this.root.notify("measureApplied",this)),s}debugLog(e){console.log(this.id,e)}measureStart(e,t,s){this.measurePreflight();let i={ref:this,size:ut,children:[]};if(e.measurements.set(this.id,i),!this._visible&&!this.takesSpaceWhenInvisible)i.size=nt;else{let r=this._lastMeasure;if((this._needsLayout||this._lastMeasure===void 0)&&(r=this.measureSelf(e,s),this.root.notify("measured",this)),r===void 0)return;i.size=r,this._lastMeasure=r}if(i.children=this.children.map(r=>r.measureStart(e,t,i)),!(ve.without(i.children,void 0).length<this.children.length))return i}measureSelf(e,t){let s=oe;if(t?t.size&&(s={x:0,y:0,width:t.size.width,height:t.size.height}):s={x:0,y:0,width:e.bounds.width,height:e.bounds.height},!Y(s))return s}updateDone(e,t){this.onUpdateDone(e,t),this.children.forEach(s=>s.updateDone(e,t))}update(e=!1){const t=this.updateBegin(e);let s=5,i=!1;for(;s--;){const r=this.measureStart(t,e);if(r!==void 0){if(this.measureApply(r,e),!this._ready)return;i=!0}}this.updateDone(t,e),i||console.warn("Ran out of measurement attempts")}},Ge=class extends qe{constructor(e,t){super(e);d(this,"ctx"),this.ctx=t}},R=class extends je{constructor(e,t,s){super(e,s);if(d(this,"canvasEl"),t===void 0)throw new Error("canvasEl undefined");if(t===null)throw new Error("canvasEl null");this.canvasEl=t,e===void 0&&this.designateRoot()}designateRoot(){this.canvasEl.addEventListener("pointermove",e=>{const t={x:e.offsetX,y:e.offsetY};this.notifyPointerMove(t)}),this.canvasEl.addEventListener("pointerleave",e=>{this.notifyPointerLeave()}),this.canvasEl.addEventListener("click",e=>{const t={x:e.offsetX,y:e.offsetY};this.notifyClick(t)})}onClick(e){}notifyClick(e){if(!Y(this.visual)&&he(this.visual,e)){const t=G.subtract(e,this.visual.x,this.visual.y);this.onClick(t),this.children.forEach(s=>s.notifyClick(t))}}notifyPointerLeave(){this.onPointerLeave(),this.children.forEach(e=>e.notifyPointerLeave())}notifyPointerMove(e){if(!Y(this.visual)&&he(this.visual,e)){const t=G.subtract(e,this.visual.x,this.visual.y);this.onPointerMove(t),this.children.forEach(s=>s.notifyPointerMove(t))}}onPointerLeave(){}onPointerMove(e){}updateBegin(){const e=this.canvasEl.getContext("2d");if(e===null)throw new Error("Context unavailable");const t=this.canvasEl.getBoundingClientRect();return new Ge({width:t.width,height:t.height},e)}onUpdateDone(e,t){if(!this.needsDrawing&&!t)return;const s=this.canvasEl.getContext("2d");if(s===null)throw new Error("Context unavailable");s.save(),s.translate(this.visual.x,this.visual.y);const i=this.visual;this.debugLayout&&(s.lineWidth=1,s.strokeStyle=`hsl(${this.debugHue}, 100%, 50%)`,s.strokeRect(0,0,i.width,i.height),s.fillStyle=s.strokeStyle,s.fillText(this.id,10,10,i.width),s.beginPath(),s.moveTo(0,0),s.lineTo(i.width,i.height),s.stroke()),this.drawSelf(s),this.needsDrawing=!1,s.restore()}drawSelf(e){}},Oe=class{constructor(e){d(this,"data"),d(this,"series"),d(this,"dirty",!1),d(this,"type","array"),d(this,"_range"),this.series=e,this.data=[],this.dirty=!0}clear(){this.set([])}set(e){this.data=e,this.dirty=!0}get length(){return this.data.length}get range(){return!this.dirty&&this._range!==void 0?this._range:(this.dirty=!1,this._range=ve.minMaxAvg(this.data),{...this._range,changed:!0})}add(e){this.data=[...this.data,e],this.dirty=!0}},ri=class extends Oe{constructor(e){super(e);d(this,"desiredDataPointMinWidth",5)}add(e){const t=this.series.lastPxPerPt;if(t>-1&&t<this.desiredDataPointMinWidth){const s=Math.floor(this.desiredDataPointMinWidth/t),i=[...this.data.slice(s),e];super.set(i)}else super.add(e)}},ai=class{constructor(e,t,s,i){if(this.plot=s,d(this,"name"),d(this,"colour"),d(this,"source"),d(this,"drawingStyle"),d(this,"width",3),d(this,"dataHitPoint"),d(this,"tooltip"),d(this,"precision",2),d(this,"lastPxPerPt",-1),d(this,"_visualRange"),d(this,"_visualRangeStretch"),this.name=e,this.drawingStyle=i.drawingStyle??"line",this.colour=i.colour,this.width=i.width??3,this._visualRange=i.axisRange??{min:Number.NaN,max:Number.NaN},this._visualRangeStretch=i.visualRangeStretch??!0,t==="array")this.source=new Oe(this);else if(t==="stream")this.source=new ri(this);else throw new Error("Unknown sourceType. Expected array|stream")}formatValue(e){return e.toFixed(this.precision)}get visualRange(){let e=this._visualRange;const t=this.source.range;let s=!1;if(t.changed)if(this._visualRangeStretch){const i=Math.min(de(e.min,t.min),t.min),r=Math.max(de(e.max,t.max),t.max);(i!==e.min||r!==e.max)&&(e={min:i,max:r},s=!0)}else Je(t,e)||(e=t,s=!0);return this._visualRange=e,{...e,changed:s}}scaleValue(e){if(this.source===void 0)return e;const t=this.visualRange;return t.min==t.max?.5:ct(e,t.min,t.max)}add(e){this.source.add(e),this.plot.plotArea.needsDrawing=!0}clear(){this.source.clear(),this.plot.plotArea.needsDrawing=!0}},ni=class extends R{constructor(e){super(e,e.canvasEl,"PlotArea");this.plot=e,d(this,"paddingPx",3),d(this,"piPi",Math.PI*2),d(this,"pointerDistanceThreshold",20),d(this,"lastRangeChange",0),d(this,"pointer")}clear(){this.lastRangeChange=0,this.pointer=void 0}measureSelf(e,t){const s=e.getSize("AxisY");if(s===void 0)return;const i=e.getSize("Legend");if(i===void 0)return;const r=e.getSize("AxisX");if(r!==void 0)return{x:s.width,y:0,width:e.bounds.width-s.width,height:e.bounds.height-i.height-r.height}}onNotify(e,t){e==="measureApplied"&&t===this.plot.axisY&&(this._needsLayout=!0),e==="measureApplied"&&t===this.plot.legend&&(this._needsLayout=!0)}onPointerLeave(){[...this.plot.series.values()].forEach(t=>{t.tooltip=void 0}),this.pointer=void 0,this.plot.legend.onLayoutNeeded()}onPointerMove(e){this.pointer=e,this.plot.legend.onLayoutNeeded()}measurePreflight(){this.updateTooltip()}updateTooltip(){const e=this.pointer;if(e===void 0)return;[...this.plot.series.values()].forEach(s=>{if(e===void 0){s.tooltip=void 0;return}if(s.dataHitPoint===void 0)return;const i=s.dataHitPoint(e);i[0]!==void 0&&(i[1]>this.pointerDistanceThreshold||(s.tooltip=s.formatValue(i[0].value)))}),this.plot.legend.needsDrawing=!0}drawSelf(e){if(this.plot.frozen)return;const t=this.plot.seriesArray();e.clearRect(0,0,this.visual.width,this.visual.height),t.forEach(s=>{if(s.source.type==="array"||s.source.type==="stream"){const i=s.source;if(i.data===void 0)return;const r=[...i.data];this.drawDataSet(s,r,e)}else console.warn(`Unknown data source type ${s.source.type}`)})}computeY(e,t){const s=e.scaleValue(t);return U(s)*this.visual.height+this.paddingPx}drawDataSet(e,t,s){const i=this.paddingPx+e.width,r=ft.subtract(this.visual,i*2,i*3.5),a=r.width/t.length;e.lastPxPerPt=a;let n=i;s.strokeStyle=e.colour,s.lineWidth=e.width;const l=[];if(e.dataHitPoint=o=>{const h=l.map(u=>G.distanceToExterior(o,u)),c=gt(...h);return[l[c],h[c]]},e.drawingStyle==="line"){let o=0;s.beginPath();for(let h=0;h<t.length;h++){const c=vt(e.scaleValue(t[h]));o=i+this.paddingPx+r.height*U(c),l.push({x:n,y:o,index:h,value:t[h]}),h==0?s.moveTo(n+a/2,o):s.lineTo(n+a/2,o),o>this.visual.height&&console.warn(o+" h: "+this.visual.height),n+=a}s.strokeStyle=e.colour,s.stroke()}else if(e.drawingStyle==="dotted"){let o=0;s.fillStyle=e.colour;for(let h=0;h<t.length;h++){const c=e.scaleValue(t[h]);o=i+r.height*U(c),s.beginPath(),s.arc(n+a/2,o,e.width,0,this.piPi),s.fill(),l.push({radius:e.width,x:n,y:o,index:h,value:t[h]}),n+=a}}else if(e.drawingStyle==="bar"){s.fillStyle=e.colour;const o=Math.ceil(a*.1);for(let h=0;h<t.length;h++){const c=e.scaleValue(t[h]),f=r.height*c,u={x:n+o,y:r.height-f+i,width:a-o,height:f,index:h,value:t[h]};s.fillRect(u.x,u.y,u.width,u.height),l.push(u),n+=a}}}},li=class extends R{constructor(e){super(e,e.canvasEl,"Legend");this.plot=e,d(this,"sampleSize",{width:10,height:10}),d(this,"padding",3),d(this,"widthSnapping",20)}clear(){}measureSelf(e,t){const s=e.measurements.get("AxisY"),i=this.sampleSize,r=this.widthSnapping,a=this.padding,n=e.ctx;if(s===void 0)return;const l=e.bounds.width-s.size.width,o=this.plot.seriesArray();let h=a;for(let u=0;u<o.length;u++)h+=i.width+a,h+=z(n,o[u].name,a,r),h+=z(n,o[u].tooltip,a,r);const f=Math.max(1,Math.ceil(h/l))*(this.sampleSize.height+this.padding+this.padding);return{x:s.size.width,y:e.bounds.height-f,width:l,height:f}}drawSelf(e){const t=this.plot.seriesArray(),s=this.sampleSize,i=this.padding,r=this.widthSnapping;let a=i,n=i;e.clearRect(0,0,this.visual.width,this.visual.height);for(let l=0;l<t.length;l++){const o=t[l];e.fillStyle=o.colour,e.fillRect(a,n,s.width,s.height),a+=s.width+i,e.textBaseline="middle",e.fillText(o.name,a,n+s.height/2),a+=z(e,o.name,i,r),o.tooltip&&(e.fillStyle=this.plot.axisColour,e.fillText(o.tooltip,a,n+s.height/2),a+=z(e,o.tooltip,i,r)),a+=i,a>this.visual.width-100&&(a=i,n+=s.height+i+i)}}onNotify(e,t){e==="measureApplied"&&t===this._parent.axisY&&(this._needsLayout=!0)}},oi=class extends R{constructor(e){super(e,e.canvasEl,"AxisX");this.plot=e,d(this,"paddingPx",2),d(this,"colour")}clear(){}onNotify(e,t){e==="measureApplied"&&t===this.plot.axisY&&(this._needsLayout=!0),e==="measureApplied"&&t===this.plot.legend&&this.onLayoutNeeded()}drawSelf(e){const t=this.plot,s=this.visual,i=t.axisWidth,r=this.colour??t.axisColour;e.strokeStyle=r,e.clearRect(0,0,s.width,s.height),e.beginPath(),e.lineWidth=i,e.moveTo(0,i/2),e.lineTo(s.width,i/2),e.stroke()}measureSelf(e,t){const s=this.plot,i=e.measurements.get("AxisY");if(i===void 0)return;const r=e.measurements.get("Legend");if(r===void 0)return;const a=s.axisWidth+this.paddingPx;return{x:i.size.width,y:e.bounds.height-a-r.size.height,width:e.bounds.width-i.size.width,height:a}}},Je=(e,t)=>e.max===t.max&&e.min===t.min,hi=e=>e.max===e.min,di=class extends R{constructor(e){super(e,e.canvasEl,"AxisY");this.plot=e,d(this,"_maxDigits",1),d(this,"seriesToShow"),d(this,"paddingPx",2),d(this,"colour"),d(this,"lastRange"),d(this,"lastPlotAreaHeight",0),this.lastRange={min:0,max:0}}clear(){this.lastRange={min:0,max:0},this.lastPlotAreaHeight=0}measurePreflight(){const e=this.getSeries();e!==void 0&&!Je(e.visualRange,this.lastRange)&&(this._needsLayout=!0,this.needsDrawing=!0)}onNotify(e,t){const s=this.plot.plotArea;e==="measureApplied"&&t===s&&s.visual.height!==this.lastPlotAreaHeight&&(this.lastPlotAreaHeight=s.visual.height,this.needsDrawing=!0)}measureSelf(e){const t=e,s=this.paddingPx;let i=this.plot.axisWidth+s;const r=this.getSeries();if(r!==void 0){const n=r.visualRange;this._maxDigits=Math.ceil(n.max).toString().length+r.precision+1;const l="9".repeat(this._maxDigits);i+=z(t.ctx,l,s*2)}const a=e.resolveToPx(this.desiredSize?.width,i);return{x:0,y:0,width:a,height:e.bounds.height}}drawSelf(e){const t=this.getSeries();if(t!==void 0)this.seriesAxis(t,e);else{if(this.seriesToShow===void 0)return;console.warn(`Plot AxisY series '${this.seriesToShow}' is missing.`)}}getSeries(){return this.seriesToShow===void 0?this.plot.seriesArray()[0]:this.plot.series.get(this.seriesToShow)}seriesAxis(e,t){const s=this.plot,i=s.plotArea,r=this.visual,a=this.paddingPx,n=e.visualRange,l=s.axisWidth,o=this.colour??s.axisColour;if(t.strokeStyle=o,t.fillStyle=o,Number.isNaN(n.min)&&Number.isNaN(n.max))return;this.lastRange=n,t.clearRect(0,0,r.width,r.height),t.beginPath(),t.lineWidth=l;const h=r.width-l/2;t.moveTo(h,i.paddingPx+l),t.lineTo(h,i.visual.height+l),t.stroke(),t.textBaseline="top";const c=r.width-a*4;hi(n)?j(t,e.formatValue(n.max),f=>[c-f.width,i.computeY(e,n.max)-a*4]):(j(t,e.formatValue(n.max),f=>[c-f.width,i.computeY(e,n.max)+l/2]),j(t,e.formatValue(n.min),f=>[c-f.width,i.computeY(e,n.min)-5]))}},j=(e,t,s)=>{const i=e.measureText(t),r=s(i);e.fillText(t,r[0],r[1])},ui=class extends R{constructor(e,t={}){if(e===void 0)throw new Error("canvasEl undefined");super(void 0,e,"Plot");d(this,"plotArea"),d(this,"legend"),d(this,"axisX"),d(this,"axisY"),d(this,"axisColour"),d(this,"axisWidth"),d(this,"series"),d(this,"_frozen",!1),d(this,"defaultSeriesOpts"),t.autoSize&&Se(e,s=>{this.update(!0)}),this.axisColour=t.axisColour??"black",this.axisWidth=t.axisWidth??3,this.series=new Map,this.plotArea=new ni(this),this.legend=new li(this),this.axisX=new oi(this),this.axisY=new di(this)}clear(){this.series=new Map,this.plotArea.clear(),this.legend.clear(),this.axisX.clear(),this.axisY.clear(),this.update(!0)}get frozen(){return this._frozen}set frozen(e){this._frozen=e,e?(this.canvasEl.classList.add("frozen"),this.canvasEl.title="Plot frozen. Tap to unfreeze"):(this.canvasEl.title="",this.canvasEl.classList.remove("frozen"))}seriesArray(){return[...this.series.values()]}get seriesLength(){return this.series.size}plot(e){lt(e).forEach(s=>{let i=this.series.get(s);i===void 0&&(i=this.createSeries(s,"stream"),i.drawingStyle="line"),i.add(ot(e,s))})}createSeriesFromObject(e,t=""){const s=Object.keys(e),i=r=>{const a=e[r];return typeof a=="object"?this.createSeriesFromObject(a,t+r+"."):typeof a=="number"?[this.createSeries(r,"stream")]:[]};return s.flatMap(i)}createSeries(e,t="array",s){const i=this.seriesLength;if(e===void 0&&(e=`series-${i}`),this.series.has(e))throw new Error(`Series name '${e}' already in use`);let r={colour:`hsl(${i*25%360}, 70%,50%)`,...s};this.defaultSeriesOpts&&(r={...this.defaultSeriesOpts,...r});const a=new ai(e,t,this,r);return this.series.set(e,a),this.setReady(!0,!0),this.plotArea.needsDrawing=!0,a}},ne={};p(ne,{create:()=>ci});var ci=e=>new fi(e),N,D,T,M,fi=class{constructor(e){W(this,N,new Map),W(this,D,new Map),d(this,"fallbacks"),W(this,T,0),W(this,M,void 0),e!==void 0?this.fallbacks=e:this.fallbacks=["red","blue","green","orange"],$(this,M,document.body)}setElementBase(e){$(this,M,e)}add(e,t){A(this,N).set(e,t)}alias(e,t){A(this,D).set(e,t)}get(e,t){const s=A(this,D).get(e);s!==void 0&&(e=s);const i=A(this,N).get(e);if(i!==void 0)return i;const r="--"+e;let a=getComputedStyle(A(this,M)).getPropertyValue(r).trim();if(a===void 0||a.length===0){if(t!==void 0)return t;a=this.fallbacks[A(this,T)],Ct(this,T)._++,A(this,T)===this.fallbacks.length&&$(this,T,0)}return a}getOrAdd(e,t){if(this.has(e))return this.get(e);const s=this.get(e,t);return this.add(e,s),s}has(e){return A(this,N).has(e)}};N=new WeakMap;D=new WeakMap;T=new WeakMap;M=new WeakMap;var Ke={};p(Ke,{capture:()=>vi,frames:()=>gi});async function*gi(e,t={}){const s=t.maxIntervalMs??0,i=t.showCanvas??!1;let r=t.canvasEl,a,n;a=n=0,r===void 0&&(r=document.createElement("CANVAS"),i||(r.style.display="none"),document.body.appendChild(r));const l=()=>{r!==void 0&&(a=e.videoWidth,n=e.videoHeight,r.width=a,r.height=n)};let o=null;const h=ye(s);for await(const c of h){if((a===0||n===0)&&l(),a===0||n===0)continue;if(o===null&&(o=r.getContext("2d")),o===null)return;o.drawImage(e,0,0,a,n),yield o.getImageData(0,0,a,n)}}var vi=(e,t={})=>{const s=t.maxIntervalMs??0,i=t.showCanvas??!1,r=t.onFrame,a=e.videoWidth,n=e.videoHeight,l=document.createElement("CANVAS");i||(l.style.display="none"),l.width=a,l.height=n;let o=null,h;t.workerScript&&(h=new Worker(t.workerScript));const c=h||r;!c&&!i&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");const f=me(()=>{if(o===null&&(o=l.getContext("2d")),o===null)return;o.drawImage(e,0,0,a,n);let u;if(c&&(u=o.getImageData(0,0,a,n)),h&&h.postMessage({pixels:u.data.buffer,width:a,height:n,channels:4},[u.data.buffer]),r)try{r(u)}catch(g){console.error(g)}},s);return{start:()=>f.start(),cancel:()=>f.cancel(),canvasEl:l}};try{typeof window<"u"&&(window.ixfx={Drawing:X,Svg:K,Plot:re,Palette:ne,Colour:V})}catch{}var yi={};p(yi,{StateMachine:()=>Mt,continuously:()=>me,debounce:()=>yt,delay:()=>mt,delayLoop:()=>ye,forEach:()=>mi,forEachAsync:()=>wi,frequencyTimer:()=>wt,frequencyTimerSource:()=>St,interval:()=>xt,msElapsedTimer:()=>pt,relativeTimer:()=>bt,repeat:()=>Si,retry:()=>Pt,sleep:()=>O,throttle:()=>At,ticksElapsedTimer:()=>kt,timeout:()=>Et,updateOutdated:()=>_t,waitFor:()=>Tt});var mi=(e,t)=>{for(const s of e){const i=t(s);if(typeof i=="boolean"&&!i)break}},wi=async function(e,t,s){if(Array.isArray(e))for(const i of e){const r=await t(i);if(s&&await O(s),typeof r=="boolean"&&!r)break}else for await(const i of e){const r=await t(i);if(s&&await O(s),typeof r=="boolean"&&!r)break}},Si=(e,t)=>{let s,i;s=i=0;const r=[];if(typeof e=="number")for(Nt(e,"positive","countOrPredicate");e-- >0;){s++;const a=t();a!==void 0&&(r.push(a),i++)}else for(;e(s,i);){s++;const a=t();a!==void 0&&(r.push(a),i++)}return r};export{X as D,re as P,xe as S,ne as a,K as b,yi as f,It as m,Si as r};
