import{b as Qe,c as et,C as F,I as tt,S as le,g as ve,i as ye,e as it,o as D,f as st,r as rt,h as N,p as Y,j as nt,k as at,l as X,m as he,n as ot,q as lt,s as de,t as ce,u as ht,v as dt,w as ct,x as ut,y as ft,z as me,A as gt,D as xe,E as vt,F as yt,G as mt,H as ue,J as xt,K as fe,L as wt}from"./chunk-V24WECPW.c3e6523e.js";import{_ as A,t as pt,a as Z}from"./chunk-7KTY42OF.629611b4.js";import{S as we,r as K,p as pe,g as St,a as bt}from"./chunk-IHDSSOYZ.47df1e9b.js";var Q={};A(Q,{capture:()=>At,frames:()=>Pt,manualCapture:()=>_t});async function*Pt(e,t={}){const i=t.maxIntervalMs??0,s=t.showCanvas??!1;let r=t.canvasEl,n,a;n=a=0,r===void 0&&(r=document.createElement("CANVAS"),r.classList.add("ixfx-frames"),s||(r.style.display="none"),document.body.appendChild(r));const o=()=>{r!==void 0&&(n=e.videoWidth,a=e.videoHeight,r.width=n,r.height=a)};let l=null;const h=Qe(i);for await(const d of h){if((n===0||a===0)&&o(),n===0||a===0)continue;if(l===null&&(l=r.getContext("2d")),l===null)return;l.drawImage(e,0,0,n,a),yield l.getImageData(0,0,n,a)}}var At=(e,t={})=>{const i=t.maxIntervalMs??0,s=t.showCanvas??!1,r=t.onFrame,n=e.videoWidth,a=e.videoHeight,o=document.createElement("CANVAS");o.classList.add("ixfx-capture"),s||(o.style.display="none"),o.width=n,o.height=a;let l=null,h;t.workerScript&&(h=new Worker(t.workerScript));const d=h||r;!d&&!s&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");const c=et(()=>{if(l===null&&(l=o.getContext("2d")),l===null)return;l.drawImage(e,0,0,n,a);let u;if(d&&(u=l.getImageData(0,0,n,a)),h&&h.postMessage({pixels:u.data.buffer,width:n,height:a,channels:4},[u.data.buffer]),r)try{r(u)}catch(f){console.error(f)}},i);return{start:()=>c.start(),cancel:()=>c.cancel(),canvasEl:o}},_t=(e,t={})=>{const i=t.showCanvas??!1,s=e.videoWidth,r=e.videoHeight,n=t.canvasEl!==void 0;let a=t.canvasEl;return a||(a=document.createElement("CANVAS"),a.classList.add("ixfx-capture"),document.body.append(a),i||(a.style.display="none")),a.width=s,a.height=r,{canvasEl:a,capture:()=>{let d;if(d||(d=a?.getContext("2d",{willReadFrequently:!0})),!d)throw new Error("Could not create graphics context");d.drawImage(e,0,0,s,r);const c=d.getImageData(0,0,s,r);return c.currentTime=e.currentTime,t.postCaptureDraw&&t.postCaptureDraw(d,s,r),c},dispose:()=>{if(!n)try{a?.remove()}catch{}}}},Rt={};A(Rt,{BipolarView:()=>$e,Colour:()=>F,Drawing:()=>$,ImageDataGrid:()=>tt,Palette:()=>ne,Plot2:()=>se,PlotOld:()=>je,SceneGraph:()=>re,Svg:()=>we,Video:()=>Q,scaleCanvas:()=>We});var $={};A($,{arc:()=>Pe,bezier:()=>_e,circle:()=>te,connectedPoints:()=>q,copyToImg:()=>Mt,dot:()=>b,drawingStack:()=>E,ellipse:()=>Et,getContext:()=>be,line:()=>ie,lineThroughPoints:()=>Lt,makeHelper:()=>Ct,paths:()=>Ae,pointLabels:()=>G,rect:()=>Ce,textBlock:()=>ke,textBlockAligned:()=>Bt,textHeight:()=>Wt,textRect:()=>U,textWidth:()=>H,translatePoint:()=>zt,triangle:()=>Nt});var Se=Math.PI*2,be=e=>{if(e===null)throw new Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw new Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");const t=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?K(e).getContext("2d"):e;if(t===null)throw new Error("Could not create 2d context for canvas");return t},Ct=(e,t)=>{const i=be(e);return{paths(s,r){Ae(i,s,r)},line(s,r){ie(i,s,r)},rect(s,r){Ce(i,s,r)},bezier(s,r){_e(i,s,r)},connectedPoints(s,r){q(i,s,r)},pointLabels(s,r){G(i,s,r)},dot(s,r){b(i,s,r)},circle(s,r){te(i,s,r)},arc(s,r){Pe(i,s,r)},textBlock(s,r){r.bounds===void 0&&t!==void 0&&(r={...r,bounds:{...t,x:0,y:0}}),ke(i,s,r)}}},ee=e=>kt(e.strokeStyle,e.fillStyle),p=(e,t={},...i)=>{if(e===void 0)throw new Error("ctx undefined");const s=E(e).push(ee(t),...i);return s.apply(),s},Pe=(e,t,i={})=>{p(e,i);const s=n=>{e.beginPath(),e.arc(n.x,n.y,n.radius,n.startRadian,n.endRadian),e.stroke()},r=Array.isArray(t)?t:[t];for(const n of r)s(n)},kt=(e,t)=>s=>{t&&(s.fillStyle=t),e&&(s.strokeStyle=e)},Tt=(e,t,i)=>r=>{e&&(r.lineWidth=e),t&&(r.lineJoin=t),i&&(r.lineCap=i)},E=(e,t)=>(t===void 0&&(t=new le),{push:(...n)=>{t===void 0&&(t=new le);const a=t.push(...n);for(const o of n)o(e);return E(e,a)},pop:()=>{const n=t?.pop();return E(e,n)},apply:()=>{if(t===void 0)return E(e);for(const n of t.data)n(e);return E(e,t)}}),Lt=(e,t,i)=>{p(e,i),e.moveTo(t[0].x,t[0].y);for(const[s,r]of t.entries()){if(s+2>=t.length)continue;const n=t[s+1],a={x:(r.x+n.x)/2,y:(r.y+n.y)/2},o=(a.x+r.x)/2,l=(a.x+n.x)/2;e.quadraticCurveTo(o,n.y,a.x,a.y),e.quadraticCurveTo(l,n.y,n.x,n.y)}},te=(e,t,i={})=>{p(e,i);const s=r=>{e.beginPath(),e.arc(r.x,r.y,r.radius,0,Se),i.strokeStyle&&e.stroke(),i.fillStyle&&e.fill()};if(Array.isArray(t))for(const r of t)s(r);else s(t)},Et=(e,t,i={})=>{p(e,i);const s=n=>{e.beginPath();const a=n.rotation??0,o=n.startAngle??0,l=n.endAngle??Se;e.ellipse(n.x,n.y,n.radiusX,n.radiusY,a,o,l),i.strokeStyle&&e.stroke(),i.fillStyle&&e.fill()},r=Array.isArray(t)?t:[t];for(const n of r)s(n)},Ae=(e,t,i={})=>{p(e,i);const s=r=>{if(ye(r))Re(e,r,i);else if(mt(r))ie(e,r,i);else throw new Error(`Unknown path type ${JSON.stringify(r)}`)};if(Array.isArray(t))for(const r of t)s(r);else s(t)},q=(e,t,i={})=>{const s=i.loop??!1;if(pt(t),t.length!==0){for(const[r,n]of t.entries())ve(n,`Index ${r}`);p(e,i),i.lineWidth&&(e.lineWidth=i.lineWidth),e.beginPath(),e.moveTo(t[0].x,t[0].y);for(const r of t)e.lineTo(r.x,r.y);s&&e.lineTo(t[0].x,t[0].y),(i.strokeStyle||i.strokeStyle===void 0&&i.fillStyle===void 0)&&e.stroke(),i.fillStyle&&e.fill()}},G=(e,t,i={},s)=>{if(t.length!==0){for(const[r,n]of t.entries())ve(n,`Index ${r}`);p(e,i);for(const[r,n]of t.entries()){const a=s!==void 0&&r<s.length?s[r]:r.toString();e.fillText(a.toString(),n.x,n.y)}}},zt=(e,t)=>{const i=e.getTransform();return{x:t.x*i.a+t.y*i.c+i.e,y:t.x*i.b+t.y*i.d+i.f}},Mt=e=>{const t=document.createElement("img");return t.src=e.toDataURL("image/jpeg"),t},b=(e,t,i)=>{i===void 0&&(i={});const s=i.radius??10;if(p(e,i),e.beginPath(),Array.isArray(t))for(const r of t)e.arc(r.x,r.y,s,0,2*Math.PI);else{const r=t;e.arc(r.x,r.y,s,0,2*Math.PI)}(i.filled||!i.outlined)&&e.fill(),i.outlined&&e.stroke()},_e=(e,t,i)=>{ye(t)?Re(e,t,i):it(t)&&It(e,t,i)},It=(e,t,i={})=>{let s=p(e,i);const{a:r,b:n,cubic1:a,cubic2:o}=t,l=i.debug??!1;e.beginPath(),e.moveTo(r.x,r.y),e.bezierCurveTo(a.x,a.y,o.x,o.y,n.x,n.y),e.stroke(),l&&(s=s.push(ee({...i,strokeStyle:D(i.strokeStyle??"silver",.6),fillStyle:D(i.fillStyle??"yellow",.4)})),s.apply(),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.stroke(),e.moveTo(n.x,n.y),e.lineTo(o.x,o.y),e.stroke(),e.fillText("a",r.x+5,r.y),e.fillText("b",n.x+5,n.y),e.fillText("c1",a.x+5,a.y),e.fillText("c2",o.x+5,o.y),b(e,a,{radius:3}),b(e,o,{radius:3}),b(e,r,{radius:3}),b(e,n,{radius:3}),s=s.pop(),s.apply())},Re=(e,t,i={})=>{const{a:s,b:r,quadratic:n}=t,a=i.debug??!1;let o=p(e,i);e.beginPath(),e.moveTo(s.x,s.y),e.quadraticCurveTo(n.x,n.y,r.x,r.y),e.stroke(),a&&(o=o.push(ee({...i,strokeStyle:D(i.strokeStyle??"silver",.6),fillStyle:D(i.fillStyle??"yellow",.4)})),q(e,[s,n,r]),e.fillText("a",s.x+5,s.y),e.fillText("b",r.x+5,r.y),e.fillText("h",n.x+5,n.y),b(e,n,{radius:3}),b(e,s,{radius:3}),b(e,r,{radius:3}),o=o.pop(),o.apply())},ie=(e,t,i={})=>{const s=i.debug??!1,r=Tt(i.lineWidth,i.lineJoin,i.lineCap);p(e,i,r);const n=a=>{const{a:o,b:l}=a;e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),s&&(e.fillText("a",o.x,o.y),e.fillText("b",l.x,l.y),b(e,o,{radius:5,strokeStyle:"black"}),b(e,l,{radius:5,strokeStyle:"black"})),e.stroke()};if(Array.isArray(t))for(const a of t)n(a);else n(t)},Nt=(e,t,i={})=>{p(e,i);const s=r=>{q(e,ue(r),{...i,loop:!0}),i.debug&&G(e,ue(r),void 0,["a","b","c"])};if(Array.isArray(t))for(const r of t)s(r);else s(t)},Ce=(e,t,i={})=>{p(e,i);const s=i.filled??i.fillStyle!==void 0,r=i.stroked??i.strokeStyle!==void 0,n=a=>{const o="x"in a?a.x:0,l="y"in a?a.y:0;s&&e.fillRect(o,l,a.width,a.height),(r??!0)&&e.strokeRect(o,l,a.width,a.height),i.debug&&G(e,xt(a),void 0,["NW","NE","SE","SW"])};if(Array.isArray(t))for(const a of t)n(a);else n(t)},H=(e,t,i=0,s)=>U(e,t,i,s).width,U=(e,t,i=0,s)=>{if(t==null||t.length===0)return st;const r=e.measureText(t);return{width:s?rt(r.width,s)+i:r.width+i,height:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent+i+i}},Wt=(e,t,i=0)=>U(e,t,i).height,ke=(e,t,i)=>{p(e,i);const s=i.anchorPadding??0,r=i.anchor,n=i.bounds??{x:0,y:0,width:1e6,height:1e6},a=t.map(f=>e.measureText(f)),o=a.map(f=>f.width),l=a.map(f=>f.actualBoundingBoxAscent+f.actualBoundingBoxDescent),h=Math.max(...o),d=l.reduce((f,m)=>f+m,0);let{x:c,y:u}=r;r.x+h>n.width?c=n.width-(h+s):c-=s,c<n.x&&(c=n.x+s),r.y+d>n.height?u=n.height-(d+s):u-=s,u<n.y&&(u=n.y+s);for(const[f,m]of t.entries())e.fillText(m,c,u),u+=l[f]},Bt=(e,t,i)=>{const{bounds:s}=i,{horiz:r="left",vert:n="top"}=i,a=typeof t=="string"?[t]:t;p(e,i),e.save(),e.translate(s.x,s.y),e.textAlign="left",e.textBaseline="top";const o=s.width/2,l=s.height/2,h=a.map(f=>e.measureText(f)),d=h.map(f=>f.actualBoundingBoxAscent+f.actualBoundingBoxDescent),c=d.reduce((f,m)=>f+m,0);let u=0;n==="center"?u=l-c/2:n==="bottom"&&(u=s.height-c);for(const[f,m]of a.entries()){let x=0;r==="center"?x=o-h[f].width/2:r==="right"&&(x=s.width-h[f].width),e.fillText(m,x,u),u+=d[f]}e.restore()},se={};A(se,{AxisX:()=>He,AxisY:()=>Fe,Legend:()=>Xe,Plot:()=>qt,PlotArea:()=>De,Series:()=>Ye});var O=e=>(typeof e=="function"&&(e=e()),Z(e,"percentage","v"),1-e),re={};A(re,{Box:()=>ze,CanvasBox:()=>M,CanvasLayoutState:()=>Ie,CanvasMeasureState:()=>Me,LayoutState:()=>Ee,MeasureState:()=>Le,boxRectFromPx:()=>Yt,boxRectFromRectPx:()=>Dt,boxUnitFromPx:()=>P});var P=e=>({type:"px",value:e}),Yt=(e,t,i,s)=>({x:P(e),y:P(t),width:P(i),height:P(s)}),Dt=e=>({x:P(e.x),y:P(e.y),width:P(e.width),height:P(e.height)}),B=(e,t)=>e.type==="px"&&t.type==="px"?e.value===t.value:!1,Xt=(e,t)=>e===void 0&&t===void 0?!0:!(e===void 0||t===void 0||e.x&&t.x&&!B(e.x,t.x)||e.y&&t.y&&!B(e.y,t.y)||e.width&&t.width&&!B(e.width,t.width)||e.height&&t.height&&!B(e.height,t.height)),Te=class{bounds;pass;constructor(e){this.bounds=e,this.pass=0}resolveToPx(e,t,i){if(e===void 0&&i!==void 0)return i;if(e!==void 0){if(e.type===void 0)throw new TypeError("Expected 'type' and 'value' fields. Type is missing");if(e.value===void 0)throw new TypeError("Expected 'type' and 'value' fields. Value is missing");if(e.type==="px")return e.value;if(e.type==="pc")return e.value*t;throw new Error(`Unknown unit type: ${e.type}`)}}resolveBox(e){if(e===void 0)return;const t=this.resolveToPx(e.x,this.bounds.width),i=this.resolveToPx(e.y,this.bounds.height),s=this.resolveToPx(e.width,this.bounds.width),r=this.resolveToPx(e.height,this.bounds.height);if(!s||!r)throw new TypeError("Expected width and height");if(t===void 0&&i===void 0)return Object.freeze({width:s,height:r});if(!t||!i)throw new TypeError("Expected x and y");return Object.freeze({x:t,y:i,width:s,height:r})}},Le=class extends Te{measurements;constructor(e){super(e);this.measurements=new Map}getActualSize(e){const t=this.measurements.get(e);if(t!==void 0&&!N(t.actual))return t.actual}whatIsMeasured(){return[...this.measurements.keys()]}},Ee=class extends Te{layouts;constructor(e){super(e);this.layouts=new Map}},ze=class{canvasRegion=Y;_desiredRect;_measuredSize;_layoutPosition;children=[];_parent;_idMap=new Map;debugLayout=!1;_visible=!0;_ready=!0;takesSpaceWhenInvisible=!1;_needsMeasuring=!0;_needsLayoutX=!0;_needsDrawing=!0;debugHue=nt();id;constructor(e,t){this.id=t,this._parent=e,e?.onChildAdded(this)}hasChild(e){const t=this.children.find(s=>s===e),i=this.children.find(s=>s.id===e.id);return t!==void 0||i!==void 0}notify(e,t){this.onNotify(e,t);for(const i of this.children)i.notify(e,t)}*getChildren(){return this.children.entries()}onNotify(e,t){}onChildAdded(e){if(e.hasChild(this))throw new Error("Recursive");if(e===this)throw new Error("Cannot add self as child");if(this.hasChild(e))throw new Error("Child already present");this.children.push(e),this._idMap.set(e.id,e),this.layoutInvalidated("Box.onChildAdded")}setReady(e,t=!1){if(this._ready=e,t)for(const i of this.children)i.setReady(e,t)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.layoutInvalidated("Box.set visible"))}get desiredRegion(){return this._desiredRect}set desiredRegion(e){Xt(e,this._desiredRect)||(this._desiredRect=e,this.layoutInvalidated("set desiredRegion"))}layoutInvalidated(e){if(e===void 0)debugger;this.debugLog(`layoutInvalidated ${e}`),this._needsMeasuring=!0,this._needsLayoutX=!0,this._needsDrawing=!0,this.notifyChildLayoutNeeded()}drawingInvalidated(e){this._needsDrawing=!0}notifyChildLayoutNeeded(){this._needsDrawing=!0,this._needsLayoutX=!0,this._needsMeasuring=!0,this._parent!==void 0&&this._parent.notifyChildLayoutNeeded()}get root(){return this._parent===void 0?this:this._parent.root}measurePreflight(){}measureApply(e){this._needsMeasuring=!1;const t=this._measuredSize===void 0?!0:!at(e.actual,this._measuredSize);t&&(this._needsLayoutX=!0),this._measuredSize={width:e.actual.width,height:e.actual.height};for(const i of e.children)i!==void 0&&i.ref.measureApply(i);return t&&this.root.notify("measureApplied",this),t}layoutApply(e){this._needsLayoutX=!1;const t=this._layoutPosition===void 0?!0:!X.isEqual(e.actual,this._layoutPosition);this._layoutPosition={x:e.actual.x,y:e.actual.y};for(const i of e.children)i!==void 0&&i.ref.layoutApply(i);return t&&this.root.notify("layoutApplied",this),t}debugLog(e){!this.debugLayout||console.log(this.id,e)}layoutStart(e,t,i,s){const r={ref:this,actual:X.Empty,children:[]};t.layouts.set(this.id,r);const n=this.layoutSelf(e,t,s);if(this.root.notify("laidout",this),n!==void 0&&(r.actual=n,r.children=this.children.map(a=>a.layoutStart(e,t,i,r)),!(he.withoutUndefined(r.children).length<this.children.length)))return r}layoutSelf(e,t,i){const s=t.resolveBox(this._desiredRect),r=s===void 0?0:"x"in s?s.x:0,n=s===void 0?0:"y"in s?s.y:0;if(r===void 0)debugger;if(n===void 0)debugger;return{x:r,y:n}}measureStart(e,t,i){this.measurePreflight();const s={ref:this,actual:fe,children:[]};if(e.measurements.set(this.id,s),!this._visible&&!this.takesSpaceWhenInvisible)s.actual=ot;else{let r=this._measuredSize;if((this._needsMeasuring||this._measuredSize===void 0)&&(r=this.measureSelf(e,i),this.root.notify("measured",this)),typeof r=="string")return;if(r===void 0)return;s.actual=r}if(s.children=this.children.map(r=>r.measureStart(e,t,s)),!(he.withoutUndefined(s.children).length<this.children.length))return s}measureSelf(e,t){let i=fe;const s=t?t.actual:e.bounds,r=e.resolveBox(this._desiredRect);return i=r?lt(r,s):s,N(i)?"Box.measureSelf - No size for box?":i}update(e,t=!1){if(e===void 0)throw new Error("context is undefined");if(!this._needsMeasuring&&!this._needsLayoutX&&!t)return;const[i,s]=this.updateBegin(e);let r=5,n=!1,a=!1;if(this._needsMeasuring||t){for(;r--;){const o=this.measureStart(i,t);if(o!==void 0){if(this.measureApply(o),!this._ready)return;n=!0}}n||this.debugLog("Ran out of measurement attempts")}if(this._needsLayoutX||t){const o=this.layoutStart(i,s,t);o===void 0?this.debugLog("Warning: could not layout"):(this.layoutApply(o),a=!0)}this.updateComplete(n,a)}},Me=class extends Le{ctx;constructor(e,t){super(e);if(this.ctx=t,t===void 0)throw new Error("ctx is undefined")}},Ie=class extends Ee{ctx;constructor(e,t){super(e);if(this.ctx=t,t===void 0)throw new Error("ctx is undefined")}},M=class Ne extends ze{bounds;constructor(t,i,s){super(t,i);this.bounds=s,this.debugLog(`CanvasBox ctor bounds: ${JSON.stringify(s)}`)}static fromCanvas(t){return new Ne(void 0,"canvas-box",t.getBoundingClientRect())}addEventHandlers(t){t.addEventListener("pointermove",i=>{const s={x:i.offsetX,y:i.offsetY};this.notifyPointerMove(s)}),t.addEventListener("pointerleave",i=>{this.notifyPointerLeave()}),t.addEventListener("click",i=>{const s={x:i.offsetX,y:i.offsetY};this.notifyClick(s)})}onClick(t){}notifyClick(t){if(!N(this.canvasRegion)&&de(this.canvasRegion,t)){const i=X.subtract(t,this.canvasRegion.x,this.canvasRegion.y);this.onClick(i);for(const s of this.children)s.notifyClick(i)}}notifyPointerLeave(){this.onPointerLeave();for(const t of this.children)t.notifyPointerLeave()}notifyPointerMove(t){if(!N(this.canvasRegion)&&de(this.canvasRegion,t)){const i=X.subtract(t,this.canvasRegion.x,this.canvasRegion.y);this.onPointerMove(i);for(const s of this.children)s.notifyPointerMove(i)}}onPointerLeave(){}onPointerMove(t){}update(t,i=!1){super.update(t,i),this.draw(t,i)}getBounds(){return this.bounds===void 0&&this._parent?this._parent.bounds:this.bounds}updateBegin(t){if(t===void 0)throw new Error("Context is undefined");let i=this.getBounds();return i===void 0&&(this.debugLog("No bounds for element or parent, using canvas bounds"),i={x:0,y:0,width:t.canvas.width,height:t.canvas.height}),[new Me(i,t),new Ie(i,t)]}updateComplete(t,i){this.canvasRegion=Y}measureApply(t){const i=super.measureApply(t);return i&&(this.canvasRegion=Y),i}layoutApply(t){const i=super.layoutApply(t);return i&&(this.canvasRegion=Y),i}draw(t,i=!1){if(this._needsDrawing||i){if(N(this.canvasRegion)){if(this._layoutPosition===void 0||this._measuredSize===void 0)return;this.canvasRegion={x:this._layoutPosition.x,y:this._layoutPosition.y,width:this._measuredSize.width,height:this._measuredSize.height}}this._needsLayoutX||this._needsMeasuring,t.save();const s=this.canvasRegion;t.translate(s.x,s.y),this.debugLayout&&(t.lineWidth=1,t.strokeStyle=`hsl(${this.debugHue}, 100%, 50%)`,t.strokeRect(0,0,s.width,s.height),t.fillStyle=t.strokeStyle,t.fillText(this.id,10,10,s.width),t.beginPath(),t.moveTo(0,0),t.lineTo(s.width,s.height),t.stroke()),this.drawSelf(t),this._needsDrawing=!1,t.restore()}for(const s of this.children)s.draw(t,i)}drawSelf(t){}},We=e=>{const t=K(e),i=window.devicePixelRatio;return t.style.width=t.width+"px",t.style.height=t.height+"px",t.width*=devicePixelRatio,t.height*=devicePixelRatio,{ctx:(()=>{const r=t.getContext("2d");if(r===null)throw new Error("Could not get drawing context");return r.save(),r.scale(i,i),r})(),element:t,bounds:t.getBoundingClientRect()}},Be=class{data;series;dirty=!1;type="array";_range;constructor(e){this.series=e,this.data=[],this.dirty=!0}clear(){this.set([]),this._range=void 0}set(e){this.data=e,this.dirty=!0}get length(){return this.data.length}get range(){if(!this.dirty&&this._range!==void 0)return this._range;this.dirty=!1;const e=xe(this.data);return this._range===void 0||e.max!==this._range.max||e.min!==this._range.min?(this._range=e,{...this._range,changed:!0}):{...this._range,changed:!1}}add(e){this.data=[...this.data,e],this.dirty=!0}},Ht=class extends Be{desiredDataPointMinWidth=5;add(e){const t=this.series.lastPxPerPt;if(t>-1&&t<this.desiredDataPointMinWidth){const i=Math.floor(this.desiredDataPointMinWidth/t),s=[...this.data.slice(i),e];super.set(s)}else super.add(e)}},Ye=class{constructor(e,t,i,s){if(this.plot=i,this.name=e,this.drawingStyle=s.drawingStyle??"line",this.colour=s.colour,this.width=s.width??3,this.axisRange=s.axisRange??{min:Number.NaN,max:Number.NaN},this._visualRange={...this.axisRange},this._visualRangeStretch=s.visualRangeStretch??!0,t==="array")this.source=new Be(this);else if(t==="stream")this.source=new Ht(this);else throw new Error("Unknown sourceType. Expected array|stream")}name;colour;source;drawingStyle;width=3;dataHitPoint;tooltip;precision=2;axisRange;lastPxPerPt=-1;_visualRange;_visualRangeStretch;formatValue(e){return e.toFixed(this.precision)}get visualRange(){let e=this._visualRange;const t=this.source.range;let i=!1;if(t.changed)if(this._visualRangeStretch){const s=Math.min(ce(e.min,t.min),t.min),r=Math.max(ce(e.max,t.max),t.max);(s!==e.min||r!==e.max)&&(e={min:s,max:r},i=!0)}else Ft(t,e)||(e=t,i=!0);return this._visualRange=e,{...e,changed:i}}scaleValue(e){if(this.source===void 0)return e;const t=this.visualRange;return t.changed&&this.plot.notify("range-change",this.plot.plotArea),t.min==t.max?.5:ht(e,t.min,t.max)}add(e){Z(e,"","value"),this.source.add(e),this.plot.plotArea.drawingInvalidated("Series.add")}clear(){this.source.clear(),this._visualRange={...this.axisRange},this.plot.plotArea.layoutInvalidated("Series.clear")}},De=class extends M{constructor(e,t){super(e,"PlotArea",t);this.plot=e}paddingPx=5;piPi=Math.PI*2;pointerDistanceThreshold=20;lastRangeChange=0;pointer;clear(){this.lastRangeChange=0,this.pointer=void 0}measureSelf(e,t){const i=e.getActualSize("AxisY"),s=this.paddingPx,r=e.getActualSize("Legend"),n=r?.height??0,a=e.getActualSize("AxisX"),o=a?.height??0;return i?r?a?{width:e.bounds.width-i.width-this.paddingPx,height:e.bounds.height-n-o-s}:"No AxisX":"No Legend":`No AxisY. Measured: ${e.whatIsMeasured().join(", ")}`}layoutSelf(e,t,i){const s=e.getActualSize("AxisY"),r=this.paddingPx;return{x:s?.width??0,y:r}}onNotify(e,t){e==="measureApplied"&&t===this.plot.axisY&&this.layoutInvalidated("PlotArea.onNotify measureApplied to axisY"),e==="laidout"&&t===this.plot.legend&&this.layoutInvalidated("PlotArea.onNotify laidout to legend")}onPointerLeave(){for(const e of this.plot.series.values())e.tooltip=void 0;this.pointer=void 0,this.plot.legend.drawingInvalidated("PlotArea.onPointerLeave")}onPointerMove(e){this.pointer=e,this.plot.legend.drawingInvalidated("PlotArea.onPointerMove")}measurePreflight(){this.updateTooltip()}updateTooltip(){const e=this.pointer;if(e!==void 0){for(const t of this.plot.series.values()){if(e===void 0){t.tooltip=void 0;return}if(t.dataHitPoint===void 0)return;const i=t.dataHitPoint(e);if(i[0]===void 0||i[1]>this.pointerDistanceThreshold)return;t.tooltip=t.formatValue(i[0].value)}this.plot.legend.drawingInvalidated("PlotArea.updateTooltip")}}drawSelf(e){if(this.plot.frozen)return;const t=this.plot.seriesArray();e.clearRect(0,-1,this.canvasRegion.width,this.canvasRegion.height);for(const i of t)if(i.source.type==="array"||i.source.type==="stream"){const s=i.source;if(s.data===void 0)return;const r=[...s.data];this.drawDataSet(i,r,e)}else console.warn(`Unknown data source type ${i.source.type}`)}computeY(e,t){const i=e.scaleValue(t);return O(i)*this.canvasRegion.height+this.paddingPx}drawDataSet(e,t,i){const s=this.paddingPx+e.width,r=dt(this.canvasRegion,s*2,s*3.5),n=r.width/t.length;e.lastPxPerPt=n;let a=s;i.strokeStyle=e.colour,i.lineWidth=e.width;const o=[];if(e.dataHitPoint=l=>{const h=o.map(u=>ct(l,u)),d=ut(...h);return[o[d],h[d]]},e.drawingStyle==="line"){let l=0;i.beginPath();for(let h=0;h<t.length;h++){const d=ft(e.scaleValue(t[h]));l=s+this.paddingPx+r.height*O(d),o.push({x:a,y:l,index:h,value:t[h]}),h==0?i.moveTo(a+n/2,l):i.lineTo(a+n/2,l),l>this.canvasRegion.height&&console.warn(`${l} h: ${this.canvasRegion.height}`),a+=n}i.strokeStyle=e.colour,i.stroke()}else if(e.drawingStyle==="dotted"){let l=0;i.fillStyle=e.colour;for(let h=0;h<t.length;h++){const d=e.scaleValue(t[h]);l=s+r.height*O(d),i.beginPath(),i.arc(a+n/2,l,e.width,0,this.piPi),i.fill(),o.push({radius:e.width,x:a,y:l,index:h,value:t[h]}),a+=n}}else if(e.drawingStyle==="bar"){i.fillStyle=e.colour;const l=Math.ceil(n*.1);for(let h=0;h<t.length;h++){const d=e.scaleValue(t[h]),c=r.height*d,u={x:a+l,y:r.height-c+s,width:n-l,height:c,index:h,value:t[h]};i.fillRect(u.x,u.y,u.width,u.height),o.push(u),a+=n}}}},Xe=class extends M{constructor(e,t){super(e,"Legend",t);this.plot=e}sampleSize={width:10,height:10};padding=3;widthSnapping=20;labelMeasurements=new Map;clear(){}layoutSelf(e,t,i){const r=e.getActualSize("AxisY")?.width??0,n=this._measuredSize?.height??0;return{x:r,y:t.bounds.height-n}}measureSelf(e,t){const i=this.plot.seriesArray(),s=this.sampleSize,r=this.padding,n=this.widthSnapping,a=e.ctx,l=e.measurements.get("AxisY")?.actual.width??0;let h=r,d=r;const c=e.bounds.width-l-r;let u=0;for(const f of i){const m=h;h+=s.width+r,a.textBaseline="middle";const x=U(a,f.name,r,n);h+=H(a,f.name,r,n),f.tooltip&&(h+=H(a,f.tooltip,r,n));const y={width:10,height:10,x:m,y:d};this.labelMeasurements.set(f.name,y),u=Math.min(s.height+r+r,x.height+r+r),h+=r,h>c&&(h=r,d+=u)}return{width:c,height:d+u}}drawSelf(e){const t=this.plot.seriesArray(),i=this.sampleSize,s=this.padding;this.debugLog("drawSelf"),e.clearRect(0,0,this.canvasRegion.width,this.canvasRegion.height);for(const r of t){const n=this.labelMeasurements.get(r.name);if(n===void 0)continue;let a=n.x;e.fillStyle=r.colour,e.fillRect(a,n.y,i.width,i.height),a+=i.width+s,e.textBaseline="middle",e.fillStyle=this.plot.legendTextColour,e.fillText(r.name,a,n.y+i.height/2),r.tooltip&&(e.fillStyle=this.plot.legendTextColour,e.fillText(r.tooltip,n.x,n.y+i.height/2))}}onNotify(e,t){this.debugLog(`onNotify ${e} source: ${t.id}`),e==="measureApplied"&&t===this._parent.axisY&&this.layoutInvalidated("Legend.onNotify measureApplied to axisY")}},He=class extends M{constructor(e,t){super(e,"AxisX",t);this.plot=e}paddingPx=2;colour;clear(){}onNotify(e,t){e==="measureApplied"&&t===this.plot.axisY&&this.layoutInvalidated("AxisX.onNotify measureApplied to axisY")}drawSelf(e){const t=this.plot,i=this.canvasRegion,s=t.axisStrokeWidth,r=this.colour??t.axisStrokeColour;e.strokeStyle=r,e.clearRect(0,0,i.width,i.height),e.beginPath(),e.lineWidth=s,e.moveTo(0,s/2),e.lineTo(i.width,s/2),e.stroke()}measureSelf(e,t){const i=this.plot,s=this.paddingPx,n=e.measurements.get("AxisY")?.actual.width??0,a=0,o=i.axisStrokeWidth+a+s+s;return{width:e.bounds.width-n-s,height:o}}layoutSelf(e,t,i){const s=e.measurements.get("AxisY"),n=e.getActualSize("Legend")?.height??0,a=s?.actual.width??0,o=this._measuredSize?.height??0;return{x:a,y:e.bounds.height-o-n}}},Ft=(e,t)=>e.max===t.max&&e.min===t.min,$t=e=>e.max===e.min,Fe=class extends M{constructor(e,t){super(e,"AxisY",t);this.plot=e,this.lastRange={min:0,max:0}}_maxDigits=1;seriesToShow;paddingPx=2;colour;lastRange;lastPlotAreaHeight=0;clear(){this.lastRange={min:0,max:0},this.lastPlotAreaHeight=0}measurePreflight(){}onNotify(e,t){const i=this.plot.plotArea;if(e==="range-change"){this.drawingInvalidated("range-change");return}e==="measureApplied"&&t===i&&i.canvasRegion.height!==this.lastPlotAreaHeight&&(this.lastPlotAreaHeight=i.canvasRegion.height,this.drawingInvalidated("AxisY.onNotify height change"))}measureSelf(e){if(e.ctx===void 0)throw new Error("opts.ctx is undefined");const t=this.paddingPx;let i=this.plot.axisStrokeWidth+t;const s=this.getSeries();if(s!==void 0){const n=s.visualRange;this._maxDigits=Math.ceil(n.max).toString().length+s.precision+1;const a="9".repeat(this._maxDigits);i+=H(e.ctx,a,t*2)}return{width:e.resolveToPx(this.desiredRegion?.width,i,i),height:e.bounds.height}}layoutSelf(e,t,i){return{x:0,y:0}}drawSelf(e){const t=this.getSeries();if(t===void 0){if(this.seriesToShow===void 0)return;console.warn(`Plot AxisY series '${this.seriesToShow}' is missing.`)}else this.seriesAxis(t,e)}getSeries(){return this.seriesToShow===void 0?this.plot.seriesArray()[0]:this.plot.series.get(this.seriesToShow)}seriesAxis(e,t){const i=this.plot,s=i.plotArea,r=this.canvasRegion,n=this.paddingPx,a=e.visualRange,o=i.axisStrokeWidth,l=this.colour??i.axisStrokeColour;if(t.strokeStyle=l,t.fillStyle=l,Number.isNaN(a.min)&&Number.isNaN(a.max))return;this.lastRange=a,t.clearRect(0,0,r.width,r.height),t.beginPath(),t.lineWidth=o;const h=r.width-o/2;t.moveTo(h,s.paddingPx+o),t.lineTo(h,s.canvasRegion.height+n+o+o),t.stroke(),t.textBaseline="top";const d=r.width-n*4;t.fillStyle=i.axisTextColour,$t(a)?(this.debugLog("rangeSinglePoint"),V(t,e.formatValue(a.max),c=>[d-c.width,s.computeY(e,a.max)-n*4])):(V(t,e.formatValue(a.max),c=>[d-c.width,s.computeY(e,a.max)+o/2]),V(t,e.formatValue(a.min),c=>[d-c.width,s.computeY(e,a.min)-5]))}},V=(e,t,i)=>{if(e===void 0)throw new Error("ctx is undefined");const s=e.measureText(t),r=i(s);e.fillText(t,r[0],r[1])},qt=class extends M{plotArea;legend;axisX;axisY;axisStrokeColour;axisTextColour;legendTextColour;axisStrokeWidth;series;_frozen=!1;_canvasEl;_ctx;defaultSeriesOpts;constructor(e,t={}){const{ctx:i,element:s,bounds:r}=We(e);super(void 0,"Plot");this._canvasEl=s,this._ctx=i,t.autoSize&&pe(s,n=>{this.drawingInvalidated("resize"),this.layoutInvalidated("resize"),this.update(n.ctx,!0)}),this.axisStrokeColour=t.axisStrokeColour??"black",this.axisTextColour=t.axisTextColour??"black",this.legendTextColour=t.legendTextColour??"black",this.axisStrokeWidth=t.axisStrokeWidth??3,this.series=new Map,this.plotArea=new De(this,r),this.legend=new Xe(this,r),this.axisX=new He(this,r),this.axisY=new Fe(this,r)}update(e,t=!1){e===void 0&&(e=this._ctx),super.update(e,t)}clearSeries(){for(const e of this.series.values())e.clear();this.update()}clear(){this.series=new Map,this.plotArea.clear(),this.legend.clear(),this.axisX.clear(),this.axisY.clear(),this.layoutInvalidated("Plot.clear"),this.drawingInvalidated("Plot.clear"),this.update()}get frozen(){return this._frozen}set frozen(e){this._frozen=e,e?(this._canvasEl.classList.add("frozen"),this._canvasEl.title="Plot frozen. Tap to unfreeze"):(this._canvasEl.title="",this._canvasEl.classList.remove("frozen"))}seriesArray(){return[...this.series.values()]}get seriesLength(){return this.series.size}plot(e){const t=St(e,!0);let i=!1;for(const s of t){let r=this.series.get(s);r===void 0&&(r=this.createSeries(s,"stream"),r.drawingStyle="line",i=!0),r.add(bt(e,s))}i&&this.legend.layoutInvalidated("new series"),this.update()}createSeriesFromObject(e,t=""){const i=Object.keys(e),s=r=>{const n=e[r];return typeof n=="object"?this.createSeriesFromObject(n,`${t}${r}.`):typeof n=="number"?[this.createSeries(r,"stream")]:[]};return i.flatMap(r=>s(r))}createSeries(e,t="array",i){const s=this.seriesLength;if(e===void 0&&(e=`series-${s}`),this.series.has(e))throw new Error(`Series name '${e}' already in use`);let r={colour:`hsl(${s*25%360}, 70%,50%)`,...i};this.defaultSeriesOpts&&(r={...this.defaultSeriesOpts,...r});const n=new Ye(e,t,this,r);return this.series.set(e,n),this.setReady(!0,!0),this.plotArea.drawingInvalidated("Plot.createSeries"),n}},ne={};A(ne,{create:()=>Gt});var Gt=e=>new Ut(e),Ut=class{#t=new Map;#s=new Map;fallbacks;#e=0;#i;constructor(e){e!==void 0?this.fallbacks=e:this.fallbacks=["red","blue","green","orange"],this.#i=document.body}setElementBase(e){this.#i=e}add(e,t){this.#t.set(e,t)}alias(e,t){this.#s.set(e,t)}get(e,t){const i=this.#s.get(e);i!==void 0&&(e=i);const s=this.#t.get(e);if(s!==void 0)return s;const r="--"+e;let n=getComputedStyle(this.#i).getPropertyValue(r).trim();if(n===void 0||n.length===0){if(t!==void 0)return t;n=this.fallbacks[this.#e],this.#e++,this.#e===this.fallbacks.length&&(this.#e=0)}return n}getOrAdd(e,t){if(this.has(e))return this.get(e);const i=this.get(e,t);return this.add(e,i),i}has(e){return this.#t.has(e)}},$e={};A($e,{init:()=>Kt});var jt={};A(jt,{clamp:()=>R,fromScalar:()=>Ot,immutable:()=>L,random:()=>Zt,randomSource:()=>Ge,scale:()=>Vt,scaleClamped:()=>Jt,toScalar:()=>qe,towardZero:()=>Ue});var L=(e=0)=>{const t=typeof e=="number"?e:e.value;if(t>1)throw new Error("Cannot be larger than 1");if(t<-1)throw new Error("Cannot be smaller than -1");if(Number.isNaN(t))throw new Error("startingValue is NaN");const i=t;return{[Symbol.toPrimitive](s){return s==="number"?i:s==="string"?i.toString():!0},value:i,towardZero:s=>L(Ue(i,s)),add:s=>L(R(i+s)),multiply:s=>L(R(i*s)),inverse:()=>L(-i),interpolate:(s,r)=>L(R(wt(s,i,r))),asScalar:()=>qe(i)}},qe=e=>{if(typeof e!="number")throw new Error(`Expected v to be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw new Error("Parameter is NaN");return(e+1)/2},Ot=e=>(Z(e,"percentage","v"),e*2-1),Vt=(e,t,i)=>R(me(t,i,-1,1)(e)),Jt=(e,t,i)=>me(t,i,-1,1)(e),Ge=e=>{const t=gt(e);return()=>t()*2-1},Zt=e=>Ge(e)(),R=e=>{if(typeof e!="number")throw new Error(`Parameter must be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw new Error("v parameter is NaN");return e>1?1:e<-1?-1:e},Ue=(e,t)=>{if(typeof e!="number")throw new Error(`Parameter 'v' must be a number. Got: ${typeof e}`);if(typeof t!="number")throw new Error(`Parameter 'amt' must be a number. Got: ${typeof t}`);if(t<0)throw new Error("Parameter 'amt' must be positive");return e<0?(e+=t,e>0&&(e=0)):e>0&&(e-=t,e<0&&(e=0)),e};function ge(e,t,i){const s=e.getAttribute(t);return s===null?i:Number.parseInt(s)}var Kt=(e,t={})=>{const i=document.querySelector(e);if(!i)throw new Error(`Element query could not be found (${e})`);const s=t.labels??["x","y"],r=t.labelPrecision??2,n=t.asPercentages??!1,a=t.showWhiskers??!0,o=t.showDot??!0,l=t.showLabels??!0,h=t.axisColour??"silver",d=t.bgColour??"white",c=t.whiskerColour??"black",u=t.dotColour??c,f=t.labelColour??h,m=t.axisWidth??1*window.devicePixelRatio,x=t.dotRadius??5*window.devicePixelRatio,y=t.padding??10*window.devicePixelRatio,v=t.whiskerSize??5*window.devicePixelRatio,w=t.width??ge(i,"width",200)*window.devicePixelRatio,_=t.height??ge(i,"height",200)*window.devicePixelRatio;i.width=w,i.height=_,i.style.width=w/window.devicePixelRatio+"px",i.style.height=_/window.devicePixelRatio+"px";const W=_/2,k=w/2,g=i.getContext("2d");if(!g)throw new Error("Could not create drawing context");window.devicePixelRatio>=2&&(g.font="20px sans-serif");const oe=n?S=>Math.round(S*100)+"%":S=>S.toFixed(r);l?(s[0]=s[0]+":",s[1]=s[1]+":"):(s[0]="",s[1]="");const Ke=t.renderBackground??((S,T,I)=>{S.fillStyle=d,S.fillRect(0,0,T,I)});return(S,T)=>{S=R(S),T=R(T),Ke(g,w,_),g.fillStyle=f,g.textBaseline="top",g.save(),g.translate(k,W),g.rotate(-Math.PI/2),g.fillText((s[1]+" "+oe(T)).trim(),-k+y,1),g.restore(),g.fillText((s[0]+" "+oe(S)).trim(),y,k+2),g.strokeStyle=h,g.lineWidth=m,g.beginPath(),g.moveTo(y,W),g.lineTo(w-y,W),g.moveTo(k,y),g.lineTo(k,_-y),g.stroke(),g.closePath();const I=(_-y-y)/2*-T,j=(w-y-y)/2*S;g.save(),g.translate(k,W),o&&te(g,{radius:x,x:j,y:I},{fillStyle:u}),a&&(g.strokeStyle=c,g.beginPath(),g.moveTo(0,I-v),g.lineTo(0,I+v),g.moveTo(j-v,0),g.lineTo(j+v,0),g.stroke(),g.closePath()),g.restore()}},je={};A(je,{add:()=>Oe,calcScale:()=>ae,defaultAxis:()=>J,draw:()=>z,drawValue:()=>Ve,plot:()=>oi});var Qt=Math.PI*2,J=e=>({endWith:"none",lineWidth:1,namePosition:"none",name:e,showLabels:e==="y",showLine:!0,textSize:e==="y"?20:10}),ae=(e,t,i)=>{const s=[];for(const r of e.keys()){const n=[...e.get(r)];if(n.length===0)break;let{min:a,max:o}=xe(n),l=o-a,h;i!==void 0&&(h=i[r]),h==null&&(h=t.defaultSeriesVariable?F.getCssVariable("accent",t.defaultSeriesColour):t.defaultSeriesColour),l===0&&(l=a,a=a-l/2,o=o+l/2),s.push({min:a,max:o,range:l,name:r,colour:h})}return s},Oe=(e,t,i="")=>{e.addKeyedValues(i,t)},Ve=(e,t,i)=>{const s={...i,translucentPlot:!0,leadingEdgeDot:!1};z(t,s),i={...i,highlightIndex:e,leadingEdgeDot:!0,translucentPlot:!1,style:"none",clearCanvas:!1},z(t,i)},ei=(e,t,i)=>ae(e,i,i.seriesColours).map(s=>({...s,range:t[1]-t[0],min:t[0],max:t[1]})),z=(e,t)=>{const{x:i,y:s,ctx:r,canvasSize:n}=t,a=t.margin,o=t.y.scaleRange?ei(e,t.y.scaleRange,t):ae(e,t,t.seriesColours);t.clearCanvas&&r.clearRect(0,0,n.width,n.height),t.debug&&(r.strokeStyle="orange",r.strokeRect(0,0,n.width,n.height)),r.translate(a,a);const l=t.plotSize??Ze(n,t),h={height:l.height+a+a,width:l.width};if(s.showLabels||s.showLine){for(const c of o)s.allowedSeries!==void 0&&!s.allowedSeries.includes(c.name)||ti(c,h,t);o.length>0&&s.showLine&&ii(h,o[0],t)}if((i.showLabels||i.showLine)&&o.length>0){const c=s.labelRange?s.labelRange[0]:o[0].min;ri(l.width,C(c,o[0],l.height)+a+i.lineWidth,t)}const d={...t,plotSize:l};$.translatePoint(r,t.pointer);for(const c of o){const u=e.getSource(c.name);if(u===void 0)continue;let f=e.typeName==="circular"?u.pointer-1:u.length-1;t.highlightIndex!==void 0&&(f=t.highlightIndex),r.save(),r.translate(0,a+a),ni(c,u,l,d,f),r.restore()}t.showLegend&&(r.save(),r.translate(0,l.height+a+a+a),l.width,t.x.textSize+a+a,si(o,t),r.restore()),r.resetTransform()},ti=(e,t,i)=>{const{ctx:s,y:r,digitsPrecision:n,margin:a}=i,{height:o}=t;i.debug&&(s.strokeStyle="purple",s.strokeRect(0,0,r.textSize,o+a)),s.fillStyle=e.colour.length>0?e.colour:"white",r.colour&&(s.fillStyle=r.colour);const l=r.labelRange?r.labelRange[0]:e.min,h=r.labelRange?r.labelRange[1]:e.max,d=r.labelRange?h-l:e.range,c=l+d/2,u=i.textHeight/2;s.textBaseline="top",s.fillText(l.toFixed(n),0,C(l,e,o)-u),s.fillText(c.toFixed(n),0,C(c,e,o)-u),s.fillText(h.toFixed(n),0,C(h,e,o)-a),s.translate(r.textSize+a,0)},ii=(e,t,i)=>{if(t===void 0)throw new Error("series undefined");const{ctx:s,y:r}=i,{height:n}=e,a=r.labelRange?r.labelRange[0]:t.min,o=r.labelRange?r.labelRange[1]:t.max,l=C(a,t,n),h=C(o,t,n);s.translate(r.lineWidth,0),s.lineWidth=r.lineWidth,s.beginPath(),s.moveTo(0,l),s.lineTo(0,h),s.strokeStyle=t.colour,r.colour&&(s.strokeStyle=r.colour),s.stroke(),s.translate(r.lineWidth,0)},si=(e,t,i)=>{const{ctx:s}=t,r=10;let n=0;const a=t.margin*3,o=t.margin;s.lineWidth=t.lineWidth;for(const l of e){s.moveTo(n,a),s.strokeStyle=l.colour,s.lineTo(n+r,a),s.stroke(),n+=r+t.margin;let h=l.name;l.lastValue&&(h+=" "+l.lastValue.toFixed(t.digitsPrecision));const d=s.measureText(h);s.fillStyle=l.colour,s.fillText(h,n,o),n+=d.width}},ri=(e,t,i)=>{const{ctx:s,x:r,y:n}=i;!r.showLine||(r.colour&&(s.strokeStyle=r.colour),s.lineWidth=r.lineWidth,s.beginPath(),s.moveTo(0,t),s.lineTo(e,t),s.stroke())},ni=(e,t,i,s,r)=>{const{ctx:n,lineWidth:a,translucentPlot:o=!1,margin:l,x:h}=s,d=s.style??"connected",c=i.height-l;let u=1;if(h.scaleRange){const v=h.scaleRange[1]-h.scaleRange[0];u=i.width/v}else u=s.capacity===0?i.width/t.length:i.width/s.capacity;const f=s.coalesce&&u<0?Math.floor(1/u):1;let m=0,x;s.debug&&(n.strokeStyle="green",n.strokeRect(0,0,i.width,i.height));const y=v=>o?F.opacity(v,.2):v;d==="dots"?n.fillStyle=y(e.colour):d==="none"||(n.beginPath(),n.lineWidth=a,n.strokeStyle=y(e.colour));for(let v=0;v<t.length;v+=f){const w=C(t[v],e,c)-1;d==="dots"?(n.beginPath(),n.arc(m,w,a,0,Qt),n.fill()):d==="none"||(v==0&&n.moveTo(m,w),n.lineTo(m,w)),v===r&&(x={x:m,y:w},e.lastValue=t[v]),m+=u}d==="connected"&&n.stroke(),x!==void 0&&s.leadingEdgeDot&&(n.beginPath(),n.fillStyle=y(e.colour),n.arc(x.x,x.y,3,0,2*Math.PI),n.fill())},C=(e,t,i)=>(1-(e-t.min)/t.range)*i,Je=(e,t,i,s)=>{let r=e;i.showLabels&&(r+=i.textSize),i.showLine&&(r+=i.lineWidth),(i.showLabels||i.showLine)&&(r+=e+e);const n=e,a=e+e;let o=e+e;return o+=t.showLabels?t.textSize:e,t.showLine&&(o+=t.lineWidth),(t.showLabels||t.showLine)&&(o+=e),s&&(o+=t.textSize),{left:r,right:n,top:a,bottom:o}},Ze=(e,t)=>{const{width:i,height:s}=e,r=Je(t.margin,t.x,t.y,t.showLegend);return{width:i-r.left-r.right,height:s-r.top-r.bottom}},ai=(e,t)=>{const{width:i,height:s}=e,r=Je(t.margin,t.x,t.y,t.showLegend);return{width:i+r.left+r.right,height:s+r.top+r.bottom}},oi=(e,t)=>{if(e===null)throw new Error("parentElOrQuery is null. Expected string or element");const i=K(e);let s,r=!0,n=t.plotSize,a;i.nodeName==="CANVAS"?(s=i,r=!1,a={width:s.width,height:s.height}):(s=document.createElement("CANVAS"),i.append(s),n=t.plotSize,a={width:s.width,height:s.height});const o={x:0,y:0},l=v=>{o.x=v.offsetX,o.y=v.offsetY};s.addEventListener("pointermove",l);const h=s.getContext("2d"),d=t.capacity??10,c=d>0?vt({capacity:d}):yt(),u=h.measureText("Xy"),f=t.coalesce??!0;if(h===null)throw new Error("Drawing context not available");let m=J("x");t.x&&(m={...m,...t.x});let x=J("y");t.y&&(x={...x,...t.y});let y={...t,y:x,x:m,pointer:o,capacity:d,coalesce:f,plotSize:n,canvasSize:a,ctx:h,textHeight:t.textHeight??u.actualBoundingBoxAscent+u.actualBoundingBoxDescent,style:t.style??"connected",defaultSeriesColour:t.defaultSeriesColour??"yellow",margin:3,clearCanvas:!0,leadingEdgeDot:!0,debug:t.debug??!1,digitsPrecision:t.digitsPrecision??2,lineWidth:t.lineWidth??2,showLegend:t.showLegend??!1};if(n){const v=ai(n,y);s.width=v.width,s.height=v.height,y.canvasSize=v}return t.autoSizeCanvas&&pe(s,v=>{const w=v.bounds;y={...y,plotSize:Ze(w,y),canvasSize:w},z(c,y)}),{drawValue:v=>{Ve(v,c,y)},dispose:()=>{s.removeEventListener("pointermove",l),r&&s.remove()},add:(v,w="",_=!1)=>{Oe(c,v,w),!_&&z(c,y)},draw:()=>{z(c,y)},clear:()=>{c.clear()}}};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{SceneGraph:re,Plot2:se,Drawing:$,Svg:we,Palette:ne,Colour:F,Video:Q}})}catch{}export{jt as B,$ as D,je as P,ne as a,O as f,_t as m};
