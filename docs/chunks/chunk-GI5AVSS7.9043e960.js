import{_ as T,a as le,b as E,c as y,u as sf,d as Ao,e as Co,f as Z,s as af,g as of,i as Bn,o as _n}from"./chunk-ZTX6UONG.8be22e52.js";var uf={};T(uf,{SimpleEventEmitter:()=>Mt});var ze,lf=class{constructor(){le(this,ze,new Map)}add(e,...r){const n=E(this,ze).get(e);n===void 0?E(this,ze).set(e,r):E(this,ze).set(e,[...n,...r])}keys(){return E(this,ze).keys()}debugString(){let e="";return Array.from(E(this,ze).keys()).every(n=>{const i=E(this,ze).get(n);i!==void 0&&(e+=n+` (${i.length}) = ${JSON.stringify(i)}\r
`)}),e}get(e){return E(this,ze).get(e)}delete(e,r){const n=E(this,ze).get(e);if(n===void 0)return!1;const i=n.filter(s=>s!==r);return E(this,ze).set(e,i),i.length<n.length}clear(){E(this,ze).clear()}};ze=new WeakMap;var Fo=()=>new lf,sr,Mt=class{constructor(){le(this,sr,Fo())}fireEvent(e,r){const n=E(this,sr).get(e);n!==void 0&&n.forEach(i=>{try{i(r,this)}catch(s){console.debug("Event listener error: ",s)}})}addEventListener(e,r){E(this,sr).add(e,r)}removeEventListener(e,r){E(this,sr).delete(e,r)}clearEventListeners(){E(this,sr).clear()}};sr=new WeakMap;var So={};T(So,{setMutable:()=>ps});var ps=(e=void 0)=>new cf(e),cf=class extends Mt{constructor(e=void 0){super();y(this,"store",new Map),y(this,"keyString"),e===void 0&&(e=r=>typeof r=="string"?r:JSON.stringify(r)),this.keyString=e}add(...e){e.forEach(r=>{const n=this.has(r);this.store.set(this.keyString(r),r),super.fireEvent("add",{value:r,updated:n})})}values(){return this.store.values()}clear(){this.store.clear(),super.fireEvent("clear",!0)}delete(e){const r=this.store.delete(this.keyString(e));return r&&super.fireEvent("delete",e),r}has(e){return this.store.has(this.keyString(e))}toArray(){return Array.from(this.store.values())}},ms={};T(ms,{chunks:()=>hf,concat:()=>ff,dropWhile:()=>df,equals:()=>vf,every:()=>yf,fill:()=>pf,filter:()=>mf,find:()=>gf,flatten:()=>wf,forEach:()=>Df,map:()=>xf,max:()=>Ef,min:()=>bf,range:()=>Af,reduce:()=>Cf,slice:()=>Ff,some:()=>Sf,takeWhile:()=>Bf,toArray:()=>_f,unique:()=>Pf,zip:()=>Mf});async function*hf(e,r){let n=[];for await(const i of e)n.push(i),n.length===r&&(yield n,n=[]);n.length>0&&(yield n)}async function*ff(...e){for await(const r of e)yield*r}async function*df(e,r){for await(const n of e)if(!r(n)){yield n;break}yield*e}async function vf(e,r,n){const i=e[Symbol.iterator](),s=r[Symbol.iterator]();for(;;){const a=await i.next(),o=await s.next();if(n!==void 0){if(!n(a.value,o.value))return!1}else if(a.value!==o.value)return!1;if(a.done||o.done)return a.done&&o.done}}async function yf(e,r){let n=!0;for await(const i of e)n=n&&r(i);return n}async function*pf(e,r){for await(const n of e)yield r}async function*mf(e,r){for await(const n of e)!r(n)||(yield n)}async function gf(e,r){for await(const n of e)if(r(n))return n}async function*wf(e){for await(const r of e)Symbol.asyncIterator in r?yield*r:yield r}async function Df(e,r){for await(const n of e)r(n)}async function*xf(e,r){for await(const n of e)yield r(n)}async function Ef(e,r=(n,i)=>n>i){let n;for await(const i of e){if(!n){n=i;continue}n=r(n,i)?n:i}return n}async function bf(e,r=(n,i)=>n>i){let n;for await(const i of e){if(!n){n=i;continue}n=r(n,i)?i:n}return n}async function*Af(e,r){for(let n=0;n<r;n++)yield e++}async function Cf(e,r,n){for await(const i of e)n=r(n,i);return n}async function*Ff(e,r=0,n=Number.POSITIVE_INFINITY){const i=e[Symbol.asyncIterator]();for(;r>0;r--,n--)await i.next();for await(const s of e)if(n-- >0)yield s;else break}async function Sf(e,r){for await(const n of e)if(r(n))return!0;return!1}async function*Bf(e,r){for await(const n of e){if(!r(n))return;yield n}}async function _f(e,r=1/0){const n=[],i=e[Symbol.asyncIterator]();for(;n.length<r;){const{value:s,done:a}=await i.next();if(a)break;n.push(s)}return n}async function*Pf(e,r=n=>n){const n=[];for await(const i of e){const s=r(i);n.indexOf(s)===-1&&(n.push(s),yield i)}}async function*Mf(...e){const r=e.map(n=>n[Symbol.asyncIterator]());for(;;){const n=await Promise.all(r.map(i=>i.next()));if(n.some(i=>i.done))return;yield n.map(i=>i.value)}}var M=(e,r="",n="?")=>{if(typeof e>"u")throw new Error(`Parameter ${n} is undefined`);if(Number.isNaN(e))throw new Error(`Parameter '${n}' is NaN`);if(typeof e!="number")throw new Error(`Parameter '${n}' is not a number (${e})`);switch(r){case"positive":if(e<0)throw new Error(`Parameter '${n}' must be at least zero (${e})`);break;case"negative":if(e>0)throw new Error(`Parameter '${n}' must be zero or lower (${e})`);break;case"aboveZero":if(e<=0)throw new Error(`Parameter '${n}' must be above zero (${e})`);break;case"belowZero":if(e>=0)throw new Error(`Parameter '${n}' must be below zero (${e})`);break;case"percentage":if(e>1||e<0)throw new Error(`Parameter '${n}' must be in percentage range (0 to 1). (${e})`);break;case"nonZero":if(e===0)throw new Error(`Parameter '${n}' must non-zero. (${e})`);break;case"bipolar":if(e>1||e<-1)throw new Error(`Parameter '${n}' must be in bipolar percentage range (-1 to 1). (${e})`);break}return!0},Nf=(e,r="?")=>M(e,"percentage",r),ce=(e,r="",n="?")=>{if(M(e,r,n),!Number.isInteger(e))throw new Error(`Paramter ${n} is not an integer`)},zf=e=>Array.isArray(e)?e.find(r=>typeof r!="string")===void 0:!1,kf=(e,r="?")=>{if(!Array.isArray(e))throw new Error(`Parameter '${r}' is expected to be an array'`)},$f={};T($f,{IterableAsync:()=>ms,getFieldByPath:()=>Jn,getFieldPaths:()=>gs,ifNaN:()=>Ri,isEqualDefault:()=>Xr,isEqualValueDefault:()=>Po,isPowerOfTwo:()=>Bo,relativeDifference:()=>Tf,roundUpToMultiple:()=>_o,runningiOS:()=>If,toStringDefault:()=>Hr});var Ri=(e,r)=>Number.isNaN(e)?r:e,Bo=e=>Math.log2(e)%1===0,Tf=e=>r=>r/e,Jn=(e,r="")=>{if(r.length===0)return e;if(r in e)return e[r];{const n=sf(r,".");return n in e?Jn(e[n],r.substring(n.length+1)):void 0}},gs=e=>{const r=[],n=(i,s="")=>{if(typeof i=="object"){const a=Object.keys(i);s.length>0&&(s+="."),a.forEach(o=>n(i[o],s+o))}else r.push(s)};return n(e),r},_o=(e,r)=>(M(e,"nonZero","v"),M(r,"nonZero","muliple"),Math.ceil(e/r)*r),Xr=(e,r)=>e===r,Po=(e,r)=>e===r?!0:Hr(e)===Hr(r),Hr=e=>typeof e=="string"?e:JSON.stringify(e),If=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document;try{typeof window<"u"&&(window.ixfx={...window.ixfx,getFieldByPath:Jn,getFieldPaths:gs})}catch{}var Rf=Co({"node_modules/rxjs/node_modules/tslib/tslib.js"(e,r){var n,i,s,a,o,u,l,c,h,f,d,D,F,B,_,N,O,ee,P,I,Q,R,Y,te;(function(j){var pe=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(p){j(fe(pe,fe(p)))}):typeof r=="object"&&typeof r.exports=="object"?j(fe(pe,fe(r.exports))):j(fe(pe));function fe(p,m){return p!==pe&&(typeof Object.create=="function"?Object.defineProperty(p,"__esModule",{value:!0}):p.__esModule=!0),function(b,C){return p[b]=m?m(b,C):C}}})(function(j){var pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,m){p.__proto__=m}||function(p,m){for(var b in m)Object.prototype.hasOwnProperty.call(m,b)&&(p[b]=m[b])};n=function(p,m){if(typeof m!="function"&&m!==null)throw new TypeError("Class extends value "+String(m)+" is not a constructor or null");pe(p,m);function b(){this.constructor=p}p.prototype=m===null?Object.create(m):(b.prototype=m.prototype,new b)},i=Object.assign||function(p){for(var m,b=1,C=arguments.length;b<C;b++){m=arguments[b];for(var z in m)Object.prototype.hasOwnProperty.call(m,z)&&(p[z]=m[z])}return p},s=function(p,m){var b={};for(var C in p)Object.prototype.hasOwnProperty.call(p,C)&&m.indexOf(C)<0&&(b[C]=p[C]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var z=0,C=Object.getOwnPropertySymbols(p);z<C.length;z++)m.indexOf(C[z])<0&&Object.prototype.propertyIsEnumerable.call(p,C[z])&&(b[C[z]]=p[C[z]]);return b},a=function(p,m,b,C){var z=arguments.length,S=z<3?m:C===null?C=Object.getOwnPropertyDescriptor(m,b):C,H;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(p,m,b,C);else for(var oe=p.length-1;oe>=0;oe--)(H=p[oe])&&(S=(z<3?H(S):z>3?H(m,b,S):H(m,b))||S);return z>3&&S&&Object.defineProperty(m,b,S),S},o=function(p,m){return function(b,C){m(b,C,p)}},u=function(p,m){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(p,m)},l=function(p,m,b,C){function z(S){return S instanceof b?S:new b(function(H){H(S)})}return new(b||(b=Promise))(function(S,H){function oe(Fe){try{U(C.next(Fe))}catch(wt){H(wt)}}function je(Fe){try{U(C.throw(Fe))}catch(wt){H(wt)}}function U(Fe){Fe.done?S(Fe.value):z(Fe.value).then(oe,je)}U((C=C.apply(p,m||[])).next())})},c=function(p,m){var b={label:0,sent:function(){if(S[0]&1)throw S[1];return S[1]},trys:[],ops:[]},C,z,S,H;return H={next:oe(0),throw:oe(1),return:oe(2)},typeof Symbol=="function"&&(H[Symbol.iterator]=function(){return this}),H;function oe(U){return function(Fe){return je([U,Fe])}}function je(U){if(C)throw new TypeError("Generator is already executing.");for(;b;)try{if(C=1,z&&(S=U[0]&2?z.return:U[0]?z.throw||((S=z.return)&&S.call(z),0):z.next)&&!(S=S.call(z,U[1])).done)return S;switch(z=0,S&&(U=[U[0]&2,S.value]),U[0]){case 0:case 1:S=U;break;case 4:return b.label++,{value:U[1],done:!1};case 5:b.label++,z=U[1],U=[0];continue;case 7:U=b.ops.pop(),b.trys.pop();continue;default:if(S=b.trys,!(S=S.length>0&&S[S.length-1])&&(U[0]===6||U[0]===2)){b=0;continue}if(U[0]===3&&(!S||U[1]>S[0]&&U[1]<S[3])){b.label=U[1];break}if(U[0]===6&&b.label<S[1]){b.label=S[1],S=U;break}if(S&&b.label<S[2]){b.label=S[2],b.ops.push(U);break}S[2]&&b.ops.pop(),b.trys.pop();continue}U=m.call(p,b)}catch(Fe){U=[6,Fe],z=0}finally{C=S=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}},h=function(p,m){for(var b in p)b!=="default"&&!Object.prototype.hasOwnProperty.call(m,b)&&te(m,p,b)},te=Object.create?function(p,m,b,C){C===void 0&&(C=b),Object.defineProperty(p,C,{enumerable:!0,get:function(){return m[b]}})}:function(p,m,b,C){C===void 0&&(C=b),p[C]=m[b]},f=function(p){var m=typeof Symbol=="function"&&Symbol.iterator,b=m&&p[m],C=0;if(b)return b.call(p);if(p&&typeof p.length=="number")return{next:function(){return p&&C>=p.length&&(p=void 0),{value:p&&p[C++],done:!p}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},d=function(p,m){var b=typeof Symbol=="function"&&p[Symbol.iterator];if(!b)return p;var C=b.call(p),z,S=[],H;try{for(;(m===void 0||m-- >0)&&!(z=C.next()).done;)S.push(z.value)}catch(oe){H={error:oe}}finally{try{z&&!z.done&&(b=C.return)&&b.call(C)}finally{if(H)throw H.error}}return S},D=function(){for(var p=[],m=0;m<arguments.length;m++)p=p.concat(d(arguments[m]));return p},F=function(){for(var p=0,m=0,b=arguments.length;m<b;m++)p+=arguments[m].length;for(var C=Array(p),z=0,m=0;m<b;m++)for(var S=arguments[m],H=0,oe=S.length;H<oe;H++,z++)C[z]=S[H];return C},B=function(p,m,b){if(b||arguments.length===2)for(var C=0,z=m.length,S;C<z;C++)(S||!(C in m))&&(S||(S=Array.prototype.slice.call(m,0,C)),S[C]=m[C]);return p.concat(S||Array.prototype.slice.call(m))},_=function(p){return this instanceof _?(this.v=p,this):new _(p)},N=function(p,m,b){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var C=b.apply(p,m||[]),z,S=[];return z={},H("next"),H("throw"),H("return"),z[Symbol.asyncIterator]=function(){return this},z;function H(me){C[me]&&(z[me]=function(nt){return new Promise(function(_r,gi){S.push([me,nt,_r,gi])>1||oe(me,nt)})})}function oe(me,nt){try{je(C[me](nt))}catch(_r){wt(S[0][3],_r)}}function je(me){me.value instanceof _?Promise.resolve(me.value.v).then(U,Fe):wt(S[0][2],me)}function U(me){oe("next",me)}function Fe(me){oe("throw",me)}function wt(me,nt){me(nt),S.shift(),S.length&&oe(S[0][0],S[0][1])}},O=function(p){var m,b;return m={},C("next"),C("throw",function(z){throw z}),C("return"),m[Symbol.iterator]=function(){return this},m;function C(z,S){m[z]=p[z]?function(H){return(b=!b)?{value:_(p[z](H)),done:z==="return"}:S?S(H):H}:S}},ee=function(p){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=p[Symbol.asyncIterator],b;return m?m.call(p):(p=typeof f=="function"?f(p):p[Symbol.iterator](),b={},C("next"),C("throw"),C("return"),b[Symbol.asyncIterator]=function(){return this},b);function C(S){b[S]=p[S]&&function(H){return new Promise(function(oe,je){H=p[S](H),z(oe,je,H.done,H.value)})}}function z(S,H,oe,je){Promise.resolve(je).then(function(U){S({value:U,done:oe})},H)}},P=function(p,m){return Object.defineProperty?Object.defineProperty(p,"raw",{value:m}):p.raw=m,p};var fe=Object.create?function(p,m){Object.defineProperty(p,"default",{enumerable:!0,value:m})}:function(p,m){p.default=m};I=function(p){if(p&&p.__esModule)return p;var m={};if(p!=null)for(var b in p)b!=="default"&&Object.prototype.hasOwnProperty.call(p,b)&&te(m,p,b);return fe(m,p),m},Q=function(p){return p&&p.__esModule?p:{default:p}},R=function(p,m,b,C){if(b==="a"&&!C)throw new TypeError("Private accessor was defined without a getter");if(typeof m=="function"?p!==m||!C:!m.has(p))throw new TypeError("Cannot read private member from an object whose class did not declare it");return b==="m"?C:b==="a"?C.call(p):C?C.value:m.get(p)},Y=function(p,m,b,C,z){if(C==="m")throw new TypeError("Private method is not writable");if(C==="a"&&!z)throw new TypeError("Private accessor was defined without a setter");if(typeof m=="function"?p!==m||!z:!m.has(p))throw new TypeError("Cannot write private member to an object whose class did not declare it");return C==="a"?z.call(p,b):z?z.value=b:m.set(p,b),b},j("__extends",n),j("__assign",i),j("__rest",s),j("__decorate",a),j("__param",o),j("__metadata",u),j("__awaiter",l),j("__generator",c),j("__exportStar",h),j("__createBinding",te),j("__values",f),j("__read",d),j("__spread",D),j("__spreadArrays",F),j("__spreadArray",B),j("__await",_),j("__asyncGenerator",N),j("__asyncDelegator",O),j("__asyncValues",ee),j("__makeTemplateObject",P),j("__importStar",I),j("__importDefault",Q),j("__classPrivateFieldGet",R),j("__classPrivateFieldSet",Y)})}}),Lf=Co({"node_modules/json5/dist/index.js"(e,r){(function(n,i){typeof e=="object"&&typeof r<"u"?r.exports=i():typeof define=="function"&&define.amd?define(i):n.JSON5=i()})(e,function(){function n(v,g){return g={exports:{}},v(g,g.exports),g.exports}var i=n(function(v){var g=v.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=g)}),s=n(function(v){var g=v.exports={version:"2.6.5"};typeof __e=="number"&&(__e=g)});s.version;var a=function(v){return typeof v=="object"?v!==null:typeof v=="function"},o=function(v){if(!a(v))throw TypeError(v+" is not an object!");return v},u=function(v){try{return!!v()}catch{return!0}},l=!u(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),c=i.document,h=a(c)&&a(c.createElement),f=function(v){return h?c.createElement(v):{}},d=!l&&!u(function(){return Object.defineProperty(f("div"),"a",{get:function(){return 7}}).a!=7}),D=function(v,g){if(!a(v))return v;var k,$;if(g&&typeof(k=v.toString)=="function"&&!a($=k.call(v))||typeof(k=v.valueOf)=="function"&&!a($=k.call(v))||!g&&typeof(k=v.toString)=="function"&&!a($=k.call(v)))return $;throw TypeError("Can't convert object to primitive value")},F=Object.defineProperty,B=l?Object.defineProperty:function(g,k,$){if(o(g),k=D(k,!0),o($),d)try{return F(g,k,$)}catch{}if("get"in $||"set"in $)throw TypeError("Accessors not supported!");return"value"in $&&(g[k]=$.value),g},_={f:B},N=function(v,g){return{enumerable:!(v&1),configurable:!(v&2),writable:!(v&4),value:g}},O=l?function(v,g,k){return _.f(v,g,N(1,k))}:function(v,g,k){return v[g]=k,v},ee={}.hasOwnProperty,P=function(v,g){return ee.call(v,g)},I=0,Q=Math.random(),R=function(v){return"Symbol(".concat(v===void 0?"":v,")_",(++I+Q).toString(36))},Y=n(function(v){var g="__core-js_shared__",k=i[g]||(i[g]={});(v.exports=function($,L){return k[$]||(k[$]=L!==void 0?L:{})})("versions",[]).push({version:s.version,mode:"global",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),te=Y("native-function-to-string",Function.toString),j=n(function(v){var g=R("src"),k="toString",$=(""+te).split(k);s.inspectSource=function(L){return te.call(L)},(v.exports=function(L,G,K,Oe){var be=typeof K=="function";be&&(P(K,"name")||O(K,"name",G)),L[G]!==K&&(be&&(P(K,g)||O(K,g,L[G]?""+L[G]:$.join(String(G)))),L===i?L[G]=K:Oe?L[G]?L[G]=K:O(L,G,K):(delete L[G],O(L,G,K)))})(Function.prototype,k,function(){return typeof this=="function"&&this[g]||te.call(this)})}),pe=function(v){if(typeof v!="function")throw TypeError(v+" is not a function!");return v},fe=function(v,g,k){if(pe(v),g===void 0)return v;switch(k){case 1:return function($){return v.call(g,$)};case 2:return function($,L){return v.call(g,$,L)};case 3:return function($,L,G){return v.call(g,$,L,G)}}return function(){return v.apply(g,arguments)}},p="prototype",m=function(v,g,k){var $=v&m.F,L=v&m.G,G=v&m.S,K=v&m.P,Oe=v&m.B,be=L?i:G?i[g]||(i[g]={}):(i[g]||{})[p],Lt=L?s:s[g]||(s[g]={}),rr=Lt[p]||(Lt[p]={}),Ve,Ke,Be,nr;L&&(k=g);for(Ve in k)Ke=!$&&be&&be[Ve]!==void 0,Be=(Ke?be:k)[Ve],nr=Oe&&Ke?fe(Be,i):K&&typeof Be=="function"?fe(Function.call,Be):Be,be&&j(be,Ve,Be,v&m.U),Lt[Ve]!=Be&&O(Lt,Ve,nr),K&&rr[Ve]!=Be&&(rr[Ve]=Be)};i.core=s,m.F=1,m.G=2,m.S=4,m.P=8,m.B=16,m.W=32,m.U=64,m.R=128;var b=m,C=Math.ceil,z=Math.floor,S=function(v){return isNaN(v=+v)?0:(v>0?z:C)(v)},H=function(v){if(v==null)throw TypeError("Can't call method on  "+v);return v},oe=function(v){return function(g,k){var $=String(H(g)),L=S(k),G=$.length,K,Oe;return L<0||L>=G?v?"":void 0:(K=$.charCodeAt(L),K<55296||K>56319||L+1===G||(Oe=$.charCodeAt(L+1))<56320||Oe>57343?v?$.charAt(L):K:v?$.slice(L,L+2):(K-55296<<10)+(Oe-56320)+65536)}},je=oe(!1);b(b.P,"String",{codePointAt:function(g){return je(this,g)}}),s.String.codePointAt;var U=Math.max,Fe=Math.min,wt=function(v,g){return v=S(v),v<0?U(v+g,0):Fe(v,g)},me=String.fromCharCode,nt=String.fromCodePoint;b(b.S+b.F*(!!nt&&nt.length!=1),"String",{fromCodePoint:function(g){for(var k=arguments,$=[],L=arguments.length,G=0,K;L>G;){if(K=+k[G++],wt(K,1114111)!==K)throw RangeError(K+" is not a valid code point");$.push(K<65536?me(K):me(((K-=65536)>>10)+55296,K%1024+56320))}return $.join("")}}),s.String.fromCodePoint;var _r=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,gi=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Vh=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,wi={Space_Separator:_r,ID_Start:gi,ID_Continue:Vh},ye={isSpaceSeparator:function(g){return typeof g=="string"&&wi.Space_Separator.test(g)},isIdStartChar:function(g){return typeof g=="string"&&(g>="a"&&g<="z"||g>="A"&&g<="Z"||g==="$"||g==="_"||wi.ID_Start.test(g))},isIdContinueChar:function(g){return typeof g=="string"&&(g>="a"&&g<="z"||g>="A"&&g<="Z"||g>="0"&&g<="9"||g==="$"||g==="_"||g==="\u200C"||g==="\u200D"||wi.ID_Continue.test(g))},isDigit:function(g){return typeof g=="string"&&/[0-9]/.test(g)},isHexDigit:function(g){return typeof g=="string"&&/[0-9A-Fa-f]/.test(g)}},Di,Se,it,nn,Dt,qe,ge,xi,Pr,Wh=function(g,k){Di=String(g),Se="start",it=[],nn=0,Dt=1,qe=0,ge=void 0,xi=void 0,Pr=void 0;do ge=Hh(),Jh[Se]();while(ge.type!=="eof");return typeof k=="function"?Ga({"":Pr},"",k):Pr};function Ga(v,g,k){var $=v[g];if($!=null&&typeof $=="object")for(var L in $){var G=Ga($,L,k);G===void 0?delete $[L]:$[L]=G}return k.call(v,g,$)}var W,q,Mr,st,J;function Hh(){for(W="default",q="",Mr=!1,st=1;;){J=at();var v=Ja[W]();if(v)return v}}function at(){if(Di[nn])return String.fromCodePoint(Di.codePointAt(nn))}function x(){var v=at();return v===`
`?(Dt++,qe=0):v?qe+=v.length:qe++,v&&(nn+=v.length),v}var Ja={default:function(){switch(J){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":x();return;case"/":x(),W="comment";return;case void 0:return x(),ie("eof")}if(ye.isSpaceSeparator(J)){x();return}return Ja[Se]()},comment:function(){switch(J){case"*":x(),W="multiLineComment";return;case"/":x(),W="singleLineComment";return}throw se(x())},multiLineComment:function(){switch(J){case"*":x(),W="multiLineCommentAsterisk";return;case void 0:throw se(x())}x()},multiLineCommentAsterisk:function(){switch(J){case"*":x();return;case"/":x(),W="default";return;case void 0:throw se(x())}x(),W="multiLineComment"},singleLineComment:function(){switch(J){case`
`:case"\r":case"\u2028":case"\u2029":x(),W="default";return;case void 0:return x(),ie("eof")}x()},value:function(){switch(J){case"{":case"[":return ie("punctuator",x());case"n":return x(),It("ull"),ie("null",null);case"t":return x(),It("rue"),ie("boolean",!0);case"f":return x(),It("alse"),ie("boolean",!1);case"-":case"+":x()==="-"&&(st=-1),W="sign";return;case".":q=x(),W="decimalPointLeading";return;case"0":q=x(),W="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":q=x(),W="decimalInteger";return;case"I":return x(),It("nfinity"),ie("numeric",1/0);case"N":return x(),It("aN"),ie("numeric",NaN);case'"':case"'":Mr=x()==='"',q="",W="string";return}throw se(x())},identifierNameStartEscape:function(){if(J!=="u")throw se(x());x();var g=Ei();switch(g){case"$":case"_":break;default:if(!ye.isIdStartChar(g))throw Ya();break}q+=g,W="identifierName"},identifierName:function(){switch(J){case"$":case"_":case"\u200C":case"\u200D":q+=x();return;case"\\":x(),W="identifierNameEscape";return}if(ye.isIdContinueChar(J)){q+=x();return}return ie("identifier",q)},identifierNameEscape:function(){if(J!=="u")throw se(x());x();var g=Ei();switch(g){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!ye.isIdContinueChar(g))throw Ya();break}q+=g,W="identifierName"},sign:function(){switch(J){case".":q=x(),W="decimalPointLeading";return;case"0":q=x(),W="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":q=x(),W="decimalInteger";return;case"I":return x(),It("nfinity"),ie("numeric",st*(1/0));case"N":return x(),It("aN"),ie("numeric",NaN)}throw se(x())},zero:function(){switch(J){case".":q+=x(),W="decimalPoint";return;case"e":case"E":q+=x(),W="decimalExponent";return;case"x":case"X":q+=x(),W="hexadecimal";return}return ie("numeric",st*0)},decimalInteger:function(){switch(J){case".":q+=x(),W="decimalPoint";return;case"e":case"E":q+=x(),W="decimalExponent";return}if(ye.isDigit(J)){q+=x();return}return ie("numeric",st*Number(q))},decimalPointLeading:function(){if(ye.isDigit(J)){q+=x(),W="decimalFraction";return}throw se(x())},decimalPoint:function(){switch(J){case"e":case"E":q+=x(),W="decimalExponent";return}if(ye.isDigit(J)){q+=x(),W="decimalFraction";return}return ie("numeric",st*Number(q))},decimalFraction:function(){switch(J){case"e":case"E":q+=x(),W="decimalExponent";return}if(ye.isDigit(J)){q+=x();return}return ie("numeric",st*Number(q))},decimalExponent:function(){switch(J){case"+":case"-":q+=x(),W="decimalExponentSign";return}if(ye.isDigit(J)){q+=x(),W="decimalExponentInteger";return}throw se(x())},decimalExponentSign:function(){if(ye.isDigit(J)){q+=x(),W="decimalExponentInteger";return}throw se(x())},decimalExponentInteger:function(){if(ye.isDigit(J)){q+=x();return}return ie("numeric",st*Number(q))},hexadecimal:function(){if(ye.isHexDigit(J)){q+=x(),W="hexadecimalInteger";return}throw se(x())},hexadecimalInteger:function(){if(ye.isHexDigit(J)){q+=x();return}return ie("numeric",st*Number(q))},string:function(){switch(J){case"\\":x(),q+=Uh();return;case'"':if(Mr)return x(),ie("string",q);q+=x();return;case"'":if(!Mr)return x(),ie("string",q);q+=x();return;case`
`:case"\r":throw se(x());case"\u2028":case"\u2029":Yh(J);break;case void 0:throw se(x())}q+=x()},start:function(){switch(J){case"{":case"[":return ie("punctuator",x())}W="value"},beforePropertyName:function(){switch(J){case"$":case"_":q=x(),W="identifierName";return;case"\\":x(),W="identifierNameStartEscape";return;case"}":return ie("punctuator",x());case'"':case"'":Mr=x()==='"',W="string";return}if(ye.isIdStartChar(J)){q+=x(),W="identifierName";return}throw se(x())},afterPropertyName:function(){if(J===":")return ie("punctuator",x());throw se(x())},beforePropertyValue:function(){W="value"},afterPropertyValue:function(){switch(J){case",":case"}":return ie("punctuator",x())}throw se(x())},beforeArrayValue:function(){if(J==="]")return ie("punctuator",x());W="value"},afterArrayValue:function(){switch(J){case",":case"]":return ie("punctuator",x())}throw se(x())},end:function(){throw se(x())}};function ie(v,g){return{type:v,value:g,line:Dt,column:qe}}function It(v){for(var g=0,k=v;g<k.length;g+=1){var $=k[g],L=at();if(L!==$)throw se(x());x()}}function Uh(){var v=at();switch(v){case"b":return x(),"\b";case"f":return x(),"\f";case"n":return x(),`
`;case"r":return x(),"\r";case"t":return x(),"	";case"v":return x(),"\v";case"0":if(x(),ye.isDigit(at()))throw se(x());return"\0";case"x":return x(),Gh();case"u":return x(),Ei();case`
`:case"\u2028":case"\u2029":return x(),"";case"\r":return x(),at()===`
`&&x(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw se(x());case void 0:throw se(x())}return x()}function Gh(){var v="",g=at();if(!ye.isHexDigit(g)||(v+=x(),g=at(),!ye.isHexDigit(g)))throw se(x());return v+=x(),String.fromCodePoint(parseInt(v,16))}function Ei(){for(var v="",g=4;g-- >0;){var k=at();if(!ye.isHexDigit(k))throw se(x());v+=x()}return String.fromCodePoint(parseInt(v,16))}var Jh={start:function(){if(ge.type==="eof")throw Rt();bi()},beforePropertyName:function(){switch(ge.type){case"identifier":case"string":xi=ge.value,Se="afterPropertyName";return;case"punctuator":sn();return;case"eof":throw Rt()}},afterPropertyName:function(){if(ge.type==="eof")throw Rt();Se="beforePropertyValue"},beforePropertyValue:function(){if(ge.type==="eof")throw Rt();bi()},beforeArrayValue:function(){if(ge.type==="eof")throw Rt();if(ge.type==="punctuator"&&ge.value==="]"){sn();return}bi()},afterPropertyValue:function(){if(ge.type==="eof")throw Rt();switch(ge.value){case",":Se="beforePropertyName";return;case"}":sn()}},afterArrayValue:function(){if(ge.type==="eof")throw Rt();switch(ge.value){case",":Se="beforeArrayValue";return;case"]":sn()}},end:function(){}};function bi(){var v;switch(ge.type){case"punctuator":switch(ge.value){case"{":v={};break;case"[":v=[];break}break;case"null":case"boolean":case"numeric":case"string":v=ge.value;break}if(Pr===void 0)Pr=v;else{var g=it[it.length-1];Array.isArray(g)?g.push(v):g[xi]=v}if(v!==null&&typeof v=="object")it.push(v),Array.isArray(v)?Se="beforeArrayValue":Se="beforePropertyName";else{var k=it[it.length-1];k==null?Se="end":Array.isArray(k)?Se="afterArrayValue":Se="afterPropertyValue"}}function sn(){it.pop();var v=it[it.length-1];v==null?Se="end":Array.isArray(v)?Se="afterArrayValue":Se="afterPropertyValue"}function se(v){return an(v===void 0?"JSON5: invalid end of input at "+Dt+":"+qe:"JSON5: invalid character '"+Ka(v)+"' at "+Dt+":"+qe)}function Rt(){return an("JSON5: invalid end of input at "+Dt+":"+qe)}function Ya(){return qe-=5,an("JSON5: invalid identifier character at "+Dt+":"+qe)}function Yh(v){console.warn("JSON5: '"+Ka(v)+"' in strings is not valid ECMAScript; consider escaping")}function Ka(v){var g={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(g[v])return g[v];if(v<" "){var k=v.charCodeAt(0).toString(16);return"\\x"+("00"+k).substring(k.length)}return v}function an(v){var g=new SyntaxError(v);return g.lineNumber=Dt,g.columnNumber=qe,g}var Kh=function(g,k,$){var L=[],G="",K,Oe,be="",Lt;if(k!=null&&typeof k=="object"&&!Array.isArray(k)&&($=k.space,Lt=k.quote,k=k.replacer),typeof k=="function")Oe=k;else if(Array.isArray(k)){K=[];for(var rr=0,Ve=k;rr<Ve.length;rr+=1){var Ke=Ve[rr],Be=void 0;typeof Ke=="string"?Be=Ke:(typeof Ke=="number"||Ke instanceof String||Ke instanceof Number)&&(Be=String(Ke)),Be!==void 0&&K.indexOf(Be)<0&&K.push(Be)}}return $ instanceof Number?$=Number($):$ instanceof String&&($=String($)),typeof $=="number"?$>0&&($=Math.min(10,Math.floor($)),be="          ".substr(0,$)):typeof $=="string"&&(be=$.substr(0,10)),nr("",{"":g});function nr(ne,Ae){var V=Ae[ne];switch(V!=null&&(typeof V.toJSON5=="function"?V=V.toJSON5(ne):typeof V.toJSON=="function"&&(V=V.toJSON(ne))),Oe&&(V=Oe.call(Ae,ne,V)),V instanceof Number?V=Number(V):V instanceof String?V=String(V):V instanceof Boolean&&(V=V.valueOf()),V){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof V=="string")return on(V);if(typeof V=="number")return String(V);if(typeof V=="object")return Array.isArray(V)?rf(V):ef(V)}function on(ne){for(var Ae={"'":.1,'"':.2},V={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},xe="",We=0;We<ne.length;We++){var Ce=ne[We];switch(Ce){case"'":case'"':Ae[Ce]++,xe+=Ce;continue;case"\0":if(ye.isDigit(ne[We+1])){xe+="\\x00";continue}}if(V[Ce]){xe+=V[Ce];continue}if(Ce<" "){var jt=Ce.charCodeAt(0).toString(16);xe+="\\x"+("00"+jt).substring(jt.length);continue}xe+=Ce}var ot=Lt||Object.keys(Ae).reduce(function(xt,qt){return Ae[xt]<Ae[qt]?xt:qt});return xe=xe.replace(new RegExp(ot,"g"),V[ot]),ot+xe+ot}function ef(ne){if(L.indexOf(ne)>=0)throw TypeError("Converting circular structure to JSON5");L.push(ne);var Ae=G;G=G+be;for(var V=K||Object.keys(ne),xe=[],We=0,Ce=V;We<Ce.length;We+=1){var jt=Ce[We],ot=nr(jt,ne);if(ot!==void 0){var xt=tf(jt)+":";be!==""&&(xt+=" "),xt+=ot,xe.push(xt)}}var qt;if(xe.length===0)qt="{}";else{var un;if(be==="")un=xe.join(","),qt="{"+un+"}";else{var nf=`,
`+G;un=xe.join(nf),qt=`{
`+G+un+`,
`+Ae+"}"}}return L.pop(),G=Ae,qt}function tf(ne){if(ne.length===0)return on(ne);var Ae=String.fromCodePoint(ne.codePointAt(0));if(!ye.isIdStartChar(Ae))return on(ne);for(var V=Ae.length;V<ne.length;V++)if(!ye.isIdContinueChar(String.fromCodePoint(ne.codePointAt(V))))return on(ne);return ne}function rf(ne){if(L.indexOf(ne)>=0)throw TypeError("Converting circular structure to JSON5");L.push(ne);var Ae=G;G=G+be;for(var V=[],xe=0;xe<ne.length;xe++){var We=nr(String(xe),ne);V.push(We!==void 0?We:"null")}var Ce;if(V.length===0)Ce="[]";else if(be===""){var jt=V.join(",");Ce="["+jt+"]"}else{var ot=`,
`+G,xt=V.join(ot);Ce=`[
`+G+xt+`,
`+Ae+"]"}return L.pop(),G=Ae,Ce}},Xh={parse:Wh,stringify:Kh},Zh=Xh,Qh=Zh;return Qh})}}),Mo={};T(Mo,{button:()=>Yd,checkbox:()=>Gd,numeric:()=>Jd,select:()=>Kd,textAreaKeyboard:()=>Ud});var jf=Ao(Rf(),1),{__extends:Cr,__assign:c1,__rest:h1,__decorate:f1,__param:d1,__metadata:v1,__awaiter:qf,__generator:No,__exportStar:y1,__createBinding:p1,__values:Li,__read:wr,__spread:m1,__spreadArrays:g1,__spreadArray:Ur,__await:Ai,__asyncGenerator:Of,__asyncDelegator:w1,__asyncValues:Vf,__makeTemplateObject:D1,__importStar:x1,__importDefault:E1,__classPrivateFieldGet:b1,__classPrivateFieldSet:A1}=jf.default;function ue(e){return typeof e=="function"}function Wf(e){var r=function(i){Error.call(i),i.stack=new Error().stack},n=e(r);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Ci=Wf(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(i,s){return s+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ji(e,r){if(e){var n=e.indexOf(r);0<=n&&e.splice(n,1)}}var ws=function(){function e(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var r,n,i,s,a;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var u=Li(o),l=u.next();!l.done;l=u.next()){var c=l.value;c.remove(this)}}catch(B){r={error:B}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}else o.remove(this);var h=this.initialTeardown;if(ue(h))try{h()}catch(B){a=B instanceof Ci?B.errors:[B]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var d=Li(f),D=d.next();!D.done;D=d.next()){var F=D.value;try{Xa(F)}catch(B){a=a??[],B instanceof Ci?a=Ur(Ur([],wr(a)),wr(B.errors)):a.push(B)}}}catch(B){i={error:B}}finally{try{D&&!D.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}}if(a)throw new Ci(a)}},e.prototype.add=function(r){var n;if(r&&r!==this)if(this.closed)Xa(r);else{if(r instanceof e){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(r)}},e.prototype._hasParent=function(r){var n=this._parentage;return n===r||Array.isArray(n)&&n.includes(r)},e.prototype._addParent=function(r){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(r),n):n?[n,r]:r},e.prototype._removeParent=function(r){var n=this._parentage;n===r?this._parentage=null:Array.isArray(n)&&ji(n,r)},e.prototype.remove=function(r){var n=this._finalizers;n&&ji(n,r),r instanceof e&&r._removeParent(this)},e.EMPTY=function(){var r=new e;return r.closed=!0,r}(),e}();function zo(e){return e instanceof ws||e&&"closed"in e&&ue(e.remove)&&ue(e.add)&&ue(e.unsubscribe)}function Xa(e){ue(e)?e():e.unsubscribe()}var ko={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Hf={setTimeout:function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Ur([e,r],wr(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function $o(e){Hf.setTimeout(function(){throw e})}function Za(){}function Uf(e){e()}var Ds=function(e){Cr(r,e);function r(n){var i=e.call(this)||this;return i.isStopped=!1,n?(i.destination=n,zo(n)&&n.add(i)):i.destination=Kf,i}return r.create=function(n,i,s){return new qi(n,i,s)},r.prototype.next=function(n){this.isStopped||this._next(n)},r.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(n){this.destination.next(n)},r.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(ws),Gf=Function.prototype.bind;function Fi(e,r){return Gf.call(e,r)}var Jf=function(){function e(r){this.partialObserver=r}return e.prototype.next=function(r){var n=this.partialObserver;if(n.next)try{n.next(r)}catch(i){ln(i)}},e.prototype.error=function(r){var n=this.partialObserver;if(n.error)try{n.error(r)}catch(i){ln(i)}else ln(r)},e.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(n){ln(n)}},e}(),qi=function(e){Cr(r,e);function r(n,i,s){var a=e.call(this)||this,o;if(ue(n)||!n)o={next:n??void 0,error:i??void 0,complete:s??void 0};else{var u;a&&ko.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=function(){return a.unsubscribe()},o={next:n.next&&Fi(n.next,u),error:n.error&&Fi(n.error,u),complete:n.complete&&Fi(n.complete,u)}):o=n}return a.destination=new Jf(o),a}return r}(Ds);function ln(e){$o(e)}function Yf(e){throw e}var Kf={closed:!0,next:Za,error:Yf,complete:Za},xs=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Xf(e){return e}function Zf(e){return e.length===0?Xf:e.length===1?e[0]:function(n){return e.reduce(function(i,s){return s(i)},n)}}var pt=function(){function e(r){r&&(this._subscribe=r)}return e.prototype.lift=function(r){var n=new e;return n.source=this,n.operator=r,n},e.prototype.subscribe=function(r,n,i){var s=this,a=ed(r)?r:new qi(r,n,i);return Uf(function(){var o=s,u=o.operator,l=o.source;a.add(u?u.call(a,l):l?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(n){r.error(n)}},e.prototype.forEach=function(r,n){var i=this;return n=Qa(n),new n(function(s,a){var o=new qi({next:function(u){try{r(u)}catch(l){a(l),o.unsubscribe()}},error:a,complete:s});i.subscribe(o)})},e.prototype._subscribe=function(r){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(r)},e.prototype[xs]=function(){return this},e.prototype.pipe=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return Zf(r)(this)},e.prototype.toPromise=function(r){var n=this;return r=Qa(r),new r(function(i,s){var a;n.subscribe(function(o){return a=o},function(o){return s(o)},function(){return i(a)})})},e.create=function(r){return new e(r)},e}();function Qa(e){var r;return(r=e??ko.Promise)!==null&&r!==void 0?r:Promise}function Qf(e){return e&&ue(e.next)&&ue(e.error)&&ue(e.complete)}function ed(e){return e&&e instanceof Ds||Qf(e)&&zo(e)}function td(e){return ue(e?.lift)}function Es(e){return function(r){if(td(r))return r.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Pn(e,r,n,i,s){return new rd(e,r,n,i,s)}var rd=function(e){Cr(r,e);function r(n,i,s,a,o,u){var l=e.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=u,l._next=i?function(c){try{i(c)}catch(h){n.error(h)}}:e.prototype._next,l._error=a?function(c){try{a(c)}catch(h){n.error(h)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=s?function(){try{s()}catch(c){n.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,l}return r.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;e.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},r}(Ds),nd={now:function(){return Date.now()},delegate:void 0},id=function(e){Cr(r,e);function r(n,i){return e.call(this)||this}return r.prototype.schedule=function(n,i){return this},r}(ws),eo={setInterval:function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Ur([e,r],wr(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},sd=function(e){Cr(r,e);function r(n,i){var s=e.call(this,n,i)||this;return s.scheduler=n,s.work=i,s.pending=!1,s}return r.prototype.schedule=function(n,i){if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,a=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(a,s,i)),this.pending=!0,this.delay=i,this.id=this.id||this.requestAsyncId(a,this.id,i),this},r.prototype.requestAsyncId=function(n,i,s){return s===void 0&&(s=0),eo.setInterval(n.flush.bind(n,this),s)},r.prototype.recycleAsyncId=function(n,i,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return i;eo.clearInterval(i)},r.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(n,i);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},r.prototype._execute=function(n,i){var s=!1,a;try{this.work(n)}catch(o){s=!0,a=o||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),a},r.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,s=n.scheduler,a=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ji(a,this),i!=null&&(this.id=this.recycleAsyncId(s,i,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},r}(id),to=function(){function e(r,n){n===void 0&&(n=e.now),this.schedulerActionCtor=r,this.now=n}return e.prototype.schedule=function(r,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,r).schedule(i,n)},e.now=nd.now,e}(),ad=function(e){Cr(r,e);function r(n,i){i===void 0&&(i=to.now);var s=e.call(this,n,i)||this;return s.actions=[],s._active=!1,s._scheduled=void 0,s}return r.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var s;this._active=!0;do if(s=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,s){for(;n=i.shift();)n.unsubscribe();throw s}},r}(to),od=new ad(sd),To=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ud(e){return ue(e?.then)}function ld(e){return ue(e[xs])}function cd(e){return Symbol.asyncIterator&&ue(e?.[Symbol.asyncIterator])}function hd(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function fd(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var dd=fd();function vd(e){return ue(e?.[dd])}function yd(e){return Of(this,arguments,function(){var n,i,s,a;return No(this,function(o){switch(o.label){case 0:n=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Ai(n.read())];case 3:return i=o.sent(),s=i.value,a=i.done,a?[4,Ai(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Ai(s)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function pd(e){return ue(e?.getReader)}function bs(e){if(e instanceof pt)return e;if(e!=null){if(ld(e))return md(e);if(To(e))return gd(e);if(ud(e))return wd(e);if(cd(e))return Io(e);if(vd(e))return Dd(e);if(pd(e))return xd(e)}throw hd(e)}function md(e){return new pt(function(r){var n=e[xs]();if(ue(n.subscribe))return n.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function gd(e){return new pt(function(r){for(var n=0;n<e.length&&!r.closed;n++)r.next(e[n]);r.complete()})}function wd(e){return new pt(function(r){e.then(function(n){r.closed||(r.next(n),r.complete())},function(n){return r.error(n)}).then(null,$o)})}function Dd(e){return new pt(function(r){var n,i;try{for(var s=Li(e),a=s.next();!a.done;a=s.next()){var o=a.value;if(r.next(o),r.closed)return}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}r.complete()})}function Io(e){return new pt(function(r){Ed(e,r).catch(function(n){return r.error(n)})})}function xd(e){return Io(yd(e))}function Ed(e,r){var n,i,s,a;return qf(this,void 0,void 0,function(){var o,u;return No(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=Vf(e),l.label=1;case 1:return[4,n.next()];case 2:if(i=l.sent(),!!i.done)return[3,4];if(o=i.value,r.next(o),r.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=l.sent(),s={error:u},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function bd(e,r,n,i,s){i===void 0&&(i=0),s===void 0&&(s=!1);var a=r.schedule(function(){n(),s?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(a),!s)return a}function Mn(e,r){return Es(function(n,i){var s=0;n.subscribe(Pn(i,function(a){i.next(e.call(r,a,s++))}))})}var Ad=Array.isArray;function Cd(e,r){return Ad(r)?e.apply(void 0,Ur([],wr(r))):e(r)}function Fd(e){return Mn(function(r){return Cd(e,r)})}function Sd(e,r,n,i,s,a,o,u){var l=[],c=0,h=0,f=!1,d=function(){f&&!l.length&&!c&&r.complete()},D=function(B){return c<i?F(B):l.push(B)},F=function(B){a&&r.next(B),c++;var _=!1;bs(n(B,h++)).subscribe(Pn(r,function(N){s?.(N),a?D(N):r.next(N)},function(){_=!0},void 0,function(){if(_)try{c--;for(var N=function(){var O=l.shift();o?bd(r,o,function(){return F(O)}):F(O)};l.length&&c<i;)N();d()}catch(O){r.error(O)}}))};return e.subscribe(Pn(r,D,function(){f=!0,d()})),function(){u?.()}}function Ro(e,r,n){return n===void 0&&(n=1/0),ue(r)?Ro(function(i,s){return Mn(function(a,o){return r(i,a,s,o)})(bs(e(i,s)))},n):(typeof r=="number"&&(n=r),Es(function(i,s){return Sd(i,s,e,n)}))}var Bd=["addListener","removeListener"],_d=["addEventListener","removeEventListener"],Pd=["on","off"];function Nn(e,r,n,i){if(ue(n)&&(i=n,n=void 0),i)return Nn(e,r,n).pipe(Fd(i));var s=wr(zd(e)?_d.map(function(u){return function(l){return e[u](r,l,n)}}):Md(e)?Bd.map(ro(e,r)):Nd(e)?Pd.map(ro(e,r)):[],2),a=s[0],o=s[1];if(!a&&To(e))return Ro(function(u){return Nn(u,r,n)})(bs(e));if(!a)throw new TypeError("Invalid event target");return new pt(function(u){var l=function(){for(var c=[],h=0;h<arguments.length;h++)c[h]=arguments[h];return u.next(1<c.length?c:c[0])};return a(l),function(){return o(l)}})}function ro(e,r){return function(n){return function(i){return e[n](r,i)}}}function Md(e){return ue(e.addListener)&&ue(e.removeListener)}function Nd(e){return ue(e.on)&&ue(e.off)}function zd(e){return ue(e.addEventListener)&&ue(e.removeEventListener)}function Lo(e,r){return r===void 0&&(r=od),Es(function(n,i){var s=null,a=null,o=null,u=function(){if(s){s.unsubscribe(),s=null;var c=a;a=null,i.next(c)}};function l(){var c=o+e,h=r.now();if(h<c){s=this.schedule(void 0,c-h),i.add(s);return}u()}n.subscribe(Pn(i,function(c){a=c,o=r.now(),s||(s=r.schedule(l,e),i.add(s))},function(){u(),i.complete()},void 0,function(){a=s=null}))})}var jo=Ao(Lf(),1),qo=(e,r)=>{const n=Ee(e),i=Cs(),s=()=>{const a=window.innerWidth,o=window.innerHeight;n.setAttribute("width",a.toString()),n.setAttribute("height",o.toString());const u={width:a,height:o,center:{x:a/2,y:o/2}};r!==void 0&&r({el:n,bounds:u})};return i.subscribe(s),s(),i},kd=(e,r,n=!1)=>{if(e==null)throw new Error("domQueryOrEl is null or undefined");const i=Ee(e);if(i.nodeName!=="CANVAS")throw new Error(`Expected HTML element with node name CANVAS, not ${i.nodeName}`);const s=i.getContext("2d");if(s===null)throw new Error("Could not create drawing context");const a=()=>{const u=window.innerWidth,l=window.innerHeight;i.width=u,i.height=l;const c={width:u,height:l,center:{x:u/2,y:l/2}};r!==void 0&&r({ctx:s,el:i,bounds:c})};n||(i.style.top="0",i.style.left="0",i.style.zIndex="-100",i.style.position="fixed");const o=Cs();return o.subscribe(a),a(),o},$d=(e,r)=>{if(!(e===null||!e)){if(!Array.isArray(r))throw new Error("List should be an array of strings");for(let n=0;n<r.length;n++)if(e.classList.contains(r[n])){e.classList.remove(r[n]),n+1<r.length?e.classList.add(r[n+1]):e.classList.add(r[0]);return}e.classList.add(r[0])}},Td=(e,r,n=100)=>{const i=Ee(e),s=i.parentElement;if(s===null)throw new Error("Element has no parent");return Fs(s,n).subscribe(o=>{const u=o.find(f=>f.target===s);if(u===void 0)return;const l=u.contentRect.width,c=u.contentRect.height;i.setAttribute("width",l+"px"),i.setAttribute("height",c+"px");const h={width:l,height:c,center:{x:l/2,y:c/2}};r!==void 0&&r({el:i,bounds:h})})},Id=e=>{const r=Ee(e),i=window.getComputedStyle(r).transform;if(i==="none"||typeof i>"u")return{x:0,y:0,z:0};const s=i.includes("3d")?"3d":"2d",a=i.match(/matrix.*\((.+)\)/)[1].split(", ");return s==="2d"?{x:parseFloat(a[4]),y:parseFloat(a[5]),z:0}:s==="3d"?{x:parseFloat(a[12]),y:parseFloat(a[13]),z:parseFloat(a[14])}:{x:0,y:0,z:0}},As=(e,r,n=100)=>{const i=Ee(e);if(i.nodeName!=="CANVAS")throw new Error(`Expected HTML element with node name CANVAS, not ${i.nodeName}`);const s=i.parentElement;if(s===null)throw new Error("Element has no parent");const a=i.getContext("2d");if(a===null)throw new Error("Could not create drawing context");return i.style.width="100%",i.style.height="100%",Fs(s,n).subscribe(u=>{const l=u.find(d=>d.target===s);if(l===void 0)return;const c=l.contentRect.width,h=l.contentRect.height;i.setAttribute("width",i.offsetWidth+"px"),i.setAttribute("height",i.offsetHeight+"px");const f={width:c,height:h,center:{x:c/2,y:h/2}};r!==void 0&&r({ctx:a,el:i,bounds:f})})},Cs=(e=100)=>Nn(window,"resize").pipe(Lo(e)),Ee=e=>{if(typeof e=="string"){const n=document.querySelector(e);if(n===null)throw e.startsWith("#")?new Error(`Query '${e}' did not match anything. Try '#id', 'div', or '.class'`):new Error(`Query '${e}' did not match anything. Did you mean '#${e}?`);e=n}else{if(e===null)throw new Error(`domQueryOrEl ${e} is null`);if(e===void 0)throw new Error(`domQueryOrEl ${e} is undefined`)}return e},Rd=(e,r)=>{const n=document.createElement(r);return e.parentElement?.insertBefore(n,e.nextSibling),n},Ld=(e,r)=>{const n=document.createElement(r);return e.appendChild(n),n},jd=(e,r)=>{const n=Ee(e),i=s=>{const a=new Set;for(const[u,l]of s){const c=`table-${u}`;a.add(c);let h=n.querySelector(`#${c}`);h===null&&(h=document.createElement("table"),h.id=c,n.append(h)),Oi(h,l)}Array.from(n.querySelectorAll("table")).forEach(u=>{a.has(u.id)||u.remove()})};return r&&i(r),s=>{i(s)}},Oi=(e,r,n={})=>{const i=n.precision??2;if(r===void 0){e.innerHTML="";return}const s=new Set;for(const[o,u]of Object.entries(r)){const l=`row-${o}`;s.add(l);let c=e.querySelector(`#${l}`);if(c===null){c=document.createElement("tr"),e.append(c),c.id=l;const d=document.createElement("td");d.innerText=o,c.append(d)}let h=c.querySelector(`#${l}-val`);h===null&&(h=document.createElement("td"),h.id=`${l}-val`,c.append(h));let f;n.formatter&&(f=n.formatter(u,o)),f===void 0&&(typeof u=="object"?f=jo.default.stringify(u):typeof u=="number"?n.roundNumbers?f=Math.round(u).toString():f=u.toFixed(i):f=u.toString()),h.innerHTML=f}Array.from(e.querySelectorAll("tr")).forEach(o=>{s.has(o.id)||o.remove()})},qd=(e,r,n)=>{const i=Ee(e),s=document.createElement("table");return i.append(s),r&&Oi(s,r,n),a=>{Oi(s,a,n)}},Od=e=>{let r=e.lastElementChild;for(;r;)e.removeChild(r),r=e.lastElementChild},Vd=()=>new pt(r=>{const n=new MutationObserver(s=>{r.next(s)}),i={attributeFilter:["class"],attributes:!0};return n.observe(document.documentElement,i),function(){n.disconnect()}}),Fs=(e,r=1e3)=>{if(e===null)throw new Error("elem parameter is null. Expected element to observe");if(e===void 0)throw new Error("elem parameter is undefined. Expected element to observe");return new pt(i=>{const s=new ResizeObserver(a=>{i.next(a)});return s.observe(e),function(){s.unobserve(e)}}).pipe(Lo(r))},Wd=e=>new Promise((n,i)=>{const s=jo.default.stringify(e);navigator.clipboard.writeText(JSON.stringify(s)).then(()=>{n(!0)},a=>{console.warn("Could not copy to clipboard"),console.log(s),i(a)})}),Hd=(e,r,n)=>{if(e===null)throw new Error("parentEl is null");if(e===void 0)throw new Error("parentEl is undefined");const i=new Set;for(const[a,o]of r){const u=`c-${a}`,l=e.querySelector(`#${u}`),c=n(o,l);l!==c&&(c.id=u,e.append(c)),i.add(u)}const s=[];for(let a=0;a<e.children.length;a++){const o=e.children[a];i.has(o.id)||s.push(o)}s.forEach(a=>a.remove())},Ud=e=>{e.addEventListener("keydown",r=>{const n=e.value,i=e.selectionStart,s=e.selectionEnd;if(r.key==="Tab"&&r.shiftKey)return e.value.substring(i-2,i)==="  "&&(e.value=n.substring(0,i-2)+n.substring(s)),e.selectionStart=e.selectionEnd=i-2,r.preventDefault(),!1;if(r.key==="Tab")return e.value=n.substring(0,i)+"  "+n.substring(s),e.selectionStart=e.selectionEnd=i+2,r.preventDefault(),!1})},Gd=(e,r)=>{const n=Ee(e);return r&&n.addEventListener("change",()=>{r(n.checked)}),{get checked(){return n.checked},set checked(i){n.checked=i}}},Jd=(e,r,n)=>{const i=Ee(e),s=n?"change":"input";return r&&i.addEventListener(s,()=>{r(parseInt(i.value))}),{get value(){return parseInt(i.value)},set value(a){i.value=a.toString()}}},Yd=(e,r)=>{const n=Ee(e);return r&&n.addEventListener("click",i=>{r()}),{click(){r&&r()},set disabled(i){n.disabled=i}}},Kd=(e,r,n={})=>{const i=Ee(e),{placeholderOpt:s,shouldAddChoosePlaceholder:a=!1,autoSelectAfterChoice:o=-1}=n,u=()=>{r!==void 0&&r(i.value),o>=0&&(i.selectedIndex=o)};return r&&i.addEventListener("change",l=>{u()}),{set disabled(l){i.disabled=l},get value(){return i.value},get index(){return i.selectedIndex},get isSelectedPlaceholder(){return(a||n.placeholderOpt!==void 0)&&i.selectedIndex===0},setOpts(l,c){i.options.length=0,a?l=["-- Choose --",...l]:s!==void 0&&(l=[s,...l]);let h=0;l.forEach((f,d)=>{const D=document.createElement("option");D.value=f,D.innerHTML=f,c!==void 0&&f===c&&(h=d),i.options.add(D)}),i.selectedIndex=h},select(l=0,c=!1){i.selectedIndex=l,c&&r&&u()}}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xt=(e,r)=>(ce(e,"positive","timeoutMs"),e===0?new Promise(n=>requestAnimationFrame(i=>{n(r)})):new Promise(n=>setTimeout(()=>n(r),e))),Oo=async function*(e,r){let n=!1;try{for(;!n;){if(await Xt(r),n)return;if(typeof e=="function")yield await e();else if(typeof e=="object")if("next"in e&&"return"in e&&"throw"in e){const i=await e.next();if(i.done)return;yield i.value}else throw new Error("interval: produce param does not seem to be a generator?");else throw new Error("produce param does not seem to return a value/Promise and is not a generator?")}}finally{n=!0}},Xd=async(e,r)=>(await Xt(r),Promise.resolve(await e()));async function*Zd(){let e,r=new Promise(s=>e=s),n=0;const i=()=>{e(),r=new Promise(s=>e=s)};try{for(;;)n=window.requestAnimationFrame(i),yield await r}finally{e(),window.cancelAnimationFrame(n)}}async function*Ss(e){if(e===0)return yield*Zd();let r,n=new Promise(a=>r=a),i=0;const s=()=>{r(),n=new Promise(a=>r=a)};try{for(;;)i=window.setTimeout(s,e),yield await n}finally{r(),window.clearTimeout(i)}}var Qd={};T(Qd,{Async:()=>ms,Sync:()=>Wo,count:()=>x0,delayLoop:()=>Ss,interval:()=>Oo,numericPercent:()=>E0,numericRange:()=>Ho,numericRangeRaw:()=>D0,pingPong:()=>Bs,pingPongPercent:()=>Vo});var Vo=function(e=.1,r,n,i,s){return r===void 0&&(r=0),n===void 0&&(n=1),i===void 0&&(i=r),M(e,"bipolar","interval"),M(n,"bipolar","end"),M(i,"bipolar","offset"),M(r,"bipolar","start"),Bs(e,r,n,i,s)},Bs=function*(e,r,n,i,s){if(r===void 0)throw new Error("Parameter 'lower' is undefined");if(e===void 0)throw new Error("Parameter 'interval' is undefined");if(n===void 0)throw new Error("Parameter 'upper' is undefined");if(s===void 0&&e<=1&&e>=0?s=10/e:s===void 0&&(s=1234),Number.isNaN(e))throw new Error("interval parameter is NaN");if(Number.isNaN(r))throw new Error("lower parameter is NaN");if(Number.isNaN(n))throw new Error("upper parameter is NaN");if(Number.isNaN(i))throw new Error("upper parameter is NaN");if(r>=n)throw new Error("lower must be less than upper");if(e===0)throw new Error("Interval cannot be zero");const a=n-r;if(Math.abs(e)>=a)throw new Error(`Interval should be between -${a} and ${a}`);let o=e>0;if(n=Math.floor(n*s),r=Math.floor(r*s),e=Math.floor(Math.abs(e*s)),e===0)throw new Error(`Interval is zero (rounding: ${s})`);if(i===void 0?i=r:i=Math.floor(i*s),i>n||i<r)throw new Error(`Start (${i/s}) must be within lower (${r/s}) and upper (${n/s})`);let u=i;yield u/s;let l=!0;for(;;)u=u+(o?e:-e),o&&u>=n?(o=!1,u=n,u===n&&l&&(u=r,o=!0)):!o&&u<=r&&(o=!0,u=r,u===r&&l&&(u=n,o=!1)),yield u/s,l=!1},Wo={};T(Wo,{chunks:()=>e0,concat:()=>t0,dropWhile:()=>r0,equals:()=>n0,every:()=>i0,fill:()=>s0,filter:()=>o0,find:()=>u0,flatten:()=>l0,forEach:()=>a0,map:()=>c0,max:()=>h0,min:()=>f0,range:()=>d0,reduce:()=>v0,slice:()=>y0,some:()=>p0,takeWhile:()=>m0,unique:()=>g0,zip:()=>w0});function*e0(e,r){let n=[];for(const i of e)n.push(i),n.length===r&&(yield n,n=[]);n.length>0&&(yield n)}function*t0(...e){for(const r of e)yield*r}function*r0(e,r){for(const n of e)if(!r(n)){yield n;break}yield*e}function n0(e,r,n){for(;;){const i=e.next(),s=r.next();if(n!==void 0){if(!n(i.value,s.value))return!1}else if(i.value!==s.value)return!1;if(i.done||s.done)return i.done&&s.done}}function i0(e,r){let n=!0;for(const i of e)n=n&&r(i);return n}function*s0(e,r){for(const n of e)yield r}function a0(e,r){for(const n of e)r(n)}function*o0(e,r){for(const n of e)!r(n)||(yield n)}function u0(e,r){for(const n of e)if(r(n))return n}function*l0(e){for(const r of e)Symbol.iterator in r?yield*r:yield r}function*c0(e,r){for(const n of e)yield r(n)}function h0(e,r=(n,i)=>n>i){let n;for(const i of e){if(!n){n=i;continue}n=r(n,i)?n:i}return n}function f0(e,r=(n,i)=>n>i){let n;for(const i of e){if(!n){n=i;continue}n=r(n,i)?i:n}return n}function*d0(e,r){for(let n=0;n<r;n++)yield e++}function v0(e,r,n){for(const i of e)n=r(n,i);return n}function*y0(e,r=0,n=Number.POSITIVE_INFINITY){const i=e[Symbol.iterator]();for(;r>0;r--,n--)i.next();for(const s of e)if(n-- >0)yield s;else break}function p0(e,r){for(const n of e)if(r(n))return!0;return!1}function*m0(e,r){for(const n of e){if(!r(n))return;yield n}}function*g0(e,r=n=>n){const n=[];for(const i of e){const s=r(i);n.indexOf(s)===-1&&(n.push(s),yield i)}}function*w0(...e){const r=e.map(n=>n[Symbol.iterator]());for(;;){const n=r.map(i=>i.next());if(n.some(i=>i.done))return;yield n.map(i=>i.value)}}var D0=function*(e,r=0,n,i=!1){if(e<=0)throw new Error("Interval is expected to be above zero");n===void 0&&(n=Number.MAX_SAFE_INTEGER);let s=r;do for(;s<n;)yield s,s+=e;while(i)},Ho=function*(e,r=0,n,i=!1,s){M(e,"nonZero");const a=e<0;if(n!==void 0){if(a&&r<n)throw new Error(`Interval of ${e} will never go from ${r} to ${n}`);if(!a&&r>n)throw new Error(`Interval of ${e} will never go from ${r} to ${n}`)}s=s??1e3,n===void 0?n=Number.MAX_SAFE_INTEGER:n*=s,e=e*s;do{let o=r*s;for(;!a&&o<=n||a&&o>=n;)yield o/s,o+=e}while(i)},x0=function*(e,r=0){if(ce(e,"","amount"),ce(r,"","offset"),e===0)return;let n=0;do e<0?yield-n+r:yield n+r;while(n++<Math.abs(e)-1)},E0=function(e=.01,r=!1,n=0,i=1){return M(e,"percentage","interval"),M(n,"percentage","start"),M(i,"percentage","end"),Ho(e,n,i,r)},Uo={};T(Uo,{addUniqueByHash:()=>Jo,filter:()=>Ko,find:()=>Xo,getOrGenerate:()=>Go,getOrGenerateSync:()=>A0,hasAnyValue:()=>Yo,hasKeyValue:()=>b0,mapToArray:()=>B0,mapToObj:()=>S0,mapToObjTransform:()=>C0,toArray:()=>Vi,transformMap:()=>F0,zipKeyValue:()=>_s});var b0=(e,r,n,i)=>e.has(r)?Array.from(e.values()).some(a=>i(a,n)):!1,Go=(e,r)=>async(n,i)=>{let s=e.get(n);if(s!==void 0)return Promise.resolve(s);if(s=await r(n,i),s===void 0)throw new Error("fn returned undefined");return e.set(n,s),s},A0=(e,r)=>(n,i)=>{let s=e.get(n);return s!==void 0||(s=r(n,i),e.set(n,s)),s},Jo=(e,r,...n)=>{const i=e===void 0?new Map:new Map(e);return n.forEach(s=>{const a=r(s);i.has(a)||i.set(a,s)}),i},Yo=(e,r,n)=>Array.from(e.entries()).some(s=>n(s[1],r));function*Ko(e,r){for(const n of e.values())r(n)&&(yield n)}var Vi=e=>Array.from(e.values()),Xo=(e,r)=>Array.from(e.values()).find(n=>r(n)),C0=(e,r)=>Array.from(e).reduce((n,[i,s])=>{const a=r(s);return n[i]=a,n},{}),_s=(e,r)=>{if(e.length!==r.length)throw new Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((n,i)=>[n,r[i]]))},F0=(e,r)=>new Map(Array.from(e,n=>[n[0],r(n[1],n[0])])),S0=e=>Array.from(e).reduce((r,[n,i])=>(r[n]=i,r),{}),B0=(e,r)=>Array.from(e.entries()).map(n=>r(n[0],n[1])),Ps={};T(Ps,{StateMachine:()=>Fr,create:()=>P0,descriptionFromList:()=>Zo,fromList:()=>_0});var Zo=(...e)=>{const r={};for(let n=0;n<e.length;n++)n===e.length-1?r[e[n]]=null:r[e[n]]=e[n+1];return r},_0=(...e)=>new Fr(e[0],Zo(...e)),P0=(e,r,n={debug:!1})=>new Fr(e,r,n),At,mn,Ct,ar,gn,wn=class extends Mt{constructor(e,r,n={debug:!1}){super();le(this,At,void 0),le(this,mn,void 0),le(this,Ct,void 0),le(this,ar,void 0),le(this,gn,void 0);const[i,s]=wn.validate(e,r);if(!i)throw new Error(s);Z(this,gn,e),Z(this,Ct,r),Z(this,mn,n.debug??!1),Z(this,At,e),Z(this,ar,!1)}get states(){return Object.keys(E(this,Ct))}static validate(e,r){const n=Object.keys(r),i=new Set,s=new Set;for(let u=0;u<n.length;u++){const l=n[u];if(i.has(l))return[!1,`Key ${l} is already used`];if(i.add(l),typeof n[u]!="string")return[!1,`Key[${u}] is not a string`];const c=r[l];if(c===void 0)return[!1,`Key ${l} value is undefined`];if(typeof c=="string"){if(s.add(c),c===l)return[!1,`Loop present for ${l}`]}else if(Array.isArray(c)){if(!zf(c))return[!1,`Key ${l} value is not an array of strings`];if(c.forEach(h=>s.add(h)),c.find(h=>h===l))return[!1,`Loop present for ${l}`]}else if(c!==null)return[!1,`Key ${l} has a value that is neither null, string or array`]}const o=Array.from(s).find(u=>!i.has(u));return o?[!1,`Potential state '${o}' does not exist as a top-level state`]:r[e]===void 0?[!1,`Initial state ${e} not present`]:[!0,""]}next(){const e=E(this,Ct)[E(this,At)];if(e===null)return null;if(Array.isArray(e))if(typeof e[0]=="string")this.state=e[0];else throw new Error("Error in machine description. Potential state array does not contain strings");else if(typeof e=="string")this.state=e;else throw new Error("Error in machine description. Potential state is neither array nor string");return this.state}get isDone(){return E(this,ar)}reset(){Z(this,ar,!1),Z(this,At,E(this,gn))}static isValid(e,r,n){if(n[r]===void 0)return[!1,`Machine cannot change to non-existent state ${r}`];const i=n[e];if(Array.isArray(i)){if(!i.includes(r))return[!1,`Machine cannot change '${e} -> ${r}'. Allowed transitions: ${i.join(", ")}`]}else if(r!==i&&i!=="*")return[!1,`Machine cannot '${e} -> ${r}'. Allowed transition: ${i}`];return[!0,"ok"]}isValid(e){return wn.isValid(this.state,e,E(this,Ct))}set state(e){const r=E(this,At),[n,i]=wn.isValid(r,e,E(this,Ct));if(!n)throw new Error(i);E(this,mn)&&console.log(`StateMachine: ${r} -> ${e}`),Z(this,At,e),E(this,Ct)[e]===null&&Z(this,ar,!0),setTimeout(()=>{this.fireEvent("change",{newState:e,priorState:r}),this.isDone&&this.fireEvent("stop",{state:e})},1)}get state(){return E(this,At)}},Fr=wn;At=new WeakMap;mn=new WeakMap;Ct=new WeakMap;ar=new WeakMap;gn=new WeakMap;var M0={};T(M0,{StateMachine:()=>Ps,continuously:()=>zs,debounce:()=>k0,delay:()=>Xd,delayLoop:()=>Ss,forEach:()=>ru,forEachAsync:()=>nu,frequencyTimer:()=>mt,frequencyTimerSource:()=>eu,interval:()=>Oo,msElapsedTimer:()=>er,relativeTimer:()=>Ms,repeat:()=>$s,sleep:()=>Xt,throttle:()=>$0,ticksElapsedTimer:()=>Ns,timeout:()=>tu,updateOutdated:()=>N0,waitFor:()=>ks});var Qo={};T(Qo,{frequencyTimer:()=>mt,frequencyTimerSource:()=>eu,msElapsedTimer:()=>er,relativeTimer:()=>Ms,ticksElapsedTimer:()=>Ns});var $e=(e,r=0,n=1)=>{if(Number.isNaN(e))throw new Error("v parameter is NaN");if(Number.isNaN(r))throw new Error("min parameter is NaN");if(Number.isNaN(n))throw new Error("max parameter is NaN");return e<r?r:e>n?n:e},Wi=(e,r)=>{if(!Number.isInteger(e))throw new Error(`v parameter must be an integer (${e})`);const n=Array.isArray(r)?r.length:r;if(!Number.isInteger(n))throw new Error(`length parameter must be an integer (${n}, ${typeof n})`);return e=Math.round(e),e<0?0:e>=n?n-1:e},eu=e=>()=>mt(e,er()),Ms=(e,r,n=!0)=>{let i=!1,s=1;return{mod(a){s=a},get isDone(){return i},reset:()=>{i=!1,r.reset()},get elapsed(){let a=r.elapsed/(e*s);return n&&(a=$e(a)),a>=1&&(i=!0),a}}},mt=(e,r=er())=>{const n=e/1e3;let i=1;return{mod:s=>{i=s},reset:()=>{r.reset()},get elapsed(){const s=r.elapsed*(n*i),a=s-Math.floor(s);if(a<0)throw new Error(`Unexpected cycle fraction less than 0. Elapsed: ${s} f: ${a}`);if(a>1)throw new Error(`Unexpected cycle fraction more than 1. Elapsed: ${s} f: ${a}`);return a}}},er=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e}}},Ns=()=>{let e=0;return{reset:()=>{e=0},get elapsed(){return e++}}},tu=(e,r)=>{if(e===void 0)throw new Error("callback parameter is undefined");ce(r,"aboveZero","timeoutMs");let n=0,i=0;const s=async(o=r,u)=>new Promise((c,h)=>{i=performance.now();try{ce(o,"aboveZero","altTimeoutMs")}catch(f){h(f);return}n!==0&&a(),n=window.setTimeout(async()=>{await e(performance.now()-i,...u),n=0,c(void 0)},o)}),a=()=>{n!==0&&(i=0,window.clearTimeout(n))};return{start:s,cancel:a,get isDone(){return n!==0}}},N0=(e,r,n="slow")=>{let i=0,s,a=r;return()=>new Promise(async(o,u)=>{const l=performance.now()-i;if(s===void 0||l>a)try{i=performance.now(),s=await e(l),a=r}catch(c){n==="fast"?(s=void 0,i=0):n==="backoff"&&(a=Math.floor(a*1.2)),u(c);return}o(s)})},z0=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(e,1),zs=(e,r,n)=>{r!==void 0&&ce(r,"positive","intervalMs");let i=!1,s=0,a=performance.now(),o=r===void 0?0:r;const u=o===0?z0:f=>setTimeout(f,o),l=()=>{!i||(i=!1,s=0)},c=async()=>{if(!i)return;const f=e(s++,performance.now()-a);let d;if(typeof f=="object"?d=await f:d=f,d!==void 0&&!d){l();return}u(c)};return{start:()=>{if(i&&n!==void 0){const f=n(s,performance.now()-a);if(a=performance.now(),f!==void 0&&!f){l();return}}else if(i)return;i=!0,u(c)},get intervalMs(){return o},set intervalMs(f){ce(f,"positive","ms"),o=f},get isDone(){return!i},get ticks(){return s},get elapsedMs(){return performance.now()-a},cancel:l}},k0=(e,r)=>{const n=tu(e,r);return(...i)=>n.start(void 0,i)},$0=(e,r)=>{let n=0;return async(...i)=>{const s=performance.now()-n;if(s>=r){const a=e(s,...i);typeof a=="object"&&await a,n=performance.now()}}},ks=(e,r,n)=>{let i=!1;const s=o=>{a!==0&&(window.clearTimeout(a),a=0),o?r(o):i=!0,n!==void 0&&n(i)};let a=window.setTimeout(()=>{a=0;try{r(`Timeout after ${e}ms`)}finally{n!==void 0&&n(i)}},e);return s},ru=(e,r)=>{for(const n of e){const i=r(n);if(typeof i=="boolean"&&!i)break}},nu=async function(e,r,n){if(Array.isArray(e))for(const i of e){const s=await r(i);if(n&&await Xt(n),typeof s=="boolean"&&!s)break}else for await(const i of e){const s=await r(i);if(n&&await Xt(n),typeof s=="boolean"&&!s)break}},$s=(e,r)=>{let n,i;n=i=0;const s=[];if(typeof e=="number")for(M(e,"positive","countOrPredicate");e-- >0;){n++;const a=r();a!==void 0&&(s.push(a),i++)}else for(;e(n,i);){n++;const a=r();a!==void 0&&(s.push(a),i++)}return s};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Flow:{StateMachine:Ps,Timer:Qo,forEach:ru,forEachAsync:nu,repeat:$s}})}catch{}var iu={};T(iu,{byValueString:()=>qh,getSorter:()=>Oh,minMaxAvg:()=>u1,sortByKey:()=>vs,sortByValueNumber:()=>ys,sortByValueString:()=>o1});function Ts(e,r,n,i,s,a,o,u,l){switch(arguments.length){case 1:return e;case 2:return r(e);case 3:return n(r(e));case 4:return i(n(r(e)));case 5:return s(i(n(r(e))));case 6:return a(s(i(n(r(e)))));case 7:return o(a(s(i(n(r(e))))));case 8:return u(o(a(s(i(n(r(e)))))));case 9:return l(u(o(a(s(i(n(r(e))))))));default:for(var c=arguments[0],h=1;h<arguments.length;h++)c=arguments[h](c);return c}}var T0=function(e){return function(r,n){return r===n||e(r,n)===0}},su=function(e){return{equals:T0(e),compare:function(r,n){return r===n?0:e(r,n)}}},Is=function(e){return su(function(r,n){return e.compare(n,r)})},Rs=function(e){return function(r){return su(function(n,i){return r.compare(e(n),e(i))})}},au={equals:function(e,r){return e===r}},Hi={equals:au.equals,compare:function(e,r){return e<r?-1:e>r?1:0}};au.equals,Hi.compare;var I0=function(e){return e.slice()},Ls=function(e){return function(r){return r.length<=1?I0(r):r.slice().sort(e.compare)}},R0={equals:function(e,r){return e===r}},zn={equals:R0.equals,compare:function(e,r){return e<r?-1:e>r?1:0}},Je={};T(Je,{areValuesIdentical:()=>Wa,average:()=>lu,averageWeighted:()=>cu,chunks:()=>i1,dotProduct:()=>q0,ensureLength:()=>Zw,filterBetween:()=>Lh,flatten:()=>Kw,groupBy:()=>r1,guardArray:()=>mi,guardIndex:()=>Gn,interleave:()=>Xw,intersection:()=>Yw,max:()=>du,maxFast:()=>V0,maxIndex:()=>O0,min:()=>hu,minFast:()=>yu,minIndex:()=>fu,minMaxAvg:()=>Yn,randomElement:()=>Ua,randomIndex:()=>Ha,randomPluck:()=>Qw,remove:()=>t1,sample:()=>n1,shuffle:()=>e1,total:()=>vu,validNumbers:()=>Dr,weight:()=>uu,without:()=>jh,zip:()=>Rh});var L0={};T(L0,{arrayElement:()=>Ua,arrayIndex:()=>Ha,defaultRandom:()=>Ye,float:()=>Gw,gaussian:()=>Va,gaussianSkewed:()=>Hw,hue:()=>ba,integer:()=>Uw,shortGuid:()=>Jw,string:()=>Ih,weighted:()=>Th,weightedInteger:()=>Ww,weightedSkewed:()=>Vw});var js={};T(js,{crossfade:()=>Rw,fromCubicBezier:()=>Iw,functions:()=>Oa,gaussian:()=>$h,get:()=>pi,getEasings:()=>Lw,mix:()=>kh,tick:()=>Tw,time:()=>$w});var j0={};T(j0,{FrequencyMutable:()=>Bh,IntervalTracker:()=>Ph,Normalise:()=>ou,NumberTracker:()=>Hs,PointTracker:()=>$a,TrackedPointMap:()=>yh,TrackedValueMap:()=>vh,TrackerBase:()=>Ws,clamp:()=>$e,clampIndex:()=>Wi,flip:()=>Sn,frequencyMutable:()=>Pw,interpolate:()=>qa,interpolateAngle:()=>Nh,intervalTracker:()=>zw,movingAverage:()=>Nw,movingAverageLight:()=>_h,movingAverageTimed:()=>Mw,numberTracker:()=>Vr,piPi:()=>ds,pointTracker:()=>nw,pointsTracker:()=>ph,scale:()=>vt,scaleClamped:()=>W0,scalePercent:()=>U0,scalePercentages:()=>H0,wrap:()=>Un,wrapInteger:()=>Mh,wrapRange:()=>kw});var ou={};T(ou,{array:()=>J0,stream:()=>G0});var uu=(e,r)=>{const n=r===void 0?i=>i:r;return Dr(e).map((i,s)=>i*n(s/(Dr.length-1)))},Dr=e=>e.filter(r=>typeof r=="number"&&!Number.isNaN(r)),q0=e=>{let r=0;const n=e[0].length;for(let i=0;i<n;i++){let s=0;for(let a=0;a<e.length;a++)a===0?s=e[a][i]:s*=e[a][i];r+=s}return r},lu=e=>{if(e===void 0)throw new Error("data parameter is undefined");const r=Dr(e);return r.reduce((i,s)=>i+s,0)/r.length},cu=(e,r)=>{typeof r=="function"&&(r=uu(e,r));const n=Rh(e,r),[i,s]=n.reduce((a,o)=>[a[0]+o[0]*o[1],a[1]+o[1]],[0,0]);return i/s},hu=e=>Math.min(...Dr(e)),O0=e=>e.reduce((r,n,i,s)=>n>s[r]?i:r,0),fu=(...e)=>e.reduce((r,n,i,s)=>n<s[r]?i:r,0),du=e=>Math.max(...Dr(e)),vu=e=>e.reduce((r,n)=>typeof n!="number"||Number.isNaN(n)||Number.isFinite(n)?r:r+n,0),V0=e=>{let r=Number.MIN_SAFE_INTEGER;for(let n=0;n<e.length;n++)r=Math.max(r,e[n]);return r},yu=e=>{let r=Number.MIN_SAFE_INTEGER;for(let n=0;n<e.length;n++)r=Math.min(r,e[n]);return r},Yn=(e,r,n)=>{if(e===void 0)throw new Error("'data' is undefined");if(!Array.isArray(e))throw new Error("'data' parameter is not an array");if(e.length===0)return{total:0,min:0,max:0,avg:0};r===void 0&&(r=0),n===void 0&&(n=e.length-1);const i=Lh(e,a=>typeof a=="number"&&!Number.isNaN(a),r,n),s=i.reduce((a,o)=>a+o,0);return{total:s,max:Math.max(...i),min:Math.min(...i),avg:s/i.length}},vt=(e,r,n,i,s,a)=>{if(s===void 0&&(s=1),i===void 0&&(i=0),r===n)return s;let o=(e-r)/(n-r);return a!==void 0&&(o=a(o)),o*(s-i)+i},W0=(e,r,n,i,s,a)=>{if(s===void 0&&(s=1),i===void 0&&(i=0),r===n)return s;const o=vt(e,r,n,i,s,a);return $e(o,i,s)},H0=(e,r,n=1)=>(M(e,"percentage","v"),M(r,"percentage","outMin"),M(n,"percentage","outMax"),vt(e,0,1,r,n)),U0=(e,r,n)=>(M(e,"percentage","v"),vt(e,0,1,r,n)),G0=(e,r)=>{let n=e??Number.MAX_SAFE_INTEGER,i=r??Number.MIN_SAFE_INTEGER;return M(e),M(r),s=>(M(s),n=Math.min(n,s),i=Math.max(i,s),vt(s,n,i))},J0=(e,r,n)=>{if(!Array.isArray(e))throw new Error("values param should be an array");const i=Yn(e),s=r??i.min,a=n??i.max;return e.map(o=>$e(vt(o,s,a)))},Y0={};T(Y0,{Arcs:()=>qs,Beziers:()=>Zr,Circles:()=>yt,Compound:()=>Qs,Ellipses:()=>oa,Grids:()=>ta,Lines:()=>Ne,Paths:()=>yr,Points:()=>w,Polar:()=>Ze,Rects:()=>re,Shapes:()=>ua,Triangles:()=>Gt,degreeToRadian:()=>Bt,radianToDegree:()=>ha,radiansFromAxisX:()=>rc});var qs={};T(qs,{bbox:()=>fl,distanceCenter:()=>iy,fromDegrees:()=>ry,guard:()=>Gs,interpolate:()=>Js,isArc:()=>ll,isEqual:()=>sy,isPositioned:()=>ht,length:()=>hl,point:()=>In,toLine:()=>cl,toPath:()=>ny,toSvg:()=>dl});var w={};T(w,{Empty:()=>Tn,Placeholder:()=>tl,abs:()=>Nv,angle:()=>dr,apply:()=>Lv,bbox:()=>zv,centroid:()=>nl,clamp:()=>ty,clampMagnitude:()=>ey,compare:()=>Hv,compareByX:()=>ul,convexHull:()=>Wv,distance:()=>dt,distanceToCenter:()=>Mv,distanceToExterior:()=>Pv,divide:()=>Ov,dotProduct:()=>Fv,findMinimum:()=>Wt,from:()=>Rv,fromNumbers:()=>il,getPointParam:()=>Zt,guard:()=>X,guardNonZeroPoint:()=>rl,interpolate:()=>Iv,invert:()=>Zv,isEmpty:()=>Dn,isEqual:()=>Wr,isNull:()=>Sv,isPlaceholder:()=>xn,isPoint:()=>he,isPoint3d:()=>Zi,leftmost:()=>Bv,multiply:()=>ol,normalise:()=>Jv,normaliseByRect:()=>Yv,pipeline:()=>sl,pipelineApply:()=>jv,project:()=>Qi,quantiseEvery:()=>Vv,random:()=>Kv,reduce:()=>al,relation:()=>es,rightmost:()=>_v,rotate:()=>Ut,rotatePointArray:()=>Uv,subtract:()=>Us,sum:()=>qv,toArray:()=>kv,toIntegerValues:()=>Qv,toString:()=>$v,withinRange:()=>Tv,wrap:()=>Xv});var Ne={};T(Ne,{angleRadian:()=>uv,apply:()=>$u,asPoints:()=>vv,bbox:()=>Zu,distance:()=>Gu,divide:()=>Iu,extendFromA:()=>fv,fromFlatArray:()=>yv,fromNumbers:()=>$n,fromPoints:()=>Zn,fromPointsToPath:()=>pv,getPointsParam:()=>Xn,guard:()=>Os,interpolate:()=>_t,isEqual:()=>ku,isLine:()=>Nt,isPolyLine:()=>zu,joinPointsToLines:()=>Xu,length:()=>Ge,midpoint:()=>qu,multiply:()=>Tu,nearest:()=>Ou,normaliseByRect:()=>lv,parallel:()=>Uu,perpendicularPoint:()=>Hu,pointAtX:()=>hv,pointsOf:()=>dv,rotate:()=>Qu,scaleFromMidpoint:()=>cv,slope:()=>Vs,subtract:()=>Lu,sum:()=>Ru,toFlatArray:()=>Yu,toPath:()=>St,toString:()=>Ju,toSvgString:()=>Ku,withinRange:()=>ju});var K0={};T(K0,{Arrays:()=>Je,MapOfMutableImpl:()=>Kn,Maps:()=>Uo,Queues:()=>Fu,Sets:()=>So,Stacks:()=>Du,circularArray:()=>mu,map:()=>or,mapArray:()=>gu,mapCircularMutable:()=>wu,mapMutable:()=>ov,mapSet:()=>Z0,queue:()=>Mu,queueMutable:()=>xr,setMutable:()=>ps,simpleMapArrayMutable:()=>Fo,stack:()=>kn,stackMutable:()=>Cu});var lt,Xe,pu=class extends Array{constructor(e=0){super();le(this,lt,void 0),le(this,Xe,void 0),ce(e,"positive","capacity"),Z(this,lt,e),Z(this,Xe,0)}add(e){const r=pu.from(this);return r[E(this,Xe)]=e,Z(r,lt,E(this,lt)),E(this,lt)>0?Z(r,Xe,E(this,Xe)+1===E(this,lt)?0:E(this,Xe)+1):Z(r,Xe,E(this,Xe)+1),r}get pointer(){return E(this,Xe)}get isFull(){return E(this,lt)===0?!1:this.length===E(this,lt)}},X0=pu;lt=new WeakMap;Xe=new WeakMap;var mu=e=>new X0(e),de,Kn=class extends Mt{constructor(e,r={}){super();le(this,de,new Map),y(this,"groupBy"),y(this,"type"),this.type=e,this.groupBy=r.groupBy??Hr}get typeName(){return this.type.name}get lengthMax(){let e=0;for(const r of E(this,de).values())e=Math.max(e,this.type.count(r));return e}debugString(){const e=Array.from(E(this,de).keys());let r=`Keys: ${e.join(", ")}\r
`;return e.forEach(n=>{const i=E(this,de).get(n);if(i!==void 0){const s=this.type.toArray(i);s!==void 0&&(r+=` - ${n} (${this.type.count(i)}) = ${JSON.stringify(s)}\r
`)}else r+=` - ${n} (undefined)\r
`}),r}get isEmpty(){return E(this,de).size===0}clear(){E(this,de).clear(),super.fireEvent("clear",!0)}addKeyedValues(e,...r){const n=E(this,de).get(e);n===void 0?(E(this,de).set(e,this.type.add(void 0,r)),super.fireEvent("addedKey",{key:e}),super.fireEvent("addedValues",{values:r})):(E(this,de).set(e,this.type.add(n,r)),super.fireEvent("addedValues",{values:r}))}addValue(...e){e.forEach(r=>this.addKeyedValues(this.groupBy(r),r))}hasKeyValue(e,r){const n=E(this,de).get(e);return n===void 0?!1:this.type.has(n,r)}has(e){return E(this,de).has(e)}deleteKeyValue(e,r){const n=E(this,de).get(e);if(n===void 0)return!1;const i=this.type.count(n),s=this.type.without(n,r),a=s.length;return E(this,de).set(e,this.type.add(void 0,s)),i>a}delete(e){return E(this,de).get(e)===void 0?!1:(E(this,de).delete(e),this.fireEvent("deleteKey",{key:e}),!0)}findKeyForValue(e){return Array.from(E(this,de).keys()).find(i=>{const s=E(this,de).get(i);if(s===void 0)throw Error("Bug: map could not be accessed");return!!this.type.has(s,e)})}count(e){const r=E(this,de).get(e);return r===void 0?0:this.type.count(r)}get(e){const r=E(this,de).get(e);if(r!==void 0)return this.type.toArray(r)}getSource(e){return E(this,de).get(e)}keys(){return Array.from(E(this,de).keys())}keysAndCounts(){return this.keys().map(n=>[n,this.count(n)])}merge(e){e.keys().forEach(n=>{const i=e.get(n);i!==void 0&&this.addKeyedValues(n,...i)})}};de=new WeakMap;var gu=(e={})=>{const r=e.comparer===void 0?e.toString===void 0?(s,a)=>e.toString(s)===e.toString(a):Xr:e.comparer,n={get name(){return"array"},add:(s,a)=>s===void 0?[...a]:[...s,...a],count:s=>s.length,find:(s,a)=>s.find(a),filter:(s,a)=>s.filter(a),toArray:s=>s,has:(s,a)=>s.find(o=>r(o,a))!==void 0,without:(s,a)=>s.filter(o=>!r(o,a))};return new Kn(n,e)},Z0=e=>{const r=e?.hash??Hr,n=(a,o)=>r(a)===r(o),i={get name(){return"set"},add:(a,o)=>Jo(a,r,...o),count:a=>a.size,find:(a,o)=>Xo(a,o),filter:(a,o)=>Ko(a,o),toArray:a=>Vi(a),has:(a,o)=>Yo(a,o,n),without:(a,o)=>jh(Vi(a),o,n)};return new Kn(i,e)},wu=e=>{const r=Xr,n={get name(){return"circular"},add:(i,s)=>(i===void 0&&(i=mu(e.capacity)),s.forEach(a=>i=i?.add(a)),i),count:i=>i.length,find:(i,s)=>i.find(s),filter:(i,s)=>i.filter(s),toArray:i=>i,has:(i,s)=>i.find(a=>r(a,s))!==void 0,without:(i,s)=>i.filter(a=>!r(a,s))};return new Kn(n,e)},Du={};T(Du,{stack:()=>kn,stackMutable:()=>Cu});var Q0=(e,r,n)=>{const i=r.length+n.length,s=e.discardPolicy??"additions",a=e.capacity??i,o=i-a;switch(e.debug&&console.log(`Stack.push: stackLen: ${r.length} potentialLen: ${i} toRemove: ${o} policy: ${s}`),s){case"additions":return e.debug&&console.log(`Stack.push:DiscardAdditions: stackLen: ${r.length} slice: ${i-a} toAddLen: ${n.length}`),r.length===e.capacity?r:[...r,...n.slice(0,n.length-o)];case"newer":return o>=r.length?n.slice(Math.max(0,n.length-a),Math.min(n.length,a)+1):(e.debug&&console.log(` from orig: ${r.slice(0,r.length-o)}`),[...r.slice(0,r.length-o),...n.slice(0,Math.min(n.length,a-o+1))]);case"older":return[...r,...n].slice(o);default:throw new Error(`Unknown discard policy ${s}`)}},xu=(e,r,...n)=>{const i=r.length+n.length;return e.capacity&&i>e.capacity?Q0(e,r,n):[...r,...n]},Eu=(e,r)=>{if(r.length===0)throw new Error("Stack is empty");return r.slice(0,r.length-1)},Ui=(e,r)=>r[r.length-1],bu=(e,r)=>r.length===0,Au=(e,r)=>e.capacity?r.length>=e.capacity:!1,Gi=class{constructor(e,r){y(this,"opts"),y(this,"data"),this.opts=e,this.data=r}push(...e){return new Gi(this.opts,xu(this.opts,this.data,...e))}pop(){return new Gi(this.opts,Eu(this.opts,this.data))}forEach(e){this.data.forEach(e)}forEachFromTop(e){[...this.data].reverse().forEach(e)}get isEmpty(){return bu(this.opts,this.data)}get isFull(){return Au(this.opts,this.data)}get peek(){return Ui(this.opts,this.data)}get length(){return this.data.length}},ev=class{constructor(e,r){y(this,"opts"),y(this,"data"),this.opts=e,this.data=r}push(...e){return this.data=xu(this.opts,this.data,...e),this.data.length}forEach(e){this.data.forEach(e)}forEachFromTop(e){[...this.data].reverse().forEach(e)}pop(){const e=Ui(this.opts,this.data);return Eu(this.opts,this.data),e}get isEmpty(){return bu(this.opts,this.data)}get isFull(){return Au(this.opts,this.data)}get peek(){return Ui(this.opts,this.data)}get length(){return this.data.length}},kn=(e={},...r)=>new Gi({...e},[...r]),Cu=(e={},...r)=>new ev({...e},[...r]),Fu={};T(Fu,{queue:()=>Mu,queueMutable:()=>xr});var cn=(e,r)=>{e.debug&&console.log(`queue:${r}`)},tv=(e,r,n)=>{const i=r.length+n.length,s=e.capacity??i,a=i-s,o=e.discardPolicy??"additions";switch(cn(e,`queueLen: ${r.length} potentialLen: ${i} toRemove: ${a} policy: ${o}`),o){case"additions":return cn(e,`trimQueue:DiscardAdditions: queueLen: ${r.length} slice: ${i-s} toAddLen: ${n.length}`),r.length===e.capacity?r:[...r,...n.slice(0,a-1)];case"newer":if(a>=r.length)return n.slice(Math.max(0,n.length-s),Math.min(n.length,s)+1);{const u=n.slice(0,Math.min(n.length,s-a+1)),l=r.slice(0,r.length-a);cn(e,`trimQueue: toRemove: ${a} keeping: ${JSON.stringify(l)} from orig: ${JSON.stringify(r)} toAddFinal: ${JSON.stringify(u)}`);const c=[...l,...u];return cn(e,`final: ${JSON.stringify(c)}`),c}case"older":return[...r,...n].slice(a);default:throw new Error(`Unknown overflow policy ${o}`)}},Su=(e,r,...n)=>{if(e===void 0)throw new Error("opts parameter undefined");const i=r.length+n.length,s=e.capacity&&i>e.capacity,a=s?tv(e,r,n):[...r,...n];if(e.capacity&&a.length!==e.capacity&&s)throw new Error(`Bug! Expected return to be at capacity. Return len: ${a.length} capacity: ${e.capacity} opts: ${JSON.stringify(e)}`);if(!e.capacity&&a.length!==i)throw new Error(`Bug! Return length not expected. Return len: ${a.length} expected: ${i} opts: ${JSON.stringify(e)}`);return a},Bu=(e,r)=>{if(r.length===0)throw new Error("Queue is empty");return r.slice(1)},Ji=(e,r)=>r[0],_u=(e,r)=>r.length===0,Pu=(e,r)=>e.capacity?r.length>=e.capacity:!1,Yi=class{constructor(e,r){if(y(this,"opts"),y(this,"data"),e===void 0)throw new Error("opts parameter undefined");this.opts=e,this.data=r}forEach(e){for(let r=this.data.length-1;r>=0;r--)e(this.data[r])}forEachFromFront(e){this.data.forEach(r=>e(r))}enqueue(...e){return new Yi(this.opts,Su(this.opts,this.data,...e))}dequeue(){return new Yi(this.opts,Bu(this.opts,this.data))}get isEmpty(){return _u(this.opts,this.data)}get isFull(){return Pu(this.opts,this.data)}get length(){return this.data.length}get peek(){return Ji(this.opts,this.data)}},rv=class{constructor(e,r){if(y(this,"opts"),y(this,"data"),e===void 0)throw new Error("opts parameter undefined");this.opts=e,this.data=r}enqueue(...e){return this.data=Su(this.opts,this.data,...e),this.data.length}dequeue(){const e=Ji(this.opts,this.data);return this.data=Bu(this.opts,this.data),e}get isEmpty(){return _u(this.opts,this.data)}get isFull(){return Pu(this.opts,this.data)}get length(){return this.data.length}get peek(){return Ji(this.opts,this.data)}},Mu=(e={},...r)=>(e={...e},new Yi(e,[...r])),xr=(e={},...r)=>new rv({...e},[...r]),nv=(e,r)=>{const n=new Map(e.entries());return r.forEach(i=>{if(i[0]===void 0)throw new Error("key cannot be undefined");if(i[1]===void 0)throw new Error("value cannot be undefined");n.set(i[0],i[1])}),n},iv=(e,r)=>{const n=new Map(e.entries());return r.forEach(i=>{if(i.key===void 0)throw new Error("key cannot be undefined");if(i.value===void 0)throw new Error("value cannot be undefined");n.set(i.key,i.value)}),n},sv=(e,r)=>e.has(r),Or=(e,...r)=>{if(e===void 0)throw new Error("map parameter is undefined");if(r===void 0)throw new Error("data parameter i.s undefined");if(r.length===0)return e;const n=r[0];return typeof n.key<"u"&&typeof n.value<"u"?iv(e,r):nv(e,r)},av=(e,r,n)=>{const i=new Map(e.entries());return i.set(r,n),i},Nu=(e,r)=>{const n=new Map(e.entries());return n.delete(r),n},or=e=>{if(e===void 0)return or([]);if(Array.isArray(e))return or(Or(new Map,...e));const r=e;return{add:(...n)=>{const i=Or(r,...n);return or(i)},get:n=>r.get(n),delete:n=>or(Nu(r,n)),clear:()=>or(),has:n=>r.has(n),entries:()=>r.entries(),isEmpty:()=>r.size===0}},ov=(...e)=>{let r=Or(new Map,...e);return{add:(...n)=>{r=Or(r,...n)},delete:n=>{r=Nu(r,n)},clear:()=>{r=Or(new Map)},set:(n,i)=>{r=av(r,n,i)},get:n=>r.get(n),entries:()=>r.entries(),isEmpty:()=>r.size===0,has:n=>sv(r,n)}},Nt=e=>!(e===void 0||e.a===void 0||e.b===void 0||!w.isPoint(e.a)||!w.isPoint(e.b)),zu=e=>Array.isArray(e)?!e.some(n=>!Nt(n)):!1,ku=(e,r)=>w.isEqual(e.a,r.a)&&w.isEqual(e.b,r.b),$u=(e,r)=>Object.freeze({...e,a:r(e.a),b:r(e.b)}),Os=(e,r="line")=>{if(e===void 0)throw new Error(`${r} undefined`);if(e.a===void 0)throw new Error(`${r}.a undefined. Expected {a:Point, b:Point}`);if(e.b===void 0)throw new Error(`${r}.b undefined. Expected {a:Point, b:Point}`)},uv=(e,r)=>{let n;if(Nt(e))n=e.a,r=e.b;else if(n=e,r===void 0)throw new Error("b point must be provided");return Math.atan2(r.y-n.y,r.x-n.x)},Tu=(e,r)=>Object.freeze({...e,a:w.multiply(e.a,r),b:w.multiply(e.b,r)}),Iu=(e,r)=>Object.freeze({...e,a:w.divide(e.a,r),b:w.divide(e.b,r)}),Ru=(e,r)=>Object.freeze({...e,a:w.sum(e.a,r),b:w.sum(e.b,r)}),Lu=(e,r)=>Object.freeze({...e,a:w.subtract(e.a,r),b:w.subtract(e.b,r)}),lv=(e,r,n)=>Object.freeze({...e,a:w.normaliseByRect(e.a,r,n),b:w.normaliseByRect(e.b,r,n)}),ju=(e,r,n)=>Gu(e,r)<=n;function Ge(e,r){if(zu(e))return e.reduce((u,l)=>Ge(l)+u,0);const[n,i]=Xn(e,r),s=i.x-n.x,a=i.y-n.y;if(n.z!==void 0&&i.z!==void 0){const o=i.z-n.z;return Math.hypot(s,a,o)}else return Math.hypot(s,a)}var qu=(e,r)=>{const[n,i]=Xn(e,r);return _t(.5,n,i)},Xn=(e,r)=>{let n;if(Nt(e))r=e.b,n=e.a;else if(n=e,r===void 0)throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${JSON.stringify(n)} b: ${JSON.stringify(r)}`);return X(n,"a"),X(n,"b"),[n,r]},Ou=(e,r)=>{const n=i=>{const{a:s,b:a}=i,o={x:a.x-s.x,y:a.y-s.y},u={x:r.x-s.x,y:r.y-s.y},l=o.x*o.x+o.y*o.y;let c=u.x*o.x+u.y*o.y;const h=Math.min(1,Math.max(0,c/l));return c=(a.x-s.x)*(r.y-s.y)-(a.y-s.y)*(r.x-s.x),{x:s.x+o.x*h,y:s.y+o.y*h}};if(Array.isArray(e)){const i=e.map(a=>n(a)),s=i.map(a=>w.distance(a,r));return Object.freeze(i[Je.minIndex(...s)])}else return Object.freeze(n(e))},Vs=(e,r)=>{let n;if(Nt(e))n=e.a,r=e.b;else if(n=e,r===void 0)throw new Error("b parameter required");if(r!==void 0)return(r.y-n.y)/(r.x-n.x);throw Error("Second point missing")},Vu=e=>({x:e.b.x-e.a.x,y:e.b.y-e.a.y}),Wu=e=>{const r=Ge(e),n=Vu(e);return{x:n.x/r,y:n.y/r}},Hu=(e,r,n=0)=>{const i=_t(n,e),s=Wu(e);return{x:i.x-s.y*r,y:i.y+s.x*r}},Uu=(e,r)=>{const n=Vu(e),i=Wu(e),s={x:e.a.x-i.y*r,y:e.a.y+i.x*r};return{a:s,b:{x:s.x+n.x,y:s.y+n.y}}},cv=(e,r)=>{const n=_t(r/2,e),i=_t(.5+r/2,e);return{a:n,b:i}},hv=(e,r)=>{const n=e.a.y+(r-e.a.x)*Vs(e);return Object.freeze({x:r,y:n})},fv=(e,r)=>{const n=Ge(e);return Object.freeze({...e,a:e.a,b:Object.freeze({x:e.b.x+(e.b.x-e.a.x)/n*r,y:e.b.y+(e.b.y-e.a.y)/n*r})})};function*dv(e){const{a:r,b:n}=e;let i=Math.floor(r.x),s=Math.floor(r.y);const a=Math.floor(n.x),o=Math.floor(n.y),u=Math.abs(a-i),l=-Math.abs(o-s),c=i<a?1:-1,h=s<o?1:-1;let f=u+l;for(;yield{x:i,y:s},!(i===a&&s===o);){const d=2*f;d>=l&&(f+=l,i+=c),d<=u&&(f+=u,s+=h)}}var Gu=(e,r)=>{if(Array.isArray(e)){const n=e.map(i=>Ki(i,r));return yu(n)}else return Ki(e,r)},Ki=(e,r)=>{if(Os(e,"line"),X(r,"point"),Ge(e)===0)return Ge(e.a,r);const n=Ou(e,r);return Ge(n,r)};function _t(e,r,n,i){typeof n=="boolean"&&(i=n,n=void 0),i?M(e,"","amount"):Nf(e,"amount");const[s,a]=Xn(r,n),o=Ge(s,a),u=o*(1-e);if(o===0&&u===0)return Object.freeze({...a});const l=a.x-u*(a.x-s.x)/o,c=a.y-u*(a.y-s.y)/o;return Object.freeze({...a,x:l,y:c})}function Ju(e,r){if(Nt(e))Os(e,"a"),r=e.b,e=e.a;else if(r===void 0)throw new Error("Expect second point if first is a point");return w.toString(e)+"-"+w.toString(r)}var $n=(e,r,n,i)=>{if(Number.isNaN(e))throw new Error("x1 is NaN");if(Number.isNaN(n))throw new Error("x2 is NaN");if(Number.isNaN(r))throw new Error("y1 is NaN");if(Number.isNaN(i))throw new Error("y2 is NaN");return Zn({x:e,y:r},{x:n,y:i})},Yu=(e,r)=>{if(Nt(e))return[e.a.x,e.a.y,e.b.x,e.b.y];if(w.isPoint(e)&&w.isPoint(r))return[e.x,e.y,r.x,r.y];throw new Error("Expected single line parameter, or a and b points")};function*vv(e){for(const r of e)yield r.a,yield r.b}var Ku=(e,r)=>[`M${e.x} ${e.y} L ${r.x} ${r.y}`],yv=e=>{if(!Array.isArray(e))throw new Error("arr parameter is not an array");if(e.length!==4)throw new Error("array is expected to have length four");return $n(e[0],e[1],e[2],e[3])},Zn=(e,r)=>(X(e,"a"),X(r,"b"),e=Object.freeze({...e}),r=Object.freeze({...r}),Object.freeze({a:e,b:r})),Xu=(...e)=>{const r=[];let n=e[0];for(let i=1;i<e.length;i++)r.push(Zn(n,e[i])),n=e[i];return r},pv=(e,r)=>St(Zn(e,r)),Zu=e=>w.bbox(e.a,e.b),St=e=>{const{a:r,b:n}=e;return Object.freeze({...e,length:()=>Ge(r,n),interpolate:i=>_t(i,r,n),bbox:()=>Zu(e),toString:()=>Ju(r,n),toFlatArray:()=>Yu(r,n),toSvgString:()=>Ku(r,n),toPoints:()=>[r,n],rotate:(i,s)=>St(Qu(e,i,s)),sum:i=>St(Ru(e,i)),divide:i=>St(Iu(e,i)),multiply:i=>St(Tu(e,i)),subtract:i=>St(Lu(e,i)),midpoint:()=>qu(r,n),distance:i=>Ki(e,i),parallel:i=>Uu(e,i),perpendicularPoint:(i,s)=>Hu(e,i,s),slope:()=>Vs(e),withinRange:(i,s)=>ju(e,i,s),isEqual:i=>ku(e,i),apply:i=>St($u(e,i)),kind:"line"})},Qu=(e,r,n)=>r===void 0||r===0?e:(n===void 0&&(n=.5),typeof n=="number"&&(n=_t(n,e.a,e.b)),Object.freeze({...e,a:w.rotate(e.a,r,n),b:w.rotate(e.b,r,n)})),mv={};T(mv,{average:()=>wv,averageWeighted:()=>Dv,filter:()=>Cv,isValid:()=>el,max:()=>Ev,min:()=>xv,quantiseEvery:()=>Xi,total:()=>bv,tracker:()=>Av});var Ws=class{constructor(e="TrackerBase",r={}){this.id=e,y(this,"seenCount"),y(this,"storeIntermediate"),y(this,"resetAfterSamples"),this.storeIntermediate=r.storeIntermediate??!1,this.resetAfterSamples=r.resetAfterSamples??-1,this.seenCount=0}reset(){this.seenCount=0,this.onReset()}seen(...e){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples&&this.reset(),this.seenCount+=e.length;const r=this.seenImpl(e);this.onSeen(r)}onSeen(e){}},gv=class extends Ws{constructor(e,r){super(e,r);y(this,"values"),y(this,"timestamps"),this.values=[],this.timestamps=[]}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw new Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}seenImpl(e){const r=e.at(-1),n=Date.now();return this.storeIntermediate?(this.values.push(...e),this.timestamps.push(...$s(e.length,()=>n))):this.values.length===0?(this.values.push(r),this.timestamps.push(n)):this.values.length===2?(this.values[1]=r,this.timestamps[1]=n):this.values.length===1&&(this.values.push(r),this.timestamps.push(n)),e}},Hs=class extends gv{constructor(){super(...arguments);y(this,"total",0),y(this,"min",Number.MAX_SAFE_INTEGER),y(this,"max",Number.MIN_SAFE_INTEGER)}get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.total=0,super.onReset()}onSeen(e){if(e.some(r=>Number.isNaN(r)))throw Error("Cannot add NaN");this.total=e.reduce((r,n)=>r+n,this.total),this.min=Math.min(...e,this.min),this.max=Math.max(...e,this.max)}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}},Vr=(e,r)=>new Hs(e??"",r??{}),wv=(...e)=>lu(e),Dv=(e,...r)=>cu(r,e),xv=(...e)=>hu(e),Ev=(...e)=>du(e),bv=(...e)=>vu(e),el=e=>!(typeof e!="number"||Number.isNaN(e)),Av=(e,r)=>Vr(e,r);function*Cv(e){for(const r of e)el(r)&&(yield r)}var Xi=(e,r,n=!0)=>{let i=e/r;const s=i%1;return i=Math.floor(i),(s===.5&&n||s>.5)&&i++,r*i},Zt=(e,r)=>{if(e===void 0)return{x:0,y:0};if(w.isPoint(e))return e;if(typeof e!="number"||typeof r!="number")throw new Error(`Expected point or x,y as parameters. Got: a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`);return{x:e,y:r}},Fv=(...e)=>{const r=e.map(n=>w.toArray(n));return Je.dotProduct(r)},Tn=Object.freeze({x:0,y:0}),tl=Object.freeze({x:NaN,y:NaN}),Dn=e=>e.x===0&&e.y===0,xn=e=>Number.isNaN(e.x)&&Number.isNaN(e.y),Sv=e=>e.x===null&&e.y===null,Wt=(e,...r)=>{if(r.length===0)throw new Error("No points provided");let n=r[0];return r.forEach(i=>{n=e(n,i)}),n},Bv=(...e)=>Wt((r,n)=>r.x<=n.x?r:n,...e),_v=(...e)=>Wt((r,n)=>r.x>=n.x?r:n,...e);function dt(e,r,n){const i=Zt(r,n);return X(i),Math.hypot(i.x-e.x,i.y-e.y)}var Pv=(e,r)=>{if(re.isRectPositioned(r))return re.distanceFromExterior(r,e);if(yt.isCirclePositioned(r))return yt.distanceFromExterior(r,e);if(he(r))return dt(e,r);throw new Error("Unknown shape")},Mv=(e,r)=>{if(re.isRectPositioned(r))return re.distanceFromExterior(r,e);if(yt.isCirclePositioned(r))return yt.distanceFromExterior(r,e);if(he(r))return dt(e,r);throw new Error("Unknown shape")},X=(e,r="Point")=>{if(e===void 0)throw new Error(`'${r}' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e===null)throw new Error(`'${r}' is null. Expected {x,y} got ${JSON.stringify(e)}`);if(e.x===void 0)throw new Error(`'${r}.x' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e.y===void 0)throw new Error(`'${r}.y' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(typeof e.x!="number")throw new Error(`'${r}.x' must be a number. Got ${e.x}`);if(typeof e.y!="number")throw new Error(`'${r}.y' must be a number. Got ${e.y}`);if(e.x===null)throw new Error(`'${r}.x' is null`);if(e.y===null)throw new Error(`'${r}.y' is null`);if(Number.isNaN(e.x))throw new Error(`'${r}.x' is NaN`);if(Number.isNaN(e.y))throw new Error(`'${r}.y' is NaN`)},rl=(e,r="pt")=>(X(e,r),M(e.x,"nonZero",`${r}.x`),M(e.y,"nonZero",`${r}.y`),!0),Nv=e=>({...e,x:Math.abs(e.x),y:Math.abs(e.y)}),dr=(e,r,n)=>r===void 0?Math.atan2(e.y,e.x):n!==void 0?Math.atan2(r.y-e.y,r.x-e.x)-Math.atan2(n.y-e.y,n.x-e.x):Math.atan2(r.y-e.y,r.x-e.x),nl=(...e)=>{if(!Array.isArray(e))throw new Error("Expected list of points");const r=e.reduce((n,i)=>{if(i===void 0)return n;if(Array.isArray(i))throw new Error("'points' list contains an array. Did you mean: centroid(...myPoints)?");if(!he(i))throw new Error(`'points' contains something which is not a point: ${JSON.stringify(i)}`);return{x:n.x+i.x,y:n.y+i.y}},{x:0,y:0});return Object.freeze({x:r.x/e.length,y:r.y/e.length})},zv=(...e)=>{const r=Wt((c,h)=>c.x<h.x?c:h,...e),n=Wt((c,h)=>c.x>h.x?c:h,...e),i=Wt((c,h)=>c.y<h.y?c:h,...e),s=Wt((c,h)=>c.y>h.y?c:h,...e),a={x:r.x,y:i.y},o={x:n.x,y:i.y},u={x:n.x,y:s.y},l={x:r.x,y:s.y};return re.maxFromCorners(a,o,u,l)},he=e=>!(e===void 0||e===null||e.x===void 0||e.y===void 0),Zi=e=>!(e===void 0||e===null||e.x===void 0||e.y===void 0||e.z===void 0),kv=e=>[e.x,e.y],$v=(e,r)=>{if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=r?e.x.toFixed(r):e.x,i=r?e.y.toFixed(r):e.y;if(e.z!==void 0){const s=r?e.z.toFixed(r):e.z;return`(${n},${i},${s})`}else return`(${n},${i})`},Wr=(...e)=>{if(e===void 0)throw new Error("parameter 'p' is undefined");if(e.length<2)return!0;for(let r=1;r<e.length;r++)if(e[r].x!==e[0].x||e[r].y!==e[0].y)return!1;return!0},Tv=(e,r,n)=>{typeof n=="number"&&(n={x:n,y:n});const i=Math.abs(r.x-e.x),s=Math.abs(r.y-e.y);return i<=n.x&&s<=n.y},Iv=(e,r,n,i=!1)=>_t(e,r,n,i),Rv=(e,r)=>{if(Array.isArray(e)){if(e.length!==2)throw new Error("Expected array of length two, got "+e.length);return Object.freeze({x:e[0],y:e[1]})}else{if(e===void 0)e=0;else if(Number.isNaN(e))throw new Error("x is NaN");if(r===void 0)r=0;else if(Number.isNaN(r))throw new Error("y is NaN");return Object.freeze({x:e,y:r})}},il=(...e)=>{const r=[];if(Array.isArray(e[0]))e.forEach(n=>{if(n.length%2!==0)throw new Error("coords array should be even-numbered");r.push(Object.freeze({x:n[0],y:n[1]}))});else{if(e.length%2!==0)throw new Error("Expected even number of elements: [x,y,x,y...]");for(let n=0;n<e.length;n+=2)r.push(Object.freeze({x:e[n],y:e[n+1]}))}return r};function Us(e,r,n,i){if(he(e))return X(e,"a"),he(r)?(X(r,"b"),Object.freeze({x:e.x-r.x,y:e.y-r.y})):(n===void 0&&(n=r),Object.freeze({x:e.x-r,y:e.y-n}));if(M(e,"","a"),typeof r!="number")throw new Error("Second parameter is expected to by y value");if(M(r,"","b"),Number.isNaN(n))throw new Error("Third parameter is NaN");if(Number.isNaN(i))throw new Error("Fourth parameter is NaN");return n===void 0&&(n=0),i===void 0&&(i=0),Object.freeze({x:e-n,y:r-i})}var Lv=(e,r)=>Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y")}),jv=(e,...r)=>sl(...r)(e),sl=(...e)=>r=>e.reduce((n,i)=>i(n),r),al=(e,r,n={x:0,y:0})=>{let i=n;return e.forEach(s=>{i=r(s,i)}),i},qv=function(e,r,n,i){if(e===void 0)throw new Error(`a missing. a: ${e}`);let s,a;if(he(e))if(s=e,r===void 0&&(r=Tn),he(r))a=r;else{if(r===void 0)throw new Error("Expects x coordinate");a={x:r,y:n===void 0?r:n}}else if(!he(r)){if(r===void 0)throw new Error("Expected number as second param");if(s={x:e,y:r},n===void 0)throw new Error("Expects x coordiante");a={x:n,y:i===void 0?0:i}}if(s===void 0)throw new Error(`ptA missing. a: ${e}`);if(a===void 0)throw new Error(`ptB missing. b: ${r}`);return X(s,"a"),X(a,"b"),Object.freeze({x:s.x+a.x,y:s.y+a.y})};function ol(e,r,n){if(X(e,"a"),typeof r=="number")return typeof n>"u"&&(n=r),M(n,"","y"),M(r,"","x"),Object.freeze({x:e.x*r,y:e.y*n});if(he(r))return X(r,"b"),Object.freeze({x:e.x*r.x,y:e.y*r.y});if(re.isRect(r))return re.guard(r,"rect"),Object.freeze({x:e.x*r.width,y:e.y*r.height});throw new Error(`Invalid arguments. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)}function Ov(e,r,n,i){if(he(e))return X(e,"a"),he(r)?(rl(r),Object.freeze({x:e.x/r.x,y:e.y/r.y})):re.isRect(r)?(re.guard(r,"rect"),Object.freeze({x:e.x/r.width,y:e.y/r.height})):(n===void 0&&(n=r),X(e),M(r,"nonZero","x"),M(n,"nonZero","y"),Object.freeze({x:e.x/r,y:e.y/n}));if(typeof r!="number")throw new Error("expected second parameter to be y1 coord");return M(e,"positive","x1"),M(r,"positive","y1"),n===void 0&&(n=1),i===void 0&&(i=n),M(n,"nonZero","x2"),M(i,"nonZero","y2"),Object.freeze({x:e/n,y:r/i})}var Vv=(e,r,n=!0)=>Object.freeze({x:Xi(e.x,r.x,n),y:Xi(e.y,r.y,n)}),Wv=(...e)=>{const r=[...e].sort(ul);if(r.length===1)return r;const n=a=>{const o=[];return a.forEach(u=>{for(;o.length>=2;){const l=o[o.length-1],c=o[o.length-2];if((l.x-c.x)*(u.y-c.y)>=(l.y-c.y)*(u.x-c.x))o.pop();else break}o.push(u)}),o.pop(),o},i=n(r),s=n(r.reverse());return i.length===1&&s.length===1&&Wr(s[0],i[0])?i:i.concat(s)},Hv=(e,r)=>e.x<r.x&&e.y<r.y?-2:e.x>r.x&&e.y>r.y?2:e.x<r.x||e.y<r.y?-1:e.x>r.x||e.y>r.y?1:e.x===r.x&&e.x===r.y?0:NaN,ul=(e,r)=>e.x-r.x||e.y-r.y,Qi=(e,r,n)=>{const i=Math.cos(n)*r+e.x,s=Math.sin(n)*r+e.y;return{x:i,y:s}};function Ut(e,r,n){n===void 0&&(n={x:0,y:0}),X(n,"origin"),M(r,"","amountRadian");const i=Array.isArray(e);if(r===0)return e;i||(e=[e]);const s=e;s.forEach((l,c)=>X(l,`pt[${c}]`));const u=s.map(l=>Ze.fromCartesian(l,n)).map(l=>Ze.rotate(l,r)).map(l=>Ze.toCartesian(l,n));return i?u:u[0]}var Uv=(e,r)=>{const n=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],i=[];for(let s=0;s<e.length;++s)i[s]=[n[0][0]*e[s][0]+n[0][1]*e[s][1],n[1][0]*e[s][0]+n[1][1]*e[s][1]];return i},Gv=(e,r)=>{if(he(e)&&(r=e.y,e=e.x),r===void 0)throw new Error("Expected y");return Math.sqrt(e*e+r*r)},Jv=(e,r)=>{const n=Zt(e,r),i=Gv(n);return i===0?w.Empty:Object.freeze({x:n.x/i,y:n.y/i})};function Yv(e,r,n,i){if(he(e)){if(typeof r=="number"&&n!==void 0)M(r,"positive","width"),M(n,"positive","height");else{if(!re.isRect(r))throw new Error("Expected second parameter to be a rect");n=r.height,r=r.width}return Object.freeze({x:e.x/r,y:e.y/n})}else{if(M(e,"positive","x"),typeof r!="number")throw new Error("Expecting second parameter to be a number (width)");if(typeof n!="number")throw new Error("Expecting third parameter to be a number (height)");if(M(r,"positive","y"),M(n,"positive","width"),i===void 0)throw new Error("Expected height parameter");return M(i,"positive","height"),Object.freeze({x:e/n,y:r/i})}}var Kv=e=>(e===void 0&&(e=Ye),{x:e(),y:e()}),Xv=(e,r={x:1,y:1},n={x:0,y:0})=>(X(e,"pt"),X(r,"ptMax"),X(n,"ptMin"),Object.freeze({x:Un(e.x,n.x,r.x),y:Un(e.y,n.y,r.y)})),Zv=(e,r="both")=>{switch(r){case"both":return Zi(e)?Object.freeze({...e,x:e.x*-1,y:e.y*-1,z:e.z*-1}):Object.freeze({...e,x:e.x*-1,y:e.y*-1});case"x":return Object.freeze({...e,x:e.x*-1});case"y":return Object.freeze({...e,y:e.y*-1});case"z":if(Zi(e))return Object.freeze({...e,z:e.z*-1});throw new Error("pt parameter is missing z");default:throw new Error("Unknown what parameter. Expecting 'both', 'x' or 'y'")}},Qv=(e,r=Math.round)=>(X(e,"pt"),Object.freeze({x:r(e.x),y:r(e.y)})),ey=(e,r)=>{const n=dt(e);if(n>r){const i=r/n;return ol(e,i,i)}return e};function ty(e,r,n,i){if(he(e))return r===void 0&&(r=0),n===void 0&&(n=1),M(r,"","min"),M(n,"","max"),Object.freeze({x:$e(e.x,r,n),y:$e(e.y,r,n)});if(r===void 0)throw new Error("Expected y coordinate");return n===void 0&&(n=0),i===void 0&&(i=1),M(e,"","x"),M(r,"","y"),M(n,"","min"),M(i,"","max"),Object.freeze({x:$e(e,n,i),y:$e(r,n,i)})}var es=(e,r)=>{const n=Zt(e,r);let i=0,s=0,a=0,o=performance.now();return(l,c)=>{const h=Zt(l,c);i+=h.x,s+=h.y,a++;const f=dt(h,n),d=performance.now(),D=f/(d-o);return o=d,Object.freeze({angle:dr(h,n),distance:f,speed:D,centroid:nl(h,n),average:{x:i/a,y:s/a}})}},ll=e=>e.startRadian!==void 0&&e.endRadian!==void 0,ht=e=>e.x!==void 0&&e.y!==void 0,no=Math.PI*2;function ry(e,r,n,i){const s={radius:e,startRadian:Bt(r),endRadian:Bt(n)};if(he(i)){X(i);const a={...s,x:i.x,y:i.y};return Object.freeze(a)}else return Object.freeze(s)}var cl=e=>Ne.fromPoints(In(e,e.startRadian),In(e,e.endRadian)),In=(e,r,n)=>{if(r>e.endRadian)throw new Error("angleRadian beyond end angle of arc");if(r<e.startRadian)throw new Error("angleRadian beyond start angle of arc");return n===void 0&&(ht(e)?n=e:n={x:0,y:0}),{x:Math.cos(r)*e.radius+n.x,y:Math.sin(r)*e.radius+n.y}},Gs=e=>{if(e===void 0)throw new Error("Arc is undefined");if(ht(e)&&X(e,"arc"),e.radius===void 0)throw new Error(`Arc radius is undefined (${JSON.stringify(e)})`);if(typeof e.radius!="number")throw new Error("Radius must be a number");if(Number.isNaN(e.radius))throw new Error("Radius is NaN");if(e.radius<=0)throw new Error("Radius must be greater than zero");if(e.startRadian===void 0)throw new Error("Arc is missing 'startRadian' field");if(e.endRadian===void 0)throw new Error("Arc is missing 'startRadian' field");if(Number.isNaN(e.endRadian))throw new Error("Arc endRadian is NaN");if(Number.isNaN(e.startRadian))throw new Error("Arc endRadian is NaN");if(e.startRadian>=e.endRadian)throw new Error("startRadian is expected to be les than endRadian")},Js=(e,r,n)=>(Gs(r),In(r,r.startRadian+(r.endRadian-r.startRadian)*e,n)),ny=e=>(Gs(e),Object.freeze({...e,interpolate:r=>Js(r,e),bbox:()=>fl(e),length:()=>hl(e),toSvgString:()=>dl(e),kind:"arc"})),hl=e=>no*e.radius*((e.startRadian-e.endRadian)/no),fl=e=>{if(ht(e)){const r=Js(.5,e),n=cl(e);return w.bbox(r,n.a,n.b)}else return{width:e.radius*2,height:e.radius*2}},dl=(e,r,n,i,s)=>{if(ll(e))return ht(e)?hn(e,e.radius,e.startRadian,e.endRadian,r):he(r)?hn(r,e.radius,e.startRadian,e.endRadian,n):hn({x:0,y:0},e.radius,e.startRadian,e.endRadian);if(n===void 0)throw new Error("startAngle undefined");if(i===void 0)throw new Error("endAngle undefined");if(he(e)){if(typeof r=="number"&&typeof n=="number"&&typeof i=="number")return hn(e,r,n,i,s);throw new Error("Expected (point, number, number, number). Missing a number param.")}else throw new Error("Expected (point, number, number, number). Missing first point.")},hn=(e,r,n,i,s)=>{(s===void 0||typeof s!="object")&&(s={});const a=i-n===360,o=Ze.toCartesian(r,i-.01,e),u=Ze.toCartesian(r,n,e),{largeArc:l=!1,sweep:c=!1}=s,h=[`
    M ${o.x} ${o.y}
    A ${r} ${r} 0 ${l?"1":"0"} ${c?"1":"0"} ${u.x} ${u.y},
  `];return a&&h.push("z"),h},iy=(e,r)=>w.distance(e,r),sy=(e,r)=>e.radius!==r.radius?!1:ht(e)&&ht(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):!(!(!ht(e)&&!ht(r))||e.endRadian!==r.endRadian||e.startRadian!==r.startRadian),Zr={};T(Zr,{computeQuadraticSimple:()=>vy,cubic:()=>yy,isCubicBezier:()=>Ys,isQuadraticBezier:()=>Qn,quadratic:()=>pl,quadraticBend:()=>dy,quadraticSimple:()=>vr,quadraticToSvgString:()=>yl,toPath:()=>bn});var{abs:Nr,cos:ut,sin:ir,acos:ay,atan2:zr,sqrt:Et,pow:ke}=Math;function kr(e){return e<0?-ke(-e,1/3):ke(e,1/3)}var vl=Math.PI,fn=2*vl,bt=vl/2,oy=1e-6,Si=Number.MAX_SAFE_INTEGER||9007199254740991,Bi=Number.MIN_SAFE_INTEGER||-9007199254740991,uy={x:0,y:0,z:0},A={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,r){const n=r(e);let i=n.x*n.x+n.y*n.y;return typeof n.z<"u"&&(i+=n.z*n.z),Et(i)},compute:function(e,r,n){if(e===0)return r[0].t=0,r[0];const i=r.length-1;if(e===1)return r[i].t=1,r[i];const s=1-e;let a=r;if(i===0)return r[0].t=e,r[0];if(i===1){const u={x:s*a[0].x+e*a[1].x,y:s*a[0].y+e*a[1].y,t:e};return n&&(u.z=s*a[0].z+e*a[1].z),u}if(i<4){let u=s*s,l=e*e,c,h,f,d=0;i===2?(a=[a[0],a[1],a[2],uy],c=u,h=s*e*2,f=l):i===3&&(c=u*s,h=u*e*3,f=s*l*3,d=e*l);const D={x:c*a[0].x+h*a[1].x+f*a[2].x+d*a[3].x,y:c*a[0].y+h*a[1].y+f*a[2].y+d*a[3].y,t:e};return n&&(D.z=c*a[0].z+h*a[1].z+f*a[2].z+d*a[3].z),D}const o=JSON.parse(JSON.stringify(r));for(;o.length>1;){for(let u=0;u<o.length-1;u++)o[u]={x:o[u].x+(o[u+1].x-o[u].x)*e,y:o[u].y+(o[u+1].y-o[u].y)*e},typeof o[u].z<"u"&&(o[u]=o[u].z+(o[u+1].z-o[u].z)*e);o.splice(o.length-1,1)}return o[0].t=e,o[0]},computeWithRatios:function(e,r,n,i){const s=1-e,a=n,o=r;let u=a[0],l=a[1],c=a[2],h=a[3],f;if(u*=s,l*=e,o.length===2)return f=u+l,{x:(u*o[0].x+l*o[1].x)/f,y:(u*o[0].y+l*o[1].y)/f,z:i?(u*o[0].z+l*o[1].z)/f:!1,t:e};if(u*=s,l*=2*s,c*=e*e,o.length===3)return f=u+l+c,{x:(u*o[0].x+l*o[1].x+c*o[2].x)/f,y:(u*o[0].y+l*o[1].y+c*o[2].y)/f,z:i?(u*o[0].z+l*o[1].z+c*o[2].z)/f:!1,t:e};if(u*=s,l*=1.5*s,c*=3*s,h*=e*e*e,o.length===4)return f=u+l+c+h,{x:(u*o[0].x+l*o[1].x+c*o[2].x+h*o[3].x)/f,y:(u*o[0].y+l*o[1].y+c*o[2].y+h*o[3].y)/f,z:i?(u*o[0].z+l*o[1].z+c*o[2].z+h*o[3].z)/f:!1,t:e}},derive:function(e,r){const n=[];for(let i=e,s=i.length,a=s-1;s>1;s--,a--){const o=[];for(let u=0,l;u<a;u++)l={x:a*(i[u+1].x-i[u].x),y:a*(i[u+1].y-i[u].y)},r&&(l.z=a*(i[u+1].z-i[u].z)),o.push(l);n.push(o),i=o}return n},between:function(e,r,n){return r<=e&&e<=n||A.approximately(e,r)||A.approximately(e,n)},approximately:function(e,r,n){return Nr(e-r)<=(n||oy)},length:function(e){const n=A.Tvalues.length;let i=0;for(let s=0,a;s<n;s++)a=.5*A.Tvalues[s]+.5,i+=A.Cvalues[s]*A.arcfn(a,e);return .5*i},map:function(e,r,n,i,s){const a=n-r,o=s-i,u=e-r,l=u/a;return i+o*l},lerp:function(e,r,n){const i={x:r.x+e*(n.x-r.x),y:r.y+e*(n.y-r.y)};return r.z!==void 0&&n.z!==void 0&&(i.z=r.z+e*(n.z-r.z)),i},pointToString:function(e){let r=e.x+"/"+e.y;return typeof e.z<"u"&&(r+="/"+e.z),r},pointsToString:function(e){return"["+e.map(A.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,r,n){const i=r.x-e.x,s=r.y-e.y,a=n.x-e.x,o=n.y-e.y,u=i*o-s*a,l=i*a+s*o;return zr(u,l)},round:function(e,r){const n=""+e,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+r))},dist:function(e,r){const n=e.x-r.x,i=e.y-r.y;return Et(n*n+i*i)},closest:function(e,r){let n=ke(2,63),i,s;return e.forEach(function(a,o){s=A.dist(r,a),s<n&&(n=s,i=o)}),{mdist:n,mpos:i}},abcratio:function(e,r){if(r!==2&&r!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const n=ke(e,r)+ke(1-e,r),i=n-1;return Nr(i/n)},projectionratio:function(e,r){if(r!==2&&r!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const n=ke(1-e,r),i=ke(e,r)+n;return n/i},lli8:function(e,r,n,i,s,a,o,u){const l=(e*i-r*n)*(s-o)-(e-n)*(s*u-a*o),c=(e*i-r*n)*(a-u)-(r-i)*(s*u-a*o),h=(e-n)*(a-u)-(r-i)*(s-o);return h==0?!1:{x:l/h,y:c/h}},lli4:function(e,r,n,i){const s=e.x,a=e.y,o=r.x,u=r.y,l=n.x,c=n.y,h=i.x,f=i.y;return A.lli8(s,a,o,u,l,c,h,f)},lli:function(e,r){return A.lli4(e,e.c,r,r.c)},makeline:function(e,r){return new ae(e.x,e.y,(e.x+r.x)/2,(e.y+r.y)/2,r.x,r.y)},findbbox:function(e){let r=Si,n=Si,i=Bi,s=Bi;return e.forEach(function(a){const o=a.bbox();r>o.x.min&&(r=o.x.min),n>o.y.min&&(n=o.y.min),i<o.x.max&&(i=o.x.max),s<o.y.max&&(s=o.y.max)}),{x:{min:r,mid:(r+i)/2,max:i,size:i-r},y:{min:n,mid:(n+s)/2,max:s,size:s-n}}},shapeintersections:function(e,r,n,i,s){if(!A.bboxoverlap(r,i))return[];const a=[],o=[e.startcap,e.forward,e.back,e.endcap],u=[n.startcap,n.forward,n.back,n.endcap];return o.forEach(function(l){l.virtual||u.forEach(function(c){if(c.virtual)return;const h=l.intersects(c,s);h.length>0&&(h.c1=l,h.c2=c,h.s1=e,h.s2=n,a.push(h))})}),a},makeshape:function(e,r,n){const i=r.points.length,s=e.points.length,a=A.makeline(r.points[i-1],e.points[0]),o=A.makeline(e.points[s-1],r.points[0]),u={startcap:a,forward:e,back:r,endcap:o,bbox:A.findbbox([a,e,r,o])};return u.intersections=function(l){return A.shapeintersections(u,u.bbox,l,l.bbox,n)},u},getminmax:function(e,r,n){if(!n)return{min:0,max:0};let i=Si,s=Bi,a,o;n.indexOf(0)===-1&&(n=[0].concat(n)),n.indexOf(1)===-1&&n.push(1);for(let u=0,l=n.length;u<l;u++)a=n[u],o=e.get(a),o[r]<i&&(i=o[r]),o[r]>s&&(s=o[r]);return{min:i,mid:(i+s)/2,max:s,size:s-i}},align:function(e,r){const n=r.p1.x,i=r.p1.y,s=-zr(r.p2.y-i,r.p2.x-n),a=function(o){return{x:(o.x-n)*ut(s)-(o.y-i)*ir(s),y:(o.x-n)*ir(s)+(o.y-i)*ut(s)}};return e.map(a)},roots:function(e,r){r=r||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=e.length-1,i=A.align(e,r),s=function(R){return 0<=R&&R<=1};if(n===2){const R=i[0].y,Y=i[1].y,te=i[2].y,j=R-2*Y+te;if(j!==0){const pe=-Et(Y*Y-R*te),fe=-R+Y,p=-(pe+fe)/j,m=-(-pe+fe)/j;return[p,m].filter(s)}else if(Y!==te&&j===0)return[(2*Y-te)/(2*Y-2*te)].filter(s);return[]}const a=i[0].y,o=i[1].y,u=i[2].y,l=i[3].y;let c=-a+3*o-3*u+l,h=3*a-6*o+3*u,f=-3*a+3*o,d=a;if(A.approximately(c,0)){if(A.approximately(h,0))return A.approximately(f,0)?[]:[-d/f].filter(s);const R=Et(f*f-4*h*d),Y=2*h;return[(R-f)/Y,(-f-R)/Y].filter(s)}h/=c,f/=c,d/=c;const D=(3*f-h*h)/3,F=D/3,B=(2*h*h*h-9*h*f+27*d)/27,_=B/2,N=_*_+F*F*F;let O,ee,P,I,Q;if(N<0){const R=-D/3,Y=R*R*R,te=Et(Y),j=-B/(2*te),pe=j<-1?-1:j>1?1:j,fe=ay(pe),p=kr(te),m=2*p;return P=m*ut(fe/3)-h/3,I=m*ut((fe+fn)/3)-h/3,Q=m*ut((fe+2*fn)/3)-h/3,[P,I,Q].filter(s)}else{if(N===0)return O=_<0?kr(-_):-kr(_),P=2*O-h/3,I=-O-h/3,[P,I].filter(s);{const R=Et(N);return O=kr(-_+R),ee=kr(_+R),[O-ee-h/3].filter(s)}}},droots:function(e){if(e.length===3){const r=e[0],n=e[1],i=e[2],s=r-2*n+i;if(s!==0){const a=-Et(n*n-r*i),o=-r+n,u=-(a+o)/s,l=-(-a+o)/s;return[u,l]}else if(n!==i&&s===0)return[(2*n-i)/(2*(n-i))];return[]}if(e.length===2){const r=e[0],n=e[1];return r!==n?[r/(r-n)]:[]}return[]},curvature:function(e,r,n,i,s){let a,o,u,l,c=0,h=0;const f=A.compute(e,r),d=A.compute(e,n),D=f.x*f.x+f.y*f.y;if(i?(a=Et(ke(f.y*d.z-d.y*f.z,2)+ke(f.z*d.x-d.z*f.x,2)+ke(f.x*d.y-d.x*f.y,2)),o=ke(D+f.z*f.z,3/2)):(a=f.x*d.y-f.y*d.x,o=ke(D,3/2)),a===0||o===0)return{k:0,r:0};if(c=a/o,h=o/a,!s){const F=A.curvature(e-.001,r,n,i,!0).k,B=A.curvature(e+.001,r,n,i,!0).k;l=(B-c+(c-F))/2,u=(Nr(B-c)+Nr(c-F))/2}return{k:c,r:h,dk:l,adk:u}},inflections:function(e){if(e.length<4)return[];const r=A.align(e,{p1:e[0],p2:e.slice(-1)[0]}),n=r[2].x*r[1].y,i=r[3].x*r[1].y,s=r[1].x*r[2].y,a=r[3].x*r[2].y,o=18*(-3*n+2*i+3*s-a),u=18*(3*n-i-3*s),l=18*(s-n);if(A.approximately(o,0)){if(!A.approximately(u,0)){let d=-l/u;if(0<=d&&d<=1)return[d]}return[]}const c=2*o;if(A.approximately(c,0))return[];const h=u*u-4*o*l;if(h<0)return[];const f=Math.sqrt(h);return[(f-u)/c,-(u+f)/c].filter(function(d){return 0<=d&&d<=1})},bboxoverlap:function(e,r){const n=["x","y"],i=n.length;for(let s=0,a,o,u,l;s<i;s++)if(a=n[s],o=e[a].mid,u=r[a].mid,l=(e[a].size+r[a].size)/2,Nr(o-u)>=l)return!1;return!0},expandbox:function(e,r){r.x.min<e.x.min&&(e.x.min=r.x.min),r.y.min<e.y.min&&(e.y.min=r.y.min),r.z&&r.z.min<e.z.min&&(e.z.min=r.z.min),r.x.max>e.x.max&&(e.x.max=r.x.max),r.y.max>e.y.max&&(e.y.max=r.y.max),r.z&&r.z.max>e.z.max&&(e.z.max=r.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,r,n){const i=e.bbox(),s=r.bbox(),a=1e5,o=n||.5;if(i.x.size+i.y.size<o&&s.x.size+s.y.size<o)return[(a*(e._t1+e._t2)/2|0)/a+"/"+(a*(r._t1+r._t2)/2|0)/a];let u=e.split(.5),l=r.split(.5),c=[{left:u.left,right:l.left},{left:u.left,right:l.right},{left:u.right,right:l.right},{left:u.right,right:l.left}];c=c.filter(function(f){return A.bboxoverlap(f.left.bbox(),f.right.bbox())});let h=[];return c.length===0||(c.forEach(function(f){h=h.concat(A.pairiteration(f.left,f.right,o))}),h=h.filter(function(f,d){return h.indexOf(f)===d})),h},getccenter:function(e,r,n){const i=r.x-e.x,s=r.y-e.y,a=n.x-r.x,o=n.y-r.y,u=i*ut(bt)-s*ir(bt),l=i*ir(bt)+s*ut(bt),c=a*ut(bt)-o*ir(bt),h=a*ir(bt)+o*ut(bt),f=(e.x+r.x)/2,d=(e.y+r.y)/2,D=(r.x+n.x)/2,F=(r.y+n.y)/2,B=f+u,_=d+l,N=D+c,O=F+h,ee=A.lli8(f,d,B,_,D,F,N,O),P=A.dist(ee,e);let I=zr(e.y-ee.y,e.x-ee.x),Q=zr(r.y-ee.y,r.x-ee.x),R=zr(n.y-ee.y,n.x-ee.x),Y;return I<R?((I>Q||Q>R)&&(I+=fn),I>R&&(Y=R,R=I,I=Y)):R<Q&&Q<I?(Y=R,R=I,I=Y):R+=fn,ee.s=I,ee.e=R,ee.r=P,ee},numberSort:function(e,r){return e-r}},En=class{constructor(e){this.curves=[],this._3d=!1,e&&(this.curves=e,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(e){return A.pointsToString(e.points)}).join(", ")+"]"}addCurve(e){this.curves.push(e),this._3d=this._3d||e._3d}length(){return this.curves.map(function(e){return e.length()}).reduce(function(e,r){return e+r})}curve(e){return this.curves[e]}bbox(){const e=this.curves;for(var r=e[0].bbox(),n=1;n<e.length;n++)A.expandbox(r,e[n].bbox());return r}offset(e){const r=[];return this.curves.forEach(function(n){r.push(...n.offset(e))}),new En(r)}},{abs:$r,min:io,max:so,cos:ly,sin:cy,acos:hy,sqrt:Tr}=Math,fy=Math.PI,ae=class{constructor(e){let r=e&&e.forEach?e:Array.from(arguments).slice(),n=!1;if(typeof r[0]=="object"){n=r.length;const d=[];r.forEach(function(D){["x","y","z"].forEach(function(F){typeof D[F]<"u"&&d.push(D[F])})}),r=d}let i=!1;const s=r.length;if(n){if(n>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(s!==6&&s!==8&&s!==9&&s!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const a=this._3d=!i&&(s===9||s===12)||e&&e[0]&&typeof e[0].z<"u",o=this.points=[];for(let d=0,D=a?3:2;d<s;d+=D){var u={x:r[d],y:r[d+1]};a&&(u.z=r[d+2]),o.push(u)}const l=this.order=o.length-1,c=this.dims=["x","y"];a&&c.push("z"),this.dimlen=c.length;const h=A.align(o,{p1:o[0],p2:o[l]}),f=A.dist(o[0],o[l]);this._linear=h.reduce((d,D)=>d+$r(D.y),0)<f/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(e,r,n,i){if(typeof i>"u"&&(i=.5),i===0)return new ae(r,r,n);if(i===1)return new ae(e,r,r);const s=ae.getABC(2,e,r,n,i);return new ae(e,s.A,n)}static cubicFromPoints(e,r,n,i,s){typeof i>"u"&&(i=.5);const a=ae.getABC(3,e,r,n,i);typeof s>"u"&&(s=A.dist(r,a.C));const o=s*(1-i)/i,u=A.dist(e,n),l=(n.x-e.x)/u,c=(n.y-e.y)/u,h=s*l,f=s*c,d=o*l,D=o*c,F={x:r.x-h,y:r.y-f},B={x:r.x+d,y:r.y+D},_=a.A,N={x:_.x+(F.x-_.x)/(1-i),y:_.y+(F.y-_.y)/(1-i)},O={x:_.x+(B.x-_.x)/i,y:_.y+(B.y-_.y)/i},ee={x:e.x+(N.x-e.x)/i,y:e.y+(N.y-e.y)/i},P={x:n.x+(O.x-n.x)/(1-i),y:n.y+(O.y-n.y)/(1-i)};return new ae(e,ee,P,n)}static getUtils(){return A}getUtils(){return ae.getUtils()}static get PolyBezier(){return En}valueOf(){return this.toString()}toString(){return A.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const e=this.points,r=e[0].x,n=e[0].y,i=["M",r,n,this.order===2?"Q":"C"];for(let s=1,a=e.length;s<a;s++)i.push(e[s].x),i.push(e[s].y);return i.join(" ")}setRatios(e){if(e.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=e,this._lut=[]}verify(){const e=this.coordDigest();e!==this._print&&(this._print=e,this.update())}coordDigest(){return this.points.map(function(e,r){return""+r+e.x+e.y+(e.z?e.z:0)}).join("")}update(){this._lut=[],this.dpoints=A.derive(this.points,this._3d),this.computedirection()}computedirection(){const e=this.points,r=A.angle(e[0],e[this.order],e[1]);this.clockwise=r>0}length(){return A.length(this.derivative.bind(this))}static getABC(e=2,r,n,i,s=.5){const a=A.projectionratio(s,e),o=1-a,u={x:a*r.x+o*i.x,y:a*r.y+o*i.y},l=A.abcratio(s,e);return{A:{x:n.x+(n.x-u.x)/l,y:n.y+(n.y-u.y)/l},B:n,C:u,S:r,E:i}}getABC(e,r){r=r||this.get(e);let n=this.points[0],i=this.points[this.order];return ae.getABC(this.order,n,r,i,e)}getLUT(e){if(this.verify(),e=e||100,this._lut.length===e)return this._lut;this._lut=[],e++,this._lut=[];for(let r=0,n,i;r<e;r++)i=r/(e-1),n=this.compute(i),n.t=i,this._lut.push(n);return this._lut}on(e,r){r=r||5;const n=this.getLUT(),i=[];for(let s=0,a,o=0;s<n.length;s++)a=n[s],A.dist(a,e)<r&&(i.push(a),o+=s/n.length);return i.length?t/=i.length:!1}project(e){const r=this.getLUT(),n=r.length-1,i=A.closest(r,e),s=i.mpos,a=(s-1)/n,o=(s+1)/n,u=.1/n;let l=i.mdist,c=a,h=c,f;l+=1;for(let d;c<o+u;c+=u)f=this.compute(c),d=A.dist(e,f),d<l&&(l=d,h=c);return h=h<0?0:h>1?1:h,f=this.compute(h),f.t=h,f.d=l,f}get(e){return this.compute(e)}point(e){return this.points[e]}compute(e){return this.ratios?A.computeWithRatios(e,this.points,this.ratios,this._3d):A.compute(e,this.points,this._3d,this.ratios)}raise(){const e=this.points,r=[e[0]],n=e.length;for(let i=1,s,a;i<n;i++)s=e[i],a=e[i-1],r[i]={x:(n-i)/n*s.x+i/n*a.x,y:(n-i)/n*s.y+i/n*a.y};return r[n]=e[n-1],new ae(r)}derivative(e){return A.compute(e,this.dpoints[0],this._3d)}dderivative(e){return A.compute(e,this.dpoints[1],this._3d)}align(){let e=this.points;return new ae(A.align(e,{p1:e[0],p2:e[e.length-1]}))}curvature(e){return A.curvature(e,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return A.inflections(this.points)}normal(e){return this._3d?this.__normal3(e):this.__normal2(e)}__normal2(e){const r=this.derivative(e),n=Tr(r.x*r.x+r.y*r.y);return{t:e,x:-r.y/n,y:r.x/n}}__normal3(e){const r=this.derivative(e),n=this.derivative(e+.01),i=Tr(r.x*r.x+r.y*r.y+r.z*r.z),s=Tr(n.x*n.x+n.y*n.y+n.z*n.z);r.x/=i,r.y/=i,r.z/=i,n.x/=s,n.y/=s,n.z/=s;const a={x:n.y*r.z-n.z*r.y,y:n.z*r.x-n.x*r.z,z:n.x*r.y-n.y*r.x},o=Tr(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=o,a.y/=o,a.z/=o;const u=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:e,x:u[0]*r.x+u[1]*r.y+u[2]*r.z,y:u[3]*r.x+u[4]*r.y+u[5]*r.z,z:u[6]*r.x+u[7]*r.y+u[8]*r.z}}hull(e){let r=this.points,n=[],i=[],s=0;for(i[s++]=r[0],i[s++]=r[1],i[s++]=r[2],this.order===3&&(i[s++]=r[3]);r.length>1;){n=[];for(let a=0,o,u=r.length-1;a<u;a++)o=A.lerp(e,r[a],r[a+1]),i[s++]=o,n.push(o);r=n}return i}split(e,r){if(e===0&&!!r)return this.split(r).left;if(r===1)return this.split(e).right;const n=this.hull(e),i={left:this.order===2?new ae([n[0],n[3],n[5]]):new ae([n[0],n[4],n[7],n[9]]),right:this.order===2?new ae([n[5],n[4],n[2]]):new ae([n[9],n[8],n[6],n[3]]),span:n};return i.left._t1=A.map(0,0,1,this._t1,this._t2),i.left._t2=A.map(e,0,1,this._t1,this._t2),i.right._t1=A.map(e,0,1,this._t1,this._t2),i.right._t2=A.map(1,0,1,this._t1,this._t2),r?(r=A.map(r,e,1,0,1),i.right.split(r).left):i}extrema(){const e={};let r=[];return this.dims.forEach(function(n){let i=function(a){return a[n]},s=this.dpoints[0].map(i);e[n]=A.droots(s),this.order===3&&(s=this.dpoints[1].map(i),e[n]=e[n].concat(A.droots(s))),e[n]=e[n].filter(function(a){return a>=0&&a<=1}),r=r.concat(e[n].sort(A.numberSort))}.bind(this)),e.values=r.sort(A.numberSort).filter(function(n,i){return r.indexOf(n)===i}),e}bbox(){const e=this.extrema(),r={};return this.dims.forEach(function(n){r[n]=A.getminmax(this,n,e[n])}.bind(this)),r}overlaps(e){const r=this.bbox(),n=e.bbox();return A.bboxoverlap(r,n)}offset(e,r){if(typeof r<"u"){const n=this.get(e),i=this.normal(e),s={c:n,n:i,x:n.x+i.x*r,y:n.y+i.y*r};return this._3d&&(s.z=n.z+i.z*r),s}if(this._linear){const n=this.normal(0),i=this.points.map(function(s){const a={x:s.x+e*n.x,y:s.y+e*n.y};return s.z&&n.z&&(a.z=s.z+e*n.z),a});return[new ae(i)]}return this.reduce().map(function(n){return n._linear?n.offset(e)[0]:n.scale(e)})}simple(){if(this.order===3){const i=A.angle(this.points[0],this.points[3],this.points[1]),s=A.angle(this.points[0],this.points[3],this.points[2]);if(i>0&&s<0||i<0&&s>0)return!1}const e=this.normal(0),r=this.normal(1);let n=e.x*r.x+e.y*r.y;return this._3d&&(n+=e.z*r.z),$r(hy(n))<fy/3}reduce(){let e,r=0,n=0,i=.01,s,a=[],o=[],u=this.extrema().values;for(u.indexOf(0)===-1&&(u=[0].concat(u)),u.indexOf(1)===-1&&u.push(1),r=u[0],e=1;e<u.length;e++)n=u[e],s=this.split(r,n),s._t1=r,s._t2=n,a.push(s),r=n;return a.forEach(function(l){for(r=0,n=0;n<=1;)for(n=r+i;n<=1+i;n+=i)if(s=l.split(r,n),!s.simple()){if(n-=i,$r(r-n)<i)return[];s=l.split(r,n),s._t1=A.map(r,0,1,l._t1,l._t2),s._t2=A.map(n,0,1,l._t1,l._t2),o.push(s),r=n;break}r<1&&(s=l.split(r,1),s._t1=A.map(r,0,1,l._t1,l._t2),s._t2=l._t2,o.push(s))}),o}translate(e,r,n){n=typeof n=="number"?n:r;const i=this.order;let s=this.points.map((a,o)=>(1-o/i)*r+o/i*n);return new ae(this.points.map((a,o)=>({x:a.x+e.x*s[o],y:a.y+e.y*s[o]})))}scale(e){const r=this.order;let n=!1;if(typeof e=="function"&&(n=e),n&&r===2)return this.raise().scale(n);const i=this.clockwise,s=this.points;if(this._linear)return this.translate(this.normal(0),n?n(0):e,n?n(1):e);const a=n?n(0):e,o=n?n(1):e,u=[this.offset(0,10),this.offset(1,10)],l=[],c=A.lli4(u[0],u[0].c,u[1],u[1].c);if(!c)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(h){const f=l[h*r]=A.copy(s[h*r]);f.x+=(h?o:a)*u[h].n.x,f.y+=(h?o:a)*u[h].n.y}),n?([0,1].forEach(function(h){if(!(r===2&&!!h)){var f=s[h+1],d={x:f.x-c.x,y:f.y-c.y},D=n?n((h+1)/r):e;n&&!i&&(D=-D);var F=Tr(d.x*d.x+d.y*d.y);d.x/=F,d.y/=F,l[h+1]={x:f.x+D*d.x,y:f.y+D*d.y}}}),new ae(l)):([0,1].forEach(h=>{if(r===2&&!!h)return;const f=l[h*r],d=this.derivative(h),D={x:f.x+d.x,y:f.y+d.y};l[h+1]=A.lli4(f,D,c,s[h+1])}),new ae(l))}outline(e,r,n,i){if(r=r===void 0?e:r,this._linear){const P=this.normal(0),I=this.points[0],Q=this.points[this.points.length-1];let R,Y,te;n===void 0&&(n=e,i=r),R={x:I.x+P.x*e,y:I.y+P.y*e},te={x:Q.x+P.x*n,y:Q.y+P.y*n},Y={x:(R.x+te.x)/2,y:(R.y+te.y)/2};const j=[R,Y,te];R={x:I.x-P.x*r,y:I.y-P.y*r},te={x:Q.x-P.x*i,y:Q.y-P.y*i},Y={x:(R.x+te.x)/2,y:(R.y+te.y)/2};const pe=[te,Y,R],fe=A.makeline(pe[2],j[0]),p=A.makeline(j[2],pe[0]),m=[fe,new ae(j),p,new ae(pe)];return new En(m)}const s=this.reduce(),a=s.length,o=[];let u=[],l,c=0,h=this.length();const f=typeof n<"u"&&typeof i<"u";function d(P,I,Q,R,Y){return function(te){const j=R/Q,pe=(R+Y)/Q,fe=I-P;return A.map(te,0,1,P+j*fe,P+pe*fe)}}s.forEach(function(P){const I=P.length();f?(o.push(P.scale(d(e,n,h,c,I))),u.push(P.scale(d(-r,-i,h,c,I)))):(o.push(P.scale(e)),u.push(P.scale(-r))),c+=I}),u=u.map(function(P){return l=P.points,l[3]?P.points=[l[3],l[2],l[1],l[0]]:P.points=[l[2],l[1],l[0]],P}).reverse();const D=o[0].points[0],F=o[a-1].points[o[a-1].points.length-1],B=u[a-1].points[u[a-1].points.length-1],_=u[0].points[0],N=A.makeline(B,D),O=A.makeline(F,_),ee=[N].concat(o).concat([O]).concat(u);return new En(ee)}outlineshapes(e,r,n){r=r||e;const i=this.outline(e,r).curves,s=[];for(let a=1,o=i.length;a<o/2;a++){const u=A.makeshape(i[a],i[o-a],n);u.startcap.virtual=a>1,u.endcap.virtual=a<o/2-1,s.push(u)}return s}intersects(e,r){return e?e.p1&&e.p2?this.lineIntersects(e):(e instanceof ae&&(e=e.reduce()),this.curveintersects(this.reduce(),e,r)):this.selfintersects(r)}lineIntersects(e){const r=io(e.p1.x,e.p2.x),n=io(e.p1.y,e.p2.y),i=so(e.p1.x,e.p2.x),s=so(e.p1.y,e.p2.y);return A.roots(this.points,e).filter(a=>{var o=this.get(a);return A.between(o.x,r,i)&&A.between(o.y,n,s)})}selfintersects(e){const r=this.reduce(),n=r.length-2,i=[];for(let s=0,a,o,u;s<n;s++)o=r.slice(s,s+1),u=r.slice(s+2),a=this.curveintersects(o,u,e),i.push(...a);return i}curveintersects(e,r,n){const i=[];e.forEach(function(a){r.forEach(function(o){a.overlaps(o)&&i.push({left:a,right:o})})});let s=[];return i.forEach(function(a){const o=A.pairiteration(a.left,a.right,n);o.length>0&&(s=s.concat(o))}),s}arcs(e){return e=e||.5,this._iterate(e,[])}_error(e,r,n,i){const s=(i-n)/4,a=this.get(n+s),o=this.get(i-s),u=A.dist(e,r),l=A.dist(e,a),c=A.dist(e,o);return $r(l-u)+$r(c-u)}_iterate(e,r){let n=0,i=1,s;do{s=0,i=1;let a=this.get(n),o,u,l,c,h=!1,f=!1,d,D=i,F=1;do if(f=h,c=l,D=(n+i)/2,o=this.get(D),u=this.get(i),l=A.getccenter(a,o,u),l.interval={start:n,end:i},h=this._error(l,a,n,i)<=e,d=f&&!h,d||(F=i),h){if(i>=1){if(l.interval.end=F=1,c=l,i>1){let _={x:l.x+l.r*ly(l.e),y:l.y+l.r*cy(l.e)};l.e+=A.angle({x:l.x,y:l.y},_,this.get(1))}break}i=i+(i-n)/2}else i=D;while(!d&&s++<100);if(s>=100)break;c=c||l,r.push(c),n=F}while(i<1);return r}},Qn=e=>e.quadratic!==void 0,Ys=e=>e.cubic1!==void 0&&e.cubic2!==void 0,dy=(e,r,n=0)=>vr(e,r,n),vr=(e,r,n=0)=>{if(isNaN(n))throw Error("bend is NaN");if(n<-1||n>1)throw Error("Expects bend range of -1 to 1");const i=Ne.interpolate(.5,e,r);let s=i;r.y<e.y?s=n>0?{x:Math.min(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.max(e.x,r.x),y:Math.max(e.y,r.y)}:s=n>0?{x:Math.max(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.min(e.x,r.x),y:Math.max(e.y,r.y)};const a=Ne.interpolate(Math.abs(n),i,s);return pl(e,r,a)},vy=(e,r,n,i)=>{const s=vr(e,r,n);return new ae(s.a,s.quadratic,s.b).compute(i)},yl=(e,r,n)=>[`M ${e.x} ${e.y} Q ${n.x} ${n.y} ${r.x} ${r.y}`],bn=e=>{if(Ys(e))return py(e);if(Qn(e))return my(e);throw new Error("Unknown bezier type")},yy=(e,r,n,i)=>({a:Object.freeze(e),b:Object.freeze(r),cubic1:Object.freeze(n),cubic2:Object.freeze(i)}),py=e=>{const{a:r,cubic1:n,cubic2:i,b:s}=e,a=new ae(r,n,i,s);return Object.freeze({...e,length:()=>a.length(),interpolate:o=>a.compute(o),bbox:()=>{const{x:o,y:u}=a.bbox(),l=o.size,c=u.size;if(l===void 0)throw new Error("x.size not present on calculated bbox");if(c===void 0)throw new Error("x.size not present on calculated bbox");return re.fromTopLeft({x:o.min,y:u.min},l,c)},toString:()=>a.toString(),toSvgString:()=>["brrup"],kind:"bezier/cubic"})},pl=(e,r,n)=>({a:Object.freeze(e),b:Object.freeze(r),quadratic:Object.freeze(n)}),my=e=>{const{a:r,b:n,quadratic:i}=e,s=new ae(r,i,n);return Object.freeze({...e,length:()=>s.length(),interpolate:a=>s.compute(a),bbox:()=>{const{x:a,y:o}=s.bbox(),u=a.size,l=o.size;if(u===void 0)throw new Error("x.size not present on calculated bbox");if(l===void 0)throw new Error("x.size not present on calculated bbox");return re.fromTopLeft({x:a.min,y:o.min},u,l)},toString:()=>s.toString(),toSvgString:()=>yl(r,n,i),kind:"bezier/quadratic"})},yt={};T(yt,{area:()=>wy,bbox:()=>bl,center:()=>gy,circumference:()=>El,distanceCenter:()=>Zs,distanceFromExterior:()=>xy,interpolate:()=>Dl,intersectionLine:()=>by,intersections:()=>Cl,isCircle:()=>Ks,isCirclePositioned:()=>gl,isContainedBy:()=>Al,isEqual:()=>Xs,isIntersecting:()=>Dy,isPositioned:()=>Te,length:()=>xl,point:()=>wl,toPath:()=>Ey,toSvg:()=>Fl});var ml=Math.PI*2,Te=e=>e.x!==void 0&&e.y!==void 0,Ks=e=>e.radius!==void 0,gl=e=>Ks(e)&&Te(e),wl=(e,r,n)=>(n===void 0&&(Te(e)?n=e:n={x:0,y:0}),{x:Math.cos(-r)*e.radius+n.x,y:Math.sin(-r)*e.radius+n.y}),ei=(e,r="circle")=>{if(Te(e)&&X(e,"circle"),Number.isNaN(e.radius))throw new Error(`${r}.radius is NaN`);if(e.radius<=0)throw new Error(`${r}.radius must be greater than zero`)},ts=(e,r="circle")=>{if(!Te(e))throw new Error("Expected a positioned circle with x,y");return ei(e,r)},gy=e=>Te(e)?Object.freeze({x:e.x,y:e.y}):Object.freeze({x:e.radius,y:e.radius}),Dl=(e,r)=>wl(e,r*ml),xl=e=>El(e),El=e=>(ei(e),ml*e.radius),wy=e=>(ei(e),Math.PI*e.radius*e.radius),bl=e=>Te(e)?re.fromCenter(e,e.radius*2,e.radius*2):{width:e.radius*2,height:e.radius*2},Al=(e,r)=>Zs(e,r)<Math.abs(e.radius-r.radius),Dy=(e,r)=>Xs(e,r)||Al(e,r)?!0:Cl(e,r).length===2,Cl=(e,r)=>{const n=w.subtract(r,e),i=Math.sqrt(n.y*n.y+n.x*n.x);if(i>e.radius+r.radius)return[];if(i<Math.abs(e.radius-r.radius))return[];if(Xs(e,r))return[];const s=(e.radius*e.radius-r.radius*r.radius+i*i)/(2*i),a={x:e.x+n.x*s/i,y:e.y+n.y*s/i},o=Math.sqrt(e.radius*e.radius-s*s),u={x:-n.y*(o/i),y:n.x*(o/i)};return[w.sum(a,u),w.subtract(a,u)]},Xs=(e,r)=>e.radius!==r.radius?!1:Te(e)&&Te(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):(!Te(e)&&!Te(r),!1),Zs=(e,r)=>(ts(e,"a"),ts(e,"b"),w.distance(e,r)),xy=(e,r)=>{if(ts(e,"a"),gl(r))return Math.max(0,Zs(e,r)-e.radius-r.radius);if(w.isPoint(r))return Math.max(0,w.distance(e,r));throw new Error("Second parameter invalid type")},Fl=(e,r,n)=>{if(Ks(e)){if(n!==void 0)return _i(e.radius,n,r);if(Te(e))return _i(e.radius,e,r);throw new Error("origin parameter needed for non-positioned circle")}else{if(n!==void 0)return _i(e,n,r);throw new Error("origin parameter needed")}},_i=(e,r,n)=>{const{x:i,y:s}=r,a=n?"1":"0";return`
    M ${i}, ${s}
    m -${e}, 0
    a ${e},${e} 0 1,${a} ${e*2},0
    a ${e},${e} 0 1,${a} -${e*2},0
  `.split(`
`)},Ey=e=>(ei(e),Object.freeze({...e,interpolate:r=>Dl(e,r),bbox:()=>bl(e),length:()=>xl(e),toSvgString:(r=!0)=>Fl(e,r),kind:"circular"})),by=(e,r)=>{const n={x:r.b.x-r.a.x,y:r.b.y-r.a.y},i={x:r.a.x-e.x,y:r.a.y-e.y},s=(n.x*i.x+n.y*i.y)*-2,a=2*(n.x*n.x+n.y*n.y),o=Math.sqrt(s*s-2*a*(i.x*i.x+i.y*i.y-e.radius*e.radius));if(isNaN(o))return[];const u=(s-o)/a,l=(s+o)/a,c=[];return u<=1&&u>=0&&c.push({x:r.a.x+n.x*u,y:r.a.y+n.y*u}),l<=1&&l>=0&&c.push({x:r.a.x+n.x*l,y:r.a.y+n.y*l}),c},Qs={};T(Qs,{bbox:()=>Bl,computeDimensions:()=>ea,fromPaths:()=>Nl,guardContinuous:()=>Pl,interpolate:()=>Sl,setSegment:()=>Ay,toString:()=>_l,toSvgString:()=>Ml});var Ay=(e,r,n)=>{const i=[...e.segments];return i[r]=n,Nl(...i)},Sl=(e,r,n,i)=>{i===void 0&&(i=ea(e));const s=r*(n?i.totalWidth:i.totalLength);let a=0;const o=n?i.widths:i.lengths;for(let u=0;u<o.length;u++)if(a+o[u]>=s){let c=(s-a)/o[u];return c>1&&(c=1),e[u].interpolate(c)}else a+=o[u];return{x:0,y:0}},ea=e=>{const r=e.map(a=>a.bbox().width),n=e.map(a=>a.length());let i=0,s=0;for(let a=0;a<n.length;a++)i+=n[a];for(let a=0;a<r.length;a++)s+=r[a];return{totalLength:i,totalWidth:s,widths:r,lengths:n}},Bl=e=>{const n=e.map(i=>i.bbox()).map(i=>re.corners(i)).flat();return w.bbox(...n)},_l=e=>e.map(r=>r.toString()).join(", "),Pl=e=>{let r=yr.getEnd(e[0]);for(let n=1;n<e.length;n++){const i=yr.getStart(e[n]);if(!w.isEqual(i,r))throw new Error("Path index "+n+" does not start at prior path end. Start: "+i.x+","+i.y+" expected: "+r.x+","+r.y);r=yr.getEnd(e[n])}},Ml=e=>e.flatMap(r=>r.toSvgString()),Nl=(...e)=>{Pl(e);const r=ea(e);return Object.freeze({segments:e,length:()=>r.totalLength,interpolate:(n,i=!1)=>Sl(e,n,i,r),bbox:()=>Bl(e),toString:()=>_l(e),toSvgString:()=>Ml(e),kind:"compound"})},ta={};T(ta,{allDirections:()=>ra,cellAtPoint:()=>_y,cellEquals:()=>kl,cellKeyString:()=>zl,cellMiddle:()=>Py,cells:()=>sa,crossDirections:()=>Tl,getLine:()=>My,getVectorFromCardinal:()=>na,guardCell:()=>tt,inside:()=>$l,isEqual:()=>Sy,neighbours:()=>Il,offset:()=>ia,offsetCardinals:()=>Ny,rectangleForCell:()=>By,rows:()=>Oy,simpleLine:()=>zy,visitFor:()=>jy,visitor:()=>tr,visitorBreadth:()=>Ty,visitorColumn:()=>qy,visitorDepth:()=>$y,visitorRandom:()=>Ry,visitorRandomContiguous:()=>Iy,visitorRow:()=>Ly});var Cy=e=>e===void 0?!1:"x"in e&&"y"in e,Fy=e=>!(e===void 0||e[1]===void 0),Sy=(e,r)=>{if("rows"in e&&"cols"in e)if("rows"in r&&"cols"in r){if(e.rows!==r.rows||e.cols!==r.cols)return!1}else return!1;if("size"in e)if("size"in r){if(e.size!==r.size)return!1}else return!1;return!0},zl=e=>`Cell{${e.x},${e.y}}`,kl=(e,r)=>r===void 0||e===void 0?!1:e.x===r.x&&e.y===r.y,tt=(e,r="Param",n)=>{if(e===void 0)throw new Error(r+" is undefined. Expecting {x,y}");if(e.x===void 0)throw new Error(r+".x is undefined");if(e.y===void 0)throw new Error(r+".y is undefined");if(!Number.isInteger(e.x))throw new Error(r+".x is non-integer");if(!Number.isInteger(e.y))throw new Error(r+".y is non-integer");if(n!==void 0&&!$l(n,e))throw new Error(`${r} is outside of grid. Cell: ${e.x},${e.y} Grid: ${n.cols}, ${n.rows}`)},ti=(e,r="Param")=>{if(e===void 0)throw new Error(`${r} is undefined. Expecting grid.`);if(!("rows"in e))throw new Error(`${r}.rows is undefined`);if(!("cols"in e))throw new Error(`${r}.cols is undefined`);if(!Number.isInteger(e.rows))throw new Error(`${r}.rows is not an integer`);if(!Number.isInteger(e.cols))throw new Error(`${r}.cols is not an integer`)},$l=(e,r)=>!(r.x<0||r.y<0||r.x>=e.cols||r.y>=e.rows),By=(e,r)=>{tt(e);const n=r.size,i=e.x*n,s=e.y*n;return re.fromTopLeft({x:i,y:s},n,n)},_y=(e,r)=>{const n=r.size;if(e.x<0||e.y<0)return;const i=Math.floor(e.x/n),s=Math.floor(e.y/n);if(!(i>=r.cols)&&!(s>=r.rows))return{x:i,y:s}},ra=Object.freeze(["n","ne","nw","e","s","se","sw","w"]),Tl=Object.freeze(["n","e","s","w"]),Il=(e,r,n="undefined",i)=>{const s=i??ra,a=s.map(o=>ia(e,r,na(o),n));return _s(s,a)},Py=(e,r)=>{tt(e);const n=r.size,i=e.x*n,s=e.y*n;return Object.freeze({x:i+n/2,y:s+n/2})},My=(e,r)=>{tt(e),tt(r);let n=e.x,i=e.y;const s=Math.abs(r.x-n),a=Math.abs(r.y-i),o=n<r.x?1:-1,u=i<r.y?1:-1;let l=s-a;const c=[];for(;c.push(Object.freeze({x:n,y:i})),!(n===r.x&&i===r.y);){const h=2*l;h>-a&&(l-=a,n+=o),h<s&&(l+=s,i+=u)}return c},Ny=(e,r,n,i="stop")=>{ti(e,"grid"),tt(r,"start"),ce(n,"aboveZero","steps");const s=ra,a=s.map(u=>na(u,n)),o=s.map((u,l)=>ia(e,r,a[l],i));return _s(s,o)},na=(e,r=1)=>{let n;switch(e){case"n":n={x:0,y:-1*r};break;case"ne":n={x:1*r,y:-1*r};break;case"e":n={x:1*r,y:0};break;case"se":n={x:1*r,y:1*r};break;case"s":n={x:0,y:1*r};break;case"sw":n={x:-1*r,y:1*r};break;case"w":n={x:-1*r,y:0};break;case"nw":n={x:-1*r,y:-1*r};break;default:n={x:0,y:0}}return Object.freeze(n)},zy=function(e,r,n=!1){const i=[];if(e.x===r.x){const s=n?r.y+1:r.y;for(let a=e.y;a<s;a++)i.push({x:e.x,y:a})}else if(e.y===r.y){const s=n?r.x+1:r.x;for(let a=e.x;a<s;a++)i.push({x:a,y:e.y})}else throw new Error(`Only does vertical and horizontal: ${e.x},${e.y} - ${r.x},${r.y}`);return i},ia=function(e,r,n,i="undefined"){tt(r,"start",e),tt(n),ti(e,"grid");let s=r.x,a=r.y;switch(i){case"wrap":s+=n.x%e.cols,a+=n.y%e.rows,s<0?s=e.cols+s:s>=e.cols&&(s-=e.cols),a<0?a=e.rows+a:a>=e.rows&&(a-=e.rows);break;case"stop":s+=n.x,a+=n.y,s=Wi(s,e.cols),a=Wi(a,e.rows);break;case"undefined":if(s+=n.x,a+=n.y,s<0||a<0||s>=e.cols||a>=e.rows)return;break;case"unbounded":s+=n.x,a+=n.y;break;default:throw new Error(`Unknown BoundsLogic case ${i}`)}return Object.freeze({x:s,y:a})},ky=(e,r,n,i)=>{const s=Il(e,r,i,n);return Object.entries(s).filter(Fy)},tr=function*(e,r,n,i={}){ti(r,"grid"),tt(n,"start",r);const s=i.visited??ps(c=>zl(c)),a=e.options?e.options:(c,h)=>ky(c,h,Tl,"undefined");if(!Cy(n))throw new Error("'start' parameter is undefined or not a cell");let o=[n],u=[],l=null;for(;o.length>0;){if(l===null){const c=o.pop();if(c===void 0)break;l=c}if(!s.has(l)){s.add(l),yield l;const c=a(r,l).filter(h=>!s.has(h[1]));c.length===0?l!==null&&(o=o.filter(h=>kl(h,l))):u.push(...c)}if(u=u.filter(c=>!s.has(c[1])),u.length===0)l=null;else{const c=e.select(u);c!==void 0&&(o.push(c[1]),l=c[1])}}},$y=(e,r,n={})=>tr({select:i=>i[i.length-1]},e,r,n),Ty=(e,r,n={})=>tr({select:i=>i[0]},e,r,n),Rl=e=>Ua(e),Iy=(e,r,n={})=>tr({select:Rl},e,r,n),Ry=(e,r,n={})=>tr({options:(i,s)=>{const a=[];for(const o of sa(i,s))a.push(["n",o]);return a},select:Rl},e,r,n),Ly=(e,r,n={})=>{const{reversed:i=!1}=n;return tr({select:u=>u.find(l=>l[0]===(i?"w":"e")),options:(u,l)=>(i?l.x>0?l={x:l.x-1,y:l.y}:l.y>0?l={x:u.cols-1,y:l.y-1}:l={x:u.cols-1,y:u.rows-1}:l.x<u.rows-1?l={x:l.x+1,y:l.y}:l.y<u.rows-1?l={x:0,y:l.y+1}:l={x:0,y:0},[[i?"w":"e",l]])},e,r,n)},jy=(e,r,n,i)=>{ce(n,"","steps");const s={reversed:n<0};n=Math.abs(n);let a=r,o=i(e,r,s);o.next();let u=0;for(;u<n;){u++;const{value:l}=o.next();if(l)a=l,s.debug&&console.log(`stepsMade: ${u} cell: ${a.x}, ${a.y} reverse: ${s.reversed}`);else if(n>=e.cols*e.rows)n-=e.cols*e.rows,u=0,o=i(e,r,s),o.next(),a=r,s.debug&&console.log(`resetting visitor to ${n}`);else throw new Error("Value not received by visitor")}return a},qy=(e,r,n={})=>{const{reversed:i=!1}=n;return tr({select:a=>a.find(o=>o[0]===(i?"n":"s")),options:(a,o)=>(i?o.y>0?o={x:o.x,y:o.y-1}:o.x===0?o={x:a.cols-1,y:a.rows-1}:o={x:o.x-1,y:a.rows-1}:o.y<a.rows-1?o={x:o.x,y:o.y+1}:o.x<a.cols-1?o={x:o.x+1,y:0}:o={x:0,y:0},[[i?"n":"s",o]])},e,r,n)},Oy=function*(e,r={x:0,y:0}){let n=r.y,i=[];for(const s of sa(e,r))s.y!==n?(yield i,i=[s],n=s.y):i.push(s);i.length>0&&(yield i)},sa=function*(e,r={x:0,y:0}){ti(e,"grid"),tt(r,"start",e);let{x:n,y:i}=r,s=!0;do yield{x:n,y:i},n++,n===e.cols&&(i++,n=0),i===e.rows&&(i=0,n=0),n===r.x&&i===r.y&&(s=!1);while(s)},yr={};T(yr,{getEnd:()=>Wy,getStart:()=>Vy});var Vy=function(e){if(Zr.isQuadraticBezier(e))return e.a;if(Ne.isLine(e))return e.a;throw new Error(`Unknown path type ${JSON.stringify(e)}`)},Wy=function(e){if(Zr.isQuadraticBezier(e))return e.b;if(Ne.isLine(e))return e.b;throw new Error(`Unknown path type ${JSON.stringify(e)}`)},re={};T(re,{area:()=>up,center:()=>Vl,corners:()=>aa,distanceFromCenter:()=>tp,distanceFromExterior:()=>ep,edges:()=>Wl,empty:()=>Hy,emptyPositioned:()=>Ll,fromCenter:()=>Qy,fromElement:()=>Gy,fromNumbers:()=>Yy,fromTopLeft:()=>np,getEdgeX:()=>is,getEdgeY:()=>ss,guard:()=>rt,intersectsPoint:()=>Rn,isEmpty:()=>Uy,isEqual:()=>ql,isEqualSize:()=>Jy,isPlaceholder:()=>Gr,isPositioned:()=>Ie,isRect:()=>Qr,isRectPositioned:()=>ns,lengths:()=>ap,maxFromCorners:()=>rp,multiply:()=>sp,normaliseByRect:()=>ip,perimeter:()=>op,placeholder:()=>jl,placeholderPositioned:()=>rs,subtract:()=>Xy,sum:()=>Zy,toArray:()=>Ky});var Hy=Object.freeze({width:0,height:0}),Ll=Object.freeze({x:0,y:0,width:0,height:0}),jl=Object.freeze({width:Number.NaN,height:Number.NaN}),rs=Object.freeze({x:Number.NaN,y:Number.NaN,width:Number.NaN,height:Number.NaN}),Uy=e=>e.width===0&&e.height===0,Gr=e=>Number.isNaN(e.width)&&Number.isNaN(e.height),Ie=e=>e.x!==void 0&&e.y!==void 0,Qr=e=>!(e===void 0||e.width===void 0||e.height===void 0),ns=e=>Qr(e)&&Ie(e),Gy=e=>({width:e.clientWidth,height:e.clientHeight}),Jy=(e,r)=>{if(e===void 0)throw new Error("a undefined");if(r===void 0)throw new Error("b undefined");return e.width===r.width&&e.height===r.height};function Yy(e,r,n,i){if(n===void 0||i===void 0){if(typeof e!="number")throw new Error("width is not an number");if(typeof r!="number")throw new Error("height is not an number");return Object.freeze({width:e,height:r})}if(typeof e!="number")throw new Error("x is not an number");if(typeof r!="number")throw new Error("y is not an number");if(typeof n!="number")throw new Error("width is not an number");if(typeof i!="number")throw new Error("height is not an number");return Object.freeze({x:e,y:r,width:n,height:i})}function Ky(e){if(Ie(e))return[e.x,e.y,e.width,e.height];if(Qr(e))return[e.width,e.height];throw new Error(`rect param is not a rectangle. Got: ${JSON.stringify(e)}`)}var ql=(e,r)=>Ie(e)&&Ie(r)?w.isEqual(e,r)?e.width===r.width&&e.height===r.height:!1:!Ie(e)&&!Ie(r)?e.width===r.width&&e.height===r.height:!1;function Xy(e,r,n){if(e===void 0)throw new Error("First parameter undefined");if(typeof r=="number"){const i=n===void 0?0:n;return Object.freeze({...e,width:e.width-r,height:e.height-i})}else return Object.freeze({...e,width:e.width-r.width,height:e.height-r.height})}function Zy(e,r,n){if(e===void 0)throw new Error("First parameter undefined");if(typeof r=="number"){const i=n===void 0?0:n;return Object.freeze({...e,width:e.width+r,height:e.height+i})}else return Object.freeze({...e,width:e.width+r.width,height:e.height+r.height})}function Rn(e,r,n){rt(e,"rect");let i=0,s=0;if(typeof r=="number"){if(n===void 0)throw new Error("x and y coordinate needed");i=r,s=n}else i=r.x,s=r.y;if(Ie(e)){if(i-e.x>e.width||i<e.x||s-e.y>e.height||s<e.y)return!1}else if(i>e.width||i<0||s>e.height||s<0)return!1;return!0}var Qy=(e,r,n)=>{w.guard(e,"origin"),Er(r,"width"),Er(n,"height");const i=r/2,s=n/2;return{x:e.x-i,y:e.y-s,width:r,height:n}},ep=(e,r)=>{if(Ol(e,"rect"),w.guard(r,"pt"),Rn(e,r))return 0;const n=Math.max(e.x-r.x,0,r.x-e.x+e.width),i=Math.max(e.y-r.y,0,r.y-e.y+e.height);return Math.sqrt(n*n+i*i)},tp=(e,r)=>w.distance(Vl(e),r),rp=(e,r,n,i)=>{if(e.y>n.y)throw new Error("topLeft.y greater than bottomRight.y");if(e.y>i.y)throw new Error("topLeft.y greater than bottomLeft.y");const s=r.x-e.x,a=n.x-i.x,o=Math.abs(i.y-e.y),u=Math.abs(n.y-r.y);return{x:Math.min(e.x,i.x),y:Math.min(r.y,e.y),width:Math.max(s,a),height:Math.max(o,u)}},Er=(e,r="Dimension")=>{if(e===void 0)throw Error(`${r} is undefined`);if(isNaN(e))throw Error(`${r} is NaN`);if(e<0)throw Error(`${r} cannot be negative`)},rt=(e,r="rect")=>{if(e===void 0)throw Error("{$name} undefined");Ie(e)&&w.guard(e,r),Er(e.width,r+".width"),Er(e.height,r+".height")},Ol=(e,r="rect")=>{if(!Ie(e))throw new Error(`Expected ${r} to have x,y`);rt(e,r)},np=(e,r,n)=>(Er(r,"width"),Er(n,"height"),w.guard(e,"origin"),{x:e.x,y:e.y,width:r,height:n}),aa=(e,r)=>{if(rt(e),r===void 0&&w.isPoint(e))r=e;else if(r===void 0)throw new Error("Unpositioned rect needs origin param");return[{x:r.x,y:r.y},{x:r.x+e.width,y:r.y},{x:r.x+e.width,y:r.y+e.height},{x:r.x,y:r.y+e.height}]},is=(e,r)=>{switch(rt(e),r){case"top":return w.isPoint(e)?e.x:0;case"bottom":return w.isPoint(e)?e.x:0;case"left":return w.isPoint(e)?e.y:0;case"right":return w.isPoint(e)?e.x+e.width:e.width}},ss=(e,r)=>{switch(rt(e),r){case"top":return w.isPoint(e)?e.y:0;case"bottom":return w.isPoint(e)?e.y+e.height:e.height;case"left":return w.isPoint(e)?e.y:0;case"right":return w.isPoint(e)?e.y:0}},ip=(e,r,n)=>{let i;if(n===void 0)if(Qr(r))n=r.height,i=r.width;else throw new Error("Expects rectangle or width and height parameters for normaliseBy");else if(typeof r=="number")i=r;else throw new Error("Expects rectangle or width and height parameters for normaliseBy");return Ie(e)?Object.freeze({x:e.x/i,y:e.y/n,width:e.width/i,height:e.height/n}):Object.freeze({width:e.width/i,height:e.height/n})};function sp(e,r,n){if(rt(e,"a"),Qr(r))return ns(e)?{...e,x:e.x*r.width,y:e.y*r.height,width:e.width*r.width,height:e.width*r.height}:{...e,width:e.width*r.width,height:e.width*r.height};if(typeof r!="number")throw new Error(`Expected second parameter of type Rect or number. Got ${JSON.stringify(r)}`);return n===void 0&&(n=r),ns(e)?{...e,x:e.x*r,y:e.y*n,width:e.width*r,height:e.width*n}:{...e,width:e.width*r,height:e.width*n}}var Vl=(e,r)=>(rt(e),r===void 0&&w.isPoint(e)?r=e:r===void 0&&(r={x:0,y:0}),Object.freeze({x:r.x+e.width/2,y:r.y+e.height/2})),ap=e=>(Ol(e,"rect"),Wl(e).map(r=>Ne.length(r))),Wl=(e,r)=>{const n=aa(e,r);return Ne.joinPointsToLines(...n,n[0])},op=e=>(rt(e),e.height+e.height+e.width+e.width),up=e=>(rt(e),e.height*e.width),oa={};T(oa,{fromDegrees:()=>lp});var lp=(e,r,n=0,i=0,s=360)=>({radiusX:e,radiusY:r,rotation:Bt(n),startAngle:Bt(i),endAngle:Bt(s)}),Ze={};T(Ze,{fromCartesian:()=>cp,isCoord:()=>Hl,rotate:()=>fp,rotateDegrees:()=>dp,spiral:()=>hp,spiralRaw:()=>vp,toCartesian:()=>An});var Hl=e=>!(e.distance===void 0||e.angleRadian===void 0),cp=(e,r)=>{e=Us(e,r);const n=Math.atan2(e.y,e.x);return Object.freeze({...e,angleRadian:n,distance:Math.sqrt(e.x*e.x+e.y*e.y)})},An=(e,r,n)=>{if(Hl(e)){if(r===void 0&&(r=Tn),!he(r))throw new Error("Expecting (Coord, Point). Point param wrong type.");return ao(e.distance,e.angleRadian,r)}else if(typeof e=="number"&&typeof r=="number"){if(n===void 0&&(n=Tn),!he(n))throw new Error("Expecting (number, number, Point). Point param wrong type");return ao(e,r,n)}else throw new Error(`Expecting parameters of (number, number). Got: (${typeof e}, ${typeof r}, ${typeof n}). a: ${JSON.stringify(e)}`)};function*hp(e,r){let n=0;for(;;){const i=e*n++;yield{distance:r*i,angleRadian:i,step:n}}}var fp=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+r}),dp=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+Bt(r)}),vp=(e,r,n)=>{const i=r*e;return Object.freeze({distance:n*i,angleRadian:i})},ao=(e,r,n)=>(X(n),Object.freeze({x:n.x+e*Math.cos(r),y:n.y+e*Math.sin(r)})),ua={};T(ua,{arrow:()=>mp,center:()=>yp,starburst:()=>pp});var yp=e=>{if(e===void 0)return Object.freeze({x:.5,y:.5});if(re.isRect(e))return re.center(e);if(Gt.isTriangle(e))return Gt.centroid(e);if(yt.isCircle(e))return yt.center(e);throw new Error(`Unknown shape: ${JSON.stringify(e)}`)},pp=(e,r=5,n,i={x:0,y:0},s)=>{ce(r,"positive","points");const a=Math.PI*2/r,o=a/2,u=s?.initialAngleRadian??-Math.PI/2;n===void 0&&(n=e/2);let l=u;const c=[];for(let h=0;h<r;h++){const f=An(e,l,i),d=An(n,l-o,i),D=An(n,l+o,i);c.push(d,f),h+1<r&&c.push(D),l+=a}return c},mp=(e,r,n={})=>{const i=n.tailLength??10,s=n.tailThickness??Math.max(i/5,5),a=n.angleRadian??0,o=n.arrowSize??Math.max(i/5,15),u=Math.PI/2;let l,c;if(r==="tip")l=Gt.equilateralFromVertex(e,o,u),c=re.corners(re.fromTopLeft({x:l.a.x-i,y:e.y-s/2},i,s));else if(r==="middle"){const f=i+o/2,d=s/2;l=Gt.equilateralFromVertex({x:e.x+o*1.2,y:e.y},o,u),c=re.corners(re.fromTopLeft({x:e.x-f,y:e.y-d},i+o,s))}else c=re.corners(re.fromTopLeft({x:e.x,y:e.y-s/2},i,s)),l=Gt.equilateralFromVertex({x:e.x+i+o*.7,y:e.y},o,u);return w.rotate([c[0],c[1],l.a,l.b,l.c,c[2],c[3]],a,e)},Gt={};T(Gt,{Empty:()=>Zp,Equilateral:()=>Ul,Isosceles:()=>Jl,Placeholder:()=>Qp,Right:()=>Gl,angles:()=>en,anglesDegrees:()=>sm,apply:()=>rm,area:()=>Ql,barycentricCoord:()=>tc,barycentricToCartestian:()=>gm,bbox:()=>ec,centroid:()=>ai,corners:()=>as,edges:()=>si,equilateralFromVertex:()=>ym,fromFlatArray:()=>mm,fromPoints:()=>ca,fromRadius:()=>dm,guard:()=>Le,innerCircle:()=>hm,intersectsPoint:()=>wm,isAcute:()=>lm,isEmpty:()=>em,isEqual:()=>im,isEquilateral:()=>am,isIsoceles:()=>om,isOblique:()=>um,isObtuse:()=>cm,isPlaceholder:()=>tm,isRightAngle:()=>Xl,isTriangle:()=>nm,lengths:()=>la,outerCircle:()=>fm,perimeter:()=>Zl,rotate:()=>Dm,rotateByVertex:()=>vm,toFlatArray:()=>pm});var Ul={};T(Ul,{area:()=>Ap,centerFromA:()=>wp,centerFromB:()=>Dp,centerFromC:()=>xp,circumcircle:()=>Cp,fromCenter:()=>gp,height:()=>Ep,incircle:()=>ri,perimeter:()=>bp});var oo=Math.PI*4/3,uo=Math.PI*2/3,zt=e=>typeof e=="number"?e:e.length,gp=(e,r={x:0,y:0},n)=>{const i=zt(e)/Math.sqrt(3),s=n??Math.PI*1.5,a={x:i*Math.cos(s)+r.x,y:i*Math.sin(s)+r.y},o={x:i*Math.cos(s+oo)+r.x,y:i*Math.sin(s+oo)+r.y},u={x:i*Math.cos(s+uo)+r.x,y:i*Math.sin(s+uo)+r.y};return Object.freeze({a:o,b:a,c:u})},wp=(e,r={x:0,y:0})=>{const n=zt(e),{radius:i}=ri(e);return{x:r.x+n/2,y:r.y-i}},Dp=(e,r={x:0,y:0})=>{const{radius:n}=ri(e);return{x:r.x,y:r.y+n*2}},xp=(e,r={x:0,y:0})=>{const n=zt(e),{radius:i}=ri(e);return{x:r.x-n/2,y:r.y-i}},Ep=e=>Math.sqrt(3)/2*zt(e),bp=e=>zt(e)*3,Ap=e=>Math.pow(zt(e),2)*Math.sqrt(3)/4,Cp=e=>({radius:Math.sqrt(3)/3*zt(e)}),ri=e=>({radius:Math.sqrt(3)/6*zt(e)}),Gl={};T(Gl,{adjacentFromHypotenuse:()=>Rp,adjacentFromOpposite:()=>Lp,angleAtPointA:()=>Mp,angleAtPointB:()=>Np,area:()=>Pp,circumcircle:()=>kp,fromA:()=>Fp,fromB:()=>Sp,fromC:()=>Bp,height:()=>ni,hypotenuseFromAdjacent:()=>qp,hypotenuseFromOpposite:()=>jp,hypotenuseSegments:()=>ii,incircle:()=>$p,medians:()=>zp,oppositeFromAdjacent:()=>Tp,oppositeFromHypotenuse:()=>Ip,perimeter:()=>_p,resolveLengths:()=>Re});var Fp=(e,r={x:0,y:0})=>{const n=Re(e),i=ii(e),s=ni(e),a={x:r.x,y:r.y},o={x:r.x+n.hypotenuse,y:r.y},u={x:r.x+i[1],y:r.y-s};return{a,b:o,c:u}},Sp=(e,r={x:0,y:0})=>{const n=Re(e),i=ii(e),s=ni(e),a={x:r.x,y:r.y},o={x:r.x-n.hypotenuse,y:r.y},u={x:r.x-i[0],y:r.y-s};return{a:o,b:a,c:u}},Bp=(e,r={x:0,y:0})=>{const n=ii(e),i=ni(e),s={x:r.x,y:r.y},a={x:r.x-n[1],y:r.y+i},o={x:r.x+n[0],y:r.y+i};return{a,b:o,c:s}},Re=e=>{const r=e.adjacent,n=e.opposite,i=e.hypotenuse;if(r!==void 0&&n!==void 0)return{...e,adjacent:r,opposite:n,hypotenuse:Math.sqrt(r*r+n*n)};if(r&&i)return{...e,adjacent:r,hypotenuse:i,opposite:i*i-r*r};if(n&&i)return{...e,hypotenuse:i,opposite:n,adjacent:i*i-n*n};if(e.opposite&&e.hypotenuse&&e.adjacent)return e;throw new Error("Missing at least two edges")},ni=e=>{const r=Re(e),n=r.opposite*r.opposite/r.hypotenuse,i=r.adjacent*r.adjacent/r.hypotenuse;return Math.sqrt(n*i)},ii=e=>{const r=Re(e),n=r.opposite*r.opposite/r.hypotenuse,i=r.adjacent*r.adjacent/r.hypotenuse;return[n,i]},_p=e=>{const r=Re(e);return r.adjacent+r.hypotenuse+r.opposite},Pp=e=>{const r=Re(e);return r.opposite*r.adjacent/2},Mp=e=>{const r=Re(e);return Math.acos((r.adjacent*r.adjacent+r.hypotenuse*r.hypotenuse-r.opposite*r.opposite)/(2*r.adjacent*r.hypotenuse))},Np=e=>{const r=Re(e);return console.log(r),Math.acos((r.opposite*r.opposite+r.hypotenuse*r.hypotenuse-r.adjacent*r.adjacent)/(2*r.opposite*r.hypotenuse))},zp=e=>{const r=Re(e),n=r.adjacent*r.adjacent,i=r.hypotenuse*r.hypotenuse,s=r.opposite*r.opposite;return[Math.sqrt(2*(n+i)-s)/2,Math.sqrt(2*(i+s)-n)/2,Math.sqrt(2*(s+n)-i)/2]},kp=e=>({radius:Re(e).hypotenuse/2}),$p=e=>{const r=Re(e);return{radius:(r.adjacent+r.opposite-r.hypotenuse)/2}},Tp=(e,r)=>Math.tan(e)*r,Ip=(e,r)=>Math.sin(e)*r,Rp=(e,r)=>Math.cos(e)*r,Lp=(e,r)=>r/Math.tan(e),jp=(e,r)=>r/Math.sin(e),qp=(e,r)=>r/Math.cos(e),Jl={};T(Jl,{apexAngle:()=>Op,area:()=>Hp,baseAngle:()=>Yl,circumcircle:()=>Up,fromA:()=>Yp,fromB:()=>Kp,fromC:()=>Xp,fromCenter:()=>Jp,height:()=>kt,incircle:()=>Kl,legHeights:()=>Vp,medians:()=>Gp,perimeter:()=>Wp});var Yl=e=>Math.acos(e.base/(2*e.legs)),Op=e=>{const r=e.legs*e.legs,n=e.base*e.base;return Math.acos((2*r-n)/(2*r))},kt=e=>{const r=e.legs*e.legs,n=e.base*e.base;return Math.sqrt((4*r-n)/4)},Vp=e=>{const r=Yl(e);return e.base*Math.sin(r)},Wp=e=>2*e.legs+e.base,Hp=e=>kt(e)*e.base/2,Up=e=>{const r=kt(e),n=r*r,i=e.base*e.base;return{radius:(4*n+i)/(8*r)}},Kl=e=>{const r=kt(e);return{radius:e.base*r/(2*e.legs+e.base)}},Gp=e=>{const r=e.legs*e.legs,n=e.base*e.base,i=Math.sqrt(r+2*n)/2,s=Math.sqrt(4*r-n)/2;return[i,i,s]},Jp=(e,r={x:0,y:0})=>{const n=kt(e),i=Kl(e).radius,s=n-i,a={x:r.x-e.base/2,y:r.y+i},o={x:r.x+e.base/2,y:r.y+i},u={x:r.x,y:r.y-s};return{a,b:o,c:u}},Yp=(e,r={x:0,y:0})=>{const n=kt(e),i={x:r.x,y:r.y},s={x:r.x+e.base,y:r.y},a={x:r.x+e.base/2,y:r.y-n};return{a:i,b:s,c:a}},Kp=(e,r={x:0,y:0})=>{const n=kt(e),i={x:r.x,y:r.y},s={x:r.x-e.base,y:r.y},a={x:r.x-e.base/2,y:r.y-n};return{a:s,b:i,c:a}},Xp=(e,r={x:0,y:0})=>{const n=kt(e),i={x:r.x,y:r.y},s={x:r.x-e.base/2,y:r.y+n},a={x:r.x+e.base/2,y:r.y+n};return{a:s,b:a,c:i}},lo=Math.PI*2,Zp=Object.freeze({a:{x:0,y:0},b:{x:0,y:0},c:{x:0,y:0}}),Qp=Object.freeze({a:{x:NaN,y:NaN},b:{x:NaN,y:NaN},c:{x:NaN,y:NaN}}),em=e=>Dn(e.a)&&Dn(e.b)&&Dn(e.c),tm=e=>xn(e.a)&&xn(e.b)&&xn(e.c),rm=(e,r)=>Object.freeze({...e,a:r(e.a,"a"),b:r(e.b,"b"),c:r(e.c,"c")}),Le=(e,r="t")=>{if(e===void 0)throw Error("{$name} undefined");X(e.a,r+".a"),X(e.b,r+".b"),X(e.c,r+".c")},nm=e=>{if(e===void 0)return!1;const r=e;return!(!he(r.a)||!he(r.b)||!he(r.c))},im=(e,r)=>Wr(e.a,r.a)&&Wr(e.b,r.b)&&Wr(e.c,r.c),as=e=>(Le(e),[e.a,e.b,e.c]),si=e=>(Le(e),Ne.joinPointsToLines(e.a,e.b,e.c,e.a)),la=e=>(Le(e),[dt(e.a,e.b),dt(e.b,e.c),dt(e.c,e.a)]),en=e=>(Le(e),[dr(e.a,e.b),dr(e.b,e.c),dr(e.c,e.a)]),sm=e=>(Le(e),ha(en(e))),am=e=>{Le(e);const[r,n,i]=la(e);return r===n&&n===i},om=e=>{const[r,n,i]=la(e);return r===n||n===i||i===r},Xl=e=>en(e).some(r=>r===Math.PI/2),um=e=>!Xl(e),lm=e=>!en(e).some(r=>r>=Math.PI/2),cm=e=>en(e).some(r=>r>Math.PI/2),ai=e=>{Le(e);const r=al([e.a,e.b,e.c],(i,s)=>({x:i.x+s.x,y:i.y+s.y}));return{x:r.x/3,y:r.y/3}},Zl=e=>(Le(e),si(e).reduce((r,n)=>r+Ne.length(n),0)),Ql=e=>{Le(e,"t");const r=si(e).map(i=>Ne.length(i)),n=(r[0]+r[1]+r[2])/2;return Math.sqrt(n*(n-r[0])*(n-r[1])*(n-r[2]))},hm=e=>{const r=ai(e),n=Zl(e)/2;return{radius:Ql(e)/n,...r}},fm=e=>{const[r,n,i]=si(e).map(o=>Ne.length(o)),s=ai(e);return{radius:r*n*i/Math.sqrt((r+n+i)*(-r+n+i)*(r-n+i)*(r+n-i)),...s}},dm=(e,r,n={})=>{M(r,"positive","radius"),X(e,"origin");const i=n.initialAngleRadian??0,a=[i,i+lo*1/3,i+lo*2/3].map(o=>Ze.toCartesian(r,o,e));return ca(a)},vm=(e,r,n="b")=>{const i=n==="a"?e.a:n==="b"?e.b:e.c;return Object.freeze({a:Ut(e.a,r,i),b:Ut(e.b,r,i),c:Ut(e.c,r,i)})},ym=(e={x:0,y:0},r=10,n=Math.PI/2)=>{const i=Qi(e,r,Math.PI- -n/2),s=Qi(e,r,Math.PI-n/2);return{a:i,b:e,c:s}},pm=e=>(Le(e),[e.a.x,e.a.y,e.b.x,e.b.y,e.c.x,e.c.y]),mm=e=>{if(!Array.isArray(e))throw new Error("coords expected as array");if(e.length!==6)throw new Error(`coords array expected with 6 elements. Got ${e.length}`);return ca(il(...e))},ca=e=>{if(!Array.isArray(e))throw new Error("points expected as array");if(e.length!==3)throw new Error(`points array expected with 3 elements. Got ${e.length}`);return{a:e[0],b:e[1],c:e[2]}},ec=(e,r=0)=>{const{a:n,b:i,c:s}=e,a=Math.min(n.x,i.x,s.x)-r,o=Math.max(n.x,i.x,s.x)+r,u=Math.min(n.y,i.y,s.y)-r,l=Math.max(n.y,i.y,s.y)+r;return{x:a,y:u,width:o-a,height:l-u}},tc=(e,r,n)=>{const i=Zt(r,n),s=(l,c,h,f)=>(h.y-f.y)*l+(f.x-h.x)*c+h.x*f.y-f.x*h.y,a=s(i.x,i.y,e.b,e.c)/s(e.a.x,e.a.y,e.b,e.c),o=s(i.x,i.y,e.c,e.a)/s(e.b.x,e.b.y,e.c,e.a),u=s(i.x,i.y,e.a,e.b)/s(e.c.x,e.c.y,e.a,e.b);return{a,b:o,c:u}},gm=(e,r)=>{Le(e);const{a:n,b:i,c:s}=e,a=n.x*r.a+i.x*r.b+s.x*r.c,o=n.y*r.a+i.y*r.b+s.y*r.c;if(n.z&&i.z&&s.z){const u=n.z*r.a+i.z*r.b+s.z*r.c;return Object.freeze({x:a,y:o,z:u})}else return Object.freeze({x:a,y:o})},wm=(e,r,n)=>{const i=ec(e),s=Zt(r,n);if(!re.intersectsPoint(i,s))return!1;const a=tc(e,s);return 0<=a.a&&a.a<=1&&0<=a.b&&a.b<=1&&0<=a.c&&a.c<=1},Dm=(e,r,n)=>r===void 0||r===0?e:(n===void 0&&(n=ai(e)),Object.freeze({...e,a:Ut(e.a,r,n),b:Ut(e.b,r,n),c:Ut(e.c,r,n)}));function Bt(e){return Array.isArray(e)?e.map(r=>r*(Math.PI/180)):e*(Math.PI/180)}function ha(e){return Array.isArray(e)?e.map(r=>r*180/Math.PI):e*180/Math.PI}var rc=e=>Math.atan2(e.x,e.y);try{typeof window<"u"&&(window.ixfx={...window.ixfx,Geometry:{Circles:yt,Arcs:qs,Lines:Ne,Rects:re,Points:w,Paths:yr,Grids:ta,Beziers:Zr,Compound:Qs,Ellipses:oa,Polar:Ze,Shapes:ua,radiansFromAxisX:rc,radianToDegree:ha,degreeToRadian:Bt}})}catch{}var xm={};T(xm,{AudioAnalysers:()=>ac,AudioVisualisers:()=>oc,Bluetooth:()=>nc,Camera:()=>vc,Codec:()=>fa,Espruino:()=>lc,FrameProcessor:()=>$m,Serial:()=>cc,StringReceiveBuffer:()=>da,StringWriteBuffer:()=>va});var nc={};T(nc,{NordicBleDevice:()=>sc,defaultOpts:()=>oi});var fa=class{constructor(){y(this,"enc",new TextEncoder),y(this,"dec",new TextDecoder("utf-8"))}toBuffer(e){return this.enc.encode(e)}fromBuffer(e){return this.dec.decode(e)}},da=class{constructor(e,r=`
`){this.onData=e,this.separator=r,y(this,"buffer",""),y(this,"stream")}async close(){const e=this.stream;!e||(await e.abort(),await e.close())}clear(){this.buffer=""}writable(){return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){const e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}addImpl(e){const r=e.indexOf(this.separator);if(r<0)return this.buffer+=e,"";const n=e.substring(0,r);try{this.onData(this.buffer+n),e=e.substring(n.length+this.separator.length)}catch(i){console.warn(i)}return this.buffer="",e}add(e){for(;e.length>0;)e=this.addImpl(e)}},va=class{constructor(e,r=-1){this.onData=e,this.chunkSize=r,y(this,"paused",!1),y(this,"queue"),y(this,"writer"),y(this,"intervalMs"),y(this,"stream"),this.intervalMs=10,this.queue=xr(),this.writer=zs(()=>this.onWrite(),this.intervalMs)}async close(){const e=this.stream?.getWriter();e?.releaseLock(),await e?.close()}clear(){this.queue=xr()}writable(){return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){const e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}async onWrite(){if(this.queue.isEmpty)return!1;if(this.paused)return console.warn("WriteBuffer.onWrite: paused..."),!0;const e=this.queue.dequeue();return e===void 0?!1:(await this.onData(e),!0)}add(e){this.chunkSize>0?this.queue.enqueue(...af(e,this.chunkSize)):this.queue.enqueue(e),this.writer.start()}},ic=async(e,r=5,n=200,i)=>{ce(r,"positive","attempts"),ce(n,"positive","startingTimeoutMs");let s=n,a=0;for(;r>0;){try{return await e()}catch{r--}if(a+=s,i&&i.cancel)throw new Error("Cancelled");if(await Xt(s),i&&i.cancel)throw new Error("Cancelled");s*=2}throw new Error(`Retry failed after ${r} attempts over ${a} ms.`)},Em=class extends Mt{constructor(e,r){super();this.device=e,this.config=r,y(this,"states"),y(this,"codec"),y(this,"rx"),y(this,"tx"),y(this,"gatt"),y(this,"verboseLogging",!1),y(this,"rxBuffer"),y(this,"txBuffer"),this.verboseLogging=r.debug,this.txBuffer=new va(async n=>{await this.writeInternal(n)},r.chunkSize),this.rxBuffer=new da(n=>{this.fireEvent("data",{data:n})}),this.codec=new fa,this.states=new Fr("ready",{ready:"connecting",connecting:["connected","closed"],connected:["closed"],closed:"connecting"}),this.states.addEventListener("change",n=>{this.fireEvent("change",n),this.verbose(`${n.priorState} -> ${n.newState}`),n.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())}),e.addEventListener("gattserverdisconnected",()=>{this.isClosed||(this.verbose("GATT server disconnected"),this.states.state="closed")}),this.verbose(`ctor ${e.name} ${e.id}`)}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw new Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async writeInternal(e){this.verbose(`writeInternal ${e}`);const r=this.tx;if(r===void 0)throw new Error("Unexpectedly without tx characteristic");try{await r.writeValue(this.codec.toBuffer(e))}catch(n){this.warn(n)}}disconnect(){this.states.state==="connected"&&this.gatt?.disconnect()}async connect(){const e=this.config.connectAttempts??3;this.states.state="connecting",this.verbose("connect");const r=this.device.gatt;if(r===void 0)throw new Error("Gatt not available on device");await ic(async()=>{const n=await r.connect();this.verbose("Getting primary service");const i=await n.getPrimaryService(this.config.service);this.verbose("Getting characteristics");const s=await i.getCharacteristic(this.config.rxGattCharacteristic),a=await i.getCharacteristic(this.config.txGattCharacteristic);s.addEventListener("characteristicvaluechanged",o=>this.onRx(o)),this.rx=s,this.tx=a,this.gatt=r,this.states.state="connected",await s.startNotifications()},e,200)}onRx(e){if(this.rx===void 0)return;const n=e.target.value;if(n===void 0)return;let i=this.codec.fromBuffer(n.buffer);const s=Bn(i,19),a=Bn(i,17);a&&s<a&&(this.verbose("Tx plz start"),i=_n(i,a,1),this.txBuffer.paused=!1),s&&s>a&&(this.verbose("Tx plz stop"),i=_n(i,s,1),this.txBuffer.paused=!0),this.rxBuffer.add(i)}verbose(e){this.verboseLogging&&console.info(`${this.config.name} `,e)}log(e){console.log(`${this.config.name} `,e)}warn(e){console.warn(`${this.config.name} `,e)}},oi={chunkSize:20,service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",txGattCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",rxGattCharacteristic:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",name:"NordicDevice",connectAttempts:5,debug:!1},sc=class extends Em{constructor(e,r={}){super(e,{...oi,...r})}},ac={};T(ac,{AudioAnalyser:()=>ui,basic:()=>bm,freq:()=>Am,peakLevel:()=>Cm});var oc={};T(oc,{default:()=>uc});var uc=class{constructor(e,r){y(this,"freqMaxRange",200),y(this,"audio"),y(this,"parent"),y(this,"lastPointer",{x:0,y:0}),y(this,"pointerDown",!1),y(this,"pointerClicking",!1),y(this,"pointerClickDelayMs",100),y(this,"pointerDelaying",!1),y(this,"waveTracker"),y(this,"freqTracker"),y(this,"el"),this.audio=r,this.parent=e,this.waveTracker=Vr(),this.freqTracker=Vr(),e.innerHTML=`
    <section>
      <button id="rendererComponentToggle">\u{1F53C}</button>
      <div>
        <h1>Visualiser</h1>
        <div style="display:flex; flex-wrap: wrap">
          <div class="visPanel">
            <h2>Frequency distribution</h2>
            <br />
            <canvas id="rendererComponentFreqData" height="200" width="400"></canvas>
          </div>
          <div class="visPanel">
            <h2>Waveform</h2>
            <button id="rendererComponentWaveReset">Reset</button>
            <div>
              Press and hold on wave to measure
            </div>
            <br />
            <canvas id="rendererComponentWaveData" height="200" width="400"></canvas>
          </div>
        </div>
      </div>
    </section>
    `,this.el=e.children[0],document.getElementById("rendererComponentToggle")?.addEventListener("click",()=>{this.setExpanded(!this.isExpanded())}),this.el.addEventListener("pointermove",n=>this.onPointer(n)),this.el.addEventListener("pointerup",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),this.el.addEventListener("pointerdown",()=>{this.pointerDelaying=!0,setTimeout(()=>{this.pointerDelaying&&(this.pointerDelaying=!1,this.pointerDown=!0)},this.pointerClickDelayMs)}),this.el.addEventListener("pointerleave",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),document.getElementById("rendererComponentWaveReset")?.addEventListener("click",()=>{this.clear()})}renderFreq(e){if(!this.isExpanded()||!e)return;const r=document.getElementById("rendererComponentFreqData");if(r===null)throw new Error("Cannot find canvas element");const n=r.getContext("2d");if(n===null)throw new Error("Cannot create drawing context");const i=e.length,s=r.clientWidth,a=r.clientHeight;n.clearRect(0,0,s,a);const o=this.getPointerRelativeTo(r),u=s/i,l=Je.minMaxAvg(e);for(let c=0;c<i;c++){if(!Number.isFinite(e[c]))continue;const f=(e[c]-l.min)/this.freqMaxRange,d=Math.abs(a*f),D=a-d,F=c/i*360,B=c*u;if(n.fillStyle="hsl("+F+", 100%, 50%)",o.y>0&&o.y<=a&&o.x>=B&&o.x<=B+u){this.freqTracker.id!==c.toString()&&(this.freqTracker=Vr(c.toString())),this.freqTracker.seen(e[c]);const _=this.freqTracker.getMinMaxAvg();n.fillStyle="black",this.audio&&n.fillText(`Frequency (${c}) at pointer: ${this.audio.getFrequencyAtIndex(c).toLocaleString("en")} - ${this.audio.getFrequencyAtIndex(c+1).toLocaleString("en")}`,2,10),n.fillText(`Raw value: ${e[c].toFixed(2)}`,2,20),n.fillText(`Min: ${_.min.toFixed(2)}`,2,40),n.fillText(`Max: ${_.max.toFixed(2)}`,60,40),n.fillText(`Avg: ${_.avg.toFixed(2)}`,120,40)}n.fillRect(B,D,u,d)}}isExpanded(){const e=this.el.querySelector("div");if(e===null)throw new Error("contents div not found");return e.style.display===""}setExpanded(e){const r=this.el.querySelector("div"),n=this.el.querySelector("button");if(n===null)throw new Error("Button element not found");if(r===null)throw new Error("Contents element not found");e?(r.style.display="",n.innerText="\u{1F53C}"):(r.style.display="none",n.innerText="\u{1F53D}")}clear(){this.clearCanvas(document.getElementById("rendererComponentFreqData")),this.clearCanvas(document.getElementById("rendererComponentWaveData"))}clearCanvas(e){if(e===null)throw new Error("Canvas is null");const r=e.getContext("2d");if(r===null)throw new Error("Cannot create drawing context");r.fillStyle="white",r.fillRect(0,0,e.clientWidth,e.clientHeight)}renderWave(e,r=!0){if(!this.isExpanded()||!e)return;const n=document.getElementById("rendererComponentWaveData");if(n===null)throw new Error("Cannot find wave canvas");const i=n.getContext("2d");if(i===null)throw new Error("Cannot create drawing context for wave");const s=n.clientWidth,a=n.clientHeight,o=this.getPointerRelativeTo(n),u=20,l=60,c=e.length;i.fillStyle="white",i.fillRect(0,0,l,u);const h=s/c;i.fillStyle="rgba(255, 255, 255, 0.03)",i.fillRect(0,20,s,a),i.fillStyle="red",r?i.fillRect(0,a/2,s,1):i.fillRect(0,a-1,s,1),i.lineWidth=1,i.strokeStyle="black",i.beginPath();let f=0;for(let d=0;d<c;d++){const D=e[d]*a,F=r?a/2-D:a-D;d===0?i.moveTo(f,F):i.lineTo(f,F),f+=h,this.pointerDown&&this.waveTracker.seen(e[d])}if(i.lineTo(s,r?a/2:a),i.stroke(),this.pointerDown){const d=this.waveTracker.getMinMaxAvg();i.fillStyle="rgba(255,255,0,1)",i.fillRect(l,0,150,20),i.fillStyle="black",i.fillText("Min: "+d.min.toFixed(2),60,10),i.fillText("Max: "+d.max.toFixed(2),110,10),i.fillText("Avg: "+d.avg.toFixed(2),160,10)}else this.waveTracker.reset();o.y>0&&o.y<=a&&o.x>=0&&o.x<=s&&(i.fillStyle="black",i.fillText("Level: "+(1-o.y/a).toFixed(2),2,10))}getPointerRelativeTo(e){const r=e.getBoundingClientRect();return{x:this.lastPointer.x-r.left-window.scrollX,y:this.lastPointer.y-r.top-window.scrollY}}onPointer(e){this.lastPointer={x:e.pageX,y:e.pageY},e.preventDefault()}},bm=(e,r={})=>new ui((n,i)=>{const s=new Float32Array(n.frequencyBinCount),a=new Float32Array(n.fftSize);n.getFloatFrequencyData(s),n.getFloatTimeDomainData(a),e(s,a,i)},r),Am=(e,r={})=>new ui((n,i)=>{const s=new Float32Array(n.frequencyBinCount);n.getFloatFrequencyData(s),e(s,i)},r),Cm=(e,r={})=>new ui((n,i)=>{const s=new Float32Array(n.fftSize);n.getFloatTimeDomainData(s),e(Je.maxFast(s),i)},r),Rr,ur,ui=class{constructor(e,r={}){if(y(this,"showVis"),y(this,"fftSize"),y(this,"smoothingTimeConstant"),le(this,Rr,!1),y(this,"debug"),le(this,ur,!1),y(this,"visualiser"),y(this,"audioCtx"),y(this,"analyserNode"),y(this,"analyse"),this.showVis=r.showVis??!1,this.fftSize=r.fftSize??1024,this.debug=r.debug??!1,this.smoothingTimeConstant=r.smoothingTimeConstant??.8,ce(this.fftSize,"positive","opts.fftSize"),M(this.smoothingTimeConstant,"percentage","opts.smoothingTimeConstant"),!Bo(this.fftSize))throw new Error(`fftSize must be a power of two from 32 to 32768 (${this.fftSize})`);if(this.fftSize<32)throw new Error("fftSize must be at least 32");if(this.fftSize>32768)throw new Error("fftSize must be no greater than 32768");this.analyse=e,this.paused=!1,this.init();const n=document.getElementById("audio-visualiser");if(n){const i=new uc(n,this);i.setExpanded(this.showVis),this.visualiser=i}}init(){if(E(this,ur)){this.debug&&console.debug("Init already in progress");return}Z(this,ur,!0),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.onMicSuccess(e)}).catch(e=>{Z(this,ur,!1),console.error(e)})}get paused(){return E(this,Rr)}set paused(e){e!==E(this,Rr)&&(Z(this,Rr,e),e?this.debug&&console.log("Paused"):(this.debug&&console.log("Unpaused"),window.requestAnimationFrame(this.analyseLoop.bind(this))))}setup(e,r){const n=e.createAnalyser();return n.fftSize=this.fftSize,n.smoothingTimeConstant=this.smoothingTimeConstant,e.createMediaStreamSource(r).connect(n),n}onMicSuccess(e){try{const r=new AudioContext;r.addEventListener("statechange",()=>{this.debug&&console.log(`Audio context state: ${r.state}`)}),this.audioCtx=r,this.analyserNode=this.setup(r,e),window.requestAnimationFrame(this.analyseLoop.bind(this))}catch(r){Z(this,ur,!1),console.error(r)}}analyseLoop(){if(this.paused){this.debug&&console.log("Paused");return}const e=this.analyserNode;if(e===void 0){console.warn("Analyser undefined");return}try{this.analyse(e,this)}catch(r){console.error(r)}window.requestAnimationFrame(this.analyseLoop.bind(this))}getFrequencyRangeMax(e,r,n){const i=this.sliceByFrequency(e,r,n);return Je.max(i)}sliceByFrequency(e,r,n){const i=this.getIndexForFrequency(e),s=this.getIndexForFrequency(r);return n.slice(i,s)}getFrequencyAtIndex(e){const r=this.analyserNode,n=this.audioCtx;if(r===void 0)throw new Error("Analyser not available");if(n===void 0)throw new Error("Audio context not available");if(ce(e,"positive","index"),e>r.frequencyBinCount)throw new Error(`Index ${e} exceeds frequency bin count ${r.frequencyBinCount}`);return e*n.sampleRate/(r.frequencyBinCount*2)}getIndexForFrequency(e){const r=this.analyserNode;if(r===void 0)throw new Error("Analyser not available");const n=r.context.sampleRate/2,i=Math.round(e/n*r.frequencyBinCount);return i<0?0:i>=r.frequencyBinCount?r.frequencyBinCount-1:i}};Rr=new WeakMap;ur=new WeakMap;var lc={};T(lc,{EspruinoBleDevice:()=>ya,EspruinoSerialDevice:()=>fc,connectBle:()=>_m,deviceEval:()=>pa,puck:()=>Sm,serial:()=>Bm});var ya=class extends sc{constructor(e,r={}){super(e,r);y(this,"evalTimeoutMs"),y(this,"evalReplyBluetooth",!0),this.evalTimeoutMs=r.evalTimeoutMs??5*1e3}async writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},n){const i=r.debug??!1;return pa(e,r,this,"Bluetooth.println",i,n??(a=>this.warn(a)))}},cc={};T(cc,{Device:()=>hc});var Fm=class extends Mt{constructor(e={}){super();y(this,"states"),y(this,"codec"),y(this,"verboseLogging",!1),y(this,"name"),y(this,"connectAttempts"),y(this,"chunkSize"),y(this,"rxBuffer"),y(this,"txBuffer"),this.verboseLogging=e.debug??!1,this.chunkSize=e.chunkSize??1024,this.connectAttempts=e.connectAttempts??3,this.name=e.name??"JsonDevice",this.txBuffer=new va(async r=>{await this.writeInternal(r)},e.chunkSize),this.rxBuffer=new da(r=>{this.fireEvent("data",{data:r})}),this.codec=new fa,this.states=new Fr("ready",{ready:"connecting",connecting:["connected","closed"],connected:["closed"],closed:"connecting"}),this.states.addEventListener("change",r=>{this.fireEvent("change",r),this.verbose(`${r.priorState} -> ${r.newState}`),r.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())})}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw new Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async close(){this.states.state==="connected"&&this.onClosed()}async connect(){const e=this.connectAttempts;this.states.state="connecting",await this.onPreConnect(),await ic(async()=>{await this.onConnectAttempt(),this.states.state="connected"},e,200)}onRx(e){const r=e.target.value;if(r===void 0)return;let n=this.codec.fromBuffer(r.buffer);const i=Bn(n,19),s=Bn(n,17);s&&i<s&&(this.verbose("Tx plz start"),n=_n(n,s,1),this.txBuffer.paused=!1),i&&i>s&&(this.verbose("Tx plz stop"),n=_n(n,i,1),this.txBuffer.paused=!0),this.rxBuffer.add(n)}verbose(e){this.verboseLogging&&console.info(`${this.name} `,e)}log(e){console.log(`${this.name} `,e)}warn(e){console.warn(`${this.name} `,e)}},hc=class extends Fm{constructor(e={}){super(e);this.config=e,y(this,"port"),y(this,"tx"),y(this,"abort"),y(this,"baudRate"),this.abort=new AbortController;const r=e.eol??`\r
`;this.baudRate=e.baudRate??9600,e.name===void 0&&(super.name="Serial.Device"),this.rxBuffer.separator=r}async writeInternal(e){if(this.tx===void 0)throw new Error("tx not ready");try{this.tx.write(e)}catch(r){this.warn(r)}}onClosed(){this.tx?.releaseLock(),this.abort.abort("closing port"),this.states.state="closed"}onPreConnect(){return Promise.resolve()}async onConnectAttempt(){let e={};const r={baudRate:this.baudRate};this.config.filters&&(e={filters:[...this.config.filters]}),this.port=await navigator.serial.requestPort(e),this.port.addEventListener("disconnect",o=>{this.close()}),await this.port.open(r);const n=this.port.writable,i=new TextEncoderStream;n!==null&&(i.readable.pipeTo(n,{signal:this.abort.signal}).catch(o=>{console.log("Serial.onConnectAttempt txText pipe:"),console.log(o)}),this.tx=i.writable.getWriter());const s=this.port.readable,a=new TextDecoderStream;s!==null&&(s.pipeTo(a.writable,{signal:this.abort.signal}).catch(o=>{console.log("Serial.onConnectAttempt rxR pipe:"),console.log(o)}),a.readable.pipeTo(this.rxBuffer.writable(),{signal:this.abort.signal}).catch(o=>{console.log("Serial.onConnectAttempt rxText pipe:"),console.log(o);try{this.port?.close()}catch(u){console.log(u)}}))}},fc=class extends hc{constructor(e){super(e);y(this,"evalTimeoutMs"),y(this,"evalReplyBluetooth",!1),e===void 0&&(e={}),this.evalTimeoutMs=e.evalTimeoutMs??5*1e3}async disconnect(){return super.close()}async writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},n){const i=r.debug??!1;return pa(e,r,this,"USB.println",i,n??(a=>this.warn(a)))}},Sm=async(e={})=>{const r=e.name??"Puck",n=e.debug??!1,i=await navigator.bluetooth.requestDevice({filters:dc(e),optionalServices:[oi.service]});console.log(i.name);const s=new ya(i,{name:r,debug:n});return await s.connect(),s},Bm=async(e={})=>{const r=new fc(e);return await r.connect(),r},dc=e=>{const r=[];return e.filters?r.push(...e.filters):e.name?(r.push({name:e.name}),console.info(`Filtering Bluetooth devices by name '${e.name}'`)):r.push({namePrefix:"Puck.js"}),r},_m=async(e={})=>{const r=await navigator.bluetooth.requestDevice({filters:dc(e),optionalServices:[oi.service]}),n=new ya(r,{name:"Espruino"});return await n.connect(),n},pa=async(e,r={},n,i,s,a)=>{const o=r.timeoutMs??n.evalTimeoutMs,u=r.assumeExclusive??!0;if(typeof e!="string")throw new Error("code parameter should be a string");return new Promise((l,c)=>{const h=Ih(5),f=B=>{try{let _=B.data;_.startsWith(">{")&&_.endsWith("}")&&(_=_.substring(1));const N=JSON.parse(_);"reply"in N?N.reply===h?(D(),"result"in N&&l(N.result)):a(`Expected reply ${h}, got ${N.reply}`):a(`Expected packet, missing 'reply' field. Got: ${B.data}`)}catch(_){u?D(B.data):a(_)}},d=B=>{B.newState!=="connected"&&D(`State changed to '${B.newState}', aborting`)};n.addEventListener("data",f),n.addEventListener("change",d);const D=ks(o,B=>{c(B)},()=>{n.removeEventListener("data",f),n.removeEventListener("change",d)}),F=`${i}(JSON.stringify({reply:"${h}", result:JSON.stringify(${e})}))
`;s&&a(F),n.write(F)})},vc={};T(vc,{dumpDevices:()=>Pm,start:()=>yc});var Pm=async(e="videoinput")=>{(await navigator.mediaDevices.enumerateDevices()).forEach(n=>{n.kind===e&&(console.log(n.label),console.log(` Kind: ${n.kind}`),console.log(` Device id: ${n.deviceId}`))})},Mm=1e4,yc=async(e={})=>{const r=document.createElement("VIDEO");r.style.display="none",r.classList.add("ixfx-camera"),document.body.appendChild(r);let n=()=>{};const i=()=>{try{n()}catch{}r.remove()};try{return n=(await Nm(r,e)).dispose,{videoEl:r,dispose:i}}catch(s){throw console.error(s),i(),s}},Nm=async(e,r={})=>{if(e===void 0)throw new Error("videoEl undefined");if(e===null)throw new Error("videoEl null");const n=r.max,i=r.min,s=r.ideal,a={audio:!1,video:{width:{},height:{}}};r.facingMode==="front"&&(r={...r,facingMode:"user"}),r.facingMode==="back"&&(r={...r,facingMode:"environment"}),r.facingMode&&(a.video.facingMode=r.facingMode),r.deviceId&&(a.video.deviceId=r.deviceId),s&&(a.video.width={...a.video.width,ideal:s.width},a.video.height={...a.video.height,ideal:s.height}),n&&(a.video.width={...a.video.width,max:n.width},a.video.height={...a.video.height,max:n.height}),i&&(a.video.width={...a.video.width,min:i.width},a.video.height={...a.video.height,min:i.height});const o=ks(r.startTimeoutMs??Mm,u=>{throw new Error(`Camera getUserMedia failed: ${u}`)});try{const u=await navigator.mediaDevices.getUserMedia(a),l=()=>{e.pause(),u.getTracks().forEach(d=>d.stop())};e.srcObject=u,o();const c={videoEl:e,dispose:l};return new Promise((f,d)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{f(c)}).catch(D=>{d(D)})})})}catch(u){throw o(u.toString()),u}},ma={};T(ma,{capture:()=>km,frames:()=>zm,manualCapture:()=>pc});async function*zm(e,r={}){const n=r.maxIntervalMs??0,i=r.showCanvas??!1;let s=r.canvasEl,a,o;a=o=0,s===void 0&&(s=document.createElement("CANVAS"),s.classList.add("ixfx-frames"),i||(s.style.display="none"),document.body.appendChild(s));const u=()=>{s!==void 0&&(a=e.videoWidth,o=e.videoHeight,s.width=a,s.height=o)};let l=null;const c=Ss(n);for await(const h of c){if((a===0||o===0)&&u(),a===0||o===0)continue;if(l===null&&(l=s.getContext("2d")),l===null)return;l.drawImage(e,0,0,a,o),yield l.getImageData(0,0,a,o)}}var km=(e,r={})=>{const n=r.maxIntervalMs??0,i=r.showCanvas??!1,s=r.onFrame,a=e.videoWidth,o=e.videoHeight,u=document.createElement("CANVAS");u.classList.add("ixfx-capture"),i||(u.style.display="none"),u.width=a,u.height=o;let l=null,c;r.workerScript&&(c=new Worker(r.workerScript));const h=c||s;!h&&!i&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");const f=zs(()=>{if(l===null&&(l=u.getContext("2d")),l===null)return;l.drawImage(e,0,0,a,o);let d;if(h&&(d=l.getImageData(0,0,a,o)),c&&c.postMessage({pixels:d.data.buffer,width:a,height:o,channels:4},[d.data.buffer]),s)try{s(d)}catch(D){console.error(D)}},n);return{start:()=>f.start(),cancel:()=>f.cancel(),canvasEl:u}},pc=(e,r={})=>{const n=r.showCanvas??!1,i=e.videoWidth,s=e.videoHeight,a=r.canvasEl!==void 0;let o=r.canvasEl;return o||(o=document.createElement("CANVAS"),o.classList.add("ixfx-capture"),document.body.append(o),n||(o.style.display="none")),o.width=i,o.height=s,{canvasEl:o,capture:()=>{let h;if(h||(h=o?.getContext("2d")),!h)throw new Error("Could not create graphics context");h.drawImage(e,0,0,i,s);const f=h.getImageData(0,0,i,s);return f.currentTime=e.currentTime,r.postCaptureDraw&&r.postCaptureDraw(h,i,s),f},dispose:()=>{if(!a)try{o?.remove()}catch{}}}},$m=class{constructor(e={}){y(this,"_source"),y(this,"_state"),y(this,"_teardownNeeded",!1),y(this,"_cameraConstraints"),y(this,"_cameraStartResult"),y(this,"_cameraCapture"),y(this,"_showCanvas"),y(this,"_showPreview"),y(this,"_postCaptureDraw"),y(this,"_timer"),y(this,"_captureCanvasEl"),this._state="ready",this._source="",this._timer=performance.now(),this._showCanvas=e.showCanvas??!1,this._showPreview=e.showPreview??!1,this._cameraConstraints=e.cameraConstraints??void 0,this._captureCanvasEl=e.captureCanvasEl??void 0,this._postCaptureDraw=e.postCaptureDraw}showPreview(e){if(this._state==="disposed")throw new Error("Disposed");let r;switch(this._source){case"camera":r=this._cameraStartResult?.videoEl,r!==void 0&&(r.style.display=e?"block":"none");break}this._showPreview=e}showCanvas(e){if(this._state==="disposed")throw new Error("Disposed");let r;switch(this._source){case"camera":r=this._cameraCapture?.canvasEl,r!==void 0&&(r.style.display=e?"block":"none");break}this._showCanvas=e}getCapturer(){if(this._state==="disposed")throw new Error("Disposed");switch(this._source){case"camera":return this._cameraCapture}}async useCamera(e){if(this._state==="disposed")throw new Error("Disposed");this._source="camera",this._teardownNeeded&&this.teardown(),e&&this._cameraConstraints,await this.init()}async initCamera(){const e=await yc(this._cameraConstraints);if(e===void 0)throw new Error("Could not start camera");this._showPreview&&(e.videoEl.style.display="block"),this._cameraCapture=pc(e.videoEl,{postCaptureDraw:this._postCaptureDraw,showCanvas:this._showCanvas,canvasEl:this._captureCanvasEl}),this._cameraStartResult=e,this._teardownNeeded=!0,this._cameraStartResult=e}dispose(){this._state!=="disposed"&&(this.teardown(),this._state="disposed")}async init(){switch(this._timer=performance.now(),this._source){case"camera":await this.initCamera();break}this._state="initialised"}teardown(){if(!!this._teardownNeeded){switch(this._source){case"camera":this._cameraCapture?.dispose(),this._cameraStartResult?.dispose();break}this._teardownNeeded=!1}}getFrame(){if(this._state==="disposed")throw new Error("Disposed");switch(this._source){case"camera":return this.getFrameCamera()}}getTimestamp(){return performance.now()-this._timer}getFrameCamera(){return this._cameraCapture?.capture()}},Tm={};T(Tm,{Colour:()=>tn,Drawing:()=>li,Palette:()=>ka,Plot:()=>Pa,Plot2:()=>Na,SceneGraph:()=>za,Svg:()=>Sa,Video:()=>ma});var li={};T(li,{arc:()=>Ic,bezier:()=>jc,circle:()=>Rc,connectedPoints:()=>fi,copyToImg:()=>Bg,dot:()=>Ue,drawingStack:()=>hr,ellipse:()=>Fg,getCtx:()=>Tc,line:()=>Fa,lineThroughPoints:()=>Cg,makeHelper:()=>Eg,paths:()=>Lc,pointLabels:()=>di,rect:()=>Oc,textBlock:()=>Vc,textBlockAligned:()=>Mg,textWidth:()=>fr,translatePoint:()=>Sg,triangle:()=>Pg});var tn={};T(tn,{getCssVariable:()=>zc,goldenAngleColour:()=>yg,interpolate:()=>mg,opacity:()=>Kr,randomHue:()=>ba,scale:()=>gg,toHex:()=>pg,toHsl:()=>vg,toRgb:()=>Nc});function Sr(e,r,n){e.prototype=r.prototype=n,n.constructor=e}function rn(e,r){var n=Object.create(e.prototype);for(var i in r)n[i]=r[i];return n}function $t(){}var Qt=.7,br=1/Qt,pr="\\s*([+-]?\\d+)\\s*",Jr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Qe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Im=/^#([0-9a-f]{3,8})$/,Rm=new RegExp(`^rgb\\(${pr},${pr},${pr}\\)$`),Lm=new RegExp(`^rgb\\(${Qe},${Qe},${Qe}\\)$`),jm=new RegExp(`^rgba\\(${pr},${pr},${pr},${Jr}\\)$`),qm=new RegExp(`^rgba\\(${Qe},${Qe},${Qe},${Jr}\\)$`),Om=new RegExp(`^hsl\\(${Jr},${Qe},${Qe}\\)$`),Vm=new RegExp(`^hsla\\(${Jr},${Qe},${Qe},${Jr}\\)$`),co={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Sr($t,Ar,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:ho,formatHex:ho,formatHex8:Wm,formatHsl:Hm,formatRgb:fo,toString:fo});function ho(){return this.rgb().formatHex()}function Wm(){return this.rgb().formatHex8()}function Hm(){return mc(this).formatHsl()}function fo(){return this.rgb().formatRgb()}function Ar(e){var r,n;return e=(e+"").trim().toLowerCase(),(r=Im.exec(e))?(n=r[1].length,r=parseInt(r[1],16),n===6?vo(r):n===3?new we(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):n===8?dn(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):n===4?dn(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=Rm.exec(e))?new we(r[1],r[2],r[3],1):(r=Lm.exec(e))?new we(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=jm.exec(e))?dn(r[1],r[2],r[3],r[4]):(r=qm.exec(e))?dn(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=Om.exec(e))?mo(r[1],r[2]/100,r[3]/100,1):(r=Vm.exec(e))?mo(r[1],r[2]/100,r[3]/100,r[4]):co.hasOwnProperty(e)?vo(co[e]):e==="transparent"?new we(NaN,NaN,NaN,0):null}function vo(e){return new we(e>>16&255,e>>8&255,e&255,1)}function dn(e,r,n,i){return i<=0&&(e=r=n=NaN),new we(e,r,n,i)}function ga(e){return e instanceof $t||(e=Ar(e)),e?(e=e.rgb(),new we(e.r,e.g,e.b,e.opacity)):new we}function Ln(e,r,n,i){return arguments.length===1?ga(e):new we(e,r,n,i??1)}function we(e,r,n,i){this.r=+e,this.g=+r,this.b=+n,this.opacity=+i}Sr(we,Ln,rn($t,{brighter(e){return e=e==null?br:Math.pow(br,e),new we(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Qt:Math.pow(Qt,e),new we(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new we(Jt(this.r),Jt(this.g),Jt(this.b),jn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:yo,formatHex:yo,formatHex8:Um,formatRgb:po,toString:po}));function yo(){return`#${Ht(this.r)}${Ht(this.g)}${Ht(this.b)}`}function Um(){return`#${Ht(this.r)}${Ht(this.g)}${Ht(this.b)}${Ht((isNaN(this.opacity)?1:this.opacity)*255)}`}function po(){const e=jn(this.opacity);return`${e===1?"rgb(":"rgba("}${Jt(this.r)}, ${Jt(this.g)}, ${Jt(this.b)}${e===1?")":`, ${e})`}`}function jn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Jt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ht(e){return e=Jt(e),(e<16?"0":"")+e.toString(16)}function mo(e,r,n,i){return i<=0?e=r=n=NaN:n<=0||n>=1?e=r=NaN:r<=0&&(e=NaN),new He(e,r,n,i)}function mc(e){if(e instanceof He)return new He(e.h,e.s,e.l,e.opacity);if(e instanceof $t||(e=Ar(e)),!e)return new He;if(e instanceof He)return e;e=e.rgb();var r=e.r/255,n=e.g/255,i=e.b/255,s=Math.min(r,n,i),a=Math.max(r,n,i),o=NaN,u=a-s,l=(a+s)/2;return u?(r===a?o=(n-i)/u+(n<i)*6:n===a?o=(i-r)/u+2:o=(r-n)/u+4,u/=l<.5?a+s:2-a-s,o*=60):u=l>0&&l<1?0:o,new He(o,u,l,e.opacity)}function qn(e,r,n,i){return arguments.length===1?mc(e):new He(e,r,n,i??1)}function He(e,r,n,i){this.h=+e,this.s=+r,this.l=+n,this.opacity=+i}Sr(He,qn,rn($t,{brighter(e){return e=e==null?br:Math.pow(br,e),new He(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Qt:Math.pow(Qt,e),new He(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*r,s=2*n-i;return new we(Pi(e>=240?e-240:e+120,s,i),Pi(e,s,i),Pi(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new He(go(this.h),vn(this.s),vn(this.l),jn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=jn(this.opacity);return`${e===1?"hsl(":"hsla("}${go(this.h)}, ${vn(this.s)*100}%, ${vn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function go(e){return e=(e||0)%360,e<0?e+360:e}function vn(e){return Math.max(0,Math.min(1,e||0))}function Pi(e,r,n){return(e<60?r+(n-r)*e/60:e<180?n:e<240?r+(n-r)*(240-e)/60:r)*255}var gc=Math.PI/180,wc=180/Math.PI,On=18,Dc=.96422,xc=1,Ec=.82521,bc=4/29,mr=6/29,Ac=3*mr*mr,Gm=mr*mr*mr;function Cc(e){if(e instanceof et)return new et(e.l,e.a,e.b,e.opacity);if(e instanceof ft)return Fc(e);e instanceof we||(e=ga(e));var r=ki(e.r),n=ki(e.g),i=ki(e.b),s=Mi((.2225045*r+.7168786*n+.0606169*i)/xc),a,o;return r===n&&n===i?a=o=s:(a=Mi((.4360747*r+.3850649*n+.1430804*i)/Dc),o=Mi((.0139322*r+.0971045*n+.7141733*i)/Ec)),new et(116*s-16,500*(a-s),200*(s-o),e.opacity)}function os(e,r,n,i){return arguments.length===1?Cc(e):new et(e,r,n,i??1)}function et(e,r,n,i){this.l=+e,this.a=+r,this.b=+n,this.opacity=+i}Sr(et,os,rn($t,{brighter(e){return new et(this.l+On*(e??1),this.a,this.b,this.opacity)},darker(e){return new et(this.l-On*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,r=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return r=Dc*Ni(r),e=xc*Ni(e),n=Ec*Ni(n),new we(zi(3.1338561*r-1.6168667*e-.4906146*n),zi(-.9787684*r+1.9161415*e+.033454*n),zi(.0719453*r-.2289914*e+1.4052427*n),this.opacity)}}));function Mi(e){return e>Gm?Math.pow(e,1/3):e/Ac+bc}function Ni(e){return e>mr?e*e*e:Ac*(e-bc)}function zi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function ki(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Jm(e){if(e instanceof ft)return new ft(e.h,e.c,e.l,e.opacity);if(e instanceof et||(e=Cc(e)),e.a===0&&e.b===0)return new ft(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var r=Math.atan2(e.b,e.a)*wc;return new ft(r<0?r+360:r,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function us(e,r,n,i){return arguments.length===1?Jm(e):new ft(e,r,n,i??1)}function ft(e,r,n,i){this.h=+e,this.c=+r,this.l=+n,this.opacity=+i}function Fc(e){if(isNaN(e.h))return new et(e.l,0,0,e.opacity);var r=e.h*gc;return new et(e.l,Math.cos(r)*e.c,Math.sin(r)*e.c,e.opacity)}Sr(ft,us,rn($t,{brighter(e){return new ft(this.h,this.c,this.l+On*(e??1),this.opacity)},darker(e){return new ft(this.h,this.c,this.l-On*(e??1),this.opacity)},rgb(){return Fc(this).rgb()}}));var Sc=-.14861,wa=1.78277,Da=-.29227,ci=-.90649,Yr=1.97294,wo=Yr*ci,Do=Yr*wa,xo=wa*Da-ci*Sc;function Ym(e){if(e instanceof Yt)return new Yt(e.h,e.s,e.l,e.opacity);e instanceof we||(e=ga(e));var r=e.r/255,n=e.g/255,i=e.b/255,s=(xo*i+wo*r-Do*n)/(xo+wo-Do),a=i-s,o=(Yr*(n-s)-Da*a)/ci,u=Math.sqrt(o*o+a*a)/(Yr*s*(1-s)),l=u?Math.atan2(o,a)*wc-120:NaN;return new Yt(l<0?l+360:l,u,s,e.opacity)}function ls(e,r,n,i){return arguments.length===1?Ym(e):new Yt(e,r,n,i??1)}function Yt(e,r,n,i){this.h=+e,this.s=+r,this.l=+n,this.opacity=+i}Sr(Yt,ls,rn($t,{brighter(e){return e=e==null?br:Math.pow(br,e),new Yt(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Qt:Math.pow(Qt,e),new Yt(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*gc,r=+this.l,n=isNaN(this.s)?0:this.s*r*(1-r),i=Math.cos(e),s=Math.sin(e);return new we(255*(r+n*(Sc*i+wa*s)),255*(r+n*(Da*i+ci*s)),255*(r+n*(Yr*i)),this.opacity)}}));var hi=e=>()=>e;function Bc(e,r){return function(n){return e+n*r}}function Km(e,r,n){return e=Math.pow(e,n),r=Math.pow(r,n)-e,n=1/n,function(i){return Math.pow(e+i*r,n)}}function xa(e,r){var n=r-e;return n?Bc(e,n>180||n<-180?n-360*Math.round(n/360):n):hi(isNaN(e)?r:e)}function Xm(e){return(e=+e)==1?De:function(r,n){return n-r?Km(r,n,e):hi(isNaN(r)?n:r)}}function De(e,r){var n=r-e;return n?Bc(e,n):hi(isNaN(e)?r:e)}var Vn=function e(r){var n=Xm(r);function i(s,a){var o=n((s=Ln(s)).r,(a=Ln(a)).r),u=n(s.g,a.g),l=n(s.b,a.b),c=De(s.opacity,a.opacity);return function(h){return s.r=o(h),s.g=u(h),s.b=l(h),s.opacity=c(h),s+""}}return i.gamma=e,i}(1);function Zm(e,r){r||(r=[]);var n=e?Math.min(r.length,e.length):0,i=r.slice(),s;return function(a){for(s=0;s<n;++s)i[s]=e[s]*(1-a)+r[s]*a;return i}}function Qm(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function eg(e,r){var n=r?r.length:0,i=e?Math.min(n,e.length):0,s=new Array(i),a=new Array(n),o;for(o=0;o<i;++o)s[o]=Ea(e[o],r[o]);for(;o<n;++o)a[o]=r[o];return function(u){for(o=0;o<i;++o)a[o]=s[o](u);return a}}function tg(e,r){var n=new Date;return e=+e,r=+r,function(i){return n.setTime(e*(1-i)+r*i),n}}function cs(e,r){return e=+e,r=+r,function(n){return e*(1-n)+r*n}}function rg(e,r){var n={},i={},s;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(s in r)s in e?n[s]=Ea(e[s],r[s]):i[s]=r[s];return function(a){for(s in n)i[s]=n[s](a);return i}}var hs=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$i=new RegExp(hs.source,"g");function ng(e){return function(){return e}}function ig(e){return function(r){return e(r)+""}}function sg(e,r){var n=hs.lastIndex=$i.lastIndex=0,i,s,a,o=-1,u=[],l=[];for(e=e+"",r=r+"";(i=hs.exec(e))&&(s=$i.exec(r));)(a=s.index)>n&&(a=r.slice(n,a),u[o]?u[o]+=a:u[++o]=a),(i=i[0])===(s=s[0])?u[o]?u[o]+=s:u[++o]=s:(u[++o]=null,l.push({i:o,x:cs(i,s)})),n=$i.lastIndex;return n<r.length&&(a=r.slice(n),u[o]?u[o]+=a:u[++o]=a),u.length<2?l[0]?ig(l[0].x):ng(r):(r=l.length,function(c){for(var h=0,f;h<r;++h)u[(f=l[h]).i]=f.x(c);return u.join("")})}function Ea(e,r){var n=typeof r,i;return r==null||n==="boolean"?hi(r):(n==="number"?cs:n==="string"?(i=Ar(r))?(r=i,Vn):sg:r instanceof Ar?Vn:r instanceof Date?tg:Qm(r)?Zm:Array.isArray(r)?eg:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?rg:cs)(e,r)}function _c(e){return function(r,n){var i=e((r=qn(r)).h,(n=qn(n)).h),s=De(r.s,n.s),a=De(r.l,n.l),o=De(r.opacity,n.opacity);return function(u){return r.h=i(u),r.s=s(u),r.l=a(u),r.opacity=o(u),r+""}}}var ag=_c(xa),og=_c(De);function ug(e,r){var n=De((e=os(e)).l,(r=os(r)).l),i=De(e.a,r.a),s=De(e.b,r.b),a=De(e.opacity,r.opacity);return function(o){return e.l=n(o),e.a=i(o),e.b=s(o),e.opacity=a(o),e+""}}function Pc(e){return function(r,n){var i=e((r=us(r)).h,(n=us(n)).h),s=De(r.c,n.c),a=De(r.l,n.l),o=De(r.opacity,n.opacity);return function(u){return r.h=i(u),r.c=s(u),r.l=a(u),r.opacity=o(u),r+""}}}var lg=Pc(xa),cg=Pc(De);function Mc(e){return function r(n){n=+n;function i(s,a){var o=e((s=ls(s)).h,(a=ls(a)).h),u=De(s.s,a.s),l=De(s.l,a.l),c=De(s.opacity,a.opacity);return function(h){return s.h=o(h),s.s=u(h),s.l=l(Math.pow(h,n)),s.opacity=c(h),s+""}}return i.gamma=r,i}(1)}var hg=Mc(xa),fg=Mc(De);function dg(e,r){r===void 0&&(r=e,e=Ea);for(var n=0,i=r.length-1,s=r[0],a=new Array(i<0?0:i);n<i;)a[n]=e(s,s=r[++n]);return function(o){var u=Math.max(0,Math.min(i-1,Math.floor(o*=i)));return a[u](o-u)}}var vg=e=>{const r=Nc(e),n=xg(r.r,r.b,r.g);return r.opacity?{...n,opacity:r.opacity}:n},yg=(e,r=.5,n=.75,i=1)=>{M(e,"positive","index"),M(r,"percentage","saturation"),M(n,"percentage","lightness"),M(i,"percentage","alpha");const s=e*137.508;if(i===1)return`hsl(${s},${r*100}%,${n*100}%)`},ba=(e=Ye)=>e()*360,Nc=e=>{const r=Aa(e),n=r.rgb();return r.opacity<1?{r:n.r,g:n.g,b:n.b,opacity:r.opacity}:{r:n.r,g:n.g,b:n.b}},Aa=e=>{if(typeof e=="string"){const r=Ar(e);if(r!==null)return r}else{if(wg(e))return qn(e.h,e.s,e.l);if(Dg(e))return Ln(e.r,e.g,e.b)}throw new Error(`Could not resolve colour ${JSON.stringify(e)}`)},pg=e=>Aa(e).formatHex(),Kr=(e,r)=>{const n=Aa(e);return n.opacity*=r,n.toString()},zc=(e,r="black",n)=>{n===void 0&&(n=document.body);const i=getComputedStyle(n).getPropertyValue(`--${e}`).trim();return i===void 0||i.length===0?r:i},mg=(e,r,n,i)=>{if(M(e,"percentage","amount"),typeof r!="string")throw new Error("Expected string for 'from' param");if(typeof n!="string")throw new Error("Expected string for 'to' param");let s;typeof i>"u"?s={}:typeof i=="string"?s={space:i}:s=i;const a=kc(s,[r,n]);if(a===void 0)throw new Error("Could not handle colour/space");return a(e)},kc=(e,r)=>{if(!Array.isArray(r))throw new Error("Expected one or more colours as parameters");let n;if(typeof e>"u"?n={}:typeof e=="string"?n={space:e}:n=e,!Array.isArray(r))throw new Error("Expected array for colours parameter");if(r.length<2)throw new Error("Interpolation expects at least two colours");const{space:i="rgb",long:s=!1}=n;let a;switch(i){case"lab":a=ug;break;case"hsl":a=s?og:ag;break;case"hcl":a=s?cg:lg;break;case"cubehelix":a=s?fg:hg;break;case"rgb":a=Vn;default:a=Vn}return n.gamma&&(i==="rgb"||i==="cubehelix")&&(a=a.gamma(n.gamma)),r.length>2?dg(a,r):a(r[0],r[1])},gg=(e,r,...n)=>{if(M(e,"aboveZero","steps"),!Array.isArray(n))throw new Error("Expected one or more colours as parameters");const i=kc(r,n);if(i===void 0)throw new Error("Could not handle colour/space");const s=1/(e-1),a=[];let o=0;for(let u=0;u<e;u++)a.push(i(o)),o+=s,o>1&&(o=1);return a},wg=e=>!(e.h===void 0||e.s===void 0||e.l===void 0),Dg=e=>!(e.r===void 0||e.g===void 0||e.b===void 0),xg=(e,r,n)=>{e/=255,r/=255,n/=255;var i=Math.min(e,r,n),s=Math.max(e,r,n),a=s-i,o,u,l;return o=0,s===i?o=0:e===s?o=(r-n)/a:r===s?o=2+(n-e)/a:n===s&&(o=4+(e-r)/a),o=Math.min(o*60,360),o<0&&(o+=360),l=(i+s)/2,s===i?u=0:l<=.5?u=a/(s+i):u=a/(2-s-i),{h:o,s:u,l}},$c=Math.PI*2,Tc=e=>{if(e===null)throw Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");const r=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?Ee(e).getContext("2d"):e;if(r===null)throw new Error("Could not create 2d context for canvas");return r},Eg=(e,r)=>{const n=Tc(e);return{paths(i,s){Lc(n,i,s)},line(i,s){Fa(n,i,s)},rect(i,s){Oc(n,i,s)},bezier(i,s){jc(n,i,s)},connectedPoints(i,s){fi(n,i,s)},pointLabels(i,s){di(n,i,s)},dot(i,s){Ue(n,i,s)},circle(i,s){Rc(n,i,s)},arc(i,s){Ic(n,i,s)},textBlock(i,s){s.bounds===void 0&&r!==void 0&&(s={...s,bounds:{...r,x:0,y:0}}),Vc(n,i,s)}}},Ca=e=>bg(e.strokeStyle,e.fillStyle),Me=(e,r={},...n)=>{if(e===void 0)throw Error("ctx undefined");const i=hr(e).push(Ca(r),...n);return i.apply(),i},Ic=(e,r,n={})=>{Me(e,n);const i=s=>{e.beginPath(),e.arc(s.x,s.y,s.radius,s.startRadian,s.endRadian),e.stroke()};Array.isArray(r)?r.forEach(i):i(r)},bg=(e,r)=>i=>{r&&(i.fillStyle=r),e&&(i.strokeStyle=e)},Ag=(e,r,n)=>s=>{e&&(s.lineWidth=e),r&&(s.lineJoin=r),n&&(s.lineCap=n)},hr=(e,r)=>(r===void 0&&(r=kn()),{push:(...a)=>{r===void 0&&(r=kn());const o=r.push(...a);return a.forEach(u=>u(e)),hr(e,o)},pop:()=>{const a=r?.pop();return hr(e,a)},apply:()=>r===void 0?hr(e):(r.forEach(a=>a(e)),hr(e,r))}),Cg=(e,r,n)=>{Me(e,n),e.moveTo(r[0].x,r[0].y),r.forEach((i,s)=>{if(s+2>=r.length)return;const a=r[s+1],o={x:(i.x+a.x)/2,y:(i.y+a.y)/2},u=(o.x+i.x)/2,l=(o.x+a.x)/2;e.quadraticCurveTo(u,a.y,o.x,o.y),e.quadraticCurveTo(l,a.y,a.x,a.y)})},Rc=(e,r,n={})=>{Me(e,n);const i=s=>{e.beginPath(),e.arc(s.x,s.y,s.radius,0,$c),n.strokeStyle&&e.stroke(),n.fillStyle&&e.fill()};Array.isArray(r)?r.forEach(i):i(r)},Fg=(e,r,n={})=>{Me(e,n);const i=s=>{e.beginPath();const a=s.rotation??0,o=s.startAngle??0,u=s.endAngle??$c;e.ellipse(s.x,s.y,s.radiusX,s.radiusY,a,o,u),n.strokeStyle&&e.stroke(),n.fillStyle&&e.fill()};Array.isArray(r)?r.forEach(i):i(r)},Lc=(e,r,n={})=>{Me(e,n);const i=s=>{if(Qn(s))qc(e,s,n);else if(Nt(s))Fa(e,s,n);else throw new Error(`Unknown path type ${JSON.stringify(s)}`)};Array.isArray(r)?r.forEach(i):i(r)},fi=(e,r,n={})=>{const i=n.loop??!1;kf(r),r.length!==0&&(r.forEach((s,a)=>X(s,`Index ${a}`)),Me(e,n),e.beginPath(),e.moveTo(r[0].x,r[0].y),r.forEach(s=>e.lineTo(s.x,s.y)),i&&e.lineTo(r[0].x,r[0].y),(n.strokeStyle||n.strokeStyle===void 0&&n.fillStyle===void 0)&&e.stroke(),n.fillStyle&&e.fill())},di=(e,r,n={},i)=>{r.length!==0&&(r.forEach((s,a)=>X(s,`Index ${a}`)),Me(e,n),r.forEach((s,a)=>{const o=i!==void 0&&a<i.length?i[a]:a.toString();e.fillText(o.toString(),s.x,s.y)}))},Sg=(e,r)=>{const n=e.getTransform();return{x:r.x*n.a+r.y*n.c+n.e,y:r.x*n.b+r.y*n.d+n.f}},Bg=e=>{const r=document.createElement("img");return r.src=e.toDataURL("image/jpeg"),r},Ue=(e,r,n)=>{n===void 0&&(n={});const i=n.radius??10;if(Me(e,n),e.beginPath(),Array.isArray(r))r.forEach(s=>{e.arc(s.x,s.y,i,0,2*Math.PI)});else{const s=r;e.arc(s.x,s.y,i,0,2*Math.PI)}(n.filled||!n.outlined)&&e.fill(),n.outlined&&e.stroke()},jc=(e,r,n)=>{Qn(r)?qc(e,r,n):Ys(r)&&_g(e,r,n)},_g=(e,r,n={})=>{let i=Me(e,n);const{a:s,b:a,cubic1:o,cubic2:u}=r,l=n.debug??!1;e.beginPath(),e.moveTo(s.x,s.y),e.bezierCurveTo(o.x,o.y,u.x,u.y,a.x,a.y),e.stroke(),l&&(i=i.push(Ca({...n,strokeStyle:Kr(n.strokeStyle??"silver",.6),fillStyle:Kr(n.fillStyle??"yellow",.4)})),i.apply(),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.moveTo(a.x,a.y),e.lineTo(u.x,u.y),e.stroke(),e.fillText("a",s.x+5,s.y),e.fillText("b",a.x+5,a.y),e.fillText("c1",o.x+5,o.y),e.fillText("c2",u.x+5,u.y),Ue(e,o,{radius:3}),Ue(e,u,{radius:3}),Ue(e,s,{radius:3}),Ue(e,a,{radius:3}),i=i.pop(),i.apply())},qc=(e,r,n={})=>{const{a:i,b:s,quadratic:a}=r,o=n.debug??!1;let u=Me(e,n);e.beginPath(),e.moveTo(i.x,i.y),e.quadraticCurveTo(a.x,a.y,s.x,s.y),e.stroke(),o&&(u=u.push(Ca({...n,strokeStyle:Kr(n.strokeStyle??"silver",.6),fillStyle:Kr(n.fillStyle??"yellow",.4)})),fi(e,[i,a,s]),e.fillText("a",i.x+5,i.y),e.fillText("b",s.x+5,s.y),e.fillText("h",a.x+5,a.y),Ue(e,a,{radius:3}),Ue(e,i,{radius:3}),Ue(e,s,{radius:3}),u=u.pop(),u.apply())},Fa=(e,r,n={})=>{const i=n.debug??!1,s=Ag(n.lineWidth,n.lineJoin,n.lineCap);Me(e,n,s);const a=o=>{const{a:u,b:l}=o;e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(l.x,l.y),i&&(e.fillText("a",u.x,u.y),e.fillText("b",l.x,l.y),Ue(e,u,{radius:5,strokeStyle:"black"}),Ue(e,l,{radius:5,strokeStyle:"black"})),e.stroke()};Array.isArray(r)?r.forEach(a):a(r)},Pg=(e,r,n={})=>{Me(e,n);const i=s=>{fi(e,as(s),{...n,loop:!0}),n.debug&&di(e,as(s),void 0,["a","b","c"])};Array.isArray(r)?r.forEach(i):i(r)},Oc=(e,r,n={})=>{Me(e,n);const i=s=>{n.filled&&e.fillRect(s.x,s.y,s.width,s.height),e.strokeRect(s.x,s.y,s.width,s.height),n.debug&&di(e,aa(s),void 0,["NW","NE","SE","SW"])};Array.isArray(r)?r.forEach(i):i(r)},fr=(e,r,n=0,i)=>{if(r==null||r.length===0)return 0;const s=e.measureText(r);return i?_o(s.width,i)+n:s.width+n},Vc=(e,r,n)=>{Me(e,n);const i=n.anchorPadding??0,s=n.anchor,a=n.bounds??{x:0,y:0,width:1e6,height:1e6},o=r.map(D=>e.measureText(D)),u=o.map(D=>D.width),l=o.map(D=>D.actualBoundingBoxAscent+D.actualBoundingBoxDescent),c=Math.max(...u),h=l.reduce((D,F)=>D+F,0);let{x:f,y:d}=s;s.x+c>a.width?f=a.width-(c+i):f-=i,f<a.x&&(f=a.x+i),s.y+h>a.height?d=a.height-(h+i):d-=i,d<a.y&&(d=a.y+i),r.forEach((D,F)=>{e.fillText(D,f,d),d+=l[F]})},Mg=(e,r,n)=>{const{bounds:i}=n,{horiz:s="left",vert:a="top"}=n;let o;typeof r=="string"?o=[r]:o=r,Me(e,n),e.save(),e.translate(i.x,i.y),e.textAlign="left",e.textBaseline="top";const u=i.width/2,l=i.height/2,c=o.map(D=>e.measureText(D)),h=c.map(D=>D.actualBoundingBoxAscent+D.actualBoundingBoxDescent),f=h.reduce((D,F)=>D+F,0);let d=0;a==="center"?d=l-f/2:a==="bottom"&&(d=i.height-f),o.forEach((D,F)=>{let B=0;s==="center"?B=u-c[F].width/2:s==="right"&&(B=i.width-c[F].width),e.fillText(o[F],B,d),d+=h[F]}),e.restore()},Sa={};T(Sa,{Elements:()=>Wn,applyOpts:()=>gt,applyPathOpts:()=>_a,applyStrokeOpts:()=>Tt,clear:()=>zg,createEl:()=>vi,createOrResolve:()=>Pt,getBounds:()=>kg,makeHelper:()=>Tg,remove:()=>Qc,setBounds:()=>$g});var Ng=(e,r,n)=>{const i=vi("marker",e);if(r.markerWidth&&i.setAttribute("markerWidth",r.markerWidth?.toString()),r.markerHeight&&i.setAttribute("markerHeight",r.markerHeight?.toString()),r.orient?i.setAttribute("orient",r.orient.toString()):i.setAttribute("orient","auto-start-reverse"),r.viewBox&&i.setAttribute("viewBox",r.viewBox.toString()),r.refX&&i.setAttribute("refX",r.refX.toString()),r.refY&&i.setAttribute("refY",r.refY.toString()),n){const s=n();i.appendChild(s)}return i},Ti=(e,r,n)=>{if(e===null)return"(elem null)";const i=e.ownerSVGElement;if(i===null)throw new Error("parent for elem is null");const s=Pt(i,"defs","defs");let a=s.querySelector(`#${r.id}`);if(a!==null)return`url(#${r.id})`;if(r.id==="triangle")r={...r,strokeStyle:"transparent"},r.markerHeight||(r={...r,markerHeight:6}),r.markerWidth||(r={...r,markerWidth:6}),r.refX||(r={...r,refX:r.markerWidth}),r.refY||(r={...r,refY:r.markerHeight}),(!r.fillStyle||r.fillStyle==="none")&&(r={...r,fillStyle:"black"}),r.viewBox||(r={...r,viewBox:"0 0 10 10"}),a=Ng(r.id,r,()=>{const o=vi("path");return o.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),r&&gt(o,r),o});else throw new Error(`Do not know how to make ${r.id}`);return a.id=r.id,s.appendChild(a),`url(#${r.id})`},Wn={};T(Wn,{circle:()=>Gc,circleUpdate:()=>Uc,grid:()=>Zc,line:()=>Hn,lineUpdate:()=>Jc,path:()=>Wc,pathUpdate:()=>Hc,text:()=>Xc,textPath:()=>Kc,textPathUpdate:()=>Yc,textUpdate:()=>Ba});var Eo=e=>e>=0&&e<=1?e*100+"%":e.toString(),Wc=(e,r,n,i)=>{const s=Pt(r,"path",i),a=typeof e=="string"?e:e.join(`
`);return s.setAttributeNS(null,"d",a),r.appendChild(s),Hc(s,n)},Hc=(e,r)=>(r&&gt(e,r),r&&Tt(e,r),e),Uc=(e,r,n)=>(e.setAttributeNS(null,"cx",r.x.toString()),e.setAttributeNS(null,"cy",r.y.toString()),e.setAttributeNS(null,"r",r.radius.toString()),n&&gt(e,n),n&&Tt(e,n),e),Gc=(e,r,n,i)=>{const s=Pt(r,"circle",i);return Uc(s,e,n)},Hn=(e,r,n,i)=>{const s=Pt(r,"line",i);return Jc(s,e,n)},Jc=(e,r,n)=>(e.setAttributeNS(null,"x1",r.a.x.toString()),e.setAttributeNS(null,"y1",r.a.y.toString()),e.setAttributeNS(null,"x2",r.b.x.toString()),e.setAttributeNS(null,"y2",r.b.y.toString()),n&&gt(e,n),n&&_a(e,n),n&&Tt(e,n),e),Yc=(e,r,n)=>(n?.method&&e.setAttributeNS(null,"method",n.method),n?.side&&e.setAttributeNS(null,"side",n.side),n?.spacing&&e.setAttributeNS(null,"spacing",n.spacing),n?.startOffset&&e.setAttributeNS(null,"startOffset",Eo(n.startOffset)),n?.textLength&&e.setAttributeNS(null,"textLength",Eo(n.textLength)),r&&(e.textContent=r),n&&gt(e,n),n&&Tt(e,n),e),Kc=(e,r,n,i,s)=>{const a=Pt(n,"text",s+"-text");Ba(a,void 0,void 0,i);const o=Pt(a,"textPath",s);return o.setAttributeNS(null,"href",e),Yc(o,r,i)},Ba=(e,r,n,i)=>(r&&(e.setAttributeNS(null,"x",r.x.toString()),e.setAttributeNS(null,"y",r.y.toString())),n&&(e.textContent=n),i&&(gt(e,i),i&&Tt(e,i),i.anchor&&e.setAttributeNS(null,"text-anchor",i.anchor),i.align&&e.setAttributeNS(null,"alignment-baseline",i.align)),e),Xc=(e,r,n,i,s)=>{const a=Pt(r,"text",s);return Ba(a,n,e,i)},Zc=(e,r,n,i,s,a={})=>{a.strokeStyle||(a={...a,strokeStyle:zc("bg-dim","silver")}),a.strokeWidth||(a={...a,strokeWidth:1});const o=vi("g");gt(o,a),_a(o,a),Tt(o,a);let u=0;for(;u<s;){const c=$n(0,u,i,u);Hn(c,o),u+=n}let l=0;for(;l<i;){const c=$n(l,0,l,s);Hn(c,o),l+=n}return e.appendChild(o),o},Pt=(e,r,n)=>{let i=null;if(n!==void 0&&(typeof n=="string"?i=e.querySelector(n):i=n),i===null){const s=document.createElementNS("http://www.w3.org/2000/svg",r);return e.appendChild(s),n&&typeof n=="string"&&n.startsWith("#")&&(s.id=n.substring(1)),s}return i},Qc=(e,r)=>{if(typeof r=="string"){const n=e.querySelector(r);if(n===null)return;n.remove()}else r.remove()},zg=e=>{let r=e.lastElementChild;for(;r;)e.removeChild(r),r=e.lastElementChild},vi=(e,r)=>{const n=document.createElementNS("http://www.w3.org/2000/svg",e);return r&&(n.id=r),n},_a=(e,r)=>{r.markerEnd&&e.setAttribute("marker-end",Ti(e,r.markerEnd)),r.markerStart&&e.setAttribute("marker-end",Ti(e,r.markerStart)),r.markerMid&&e.setAttribute("marker-end",Ti(e,r.markerMid))},gt=(e,r)=>{r.fillStyle&&e.setAttributeNS(null,"fill",r.fillStyle)},Tt=(e,r)=>{r.strokeStyle&&e.setAttributeNS(null,"stroke",r.strokeStyle),r.strokeWidth&&e.setAttributeNS(null,"stroke-width",r.strokeWidth.toString()),r.strokeDash&&e.setAttribute("stroke-dasharray",r.strokeDash),r.strokeLineCap&&e.setAttribute("stroke-linecap",r.strokeLineCap)},kg=e=>{const r=e.getAttributeNS(null,"width"),n=r===null?0:parseFloat(r),i=e.getAttributeNS(null,"height"),s=i===null?0:parseFloat(i);return{width:n,height:s}},$g=(e,r)=>{e.setAttributeNS(null,"width",r.width.toString()),e.setAttributeNS(null,"height",r.height.toString())},Tg=(e,r)=>(r&&(gt(e,r),Tt(e,r)),{remove:i=>Qc(e,i),text:(i,s,a,o)=>Xc(i,e,s,a,o),textPath:(i,s,a,o)=>Kc(i,s,e,a,o),line:(i,s,a)=>Hn(i,e,s,a),circle:(i,s,a)=>Gc(i,e,s,a),path:(i,s,a)=>Wc(i,e,s,a),grid:(i,s,a,o,u)=>Zc(e,i,s,a,o,u),query:i=>e.querySelector(i),get width(){const i=e.getAttributeNS(null,"width");return i===null?0:parseFloat(i)},set width(i){e.setAttributeNS(null,"width",i.toString())},get parent(){return e},get height(){const i=e.getAttributeNS(null,"height");return i===null?0:parseFloat(i)},set height(i){e.setAttributeNS(null,"height",i.toString())},clear:()=>{for(;e.firstChild;)e.removeChild(e.lastChild)}}),Pa={};T(Pa,{add:()=>eh,calcScale:()=>Ma,defaultAxis:()=>fs,draw:()=>gr,drawValue:()=>th,plot:()=>Hg});var Ig=Math.PI*2,fs=e=>({endWith:"none",lineWidth:1,namePosition:"none",name:e,showLabels:e==="y",showLine:!0,textSize:e==="y"?20:10}),Ma=(e,r,n)=>{const i=e.keys(),s=[];return i.forEach(a=>{const o=e.get(a);if(o===void 0)return;let{min:u,max:l}=Yn(o),c=l-u,h;n!==void 0&&(h=n[a]),h==null&&(r.defaultSeriesVariable?h=tn.getCssVariable("accent",r.defaultSeriesColour):h=r.defaultSeriesColour),c===0&&(c=u,u=u-c/2,l=l+c/2),s.push({min:u,max:l,range:c,name:a,colour:h})}),s},eh=(e,r,n="")=>{e.addKeyedValues(n,r)},th=(e,r,n)=>{const i={...n,translucentPlot:!0,leadingEdgeDot:!1};gr(r,i),n={...n,highlightIndex:e,leadingEdgeDot:!0,translucentPlot:!1,style:"none",clearCanvas:!1},gr(r,n)},Rg=(e,r,n)=>Ma(e,n,n.seriesColours).map(i=>({...i,range:r[1]-r[0],min:r[0],max:r[1]})),gr=(e,r)=>{const{x:n,y:i,ctx:s,canvasSize:a}=r,o=r.margin,u=r.y.scaleRange?Rg(e,r.y.scaleRange,r):Ma(e,r,r.seriesColours);r.clearCanvas&&s.clearRect(0,0,a.width,a.height),r.debug&&(s.strokeStyle="orange",s.strokeRect(0,0,a.width,a.height)),s.translate(o,o);const l=r.plotSize??nh(a,r),c={height:l.height+o+o,width:l.width};if((i.showLabels||i.showLine)&&(u.forEach(f=>{i.allowedSeries!==void 0&&!i.allowedSeries.includes(f.name)||Lg(f,c,r)}),u.length>0&&i.showLine&&jg(c,u[0],r)),(n.showLabels||n.showLine)&&u.length>0){const f=i.labelRange?i.labelRange[0]:u[0].min;Og(l.width,Kt(f,u[0],l.height)+o+n.lineWidth,r)}const h={...r,plotSize:l};li.translatePoint(s,r.pointer),u.forEach(f=>{const d=e.getSource(f.name);if(d===void 0)return;let D=e.typeName==="circular"?d.pointer-1:d.length-1;r.highlightIndex!==void 0&&(D=r.highlightIndex),s.save(),s.translate(0,o+o),Vg(f,d,l,h,D),s.restore()}),r.showLegend&&(s.save(),s.translate(0,l.height+o+o+o),l.width,r.x.textSize+o+o,qg(u,r),s.restore()),s.resetTransform()},Lg=(e,r,n)=>{const{ctx:i,y:s,digitsPrecision:a,margin:o}=n,{height:u}=r;n.debug&&(i.strokeStyle="purple",i.strokeRect(0,0,s.textSize,u+o)),i.fillStyle=e.colour.length>0?e.colour:"white",s.colour&&(i.fillStyle=s.colour);const l=s.labelRange?s.labelRange[0]:e.min,c=s.labelRange?s.labelRange[1]:e.max,h=s.labelRange?c-l:e.range,f=l+h/2,d=n.textHeight/2;i.textBaseline="top",i.fillText(l.toFixed(a),0,Kt(l,e,u)-d),i.fillText(f.toFixed(a),0,Kt(f,e,u)-d),i.fillText(c.toFixed(a),0,Kt(c,e,u)-o),i.translate(s.textSize+o,0)},jg=(e,r,n)=>{if(r===void 0)throw new Error("series undefined");const{ctx:i,y:s}=n,{height:a}=e,o=s.labelRange?s.labelRange[0]:r.min,u=s.labelRange?s.labelRange[1]:r.max,l=Kt(o,r,a),c=Kt(u,r,a);i.translate(s.lineWidth,0),i.lineWidth=s.lineWidth,i.beginPath(),i.moveTo(0,l),i.lineTo(0,c),i.strokeStyle=r.colour,s.colour&&(i.strokeStyle=s.colour),i.stroke(),i.translate(s.lineWidth,0)},qg=(e,r,n)=>{const{ctx:i}=r,s=10;let a=0;const o=r.margin*3,u=r.margin;i.lineWidth=r.lineWidth,e.forEach(l=>{i.moveTo(a,o),i.strokeStyle=l.colour,i.lineTo(a+s,o),i.stroke(),a+=s+r.margin;let c=l.name;l.lastValue&&(c+=" "+l.lastValue.toFixed(r.digitsPrecision));const h=i.measureText(c);i.fillStyle=l.colour,i.fillText(c,a,u),a+=h.width})},Og=(e,r,n)=>{const{ctx:i,x:s,y:a}=n;!s.showLine||(s.colour&&(i.strokeStyle=s.colour),i.lineWidth=s.lineWidth,i.beginPath(),i.moveTo(0,r),i.lineTo(e,r),i.stroke())},Vg=(e,r,n,i,s)=>{const{ctx:a,lineWidth:o,translucentPlot:u=!1,margin:l,x:c}=i,h=i.style??"connected",f=n.height-l;let d=1;if(c.scaleRange){const N=c.scaleRange[1]-c.scaleRange[0];d=n.width/N}else i.capacity===0?d=n.width/r.length:d=n.width/i.capacity;const D=i.coalesce&&d<0?Math.floor(1/d):1;let F=0,B;i.debug&&(a.strokeStyle="green",a.strokeRect(0,0,n.width,n.height));const _=N=>u?tn.opacity(N,.2):N;h==="dots"?a.fillStyle=_(e.colour):h==="none"||(a.beginPath(),a.lineWidth=o,a.strokeStyle=_(e.colour));for(let N=0;N<r.length;N+=D){let O=Kt(r[N],e,f)-1;h==="dots"?(a.beginPath(),a.arc(F,O,o,0,Ig),a.fill()):h==="none"||(N==0&&a.moveTo(F,O),a.lineTo(F,O)),N===s&&(B={x:F,y:O},e.lastValue=r[N]),F+=d}h==="connected"&&a.stroke(),B!==void 0&&i.leadingEdgeDot&&(a.beginPath(),a.fillStyle=_(e.colour),a.arc(B.x,B.y,3,0,2*Math.PI),a.fill())},Kt=(e,r,n)=>(1-(e-r.min)/r.range)*n,rh=(e,r,n,i)=>{let s=e;n.showLabels&&(s+=n.textSize),n.showLine&&(s+=n.lineWidth),(n.showLabels||n.showLine)&&(s+=e+e);let a=e,o=e+e,u=e+e;return r.showLabels?u+=r.textSize:u+=e,r.showLine&&(u+=r.lineWidth),(r.showLabels||r.showLine)&&(u+=e),i&&(u+=r.textSize),{left:s,right:a,top:o,bottom:u}},nh=(e,r)=>{const{width:n,height:i}=e,s=rh(r.margin,r.x,r.y,r.showLegend);return{width:n-s.left-s.right,height:i-s.top-s.bottom}},Wg=(e,r)=>{const{width:n,height:i}=e,s=rh(r.margin,r.x,r.y,r.showLegend);return{width:n+s.left+s.right,height:i+s.top+s.bottom}},Hg=(e,r)=>{if(e===null)throw new Error("parentElOrQuery is null. Expected string or element");const n=Ee(e);let i,s=!0,a=r.plotSize,o;n.nodeName==="CANVAS"?(i=n,s=!1,o={width:i.width,height:i.height}):(i=document.createElement("CANVAS"),n.append(i),a=r.plotSize,o={width:i.width,height:i.height});const u={x:0,y:0},l=N=>{u.x=N.offsetX,u.y=N.offsetY};i.addEventListener("pointermove",l);const c=i.getContext("2d"),h=r.capacity??10,f=h>0?wu({capacity:h}):gu(),d=c.measureText("Xy"),D=r.coalesce??!0;if(c===null)throw new Error("Drawing context not available");let F=fs("x");r.x&&(F={...F,...r.x});let B=fs("y");r.y&&(B={...B,...r.y});let _={...r,y:B,x:F,pointer:u,capacity:h,coalesce:D,plotSize:a,canvasSize:o,ctx:c,textHeight:r.textHeight??d.actualBoundingBoxAscent+d.actualBoundingBoxDescent,style:r.style??"connected",defaultSeriesColour:r.defaultSeriesColour??"yellow",margin:3,clearCanvas:!0,leadingEdgeDot:!0,debug:r.debug??!1,digitsPrecision:r.digitsPrecision??2,lineWidth:r.lineWidth??2,showLegend:r.showLegend??!1};if(a){const N=Wg(a,_);i.width=N.width,i.height=N.height,_.canvasSize=N}return r.autoSizeCanvas&&As(i,N=>{const O=N.bounds;_={..._,plotSize:nh(O,_),canvasSize:O},gr(f,_)}),{drawValue:N=>{th(N,f,_)},dispose:()=>{i.removeEventListener("pointermove",l),s&&i.remove()},add:(N,O="",ee=!1)=>{eh(f,N,O),!ee&&gr(f,_)},draw:()=>{gr(f,_)},clear:()=>{f.clear()}}},Na={};T(Na,{AxisX:()=>hh,AxisY:()=>dh,Legend:()=>ch,Plot:()=>Yg,PlotArea:()=>lh,Series:()=>uh});var za={};T(za,{Box:()=>sh,CanvasBox:()=>Br,CanvasMeasureState:()=>ah,MeasureState:()=>ih});var yn=(e,r)=>e.type==="px"&&r.type==="px"?e.value===r.value:!1,Ug=(e,r)=>e===void 0&&r===void 0?!0:!(e===void 0||r===void 0||e.x&&r.x&&!yn(e.x,r.x)||e.y&&r.y&&!yn(e.y,r.y)||e.width&&r.width&&!yn(e.width,r.width)||e.height&&r.height&&!yn(e.height,r.height)),ih=class{constructor(e){y(this,"bounds"),y(this,"pass"),y(this,"measurements"),this.bounds=e,this.pass=0,this.measurements=new Map}getSize(e){const r=this.measurements.get(e);if(r!==void 0&&!Gr(r.size))return r.size}resolveToPx(e,r){if(e===void 0)return r;if(e.type==="px")return e.value;throw new Error(`Unknown unit type ${e.type}`)}},sh=class{constructor(e,r){y(this,"visual",rs),y(this,"_desiredSize"),y(this,"_lastMeasure"),y(this,"children",[]),y(this,"_parent"),y(this,"_idMap",new Map),y(this,"debugLayout",!1),y(this,"_visible",!0),y(this,"_ready",!0),y(this,"takesSpaceWhenInvisible",!1),y(this,"needsDrawing",!0),y(this,"_needsLayout",!0),y(this,"debugHue",ba()),y(this,"id"),this.id=r,this._parent=e,e?.onChildAdded(this)}hasChild(e){const r=this.children.find(i=>i===e),n=this.children.find(i=>i.id===e.id);return r!==void 0||n!==void 0}notify(e,r){this.onNotify(e,r),this.children.forEach(n=>n.notify(e,r))}onNotify(e,r){}onChildAdded(e){if(e.hasChild(this))throw new Error("Recursive");if(e===this)throw new Error("Cannot add self as child");if(this.hasChild(e))throw new Error("Child already present");this.children.push(e),this._idMap.set(e.id,e)}setReady(e,r=!1){this._ready=e,r&&this.children.forEach(n=>n.setReady(e,r))}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.onLayoutNeeded())}get desiredSize(){return this._desiredSize}set desiredSize(e){Ug(e,this._desiredSize)||(this._desiredSize=e,this.onLayoutNeeded())}onLayoutNeeded(){this.notifyChildLayoutNeeded()}notifyChildLayoutNeeded(){this._needsLayout=!0,this.needsDrawing=!0,this._parent!==void 0?this._parent.notifyChildLayoutNeeded():this.update()}get root(){return this._parent===void 0?this:this._parent.root}measurePreflight(){}measureApply(e,r){let n=!0;return this._needsLayout=!1,ql(e.size,this.visual)&&(n=!1),Ie(e.size)?this.visual=e.size:this.visual={x:0,y:0,width:e.size.width,height:e.size.height},e.children.forEach(i=>{i!==void 0&&i.ref.measureApply(i,r)}),(n||r)&&(this.needsDrawing=!0,this.root.notify("measureApplied",this)),n}debugLog(e){console.log(this.id,e)}measureStart(e,r,n){this.measurePreflight();let i={ref:this,size:jl,children:[]};if(e.measurements.set(this.id,i),!this._visible&&!this.takesSpaceWhenInvisible)i.size=Ll;else{let s=this._lastMeasure;if((this._needsLayout||this._lastMeasure===void 0)&&(s=this.measureSelf(e,n),this.root.notify("measured",this)),s===void 0)return;i.size=s,this._lastMeasure=s}if(i.children=this.children.map(s=>s.measureStart(e,r,i)),!(Je.without(i.children,void 0).length<this.children.length))return i}measureSelf(e,r){let n=rs;if(r?r.size&&(n={x:0,y:0,width:r.size.width,height:r.size.height}):n={x:0,y:0,width:e.bounds.width,height:e.bounds.height},!Gr(n))return n}updateDone(e,r){this.onUpdateDone(e,r),this.children.forEach(n=>n.updateDone(e,r))}update(e=!1){const r=this.updateBegin(e);let n=5,i=!1;for(;n--;){const s=this.measureStart(r,e);if(s!==void 0){if(this.measureApply(s,e),!this._ready)return;i=!0}}this.updateDone(r,e),i||console.warn("Ran out of measurement attempts")}},ah=class extends ih{constructor(e,r){super(e);y(this,"ctx"),this.ctx=r}},Br=class extends sh{constructor(e,r,n){super(e,n);if(y(this,"canvasEl"),r===void 0)throw new Error("canvasEl undefined");if(r===null)throw new Error("canvasEl null");this.canvasEl=r,e===void 0&&this.designateRoot()}designateRoot(){this.canvasEl.addEventListener("pointermove",e=>{const r={x:e.offsetX,y:e.offsetY};this.notifyPointerMove(r)}),this.canvasEl.addEventListener("pointerleave",e=>{this.notifyPointerLeave()}),this.canvasEl.addEventListener("click",e=>{const r={x:e.offsetX,y:e.offsetY};this.notifyClick(r)})}onClick(e){}notifyClick(e){if(!Gr(this.visual)&&Rn(this.visual,e)){const r=w.subtract(e,this.visual.x,this.visual.y);this.onClick(r),this.children.forEach(n=>n.notifyClick(r))}}notifyPointerLeave(){this.onPointerLeave(),this.children.forEach(e=>e.notifyPointerLeave())}notifyPointerMove(e){if(!Gr(this.visual)&&Rn(this.visual,e)){const r=w.subtract(e,this.visual.x,this.visual.y);this.onPointerMove(r),this.children.forEach(n=>n.notifyPointerMove(r))}}onPointerLeave(){}onPointerMove(e){}updateBegin(){const e=this.canvasEl.getContext("2d");if(e===null)throw new Error("Context unavailable");const r=this.canvasEl.getBoundingClientRect();return new ah({width:r.width,height:r.height},e)}onUpdateDone(e,r){if(!this.needsDrawing&&!r)return;const n=this.canvasEl.getContext("2d");if(n===null)throw new Error("Context unavailable");n.save(),n.translate(this.visual.x,this.visual.y);const i=this.visual;this.debugLayout&&(n.lineWidth=1,n.strokeStyle=`hsl(${this.debugHue}, 100%, 50%)`,n.strokeRect(0,0,i.width,i.height),n.fillStyle=n.strokeStyle,n.fillText(this.id,10,10,i.width),n.beginPath(),n.moveTo(0,0),n.lineTo(i.width,i.height),n.stroke()),this.drawSelf(n),this.needsDrawing=!1,n.restore()}drawSelf(e){}},oh=class{constructor(e){y(this,"data"),y(this,"series"),y(this,"dirty",!1),y(this,"type","array"),y(this,"_range"),this.series=e,this.data=[],this.dirty=!0}clear(){this.set([]),this._range=void 0}set(e){this.data=e,this.dirty=!0}get length(){return this.data.length}get range(){return!this.dirty&&this._range!==void 0?this._range:(this.dirty=!1,this._range=Je.minMaxAvg(this.data),{...this._range,changed:!0})}add(e){this.data=[...this.data,e],this.dirty=!0}},Gg=class extends oh{constructor(e){super(e);y(this,"desiredDataPointMinWidth",5)}add(e){const r=this.series.lastPxPerPt;if(r>-1&&r<this.desiredDataPointMinWidth){const n=Math.floor(this.desiredDataPointMinWidth/r),i=[...this.data.slice(n),e];super.set(i)}else super.add(e)}},uh=class{constructor(e,r,n,i){if(this.plot=n,y(this,"name"),y(this,"colour"),y(this,"source"),y(this,"drawingStyle"),y(this,"width",3),y(this,"dataHitPoint"),y(this,"tooltip"),y(this,"precision",2),y(this,"axisRange"),y(this,"lastPxPerPt",-1),y(this,"_visualRange"),y(this,"_visualRangeStretch"),this.name=e,this.drawingStyle=i.drawingStyle??"line",this.colour=i.colour,this.width=i.width??3,this.axisRange=i.axisRange??{min:Number.NaN,max:Number.NaN},this._visualRange={...this.axisRange},this._visualRangeStretch=i.visualRangeStretch??!0,r==="array")this.source=new oh(this);else if(r==="stream")this.source=new Gg(this);else throw new Error("Unknown sourceType. Expected array|stream")}formatValue(e){return e.toFixed(this.precision)}get visualRange(){let e=this._visualRange;const r=this.source.range;let n=!1;if(r.changed)if(this._visualRangeStretch){const i=Math.min(Ri(e.min,r.min),r.min),s=Math.max(Ri(e.max,r.max),r.max);(i!==e.min||s!==e.max)&&(e={min:i,max:s},n=!0)}else fh(r,e)||(e=r,n=!0);return this._visualRange=e,{...e,changed:n}}scaleValue(e){if(this.source===void 0)return e;const r=this.visualRange;return r.min==r.max?.5:vt(e,r.min,r.max)}add(e){M(e,"","value"),this.source.add(e),this.plot.plotArea.needsDrawing=!0}clear(){this.source.clear(),this._visualRange={...this.axisRange},this.plot.plotArea.needsDrawing=!0}},lh=class extends Br{constructor(e){super(e,e.canvasEl,"PlotArea");this.plot=e,y(this,"paddingPx",3),y(this,"piPi",Math.PI*2),y(this,"pointerDistanceThreshold",20),y(this,"lastRangeChange",0),y(this,"pointer")}clear(){this.lastRangeChange=0,this.pointer=void 0}measureSelf(e,r){const n=e.getSize("AxisY");if(n===void 0)return;const i=e.getSize("Legend");if(i===void 0)return;const s=e.getSize("AxisX");if(s!==void 0)return{x:n.width,y:0,width:e.bounds.width-n.width,height:e.bounds.height-i.height-s.height}}onNotify(e,r){e==="measureApplied"&&r===this.plot.axisY&&(this._needsLayout=!0),e==="measureApplied"&&r===this.plot.legend&&(this._needsLayout=!0)}onPointerLeave(){[...this.plot.series.values()].forEach(r=>{r.tooltip=void 0}),this.pointer=void 0,this.plot.legend.onLayoutNeeded()}onPointerMove(e){this.pointer=e,this.plot.legend.onLayoutNeeded()}measurePreflight(){this.updateTooltip()}updateTooltip(){const e=this.pointer;if(e===void 0)return;[...this.plot.series.values()].forEach(n=>{if(e===void 0){n.tooltip=void 0;return}if(n.dataHitPoint===void 0)return;const i=n.dataHitPoint(e);i[0]!==void 0&&(i[1]>this.pointerDistanceThreshold||(n.tooltip=n.formatValue(i[0].value)))}),this.plot.legend.needsDrawing=!0}drawSelf(e){if(this.plot.frozen)return;const r=this.plot.seriesArray();e.clearRect(0,0,this.visual.width,this.visual.height),r.forEach(n=>{if(n.source.type==="array"||n.source.type==="stream"){const i=n.source;if(i.data===void 0)return;const s=[...i.data];this.drawDataSet(n,s,e)}else console.warn(`Unknown data source type ${n.source.type}`)})}computeY(e,r){const n=e.scaleValue(r);return Sn(n)*this.visual.height+this.paddingPx}drawDataSet(e,r,n){const i=this.paddingPx+e.width,s=re.subtract(this.visual,i*2,i*3.5),a=s.width/r.length;e.lastPxPerPt=a;let o=i;n.strokeStyle=e.colour,n.lineWidth=e.width;const u=[];if(e.dataHitPoint=l=>{const c=u.map(d=>w.distanceToExterior(l,d)),h=fu(...c);return[u[h],c[h]]},e.drawingStyle==="line"){let l=0;n.beginPath();for(let c=0;c<r.length;c++){const h=$e(e.scaleValue(r[c]));l=i+this.paddingPx+s.height*Sn(h),u.push({x:o,y:l,index:c,value:r[c]}),c==0?n.moveTo(o+a/2,l):n.lineTo(o+a/2,l),l>this.visual.height&&console.warn(l+" h: "+this.visual.height),o+=a}n.strokeStyle=e.colour,n.stroke()}else if(e.drawingStyle==="dotted"){let l=0;n.fillStyle=e.colour;for(let c=0;c<r.length;c++){const h=e.scaleValue(r[c]);l=i+s.height*Sn(h),n.beginPath(),n.arc(o+a/2,l,e.width,0,this.piPi),n.fill(),u.push({radius:e.width,x:o,y:l,index:c,value:r[c]}),o+=a}}else if(e.drawingStyle==="bar"){n.fillStyle=e.colour;const l=Math.ceil(a*.1);for(let c=0;c<r.length;c++){const h=e.scaleValue(r[c]),f=s.height*h,d={x:o+l,y:s.height-f+i,width:a-l,height:f,index:c,value:r[c]};n.fillRect(d.x,d.y,d.width,d.height),u.push(d),o+=a}}}},ch=class extends Br{constructor(e){super(e,e.canvasEl,"Legend");this.plot=e,y(this,"sampleSize",{width:10,height:10}),y(this,"padding",3),y(this,"widthSnapping",20)}clear(){}measureSelf(e,r){const n=e.measurements.get("AxisY"),i=this.sampleSize,s=this.widthSnapping,a=this.padding,o=e.ctx;if(n===void 0)return;const u=e.bounds.width-n.size.width,l=this.plot.seriesArray();let c=a;for(let d=0;d<l.length;d++)c+=i.width+a,c+=fr(o,l[d].name,a,s),c+=fr(o,l[d].tooltip,a,s);const f=Math.max(1,Math.ceil(c/u))*(this.sampleSize.height+this.padding+this.padding);return{x:n.size.width,y:e.bounds.height-f,width:u,height:f}}drawSelf(e){const r=this.plot.seriesArray(),n=this.sampleSize,i=this.padding,s=this.widthSnapping;let a=i,o=i;e.clearRect(0,0,this.visual.width,this.visual.height);for(let u=0;u<r.length;u++){const l=r[u];e.fillStyle=l.colour,e.fillRect(a,o,n.width,n.height),a+=n.width+i,e.textBaseline="middle",e.fillText(l.name,a,o+n.height/2),a+=fr(e,l.name,i,s),l.tooltip&&(e.fillStyle=this.plot.axisColour,e.fillText(l.tooltip,a,o+n.height/2),a+=fr(e,l.tooltip,i,s)),a+=i,a>this.visual.width-100&&(a=i,o+=n.height+i+i)}}onNotify(e,r){e==="measureApplied"&&r===this._parent.axisY&&(this._needsLayout=!0)}},hh=class extends Br{constructor(e){super(e,e.canvasEl,"AxisX");this.plot=e,y(this,"paddingPx",2),y(this,"colour")}clear(){}onNotify(e,r){e==="measureApplied"&&r===this.plot.axisY&&(this._needsLayout=!0),e==="measureApplied"&&r===this.plot.legend&&this.onLayoutNeeded()}drawSelf(e){const r=this.plot,n=this.visual,i=r.axisWidth,s=this.colour??r.axisColour;e.strokeStyle=s,e.clearRect(0,0,n.width,n.height),e.beginPath(),e.lineWidth=i,e.moveTo(0,i/2),e.lineTo(n.width,i/2),e.stroke()}measureSelf(e,r){const n=this.plot,i=e.measurements.get("AxisY");if(i===void 0)return;const s=e.measurements.get("Legend");if(s===void 0)return;const a=n.axisWidth+this.paddingPx;return{x:i.size.width,y:e.bounds.height-a-s.size.height,width:e.bounds.width-i.size.width,height:a}}},fh=(e,r)=>e.max===r.max&&e.min===r.min,Jg=e=>e.max===e.min,dh=class extends Br{constructor(e){super(e,e.canvasEl,"AxisY");this.plot=e,y(this,"_maxDigits",1),y(this,"seriesToShow"),y(this,"paddingPx",2),y(this,"colour"),y(this,"lastRange"),y(this,"lastPlotAreaHeight",0),this.lastRange={min:0,max:0}}clear(){this.lastRange={min:0,max:0},this.lastPlotAreaHeight=0}measurePreflight(){const e=this.getSeries();e!==void 0&&!fh(e.visualRange,this.lastRange)&&(this._needsLayout=!0,this.needsDrawing=!0)}onNotify(e,r){const n=this.plot.plotArea;e==="measureApplied"&&r===n&&n.visual.height!==this.lastPlotAreaHeight&&(this.lastPlotAreaHeight=n.visual.height,this.needsDrawing=!0)}measureSelf(e){const r=e,n=this.paddingPx;let i=this.plot.axisWidth+n;const s=this.getSeries();if(s!==void 0){const o=s.visualRange;this._maxDigits=Math.ceil(o.max).toString().length+s.precision+1;const u="9".repeat(this._maxDigits);i+=fr(r.ctx,u,n*2)}const a=e.resolveToPx(this.desiredSize?.width,i);return{x:0,y:0,width:a,height:e.bounds.height}}drawSelf(e){const r=this.getSeries();if(r!==void 0)this.seriesAxis(r,e);else{if(this.seriesToShow===void 0)return;console.warn(`Plot AxisY series '${this.seriesToShow}' is missing.`)}}getSeries(){return this.seriesToShow===void 0?this.plot.seriesArray()[0]:this.plot.series.get(this.seriesToShow)}seriesAxis(e,r){const n=this.plot,i=n.plotArea,s=this.visual,a=this.paddingPx,o=e.visualRange,u=n.axisWidth,l=this.colour??n.axisColour;if(r.strokeStyle=l,r.fillStyle=l,Number.isNaN(o.min)&&Number.isNaN(o.max))return;this.lastRange=o,r.clearRect(0,0,s.width,s.height),r.beginPath(),r.lineWidth=u;const c=s.width-u/2;r.moveTo(c,i.paddingPx+u),r.lineTo(c,i.visual.height+u),r.stroke(),r.textBaseline="top";const h=s.width-a*4;Jg(o)?Ii(r,e.formatValue(o.max),f=>[h-f.width,i.computeY(e,o.max)-a*4]):(Ii(r,e.formatValue(o.max),f=>[h-f.width,i.computeY(e,o.max)+u/2]),Ii(r,e.formatValue(o.min),f=>[h-f.width,i.computeY(e,o.min)-5]))}},Ii=(e,r,n)=>{const i=e.measureText(r),s=n(i);e.fillText(r,s[0],s[1])},Yg=class extends Br{constructor(e,r={}){if(e===void 0)throw new Error("canvasEl undefined");super(void 0,e,"Plot");y(this,"plotArea"),y(this,"legend"),y(this,"axisX"),y(this,"axisY"),y(this,"axisColour"),y(this,"axisWidth"),y(this,"series"),y(this,"_frozen",!1),y(this,"defaultSeriesOpts"),r.autoSize&&As(e,n=>{this.update(!0)}),this.axisColour=r.axisColour??"black",this.axisWidth=r.axisWidth??3,this.series=new Map,this.plotArea=new lh(this),this.legend=new ch(this),this.axisX=new hh(this),this.axisY=new dh(this)}clearSeries(){for(const e of this.series.values())e.clear()}clear(){this.series=new Map,this.plotArea.clear(),this.legend.clear(),this.axisX.clear(),this.axisY.clear(),this.update(!0)}get frozen(){return this._frozen}set frozen(e){this._frozen=e,e?(this.canvasEl.classList.add("frozen"),this.canvasEl.title="Plot frozen. Tap to unfreeze"):(this.canvasEl.title="",this.canvasEl.classList.remove("frozen"))}seriesArray(){return[...this.series.values()]}get seriesLength(){return this.series.size}plot(e){gs(e).forEach(n=>{let i=this.series.get(n);i===void 0&&(i=this.createSeries(n,"stream"),i.drawingStyle="line"),i.add(Jn(e,n))})}createSeriesFromObject(e,r=""){const n=Object.keys(e),i=s=>{const a=e[s];return typeof a=="object"?this.createSeriesFromObject(a,r+s+"."):typeof a=="number"?[this.createSeries(s,"stream")]:[]};return n.flatMap(i)}createSeries(e,r="array",n){const i=this.seriesLength;if(e===void 0&&(e=`series-${i}`),this.series.has(e))throw new Error(`Series name '${e}' already in use`);let s={colour:`hsl(${i*25%360}, 70%,50%)`,...n};this.defaultSeriesOpts&&(s={...this.defaultSeriesOpts,...s});const a=new uh(e,r,this,s);return this.series.set(e,a),this.setReady(!0,!0),this.plotArea.needsDrawing=!0,a}},ka={};T(ka,{create:()=>Kg});var Kg=e=>new Xg(e),Lr,Cn,lr,jr,Xg=class{constructor(e){le(this,Lr,new Map),le(this,Cn,new Map),y(this,"fallbacks"),le(this,lr,0),le(this,jr,void 0),e!==void 0?this.fallbacks=e:this.fallbacks=["red","blue","green","orange"],Z(this,jr,document.body)}setElementBase(e){Z(this,jr,e)}add(e,r){E(this,Lr).set(e,r)}alias(e,r){E(this,Cn).set(e,r)}get(e,r){const n=E(this,Cn).get(e);n!==void 0&&(e=n);const i=E(this,Lr).get(e);if(i!==void 0)return i;const s="--"+e;let a=getComputedStyle(E(this,jr)).getPropertyValue(s).trim();if(a===void 0||a.length===0){if(r!==void 0)return r;a=this.fallbacks[E(this,lr)],of(this,lr)._++,E(this,lr)===this.fallbacks.length&&Z(this,lr,0)}return a}getOrAdd(e,r){if(this.has(e))return this.get(e);const n=this.get(e,r);return this.add(e,n),n}has(e){return E(this,Lr).has(e)}};Lr=new WeakMap;Cn=new WeakMap;lr=new WeakMap;jr=new WeakMap;try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{SceneGraph:za,Plot2:Na,Drawing:li,Svg:Sa,Plot:Pa,Palette:ka,Colour:tn,Video:ma}})}catch{}var Zg={};T(Zg,{Forms:()=>Mo,clear:()=>Od,copyToClipboard:()=>Wd,createAfter:()=>Rd,createIn:()=>Ld,cycleCssClass:()=>$d,dataTable:()=>qd,dataTableList:()=>jd,defaultErrorHandler:()=>sw,fullSizeCanvas:()=>kd,fullSizeElement:()=>qo,getTranslation:()=>Id,log:()=>ew,parentSize:()=>Td,parentSizeCanvas:()=>As,pointerVisualise:()=>iw,reconcileChildren:()=>Hd,resizeObservable:()=>Fs,resolveEl:()=>Ee,rx:()=>tw,themeChangeObservable:()=>Vd,windowResize:()=>Cs});var Qg=(e,r)=>{const n=document.createElement("style");n.textContent=r;let i;return e.shadowRoot?(i=e.shadowRoot,i.innerHTML=""):i=e.attachShadow({mode:"open"}),i.appendChild(n),i},ew=(e,r={})=>{const{capacity:n=0,monospaced:i=!0,timestamp:s=!1,collapseDuplicates:a=!0,css:o=""}=r;let u=0,l,c=0;const h=Ee(e),d=Qg(h,`
  .log {
    font-family: ${i?'Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", Monaco, "Courier New", Courier, monospace':"normal"};
    background-color: var(--code-background-color);
    padding: var(--padding1, 0.2em);
    overflow-y: auto;
    height:100%;
  }
  .timestamp {
    margin-right: 0.5em;
    opacity: 0.5;
    font-size: 70%;
    align-self: center;
  }
  .line {
    display: flex;
    padding-bottom: 0.1em;
    padding-top: 0.1em;
  }
  .line:hover {
  
  }
  .error {
    color: red;
  }
  .badge {
    border: 1px solid currentColor;
    align-self: center;
    font-size: 70%;
    padding-left: 0.2em;
    padding-right: 0.2em;
    border-radius: 1em;
    margin-left: 0.5em;
    margin-right: 0.5em;
  }
  .msg {
    flex: 1;
    word-break: break-word;
  }
  ${o}
  `),D=document.createElement("div");D.className="log",d.append(D);const F=P=>{const I=document.createElement("div");if(typeof P=="string")I.innerHTML=P;else if(P instanceof Error){const Q=P.stack;Q===void 0?I.innerHTML=P.toString():I.innerHTML=Q.toString()}else I.innerHTML=P;I.classList.add("error"),N(I),l=void 0,c=0};let B=0;const _=(P="")=>{let I;const Q=window.performance.now()-B;if(!(r.minIntervalMs&&Q<r.minIntervalMs))if(B=window.performance.now(),typeof P=="object"?I=JSON.stringify(P):P===void 0?I="(undefined)":P===null?I="(null)":typeof P=="number"?(Number.isNaN(I)&&(I="(NaN)"),I=P.toString()):I=P,I.length===0){const R=document.createElement("hr");l=void 0,N(R)}else if(I===l&&a){const R=D.firstElementChild;let Y=R.querySelector(".badge");return Y===null&&(Y=document.createElement("div"),Y.className="badge",R.insertAdjacentElement("beforeend",Y)),R!==null&&(Y.textContent=(++c).toString()),R}else{const R=document.createElement("div");return R.innerText=I,N(R),l=I,R}},N=P=>{if(s){const I=document.createElement("div"),Q=document.createElement("div");Q.className="timestamp",Q.innerText=new Date().toLocaleTimeString(),I.append(Q,P),P.classList.add("msg"),I.classList.add("line"),P=I}else P.classList.add("line","msg");if(r.reverse?D.appendChild(P):D.insertBefore(P,D.firstChild),n>0&&++u>n*2)for(;u>n;)D.lastChild?.remove(),u--;r.reverse&&(D.scrollTop=D.scrollHeight),c=0};return{error:F,log:_,append:N,clear:()=>{D.innerHTML="",l=void 0,c=0,u=0},dispose:()=>{D.remove()},get isEmpty(){return u===0}}},tw=(e,r,n)=>{const i=Ee(e),s=Nn(i,r),a={},o=()=>{Object.keys(a).forEach(c=>{delete a[c]})},u=l=>(l.subscribe({next:c=>{Object.assign(a,c)}}),{value:a,clear:o});return n===void 0?u(s):n.pluck?u(s.pipe(Mn(l=>l[n.pluck]))):n.transform?u(s.pipe(Mn(l=>n.transform(l)))):u(s)},vh=class{constructor(e){y(this,"store"),y(this,"gog"),this.store=new Map,this.gog=Go(this.store,e)}get size(){return this.store.size}has(e){return this.store.has(e)}async seen(e,...r){return(await this.getTrackedValue(e,...r)).seen(...r)}async getTrackedValue(e,...r){if(e===null)throw new Error("id parameter cannot be null");if(e===void 0)throw new Error("id parameter cannot be undefined");return await this.gog(e,r[0])}delete(e){this.store.delete(e)}reset(){this.store=new Map}*ids(){yield*this.store.keys()}*tracked(){yield*this.store.values()}*trackedByAge(){const e=Array.from(this.store.values());e.sort((r,n)=>{const i=r.elapsed,s=n.elapsed;return i===s?0:i>s?-1:1});for(const r of e)yield r}*valuesByAge(){for(const e of this.trackedByAge())yield e.last}*last(){for(const e of this.store.values())yield e.last}*initialValues(){for(const e of this.store.values())yield e.initial}get(e){return this.store.get(e)}},rw=class extends Ws{constructor(e,r={}){super(e,r);y(this,"values"),this.values=[]}onReset(){this.values=[]}seenImpl(e){const r=e.map(i=>"at"in i?i:{...i,at:Date.now()}),n=r.at(-1);return this.storeIntermediate?this.values.push(...r):this.values.length===0?this.values.push(n):this.values.length===2?this.values[1]=n:this.values.length===1&&this.values.push(n),r}get last(){return this.values.length===1?this.values[0]:this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){return Date.now()-this.values[0].at}},$a=class extends rw{constructor(e,r={}){super(e,r);this.id=e,y(this,"initialRelation"),y(this,"lastResult")}get x(){return this.last.x}get y(){return this.last.y}onReset(){super.onReset(),this.lastResult=void 0,this.initialRelation=void 0}seen(...e){const r=this.last;super.seen(...e);const n=this.last;if(this.initialRelation===void 0&&this.initial)this.initialRelation=es(this.initial);else if(this.initialRelation===void 0)throw new Error("Bug: No initialRelation, and this.inital is undefined?");const i=es(r),s={...this.initialRelation(n)},a={...i(n),speed:this.values.length<2?0:Ge(r,n)/(n.at-r.at)},o={fromInitial:s,fromLast:a,values:[...this.values]};return this.lastResult=o,o}get line(){return this.values.length===1?[]:Xu(...this.values)}distanceFromStart(){const e=this.initial;return this.values.length>=2&&e!==void 0?dt(e,this.last):0}difference(){const e=this.initial;return this.values.length>=2&&e!==void 0?Us(this.last,e):tl}angleFromStart(){const e=this.initial;if(e!==void 0&&this.values.length>2)return dr(e,this.last)}get length(){if(this.values.length===1)return 0;const e=this.line;return Ge(e)}},yh=class extends vh{constructor(e={}){super((r,n)=>{if(n===void 0)throw new Error("Requires start point");const i=new $a(r,e);return i.seen(n),i})}},ph=(e={})=>new yh(e),nw=(e,r={})=>new $a(e??"",r),iw=(e,r={})=>{const n=r.touchRadius??45,i=r.touchRadius??20,s=r.trace??!1,a=r.hue??100,o=`hsla(${a}, 100%, 10%, 10%)`;let u=a;const l=Ee(e),c=ph({storeIntermediate:s}),h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.id="pointerVis",h.style.zIndex="-1000",h.style.position="fixed",h.style.top="0",h.style.left="0",h.style.width="100%",h.style.height="100%",h.style.boxSizing="border-box",h.style.border="3px solid red",h.style.pointerEvents="none",h.style.touchAction="none",qo(h);let f=0;const d=async F=>{const B=F.pointerId.toString();c.delete(B),u=a,h.querySelector(`#pv-start-${B}`)?.remove();for(let _=0;_<f+10;_++)h.querySelector(`#pv-progress-${B}-${_}`)?.remove();f=0},D=async F=>{const B=F.pointerId.toString(),_={x:F.x,y:F.y},N=F.pointerType;if(F.type==="pointermove"&&!c.has(B))return;const O=await c.seen(B,_);if(O.values.length===1){const I=Wn.circle({...O.values[0],radius:N==="touch"?n:i},h,{fillStyle:o},`#pv-start-${B}`);I.style.pointerEvents="none",I.style.touchAction="none"}const ee=`hsla(${u}, 100%, 50%, 50%)`,P=Wn.circle({..._,radius:N==="touch"?n:i},h,{fillStyle:ee},`#pv-progress-${B}-${O.values.length}`);return P.style.pointerEvents="none",P.style.touchAction="none",u+=1,f=O.values.length,!0};document.body.appendChild(h),l.addEventListener("pointerdown",D),l.addEventListener("pointermove",D),l.addEventListener("pointerup",d),l.addEventListener("pointerleave",d),l.addEventListener("contextmenu",F=>{F.preventDefault()})},sw=()=>{let e=!0;const r=document.createElement("div");r.style.color="black",r.style.border="2px solid red",r.style.backgroundColor="hsl(0, 80%, 90%)",r.style.padding="1em",r.style.display="none",r.style.top="1em",r.style.left="1em",r.style.position="absolute",r.style.fontFamily="monospace";const n=document.createElement("div");n.style.maxWidth="50vw",n.style.maxHeight="50vh",n.style.overflowY="scroll",r.innerHTML="<h1>Error</h1>",r.append(n);const i=l=>{l.style.padding="0.3em",l.style.marginTop="1em"},s=document.createElement("button");s.innerText="Close",s.onclick=()=>{u()};const a=document.createElement("button");a.innerText="Stop displaying errors",a.onclick=()=>{e=!1,u()},i(s),i(a),r.append(s),r.append(a),document.body.append(r);const o=l=>{r.style.display="inline",l.stack?n.innerHTML+=`<pre>${l.stack}</pre>`:n.innerHTML+=`<p>${l}</p>`},u=()=>{r.style.display="none"};return window.onerror=(l,c,h,f,d)=>{e&&(d?(console.log(d),o(d)):(console.log(l),o(l)))},window.addEventListener("unhandledrejection",l=>{console.log(l.reason),e&&o(l.reason)}),{show:o,hide:u}},aw={};T(aw,{Easings:()=>js,Forces:()=>Ia,Oscillators:()=>ja,adsr:()=>Ta,adsrSample:()=>wh,defaultAdsrOpts:()=>gh,jitter:()=>Sh,pingPong:()=>Bs,pingPongPercent:()=>Vo});var mh={};T(mh,{adsr:()=>Ta,adsrSample:()=>wh,defaultAdsrOpts:()=>gh});var gh=()=>({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1}),_e,Fn,ct,Ot,Ft,ow=class extends Mt{constructor(e){super();le(this,_e,void 0),le(this,Fn,void 0),le(this,ct,void 0),le(this,Ot,void 0),le(this,Ft,void 0),y(this,"attackDuration"),y(this,"decayDuration"),y(this,"releaseDuration"),y(this,"decayDurationTotal"),y(this,"shouldLoop"),this.attackDuration=e.attackDuration??300,this.decayDuration=e.decayDuration??500,this.releaseDuration=e.releaseDuration??1e3,this.shouldLoop=e.shouldLoop??!1;const r={attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null};Z(this,_e,new Fr("attack",r)),E(this,_e).addEventListener("change",n=>{n.newState==="release"&&E(this,Ft)&&E(this,ct)?.reset(),super.fireEvent("change",n)}),E(this,_e).addEventListener("stop",n=>{super.fireEvent("complete",n)}),Z(this,Fn,er),Z(this,Ot,Z(this,Ft,!1)),this.decayDurationTotal=this.attackDuration+this.decayDuration}switchState(){if(E(this,ct)===void 0)return!1;let e=E(this,ct).elapsed;const r=E(this,Ft)&&!E(this,Ot);let n=!1;do switch(n=!1,E(this,_e).state){case"attack":(e>this.attackDuration||r)&&(E(this,_e).next(),n=!0);break;case"decay":(e>this.decayDurationTotal||r)&&(E(this,_e).next(),n=!0);break;case"sustain":(!E(this,Ot)||r)&&(e=0,E(this,_e).next(),E(this,ct)?.reset(),n=!0);break;case"release":e>this.releaseDuration&&(E(this,_e).next(),n=!0);break;case"complete":this.shouldLoop&&this.trigger(E(this,Ft))}while(n);return n}computeRaw(e=!0){if(E(this,ct)===void 0)return[void 0,0,E(this,_e).state];e&&this.switchState();const r=E(this,_e).state,n=E(this,ct).elapsed;let i=0;const s=E(this,_e).state;switch(s){case"attack":i=n/this.attackDuration;break;case"decay":i=(n-this.attackDuration)/this.decayDuration;break;case"sustain":i=1;break;case"release":i=Math.min(n/this.releaseDuration,1);break;case"complete":return[void 0,1,r];default:throw new Error(`State machine in unknown state: ${s}`)}return[s,i,r]}get isDone(){return E(this,_e).isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),E(this,_e).reset(),Z(this,ct,E(this,Fn).call(this)),Z(this,Ot,e),Z(this,Ft,e)}compute(){}release(){this.isDone||!E(this,Ft)||(Z(this,Ot,!1),this.compute())}};_e=new WeakMap;Fn=new WeakMap;ct=new WeakMap;Ot=new WeakMap;Ft=new WeakMap;var uw=class extends ow{constructor(e){super(e);y(this,"attackPath"),y(this,"decayPath"),y(this,"releasePath"),y(this,"initialLevel"),y(this,"peakLevel"),y(this,"releaseLevel"),y(this,"sustainLevel"),y(this,"attackBend"),y(this,"decayBend"),y(this,"releaseBend"),y(this,"initialLevelOverride"),y(this,"retrigger"),y(this,"releasedAt"),this.initialLevel=e.initialLevel??0,this.peakLevel=e.peakLevel??1,this.releaseLevel=e.releaseLevel??0,this.sustainLevel=e.sustainLevel??.75,this.retrigger=e.retrigger??!0,this.attackBend=e.attackBend??0,this.releaseBend=e.releaseBend??0,this.decayBend=e.decayBend??0;const r=1;this.attackPath=bn(vr({x:0,y:this.initialLevel},{x:r,y:this.peakLevel},-this.attackBend)),this.decayPath=bn(vr({x:0,y:this.peakLevel},{x:r,y:this.sustainLevel},-this.decayBend)),this.releasePath=bn(vr({x:0,y:this.sustainLevel},{x:r,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){const[e,r,n]=this.compute();!Number.isNaN(r)&&r>0&&(this.initialLevelOverride=r)}}get value(){return this.compute(!0)[1]}compute(e=!0){const[r,n]=super.computeRaw(e);if(r===void 0)return[void 0,NaN,NaN];let i;switch(r){case"attack":i=this.attackPath.interpolate(n).y,this.initialLevelOverride!==void 0&&(i=vt(i,0,1,this.initialLevelOverride,1)),this.releasedAt=i;break;case"decay":i=this.decayPath.interpolate(n).y,this.releasedAt=i;break;case"sustain":i=this.sustainLevel,this.releasedAt=i;break;case"release":i=this.releasePath.interpolate(n).y,this.releasedAt!==void 0&&(i=vt(i,0,this.sustainLevel,0,this.releasedAt));break;case"complete":i=this.releaseLevel,this.releasedAt=void 0;break;default:throw new Error(`Unknown state: ${r}`)}return[r,i,n]}},Ta=e=>new uw(e);async function*wh(e,r){if(e.shouldLoop)throw new Error("Cannot sample a looping envelope");const n=Ta(e);for(n.trigger();;){await Xt(r);const i=n.value;if(n.isDone)return;yield i}}var Ia={};T(Ia,{accelerationForce:()=>vw,angleFromAccelerationForce:()=>Eh,angleFromVelocityForce:()=>bh,angularForce:()=>xh,apply:()=>dw,attractionForce:()=>hw,computeAccelerationToTarget:()=>Ah,computeAttractionForce:()=>Dh,computePositionFromAngle:()=>Ch,computePositionFromVelocity:()=>La,computeVelocity:()=>Ra,constrainBounce:()=>cw,guard:()=>lw,magnitudeForce:()=>yw,nullForce:()=>pw,orientationForce:()=>Ew,pendulumForce:()=>ww,springForce:()=>gw,targetForce:()=>fw,velocityForce:()=>mw});var lw=(e,r="t")=>{if(e===void 0)throw new Error(`Parameter ${r} is undefined. Expected ForceAffected`);if(e===null)throw new Error(`Parameter ${r} is null. Expected ForceAffected`);if(typeof e!="object")throw new Error(`Parameter ${r} is type ${typeof e}. Expected object of shape ForceAffected`)},cw=(e={width:1,height:1},r=1)=>{const n=is(e,"left"),i=is(e,"right"),s=ss(e,"top"),a=ss(e,"bottom");return o=>{const u=La(o.position??w.Empty,o.velocity??w.Empty);let l=o.velocity??w.Empty,{x:c,y:h}=u;return c>i?(c=i,l=w.invert(w.multiply(l,r),"x")):c<n&&(c=n,l=w.invert(w.multiply(l,r),"x")),h>a?(h=a,l=w.multiply(w.invert(l,"y"),r)):u.y<s&&(h=s,l=w.invert(w.multiply(l,r),"y")),Object.freeze({...o,position:{x:c,y:h},velocity:l})}},hw=(e,r,n={})=>i=>{let s=i.acceleration??w.Empty;return e.forEach(a=>{if(a===i)return;const o=Dh(a,i,r,n);s=w.sum(s,o)}),{...i,acceleration:s}},Dh=(e,r,n,i={})=>{if(e.position===void 0)throw new Error("attractor.position not set");if(r.position===void 0)throw new Error("attractee.position not set");const s=i.min??.01,a=i.max??.7,o=w.normalise(w.subtract(e.position,r.position)),u=$e(w.distance(o),s,a);return w.multiply(o,n*(e.mass??1)*(r.mass??1)/(u*u))},fw=(e,r={})=>i=>{const s=Ah(e,i.position??{x:.5,y:.5},r);return{...i,acceleration:w.sum(i.acceleration??w.Empty,s)}},dw=(e,...r)=>{if(e===void 0)throw new Error("t parameter is undefined");r.forEach(a=>{a!=null&&(typeof a=="function"?e=a(e):e={...e,acceleration:w.sum(e.acceleration??w.Empty,a)})});const n=Ra(e.acceleration??w.Empty,e.velocity??w.Empty),i=La(e.position??w.Empty,n);return{...e,position:i,velocity:n,acceleration:w.Empty}},vw=(e,r="ignored")=>n=>Object.freeze({...n,acceleration:yi(e,n,r)}),yi=(e,r,n="ignored")=>{let i;if(n==="dampen")i=s=>w.divide(e,s,s);else if(n==="multiply")i=s=>w.multiply(e,s,s);else if(n==="ignored")i=s=>e;else throw new Error(`Unknown 'mass' parameter '${n}. Expected 'dampen', 'multiply' or 'ignored'`);return w.sum(r.acceleration??w.Empty,i(r.mass??1))},yw=(e,r="ignored")=>n=>{if(n.velocity===void 0)return n;const i=w.distance(w.normalise(n.velocity)),s=e*i*i,a=w.multiply(w.invert(n.velocity),s);return Object.freeze({...n,acceleration:yi(a,n,r)})},pw=e=>e,mw=(e,r)=>{const n=w.pipeline(w.invert,i=>w.multiply(i,e));return i=>{if(i.velocity===void 0)return i;const s=n(i.velocity);return Object.freeze({...i,acceleration:yi(s,i,r)})}},xh=()=>e=>{const r=e.angularAcceleration??0,n=e.angularVelocity??0,i=e.angle??0,s=n+r,a=i+s;return Object.freeze({...e,angle:a,angularVelocity:s,angularAcceleration:0})},Eh=(e=20)=>r=>{const n=r.acceleration??w.Empty;return Object.freeze({...r,angularAcceleration:n.x*e})},bh=(e=1)=>r=>{const n=w.angle(r.velocity??w.Empty);return Object.freeze({...r,angle:e<1?Nh(e,r.angle??0,n):n})},gw=(e,r=.5,n=2e-4,i=.999)=>s=>{const a=w.subtract(s.position??w.Empty,e),o=w.distance(a),u=Math.abs(r-o),l=w.pipelineApply(a,w.normalise,d=>w.multiply(d,-n*u)),c=yi(l,s,"dampen"),h=Ra(c??w.Empty,s.velocity??w.Empty),f=w.multiply(h,i,i);return{...s,velocity:f,acceleration:w.Empty}},ww=(e={x:.5,y:0},r={})=>n=>{const i=r.length??w.distance(e,n.position??w.Empty),s=r.speed??.001,a=r.damping??.995;let o=n.angle;o===void 0&&(n.position?o=w.angle(e,n.position)-Math.PI/2:o=0);const u=-1*s/i*Math.sin(o),l=(n.angularVelocity??0)+u;return o+=l,Object.freeze({angularVelocity:l*a,angle:o,position:Ch(i,o+Math.PI/2,e)})},Ra=(e,r,n)=>{const i=w.sum(r,e);return n!==void 0?w.clampMagnitude(i,n):i},Ah=(e,r,n={})=>{const i=n.diminishBy??.001,s=w.subtract(e,r);return n.range&&w.compare(w.abs(s),n.range)===-2?w.Empty:w.multiply(s,i)},La=(e,r)=>w.sum(e,r),Ch=(e,r,n)=>Ze.toCartesian(e,r,n),Dw=xh(),xw=Eh(),Ew=(e=.5)=>{const r=bh(e);return n=>(n=Dw(n),n=xw(n),n=r(n),n)},ja={};T(ja,{saw:()=>Bw,sine:()=>Cw,sineBipolar:()=>Fw,spring:()=>Aw,square:()=>_w,triangle:()=>Sw});var Fh=Math.PI*2,bw=(e={},r=0,n=1)=>{const i=e.mass??1,s=e.stiffness??100,a=e.soft??!1,o=e.damping??10,u=e.velocity??.1,l=n-r;if(a===!0||1<=o/(2*Math.sqrt(s*i))){const c=-Math.sqrt(s/i),h=-c*l-u;return f=>n-(l+f*h)*Math.E**(f*c)}else{const c=Math.sqrt(4*i*s-o**2),h=(o*l-2*i*u)/c,f=.5*c/i,d=-(.5*o)/i;return D=>n-(Math.cos(D*f)*l+Math.sin(D*f)*h)*Math.E**(D*d)}};function*Aw(e={},r){r===void 0?r=er():typeof r=="number"&&(r=mt(r));const n=bw(e,0,1);let i=e.countdown??10;for(;i>0;){const s=n(r.elapsed/1e3);yield s,s===1?i--:i=100}}function*Cw(e){for(typeof e=="number"&&(e=mt(e));;)yield(Math.sin(e.elapsed*Fh)+1)/2}function*Fw(e){for(typeof e=="number"&&(e=mt(e));;)yield Math.sin(e.elapsed*Fh)}function*Sw(e){for(typeof e=="number"&&(e=mt(e));;){let r=e.elapsed;r<.5?r*=2:r=2-r*2,yield r}}function*Bw(e){for(typeof e=="number"&&(e=mt(e));;)yield e.elapsed}function*_w(e){for(typeof e=="number"&&(e=mt(e));;)yield e.elapsed<.5?0:1}var Sh=(e,r,n={})=>{const i=n.type??"abs",s=n.clamped??!0,a=n.random??Ye;M(e,s?"percentage":"bipolar","value"),M(r,s?"percentage":"bipolar","jitter");let o;if(i==="rel"){r=e*r;const u=r*2*a();o=e-r+u}else if(i==="abs"){const u=r*2*a();o=e-r+u}else throw new Error(`Unknown jitter type: ${i}.`);return s?$e(o):o};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Modulation:{Forces:Ia,jitter:Sh,Envelopes:mh,Oscillators:ja,Easings:js}})}catch{}var Pe,cr,Bh=class extends Mt{constructor(e=void 0){super();le(this,Pe,void 0),le(this,cr,void 0),Z(this,Pe,new Map),e===void 0&&(e=r=>{if(r===void 0)throw new Error("Cannot create key for undefined");return typeof r=="string"?r:JSON.stringify(r)}),Z(this,cr,e)}clear(){E(this,Pe).clear(),this.fireEvent("change",void 0)}keys(){return E(this,Pe).keys()}values(){return E(this,Pe).values()}toArray(){return Array.from(E(this,Pe).entries())}debugString(){let e="";for(const[r,n]of E(this,Pe).entries())e+=`${r}: ${n}, `;return e.endsWith(", ")?e.substring(0,e.length-2):e}frequencyOf(e){if(typeof e=="string")return E(this,Pe).get(e);const r=E(this,cr).call(this,e);return E(this,Pe).get(r)}relativeFrequencyOf(e){let r;if(typeof e=="string")r=E(this,Pe).get(e);else{const i=E(this,cr).call(this,e);r=E(this,Pe).get(i)}if(r===void 0)return;const n=this.minMaxAvg();return r/n.total}entries(){return Array.from(E(this,Pe).entries())}minMaxAvg(){return iu.minMaxAvg(this.entries())}entriesSorted(e="value"){return Oh(e)(this.entries())}add(...e){if(e===void 0)throw new Error("value parameter is undefined");e.map(E(this,cr)).forEach(n=>{const i=E(this,Pe).get(n)??0;E(this,Pe).set(n,i+1)}),this.fireEvent("change",void 0)}};Pe=new WeakMap;cr=new WeakMap;var Pw=e=>new Bh(e),_h=(e=3)=>{ce(e,"aboveZero","scaling");let r=0,n=0,i=!1;return{dispose(){i=!0},get isDisposed(){return i},add(a){if(i)throw new Error("MovingAverage disposed, cannot add");return n++,r=r+(a-r)/Math.min(n,e),r},clear(){if(i)throw new Error("MovingAverage disposed, cannot clear");r=0,n=0},compute(){return r}}},Mw=(e=200,r=0,n=3)=>{ce(n,"aboveZero","scaling"),ce(e,"aboveZero","decayRateMs");const i=_h(n);let s=0;const a=()=>{s!==0&&clearTimeout(s),s=setTimeout(o,e)},o=()=>{i.add(r),i.isDisposed||setTimeout(o,e)};return{add(l){return a(),i.add(l)},dispose(){i.dispose()},clear:function(){i.clear()},compute:function(){return i.compute()},isDisposed:!1}},Nw=(e=100,r)=>{let n=!1,i=xr({capacity:e,discardPolicy:"older"});const s=()=>{i=xr({capacity:e,discardPolicy:"older"})},a=()=>r===void 0?Je.average(i.data):Je.averageWeighted(i.data,r);return{add:l=>(i.enqueue(l),a()),compute:a,clear:s,dispose:()=>{n=!0},isDisposed:n}},Ph=class extends Hs{constructor(){super(...arguments);y(this,"lastMark",0)}mark(){this.lastMark>0&&this.seen(window.performance.now()-this.lastMark),this.lastMark=window.performance.now()}},zw=(e,r)=>new Ph(e,r),Sn=e=>(typeof e=="function"&&(e=e()),M(e,"percentage","v"),1-e),Mh=(e,r=0,n=360)=>(ce(e,void 0,"v"),ce(r,void 0,"min"),ce(n,void 0,"max"),e===r||e===n?r:(e>0&&e<r&&(e+=r),e-=r,n-=r,e=e%n,e<0&&(e=n-Math.abs(e)+r),e+r)),Un=(e,r=0,n=1)=>{if(M(e,"","min"),M(r,"","min"),M(n,"","max"),e===r||e===n)return r;for(;(e<=r||e>=n)&&!(e===n||e===r);)e>n?e=r+(e-n):e<r&&(e=n-(r-e));return e},kw=(e,r,n,i,s)=>{let a=0;const o=Math.abs(s-i),u=Math.abs(r-i+s),l=Math.abs(i+(360-s)),c=Math.min(o,u,l);return c===l?a=i-n(c):c===u?a=i+n(c):i>s?a=i-n(c):a=i+n(c),Mh(a,e,r)},ds=Math.PI*2,qa=(e,r,n)=>(1-e)*r+e*n,Nh=(e,r,n)=>{const i=Un(n-r,0,ds);return qa(e,r,r+(i>Math.PI?i-ds:i))},qr=Math.sqrt,ve=Math.pow,bo=Math.cos,Vt=Math.PI,Ir=Math.sin,$w=function(e,r){return zh(e,r,er)},Tw=function(e,r){return zh(e,r,Ns)},zh=function(e,r,n){let i;if(typeof e=="function"?i=e:i=pi(e),i===void 0)throw new Error(`Easing function not found: ${e}`);const s=Ms(r,n(),!0);return{get isDone(){return s.isDone},compute:()=>{const a=s.elapsed;return i(a)},reset:()=>{s.reset()}}},Iw=(e,r)=>n=>{const i=1-n,s=i*i,a=n*n,o=a*n;return 3*e*s*n+3*r*i*a+o},kh=(e,r,n,i)=>qa(r,n(e),i(e)),Rw=(e,r,n)=>kh(e,e,r,n),pi=function(e){if(e===null)throw new Error("easingName is null");if(e===void 0)throw new Error("easingName is undefined");const r=e.toLocaleLowerCase(),n=Object.entries(Oa).find(([i,s])=>i.toLocaleLowerCase()===r);return n===void 0?n:n[1]},Lw=function(){return Array.from(Object.keys(Oa))},$h=(e=.4)=>{const r=1/qr(2*Vt),n=.5;return i=>{const s=r/e;let a=-2.5,o=(i-n)/e;o*=o,a*=o;const u=s*ve(Math.E,a);return u>1?1:u<0?0:u}},pn=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},jw=e=>e*e*e*e*e,qw=e=>1-ve(1-e,5),Ow=e=>e*(1-e)*4,Oa={arch:Ow,bell:$h(),sineIn:e=>1-bo(e*Vt/2),sineOut:e=>Ir(e*Vt/2),quadIn:e=>e*e,quadOut:e=>1-(1-e)*(1-e),sineInOut:e=>-(bo(Vt*e)-1)/2,quadInOut:e=>e<.5?2*e*e:1-ve(-2*e+2,2)/2,cubicIn:e=>e*e*e,cubicOut:e=>1-ve(1-e,3),quartIn:e=>e*e*e*e,quartOut:e=>1-ve(1-e,4),quintIn:jw,quintOut:qw,expoIn:e=>e===0?0:ve(2,10*e-10),expoOut:e=>e===1?1:1-ve(2,-10*e),quintInOut:e=>e<.5?16*e*e*e*e*e:1-ve(-2*e+2,5)/2,expoInOut:e=>e===0?0:e===1?1:e<.5?ve(2,20*e-10)/2:(2-ve(2,-20*e+10))/2,circIn:e=>1-qr(1-ve(e,2)),circOut:e=>qr(1-ve(e-1,2)),backIn:e=>2.70158*e*e*e-1.70158*e*e,backOut:e=>1+2.70158*ve(e-1,3)+1.70158*ve(e-1,2),circInOut:e=>e<.5?(1-qr(1-ve(2*e,2)))/2:(qr(1-ve(-2*e+2,2))+1)/2,backInOut:e=>{const n=2.5949095;return e<.5?ve(2*e,2)*((n+1)*2*e-n)/2:(ve(2*e-2,2)*((n+1)*(e*2-2)+n)+2)/2},elasticIn:e=>{const r=2*Vt/3;return e===0?0:e===1?1:-ve(2,10*e-10)*Ir((e*10-10.75)*r)},elasticOut:e=>{const r=2*Vt/3;return e===0?0:e===1?1:ve(2,-10*e)*Ir((e*10-.75)*r)+1},bounceIn:e=>1-pn(1-e),bounceOut:pn,elasticInOut:e=>{const r=2*Vt/4.5;return e===0?0:e===1?1:e<.5?-(ve(2,20*e-10)*Ir((20*e-11.125)*r))/2:ve(2,-20*e+10)*Ir((20*e-11.125)*r)/2+1},bounceInOut:e=>e<.5?(1-pn(1-2*e))/2:(1+pn(2*e-1))/2},Ye=Math.random,Th=(e="quadIn",r=Ye)=>{const n=r(),i=pi(e);if(i===void 0)throw new Error(`Easing function '${e}' not found.`);return i(n)},Vw=(e="quadIn",r=Ye)=>()=>Th(e,r),Ww=(e,r,n,i=Ye)=>{M(e);let s,a,o;if(o="quadIn",s=0,r===void 0)a=e;else if(typeof r=="number")s=e,a=r,n!==void 0&&(o=n);else if(typeof r=="string")a=e,o=r;else throw new Error(`Unexpected value type for maxOrEasing: ${r}`);n!==void 0&&(o=n);const u=pi(o);if(u===void 0)throw new Error(`Easing '${o}' not found`);if(M(s),a<=s)throw new Error("Max should be greater than min");const l=$e(u(i()));return Math.floor(l*(a-s))+s},Va=(e=1)=>{let i=0,s=0;for(;i===0;)i=Math.random();for(;s===0;)s=Math.random();let a=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s);return a=a/10+.5,a>1||a<0?a=Va(e):(a=Math.pow(a,e),a*=1-0,a+=0),a},Hw=(e=1)=>()=>Va(e),Uw=(e,r)=>{let n=!1;r===void 0&&(e<0&&(e=Math.abs(e),n=!0),r=0);const i=e-r,s=Math.floor(Math.random()*i)+r;return n?-s:s},Gw=(e=1,r=0)=>Math.random()*(e-r)+r,Ih=e=>Math.random().toString(36).substring(2,e+2),Jw=()=>{const e=Math.random()*46656|0,r=Math.random()*46656|0,n=`000${e.toString(36)}`.slice(-3),i=`000${r.toString(36)}`.slice(-3);return n+i},mi=(e,r="?")=>{if(e===void 0)throw new Error(`Param '${r}' is undefined. Expected array.`);if(e===null)throw new Error(`Param '${r}' is null. Expected array.`);if(!Array.isArray(e))throw new Error(`Param '${r}' not an array as expected`)},Gn=(e,r,n="index")=>{if(mi(e),ce(r,"positive",n),r>e.length-1)throw new Error(`'${n}' ${r} beyond array max of ${e.length-1}`)},Wa=(e,r)=>{if(!Array.isArray(e))throw new Error("Param 'array' is not an array.");if(e.length===0)return!0;const n=r===void 0?Po:r,i=e[0];return!e.some(a=>!n(i,a))},Yw=(e,r,n=Xr)=>e.filter(i=>r.some(s=>n(i,s))),Kw=e=>Array.prototype.concat.apply([],[...e]),Rh=(...e)=>{if(e.some(s=>!Array.isArray(s)))throw new Error("All parameters must be an array");const r=e.map(s=>s.length);if(!Wa(r))throw new Error("Arrays must be of same length");const n=[],i=r[0];for(let s=0;s<i;s++)n.push(e.map(a=>a[s]));return n},Xw=(...e)=>{if(e.some(s=>!Array.isArray(s)))throw new Error("All parameters must be an array");const r=e.map(s=>s.length);if(!Wa(r))throw new Error("Arrays must be of same length");const n=[],i=r[0];for(let s=0;s<i;s++)for(let a=0;a<e.length;a++)n.push(e[a][s]);return n},Zw=(e,r,n="undefined")=>{if(e===void 0)throw new Error("Data undefined");if(!Array.isArray(e))throw new Error("data is not an array");if(e.length===r)return[...e];if(e.length>r)return e.slice(0,r);const i=[...e],s=r-i.length;for(let a=0;a<s;a++)n==="undefined"?i.push(void 0):n==="repeat"?i.push(e[a%e.length]):n==="first"?i.push(e[0]):n==="last"&&i.push(e[e.length-1]);return i},Lh=(e,r,n,i)=>{mi(e),typeof n>"u"&&(n=0),typeof i>"u"&&(i=e.length-1),Gn(e,n,"startIndex"),Gn(e,i,"endIndex");const s=[];for(let a=n;a<=i;a++)r(e[a],a,e)&&s.push(e[a]);return s},Ha=(e,r=Ye)=>Math.floor(r()*e.length),Ua=(e,r=Ye)=>(mi(e,"array"),e[Math.floor(r()*e.length)]),Qw=(e,r=!1,n=Ye)=>{if(e===void 0)throw new Error("array is undefined");if(!Array.isArray(e))throw new Error("'array' param is not an array");if(e.length===0)return{value:void 0,array:[]};const i=Ha(e,n);if(r)return{value:e[i],array:e.splice(i,1)};{const s=[...e];return s.splice(i,1),{value:e[i],array:s}}},e1=(e,r=Ye)=>{const n=[...e];for(let i=n.length-1;i>0;i--){const s=Math.floor(r()*(i+1));[n[i],n[s]]=[n[s],n[i]]}return n},jh=(e,r,n=Xr)=>e.filter(i=>!n(i,r)),t1=(e,r)=>{if(!Array.isArray(e))throw new Error("'data' parameter should be an array");return Gn(e,r,"index"),[...e.slice(0,r),...e.slice(r+1)]},r1=(e,r)=>e.reduce((n,i)=>{const s=r(i),a=n.get(s);return a===void 0?n.set(s,[i]):a.push(i),n},new Map),n1=(e,r)=>{let n=1;if(r<=1){const s=e.length*r;n=Math.round(e.length/s)}else n=r;if(ce(n,"positive","amount"),n>e.length-1)throw new Error("Subsample steps exceeds array length");const i=[];for(let s=n-1;s<e.length;s+=n)i.push(e[s]);return i};function i1(e,r){const n=[];for(let i=0;i<e.length;i+=r)n.push(e.slice(i,i+r));return n}var s1=(e=!1)=>Ts(e?Is(zn):zn,Rs(r=>r[0])),qh=(e=!1)=>Ts(e?Is(zn):zn,Rs(r=>r[1])),a1=(e=!1)=>Ts(e?Is(Hi):Hi,Rs(r=>r[1])),vs=(e=!1)=>Ls(s1(e)),o1=(e=!1)=>Ls(qh(e)),ys=(e=!1)=>Ls(a1(e)),Oh=e=>{switch(e){case"value":return ys(!1);case"valueReverse":return ys(!0);case"key":return vs(!1);case"keyReverse":return vs(!0);default:throw new Error(`Unknown sorting value '${e}'. Expecting: value, valueReverse, key or keyReverse`)}},u1=(e,r)=>{r===void 0&&(r=i=>i[1]);const n=e.map(r);return Yn(n)};export{Je as A,Zr as B,tn as C,li as D,js as E,Mo as F,Qd as G,Bt as H,Rd as I,Ld as J,Du as K,Ne as L,Oh as M,ou as N,ja as O,Pa as P,Fu as Q,Pw as R,Wn as S,L0 as T,Kd as U,Yd as V,Fr as W,Ta as a,ka as b,Wd as c,gh as d,k0 as e,mt as f,zs as g,M0 as h,Th as i,Sh as j,Va as k,ew as l,$s as m,oa as n,ta as o,Tg as p,w as q,Ee as r,Ze as s,Vd as t,ha as u,qs as v,Ww as w,Sa as x,yt as y,ps as z};
