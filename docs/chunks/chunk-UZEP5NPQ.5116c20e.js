import{_ as m,h as k,n as j,a as g,b as D,i as O,j as It,s as Ac,k as ar,l as kc}from"./chunk-7KTY42OF.629611b4.js";var jc={};m(jc,{IterableAsync:()=>ws,comparerInverse:()=>yf,defaultComparer:()=>ht,defaultKeyer:()=>Bt,ifNaN:()=>of,isFunction:()=>rf,isInteger:()=>nf,isMap:()=>ff,isPlainObject:()=>Es,isPlainObjectOrPrimitive:()=>sf,isPowerOfTwo:()=>af,isSet:()=>hf,jsComparer:()=>zs,numericComparer:()=>Ms,relativeDifference:()=>uf,roundUpToMultiple:()=>lf,runningiOS:()=>df,toStringDefault:()=>Ke});var ws={};m(ws,{chunks:()=>Vc,concat:()=>Rc,dropWhile:()=>_c,equals:()=>Oc,every:()=>qc,fill:()=>Fc,filter:()=>Bc,find:()=>Lc,flatten:()=>Dc,forEach:()=>Gc,fromArray:()=>Ic,fromIterable:()=>Cc,map:()=>Kc,max:()=>Jc,min:()=>Uc,range:()=>Hc,reduce:()=>Wc,slice:()=>Qc,some:()=>Zc,takeWhile:()=>Yc,toArray:()=>Xc,unique:()=>ef,zip:()=>tf});var Ki=e=>{switch(typeof e){case"string":return e;case"object":return JSON.stringify(e);default:return""+e}},Ji=e=>{if(typeof e=="string")return e;const r=new Set;return JSON.stringify(e,(n,i)=>(r.add(n),i)),JSON.stringify(e,[...r].sort())},$=(e,r)=>e===r,Tc=(e,r)=>e===r?!0:Ki(e)===Ki(r),xs=(e,r)=>e===r?!0:Ji(e)===Ji(r);function K(e,r){if(bs(e)){if(typeof e=="number")return e;let n=e.millis??0;return n+=(e.hours??0)*60*60*1e3,n+=(e.mins??0)*60*1e3,n+=(e.secs??0)*1e3,n}else{if(typeof r<"u")return r;throw new Error(`Not a valid interval: ${e}`)}}function bs(e){if(e===void 0||e===null)return!1;if(typeof e=="number")return!(Number.isNaN(e)||!Number.isFinite(e));if(typeof e!="object")return!1;const r="millis"in e,n="secs"in e,i="mins"in e,s="hours"in e;return r&&!j(e.millis)[0]||n&&!j(e.secs)[0]||i&&!j(e.mins)[0]||s&&!j(e.hours)[0]?!1:!!(r||n||s||i)}(typeof window>"u"||!("requestAnimationFrame"in window))&&typeof window>"u"&&(globalThis.requestAnimationFrame=e=>{setTimeout(e,1)});var ue=e=>{const r=K(e,1),n=e.signal,i=e.value;return g(r,"positive","timeoutMs"),r===0?new Promise(s=>requestAnimationFrame(o=>{s(i)})):new Promise((s,o)=>{const a=()=>{n?(n.removeEventListener("abort",a),o(new Error(n.reason))):o(new Error("Cancelled"))};n&&n.addEventListener("abort",a),setTimeout(()=>{if(n&&n?.aborted){o(new Error(n.reason));return}n?.removeEventListener("abort",a),s(i)},r)})};async function*Ic(e){for(const r of e)yield r,await ue(1)}async function*Cc(e){for(const r of e)yield r,await ue(1)}async function*Vc(e,r){let n=[];for await(const i of e)n.push(i),n.length===r&&(yield n,n=[]);n.length>0&&(yield n)}async function*Rc(...e){for await(const r of e)yield*r}async function*_c(e,r){for await(const n of e)if(!r(n)){yield n;break}yield*e}async function Oc(e,r,n){const i=e[Symbol.asyncIterator](),s=r[Symbol.asyncIterator]();for(;;){const o=await i.next(),a=await s.next();if(n!==void 0){if(!n(o.value,a.value))return!1}else if(o.value!==a.value)return!1;if(o.done??a.done)return o.done&&a.done}}async function qc(e,r){let n=!0;for await(const i of e)n=n&&r(i);return n}async function*Fc(e,r){for await(const n of e)yield r}async function*Bc(e,r){for await(const n of e)!r(n)||(yield n)}async function Lc(e,r){for await(const n of e)if(r(n))return n}async function*Dc(e){for await(const r of e)Symbol.asyncIterator in r?yield*r:yield r}async function Gc(e,r){for await(const n of e)r(n)}async function*Kc(e,r){for await(const n of e)yield r(n)}async function Jc(e,r=(n,i)=>n>i){let n;for await(const i of e){if(!n){n=i;continue}n=r(n,i)?n:i}return n}async function Uc(e,r=(n,i)=>n>i){let n;for await(const i of e){if(!n){n=i;continue}n=r(n,i)?i:n}return n}async function*Hc(e,r){for(let n=0;n<r;n++)yield e++}async function Wc(e,r,n){for await(const i of e)n=r(n,i);return n}async function*Qc(e,r=0,n=Number.POSITIVE_INFINITY){const i=e[Symbol.asyncIterator]();for(;r>0;r--,n--)await i.next();for await(const s of e)if(n-- >0)yield s;else break}async function Zc(e,r){for await(const n of e)if(r(n))return!0;return!1}async function*Yc(e,r){for await(const n of e){if(!r(n))return;yield n}}async function Xc(e,r=Number.POSITIVE_INFINITY){const n=[],i=e[Symbol.asyncIterator]();for(;n.length<r;){const s=await i.next();if(s.done)break;n.push(s.value)}return n}async function*ef(e,r=n=>n){const n=[];for await(const i of e){const s=r(i);n.includes(s)||(n.push(s),yield i)}}async function*tf(...e){const r=e.map(n=>n[Symbol.asyncIterator]());for(;;){const n=await Promise.all(r.map(i=>i.next()));if(n.some(i=>i.done))return;yield n.map(i=>i.value)}}var rf=e=>e instanceof Function,Es=e=>{if(typeof e!="object"||e===null)return!1;const r=Object.getPrototypeOf(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},nf=e=>{if(e===void 0)return!1;if(typeof e=="string"){const r=Number.parseInt(e);return Number.isNaN(r)?!1:r.toString()===e.toString()}return typeof e=="number"?Number.isNaN(e)||!Number.isFinite(e)?!1:Math.round(e)===e:!1},sf=e=>{const r=typeof e;return r==="symbol"||r==="function"?!1:r==="bigint"||r==="number"||r==="string"||r==="boolean"?!0:Es(e)},of=(e,r)=>{if(Number.isNaN(e))return r;if(typeof e!="number")throw new TypeError(`v is not a number. Got: ${typeof e}`);return e},af=e=>Math.log2(e)%1===0,uf=e=>r=>r/e,lf=(e,r)=>(k(j(e,"nonZero","v")),k(j(r,"nonZero","multiple")),Math.ceil(e/r)*r),cf=Object.prototype.toString,Ns=e=>cf.call(e),ff=e=>Ns(e)==="[object Map]",hf=e=>Ns(e)==="[object Set]",Ke=e=>typeof e=="string"?e:JSON.stringify(e),df=()=>["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,Ms=(e,r)=>e===r?0:e>r?1:-1,zs=(e,r)=>{if(e===void 0&&r===void 0)return 0;if(e===void 0)return 1;if(r===void 0)return-1;const n=Ui(e),i=Ui(r);return n<i?-1:n>i?1:0},ht=(e,r)=>typeof e=="number"&&typeof r=="number"?Ms(e,r):zs(e,r),yf=e=>(r,n)=>e(r,n)*-1,Bt=e=>typeof e=="string"?e:JSON.stringify(e),Ui=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw new TypeError("Symbol cannot be converted to string");return JSON.stringify(e)},vf={};m(vf,{SimpleEventEmitter:()=>Je,eventRace:()=>gf});var pf=(e,r,n=$)=>{for(const i of e.entries()){const s=i[1];for(const o of s)if(n(o,r))return i}},mf=class{map;groupBy;valueEq;constructor(e=Bt,r=$,n=[]){this.groupBy=e,this.valueEq=r,this.map=new Map(n)}*entriesFlat(){for(const e of this.map.keys())for(const r of this.map.get(e))yield[e,r]}*entries(){for(const[e,r]of this.map.entries())yield[e,[...r]]}firstKeyByValue(e,r=$){const n=pf(this,e,r);if(n)return n[0]}*get(e){const r=this.map.get(e);!r||(yield*r.values())}*keys(){yield*this.map.keys()}*valuesFlat(){for(const e of this.map)yield*e[1]}*keysAndCounts(){for(const e of this.map)yield[e[0],e[1].length]}has(e){return this.map.has(e)}hasKeyValue(e,r){const n=this.map.get(e);if(!n)return!1;for(const i of n)if(this.valueEq(i,r))return!0;return!1}debugString(){let e="";return[...this.map.keys()].every(n=>{const i=this.map.get(n);i!==void 0&&(e+=n+` (${i.length}) = ${JSON.stringify(i)}\r
`)}),e}get isEmpty(){return this.map.size===0}count(e){const r=this.map.get(e);return r?r.length:0}get lengthKeys(){return this.map.size}},$s=class extends mf{addKeyedValues(e,...r){const n=this.map.get(e);n===void 0?this.map.set(e,r):this.map.set(e,[...n,...r])}addValue(...e){for(const r of e){const n=this.groupBy(r);this.addKeyedValues(n,r)}}deleteKeyValue(e,r){const n=this.map.get(e);if(n===void 0)return!1;const i=n.filter(s=>!this.valueEq(s,r));return this.map.set(e,i),i.length<n.length}deleteByValue(e){let r=!1;const n=[...this.map.entries()];for(const i of n)for(const s of i[1])this.valueEq(s,e)&&(r=!0,this.deleteKeyValue(i[0],e));return r}delete(e){const r=this.map.get(e);return!r||r.length===0?!1:(this.map.delete(e),!0)}clear(){this.map.clear()}},Ps=(e=Bt,r=$)=>new $s(e,r),gf=(e,r,n={})=>{const i=K(n.timeout,6e4),s=n.signal;let o=!1,a=!1,u;return new Promise((c,f)=>{const h=y=>{"type"in y?r.includes(y.type)?(o=!0,c(y),d()):console.warn(`eventRace: Got event '${y.type}' that is not in race list`):(console.warn("eventRace: Event data does not have expected 'type' field"),console.log(y))};for(const y of r)e.addEventListener(y,h);const d=()=>{if(!a){u!==void 0&&clearTimeout(u),u=void 0,a=!0;for(const y of r)e.removeEventListener(y,h)}};u=setTimeout(()=>{o||a||(d(),f(new Error(`Events not fired within interval. Events: ${JSON.stringify(r)}`)))},i),s?.addEventListener("abort",()=>{o||a||(d(),f(new Error(`Abort signal received ${s.reason}`)))})})},Je=class{#e=Ps();fireEvent(e,r){const n=this.#e.get(e);for(const i of n)i(r,this)}addEventListener(e,r){this.#e.addKeyedValues(e,r)}removeEventListener(e,r){this.#e.deleteKeyValue(e,r)}clearEventListeners(){this.#e.clear()}},Er={};m(Er,{additionalValues:()=>dn,average:()=>Fs,averageWeighted:()=>Hs,chunks:()=>Kf,compareValues:()=>Fn,compareValuesEqual:()=>Qs,contains:()=>Zf,containsDuplicateInstances:()=>Ys,containsDuplicateValues:()=>Wf,cycle:()=>If,dotProduct:()=>qs,ensureLength:()=>_f,filterAB:()=>Hf,filterBetween:()=>Rs,flatten:()=>Vf,groupBy:()=>Df,guardArray:()=>dt,guardIndex:()=>ur,interleave:()=>Rf,intersection:()=>Cf,isEqual:()=>Qf,max:()=>Ds,maxFast:()=>Ks,maxIndex:()=>Tf,mergeByKey:()=>Jf,min:()=>Bs,minFast:()=>qn,minIndex:()=>Ls,minMaxAvg:()=>_s,randomElement:()=>Mr,randomElementWeightedSource:()=>Of,randomIndex:()=>Bn,randomPluck:()=>qf,reducePairwise:()=>Uf,remove:()=>Lf,sample:()=>Gf,shuffle:()=>lr,sortByNumericProperty:()=>Nr,total:()=>Gs,totalFast:()=>Js,unique:()=>Zs,until:()=>Bf,validNumbers:()=>it,valuesEqual:()=>On,weight:()=>Os,without:()=>Lt,withoutUndefined:()=>Ff,zip:()=>Us});var wf=(e,r)=>{if(r=Math.round(r),e.has(r))return r;{let n=1;for(;n<1e3;){if(e.has(r-n))return r-n;if(e.has(r+n))return r+n;n++}throw new Error(`Could not find target ${r}`)}},xf=(e,r)=>{for(const n of r)if(e.has(n))return e.get(n)},bf=(e,r,n,i)=>e.has(r)?[...e.values()].some(o=>i(o,n)):!1,Ef=(e,r,n=$)=>{for(const i of Object.entries(e))n(i[1],r)&&e.delete(i[0])},Nf=(e,r)=>{for(const n of e.entries())if(r(n[1],n[0]))return n},Mf=(e,r,n=$)=>{for(const i of e.entries())if(n(i[1],r))return i},Ss=(e,r,...n)=>{const i=e===void 0?new Map:new Map(e);for(const s of n){const o=r(s);i.has(o)||i.set(o,s)}return i},zf=(e,r)=>{const n=r??ht;[...e.entries()].sort((i,s)=>n(i[1],s[1]))},As=(e,r,n)=>{const i=typeof n>"u"?ht:n;return[...e.entries()].sort((s,o)=>{const a=s[1],u=o[1];return i(a[r],u[r])})},ks=(e,r,n)=>[...e.entries()].some(s=>n(s[1],r));function*js(e,r){for(const n of e.values())r(n)&&(yield n)}var ln=e=>[...e.values()],Ts=(e,r=Ke,n=!1)=>{const i=new Map;for(const s of e){const o=r(s);if(i.has(o)&&!n)throw new Error(`id ${o} is already used and new data will overwrite it. `);i.set(o,s)}return i},$f=e=>{const r=new Map;if(Array.isArray(e))for(const n of e)cn(r,n);else cn(r,e);return r},cn=(e,r)=>{const n=Object.entries(r);for(const[i,s]of n)e.set(i,s)},Is=(e,r)=>[...e.values()].find(n=>r(n)),Pf=(e,r)=>[...e].reduce((n,[i,s])=>{const o=r(s);return n[i]=o,n},{}),_n=(e,r)=>{if(e.length!==r.length)throw new Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((n,i)=>[n,r[i]]))},Sf=(e,r)=>new Map(Array.from(e,n=>[n[0],r(n[1],n[0])])),Af=e=>[...e].reduce((r,[n,i])=>(r[n]=i,r),{}),kf=(e,r)=>[...e.entries()].map(n=>r(n[0],n[1])),jf=(e,...r)=>{const n=new Map;for(const i of r)for(const[s,o]of i){let a=n.get(s);a=a?e(a,o):o,n.set(s,a)}return n},Cs=(e,r=O)=>{const n=[];let i=0;for(let s=0;s<e.length;s++)i+=e[s],n[s]=i;if(i!==1)throw new Error(`Weightings should add up to 1. Got: ${i}`);return()=>{const s=r();for(let o=0;o<n.length;o++)if(s<=n[o])return o;throw new Error("Bug: weightedIndex could not select index")}},dt=(e,r="?")=>{if(e===void 0)throw new TypeError(`Param '${r}' is undefined. Expected array.`);if(e===null)throw new TypeError(`Param '${r}' is null. Expected array.`);if(!Array.isArray(e))throw new TypeError(`Param '${r}' not an array as expected`)},ur=(e,r,n="index")=>{if(dt(e),D(r,"positive",n),r>e.length-1)throw new Error(`'${n}' ${r} beyond array max of ${e.length-1}`)},On=(e,r)=>{if(!Array.isArray(e))throw new Error("Param 'array' is not an array.");if(e.length===0)return!0;const n=r??Tc,i=e[0];return!e.some(o=>!n(i,o))};function*Vs(e,r=0,n=Number.POSITIVE_INFINITY){const i=e[Symbol.iterator]();for(;r>0;r--,n--)i.next();for(const s of e)if(n-- >0)yield s;else break}var Rs=(e,r,n,i)=>{dt(e),typeof n>"u"&&(n=0),typeof i>"u"&&(i=e.length),ur(e,n,"startIndex"),ur(e,i-1,"endIndex");const s=[];for(let o=n;o<i;o++)r(e[o],o,e)&&s.push(e[o]);return s},_s=(e,r={})=>{if(e===void 0)throw new Error("'data' is undefined");if(!Array.isArray(e))if("next"in e){(r.startIndex||r.endIndex)&&(e=Vs(e,r.startIndex,r.endIndex));let a=0,u=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,c=0;for(const f of e){if(typeof f!="number")throw new TypeError(`Generator should yield numbers. Got: ${typeof f}`);a+=f,c++,u=Math.min(u,f),l=Math.max(l,f)}return{avg:a/c,total:a,max:l,min:u}}else throw new Error("'data' parameter is neither array or iterable");if(e.length===0)return{total:0,min:0,max:0,avg:0};const n=r.startIndex??0,i=r.endIndex??e.length,s=Rs(e,a=>typeof a=="number"&&!Number.isNaN(a),n,i),o=s.reduce((a,u)=>a+u,0);return{total:o,max:Math.max(...s),min:Math.min(...s),avg:o/s.length}},Os=(e,r)=>{const n=r??(i=>i);return it(e).map((i,s)=>i*n(s/(it.length-1)))},it=e=>e.filter(r=>typeof r=="number"&&!Number.isNaN(r)),qs=e=>{let r=0;const n=e[0].length;for(let i=0;i<n;i++){let s=0;for(const[o,a]of e.entries())o===0?s=a[i]:s*=a[i];r+=s}return r},Fs=e=>{if(e===void 0)throw new Error("data parameter is undefined");const r=it(e);return r.reduce((i,s)=>i+s,0)/r.length},Bs=e=>Math.min(...it(e)),Tf=e=>e.reduce((r,n,i,s)=>n>s[r]?i:r,0),Ls=(...e)=>e.reduce((r,n,i,s)=>n<s[r]?i:r,0),Ds=e=>Math.max(...it(e)),Gs=e=>e.reduce((r,n)=>typeof n!="number"||Number.isNaN(n)||Number.isFinite(n)?r:r+n,0),Ks=e=>{let r=Number.MIN_SAFE_INTEGER;for(const n of e)r=Math.max(r,n);return r},Js=e=>{let r=0;for(const n of e)r+=n;return r},qn=e=>{let r=Number.MIN_SAFE_INTEGER;for(const n of e)r=Math.min(r,n);return r},If=e=>{const r=[...e];let n=0;const i=()=>(n++,n===r.length&&(n=0),o()),s=()=>(n--,n===-1&&(n=r.length-1),o()),o=()=>r.at(n);return{toArray:()=>[...r],next:i,prev:s,get current(){return o()},select:l=>{if(typeof l=="number")n=l;else{const c=r.indexOf(l);if(c===-1)throw new Error("Could not find value");n=c}}}},Us=(...e)=>{if(e.some(s=>!Array.isArray(s)))throw new Error("All parameters must be an array");const r=e.map(s=>s.length);if(!On(r))throw new Error("Arrays must be of same length");const n=[],i=r[0];for(let s=0;s<i;s++)n.push(e.map(o=>o[s]));return n},Hs=(e,r)=>{typeof r=="function"&&(r=Os(e,r));const n=Us(e,r),[i,s]=n.reduce((o,a)=>[o[0]+a[0]*a[1],o[1]+a[1]],[0,0]);return i/s},Nr=(e,r)=>[...e].sort((n,i)=>{dt(e,"data");const s=n[r],o=i[r];return s<o?-1:s>o?1:0}),Ws={};m(Ws,{compareValues:()=>Fn,compareValuesEqual:()=>Qs,max:()=>fn,min:()=>hn});var fn=(e,r)=>{let n,i=Number.MIN_SAFE_INTEGER;for(const s of e){const o=r(s);o>=i&&(i=o,n=s)}return n},hn=(e,r)=>{let n,i=Number.MAX_SAFE_INTEGER;for(const s of e){const o=r(s);o<=i&&(i=o,n=s)}return n},Qs=(e,r,n=$)=>{const i=Fn(e,r,n);return i.a.length===0&&i.b.length===0},Fn=(e,r,n=$)=>{const i=[],s=[],o=[];for(const a of e){let u=!1;for(const l of r)if(n(a,l)){u=!0;break}u?i.push(a):s.push(a)}for(const a of r){let u=!1;for(const l of e)n(a,l)&&(u=!0);u||o.push(a)}return{shared:i,a:s,b:o}},Cf=(e,r,n=$)=>e.filter(i=>r.some(s=>n(i,s))),Vf=e=>[...e].flat(),Rf=(...e)=>{if(e.some(s=>!Array.isArray(s)))throw new Error("All parameters must be an array");const r=e.map(s=>s.length);if(!On(r))throw new Error("Arrays must be of same length");const n=[],i=r[0];for(let s=0;s<i;s++)for(const o of e)n.push(o[s]);return n},_f=(e,r,n="undefined")=>{if(e===void 0)throw new Error("Data undefined");if(!Array.isArray(e))throw new Error("data is not an array");if(e.length===r)return[...e];if(e.length>r)return e.slice(0,r);const i=[...e],s=r-i.length;for(let o=0;o<s;o++)switch(n){case"undefined":{i.push(void 0);break}case"repeat":{i.push(e[o%e.length]);break}case"first":{i.push(e[0]);break}case"last":{i.push(e.at(-1));break}}return i},Bn=(e,r=O)=>Math.floor(r()*e.length),Of=(e,r,n=O)=>{if(e.length!==r.length)throw new Error("Lengths of 'array' and 'weightings' should be the same.");const i=Cs(r,n);return()=>{const s=i();return e[s]}},Mr=(e,r=O)=>(dt(e,"array"),e[Math.floor(r()*e.length)]),qf=(e,r=!1,n=O)=>{if(e===void 0)throw new Error("array is undefined");if(!Array.isArray(e))throw new Error("'array' param is not an array");if(e.length===0)return{value:void 0,array:[]};const i=Bn(e,n);if(r)return{value:e[i],array:e.splice(i,1)};{const s=[...e];return s.splice(i,1),{value:e[i],array:s}}},lr=(e,r=O)=>{const n=[...e];for(let i=n.length-1;i>0;i--){const s=Math.floor(r()*(i+1));[n[i],n[s]]=[n[s],n[i]]}return n},Lt=(e,r,n=$)=>{if(Array.isArray(r)){const i=[];for(const s of e)r.some(o=>n(s,o))||i.push(s);return i}else return e.filter(i=>!n(i,r))},Ff=e=>e.filter(r=>r!==void 0),Bf=(e,r,n)=>{const i=[];let s=n;for(const o of e){const[a,u]=r(o,s);if(a)break;s=u,i.push(o)}return i},Lf=(e,r)=>{if(!Array.isArray(e))throw new TypeError("'data' parameter should be an array");return ur(e,r,"index"),[...e.slice(0,r),...e.slice(r+1)]},Df=(e,r)=>{const n=new Map;for(const i of e){const s=r(i);let o=n.get(s);o||(o=[],n.set(s,o)),o.push(i)}return n},Gf=(e,r)=>{let n=1;if(r<=1){const s=e.length*r;n=Math.round(e.length/s)}else n=r;if(D(n,"positive","amount"),n>e.length-1)throw new Error("Subsample steps exceeds array length");const i=[];for(let s=n-1;s<e.length;s+=n)i.push(e[s]);return i};function Kf(e,r){const n=[];for(let i=0;i<e.length;i+=r)n.push(e.slice(i,i+r));return n}var Jf=(e,r,...n)=>{const i=new Map;for(const s of n)for(const o of s){if(o===void 0)continue;const a=e(o);let u=i.get(a);u=u?r(u,o):o,i.set(a,u)}return[...i.values()]},Uf=(e,r,n)=>{if(dt(e,"arr"),e.length<2)return n;for(let i=0;i<e.length-1;i++)n=r(n,e[i],e[i+1]);return n},Hf=(e,r)=>{const n=[],i=[];for(const s of e)r(s)?n.push(s):i.push(s);return[n,i]},Zs=(e,r=$)=>{const n=[];for(const i of e)if(Array.isArray(i))for(const s of dn(n,i,r))n.push(s);else return[...dn([],e,r)];return n},Wf=(e,r=Ke)=>{if(!Array.isArray(e))throw new Error("Parameter needs to be an array");try{const n=Ts(e,r)}catch{return!0}return!1},Ys=e=>{if(!Array.isArray(e))throw new Error("Parameter needs to be an array");for(let r=0;r<e.length;r++)for(let n=0;n<e.length;n++)if(r!==n&&e[r]===e[n])return!0;return!1},Qf=(e,r,n=$)=>{if(!Array.isArray(e))throw new Error("Parameter 'arrayA' is not actually an array");if(!Array.isArray(r))throw new Error("Parameter 'arrayB' is not actually an array");if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],r[i]))return!1;return!0},Zf=(e,r,n=$)=>{if(!Array.isArray(e))throw new TypeError("Expects haystack parameter to be an array");if(!Array.isArray(r))throw new TypeError("Expects needles parameter to be an array");for(const i of r){let s=!1;for(const o of e)if(n(i,o)){s=!0;break}if(!s)return!1}return!0};function*dn(e,r,n=$){const i=[];for(const s of r)e.find(a=>n(a,s))||i.find(u=>n(u,s))||(i.push(s),yield s)}var Yf=(e,r,n)=>{const i=r.length+n.length,s=e.capacity??i,o=i-s,a=e.discardPolicy??"additions";switch(a){case"additions":return r.length===0?n.slice(0,n.length-o):r.length===e.capacity?r:[...r,...n.slice(0,o-1)];case"newer":{if(o>=r.length)return r.length===0?[...n.slice(0,s-1),n.at(-1)]:n.slice(Math.max(0,n.length-s),Math.min(n.length,s)+1);{const u=Math.max(1,n.length-r.length),l=n.slice(n.length-u,n.length);return[...r.slice(0,Math.min(r.length,s-1)),...l]}}case"older":return[...r,...n].slice(o);default:throw new Error(`Unknown overflow policy ${a}`)}},Xs=(e,r,...n)=>{if(e===void 0)throw new Error("opts parameter undefined");const i=r.length+n.length,s=e.capacity&&i>e.capacity,o=s?Yf(e,r,n):[...r,...n];if(e.capacity&&o.length!==e.capacity&&s)throw new Error(`Bug! Expected return to be at capacity. Return len: ${o.length} capacity: ${e.capacity} opts: ${JSON.stringify(e)}`);if(!e.capacity&&o.length!==i)throw new Error(`Bug! Return length not expected. Return len: ${o.length} expected: ${i} opts: ${JSON.stringify(e)}`);return o},eo=(e,r)=>{if(r.length===0)throw new Error("Queue is empty");return r.slice(1)},yn=(e,r)=>r[0],to=(e,r)=>r.length===0,ro=(e,r)=>e.capacity?r.length>=e.capacity:!1,yt=class{opts;data;eq;constructor(e={},r=[]){if(e===void 0)throw new Error("opts parameter undefined");this.opts=e,this.data=r,this.eq=e.eq??$}clear(){this.data=[]}at(e){if(e>=this.data.length)throw new Error("Index outside bounds of queue");const r=this.data.at(e);if(r===void 0)throw new Error("Index appears to be outside range of queue");return r}toArray(){return[...this.data]}enqueue(...e){return this.data=Xs(this.opts,this.data,...e),this.data.length}dequeue(){const e=yn(this.opts,this.data);if(e!==void 0)return this.data=eo(this.opts,this.data),e}remove(e,r){const n=this.data.length;return this.data=Lt(this.data,e,r??this.eq),this.data.length!==n}removeWhere(e){const r=this.data.length;return this.data=this.data.filter(n=>e(n)),r-this.data.length}get isEmpty(){return to(this.opts,this.data)}get isFull(){return ro(this.opts,this.data)}get length(){return this.data.length}get peek(){return yn(this.opts,this.data)}};function no(e={},...r){return new yt({...e},[...r])}var io=(e,r)=>(n,i)=>{let s=e.get(n);return s!==void 0||(s=r(n,i),e.set(n,s)),s},so=(e,r)=>async(n,i)=>{let s=e.get(n);if(s!==void 0)return s;if(s=await r(n,i),s===void 0)throw new Error("fn returned undefined");return e.set(n,s),s},bt=(e,r="log",n)=>i=>{i===void 0?i="(undefined)":typeof i=="object"&&(i=JSON.stringify(i));const s=n??e;switch(r){case"log":{console.log(`%c${e} ${i}`,`color: ${eh(s)}`);break}case"warn":{console.warn(e,i);break}case"error":{console.error(e,i);break}}},Xg=(e,r=!0,n)=>r?{log:bt(e,"log",n),warn:bt(e,"warn",n),error:bt(e,"error",n)}:{log:i=>{},warn:bt(e,"warn",n),error:bt(e,"error",n)},oo=(e,r={})=>{if(e===void 0||typeof e=="boolean"&&!e)return s=>{};const n=r.category??"",i=r.kind??void 0;return typeof e=="boolean"?s=>{const o=typeof s=="string"?{msg:s}:s,a=o.kind??i,u=o.category??n;let l=o.msg;switch(u&&(l=`[${u}] ${l}`),a){case"error":{console.error(l);break}case"warn":{console.warn(l);break}case"info":{console.info(l);break}default:console.log(l)}}:e},Xf=0,eh=io(new Map,()=>`hsl(${++Xf*137.508},50%,75%)`),Hi=e=>typeof e=="string"?e:e instanceof Error?e.message:e,Ln={};m(Ln,{WithEvents:()=>Eo,cloneState:()=>vn,done:()=>mn,driver:()=>rh,fromList:()=>Eh,fromListBidirectional:()=>Nh,init:()=>zr,isValidTransition:()=>Po,next:()=>$o,normaliseTargets:()=>Mo,possible:()=>Ct,possibleTargets:()=>Kn,reset:()=>pn,to:()=>Vt,validateMachine:()=>No,validateTransition:()=>$r});var th=async(e,r={},n)=>{const i=[],s=r.rank??ht;let o=Array.isArray(e)?e:[e];r.shuffle&&(o=lr(o));for(let a=0;a<o.length;a++){const u=o[a];let l;if(typeof u=="function"?l=await u(n):l=u,l!==void 0&&(i.push(l),i.sort(s)),typeof r.stop<"u"&&r.stop(l,i))break}return r.filter?i.filter(r.filter):i};async function rh(e,r){const n=Array.isArray(r)?{handlers:r}:r,i=oo(n.debug,{category:"StateMachineDriver"}),s=new Map;for(const l of n.handlers){const c=Array.isArray(l.if)?l.if:[l.if];for(const f of c){if(typeof f!="string")throw new TypeError(`Expected single or array of strings for the 'if' field. Got: '${typeof f}'.`);if(s.has(f))throw new Error(`Multiple handlers defined for state '${f}'. There should be at most one.`);s.set(f,l)}}const o={rank:(l,c)=>ht(l.score??0,c.score??0),shuffle:n.shuffleHandlers??!1};let a=zr(e);for(const[l]of s)if(typeof a.machine[l]>"u"&&l!=="__fallback")throw new Error(`StateMachineDriver handler references a state ('${l}') which is not defined on the machine. Therefore this handler will never run.'`);return{reset:()=>{a=pn(a)},getValue:()=>a.value,run:async()=>{i(`Run. State: ${a.value}`);const l=a.value;let c=s.get(l);if(c===void 0&&(i(`  No handler for state '${l}', trying __fallback`),c=s.get("__fallback")),c===void 0){i("  No __fallback handler");return}const f=c.resultChoice==="first"?{...o,stop:y=>y?"reset"in y||"next"in y&&y.next!==void 0:!1}:o,h=await th(c.then,f,a);i(`  In state '${a.value}' results: ${h.length}. Choice: ${c.resultChoice}`);let d;switch(c.resultChoice??"highest"){case"highest":{d=h.at(-1);break}case"first":{d=h[0];break}case"lowest":{d=h.at(0);break}case"random":{d=Mr(h);break}default:throw new Error(`Unknown 'resultChoice' option: ${c.resultChoice}. Expected highest, first, lowest or random`)}return i(`  Chosen result: ${JSON.stringify(d)}`),d&&d.reset?a=pn(a):d&&d.next&&(typeof d.next=="boolean"?a=$o(a):(i(JSON.stringify(h)),a=Vt(a,d.next))),a},to:l=>(a=Vt(a,l),a)}}var nh={};m(nh,{DispatchList:()=>ah,Elapsed:()=>At,RequestResponseMatch:()=>gh,StateMachine:()=>Ln,TaskQueue:()=>wh,backoffGenerator:()=>po,continuously:()=>vo,debounce:()=>lh,delay:()=>hh,delayLoop:()=>yh,everyNth:()=>vh,forEach:()=>wo,forEachAsync:()=>xo,frequencyTimer:()=>be,frequencyTimerSource:()=>lo,hasElapsed:()=>uo,interval:()=>ho,intervalToMs:()=>K,isInterval:()=>bs,msElapsedTimer:()=>he,relativeTimer:()=>Dt,repeat:()=>bo,repeatReduce:()=>xh,retryFunction:()=>mh,retryTask:()=>mo,runOnce:()=>ph,sleep:()=>ue,throttle:()=>ch,ticksElapsedTimer:()=>Dn,timeout:()=>yo,updateOutdated:()=>uh,waitFor:()=>fh});var At={};m(At,{infinity:()=>oh,interval:()=>ih,once:()=>sh,progress:()=>fo,since:()=>co,toString:()=>Gn});function st(e,r){k(It(e,"positive","decimalPlaces"));let n;if(e===0)n=Math.round;else{const i=Math.pow(10,e);n=s=>Math.floor(s*i)/i}return r===void 0?n:n(r)}var ao={};m(ao,{frequencyTimer:()=>be,frequencyTimerSource:()=>lo,hasElapsed:()=>uo,msElapsedTimer:()=>he,relativeTimer:()=>Dt,ticksElapsedTimer:()=>Dn});var re=(e,r=0,n=1)=>{if(Number.isNaN(e))throw new Error("'value' parameter is NaN");if(Number.isNaN(r))throw new Error("'min' parameter is NaN");if(Number.isNaN(n))throw new Error("'max' parameter is NaN");return e<r?r:e>n?n:e},Wi=(e,r)=>{if(!Number.isInteger(e))throw new TypeError(`v parameter must be an integer (${e})`);const n=Array.isArray(r)?r.length:r;if(!Number.isInteger(n))throw new TypeError(`length parameter must be an integer (${n}, ${typeof n})`);return e=Math.round(e),e<0?0:e>=n?n-1:e};function uo(e){const r=Dt(K(e,0),{timer:he()});return()=>r.isDone}var lo=e=>()=>be(e,{timer:he()}),Dt=(e,r={})=>{const n=r.clampValue??!1,i=r.wrapValue??!1;if(n&&i)throw new Error("clampValue and wrapValue cannot both be enabled");let s=1;const o=r.timer??he(),a=()=>{let u=o.elapsed/(e*s);return n?u=re(u):i&&u>=1&&(u=u%1),u};return{mod(u){s=u},get isDone(){return a()>=1},get elapsed(){return a()},reset:()=>{o.reset()}}},be=(e,r={})=>{const n=r.timer??he(),i=e/1e3;let s=1;const o=()=>{const a=n.elapsed*(i*s),u=a-Math.floor(a);if(u<0)throw new Error(`Unexpected cycle fraction less than 0. Elapsed: ${a} f: ${u}`);if(u>1)throw new Error(`Unexpected cycle fraction more than 1. Elapsed: ${a} f: ${u}`);return u};return{mod:a=>{s=a},reset:()=>{n.reset()},get isDone(){return o()>=1},get elapsed(){return o()}}},he=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e},get isDone(){return!1}}},Dn=()=>{let e=0;return{reset:()=>{e=0},get elapsed(){return++e},get isDone(){return!0}}},co=()=>{const e=performance.now();return()=>performance.now()-e},ih=()=>{let e=performance.now();return()=>{const r=performance.now(),n=r-e;return e=r,n}},sh=()=>{const e=Date.now();let r=0;return()=>(r===0&&(r=Date.now()-e),r)},oh=()=>()=>Number.POSITIVE_INFINITY;function fo(e,r={}){const n=K(e);if(!n)throw new Error("duration invalid");const i={...r,timer:he()},s=Dt(n,i);return()=>s.elapsed}var Gn=(e,r=2)=>{let n=0;if(typeof e=="function"){const s=e();return Gn(s)}else typeof e=="number"?n=e:typeof e=="object"&&(n=K(n));let i=K(n);return typeof i>"u"?"(undefined)":i<1e3?`${st(r,i)}ms`:(i/=1e3,i<120?`${i.toFixed(1)}secs`:(i/=60,i<60?`${i.toFixed(2)}mins`:(i/=60,`${i.toFixed(2)}hrs`)))},ah=class{#e;#t=0;#r=Math.floor(Math.random()*100);constructor(){this.#e=[]}isEmpty(){return this.#e.length===0}add(e,r={}){this.#t++;const n=r.once??!1,i={id:this.#r+"-"+this.#t,handler:e,once:n};return this.#e.push(i),i.id}remove(e){const r=this.#e.length;return this.#e=this.#e.filter(n=>n.id!==e),this.#e.length!==r}notify(e){for(const r of this.#e)r.handler(e),r.once&&this.remove(r.id)}clear(){this.#e=[]}},ho=async function*(e,r={}){let n=!1;const i=typeof r=="number"?{fixed:r}:r,s=i.signal,o=i.delay??"before";let a=K(i.fixed)??K(i.minimum,0),u=performance.now();const l=i.minimum?K(i.minimum):void 0,c=async()=>{const h=performance.now()-u;if(typeof l<"u"&&(a=Math.max(0,l-h)),a&&await ue({millis:a,signal:s}),u=performance.now(),s?.aborted)throw new Error(`Signal aborted ${s.reason}`)};Array.isArray(e)&&(e=e.values());const f=typeof e=="object"&&"next"in e&&typeof e.next=="function";try{for(;!n;){if(o==="before"&&await c(),typeof e=="function"){const h=await e();if(typeof h>"u")return;yield h}else if(f){const h=await e.next();if(h.done)return;yield h.value}else throw new Error("produce param does not seem to return a value/Promise and is not a generator?");o==="after"&&await c()}}finally{n=!0}},yo=(e,r)=>{if(e===void 0)throw new Error("callback parameter is undefined");const n=K(r);D(n,"aboveZero","interval");let i,s=0,o=0,a="idle";const u=()=>{s=0,globalThis.clearTimeout(i),a="idle"},l=async(f=r,h)=>new Promise((y,w)=>{s=performance.now();const E=K(f),P=It(E,"aboveZero","altTimeoutMs");if(!P[0]){w(new Error(P[1]));return}switch(a){case"scheduled":{c();break}}a="scheduled",i=globalThis.setTimeout(async()=>{if(a!=="scheduled"){console.warn("Timeout skipping execution since state is not 'scheduled'"),u();return}const z=h??[];o++,a="running",await e(performance.now()-s,...z),a="idle",u(),y()},E)}),c=()=>{a!=="idle"&&u()};return{start:l,cancel:c,get runState(){return a},get startCount(){return o}}},uh=(e,r,n="slow")=>{let i=0,s,o=r;return()=>new Promise(async(a,u)=>{const l=performance.now()-i;if(s===void 0||l>o)try{i=performance.now(),s=await e(l),o=r}catch(c){n==="fast"?(s=void 0,i=0):n==="backoff"&&(o=Math.floor(o*1.2)),u(c);return}a(s)})},vo=(e,r,n={})=>{let i=K(r,0);D(i,"positive","interval");const s=n.fireBeforeWait??!1,o=n.onStartCalled;let a=!1,u="idle",l=0,c=0,f=performance.now(),h=r??0,d=!1,y;const w=()=>{y!==void 0&&(globalThis.clearTimeout(y),y=void 0)},E=C=>{i===0?typeof requestAnimationFrame>"u"?y=globalThis.setTimeout(C,0):(y=void 0,requestAnimationFrame(C)):y=globalThis.setTimeout(C,i)},P=()=>{d||(d=!0,u!=="idle"&&(u="idle",c=0,w()))},z=async()=>{if(u==="idle")return;u="running",l++;const C=e(c++,performance.now()-f),x=typeof C=="object"?await C:C;if(!d){if(u="scheduled",x!==void 0&&!x){P();return}d||E(z)}},A=()=>{if(a)throw new Error("Disposed");if(d=!1,o!==void 0)switch(o(c,performance.now()-f)){case"cancel":{P();return}case"reset":{I();return}case"dispose":{a=!0,P();return}}u==="idle"&&(f=performance.now(),u="scheduled",s?z():E(z))},I=()=>{if(a)throw new Error("Disposed");d=!1,u!=="idle"&&P(),A()};return{start:A,reset:I,cancel:P,get interval(){return h},get runState(){return u},get startCount(){return l},set interval(C){const x=K(C,0);D(x,"positive","interval"),i=x,h=C},get isDisposed(){return a},get elapsedMs(){return performance.now()-f}}},lh=(e,r)=>{const n=yo(e,r);return(...i)=>n.start(void 0,i)},ch=(e,r)=>{let n=0;return async(...i)=>{const s=performance.now()-n;if(s>=r){const o=e(s,...i);typeof o=="object"&&await o,n=performance.now()}}},fh=(e,r,n)=>{let i,s=!1;const o=a=>{i!==void 0&&(window.clearTimeout(i),i=void 0),a?r(a):s=!0,n!==void 0&&n(s)};return i=globalThis.setTimeout(()=>{i=void 0;try{r(`Timeout after ${e}ms`)}finally{n!==void 0&&n(s)}},e),o},hh=async(e,r)=>{const n=typeof r=="number"?{millis:r}:r,i=n.delay??"before";(i==="before"||i==="both")&&await ue(n);const s=Promise.resolve(await e());return(i==="after"||i==="both")&&await ue(n),s};async function*dh(){let e,r=new Promise(s=>e=s),n=0;const i=()=>{e&&e(),r=new Promise(s=>e=s)};try{for(;;)n=globalThis.requestAnimationFrame(i),yield await r}finally{e&&e(),globalThis.cancelAnimationFrame(n)}}async function*yh(e){const r=K(e);if(typeof r>"u")throw new Error("timeout is undefined");if(r<0)throw new Error("Timeout is less than zero");if(r===0)return yield*dh();let n,i=new Promise(a=>n=a),s;const o=()=>{n&&n(),i=new Promise(a=>n=a)};try{for(;;)s=globalThis.setTimeout(o,r),yield await i}finally{n&&n(),s!==void 0&&globalThis.clearTimeout(s),s=void 0}}var vh=(e,r)=>{D(e,"positive","nth");let n=0;return(...i)=>++n===e?(n=0,r&&r(...i),!0):!1},ph=e=>{let r=!1,n=!1;return()=>(r||(r=!0,n=e()),n)};function*po(e={}){const r=e.startAt??1;let n=e.limitAttempts??Number.MAX_SAFE_INTEGER;const i=e.limitValue,s=e.power??1.1;let o=r;for(D(n,"aboveZero","limitAttempts"),g(r,"","startAt"),g(n,"","limitAttempts"),i!==void 0&&g(i,"","limitValue"),g(s,"","power");n>0;){if(i&&o>=i)return;n--,yield o,o+=Math.pow(o,s)}}var mh=(e,r={})=>mo({async probe(){const i=await e();return i===void 0?{value:r.taskValueFallback,success:!1}:{value:i,success:!0}}},r),mo=async(e,r={})=>{const n=r.abort,i=oo(r.log),s=r.predelayMs??0,o=co();let a=0;const u=r.startAt??1e3,l=r.limitAttempts??Number.MAX_SAFE_INTEGER,c=po({...r,startAt:u,limitAttempts:l});if(u<=0)throw new Error("Param 'initialValue' must be above zero");if(s>0)try{await ue({millis:s,signal:n})}catch(f){return{success:!1,attempts:a,value:r.taskValueFallback,elapsed:o(),message:Hi(f)}}for(const f of c){a++;const h=await e.probe(a);if(h.success)return{success:h.success,value:h.value,attempts:a,elapsed:o()};if(i({msg:`retry attempts: ${a} t: ${Gn(f)}`}),a>=l)break;try{await ue({millis:f,signal:n})}catch(d){return{success:!1,attempts:a,value:r.taskValueFallback,message:Hi(d),elapsed:o()}}}return{message:`Giving up after ${a} attempts.`,success:!1,attempts:a,value:r.taskValueFallback,elapsed:o()}},gh=class extends Je{timeoutMs;whenUnmatchedResponse;keyRequest;keyResponse;#e=new Map;#t;constructor(e={}){super();if(typeof window>"u"&&(globalThis.window={setTimeout,clearTimeout}),this.timeoutMs=e.timeoutMs??1e3,this.whenUnmatchedResponse=e.whenUnmatchedResponse??"throw",this.#t=vo(()=>this.#r(),this.timeoutMs*2),e.key){if(e.keyRequest)throw new Error("Cannot set 'keyRequest' when 'key' is set ");if(e.keyResponse)throw new Error("Cannot set 'keyResponse' when 'key' is set ");this.keyRequest=e.key,this.keyResponse=e.key}else{if(!e.keyRequest||!e.keyResponse)throw new Error("Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set");this.keyRequest=e.keyRequest,this.keyResponse=e.keyResponse}}#r(){const e=[...this.#e.values()],r=Date.now();for(const n of e)if(n.expiresAt<=r){n.promiseReject&&n.promiseReject("Request timeout");const i=n.callback;i&&setTimeout(()=>{i(!0,"Request timeout")},1),this.fireEvent("completed",{request:n.req,response:"Request timeout",success:!1}),this.#e.delete(n.id)}return this.debugDump(),this.#e.size>0}debugDump(){const e=[...this.#e.values()],r=Date.now();for(const n of e){const i=r-n.expiresAt;console.log(`${n.id} Expires in: ${Math.floor(i/1e3)}s`)}}request(e,r){if(r!==void 0){this.#i(e,r);return}return this.#n(e)}requestAndForget(e){const r=this.keyRequest(e);if(this.#e.has(r))throw new Error(`Already a request pending with id '${r}'`);const n={expiresAt:Date.now()+this.timeoutMs,id:r,req:e};this.#e.set(r,n),this.#t.start()}#n(e){const r=this.keyRequest(e);if(this.#e.has(r))throw new Error(`Already a request pending with id '${r}'`);return new Promise((i,s)=>{const o={expiresAt:Date.now()+this.timeoutMs,id:r,req:e,promiseResolve:i,promiseReject:s};this.#e.set(r,o),this.#t.start()})}#i(e,r){const n=this.keyRequest(e);if(this.#e.has(n))throw new Error(`Already a request pending with id '${n}'`);const i={expiresAt:Date.now()+this.timeoutMs,id:n,req:e,callback:r};this.#e.set(n,i),this.#t.start()}response(e,r){const n=this.keyResponse(e),i=this.#e.get(n);if(!i){if(this.whenUnmatchedResponse==="throw")throw new Error(`Unmatched response with id: '${n}'`,{cause:e});return!1}return r?i.expiresAt=Date.now()+this.timeoutMs:this.#e.delete(n),i.promiseResolve&&i.promiseResolve(e),i.callback&&i.callback(!1,e),this.fireEvent("match",{request:i.req,response:e}),r||this.fireEvent("completed",{request:i.req,response:e,success:!0}),!0}},wh=class go{static instance=new go;_timer=0;_queue;_startDelayMs;_intervalMs;constructor(r={}){this._startDelayMs=r.startDelayMs??500,this._intervalMs=r.intervalMs??100,this._queue=no()}add(r){this._queue.enqueue(r),this._timer===0&&this.schedule(this._startDelayMs)}schedule(r){if(this._queue.length===0){this._timer=0;return}this._timer===0&&(this._timer=setTimeout(()=>{this.processQueue()},r))}async processQueue(){const r=this._queue.dequeue();if(this._timer=0,r!==void 0)try{await r(),this._timer=0,this.schedule(this._intervalMs)}catch(n){console.error(n)}}},wo=(e,r)=>{for(const n of e){const i=r(n);if(typeof i=="boolean"&&!i)break}},xo=async function(e,r,n){if(Array.isArray(e))for(const i of e){const s=await r(i);if(n&&await ue(n),typeof s=="boolean"&&!s)break}else for await(const i of e){const s=await r(i);if(n&&await ue(n),typeof s=="boolean"&&!s)break}};function*bo(e,r){let n,i;if(n=i=0,typeof e=="number")for(g(e,"positive","countOrPredicate");e-- >0;){n++;const s=r(n,i);s!==void 0&&(yield s,i++)}else if(typeof e=="function")for(;e(n,i);){n++;const s=r(n,i);s!==void 0&&(yield s,i++)}else throw new TypeError(`countOrPredicate should be a number or function. Got: ${typeof e}`)}var xh=(e,r,n,i)=>{if(typeof e=="number")for(g(e,"positive","countOrPredicate");e-- >0;){const s=r();s!==void 0&&(n=i(n,s))}else{let s,o;for(s=o=0;e(s,o);){s++;const a=r();a!==void 0&&(n=i(n,a),o++)}}return n};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Flow:{StateMachine:Ln,Timer:ao,forEach:wo,forEachAsync:xo,repeat:bo}})}catch{}var Eo=class extends Je{#e;#t;#r;#n=!1;#i=!1;#s=At.infinity();constructor(e,r={}){super();this.#r=r.debug??!1,this.#e=zr(e,r.initial),this.#t=vn(this.#e)}#o(e){this.#i!==e&&(this.#i=e,e?(this.#n=!0,setTimeout(()=>{!this.#n||(this.#n=!1,this.fireEvent("stop",{state:this.#e.value}))},2)):this.#n=!1)}get statesPossible(){return Ct(this.#e)}get statesDefined(){return Object.keys(this.#e.machine)}next(){const e=Ct(this.#e);return e.length===0?null:(this.state=e[0],e[0])}get isDone(){return mn(this.#e)}reset(){this.#o(!1),this.#e=vn(this.#t),this.#s=At.since()}validateTransition(e){$r(this.#e,e)}isValid(e){return Po(this.#e,e)}set state(e){const r=this.#e.value;e!==this.#e.value&&(this.#e=Vt(this.#e,e),this.#r&&console.log(`StateMachine: ${r} -> ${e}`),this.#s=At.since(),setTimeout(()=>{this.fireEvent("change",{newState:e,priorState:r})},1),mn(this.#e)&&this.#o(!0))}get state(){return this.#e.value}get changedAt(){return this.#s()}get elapsed(){return this.#s()}},vn=e=>Object.freeze({value:e.value,visited:[...e.visited],machine:e.machine}),zr=(e,r)=>{const[n,i]=No(e);if(!n)throw new Error(i);const s=r??Object.keys(n.states)[0];if(n.states[s]===void 0)throw new TypeError("Initial state not found");const o=bh(n.states);if(o===void 0)throw new Error("Could not normalise transitions");return Object.freeze({value:s,visited:[],machine:Object.fromEntries(o)})},pn=e=>zr(e.machine),No=e=>e===void 0?[void 0,"Parameter undefined"]:e===null?[void 0,"Parameter null"]:"states"in e?[e,""]:typeof e=="object"?[{states:e},""]:[void 0,`Unexpected type: ${typeof e}. Expected object`],mn=e=>Ct(e).length===0,Kn=e=>{zo(e);const r=e.machine[e.value];return r.length===1&&r[0].state===null?[]:r},Ct=e=>Kn(e).map(n=>n.state),Mo=e=>{const r=n=>{if(n===null)return{state:null};if(typeof n=="string")return{state:n};if(typeof n=="object"&&"state"in n){const i=n.state;if(typeof i!="string")throw new TypeError(`Target 'state' field is not a string. Got: ${typeof i}`);return"preconditions"in n?{state:i,preconditions:n.preconditions}:{state:i}}else throw new Error(`Unexpected type: ${typeof n}. Expected string or object with 'state' field.`)};if(Array.isArray(e)){let n=!1;const i=e.map(s=>{const o=r(s);if(!o)throw new Error("Invalid target");return n=n||o.state===null,o});if(n&&i.length>1)throw new Error("Cannot have null as an possible state");return i}else{const n=r(e);return n?[n]:void 0}},bh=e=>{const r=new Map;for(const[n,i]of Object.entries(e)){if(typeof n>"u")throw new TypeError("Top-level undefined state");if(typeof i>"u")throw new TypeError(`Undefined target state for ${n}`);if(r.has(n))throw new Error(`State defined twice: ${n}`);if(n.includes(" "))throw new Error("State names cannot contain spaces");r.set(n,[])}for(const[n,i]of Object.entries(e)){const s=Mo(i);if(s===void 0)throw new Error("Could not normalise target");if(s!==null){const o=new Set;for(const a of s){if(o.has(a.state))throw new Error(`Target state '${a.state}' already exists for '${n}'`);if(o.add(a.state),a.state!==null&&!r.has(a.state))throw new Error(`Target state '${a.state}' is not defined as a top-level state. Defined under: '${n}'`)}r.set(n,s)}}return r},zo=e=>{if(e===void 0)throw new TypeError("Parameter 'state' is undefined");if(typeof e.value!="string")throw new TypeError("Existing state is not a string")},Vt=(e,r)=>(zo(e),$r(e,r),Object.freeze({value:r,machine:e.machine,visited:Zs([e.visited,[e.value]])})),$o=e=>{const r=Kn(e).at(0);if(!r||r.state===null)throw new Error(`Not possible to move to a next state from '${e.value}`);return Vt(e,r.state)},Po=(e,r)=>{try{return $r(e,r),!0}catch{return!1}},$r=(e,r)=>{if(r===null)throw new Error("Cannot transition to null state");if(r===void 0)throw new Error("Cannot transition to undefined state");if(typeof r!="string")throw new TypeError(`Parameter 'toState' should be a string. Got: ${typeof r}`);const n=Ct(e);if(n.length===0)throw new Error("Machine is in terminal state");if(!n.includes(r))throw new Error(`Target state '${r}' not available at current state '${e.value}'. Possible states: ${n.join(", ")}`)},Eh=(...e)=>{const r={};if(!Array.isArray(e))throw new Error("Expected array of strings");if(e.length<=2)throw new Error("Expects at least two states");for(let n=0;n<e.length;n++){const i=e[n];if(typeof i!="string")throw new TypeError(`Expected array of strings. Got type '${typeof i}' at index ${n}`);r[i]=n===e.length-1?null:e[n+1]}return r},Nh=(...e)=>{const r={};if(!Array.isArray(e))throw new Error("Expected array of strings");if(e.length<2)throw new Error("Expects at least two states");for(const[n,i]of e.entries()){if(typeof i!="string")throw new TypeError(`Expected array of strings. Got type '${typeof i}' at index ${n}`);r[i]=[]}for(let n=0;n<e.length;n++){const i=r[e[n]];n===e.length-1?e.length>1?i.push(e[n-1]):r[e[n]]=null:(i.push(e[n+1]),n>0&&i.push(e[n-1]))}return r},Mh=function(e=.1,r,n,i,s){return r===void 0&&(r=0),n===void 0&&(n=1),i===void 0&&(i=r),g(e,"bipolar","interval"),g(n,"bipolar","end"),g(i,"bipolar","offset"),g(r,"bipolar","start"),So(e,r,n,i,s)},So=function*(e,r,n,i,s){if(r===void 0)throw new Error("Parameter 'lower' is undefined");if(e===void 0)throw new Error("Parameter 'interval' is undefined");if(n===void 0)throw new Error("Parameter 'upper' is undefined");if(s===void 0&&e<=1&&e>=0?s=10/e:s===void 0&&(s=1234),Number.isNaN(e))throw new Error("interval parameter is NaN");if(Number.isNaN(r))throw new Error("lower parameter is NaN");if(Number.isNaN(n))throw new Error("upper parameter is NaN");if(Number.isNaN(i))throw new Error("upper parameter is NaN");if(r>=n)throw new Error("lower must be less than upper");if(e===0)throw new Error("Interval cannot be zero");const o=n-r;if(Math.abs(e)>=o)throw new Error(`Interval should be between -${o} and ${o}`);let a=e>0;if(n=Math.floor(n*s),r=Math.floor(r*s),e=Math.floor(Math.abs(e*s)),e===0)throw new Error(`Interval is zero (rounding: ${s})`);if(i===void 0?i=r:i=Math.floor(i*s),i>n||i<r)throw new Error(`Start (${i/s}) must be within lower (${r/s}) and upper (${n/s})`);let u=i;yield u/s;let l=!0;for(;;)u=u+(a?e:-e),a&&u>=n?(a=!1,u=n,u===n&&l&&(u=r,a=!0)):!a&&u<=r&&(a=!0,u=r,u===r&&l&&(u=n,a=!1)),yield u/s,l=!1},zh={};m(zh,{chunks:()=>kh,chunksOverlapping:()=>Ah,concat:()=>jh,dropWhile:()=>Th,equals:()=>Ih,every:()=>Ch,fill:()=>Vh,filter:()=>_h,find:()=>Oh,first:()=>Sh,flatten:()=>qh,forEach:()=>Rh,last:()=>Ao,map:()=>Fh,max:()=>Bh,min:()=>Lh,range:()=>ko,reduce:()=>Dh,slice:()=>Vs,some:()=>Gh,takeWhile:()=>Kh,unique:()=>Jh,uniqueByValue:()=>$h,yieldNumber:()=>Ph,zip:()=>Uh});function*$h(e,r=Ke,n=new Set){for(const i of e){const s=r(i);n.has(s)||(n.add(s),yield i)}}function Ph(e,r){return()=>{const n=e.next().value;return n===void 0?r:n}}function Sh(e){for(const r of e)return r}function Ao(e){let r;for(const n of e)r=n;return r}function*Ah(e,r){if(r<=1)throw new Error("Size should be at least 2");let n=[];for(const i of e)n.push(i),n.length===r&&(yield n,n=[n.at(-1)]);n.length<=1||n.length>0&&(yield n)}function*kh(e,r){let n=[];for(const i of e)n.push(i),n.length===r&&(yield n,n=[]);n.length>0&&(yield n)}function*jh(...e){for(const r of e)yield*r}function*Th(e,r){for(const n of e)if(!r(n)){yield n;break}yield*e}function Ih(e,r,n){for(;;){const i=e.next(),s=r.next();if(n!==void 0){if(!n(i.value,s.value))return!1}else if(i.value!==s.value)return!1;if(i.done??s.done)return i.done&&s.done}}function Ch(e,r){let n=!0;for(const i of e)n=n&&r(i);return n}function*Vh(e,r){for(const n of e)yield r}function Rh(e,r){for(const n of e)r(n)}function*_h(e,r){for(const n of e)!r(n)||(yield n)}function Oh(e,r){for(const n of e)if(r(n))return n}function*qh(e){for(const r of e)Symbol.iterator in r?yield*r:yield r}function*Fh(e,r){for(const n of e)yield r(n)}function Bh(e,r=(n,i)=>n>i){let n;for(const i of e){if(!n){n=i;continue}n=r(n,i)?n:i}return n}function Lh(e,r=(n,i)=>n>i){let n;for(const i of e){if(!n){n=i;continue}n=r(n,i)?i:n}return n}function*ko(e,r){for(let n=0;n<r;n++)yield e++}function Dh(e,r,n){for(const i of e)n=r(n,i);return n}function Gh(e,r){for(const n of e)if(r(n))return!0;return!1}function*Kh(e,r){for(const n of e){if(!r(n))return;yield n}}function*Jh(e){const r=[];let n=[];n=Array.isArray(e)?e:[e];for(const i of n)for(const s of i)r.includes(s)||(r.push(s),yield s)}function*Uh(...e){const r=e.map(n=>n[Symbol.iterator]());for(;;){const n=r.map(i=>i.next());if(n.some(i=>i.done))return;yield n.map(i=>i.value)}}var Hh={};m(Hh,{arrayElement:()=>Mr,arrayIndex:()=>Bn,defaultRandom:()=>O,float:()=>na,floatSource:()=>Jn,gaussian:()=>Hd,gaussianSource:()=>ta,hue:()=>Jo,integer:()=>ra,integerSource:()=>ei,integerUniqueGen:()=>Yd,minutesMs:()=>Qd,minutesMsSource:()=>ia,secondsMs:()=>Zd,secondsMsSource:()=>sa,shortGuid:()=>Wd,string:()=>Ac,weighted:()=>Jd,weightedIndex:()=>Cs,weightedInteger:()=>Ud,weightedIntegerSource:()=>ea,weightedSource:()=>Xo});var Jn=(e=1)=>{const r=typeof e=="number"?{max:e}:e;let n=r.max,i=r.min??0;const s=r.source??O;if(k(j(i,"","min")),k(j(n,"","max")),!r.min&&n<0&&(i=n,n=0),i>n)throw new Error(`Min is greater than max. Min: ${i} max: ${n}`);return()=>s()*(n-i)+i},Wh={};m(Wh,{getCssVariable:()=>Td,goldenAngleColour:()=>Sd,interpolate:()=>Id,opacity:()=>jd,randomHue:()=>Jo,scale:()=>Cd,toHex:()=>kd,toHsl:()=>Pd,toRgb:()=>Ad});function vt(e,r,n){e.prototype=r.prototype=n,n.constructor=e}function Gt(e,r){var n=Object.create(e.prototype);for(var i in r)n[i]=r[i];return n}function ke(){}var Le=.7,ot=1/Le,Ze="\\s*([+-]?\\d+)\\s*",Rt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",oe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Qh=/^#([0-9a-f]{3,8})$/,Zh=new RegExp(`^rgb\\(${Ze},${Ze},${Ze}\\)$`),Yh=new RegExp(`^rgb\\(${oe},${oe},${oe}\\)$`),Xh=new RegExp(`^rgba\\(${Ze},${Ze},${Ze},${Rt}\\)$`),ed=new RegExp(`^rgba\\(${oe},${oe},${oe},${Rt}\\)$`),td=new RegExp(`^hsl\\(${Rt},${oe},${oe}\\)$`),rd=new RegExp(`^hsla\\(${Rt},${oe},${oe},${Rt}\\)$`),Qi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};vt(ke,at,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Zi,formatHex:Zi,formatHex8:nd,formatHsl:id,formatRgb:Yi,toString:Yi});function Zi(){return this.rgb().formatHex()}function nd(){return this.rgb().formatHex8()}function id(){return jo(this).formatHsl()}function Yi(){return this.rgb().formatRgb()}function at(e){var r,n;return e=(e+"").trim().toLowerCase(),(r=Qh.exec(e))?(n=r[1].length,r=parseInt(r[1],16),n===6?Xi(r):n===3?new B(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):n===8?Yt(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):n===4?Yt(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=Zh.exec(e))?new B(r[1],r[2],r[3],1):(r=Yh.exec(e))?new B(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=Xh.exec(e))?Yt(r[1],r[2],r[3],r[4]):(r=ed.exec(e))?Yt(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=td.exec(e))?rs(r[1],r[2]/100,r[3]/100,1):(r=rd.exec(e))?rs(r[1],r[2]/100,r[3]/100,r[4]):Qi.hasOwnProperty(e)?Xi(Qi[e]):e==="transparent"?new B(NaN,NaN,NaN,0):null}function Xi(e){return new B(e>>16&255,e>>8&255,e&255,1)}function Yt(e,r,n,i){return i<=0&&(e=r=n=NaN),new B(e,r,n,i)}function Un(e){return e instanceof ke||(e=at(e)),e?(e=e.rgb(),new B(e.r,e.g,e.b,e.opacity)):new B}function cr(e,r,n,i){return arguments.length===1?Un(e):new B(e,r,n,i??1)}function B(e,r,n,i){this.r=+e,this.g=+r,this.b=+n,this.opacity=+i}vt(B,cr,Gt(ke,{brighter(e){return e=e==null?ot:Math.pow(ot,e),new B(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Le:Math.pow(Le,e),new B(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new B(Oe(this.r),Oe(this.g),Oe(this.b),fr(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:es,formatHex:es,formatHex8:sd,formatRgb:ts,toString:ts}));function es(){return`#${Re(this.r)}${Re(this.g)}${Re(this.b)}`}function sd(){return`#${Re(this.r)}${Re(this.g)}${Re(this.b)}${Re((isNaN(this.opacity)?1:this.opacity)*255)}`}function ts(){const e=fr(this.opacity);return`${e===1?"rgb(":"rgba("}${Oe(this.r)}, ${Oe(this.g)}, ${Oe(this.b)}${e===1?")":`, ${e})`}`}function fr(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Oe(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Re(e){return e=Oe(e),(e<16?"0":"")+e.toString(16)}function rs(e,r,n,i){return i<=0?e=r=n=NaN:n<=0||n>=1?e=r=NaN:r<=0&&(e=NaN),new te(e,r,n,i)}function jo(e){if(e instanceof te)return new te(e.h,e.s,e.l,e.opacity);if(e instanceof ke||(e=at(e)),!e)return new te;if(e instanceof te)return e;e=e.rgb();var r=e.r/255,n=e.g/255,i=e.b/255,s=Math.min(r,n,i),o=Math.max(r,n,i),a=NaN,u=o-s,l=(o+s)/2;return u?(r===o?a=(n-i)/u+(n<i)*6:n===o?a=(i-r)/u+2:a=(r-n)/u+4,u/=l<.5?o+s:2-o-s,a*=60):u=l>0&&l<1?0:a,new te(a,u,l,e.opacity)}function _t(e,r,n,i){return arguments.length===1?jo(e):new te(e,r,n,i??1)}function te(e,r,n,i){this.h=+e,this.s=+r,this.l=+n,this.opacity=+i}vt(te,_t,Gt(ke,{brighter(e){return e=e==null?ot:Math.pow(ot,e),new te(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Le:Math.pow(Le,e),new te(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*r,s=2*n-i;return new B(Yr(e>=240?e-240:e+120,s,i),Yr(e,s,i),Yr(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new te(ns(this.h),Xt(this.s),Xt(this.l),fr(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=fr(this.opacity);return`${e===1?"hsl(":"hsla("}${ns(this.h)}, ${Xt(this.s)*100}%, ${Xt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ns(e){return e=(e||0)%360,e<0?e+360:e}function Xt(e){return Math.max(0,Math.min(1,e||0))}function Yr(e,r,n){return(e<60?r+(n-r)*e/60:e<180?n:e<240?r+(n-r)*(240-e)/60:r)*255}var To=Math.PI/180,Io=180/Math.PI,hr=18,Co=.96422,Vo=1,Ro=.82521,_o=4/29,Ye=6/29,Oo=3*Ye*Ye,od=Ye*Ye*Ye;function qo(e){if(e instanceof ae)return new ae(e.l,e.a,e.b,e.opacity);if(e instanceof ve)return Fo(e);e instanceof B||(e=Un(e));var r=rn(e.r),n=rn(e.g),i=rn(e.b),s=Xr((.2225045*r+.7168786*n+.0606169*i)/Vo),o,a;return r===n&&n===i?o=a=s:(o=Xr((.4360747*r+.3850649*n+.1430804*i)/Co),a=Xr((.0139322*r+.0971045*n+.7141733*i)/Ro)),new ae(116*s-16,500*(o-s),200*(s-a),e.opacity)}function gn(e,r,n,i){return arguments.length===1?qo(e):new ae(e,r,n,i??1)}function ae(e,r,n,i){this.l=+e,this.a=+r,this.b=+n,this.opacity=+i}vt(ae,gn,Gt(ke,{brighter(e){return new ae(this.l+hr*(e??1),this.a,this.b,this.opacity)},darker(e){return new ae(this.l-hr*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,r=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return r=Co*en(r),e=Vo*en(e),n=Ro*en(n),new B(tn(3.1338561*r-1.6168667*e-.4906146*n),tn(-.9787684*r+1.9161415*e+.033454*n),tn(.0719453*r-.2289914*e+1.4052427*n),this.opacity)}}));function Xr(e){return e>od?Math.pow(e,1/3):e/Oo+_o}function en(e){return e>Ye?e*e*e:Oo*(e-_o)}function tn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function rn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ad(e){if(e instanceof ve)return new ve(e.h,e.c,e.l,e.opacity);if(e instanceof ae||(e=qo(e)),e.a===0&&e.b===0)return new ve(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var r=Math.atan2(e.b,e.a)*Io;return new ve(r<0?r+360:r,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function wn(e,r,n,i){return arguments.length===1?ad(e):new ve(e,r,n,i??1)}function ve(e,r,n,i){this.h=+e,this.c=+r,this.l=+n,this.opacity=+i}function Fo(e){if(isNaN(e.h))return new ae(e.l,0,0,e.opacity);var r=e.h*To;return new ae(e.l,Math.cos(r)*e.c,Math.sin(r)*e.c,e.opacity)}vt(ve,wn,Gt(ke,{brighter(e){return new ve(this.h,this.c,this.l+hr*(e??1),this.opacity)},darker(e){return new ve(this.h,this.c,this.l-hr*(e??1),this.opacity)},rgb(){return Fo(this).rgb()}}));var Bo=-.14861,Hn=1.78277,Wn=-.29227,Pr=-.90649,Ot=1.97294,is=Ot*Pr,ss=Ot*Hn,os=Hn*Wn-Pr*Bo;function ud(e){if(e instanceof qe)return new qe(e.h,e.s,e.l,e.opacity);e instanceof B||(e=Un(e));var r=e.r/255,n=e.g/255,i=e.b/255,s=(os*i+is*r-ss*n)/(os+is-ss),o=i-s,a=(Ot*(n-s)-Wn*o)/Pr,u=Math.sqrt(a*a+o*o)/(Ot*s*(1-s)),l=u?Math.atan2(a,o)*Io-120:NaN;return new qe(l<0?l+360:l,u,s,e.opacity)}function xn(e,r,n,i){return arguments.length===1?ud(e):new qe(e,r,n,i??1)}function qe(e,r,n,i){this.h=+e,this.s=+r,this.l=+n,this.opacity=+i}vt(qe,xn,Gt(ke,{brighter(e){return e=e==null?ot:Math.pow(ot,e),new qe(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Le:Math.pow(Le,e),new qe(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*To,r=+this.l,n=isNaN(this.s)?0:this.s*r*(1-r),i=Math.cos(e),s=Math.sin(e);return new B(255*(r+n*(Bo*i+Hn*s)),255*(r+n*(Wn*i+Pr*s)),255*(r+n*(Ot*i)),this.opacity)}}));var Sr=e=>()=>e;function Lo(e,r){return function(n){return e+n*r}}function ld(e,r,n){return e=Math.pow(e,n),r=Math.pow(r,n)-e,n=1/n,function(i){return Math.pow(e+i*r,n)}}function Qn(e,r){var n=r-e;return n?Lo(e,n>180||n<-180?n-360*Math.round(n/360):n):Sr(isNaN(e)?r:e)}function cd(e){return(e=+e)==1?L:function(r,n){return n-r?ld(r,n,e):Sr(isNaN(r)?n:r)}}function L(e,r){var n=r-e;return n?Lo(e,n):Sr(isNaN(e)?r:e)}var dr=function e(r){var n=cd(r);function i(s,o){var a=n((s=cr(s)).r,(o=cr(o)).r),u=n(s.g,o.g),l=n(s.b,o.b),c=L(s.opacity,o.opacity);return function(f){return s.r=a(f),s.g=u(f),s.b=l(f),s.opacity=c(f),s+""}}return i.gamma=e,i}(1);function fd(e,r){r||(r=[]);var n=e?Math.min(r.length,e.length):0,i=r.slice(),s;return function(o){for(s=0;s<n;++s)i[s]=e[s]*(1-o)+r[s]*o;return i}}function hd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function dd(e,r){var n=r?r.length:0,i=e?Math.min(n,e.length):0,s=new Array(i),o=new Array(n),a;for(a=0;a<i;++a)s[a]=Zn(e[a],r[a]);for(;a<n;++a)o[a]=r[a];return function(u){for(a=0;a<i;++a)o[a]=s[a](u);return o}}function yd(e,r){var n=new Date;return e=+e,r=+r,function(i){return n.setTime(e*(1-i)+r*i),n}}function bn(e,r){return e=+e,r=+r,function(n){return e*(1-n)+r*n}}function vd(e,r){var n={},i={},s;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(s in r)s in e?n[s]=Zn(e[s],r[s]):i[s]=r[s];return function(o){for(s in n)i[s]=n[s](o);return i}}var En=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nn=new RegExp(En.source,"g");function pd(e){return function(){return e}}function md(e){return function(r){return e(r)+""}}function gd(e,r){var n=En.lastIndex=nn.lastIndex=0,i,s,o,a=-1,u=[],l=[];for(e=e+"",r=r+"";(i=En.exec(e))&&(s=nn.exec(r));)(o=s.index)>n&&(o=r.slice(n,o),u[a]?u[a]+=o:u[++a]=o),(i=i[0])===(s=s[0])?u[a]?u[a]+=s:u[++a]=s:(u[++a]=null,l.push({i:a,x:bn(i,s)})),n=nn.lastIndex;return n<r.length&&(o=r.slice(n),u[a]?u[a]+=o:u[++a]=o),u.length<2?l[0]?md(l[0].x):pd(r):(r=l.length,function(c){for(var f=0,h;f<r;++f)u[(h=l[f]).i]=h.x(c);return u.join("")})}function Zn(e,r){var n=typeof r,i;return r==null||n==="boolean"?Sr(r):(n==="number"?bn:n==="string"?(i=at(r))?(r=i,dr):gd:r instanceof at?dr:r instanceof Date?yd:hd(r)?fd:Array.isArray(r)?dd:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?vd:bn)(e,r)}function Do(e){return function(r,n){var i=e((r=_t(r)).h,(n=_t(n)).h),s=L(r.s,n.s),o=L(r.l,n.l),a=L(r.opacity,n.opacity);return function(u){return r.h=i(u),r.s=s(u),r.l=o(u),r.opacity=a(u),r+""}}}var wd=Do(Qn),xd=Do(L);function bd(e,r){var n=L((e=gn(e)).l,(r=gn(r)).l),i=L(e.a,r.a),s=L(e.b,r.b),o=L(e.opacity,r.opacity);return function(a){return e.l=n(a),e.a=i(a),e.b=s(a),e.opacity=o(a),e+""}}function Go(e){return function(r,n){var i=e((r=wn(r)).h,(n=wn(n)).h),s=L(r.c,n.c),o=L(r.l,n.l),a=L(r.opacity,n.opacity);return function(u){return r.h=i(u),r.c=s(u),r.l=o(u),r.opacity=a(u),r+""}}}var Ed=Go(Qn),Nd=Go(L);function Ko(e){return function r(n){n=+n;function i(s,o){var a=e((s=xn(s)).h,(o=xn(o)).h),u=L(s.s,o.s),l=L(s.l,o.l),c=L(s.opacity,o.opacity);return function(f){return s.h=a(f),s.s=u(f),s.l=l(Math.pow(f,n)),s.opacity=c(f),s+""}}return i.gamma=r,i}(1)}var Md=Ko(Qn),zd=Ko(L);function $d(e,r){r===void 0&&(r=e,e=Zn);for(var n=0,i=r.length-1,s=r[0],o=new Array(i<0?0:i);n<i;)o[n]=e(s,s=r[++n]);return function(a){var u=Math.max(0,Math.min(i-1,Math.floor(a*=i)));return o[u](a-u)}}var Pd=e=>{const r=Ar(e);if(r===null)throw new Error(`Could not resolve colour ${e}`);if(Ho(r))return r;if(Wo(r)){const n=_t(r);return r.opacity?{...n,opacity:r.opacity}:n}throw new Error(`Could not resolve colour ${e}`)},Sd=(e,r=.5,n=.75,i=1)=>{g(e,"positive","index"),g(r,"percentage","saturation"),g(n,"percentage","lightness"),g(i,"percentage","alpha");const s=e*137.508;return i===1?`hsl(${s},${r*100}%,${n*100}%)`:`hsl(${s},${r*100}%,${n*100}%,${i*100}%)`},Jo=(e=O)=>e()*360,Ad=e=>{const r=Ar(e),n=r.rgb();return r.opacity<1?{r:n.r,g:n.g,b:n.b,opacity:r.opacity}:{r:n.r,g:n.g,b:n.b}},Ar=e=>{if(typeof e=="string"){const r=at(e);if(r!==null)return r;throw e.startsWith("hsl")&&e.indexOf("%")<=0?new Error(`Could not resolve CSS colour ${e}. HSL values should be in the form: hsl(0, 50%, 50%)`):new Error(`Could not resolve CSS colour ${e}`)}else{if(Ho(e))return _t(e.h,e.s,e.l);if(Wo(e))return cr(e.r,e.g,e.b)}throw new Error(`Could not resolve colour ${JSON.stringify(e)}`)},kd=e=>Ar(e).formatHex(),jd=(e,r)=>{const n=Ar(e);return n.opacity*=r,n.toString()},Td=(e,r="black",n)=>{n===void 0&&(n=document.body);const i=getComputedStyle(n).getPropertyValue(`--${e}`).trim();return i===void 0||i.length===0?r:i},Id=(e,r,n,i)=>{if(g(e,"percentage","amount"),typeof r!="string")throw new Error("Expected string for 'from' param");if(typeof n!="string")throw new Error("Expected string for 'to' param");let s;typeof i>"u"?s={}:typeof i=="string"?s={space:i}:s=i;const o=Uo(s,[r,n]);if(o===void 0)throw new Error("Could not handle colour/space");return o(e)},Uo=(e,r)=>{if(!Array.isArray(r))throw new Error("Expected one or more colours as parameters");let n;if(typeof e>"u"?n={}:typeof e=="string"?n={space:e}:n=e,!Array.isArray(r))throw new Error("Expected array for colours parameter");if(r.length<2)throw new Error("Interpolation expects at least two colours");const{space:i="rgb",long:s=!1}=n;let o;switch(i){case"lab":{o=bd;break}case"hsl":{o=s?xd:wd;break}case"hcl":{o=s?Nd:Ed;break}case"cubehelix":{o=s?zd:Md;break}case"rgb":o=dr;default:o=dr}return n.gamma&&(i==="rgb"||i==="cubehelix")&&(o=o.gamma(n.gamma)),r.length>2?$d(o,r):o(r[0],r[1])},Cd=(e,r,...n)=>{if(g(e,"aboveZero","steps"),!Array.isArray(n))throw new Error("Expected one or more colours as parameters");const i=Uo(r,n);if(i===void 0)throw new Error("Could not handle colour/space");const s=1/(e-1),o=[];let a=0;for(let u=0;u<e;u++)o.push(i(a)),a+=s,a>1&&(a=1);return o},Ho=e=>!(e.h===void 0||e.s===void 0||e.l===void 0),Wo=e=>!(e.r===void 0||e.g===void 0||e.b===void 0),Yn={};m(Yn,{crossfade:()=>Fd,fromCubicBezier:()=>qd,functions:()=>Xn,gaussian:()=>Yo,get:()=>jr,getEasings:()=>Bd,mix:()=>Zo,tick:()=>Od,time:()=>_d,weightedAverage:()=>Kd});var Vd=(e,r=0,n=360)=>(D(e,void 0,"v"),D(r,void 0,"min"),D(n,void 0,"max"),e===r||e===n?r:(e>0&&e<r&&(e+=r),e-=r,n-=r,e=e%n,e<0&&(e=n-Math.abs(e)+r),e+r)),Nn=(e,r=0,n=1)=>{if(g(e,"","min"),g(r,"","min"),g(n,"","max"),e===r||e===n)return r;for(;(e<=r||e>=n)&&!(e===n||e===r);)e>n?e=r+(e-n):e<r&&(e=n-(r-e));return e},ew=(e,r,n,i,s)=>{let o=0;const a=Math.abs(s-i),u=Math.abs(r-i+s),l=Math.abs(i+(360-s)),c=Math.min(a,u,l);return c===l?o=i-n(c):c===u?o=i+n(c):i>s?o=i-n(c):o=i+n(c),Vd(o,e,r)},as=Math.PI*2,kr=(e,r,n)=>(1-e)*r+e*n,tw=(e,r=0,n=1,i=0)=>{let s=i;return(o,a)=>{if(o!==void 0&&(n=o),a!==void 0&&(r=a),s>=1)return n;const u=kr(s,r,n);return s+=e,u}},rw=(e,r=0,n=1)=>{const i=fo(e,{clampValue:!0});return(s,o)=>{const a=i();return s!==void 0&&(n=s),o!==void 0&&(r=o),a>=1?n:kr(a,r,n)}},Rd=(e,r,n)=>{const i=Nn(n-r,0,as);return kr(e,r,r+(i>Math.PI?i-as:i))},St=Math.sqrt,R=Math.pow,us=Math.cos,Ce=Math.PI,Et=Math.sin,_d=function(e,r){return Qo(e,r,he)},Od=function(e,r){return Qo(e,r,Dn)},Qo=function(e,r,n){const i=typeof e=="function"?e:jr(e);if(i===void 0)throw typeof e=="string"?new Error(`Easing function not found: ${e}`):new Error("Easing function not found");const s=Dt(r,{timer:n(),clampValue:!0});let o=1;return{get isDone(){return s.isDone},get runState(){return s.isDone?"idle":"scheduled"},get startCount(){return o},compute:()=>{const a=s.elapsed;return i(a)},reset:()=>{s.reset(),o++}}},qd=(e,r)=>n=>{const i=1-n,s=i*i,o=n*n,a=o*n;return 3*e*s*n+3*r*i*o+a},Zo=(e,r,n,i)=>kr(r,n(e),i(e)),Fd=(e,r,n)=>Zo(e,e,r,n),jr=function(e){if(e===null)throw new Error("easingName is null");if(e===void 0)throw new Error("easingName is undefined");const r=e.toLocaleLowerCase(),n=Object.entries(Xn).find(([i,s])=>i.toLocaleLowerCase()===r);return n===void 0?n:n[1]};function*Bd(){yield*Object.keys(Xn)}var Yo=(e=.4)=>{const r=1/St(2*Ce),n=.5;return i=>{const s=r/e;let o=-2.5,a=(i-n)/e;a*=a,o*=a;const u=s*R(Math.E,o);return u>1?1:u<0?0:u}},er=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},Ld=e=>e*e*e*e*e,Dd=e=>1-R(1-e,5),Gd=e=>e*(1-e)*4,Kd=(e,r,n)=>(e*(n-1)+r)/n,Xn={smoothstep:e=>e*e*(3-2*e),smootherstep:e=>(e*(e*6-15)+10)*e*e*e,arch:Gd,bell:Yo(),sineIn:e=>1-us(e*Ce/2),sineOut:e=>Et(e*Ce/2),quadIn:e=>e*e,quadOut:e=>1-(1-e)*(1-e),sineInOut:e=>-(us(Ce*e)-1)/2,quadInOut:e=>e<.5?2*e*e:1-R(-2*e+2,2)/2,cubicIn:e=>e*e*e,cubicOut:e=>1-R(1-e,3),quartIn:e=>e*e*e*e,quartOut:e=>1-R(1-e,4),quintIn:Ld,quintOut:Dd,expoIn:e=>e===0?0:R(2,10*e-10),expoOut:e=>e===1?1:1-R(2,-10*e),quintInOut:e=>e<.5?16*e*e*e*e*e:1-R(-2*e+2,5)/2,expoInOut:e=>e===0?0:e===1?1:e<.5?R(2,20*e-10)/2:(2-R(2,-20*e+10))/2,circIn:e=>1-St(1-R(e,2)),circOut:e=>St(1-R(e-1,2)),backIn:e=>2.70158*e*e*e-1.70158*e*e,backOut:e=>1+2.70158*R(e-1,3)+1.70158*R(e-1,2),circInOut:e=>e<.5?(1-St(1-R(2*e,2)))/2:(St(1-R(-2*e+2,2))+1)/2,backInOut:e=>{const n=2.5949095;return e<.5?R(2*e,2)*((n+1)*2*e-n)/2:(R(2*e-2,2)*((n+1)*(e*2-2)+n)+2)/2},elasticIn:e=>{const r=2*Ce/3;return e===0?0:e===1?1:-R(2,10*e-10)*Et((e*10-10.75)*r)},elasticOut:e=>{const r=2*Ce/3;return e===0?0:e===1?1:R(2,-10*e)*Et((e*10-.75)*r)+1},bounceIn:e=>1-er(1-e),bounceOut:er,elasticInOut:e=>{const r=2*Ce/4.5;return e===0?0:e===1?1:e<.5?-(R(2,20*e-10)*Et((20*e-11.125)*r))/2:R(2,-20*e+10)*Et((20*e-11.125)*r)/2+1},bounceInOut:e=>e<.5?(1-er(1-2*e))/2:(1+er(2*e-1))/2},Jd=(e="quadIn")=>Xo(e)(),Xo=(e="quadIn")=>{const r=typeof e=="string"?{easing:e}:e,n=r.source??O,i=r.easing??"quadIn",s=jr(i);if(s===void 0)throw new Error(`Easing function '${i}' not found.`);return()=>{const a=n();return s(a)}},ea=e=>{const r=typeof e=="number"?{max:e}:e,n=r.source??O,i=r.max,s=r.min??0,o=r.easing??"quadIn";if(typeof i>"u")throw new Error("max field is undefined");if(typeof o!="string")throw new TypeError("easing field expected to be string");k(j(i));const a=jr(o);if(a===void 0)throw new Error(`Easing '${o}' not found`);if(k(j(s)),i<=s)throw new Error("Max should be greater than min");return()=>{const l=re(a(n()));return Math.floor(l*(i-s))+s}},Ud=e=>ea(e)(),Hd=(e=1)=>ta(e)(),ta=(e=1)=>{const i=()=>{const s=ls(),o=ls();let a=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*o);return a=a/10+.5,a>1||a<0?a=i():(a=Math.pow(a,e),a*=1,a+=0),a};return i},ls=(e=O)=>{let r=0;for(;r===0;)r=e();return r},ei=e=>{if(typeof e>"u")throw new TypeError("maxOrOptions is undefined");const r=typeof e=="number"?{max:e}:e;let n=Math.floor(r.max),i=Math.floor(r.min??0);!r.min&&n<0&&(n=1,i=r.max);const s=r.source??O;if(i>n)throw new Error(`Min value is greater than max (min: ${i} max: ${n})`);if(k(j(i,"","min")),k(j(n,"","max")),n===i)throw new Error(`Max and min values cannot be the same (${n})`);const o=Math.abs(n-i);return()=>Math.floor(s()*o)+i},ra=e=>ei(e)(),na=(e=1)=>Jn(e)(),Wd=(e={})=>{const r=e.source??O,n=Math.trunc(r()*46656),i=Math.trunc(r()*46656),s=`000${n.toString(36)}`.slice(-3),o=`000${i.toString(36)}`.slice(-3);return s+o},ia=e=>{const r=typeof e=="number"?{max:e}:e,n=(r.min??0)*60*1e3,i=r.max*60*1e3;return ei({...r,max:i,min:n})},Qd=e=>ia(e)(),sa=e=>{const r=typeof e=="number"?{max:e}:e,n=(r.min??0)*1e3,i=r.max*1e3;return()=>ra({...r,max:i,min:n})},Zd=e=>sa(e)();function*Yd(e){const r=typeof e=="number"?{max:e}:e,n=r.min??0,i=r.max,s=r.source??O,o=r.loop??!1;if(k(It(n,"","min")),k(It(i,"","max")),n>i)throw new Error(`Min value is greater than max. Min: ${n} Max: ${i}`);const a=[...ko(n,i-n)];let u=lr(a),l=0;for(;;){if(l===u.length)if(o)u=lr(a,s);else return;yield u[l++]}}var oa={};m(oa,{QueueMutable:()=>yt,immutable:()=>Xd,mutable:()=>no,priority:()=>ty});var aa=class Mn{opts;data;constructor(r={},n=[]){if(r===void 0)throw new Error("opts parameter undefined");this.opts=r,this.data=n}forEach(r){for(let n=this.data.length-1;n>=0;n--)r(this.data[n])}forEachFromFront(r){this.data.forEach(r)}enqueue(...r){return new Mn(this.opts,Xs(this.opts,this.data,...r))}dequeue(){return new Mn(this.opts,eo(this.opts,this.data))}get isEmpty(){return to(this.opts,this.data)}get isFull(){return ro(this.opts,this.data)}get length(){return this.data.length}get peek(){return yn(this.opts,this.data)}},Xd=(e={},...r)=>(e={...e},new aa(e,[...r])),ey=class extends yt{constructor(e={}){e.eq===void 0&&(e={...e,eq:(r,n)=>$(r.item,n.item)});super(e)}enqueueWithPriority(e,r){super.enqueue({item:e,priority:r})}changePriority(e,r,n=!1,i){if(e===void 0)throw new Error("Item cannot be undefined");let s;for(const o of this.data)if(i){if(i(o.item,e)){s=o;break}}else if(this.eq(o,{item:e,priority:0})){s=o;break}if(s===void 0&&!n)throw new Error(`Item not found in priority queue. Item: ${JSON.stringify(e)}`);s!==void 0&&this.remove(s),this.enqueueWithPriority(e,r)}dequeueMax(){const e=fn(this.data,r=>r.priority);if(e!==void 0)return this.remove(e),e.item}dequeueMin(){const e=hn(this.data,r=>r.priority);if(e!==void 0)return this.remove(e),e.item}peekMax(){const e=fn(this.data,r=>r.priority);if(e!==void 0)return e.item}peekMin(){const e=hn(this.data,r=>r.priority);if(e!==void 0)return e.item}};function ty(e={}){return new ey(e)}var ry={};m(ry,{getSorter:()=>ny,isPrimitive:()=>Qe,minMaxAvg:()=>iy});function Qe(e){return typeof e=="number"||typeof e=="string"||typeof e=="bigint"||typeof e=="boolean"}var tr=(e,r=!1)=>n=>{const i=n.toSorted((s,o)=>ht(s[e],o[e]));return r?i.reverse():i},ny=e=>{switch(e){case"value":return tr(1,!1);case"value-reverse":return tr(1,!0);case"key":return tr(0,!1);case"key-reverse":return tr(0,!0);default:throw new Error(`Unknown sorting value '${e}'. Expecting: value, value-reverse, key or key-reverse`)}},iy=(e,r)=>{const n=r??(s=>s[1]),i=e.map(s=>n(s));return _s(i)},sy=(e,r,n)=>{const i=r.length+n.length,s=e.discardPolicy??"additions",o=e.capacity??i,a=i-o;switch(e.debug&&console.log(`Stack.push: stackLen: ${r.length} potentialLen: ${i} toRemove: ${a} policy: ${s}`),s){case"additions":return e.debug&&console.log(`Stack.push:DiscardAdditions: stackLen: ${r.length} slice: ${i-o} toAddLen: ${n.length}`),r.length===e.capacity?r:[...r,...n.slice(0,n.length-a)];case"newer":return a>=r.length?n.slice(Math.max(0,n.length-o),Math.min(n.length,o)+1):(e.debug&&console.log(` from orig: ${JSON.stringify(r.slice(0,r.length-a))}`),[...r.slice(0,r.length-a),...n.slice(0,Math.min(n.length,o-a+1))]);case"older":return[...r,...n].slice(a);default:throw new Error(`Unknown discard policy ${s}`)}},ua=(e,r,...n)=>{const i=r.length+n.length;return e.capacity&&i>e.capacity?sy(e,r,n):[...r,...n]},la=(e,r)=>{if(r.length===0)throw new Error("Stack is empty");return r.slice(0,-1)},zn=(e,r)=>r.at(-1),ca=(e,r)=>r.length===0,fa=(e,r)=>e.capacity?r.length>=e.capacity:!1,Tr=class{opts;data;constructor(e={},r=[]){this.opts=e,this.data=r}push(...e){return e.length===0?this.data.length:(this.data=ua(this.opts,this.data,...e),this.data.length)}forEach(e){this.data.forEach(e)}forEachFromTop(e){[...this.data].reverse().forEach(e)}pop(){const e=zn(this.opts,this.data);return this.data=la(this.opts,this.data),e}get isEmpty(){return ca(this.opts,this.data)}get isFull(){return fa(this.opts,this.data)}get peek(){return zn(this.opts,this.data)}get length(){return this.data.length}},oy=(e={},...r)=>new Tr({...e},[...r]),ha={};m(ha,{add:()=>ai,addValue:()=>vr,asDynamicTraversable:()=>ut,breadthFirst:()=>ni,children:()=>cy,childrenLength:()=>py,compare:()=>ay,computeMaxDepth:()=>yy,createNode:()=>Kt,depthFirst:()=>ly,findAnyChildByValue:()=>dy,findChildByValue:()=>hy,followValue:()=>ba,fromPlainObject:()=>ga,getRoot:()=>oi,hasAnyChild:()=>Ir,hasAnyParent:()=>yr,hasChild:()=>ya,hasParent:()=>pa,nodeDepth:()=>fy,parents:()=>si,queryByValue:()=>va,remove:()=>ri,root:()=>Cr,rootWrapped:()=>vy,setChildren:()=>xa,stripParentage:()=>ti,throwTreeTest:()=>da,toStringDeep:()=>ui,treeTest:()=>ii,value:()=>my,wrap:()=>$e});var ay=(e,r,n)=>li(ut(e),ut(r),n),ti=e=>({value:e.value,childrenStore:e.childrenStore.map(n=>ti(n))}),He=e=>"wraps"in e?e.wraps:e,uy=e=>"wraps"in e?e:$e(e),$e=e=>({*children(){for(const r of e.childrenStore)yield $e(r)},getValue:()=>e.value,getIdentity:()=>e,*queryValue(r){for(const n of va(r,He(e)))yield $e(n)},getParent:()=>e.parent===void 0?void 0:$e(e.parent),hasParent:r=>pa(e,He(r)),hasAnyParent:r=>yr(e,He(r)),hasChild:r=>ya(He(r),e),hasAnyChild:r=>Ir(He(r),e),remove:()=>{ri(e)},addValue:r=>{const n=vr(r,e);return $e(n)},add:r=>(ai(He(r),e),uy(r)),wraps:e}),ri=e=>{const r=e.parent;r!==void 0&&(e.parent=void 0,r.childrenStore=Lt(r.childrenStore,e))};function*ly(e){if(!Cr)return;const r=new Tr;r.push(...e.childrenStore);let n=r.pop();for(;n&&(yield n,n&&r.push(...n.childrenStore),!r.isEmpty);)n=r.pop()}function*ni(e){if(!e)return;const r=new yt;r.enqueue(...e.childrenStore);let n=r.dequeue();for(;n&&(yield n,n&&r.enqueue(...n.childrenStore),!r.isEmpty);)n=r.dequeue()}function ii(e,r=[]){if(e.parent===e)return[!1,"Root has itself as parent",e];if(r.includes(e))return[!1,"Same node instance is appearing further in tree",e];if(r.push(e),Ys(e.childrenStore))return[!1,"Children list contains duplicates",e];for(const n of e.childrenStore){if(n.parent!==e)return[!1,"Member of childrenStore does not have .parent set",n];if(Ir(e,n))return[!1,"Child has parent as its own child",n];const i=ii(n,r);if(!i[0])return i}return[!0,"",e]}function da(e){const r=ii(e);if(!r[0])throw new Error(`${r[1]} Node: ${ar(r[2].value,30)}`,{cause:r[2]})}function*cy(e){for(const r of e.childrenStore)yield r}function*si(e){let r=e.parent;for(;r;)yield r,r=r.parent}function fy(e){return[...si(e)].length}var ya=(e,r)=>{for(const n of r.childrenStore)if(n===e)return!0;return!1},hy=(e,r,n=$)=>{for(const i of r.childrenStore)if(n(e,i.value))return i};function*va(e,r,n=$){for(const i of r.childrenStore)n(e,i.value)&&(yield i)}var Ir=(e,r)=>{for(const n of ni(r))if(n===e)return!0;return!1},dy=(e,r,n=$)=>{for(const i of ni(r))if(n(i.value,e))return i},oi=e=>e.parent?oi(e.parent):e,yr=(e,r)=>{for(const n of si(e))if(n===r)return!0;return!1},pa=(e,r)=>e.parent===r,yy=e=>ma(e,0),ma=(e,r=0)=>{let n=r;for(const i of e.childrenStore)n=Math.max(n,ma(i,r+1));return n},ai=(e,r)=>{wa(e,r);const n=e.parent;r.childrenStore=[...r.childrenStore,e],e.parent=r,n&&(n.childrenStore=Lt(n.childrenStore,e))},vr=(e,r)=>Kt(e,r),Cr=e=>Kt(e),ga=(e,r="",n,i=[])=>{const s=Object.entries(e);n=n===void 0?Cr():vr({label:r,value:e},n);for(const o of s){const a=o[1];i.includes(a)||(i.push(a),typeof o[1]=="object"?ga(a,o[0],n,i):vr({label:o[0],value:a},n))}return n},vy=e=>$e(Kt(e)),Kt=(e,r)=>{const n={childrenStore:[],parent:r,value:e};return r!==void 0&&(r.childrenStore=[...r.childrenStore,n]),n},py=e=>e.childrenStore.length,my=e=>e.value,ut=e=>({*children(){for(const n of e.childrenStore)yield ut(n)},getParent(){if(e.parent!==void 0)return ut(e.parent)},getValue(){return e.value},getIdentity(){return e}}),wa=(e,r)=>{if(r===e)throw new Error("Cannot add self as child");if(e.parent!==r){if(yr(r,e))throw new Error("Child contains parent (1)",{cause:e});if(yr(e,r))throw new Error("Parent already contains child",{cause:e});if(Ir(r,e))throw new Error("Child contains parent (2)",{cause:e})}},xa=(e,r)=>{for(const n of r)wa(n,e);e.childrenStore=[...r];for(const n of r)n.parent=e},ui=(e,r=0)=>{const n=`${"  ".repeat(r)} + ${e.value?JSON.stringify(e.value):"-"}`;return e.childrenStore.length>0?n+`
`+e.childrenStore.map(i=>ui(i,r+1)).join(`
`):n};function*ba(e,r,n=1){for(const i of e.childrenStore){const s=i.value;s!==void 0&&r(s,n)&&(yield i.value,yield*ba(i,r,n+1))}}var li=(e,r,n=xs,i)=>{const s=Ea(e,r,n),o=gy(e,r,n),a={valueChanged:!s,a:e,b:r,added:o.added,removed:o.removed,childChanged:!1},u={value:a,childrenStore:[],parent:i},l=o.identical.map(f=>li(f[0],f[1],n,u)),c=cs(a)||l.some(f=>cs(f.value));return xa(u,l),u.toString=()=>Na(u,0),u.value.childChanged=c,da(u),u},cs=e=>e===void 0?!1:!!(e.valueChanged||e.childChanged||e.added.length>0||e.removed.length>0),gy=(e,r,n=xs)=>{const i=[...e.children()],s=[...r.children()],o=[],a=[];for(const l of i){let c=-1;for(const[f,h]of s.entries())if(Ea(l,h,n)){o.push([l,h]),c=f;break}c===-1?a.push(l):s.splice(c,1)}return{added:[...s],identical:o,removed:a}},Ea=(e,r,n)=>!!(e.getIdentity()===r.getIdentity()||n(e.getValue(),r.getValue())),rr=e=>JSON.stringify(e.getValue()),Na=(e,r=0)=>{if(e===void 0)return"(undefined)";let n=wy(e.value,r);for(const i of e.childrenStore)n+=Na(i,r+2);return n},wy=(e,r)=>{const n=" ".repeat(r);if(e===void 0)return`${n}(undefined)`;const i=[];if(i.push(`a: ${rr(e.a)} b: ${rr(e.b)}`),e.valueChanged?i.push(`Value changed. Child changed: ${e.childChanged}`):i.push(`Value unchanged. Child changed: ${e.childChanged}`),e.added.length>0){i.push("Added:");for(const s of e.added)i.push(" - "+rr(s))}if(e.removed.length>0){i.push(`Removed: ${e.removed.length}`);for(const s of e.removed)i.push(" - "+rr(s))}return i.push(`----
`),i.map(s=>n+s).join(`
`)},Ma={};m(Ma,{asDynamicTraversable:()=>ci,children:()=>pt,create:()=>fi,createSimplified:()=>My,createWrapped:()=>Ny,depthFirst:()=>Pa,getByPath:()=>Ey,prettyPrint:()=>za,prettyPrintEntries:()=>xy,toStringDeep:()=>$a,traceByPath:()=>Sa});function xy(e){if(e.length===0)return"(empty)";let r="";for(const[n,i]of e.entries())r+="  ".repeat(n),r+=i.name+" = "+JSON.stringify(i.nodeValue)+`
`;return r}var za=(e,r=0,n={})=>{const i=n.name??"node",s=zy(e,i),o=`${"  ".repeat(r)} + name: ${s.name} value: ${JSON.stringify(s.nodeValue)}`,a=[...pt(e,n)];return a.length>0?o+`
`+a.map(u=>za(u.nodeValue,r+1,{...n,name:u.name})).join(`
`):o},$a=(e,r=0)=>{let n=" ".repeat(r)+" "+e.value?.name;if(e.value!==void 0){if("sourceValue"in e.value&&"nodeValue"in e.value){let i=ar(e.value?.sourceValue,20);const s=ar(e.value?.nodeValue,20);i=i===s?"":"source: "+i,n+=` = ${s} ${i}`}else"value"in e.value&&e.value.value!==void 0&&(n+=` = ${e.value.value}`);"ancestors"in e.value&&(n+=` (ancestors: ${e.value.ancestors.join(", ")})`)}n+=`
`;for(const i of e.childrenStore)n+=$a(i,r+1);return n};function*pt(e,r={}){const n=r.filter??"none",i=s=>n==="none"?[!0,Qe(s)]:n==="leaves"&&Qe(s)?[!0,!0]:n==="branches"&&!Qe(s)?[!0,!1]:[!1,Qe(s)];if(Array.isArray(e))for(const[s,o]of e.entries()){const a=i(o);a[0]&&(yield{name:s.toString(),sourceValue:o,nodeValue:a[1]?o:void 0})}else if(typeof e=="object"){const s="entries"in e?e.entries():Object.entries(e);for(const[o,a]of s){const u=i(a);u[0]&&(yield{name:o,sourceValue:a,nodeValue:u[1]?a:void 0})}}}function*Pa(e,r={},n=[]){for(const i of pt(e,r))yield{...i,ancestors:[...n]},yield*Pa(i.sourceValue,r,[...n,i.name])}function by(e,r){for(const n of pt(r))if(n.name===e)return n}function Ey(e,r,n={}){const i=Ao(Sa(e,r,n));if(!i)throw new Error(`Could not trace path: ${e} `);return i}function*Sa(e,r,n={}){const i=n.separator??".",s=e.split(i),o=[];for(const a of s){const u=by(a,r);if(!u){yield{name:a,sourceValue:void 0,nodeValue:void 0,ancestors:o};return}r=u.sourceValue,yield{...u,ancestors:[...o]},o.push(a)}}var ci=(e,r={},n=[],i)=>{const s=r.name??"object",o={*children(){for(const a of pt(e,r))yield ci(a.sourceValue,{...r,name:a.name},[...n,s],o)},getParent(){return i},getValue(){return{name:s,value:e,ancestors:n}},getIdentity(){return e}};return o},Ny=(e,r)=>$e(fi(e,r)),fi=(e,r={})=>{const i=r.valuesAtLeaves??!1?s=>{if(Qe(s))return s}:s=>s;return Aa(e,i(e),r,[])},Aa=(e,r,n={},i)=>{const s=n.name??"object_ci",o=Cr({name:s,value:r,ancestors:[...i]});i=[...i,s];for(const a of pt(e,n)){const u=n.valuesAtLeaves?a.nodeValue:a.sourceValue;ai(Aa(a.sourceValue,u,{...n,name:a.name},i),o)}return o},My=(e,r={})=>ti(fi(e,r));function zy(e,r=""){return"name"in e&&"nodeValue"in e&&"sourceValue"in e?e:"name"in e?{name:e.name,nodeValue:e,sourceValue:e}:{name:r,nodeValue:e,sourceValue:e}}var ka={};m(ka,{immutable:()=>$y,mutable:()=>ja});var ja=e=>new Ta(e),Ta=class extends Je{store=new Map;keyString;constructor(e){super();this.keyString=e??Bt}get size(){return this.store.size}add(...e){let r=!1;for(const n of e){const i=this.has(n);this.store.set(this.keyString(n),n),super.fireEvent("add",{value:n,updated:i}),i||(r=!0)}return r}values(){return this.store.values()}clear(){this.store.clear(),super.fireEvent("clear",!0)}delete(e){const r=this.store.delete(this.keyString(e));return r&&super.fireEvent("delete",e),r}has(e){return this.store.has(this.keyString(e))}toArray(){return[...this.store.values()]}},Ia=class $n{store;keyString;constructor(r,n){this.store=n??new Map,this.keyString=r??Bt}get size(){return this.store.size}add(...r){const n=new Map(this.store);for(const i of r){const s=this.keyString(i);n.set(s,i)}return new $n(this.keyString,n)}delete(r){const n=new Map(this.store),i=this.keyString(r);return n.delete(i)?new $n(this.keyString,n):this}has(r){const n=this.keyString(r);return this.store.has(n)}toArray(){return[...this.store.values()]}*values(){yield*this.store.values()}},$y=(e=Ke)=>new Ia(e),Ca={};m(Ca,{FromObject:()=>Ma,Mutable:()=>ha,Pathed:()=>Va,Traverse:()=>Ba,compare:()=>li,isTraversable:()=>Ha,isTreeNode:()=>Ua,toTraversable:()=>By});var Va={};m(Va,{addValueByPath:()=>Ra,childrenLengthByPath:()=>Sy,clearValuesByPath:()=>Oa,create:()=>Py,removeByPath:()=>_a,valueByPath:()=>qa,valuesByPath:()=>di});var Py=(e={})=>{let r;return{add:(h,d)=>{const y=Ra(h,d,r,e);r===void 0&&(r=oi(y))},prettyPrint:()=>r===void 0?"(empty)":ui(r),remove:h=>r===void 0?!1:_a(h,r,e),getValue:h=>{if(r!==void 0)return qa(h,r,e)},getValues:h=>r===void 0?[]:di(h,r,e),hasPath:h=>r===void 0?!1:Xe(h,r,e)!==void 0,childrenLength:h=>{if(r===void 0)return 0;const d=Xe(h,r,e);return d===void 0?0:d.childrenStore.length},getNode:h=>r===void 0?void 0:Xe(h,r,e),clearValues:h=>r===void 0?!1:Oa(h,r,e)}},Ra=(e,r,n,i={})=>{const s=i.separator??".",o=i.duplicates??"overwrite",a=r.split(s);let u=0;for(const l of a){const c=u===a.length-1,f=hi(l,n);if(f===void 0)n=Kt({value:c?e:void 0,label:l},n);else if(n=f,c)switch(o){case"ignore":break;case"allow":{const h=Fa(n);n.value={values:[...h,e],label:l};break}case"overwrite":{n.value={value:e,label:l};break}}else n=f;u++}if(n===void 0)throw new Error("Could not create tree");return n},_a=(e,r,n={})=>{if(r===void 0)return!1;const i=Xe(e,r,n);return i===void 0?!1:(ri(i),!0)},Oa=(e,r,n={})=>{if(r===void 0)return!1;const i=Xe(e,r,n);return i===void 0?!1:(i.value={label:i.value?.label??"",value:void 0},!0)},Sy=(e,r,n={})=>{if(r===void 0)return 0;const i=Xe(e,r,n);return i===void 0?0:i.childrenStore.length},hi=(e,r)=>{if(r!==void 0){if(e===void 0)throw new Error("Parameter 'label' cannot be undefined");if(r.value?.label===e)return r;for(const n of r.childrenStore)if(n.value?.label===e)return n}},qa=(e,r,n={})=>{const i=di(e,r,n);if(i.length!==0){if(i.length>1)throw new Error("Multiple values at path. Use getValues instead");return i[0]}},Fa=e=>e.value===void 0?[]:"values"in e.value?e.value.values:"value"in e.value?e.value.value===void 0?[]:[e.value.value]:[],Xe=(e,r,n={})=>{const i=n.separator??".",s=e.split(i);let o=r;for(const a of s)if(o=hi(a,o),o===void 0)return;return o},di=(e,r,n={})=>{const i=n.separator??".",s=e.split(i);let o=r;for(const a of s)if(o=hi(a,o),o===void 0)return[];return Fa(o)},Ba={};m(Ba,{breadthFirst:()=>mt,childrenLength:()=>Ay,couldAddChild:()=>Iy,depthFirst:()=>mi,find:()=>Oy,findAnyChildByValue:()=>_y,findAnyParentByValue:()=>Ty,findByValue:()=>qy,findChildByValue:()=>Ga,findParentByValue:()=>pi,followValue:()=>Ka,hasAnyChild:()=>Pn,hasAnyChildValue:()=>Cy,hasAnyParent:()=>ky,hasAnyParentValue:()=>jy,hasChild:()=>La,hasChildValue:()=>Da,hasParent:()=>yi,hasParentValue:()=>vi,parents:()=>Ry,siblings:()=>Vy,toString:()=>Fy,toStringDeep:()=>Ja});var Ay=e=>[...e.children()].length,ky=(e,r,n)=>yi(e,r,n,Number.MAX_SAFE_INTEGER),jy=(e,r,n)=>vi(e,r,n,Number.MAX_SAFE_INTEGER),Ty=(e,r,n)=>pi(e,r,n,Number.MAX_SAFE_INTEGER),yi=(e,r,n=$,i=0)=>{if(i<0)return!1;const s=e.getParent();return s===void 0?!1:n(s,r)||n(s.getIdentity(),r.getIdentity())?!0:yi(s,r,n,i-1)},vi=(e,r,n=$,i=0)=>{if(i<0)return!1;const s=e.getParent();return s===void 0?!1:n(s.getValue(),r)?!0:vi(s,r,n,i-1)},pi=(e,r,n=$,i=0)=>{if(i<0)return;const s=e.getParent();if(s!==void 0)return n(s.getValue(),r)?s:pi(s,r,n,i-1)},Iy=(e,r,n=$)=>{if(n(e,r))throw new Error("Child equals parent");if(Pn(e,r,n))throw new Error("Circular. Parent already has child");if(Pn(r,e,n))throw new Error("Prospective child has parent as child relation")},Pn=(e,r,n=$)=>La(e,r,n,Number.MAX_SAFE_INTEGER),Cy=(e,r,n=$)=>Da(e,r,n,Number.MAX_SAFE_INTEGER),La=(e,r,n=$,i=0)=>{if(i<0)return!1;if(n(e,r)||n(e.getIdentity(),r.getIdentity()))return!0;for(const s of mt(e,i))if(n(s,r)||n(s.getIdentity(),r.getIdentity()))return!0;return!1},Da=(e,r,n=$,i=0)=>{if(i<0)return!1;if(n(e.getValue(),r))return!0;for(const s of mt(e,i))if(n(s.getValue(),r))return!0;return!1};function*Vy(e){const r=e.getParent();if(r!==void 0)for(const n of r.children())n!==e&&(yield n)}function*Ry(e){let r=e.getParent();for(;r!==void 0;)yield r,r=r.getParent()}var _y=(e,r,n=$)=>Ga(e,r,n,Number.MAX_SAFE_INTEGER),Ga=(e,r,n=$,i=0)=>{if(!(i<0)){if(n(e.getValue(),r))return e;for(const s of mt(e,i))if(n(s.getValue(),r))return s}};function*mi(e){if(!e)return;const r=new Tr;let n=e;for(;n;)r.push(...n.children()),n=r.pop(),n&&(yield n)}function*mt(e,r=Number.MAX_SAFE_INTEGER){if(!e)return;const n=new yt;let i=e;for(;i;){if(r<0)return;for(const s of i.children())yield s,n.enqueue(s);i=n.dequeue(),r--}}function Oy(e,r,n="breadth"){if(r(e))return e;const i=n==="breadth"?mt:mi;for(const s of i(e))if(r(s))return s}function qy(e,r,n="breadth"){if(r(e.getValue()))return e;const i=n==="breadth"?mt:mi;for(const s of i(e))if(r(s.getValue()))return s}function*Ka(e,r,n=1){for(const i of e.children())r(i.getValue(),n)&&(yield i.getValue(),yield*Ka(i,r,n+1))}function Ja(e,r=0){if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=e.getValue();let i=typeof n;Array.isArray(n)&&(i="array");let s="  ".repeat(r)+`value: ${JSON.stringify(n)} (${i})
`;for(const o of e.children())s+=Ja(o,r+1);return s}function Fy(...e){let r="";for(const n of e){const i=n.getValue(),s=ar(i),o=[...n.children()],a=n.getParent();let u=typeof i;Array.isArray(i)&&(u="array"),r+=`value: ${s} (${u}) kids: ${o.length} parented: ${a?"y":"n"}
`}return r}var By=e=>{if(Ha(e))return e;if(Ua(e))return ut(e);if(typeof e=="object")return ci(e);throw new Error("Parameter 'node' not convertible")},Ua=e=>!!("parent"in e&&"childrenStore"in e&&"value"in e&&Array.isArray(e.childrenStore)),Ha=e=>"children"in e&&"getParent"in e&&"getValue"in e&&"getIdentity"in e,Wa={};m(Wa,{ExpiringMap:()=>Qa,MapOfMutableImpl:()=>Vr,MapOfSimpleMutable:()=>$s,NumberMap:()=>Yy,addKeepingExisting:()=>Ss,addObject:()=>cn,deleteByValue:()=>Ef,expiringMap:()=>Ly,filter:()=>js,find:()=>Is,firstEntryByIterablePredicate:()=>Nf,firstEntryByIterableValue:()=>Mf,fromIterable:()=>Ts,fromObject:()=>$f,getClosestIntegerKey:()=>wf,getFromKeys:()=>xf,getOrGenerate:()=>so,getOrGenerateSync:()=>io,hasAnyValue:()=>ks,hasKeyValue:()=>bf,immutable:()=>Ve,mapOfSimpleMutable:()=>Ps,mapToArray:()=>kf,mapToObjectTransform:()=>Pf,mergeByKey:()=>jf,mutable:()=>Wy,ofArrayMutable:()=>Xy,ofCircularMutable:()=>Zy,ofSetMutable:()=>Qy,sortByValue:()=>zf,sortByValueProperty:()=>As,toArray:()=>ln,toObject:()=>Af,transformMap:()=>Sf,zipKeyValue:()=>_n});var Ly=(e={})=>new Qa(e),Qa=class extends Je{capacity;store;evictPolicy;autoDeleteElapsedMs;autoDeletePolicy;constructor(e={}){super();if(this.capacity=e.capacity??-1,D(this.capacity,"nonZero","capacity"),this.store=new Map,e.evictPolicy&&this.capacity<=0)throw new Error("evictPolicy is set, but no capacity limit is set");this.evictPolicy=e.evictPolicy??"none",this.autoDeleteElapsedMs=e.autoDeleteElapsedMs??-1,this.autoDeletePolicy=e.autoDeletePolicy??"none",this.autoDeleteElapsedMs>0&&setInterval(()=>{this.#e()},Math.max(1e3,this.autoDeleteElapsedMs*2))}get keyLength(){return this.store.size}*entries(){for(const e of this.store.entries())yield[e[0],e[1].value]}*values(){for(const e of this.store.values())yield e.value}*keys(){yield*this.store.keys()}elapsedSet(e){const r=this.store.get(e);return r&&Date.now()-r.lastSet}elapsedGet(e){const r=this.store.get(e);return r&&Date.now()-r.lastGet}has(e){return this.store.has(e)}get(e){const r=this.store.get(e);if(r)return r.value}delete(e){const r=this.store.get(e);if(!r)return!1;const n=this.store.delete(e);return this.fireEvent("removed",{key:e,value:r.value}),n}clear(){this.store.clear()}touch(e){const r=this.store.get(e);return r?(this.store.set(e,{...r,lastSet:Date.now(),lastGet:Date.now()}),!0):!1}findEvicteeKey(){if(this.evictPolicy==="none")return;let e="";if(this.evictPolicy==="oldestGet")e="lastGet";else if(this.evictPolicy==="oldestSet")e="lastSet";else throw new Error(`Unknown eviction policy ${this.evictPolicy}`);return As(this.store,e)[0][0]}#e(){this.autoDeletePolicy!=="none"&&this.deleteWithElapsed(this.autoDeleteElapsedMs,this.autoDeletePolicy)}deleteWithElapsed(e,r){const n=[...this.store.entries()],i=[],s=Date.now();for(const o of n){const a=s-o[1].lastGet,u=s-o[1].lastSet;(r==="get"?a:r==="set"?u:Math.max(a,u))>=e&&i.push([o[0],o[1].value])}for(const o of i){this.store.delete(o[0]);const a={key:o[0],value:o[1]};this.fireEvent("expired",a),this.fireEvent("removed",a)}return i}set(e,r){const n=this.store.get(e);if(n){this.store.set(e,{...n,lastSet:performance.now()});return}if(this.keyLength===this.capacity&&this.capacity>0){const i=this.findEvicteeKey();if(!i)throw new Error(`ExpiringMap full (capacity: ${this.capacity})`);const s=this.store.get(i);if(this.store.delete(i),s){const o={key:i,value:s.value};this.fireEvent("expired",o),this.fireEvent("removed",o)}}this.store.set(e,{lastGet:0,lastSet:Date.now(),value:r}),this.fireEvent("newKey",{key:e,value:r})}},Dy={};m(Dy,{Arrays:()=>Er,Iterables:()=>Ws,Maps:()=>Wa,QueueImmutable:()=>aa,QueueMutable:()=>yt,Queues:()=>oa,SetStringImmutable:()=>Ia,SetStringMutable:()=>Ta,Sets:()=>ka,StackImmutable:()=>eu,StackMutable:()=>Tr,Stacks:()=>Xa,Trees:()=>Ca,circularArray:()=>Ya});var Gy=class Za extends Array{#e;#t;constructor(r=0){super();D(r,"positive","capacity"),this.#e=r,this.#t=0}add(r){const n=Za.from(this);return n[this.#t]=r,n.#e=this.#e,this.#e>0?n.#t=this.#t+1===this.#e?0:this.#t+1:n.#t=this.#t+1,n}get pointer(){return this.#t}get isFull(){return this.#e===0?!1:this.length===this.#e}},Ya=e=>new Gy(e),Xa={};m(Xa,{immutable:()=>Ky,mutable:()=>oy});var eu=class Sn{opts;data;constructor(r={},n=[]){this.opts=r,this.data=n}push(...r){return new Sn(this.opts,ua(this.opts,this.data,...r))}pop(){return new Sn(this.opts,la(this.opts,this.data))}forEach(r){this.data.forEach(r)}forEachFromTop(r){[...this.data].reverse().forEach(r)}get isEmpty(){return ca(this.opts,this.data)}get isFull(){return fa(this.opts,this.data)}get peek(){return zn(this.opts,this.data)}get length(){return this.data.length}},Ky=(e={},...r)=>new eu({...e},[...r]),Jy=(e,r)=>{const n=new Map(e.entries());for(const i of r){if(i[0]===void 0)throw new Error("key cannot be undefined");if(i[1]===void 0)throw new Error("value cannot be undefined");n.set(i[0],i[1])}return n},Uy=(e,r)=>{const n=new Map(e.entries());for(const i of r){if(i.key===void 0)throw new Error("key cannot be undefined");if(i.value===void 0)throw new Error("value cannot be undefined");n.set(i.key,i.value)}return n},Hy=(e,r)=>e.has(r),kt=(e,...r)=>{if(e===void 0)throw new Error("map parameter is undefined");if(r===void 0)throw new Error("data parameter i.s undefined");if(r.length===0)return e;const n=r[0];return typeof n.key<"u"&&typeof n.value<"u"?Uy(e,r):Jy(e,r)},tu=(e,r,n)=>{const i=new Map(e.entries());return i.set(r,n),i},ru=(e,r)=>{const n=new Map(e.entries());return n.delete(r),n},Ve=e=>{if(e===void 0)return Ve([]);if(Array.isArray(e))return Ve(kt(new Map,...e));const r=e;return{add:(...n)=>{const i=kt(r,...n);return Ve(i)},set:(n,i)=>{const s=tu(r,n,i);return Ve(s)},get:n=>r.get(n),delete:n=>Ve(ru(r,n)),clear:()=>Ve(),has:n=>r.has(n),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0}},Wy=(...e)=>{let r=kt(new Map,...e);return{add:(...n)=>{r=kt(r,...n)},delete:n=>{r=ru(r,n)},clear:()=>{r=kt(new Map)},set:(n,i)=>{r=tu(r,n,i)},get:n=>r.get(n),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0,has:n=>Hy(r,n)}},Vr=class extends Je{#e=new Map;groupBy;type;constructor(e,r={}){super();this.type=e,this.groupBy=r.groupBy??Ke}get typeName(){return this.type.name}get lengthKeys(){return this.#e.size}get lengthMax(){let e=0;for(const r of this.#e.values())e=Math.max(e,this.type.count(r));return e}debugString(){const e=[...this.#e.keys()];let r=`Keys: ${e.join(", ")}\r
`;for(const n of e){const i=this.#e.get(n);if(i===void 0)r+=` - ${n} (undefined)\r
`;else{const s=this.type.toArray(i);s!==void 0&&(r+=` - ${n} (${this.type.count(i)}) = ${JSON.stringify(s)}\r
`)}}return r}get isEmpty(){return this.#e.size===0}clear(){this.#e.clear(),super.fireEvent("clear",!0)}addKeyedValues(e,...r){const n=this.#e.get(e);n===void 0?(this.#e.set(e,this.type.add(void 0,r)),super.fireEvent("addedKey",{key:e}),super.fireEvent("addedValues",{values:r})):(this.#e.set(e,this.type.add(n,r)),super.fireEvent("addedValues",{values:r}))}set(e,r){return this.addKeyedValues(e,...r),this}addValue(...e){for(const r of e)this.addKeyedValues(this.groupBy(r),r)}hasKeyValue(e,r,n){const i=this.#e.get(e);return i===void 0?!1:this.type.has(i,r,n)}has(e){return this.#e.has(e)}deleteKeyValue(e,r){const n=this.#e.get(e);return n===void 0?!1:this.deleteKeyValueFromMap(n,e,r)}deleteKeyValueFromMap(e,r,n){const i=this.type.count(e),s=this.type.without(e,n),o=s.length;return this.#e.set(r,this.type.add(void 0,s)),i>o}deleteByValue(e){let r=!1;return[...this.#e.keys()].filter(n=>{const i=this.#e.get(n);if(!i)throw new Error("Bug: map could not be accessed");this.deleteKeyValueFromMap(i,n,e)&&(r=!0,this.count(n)===0&&this.delete(n))}),r}delete(e){return this.#e.get(e)===void 0?!1:(this.#e.delete(e),this.fireEvent("deleteKey",{key:e}),!0)}firstKeyByValue(e,r=$){return[...this.#e.keys()].find(s=>{const o=this.#e.get(s);if(o===void 0)throw new Error("Bug: map could not be accessed");return this.type.has(o,e,r)})}count(e){const r=this.#e.get(e);return r===void 0?0:this.type.count(r)}*get(e){const r=this.#e.get(e);r!==void 0&&(yield*this.type.iterable(r))}*valuesFor(e){const r=this.#e.get(e);r!==void 0&&(yield*this.type.iterable(r))}getSource(e){return this.#e.get(e)}*keys(){yield*this.#e.keys()}*entriesFlat(){for(const e of this.#e.entries())for(const r of this.type.iterable(e[1]))yield[e[0],r]}*valuesFlat(){for(const e of this.#e.entries())yield*this.type.iterable(e[1])}*entries(){for(const[e,r]of this.#e.entries()){const n=[...this.type.iterable(r)];yield[e,n]}}*keysAndCounts(){for(const e of this.keys())yield[e,this.count(e)]}merge(e){for(const r of e.keys()){const n=e.get(r);this.addKeyedValues(r,...n)}}get size(){return this.#e.size}get[Symbol.toStringTag](){return this.#e[Symbol.toStringTag]}},Qy=e=>{const r=e?.hash??Ke,n=(o,a)=>r(o)===r(a),i={get name(){return"set"},iterable:o=>o.values(),add:(o,a)=>Ss(o,r,...a),count:o=>o.size,find:(o,a)=>Is(o,a),filter:(o,a)=>js(o,a),toArray:o=>ln(o),has:(o,a)=>ks(o,a,n),without:(o,a)=>Lt(ln(o),a,n)};return new Vr(i,e)},Zy=e=>{const r=$,n={get name(){return"circular"},add:(i,s)=>{i===void 0&&(i=Ya(e.capacity));for(const o of s)i=i.add(o);return i},count:i=>i.length,find:(i,s)=>i.find(s),filter:(i,s)=>i.filter(s),toArray:i=>i,iterable:i=>i.values(),has:(i,s)=>i.find(o=>r(o,s))!==void 0,without:(i,s)=>i.filter(o=>!r(o,s))};return new Vr(n,e)},Yy=class extends Map{defaultValue;constructor(e=0){super();this.defaultValue=e}get(e){const r=super.get(e);return r===void 0?this.defaultValue:r}reset(e){return super.set(e,this.defaultValue),this.defaultValue}multiply(e,r){let i=super.get(e)??this.defaultValue;return i*=r,super.set(e,i),i}add(e,r=1){let i=super.get(e)??this.defaultValue;return i+=r,super.set(e,i),i}subtract(e,r=1){let i=super.get(e)??this.defaultValue;return i-=r,super.set(e,i),i}},Xy=(e={})=>{const r=e.convertToString,n=typeof r>"u"?$:(a,u)=>r(a)===r(u),i=e.comparer??n,s={get name(){return"array"},add:(a,u)=>a===void 0?[...u]:[...a,...u],iterable:a=>a.values(),count:a=>a.length,find:(a,u)=>a.find(l=>u(l)),filter:(a,u)=>a.filter(l=>u(l)),toArray:a=>a,has:(a,u)=>a.some(l=>i(l,u)),without:(a,u)=>a.filter(l=>!i(l,u))};return new Vr(s,e)},ev=class{seenCount;storeIntermediate;resetAfterSamples;sampleLimit;id;debug;constructor(e={}){this.id=e.id??"tracker",this.debug=e.debug??!1,this.sampleLimit=e.sampleLimit??-1,this.resetAfterSamples=e.resetAfterSamples??-1,this.storeIntermediate=e.storeIntermediate??(this.sampleLimit>-1||this.resetAfterSamples>-1),this.seenCount=0,this.debug&&console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`)}reset(){this.seenCount=0,this.onReset()}seen(...e){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples?this.reset():this.sampleLimit>0&&this.seenCount>this.sampleLimit*2&&(this.seenCount=this.trimStore(this.sampleLimit),this.onTrimmed()),this.seenCount+=e.length;const r=this.filterData(e);return this.computeResults(r)}},nw=class{store;gog;constructor(e){this.store=new Map,this.gog=so(this.store,e)}get size(){return this.store.size}has(e){return this.store.has(e)}async seen(e,...r){return(await this.getTrackedValue(e,...r)).seen(...r)}async getTrackedValue(e,...r){if(e===null)throw new Error("id parameter cannot be null");if(e===void 0)throw new Error("id parameter cannot be undefined");return await this.gog(e,r[0])}delete(e){this.store.delete(e)}reset(){this.store=new Map}*ids(){yield*this.store.keys()}*tracked(){yield*this.store.values()}*trackedByAge(){const e=[...this.store.values()];e.sort((r,n)=>{const i=r.elapsed,s=n.elapsed;return i===s?0:i>s?-1:1});for(const r of e)yield r}*valuesByAge(){for(const e of this.trackedByAge())yield e.last}*last(){for(const e of this.store.values())yield e.last}*initialValues(){for(const e of this.store.values())yield e.initial}get(e){return this.store.get(e)}},tv=class extends ev{values;timestamps;constructor(e){super(e);this.values=[],this.timestamps=[]}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.timestamps=this.timestamps.slice(-e),this.values.length)}onTrimmed(){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw new Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(e){const n={value:e.at(-1),at:performance.now()},i=e.map(s=>({at:performance.now(),value:s}));if(this.storeIntermediate)this.values.push(...e),this.timestamps.push(...i.map(s=>s.at));else switch(this.values.length){case 0:{this.values.push(n.value),this.timestamps.push(n.at);break}case 2:{this.values[1]=n.value,this.timestamps[1]=n.at;break}case 1:{this.values.push(n.value),this.timestamps.push(n.at);break}}return i}},rv=class extends tv{total=0;min=Number.MAX_SAFE_INTEGER;max=Number.MIN_SAFE_INTEGER;constructor(e){super(e)}get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.total=0,super.onReset()}onTrimmed(){this.min=qn(this.values),this.max=Ks(this.values),this.total=Js(this.values)}computeResults(e){if(e.some(i=>Number.isNaN(i)))throw new Error("Cannot add NaN");const r=e.map(i=>i.value);return this.total=r.reduce((i,s)=>i+s,this.total),this.min=Math.min(...r,this.min),this.max=Math.max(...r,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}},nv=(e={})=>new rv(e),iv={};m(iv,{Arcs:()=>lc,Beziers:()=>du,Circles:()=>wu,Compound:()=>Bl,Convolve2d:()=>nc,CurveSimplification:()=>Zl,Ellipses:()=>Ql,Grids:()=>Tl,Layouts:()=>$l,Lines:()=>gi,Paths:()=>Tt,Points:()=>p,Polar:()=>qt,QuadTree:()=>Yl,Rects:()=>pu,Scaler:()=>rc,Shapes:()=>Sl,SurfacePoints:()=>mc,Triangles:()=>Be,Vectors:()=>vc,Waypoints:()=>nu,degreeToRadian:()=>Fe,radianToDegree:()=>wi,radiansFromAxisX:()=>sv});var nu={};m(nu,{fromPoints:()=>km,init:()=>zl});var gi={};m(gi,{Empty:()=>mm,Placeholder:()=>gm,angleRadian:()=>bm,apply:()=>ol,asPoints:()=>Pm,bbox:()=>El,distance:()=>ml,divide:()=>ul,extendFromA:()=>zm,fromFlatArray:()=>Sm,fromNumbers:()=>wl,fromPoints:()=>Br,fromPointsToPath:()=>Am,getPointParameter:()=>Fr,guard:()=>qr,interpolate:()=>ce,isEmpty:()=>wm,isEqual:()=>sl,isLine:()=>Ee,isPlaceholder:()=>xm,isPolyLine:()=>il,joinPointsToLines:()=>Lr,length:()=>U,midpoint:()=>hl,multiply:()=>al,nearest:()=>Vi,normaliseByRect:()=>Em,parallel:()=>pl,perpendicularPoint:()=>vl,pointAtX:()=>Mm,pointsOf:()=>$m,relativePosition:()=>Nl,rotate:()=>Ml,scaleFromMidpoint:()=>Nm,slope:()=>Ri,subtract:()=>cl,sum:()=>ll,toFlatArray:()=>xl,toPath:()=>ye,toString:()=>gl,toSvgString:()=>bl,withinRange:()=>fl});var p={};m(p,{Empty:()=>De,Placeholder:()=>Kp,abs:()=>Qp,angle:()=>jt,apply:()=>em,bbox:()=>Ii,centroid:()=>Zu,clamp:()=>ym,clampMagnitude:()=>nl,compare:()=>om,compareByX:()=>tl,convexHull:()=>sm,distance:()=>T,distanceToCenter:()=>Dp,distanceToExterior:()=>Gp,divide:()=>wr,divider:()=>nm,dotProduct:()=>Qu,findMinimum:()=>_e,from:()=>Xp,fromNumbers:()=>Ci,getPointParameter:()=>le,guard:()=>N,guardNonZeroPoint:()=>cu,interpolate:()=>Yp,invert:()=>hm,isEmpty:()=>et,isEqual:()=>me,isNaN:()=>Up,isNull:()=>Jp,isPlaceholder:()=>tt,isPoint:()=>b,isPoint3d:()=>Ae,leftmost:()=>Hp,multiply:()=>Ft,multiplyScalar:()=>rm,normalise:()=>rl,normaliseByRect:()=>In,pipeline:()=>Xu,pipelineApply:()=>tm,progressBetween:()=>pm,project:()=>Tn,quantiseEvery:()=>im,random:()=>cm,reduce:()=>el,relation:()=>vm,rightmost:()=>Wp,rotate:()=>ge,rotatePointArray:()=>am,round:()=>lm,subtract:()=>Y,sum:()=>ft,toArray:()=>Yu,toIntegerValues:()=>dm,toString:()=>gr,withinRange:()=>Zp,wrap:()=>fm});var qt={};m(qt,{clampMagnitude:()=>au,divide:()=>vv,dotProduct:()=>ou,fromCartesian:()=>bi,guard:()=>W,invert:()=>uv,isAntiParallel:()=>fv,isOpposite:()=>lv,isParallel:()=>cv,isPolarCoord:()=>xi,multiply:()=>yv,normalise:()=>su,rotate:()=>iu,rotateDegrees:()=>hv,spiral:()=>av,spiralRaw:()=>dv,toCartesian:()=>Pe,toPoint:()=>lu,toString:()=>uu});function Fe(e){return Array.isArray(e)?e.map(r=>r*(Math.PI/180)):e*(Math.PI/180)}function wi(e){return Array.isArray(e)?e.map(r=>r*180/Math.PI):e*180/Math.PI}var sv=e=>Math.atan2(e.x,e.y),ov=Object.freeze({x:0,y:0}),xi=e=>!(e.distance===void 0||e.angleRadian===void 0),bi=(e,r)=>{e=Y(e,r);const n=Math.atan2(e.y,e.x);return Object.freeze({...e,angleRadian:n,distance:Math.hypot(e.x,e.y)})},Pe=(e,r,n)=>{if(xi(e)){if(r===void 0&&(r=De),b(r))return fs(e.distance,e.angleRadian,r);throw new Error("Expecting (Coord, Point). Second parameter is not a point")}else{if(typeof e=="object")throw new TypeError(`First param is an object, but not a Coord: ${JSON.stringify(e)}`);if(typeof e=="number"&&typeof r=="number"){if(n===void 0&&(n=De),!b(n))throw new Error("Expecting (number, number, Point). Point param wrong type");return fs(e,r,n)}else throw new TypeError(`Expecting parameters of (number, number). Got: (${typeof e}, ${typeof r}, ${typeof n}). a: ${JSON.stringify(e)}`)}};function*av(e,r){let n=0;for(;;){const i=e*n++;yield{distance:r*i,angleRadian:i,step:n}}}var iu=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+r}),su=e=>{if(e.distance===0)throw new Error("Cannot normalise vector of length 0");return Object.freeze({...e,distance:1})},W=(e,r="Point")=>{if(e===void 0)throw new Error(`'${r}' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e===null)throw new Error(`'${r}' is null. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.angleRadian===void 0)throw new Error(`'${r}.angleRadian' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.distance===void 0)throw new Error(`'${r}.distance' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(typeof e.angleRadian!="number")throw new TypeError(`'${r}.angleRadian' must be a number. Got ${e.angleRadian}`);if(typeof e.distance!="number")throw new TypeError(`'${r}.distance' must be a number. Got ${e.distance}`);if(e.angleRadian===null)throw new Error(`'${r}.angleRadian' is null`);if(e.distance===null)throw new Error(`'${r}.distance' is null`);if(Number.isNaN(e.angleRadian))throw new TypeError(`'${r}.angleRadian' is NaN`);if(Number.isNaN(e.distance))throw new Error(`'${r}.distance' is NaN`)},ou=(e,r)=>(W(e,"a"),W(r,"b"),e.distance*r.distance*Math.cos(r.angleRadian-e.angleRadian)),uv=e=>(W(e,"c"),Object.freeze({...e,angleRadian:e.angleRadian-Math.PI})),lv=(e,r)=>(W(e,"a"),W(r,"b"),e.distance!==r.distance?!1:e.angleRadian===-r.angleRadian),cv=(e,r)=>(W(e,"a"),W(r,"b"),e.angleRadian===r.angleRadian),fv=(e,r)=>(W(e,"a"),W(r,"b"),e.angleRadian===-r.angleRadian),hv=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+Fe(r)}),dv=(e,r,n)=>{const i=r*e;return Object.freeze({distance:n*i,angleRadian:i})},yv=(e,r)=>(W(e),g(r,"","amt"),Object.freeze({...e,distance:e.distance*r})),vv=(e,r)=>(W(e),g(r,"","amt"),Object.freeze({...e,distance:e.distance/r})),au=(e,r=1,n=0)=>{let i=e.distance;return i>r&&(i=r),i<n&&(i=n),Object.freeze({...e,distance:i})},fs=(e,r,n=De)=>(N(n),Object.freeze({x:n.x+e*Math.cos(r),y:n.y+e*Math.sin(r)})),uu=(e,r)=>{if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=wi(e.angleRadian),i=r?e.distance.toFixed(r):e.distance,s=r?n.toFixed(r):n;return`(${i},${s})`},lu=(e,r=ov)=>(W(e,"v"),Object.freeze({x:r.x+e.distance*Math.cos(e.angleRadian),y:r.y+e.distance*Math.sin(e.angleRadian)}));function N(e,r="Point"){if(e===void 0)throw new Error(`'${r}' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e===null)throw new Error(`'${r}' is null. Expected {x,y} got ${JSON.stringify(e)}`);if(e.x===void 0)throw new Error(`'${r}.x' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e.y===void 0)throw new Error(`'${r}.y' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(typeof e.x!="number")throw new TypeError(`'${r}.x' must be a number. Got ${e.x}`);if(typeof e.y!="number")throw new TypeError(`'${r}.y' must be a number. Got ${e.y}`);if(e.x===null)throw new Error(`'${r}.x' is null`);if(e.y===null)throw new Error(`'${r}.y' is null`);if(Number.isNaN(e.x))throw new Error(`'${r}.x' is NaN`);if(Number.isNaN(e.y))throw new Error(`'${r}.y' is NaN`)}var cu=(e,r="pt")=>(N(e,r),g(e.x,"nonZero",`${r}.x`),g(e.y,"nonZero",`${r}.y`),typeof e.z<"u"&&g(e.z,"nonZero",`${r}.z`),!0);function b(e){return!(e===void 0||e===null||e.x===void 0||e.y===void 0)}var Ae=e=>!(e===void 0||e===null||e.x===void 0||e.y===void 0||e.z===void 0),et=e=>e.x===0&&e.y===0,tt=e=>Number.isNaN(e.x)&&Number.isNaN(e.y),lt=(e,r="Dimension")=>{if(e===void 0)throw new Error(`${r} is undefined`);if(Number.isNaN(e))throw new Error(`${r} is NaN`);if(e<0)throw new Error(`${r} cannot be negative`)},ie=(e,r="rect")=>{if(e===void 0)throw new Error("{$name} undefined");H(e)&&N(e,r),lt(e.width,r+".width"),lt(e.height,r+".height")},fu=(e,r)=>{if(ie(e),H(e)&&r===void 0)return e;if(r===void 0)throw new Error("Unpositioned rect needs origin parameter");return Object.freeze({...e,...r})},hu=(e,r="rect")=>{if(!H(e))throw new Error(`Expected ${r} to have x,y`);ie(e,r)},iw=e=>Number.isNaN(e.width)&&Number.isNaN(e.height),H=e=>e.x!==void 0&&e.y!==void 0,J=e=>!(e===void 0||e.width===void 0||e.height===void 0),we=e=>J(e)&&H(e);function T(e,r,n,i){const s=le(r,n,i);return N(s,"b"),N(e,"a"),Ae(s)&&Ae(e)?Math.hypot(s.x-e.x,s.y-e.y,s.z-e.z):Math.hypot(s.x-e.x,s.y-e.y)}var pv={};m(pv,{applyToValues:()=>Rp,average:()=>Cp,averageWeighted:()=>Vp,filter:()=>Bp,isApproximately:()=>Lp,isValid:()=>Hu,linearSpace:()=>Wu,max:()=>Op,min:()=>_p,quantiseEvery:()=>jn,round:()=>st,total:()=>qp,tracker:()=>Fp});var mv={};m(mv,{Easings:()=>Yn,Envelopes:()=>Ei,Forces:()=>Ai,Oscillators:()=>Ti,adsr:()=>Si,adsrIterable:()=>Fu,defaultAdsrOpts:()=>qu,jitter:()=>Ip,jitterAbsolute:()=>Tp,perSecond:()=>jp,pingPong:()=>So,pingPongPercent:()=>Mh});var Ei={};m(Ei,{adsr:()=>Si,adsrIterable:()=>Fu,defaultAdsrOpts:()=>qu});var du={};m(du,{computeQuadraticSimple:()=>tp,cubic:()=>rp,isCubicBezier:()=>Ru,isQuadraticBezier:()=>_r,quadratic:()=>Ou,quadraticBend:()=>ep,quadraticSimple:()=>nt,quadraticToSvgString:()=>_u,toPath:()=>sr});var{abs:Nt,cos:de,sin:We,acos:gv,atan2:Mt,sqrt:Me,pow:Z}=Math;function zt(e){return e<0?-Z(-e,1/3):Z(e,1/3)}var yu=Math.PI,nr=2*yu,ze=yu/2,wv=1e-6,sn=Number.MAX_SAFE_INTEGER||9007199254740991,on=Number.MIN_SAFE_INTEGER||-9007199254740991,xv={x:0,y:0,z:0},v={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,r){const n=r(e);let i=n.x*n.x+n.y*n.y;return typeof n.z<"u"&&(i+=n.z*n.z),Me(i)},compute:function(e,r,n){if(e===0)return r[0].t=0,r[0];const i=r.length-1;if(e===1)return r[i].t=1,r[i];const s=1-e;let o=r;if(i===0)return r[0].t=e,r[0];if(i===1){const u={x:s*o[0].x+e*o[1].x,y:s*o[0].y+e*o[1].y,t:e};return n&&(u.z=s*o[0].z+e*o[1].z),u}if(i<4){let u=s*s,l=e*e,c,f,h,d=0;i===2?(o=[o[0],o[1],o[2],xv],c=u,f=s*e*2,h=l):i===3&&(c=u*s,f=u*e*3,h=s*l*3,d=e*l);const y={x:c*o[0].x+f*o[1].x+h*o[2].x+d*o[3].x,y:c*o[0].y+f*o[1].y+h*o[2].y+d*o[3].y,t:e};return n&&(y.z=c*o[0].z+f*o[1].z+h*o[2].z+d*o[3].z),y}const a=JSON.parse(JSON.stringify(r));for(;a.length>1;){for(let u=0;u<a.length-1;u++)a[u]={x:a[u].x+(a[u+1].x-a[u].x)*e,y:a[u].y+(a[u+1].y-a[u].y)*e},typeof a[u].z<"u"&&(a[u].z=a[u].z+(a[u+1].z-a[u].z)*e);a.splice(a.length-1,1)}return a[0].t=e,a[0]},computeWithRatios:function(e,r,n,i){const s=1-e,o=n,a=r;let u=o[0],l=o[1],c=o[2],f=o[3],h;if(u*=s,l*=e,a.length===2)return h=u+l,{x:(u*a[0].x+l*a[1].x)/h,y:(u*a[0].y+l*a[1].y)/h,z:i?(u*a[0].z+l*a[1].z)/h:!1,t:e};if(u*=s,l*=2*s,c*=e*e,a.length===3)return h=u+l+c,{x:(u*a[0].x+l*a[1].x+c*a[2].x)/h,y:(u*a[0].y+l*a[1].y+c*a[2].y)/h,z:i?(u*a[0].z+l*a[1].z+c*a[2].z)/h:!1,t:e};if(u*=s,l*=1.5*s,c*=3*s,f*=e*e*e,a.length===4)return h=u+l+c+f,{x:(u*a[0].x+l*a[1].x+c*a[2].x+f*a[3].x)/h,y:(u*a[0].y+l*a[1].y+c*a[2].y+f*a[3].y)/h,z:i?(u*a[0].z+l*a[1].z+c*a[2].z+f*a[3].z)/h:!1,t:e}},derive:function(e,r){const n=[];for(let i=e,s=i.length,o=s-1;s>1;s--,o--){const a=[];for(let u=0,l;u<o;u++)l={x:o*(i[u+1].x-i[u].x),y:o*(i[u+1].y-i[u].y)},r&&(l.z=o*(i[u+1].z-i[u].z)),a.push(l);n.push(a),i=a}return n},between:function(e,r,n){return r<=e&&e<=n||v.approximately(e,r)||v.approximately(e,n)},approximately:function(e,r,n){return Nt(e-r)<=(n||wv)},length:function(e){const n=v.Tvalues.length;let i=0;for(let s=0,o;s<n;s++)o=.5*v.Tvalues[s]+.5,i+=v.Cvalues[s]*v.arcfn(o,e);return .5*i},map:function(e,r,n,i,s){const o=n-r,a=s-i,u=e-r,l=u/o;return i+a*l},lerp:function(e,r,n){const i={x:r.x+e*(n.x-r.x),y:r.y+e*(n.y-r.y)};return r.z!==void 0&&n.z!==void 0&&(i.z=r.z+e*(n.z-r.z)),i},pointToString:function(e){let r=e.x+"/"+e.y;return typeof e.z<"u"&&(r+="/"+e.z),r},pointsToString:function(e){return"["+e.map(v.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,r,n){const i=r.x-e.x,s=r.y-e.y,o=n.x-e.x,a=n.y-e.y,u=i*a-s*o,l=i*o+s*a;return Mt(u,l)},round:function(e,r){const n=""+e,i=n.indexOf(".");return parseFloat(n.substring(0,i+1+r))},dist:function(e,r){const n=e.x-r.x,i=e.y-r.y;return Me(n*n+i*i)},closest:function(e,r){let n=Z(2,63),i,s;return e.forEach(function(o,a){s=v.dist(r,o),s<n&&(n=s,i=a)}),{mdist:n,mpos:i}},abcratio:function(e,r){if(r!==2&&r!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const n=Z(e,r)+Z(1-e,r),i=n-1;return Nt(i/n)},projectionratio:function(e,r){if(r!==2&&r!==3)return!1;if(typeof e>"u")e=.5;else if(e===0||e===1)return e;const n=Z(1-e,r),i=Z(e,r)+n;return n/i},lli8:function(e,r,n,i,s,o,a,u){const l=(e*i-r*n)*(s-a)-(e-n)*(s*u-o*a),c=(e*i-r*n)*(o-u)-(r-i)*(s*u-o*a),f=(e-n)*(o-u)-(r-i)*(s-a);return f==0?!1:{x:l/f,y:c/f}},lli4:function(e,r,n,i){const s=e.x,o=e.y,a=r.x,u=r.y,l=n.x,c=n.y,f=i.x,h=i.y;return v.lli8(s,o,a,u,l,c,f,h)},lli:function(e,r){return v.lli4(e,e.c,r,r.c)},makeline:function(e,r){return new Rr(e.x,e.y,(e.x+r.x)/2,(e.y+r.y)/2,r.x,r.y)},findbbox:function(e){let r=sn,n=sn,i=on,s=on;return e.forEach(function(o){const a=o.bbox();r>a.x.min&&(r=a.x.min),n>a.y.min&&(n=a.y.min),i<a.x.max&&(i=a.x.max),s<a.y.max&&(s=a.y.max)}),{x:{min:r,mid:(r+i)/2,max:i,size:i-r},y:{min:n,mid:(n+s)/2,max:s,size:s-n}}},shapeintersections:function(e,r,n,i,s){if(!v.bboxoverlap(r,i))return[];const o=[],a=[e.startcap,e.forward,e.back,e.endcap],u=[n.startcap,n.forward,n.back,n.endcap];return a.forEach(function(l){l.virtual||u.forEach(function(c){if(c.virtual)return;const f=l.intersects(c,s);f.length>0&&(f.c1=l,f.c2=c,f.s1=e,f.s2=n,o.push(f))})}),o},makeshape:function(e,r,n){const i=r.points.length,s=e.points.length,o=v.makeline(r.points[i-1],e.points[0]),a=v.makeline(e.points[s-1],r.points[0]),u={startcap:o,forward:e,back:r,endcap:a,bbox:v.findbbox([o,e,r,a])};return u.intersections=function(l){return v.shapeintersections(u,u.bbox,l,l.bbox,n)},u},getminmax:function(e,r,n){if(!n)return{min:0,max:0};let i=sn,s=on,o,a;n.indexOf(0)===-1&&(n=[0].concat(n)),n.indexOf(1)===-1&&n.push(1);for(let u=0,l=n.length;u<l;u++)o=n[u],a=e.get(o),a[r]<i&&(i=a[r]),a[r]>s&&(s=a[r]);return{min:i,mid:(i+s)/2,max:s,size:s-i}},align:function(e,r){const n=r.p1.x,i=r.p1.y,s=-Mt(r.p2.y-i,r.p2.x-n),o=function(a){return{x:(a.x-n)*de(s)-(a.y-i)*We(s),y:(a.x-n)*We(s)+(a.y-i)*de(s)}};return e.map(o)},roots:function(e,r){r=r||{p1:{x:0,y:0},p2:{x:1,y:0}};const n=e.length-1,i=v.align(e,r),s=function(M){return 0<=M&&M<=1};if(n===2){const M=i[0].y,S=i[1].y,G=i[2].y,q=M-2*S+G;if(q!==0){const se=-Me(S*S-M*G),Q=-M+S,Ne=-(se+Q)/q,Ie=-(-se+Q)/q;return[Ne,Ie].filter(s)}else if(S!==G&&q===0)return[(2*S-G)/(2*S-2*G)].filter(s);return[]}const o=i[0].y,a=i[1].y,u=i[2].y,l=i[3].y;let c=-o+3*a-3*u+l,f=3*o-6*a+3*u,h=-3*o+3*a,d=o;if(v.approximately(c,0)){if(v.approximately(f,0))return v.approximately(h,0)?[]:[-d/h].filter(s);const M=Me(h*h-4*f*d),S=2*f;return[(M-h)/S,(-h-M)/S].filter(s)}f/=c,h/=c,d/=c;const y=(3*h-f*f)/3,w=y/3,E=(2*f*f*f-9*f*h+27*d)/27,P=E/2,z=P*P+w*w*w;let A,I,C,x,F;if(z<0){const M=-y/3,S=M*M*M,G=Me(S),q=-E/(2*G),se=q<-1?-1:q>1?1:q,Q=gv(se),Ne=zt(G),Ie=2*Ne;return C=Ie*de(Q/3)-f/3,x=Ie*de((Q+nr)/3)-f/3,F=Ie*de((Q+2*nr)/3)-f/3,[C,x,F].filter(s)}else{if(z===0)return A=P<0?zt(-P):-zt(P),C=2*A-f/3,x=-A-f/3,[C,x].filter(s);{const M=Me(z);return A=zt(-P+M),I=zt(P+M),[A-I-f/3].filter(s)}}},droots:function(e){if(e.length===3){const r=e[0],n=e[1],i=e[2],s=r-2*n+i;if(s!==0){const o=-Me(n*n-r*i),a=-r+n,u=-(o+a)/s,l=-(-o+a)/s;return[u,l]}else if(n!==i&&s===0)return[(2*n-i)/(2*(n-i))];return[]}if(e.length===2){const r=e[0],n=e[1];return r!==n?[r/(r-n)]:[]}return[]},curvature:function(e,r,n,i,s){let o,a,u,l,c=0,f=0;const h=v.compute(e,r),d=v.compute(e,n),y=h.x*h.x+h.y*h.y;if(i?(o=Me(Z(h.y*d.z-d.y*h.z,2)+Z(h.z*d.x-d.z*h.x,2)+Z(h.x*d.y-d.x*h.y,2)),a=Z(y+h.z*h.z,3/2)):(o=h.x*d.y-h.y*d.x,a=Z(y,3/2)),o===0||a===0)return{k:0,r:0};if(c=o/a,f=a/o,!s){const w=v.curvature(e-.001,r,n,i,!0).k,E=v.curvature(e+.001,r,n,i,!0).k;l=(E-c+(c-w))/2,u=(Nt(E-c)+Nt(c-w))/2}return{k:c,r:f,dk:l,adk:u}},inflections:function(e){if(e.length<4)return[];const r=v.align(e,{p1:e[0],p2:e.slice(-1)[0]}),n=r[2].x*r[1].y,i=r[3].x*r[1].y,s=r[1].x*r[2].y,o=r[3].x*r[2].y,a=18*(-3*n+2*i+3*s-o),u=18*(3*n-i-3*s),l=18*(s-n);if(v.approximately(a,0)){if(!v.approximately(u,0)){let d=-l/u;if(0<=d&&d<=1)return[d]}return[]}const c=2*a;if(v.approximately(c,0))return[];const f=u*u-4*a*l;if(f<0)return[];const h=Math.sqrt(f);return[(h-u)/c,-(u+h)/c].filter(function(d){return 0<=d&&d<=1})},bboxoverlap:function(e,r){const n=["x","y"],i=n.length;for(let s=0,o,a,u,l;s<i;s++)if(o=n[s],a=e[o].mid,u=r[o].mid,l=(e[o].size+r[o].size)/2,Nt(a-u)>=l)return!1;return!0},expandbox:function(e,r){r.x.min<e.x.min&&(e.x.min=r.x.min),r.y.min<e.y.min&&(e.y.min=r.y.min),r.z&&r.z.min<e.z.min&&(e.z.min=r.z.min),r.x.max>e.x.max&&(e.x.max=r.x.max),r.y.max>e.y.max&&(e.y.max=r.y.max),r.z&&r.z.max>e.z.max&&(e.z.max=r.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,r,n){const i=e.bbox(),s=r.bbox(),o=1e5,a=n||.5;if(i.x.size+i.y.size<a&&s.x.size+s.y.size<a)return[(o*(e._t1+e._t2)/2|0)/o+"/"+(o*(r._t1+r._t2)/2|0)/o];let u=e.split(.5),l=r.split(.5),c=[{left:u.left,right:l.left},{left:u.left,right:l.right},{left:u.right,right:l.right},{left:u.right,right:l.left}];c=c.filter(function(h){return v.bboxoverlap(h.left.bbox(),h.right.bbox())});let f=[];return c.length===0||(c.forEach(function(h){f=f.concat(v.pairiteration(h.left,h.right,a))}),f=f.filter(function(h,d){return f.indexOf(h)===d})),f},getccenter:function(e,r,n){const i=r.x-e.x,s=r.y-e.y,o=n.x-r.x,a=n.y-r.y,u=i*de(ze)-s*We(ze),l=i*We(ze)+s*de(ze),c=o*de(ze)-a*We(ze),f=o*We(ze)+a*de(ze),h=(e.x+r.x)/2,d=(e.y+r.y)/2,y=(r.x+n.x)/2,w=(r.y+n.y)/2,E=h+u,P=d+l,z=y+c,A=w+f,I=v.lli8(h,d,E,P,y,w,z,A),C=v.dist(I,e);let x=Mt(e.y-I.y,e.x-I.x),F=Mt(r.y-I.y,r.x-I.x),M=Mt(n.y-I.y,n.x-I.x),S;return x<M?((x>F||F>M)&&(x+=nr),x>M&&(S=M,M=x,x=S)):M<F&&F<x?(S=M,M=x,x=S):M+=nr,I.s=x,I.e=M,I.r=C,I},numberSort:function(e,r){return e-r}},an=class vu{constructor(r){this.curves=[],this._3d=!1,r&&(this.curves=r,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(r){return v.pointsToString(r.points)}).join(", ")+"]"}addCurve(r){this.curves.push(r),this._3d=this._3d||r._3d}length(){return this.curves.map(function(r){return r.length()}).reduce(function(r,n){return r+n})}curve(r){return this.curves[r]}bbox(){const r=this.curves;for(var n=r[0].bbox(),i=1;i<r.length;i++)v.expandbox(n,r[i].bbox());return n}offset(r){const n=[];return this.curves.forEach(function(i){n.push(...i.offset(r))}),new vu(n)}},{abs:$t,min:hs,max:ds,cos:bv,sin:Ev,acos:Nv,sqrt:Pt}=Math,Mv=Math.PI,Rr=class V{constructor(r){let n=r&&r.forEach?r:Array.from(arguments).slice(),i=!1;if(typeof n[0]=="object"){i=n.length;const y=[];n.forEach(function(w){["x","y","z"].forEach(function(E){typeof w[E]<"u"&&y.push(w[E])})}),n=y}let s=!1;const o=n.length;if(i){if(i>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");s=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const a=this._3d=!s&&(o===9||o===12)||r&&r[0]&&typeof r[0].z<"u",u=this.points=[];for(let y=0,w=a?3:2;y<o;y+=w){var l={x:n[y],y:n[y+1]};a&&(l.z=n[y+2]),u.push(l)}const c=this.order=u.length-1,f=this.dims=["x","y"];a&&f.push("z"),this.dimlen=f.length;const h=v.align(u,{p1:u[0],p2:u[c]}),d=v.dist(u[0],u[c]);this._linear=h.reduce((y,w)=>y+$t(w.y),0)<d/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(r,n,i,s){if(typeof s>"u"&&(s=.5),s===0)return new V(n,n,i);if(s===1)return new V(r,n,n);const o=V.getABC(2,r,n,i,s);return new V(r,o.A,i)}static cubicFromPoints(r,n,i,s,o){typeof s>"u"&&(s=.5);const a=V.getABC(3,r,n,i,s);typeof o>"u"&&(o=v.dist(n,a.C));const u=o*(1-s)/s,l=v.dist(r,i),c=(i.x-r.x)/l,f=(i.y-r.y)/l,h=o*c,d=o*f,y=u*c,w=u*f,E={x:n.x-h,y:n.y-d},P={x:n.x+y,y:n.y+w},z=a.A,A={x:z.x+(E.x-z.x)/(1-s),y:z.y+(E.y-z.y)/(1-s)},I={x:z.x+(P.x-z.x)/s,y:z.y+(P.y-z.y)/s},C={x:r.x+(A.x-r.x)/s,y:r.y+(A.y-r.y)/s},x={x:i.x+(I.x-i.x)/(1-s),y:i.y+(I.y-i.y)/(1-s)};return new V(r,C,x,i)}static getUtils(){return v}getUtils(){return V.getUtils()}static get PolyBezier(){return an}valueOf(){return this.toString()}toString(){return v.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const r=this.points,n=r[0].x,i=r[0].y,s=["M",n,i,this.order===2?"Q":"C"];for(let o=1,a=r.length;o<a;o++)s.push(r[o].x),s.push(r[o].y);return s.join(" ")}setRatios(r){if(r.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=r,this._lut=[]}verify(){const r=this.coordDigest();r!==this._print&&(this._print=r,this.update())}coordDigest(){return this.points.map(function(r,n){return""+n+r.x+r.y+(r.z?r.z:0)}).join("")}update(){this._lut=[],this.dpoints=v.derive(this.points,this._3d),this.computedirection()}computedirection(){const r=this.points,n=v.angle(r[0],r[this.order],r[1]);this.clockwise=n>0}length(){return v.length(this.derivative.bind(this))}static getABC(r=2,n,i,s,o=.5){const a=v.projectionratio(o,r),u=1-a,l={x:a*n.x+u*s.x,y:a*n.y+u*s.y},c=v.abcratio(o,r);return{A:{x:i.x+(i.x-l.x)/c,y:i.y+(i.y-l.y)/c},B:i,C:l,S:n,E:s}}getABC(r,n){n=n||this.get(r);let i=this.points[0],s=this.points[this.order];return V.getABC(this.order,i,n,s,r)}getLUT(r){if(this.verify(),r=r||100,this._lut.length===r+1)return this._lut;this._lut=[],r++,this._lut=[];for(let n=0,i,s;n<r;n++)s=n/(r-1),i=this.compute(s),i.t=s,this._lut.push(i);return this._lut}on(r,n){n=n||5;const i=this.getLUT(),s=[];for(let o=0,a,u=0;o<i.length;o++)a=i[o],v.dist(a,r)<n&&(s.push(a),u+=o/i.length);return s.length?t/=s.length:!1}project(r){const n=this.getLUT(),i=n.length-1,s=v.closest(n,r),o=s.mpos,a=(o-1)/i,u=(o+1)/i,l=.1/i;let c=s.mdist,f=a,h=f,d;c+=1;for(let y;f<u+l;f+=l)d=this.compute(f),y=v.dist(r,d),y<c&&(c=y,h=f);return h=h<0?0:h>1?1:h,d=this.compute(h),d.t=h,d.d=c,d}get(r){return this.compute(r)}point(r){return this.points[r]}compute(r){return this.ratios?v.computeWithRatios(r,this.points,this.ratios,this._3d):v.compute(r,this.points,this._3d,this.ratios)}raise(){const r=this.points,n=[r[0]],i=r.length;for(let s=1,o,a;s<i;s++)o=r[s],a=r[s-1],n[s]={x:(i-s)/i*o.x+s/i*a.x,y:(i-s)/i*o.y+s/i*a.y};return n[i]=r[i-1],new V(n)}derivative(r){return v.compute(r,this.dpoints[0],this._3d)}dderivative(r){return v.compute(r,this.dpoints[1],this._3d)}align(){let r=this.points;return new V(v.align(r,{p1:r[0],p2:r[r.length-1]}))}curvature(r){return v.curvature(r,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return v.inflections(this.points)}normal(r){return this._3d?this.__normal3(r):this.__normal2(r)}__normal2(r){const n=this.derivative(r),i=Pt(n.x*n.x+n.y*n.y);return{t:r,x:-n.y/i,y:n.x/i}}__normal3(r){const n=this.derivative(r),i=this.derivative(r+.01),s=Pt(n.x*n.x+n.y*n.y+n.z*n.z),o=Pt(i.x*i.x+i.y*i.y+i.z*i.z);n.x/=s,n.y/=s,n.z/=s,i.x/=o,i.y/=o,i.z/=o;const a={x:i.y*n.z-i.z*n.y,y:i.z*n.x-i.x*n.z,z:i.x*n.y-i.y*n.x},u=Pt(a.x*a.x+a.y*a.y+a.z*a.z);a.x/=u,a.y/=u,a.z/=u;const l=[a.x*a.x,a.x*a.y-a.z,a.x*a.z+a.y,a.x*a.y+a.z,a.y*a.y,a.y*a.z-a.x,a.x*a.z-a.y,a.y*a.z+a.x,a.z*a.z];return{t:r,x:l[0]*n.x+l[1]*n.y+l[2]*n.z,y:l[3]*n.x+l[4]*n.y+l[5]*n.z,z:l[6]*n.x+l[7]*n.y+l[8]*n.z}}hull(r){let n=this.points,i=[],s=[],o=0;for(s[o++]=n[0],s[o++]=n[1],s[o++]=n[2],this.order===3&&(s[o++]=n[3]);n.length>1;){i=[];for(let a=0,u,l=n.length-1;a<l;a++)u=v.lerp(r,n[a],n[a+1]),s[o++]=u,i.push(u);n=i}return s}split(r,n){if(r===0&&!!n)return this.split(n).left;if(n===1)return this.split(r).right;const i=this.hull(r),s={left:this.order===2?new V([i[0],i[3],i[5]]):new V([i[0],i[4],i[7],i[9]]),right:this.order===2?new V([i[5],i[4],i[2]]):new V([i[9],i[8],i[6],i[3]]),span:i};return s.left._t1=v.map(0,0,1,this._t1,this._t2),s.left._t2=v.map(r,0,1,this._t1,this._t2),s.right._t1=v.map(r,0,1,this._t1,this._t2),s.right._t2=v.map(1,0,1,this._t1,this._t2),n?(n=v.map(n,r,1,0,1),s.right.split(n).left):s}extrema(){const r={};let n=[];return this.dims.forEach(function(i){let s=function(a){return a[i]},o=this.dpoints[0].map(s);r[i]=v.droots(o),this.order===3&&(o=this.dpoints[1].map(s),r[i]=r[i].concat(v.droots(o))),r[i]=r[i].filter(function(a){return a>=0&&a<=1}),n=n.concat(r[i].sort(v.numberSort))}.bind(this)),r.values=n.sort(v.numberSort).filter(function(i,s){return n.indexOf(i)===s}),r}bbox(){const r=this.extrema(),n={};return this.dims.forEach(function(i){n[i]=v.getminmax(this,i,r[i])}.bind(this)),n}overlaps(r){const n=this.bbox(),i=r.bbox();return v.bboxoverlap(n,i)}offset(r,n){if(typeof n<"u"){const i=this.get(r),s=this.normal(r),o={c:i,n:s,x:i.x+s.x*n,y:i.y+s.y*n};return this._3d&&(o.z=i.z+s.z*n),o}if(this._linear){const i=this.normal(0),s=this.points.map(function(o){const a={x:o.x+r*i.x,y:o.y+r*i.y};return o.z&&i.z&&(a.z=o.z+r*i.z),a});return[new V(s)]}return this.reduce().map(function(i){return i._linear?i.offset(r)[0]:i.scale(r)})}simple(){if(this.order===3){const s=v.angle(this.points[0],this.points[3],this.points[1]),o=v.angle(this.points[0],this.points[3],this.points[2]);if(s>0&&o<0||s<0&&o>0)return!1}const r=this.normal(0),n=this.normal(1);let i=r.x*n.x+r.y*n.y;return this._3d&&(i+=r.z*n.z),$t(Nv(i))<Mv/3}reduce(){let r,n=0,i=0,s=.01,o,a=[],u=[],l=this.extrema().values;for(l.indexOf(0)===-1&&(l=[0].concat(l)),l.indexOf(1)===-1&&l.push(1),n=l[0],r=1;r<l.length;r++)i=l[r],o=this.split(n,i),o._t1=n,o._t2=i,a.push(o),n=i;return a.forEach(function(c){for(n=0,i=0;i<=1;)for(i=n+s;i<=1+s;i+=s)if(o=c.split(n,i),!o.simple()){if(i-=s,$t(n-i)<s)return[];o=c.split(n,i),o._t1=v.map(n,0,1,c._t1,c._t2),o._t2=v.map(i,0,1,c._t1,c._t2),u.push(o),n=i;break}n<1&&(o=c.split(n,1),o._t1=v.map(n,0,1,c._t1,c._t2),o._t2=c._t2,u.push(o))}),u}translate(r,n,i){i=typeof i=="number"?i:n;const s=this.order;let o=this.points.map((a,u)=>(1-u/s)*n+u/s*i);return new V(this.points.map((a,u)=>({x:a.x+r.x*o[u],y:a.y+r.y*o[u]})))}scale(r){const n=this.order;let i=!1;if(typeof r=="function"&&(i=r),i&&n===2)return this.raise().scale(i);const s=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),i?i(0):r,i?i(1):r);const a=i?i(0):r,u=i?i(1):r,l=[this.offset(0,10),this.offset(1,10)],c=[],f=v.lli4(l[0],l[0].c,l[1],l[1].c);if(!f)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(h){const d=c[h*n]=v.copy(o[h*n]);d.x+=(h?u:a)*l[h].n.x,d.y+=(h?u:a)*l[h].n.y}),i?([0,1].forEach(function(h){if(!(n===2&&!!h)){var d=o[h+1],y={x:d.x-f.x,y:d.y-f.y},w=i?i((h+1)/n):r;i&&!s&&(w=-w);var E=Pt(y.x*y.x+y.y*y.y);y.x/=E,y.y/=E,c[h+1]={x:d.x+w*y.x,y:d.y+w*y.y}}}),new V(c)):([0,1].forEach(h=>{if(n===2&&!!h)return;const d=c[h*n],y=this.derivative(h),w={x:d.x+y.x,y:d.y+y.y};c[h+1]=v.lli4(d,w,f,o[h+1])}),new V(c))}outline(r,n,i,s){if(n=n===void 0?r:n,this._linear){const x=this.normal(0),F=this.points[0],M=this.points[this.points.length-1];let S,G,q;i===void 0&&(i=r,s=n),S={x:F.x+x.x*r,y:F.y+x.y*r},q={x:M.x+x.x*i,y:M.y+x.y*i},G={x:(S.x+q.x)/2,y:(S.y+q.y)/2};const se=[S,G,q];S={x:F.x-x.x*n,y:F.y-x.y*n},q={x:M.x-x.x*s,y:M.y-x.y*s},G={x:(S.x+q.x)/2,y:(S.y+q.y)/2};const Q=[q,G,S],Ne=v.makeline(Q[2],se[0]),Ie=v.makeline(se[2],Q[0]),Sc=[Ne,new V(se),Ie,new V(Q)];return new an(Sc)}const o=this.reduce(),a=o.length,u=[];let l=[],c,f=0,h=this.length();const d=typeof i<"u"&&typeof s<"u";function y(x,F,M,S,G){return function(q){const se=S/M,Q=(S+G)/M,Ne=F-x;return v.map(q,0,1,x+se*Ne,x+Q*Ne)}}o.forEach(function(x){const F=x.length();d?(u.push(x.scale(y(r,i,h,f,F))),l.push(x.scale(y(-n,-s,h,f,F)))):(u.push(x.scale(r)),l.push(x.scale(-n))),f+=F}),l=l.map(function(x){return c=x.points,c[3]?x.points=[c[3],c[2],c[1],c[0]]:x.points=[c[2],c[1],c[0]],x}).reverse();const w=u[0].points[0],E=u[a-1].points[u[a-1].points.length-1],P=l[a-1].points[l[a-1].points.length-1],z=l[0].points[0],A=v.makeline(P,w),I=v.makeline(E,z),C=[A].concat(u).concat([I]).concat(l);return new an(C)}outlineshapes(r,n,i){n=n||r;const s=this.outline(r,n).curves,o=[];for(let a=1,u=s.length;a<u/2;a++){const l=v.makeshape(s[a],s[u-a],i);l.startcap.virtual=a>1,l.endcap.virtual=a<u/2-1,o.push(l)}return o}intersects(r,n){return r?r.p1&&r.p2?this.lineIntersects(r):(r instanceof V&&(r=r.reduce()),this.curveintersects(this.reduce(),r,n)):this.selfintersects(n)}lineIntersects(r){const n=hs(r.p1.x,r.p2.x),i=hs(r.p1.y,r.p2.y),s=ds(r.p1.x,r.p2.x),o=ds(r.p1.y,r.p2.y);return v.roots(this.points,r).filter(a=>{var u=this.get(a);return v.between(u.x,n,s)&&v.between(u.y,i,o)})}selfintersects(r){const n=this.reduce(),i=n.length-2,s=[];for(let o=0,a,u,l;o<i;o++)u=n.slice(o,o+1),l=n.slice(o+2),a=this.curveintersects(u,l,r),s.push(...a);return s}curveintersects(r,n,i){const s=[];r.forEach(function(a){n.forEach(function(u){a.overlaps(u)&&s.push({left:a,right:u})})});let o=[];return s.forEach(function(a){const u=v.pairiteration(a.left,a.right,i);u.length>0&&(o=o.concat(u))}),o}arcs(r){return r=r||.5,this._iterate(r,[])}_error(r,n,i,s){const o=(s-i)/4,a=this.get(i+o),u=this.get(s-o),l=v.dist(r,n),c=v.dist(r,a),f=v.dist(r,u);return $t(c-l)+$t(f-l)}_iterate(r,n){let i=0,s=1,o;do{o=0,s=1;let a=this.get(i),u,l,c,f,h=!1,d=!1,y,w=s,E=1;do if(d=h,f=c,w=(i+s)/2,u=this.get(w),l=this.get(s),c=v.getccenter(a,u,l),c.interval={start:i,end:s},h=this._error(c,a,i,s)<=r,y=d&&!h,y||(E=s),h){if(s>=1){if(c.interval.end=E=1,f=c,s>1){let z={x:c.x+c.r*bv(c.e),y:c.y+c.r*Ev(c.e)};c.e+=v.angle({x:c.x,y:c.y},z,this.get(1))}break}s=s+(s-i)/2}else s=w;while(!y&&o++<100);if(o>=100)break;f=f||c,n.push(f),i=E}while(s<1);return n}},pu={};m(pu,{area:()=>Xv,cardinal:()=>zv,center:()=>Pi,clamp:()=>Wv,corners:()=>rt,distanceFromCenter:()=>Cv,distanceFromExterior:()=>$i,edges:()=>mu,empty:()=>Bv,emptyPositioned:()=>Lv,fromCenter:()=>Cu,fromElement:()=>Gv,fromNumbers:()=>Vv,fromTopLeft:()=>Se,getEdgeX:()=>An,getEdgeY:()=>kn,getRectPositionedParameter:()=>Hv,intersectsPoint:()=>Ut,isEqual:()=>Uv,isEqualSize:()=>Kv,isIntersecting:()=>ju,lengths:()=>Zv,maxFromCorners:()=>Vu,multiply:()=>Rv,multiplyScalar:()=>_v,normaliseByRect:()=>Qv,perimeter:()=>Yv,placeholder:()=>Iu,placeholderPositioned:()=>Dv,random:()=>Ov,randomPoint:()=>Tu,subtract:()=>qv,sum:()=>Fv,toArray:()=>Jv});var rt=(e,r)=>{const n=fu(e,r);return[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}]},mu=(e,r)=>{const n=rt(e,r);return Lr(...n,n[0])},An=(e,r)=>{switch(ie(e),r){case"top":return b(e)?e.x:0;case"bottom":return b(e)?e.x:0;case"left":return b(e)?e.y:0;case"right":return b(e)?e.x+e.width:e.width}},kn=(e,r)=>{switch(ie(e),r){case"top":return b(e)?e.y:0;case"bottom":return b(e)?e.y+e.height:e.height;case"left":return b(e)?e.y:0;case"right":return b(e)?e.y:0}},zv=(e,r)=>{const{x:n,y:i,width:s,height:o}=e;switch(r){case"nw":return Object.freeze({x:n,y:i});case"n":return Object.freeze({x:n+s/2,y:i});case"ne":return Object.freeze({x:n+s,y:i});case"sw":return Object.freeze({x:n,y:i+o});case"s":return Object.freeze({x:n+s/2,y:i+o});case"se":return Object.freeze({x:n+s,y:i+o});case"w":return Object.freeze({x:n,y:i+o/2});case"e":return Object.freeze({x:n+s,y:i+o/2});case"center":return Object.freeze({x:n+s/2,y:i+o/2});default:throw new Error(`Unknown direction: ${r}`)}},Jt=(e,r="circle")=>{if(_(e)&&N(e,"circle"),Number.isNaN(e.radius))throw new Error(`${r}.radius is NaN`);if(e.radius<=0)throw new Error(`${r}.radius must be greater than zero`)},pr=(e,r="circle")=>{if(!_(e))throw new Error("Expected a positioned circle with x,y");Jt(e,r)},$v=e=>!!(Number.isNaN(e.radius)||_(e)&&(Number.isNaN(e.x)||Number.isNaN(e.y))),gu=e=>e.x!==void 0&&e.y!==void 0,gt=e=>e.radius!==void 0,_=e=>gt(e)&&gu(e),wu={};m(wu,{area:()=>Av,bbox:()=>zu,center:()=>bu,circumference:()=>Mu,distanceCenter:()=>Ni,distanceFromExterior:()=>Mi,exteriorIntegerPoints:()=>Pv,guard:()=>Jt,guardPositioned:()=>pr,interiorIntegerPoints:()=>Sv,interpolate:()=>Eu,intersectionLine:()=>Tv,isCircle:()=>gt,isCirclePositioned:()=>_,isEqual:()=>$u,isNaN:()=>$v,isPositioned:()=>gu,length:()=>Nu,multiplyScalar:()=>kv,nearest:()=>Au,point:()=>xu,randomPoint:()=>Pu,toPath:()=>jv,toPositioned:()=>zi,toSvg:()=>Su});var Ni=(e,r)=>(pr(e,"a"),_(r)&&pr(r,"b"),T(e,r)),Mi=(e,r)=>{if(pr(e,"a"),_(r))return Math.max(0,Ni(e,r)-e.radius-r.radius);if(b(r)){const n=T(e,r);return n<e.radius?0:n}else throw new Error("Second parameter invalid type")},zi=(e,r,n)=>{if(_(e))return e;const i=p.getPointParameter(r,n);return Object.freeze({...e,...i})};function*Pv(e){const{x:r,y:n,radius:i}=e;let s=i,o=0,a=1-r;for(;s>=o;)yield{x:s+r,y:o+n},yield{x:o+r,y:s+n},yield{x:-s+r,y:o+n},yield{x:-o+r,y:s+n},yield{x:-s+r,y:-o+n},yield{x:-o+r,y:-s+n},yield{x:s+r,y:-o+n},yield{x:o+r,y:-s+n},o++,a<0?a+=2*o+1:(s--,a+=2*(o-s+1))}function*Sv(e){const r=e.x-e.radius,n=e.x+e.radius,i=e.y-e.radius,s=e.y+e.radius;for(let o=r;o<n;o++)for(let a=i;a<s;a++)Math.abs(T(e,o,a))<=e.radius&&(yield{x:o,y:a})}var mr=Math.PI*2,xu=(e,r,n)=>(n===void 0&&(n=_(e)?e:{x:0,y:0}),{x:Math.cos(-r)*e.radius+n.x,y:Math.sin(-r)*e.radius+n.y}),bu=e=>_(e)?Object.freeze({x:e.x,y:e.y}):Object.freeze({x:e.radius,y:e.radius}),Eu=(e,r)=>xu(e,r*mr),Nu=e=>Mu(e),Mu=e=>(Jt(e),mr*e.radius),Av=e=>(Jt(e),Math.PI*e.radius*e.radius),zu=e=>_(e)?Cu(e,e.radius*2,e.radius*2):{width:e.radius*2,height:e.radius*2},$u=(e,r)=>e.radius!==r.radius?!1:_(e)&&_(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):(!_(e)&&!_(r),!1),Pu=(e,r={})=>{const n=_(e)?e:{x:0,y:0},i=r.strategy??"uniform",s=r.randomSource??O;switch(i){case"naive":return p.sum(n,qt.toCartesian(s()*e.radius,s()*mr));case"uniform":return p.sum(n,qt.toCartesian(Math.sqrt(s())*e.radius,s()*mr));default:throw new Error(`Unknown strategy ${i}`)}};function kv(e,r){if(_(e)){const n=p.multiplyScalar(e,r);return Object.freeze({...e,...n,radius:e.radius*r})}else return Object.freeze({...e,radius:e.radius*r})}var Su=(e,r,n)=>{if(gt(e)){if(n!==void 0)return un(e.radius,n,r);if(_(e))return un(e.radius,e,r);throw new Error("origin parameter needed for non-positioned circle")}else{if(n===void 0)throw new Error("origin parameter needed");return un(e,n,r)}},un=(e,r,n)=>{const{x:i,y:s}=r,o=n?"1":"0";return`
    M ${i}, ${s}
    m -${e}, 0
    a ${e},${e} 0 1,${o} ${e*2},0
    a ${e},${e} 0 1,${o} -${e*2},0
  `.split(`
`)},Au=(e,r)=>{const n=i=>{const s=Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)),o=i.x+i.radius*((r.x-i.x)/s),a=i.y+i.radius*((r.y-i.y)/s);return{x:o,y:a}};if(Array.isArray(e)){const i=e.map(o=>n(o)),s=i.map(o=>p.distance(o,r));return Object.freeze(i[Er.minIndex(...s)])}else return Object.freeze(n(e))},jv=e=>(Jt(e),Object.freeze({...e,nearest:r=>Au(e,r),interpolate:r=>Eu(e,r),bbox:()=>zu(e),length:()=>Nu(e),toSvgString:(r=!0)=>Su(e,r),relativePosition:(r,n)=>{throw new Error("Not implemented")},distanceToPoint:r=>{throw new Error("Not implemented")},kind:"circular"})),Tv=(e,r)=>{const n={x:r.b.x-r.a.x,y:r.b.y-r.a.y},i={x:r.a.x-e.x,y:r.a.y-e.y},s=(n.x*i.x+n.y*i.y)*-2,o=2*(n.x*n.x+n.y*n.y),a=Math.sqrt(s*s-2*o*(i.x*i.x+i.y*i.y-e.radius*e.radius));if(Number.isNaN(a))return[];const u=(s-a)/o,l=(s+a)/o,c=[];return u<=1&&u>=0&&c.push({x:r.a.x+n.x*u,y:r.a.y+n.y*u}),l<=1&&l>=0&&c.push({x:r.a.x+n.x*l,y:r.a.y+n.y*l}),c},Iv=(e,r)=>{const n=Y(r,e),i=Math.hypot(n.y,n.x);if(i>e.radius+r.radius)return[];if(i<Math.abs(e.radius-r.radius))return[];if($u(e,r))return[];const s=(e.radius*e.radius-r.radius*r.radius+i*i)/(2*i),o={x:e.x+n.x*s/i,y:e.y+n.y*s/i},a=Math.sqrt(e.radius*e.radius-s*s),u={x:-n.y*(a/i),y:n.x*(a/i)};return[ft(o,u),Y(o,u)]},ku=(e,r)=>{const n=e.x-Math.max(r.x,Math.min(e.x,r.x+r.width)),i=e.y-Math.max(r.y,Math.min(e.y,r.y+r.height));return n*n+i*i<e.radius*e.radius},ys=(e,r)=>Iv(e,r).length===2;function Ut(e,r,n){ie(e,"rect");let i=0,s=0;if(typeof r=="number"){if(n===void 0)throw new Error("x and y coordinate needed");i=r,s=n}else i=r.x,s=r.y;if(H(e)){if(i-e.x>e.width||i<e.x||s-e.y>e.height||s<e.y)return!1}else if(i>e.width||i<0||s>e.height||s<0)return!1;return!0}var ju=(e,r)=>{if(!we(e))throw new Error("a parameter should be RectPositioned");if(_(r))return ku(r,e);if(b(r))return Ut(e,r);throw new Error(`Unknown shape for b: ${JSON.stringify(r)}`)},$i=(e,r)=>{if(hu(e,"rect"),N(r,"pt"),Ut(e,r))return 0;const n=Math.max(e.x-r.x,0,r.x-e.x+e.width),i=Math.max(e.y-r.y,0,r.y-e.y+e.height);return Math.hypot(n,i)},Cv=(e,r)=>T(Pi(e),r);function Vv(e,r,n,i){if(n===void 0||i===void 0){if(typeof e!="number")throw new Error("width is not an number");if(typeof r!="number")throw new TypeError("height is not an number");return Object.freeze({width:e,height:r})}if(typeof e!="number")throw new Error("x is not an number");if(typeof r!="number")throw new Error("y is not an number");if(typeof n!="number")throw new Error("width is not an number");if(typeof i!="number")throw new Error("height is not an number");return Object.freeze({x:e,y:r,width:n,height:i})}function Rv(e,r,n){if(ie(e,"a"),J(r))return we(e)?Object.freeze({...e,x:e.x*r.width,y:e.y*r.height,width:e.width*r.width,height:e.height*r.height}):Object.freeze({...e,width:e.width*r.width,height:e.height*r.height});if(typeof r!="number")throw new TypeError(`Expected second parameter of type Rect or number. Got ${JSON.stringify(r)}`);return n===void 0&&(n=r),we(e)?Object.freeze({...e,x:e.x*r,y:e.y*n,width:e.width*r,height:e.height*n}):Object.freeze({...e,width:e.width*r,height:e.height*n})}function _v(e,r){return H(e)?Object.freeze({...e,x:e.x*r,y:e.y*r,width:e.width*r,height:e.height*r}):Object.freeze({...e,width:e.width*r,height:e.height*r})}var Ov=e=>(e===void 0&&(e=O),Object.freeze({x:e(),y:e(),width:e(),height:e()})),Tu=(e,r={})=>{const n=r.randomSource??O,i=r.margin??{x:0,y:0},s=n()*(e.width-i.x-i.x),o=n()*(e.height-i.y-i.y),a={x:s+i.x,y:o+i.y};return H(e)?ft(a,e):Object.freeze(a)};function qv(e,r,n){if(e===void 0)throw new Error("First parameter undefined");if(typeof r=="number"){const i=n??0;return Object.freeze({...e,width:e.width-r,height:e.height-i})}else return Object.freeze({...e,width:e.width-r.width,height:e.height-r.height})}function Fv(e,r,n){if(e===void 0)throw new Error("First parameter undefined");if(typeof r=="number"){const i=n??0;return Object.freeze({...e,width:e.width+r,height:e.height+i})}else return Object.freeze({...e,width:e.width+r.width,height:e.height+r.height})}var Bv=Object.freeze({width:0,height:0}),Lv=Object.freeze({x:0,y:0,width:0,height:0}),Iu=Object.freeze({width:Number.NaN,height:Number.NaN}),Dv=Object.freeze({x:Number.NaN,y:Number.NaN,width:Number.NaN,height:Number.NaN}),Gv=e=>({width:e.clientWidth,height:e.clientHeight}),Kv=(e,r)=>{if(e===void 0)throw new Error("a undefined");if(r===void 0)throw new Error("b undefined");return e.width===r.width&&e.height===r.height};function Jv(e){if(H(e))return[e.x,e.y,e.width,e.height];if(J(e))return[e.width,e.height];throw new Error(`rect param is not a rectangle. Got: ${JSON.stringify(e)}`)}var Uv=(e,r)=>H(e)&&H(r)?me(e,r)?e.width===r.width&&e.height===r.height:!1:!H(e)&&!H(r)?e.width===r.width&&e.height===r.height:!1,Cu=(e,r,n)=>{N(e,"origin"),lt(r,"width"),lt(n,"height");const i=r/2,s=n/2;return{x:e.x-i,y:e.y-s,width:r,height:n}},Vu=(e,r,n,i)=>{if(e.y>n.y)throw new Error("topLeft.y greater than bottomRight.y");if(e.y>i.y)throw new Error("topLeft.y greater than bottomLeft.y");const s=r.x-e.x,o=n.x-i.x,a=Math.abs(i.y-e.y),u=Math.abs(n.y-r.y);return{x:Math.min(e.x,i.x),y:Math.min(r.y,e.y),width:Math.max(s,o),height:Math.max(a,u)}};function Hv(e,r,n,i){if(typeof e=="number")if(typeof r=="number"){if(typeof n=="number"&&typeof i=="number")return{x:e,y:r,width:n,height:i};if(J(n))return{x:e,y:r,width:n.width,height:n.height};throw new TypeError("If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect")}else throw new TypeError("If parameter 'a' is a number, expect following parameters to be: y,w,h");else{if(we(e))return e;if(J(e)){if(typeof r=="number"&&typeof n=="number")return{width:e.width,height:e.height,x:r,y:n};if(b(r))return{width:e.width,height:e.height,x:r.x,y:r.y};throw new TypeError("If param 'a' is a Rect, expects following parameters to be x,y")}else if(b(e)){if(typeof r=="number"&&typeof n=="number")return{x:e.x,y:e.y,width:r,height:n};if(J(r))return{x:e.x,y:e.y,width:r.width,height:r.height};throw new TypeError("If parameter 'a' is a Point, expect following params to be: Rect or width,height")}}throw new TypeError("Expect a first parameter to be x,RectPositioned,Rect or Point")}var Wv=(e,r)=>Object.freeze({...e,width:Math.min(e.width,r.width),height:Math.min(e.height,r.height)}),Se=(e,r,n)=>(lt(r,"width"),lt(n,"height"),N(e,"origin"),{x:e.x,y:e.y,width:r,height:n}),Qv=(e,r,n)=>{let i;if(n===void 0)if(J(r))n=r.height,i=r.width;else throw new Error("Expects rectangle or width and height parameters for normaliseBy");else if(typeof r=="number")i=r;else throw new TypeError("Expects rectangle or width and height parameters for normaliseBy");return H(e)?Object.freeze({x:e.x/i,y:e.y/n,width:e.width/i,height:e.height/n}):Object.freeze({width:e.width/i,height:e.height/n})},Pi=(e,r)=>(ie(e),r===void 0&&b(e)?r=e:r===void 0&&(r={x:0,y:0}),fu(e,r),Object.freeze({x:r.x+e.width/2,y:r.y+e.height/2})),Zv=e=>(hu(e,"rect"),mu(e).map(r=>U(r))),Yv=e=>(ie(e),e.height+e.height+e.width+e.width),Xv=e=>(ie(e),e.height*e.width),_r=e=>e.quadratic!==void 0,Ru=e=>e.cubic1!==void 0&&e.cubic2!==void 0,ep=(e,r,n=0)=>nt(e,r,n),nt=(e,r,n=0)=>{if(Number.isNaN(n))throw new Error("bend is NaN");if(n<-1||n>1)throw new Error("Expects bend range of -1 to 1");const i=ce(.5,e,r);let s=i;r.y<e.y?s=n>0?{x:Math.min(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.max(e.x,r.x),y:Math.max(e.y,r.y)}:s=n>0?{x:Math.max(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.min(e.x,r.x),y:Math.max(e.y,r.y)};const o=ce(Math.abs(n),i,s);return Ou(e,r,o)},tp=(e,r,n,i)=>{const s=nt(e,r,n);return new Rr(s.a,s.quadratic,s.b).compute(i)},_u=(e,r,n)=>[`M ${e.x} ${e.y} Q ${n.x} ${n.y} ${r.x} ${r.y}`],sr=e=>{if(Ru(e))return np(e);if(_r(e))return ip(e);throw new Error("Unknown bezier type")},rp=(e,r,n,i)=>({a:Object.freeze(e),b:Object.freeze(r),cubic1:Object.freeze(n),cubic2:Object.freeze(i)}),np=e=>{const{a:r,cubic1:n,cubic2:i,b:s}=e,o=new Rr(r,n,i,s);return Object.freeze({...e,length:()=>o.length(),interpolate:a=>o.compute(a),nearest:a=>{throw new Error("not implemented")},bbox:()=>{const{x:a,y:u}=o.bbox(),l=a.size,c=u.size;if(l===void 0)throw new Error("x.size not present on calculated bbox");if(c===void 0)throw new Error("x.size not present on calculated bbox");return Se({x:a.min,y:u.min},l,c)},relativePosition:(a,u)=>{throw new Error("Not implemented")},distanceToPoint:a=>{throw new Error("Not implemented")},toSvgString:()=>["brrup"],kind:"bezier/cubic"})},Ou=(e,r,n)=>({a:Object.freeze(e),b:Object.freeze(r),quadratic:Object.freeze(n)}),ip=e=>{const{a:r,b:n,quadratic:i}=e,s=new Rr(r,i,n);return Object.freeze({...e,length:()=>s.length(),interpolate:o=>s.compute(o),nearest:o=>{throw new Error("not implemented")},bbox:()=>{const{x:o,y:a}=s.bbox(),u=o.size,l=a.size;if(u===void 0)throw new Error("x.size not present on calculated bbox");if(l===void 0)throw new Error("x.size not present on calculated bbox");return Se({x:o.min,y:a.min},u,l)},distanceToPoint:o=>{throw new Error("Not implemented")},relativePosition:(o,a)=>{throw new Error("Not implemented")},toString:()=>s.toString(),toSvgString:()=>_u(r,n,i),kind:"bezier/quadratic"})},ct=(e,r,n,i,s,o)=>sp(r,n,i,s,o)(e),sp=(e,r,n,i,s)=>{const o=i??1,a=n??0;return u=>{if(e===r)return o;let l=(u-e)/(r-e);return s!==void 0&&(l=s(l)),l*(o-a)+a}},sw=(e,r,n,i,s,o)=>{if(s===void 0&&(s=1),i===void 0&&(i=0),r===n)return s;const a=ct(e,r,n,i,s,o);return re(a,i,s)},ow=(e,r,n=1)=>(k(j(e,"percentage","v")),k(j(r,"percentage","outMin")),k(j(n,"percentage","outMax")),ct(e,0,1,r,n)),aw=(e,r,n)=>op(r,n)(e),op=(e,r)=>n=>(k(j(n,"percentage","v")),ct(n,0,1,e,r)),qu=()=>({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1}),ap=Object.freeze({attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null}),up=class extends Je{#e;#t;#r;#n;#i;attackDuration;decayDuration;releaseDuration;decayDurationTotal;shouldLoop;constructor(e){super();this.attackDuration=e.attackDuration??300,this.decayDuration=e.decayDuration??500,this.releaseDuration=e.releaseDuration??1e3,this.shouldLoop=e.shouldLoop??!1,this.#e=new Eo(ap,{initial:"attack"}),this.#e.addEventListener("change",r=>{r.newState==="release"&&this.#i&&this.#r?.reset(),super.fireEvent("change",r)}),this.#e.addEventListener("stop",r=>{super.fireEvent("complete",r)}),this.#t=he,this.#n=this.#i=!1,this.decayDurationTotal=this.attackDuration+this.decayDuration}switchState(){if(this.#r===void 0)return!1;let e=this.#r.elapsed;const r=this.#i&&!this.#n;let n=!1;do switch(n=!1,this.#e.state){case"attack":{(e>this.attackDuration||r)&&(this.#e.next(),n=!0);break}case"decay":{(e>this.decayDurationTotal||r)&&(this.#e.next(),n=!0);break}case"sustain":{(!this.#n||r)&&(e=0,this.#e.next(),this.#r.reset(),n=!0);break}case"release":{e>this.releaseDuration&&(this.#e.next(),n=!0);break}case"complete":this.shouldLoop&&this.trigger(this.#i)}while(n);return n}computeRaw(e=!0){if(this.#r===void 0)return[void 0,0,this.#e.state];e&&this.switchState();const r=this.#e.state,n=this.#r.elapsed;let i=0;const s=this.#e.state;switch(s){case"attack":{i=n/this.attackDuration;break}case"decay":{i=(n-this.attackDuration)/this.decayDuration;break}case"sustain":{i=1;break}case"release":{i=Math.min(n/this.releaseDuration,1);break}case"complete":return[void 0,1,r];default:throw new Error(`State machine in unknown state: ${s}`)}return[s,i,r]}get isDone(){return this.#e.isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),this.#e.reset(),this.#r=this.#t(),this.#n=e,this.#i=e}compute(){}release(){this.isDone||!this.#i||(this.#n=!1,this.compute())}},lp=class extends up{attackPath;decayPath;releasePath;initialLevel;peakLevel;releaseLevel;sustainLevel;attackBend;decayBend;releaseBend;initialLevelOverride;retrigger;releasedAt;constructor(e){super(e);this.initialLevel=e.initialLevel??0,this.peakLevel=e.peakLevel??1,this.releaseLevel=e.releaseLevel??0,this.sustainLevel=e.sustainLevel??.75,this.retrigger=e.retrigger??!0,this.attackBend=e.attackBend??0,this.releaseBend=e.releaseBend??0,this.decayBend=e.decayBend??0;const r=1;this.attackPath=sr(nt({x:0,y:this.initialLevel},{x:r,y:this.peakLevel},-this.attackBend)),this.decayPath=sr(nt({x:0,y:this.peakLevel},{x:r,y:this.sustainLevel},-this.decayBend)),this.releasePath=sr(nt({x:0,y:this.sustainLevel},{x:r,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){const[e,r,n]=this.compute();!Number.isNaN(r)&&r>0&&(this.initialLevelOverride=r)}}get value(){return this.compute(!0)[1]}compute(e=!0){const[r,n]=super.computeRaw(e);if(r===void 0)return[void 0,Number.NaN,Number.NaN];let i;switch(r){case"attack":{i=this.attackPath.interpolate(n).y,this.initialLevelOverride!==void 0&&(i=ct(i,0,1,this.initialLevelOverride,1)),this.releasedAt=i;break}case"decay":{i=this.decayPath.interpolate(n).y,this.releasedAt=i;break}case"sustain":{i=this.sustainLevel,this.releasedAt=i;break}case"release":{i=this.releasePath.interpolate(n).y,this.releasedAt!==void 0&&(i=ct(i,0,this.sustainLevel,0,this.releasedAt));break}case"complete":{i=this.releaseLevel,this.releasedAt=void 0;break}default:throw new Error(`Unknown state: ${r}`)}return[r,i,n]}},Si=e=>new lp(e);async function*Fu(e){const r=Si(e.env),n=e.sampleRateMs??100;r.trigger();for await(const i of ho(()=>{if(!r.isDone)return r.value},{fixed:n,signal:e.signal}))yield i}var Ai={};m(Ai,{accelerationForce:()=>vp,angleFromAccelerationForce:()=>Du,angleFromVelocityForce:()=>Gu,angularForce:()=>Lu,apply:()=>yp,attractionForce:()=>hp,computeAccelerationToTarget:()=>Ku,computeAttractionForce:()=>Bu,computePositionFromAngle:()=>Ju,computePositionFromVelocity:()=>ji,computeVelocity:()=>ki,constrainBounce:()=>fp,guard:()=>cp,magnitudeForce:()=>pp,nullForce:()=>mp,orientationForce:()=>Np,pendulumForce:()=>xp,springForce:()=>wp,targetForce:()=>dp,velocityForce:()=>gp});var cp=(e,r="t")=>{if(e===void 0)throw new Error(`Parameter ${r} is undefined. Expected ForceAffected`);if(e===null)throw new Error(`Parameter ${r} is null. Expected ForceAffected`);if(typeof e!="object")throw new TypeError(`Parameter ${r} is type ${typeof e}. Expected object of shape ForceAffected`)},fp=(e,r=1)=>{e||(e={width:1,height:1});const n=An(e,"left"),i=An(e,"right"),s=kn(e,"top"),o=kn(e,"bottom");return a=>{const u=ji(a.position??p.Empty,a.velocity??p.Empty);let l=a.velocity??p.Empty,{x:c,y:f}=u;return c>i?(c=i,l=p.invert(p.multiply(l,r),"x")):c<n&&(c=n,l=p.invert(p.multiply(l,r),"x")),f>o?(f=o,l=p.multiply(p.invert(l,"y"),r)):u.y<s&&(f=s,l=p.invert(p.multiply(l,r),"y")),Object.freeze({...a,position:{x:c,y:f},velocity:l})}},hp=(e,r,n={})=>i=>{let s=i.acceleration??p.Empty;for(const o of e){if(o===i)continue;const a=Bu(o,i,r,n);s=p.sum(s,a)}return{...i,acceleration:s}},Bu=(e,r,n,i={})=>{if(e.position===void 0)throw new Error("attractor.position not set");if(r.position===void 0)throw new Error("attractee.position not set");const s=i.min??.01,o=i.max??.7,a=p.normalise(p.subtract(e.position,r.position)),u=re(p.distance(a),s,o);return p.multiply(a,n*(e.mass??1)*(r.mass??1)/(u*u))},dp=(e,r={})=>i=>{const s=Ku(e,i.position??{x:.5,y:.5},r);return{...i,acceleration:p.sum(i.acceleration??p.Empty,s)}},yp=(e,...r)=>{if(e===void 0)throw new Error("t parameter is undefined");for(const o of r)o!=null&&(e=typeof o=="function"?o(e):{...e,acceleration:p.sum(e.acceleration??p.Empty,o)});const n=ki(e.acceleration??p.Empty,e.velocity??p.Empty),i=ji(e.position??p.Empty,n);return{...e,position:i,velocity:n,acceleration:p.Empty}},vp=(e,r="ignored")=>n=>Object.freeze({...n,acceleration:Or(e,n,r)}),Or=(e,r,n="ignored")=>{let i;switch(n){case"dampen":{i=s=>p.divide(e,s,s);break}case"multiply":{i=s=>p.multiply(e,s,s);break}case"ignored":{i=s=>e;break}default:throw new Error(`Unknown 'mass' parameter '${n}. Expected 'dampen', 'multiply' or 'ignored'`)}return p.sum(r.acceleration??p.Empty,i(r.mass??1))},pp=(e,r="ignored")=>n=>{if(n.velocity===void 0)return n;const i=p.distance(p.normalise(n.velocity)),s=e*i*i,o=p.multiply(p.invert(n.velocity),s);return Object.freeze({...n,acceleration:Or(o,n,r)})},mp=e=>e,gp=(e,r)=>{const n=p.pipeline(p.invert,i=>p.multiply(i,e));return i=>{if(i.velocity===void 0)return i;const s=n(i.velocity);return Object.freeze({...i,acceleration:Or(s,i,r)})}},Lu=()=>e=>{const r=e.angularAcceleration??0,n=e.angularVelocity??0,i=e.angle??0,s=n+r,o=i+s;return Object.freeze({...e,angle:o,angularVelocity:s,angularAcceleration:0})},Du=(e=20)=>r=>{const n=r.acceleration??p.Empty;return Object.freeze({...r,angularAcceleration:n.x*e})},Gu=(e=1)=>r=>{const n=p.angle(r.velocity??p.Empty);return Object.freeze({...r,angle:e<1?Rd(e,r.angle??0,n):n})},wp=(e,r=.5,n=2e-4,i=.999)=>s=>{const o=p.subtract(s.position??p.Empty,e),a=p.distance(o),u=Math.abs(r-a),l=p.pipelineApply(o,p.normalise,d=>p.multiply(d,-n*u)),c=Or(l,s,"dampen"),f=ki(c??p.Empty,s.velocity??p.Empty),h=p.multiply(f,i,i);return{...s,velocity:h,acceleration:p.Empty}},xp=(e,r={})=>n=>{e||(e={x:0,y:0});const i=r.length??p.distance(e,n.position??p.Empty),s=r.speed??.001,o=r.damping??.995;let a=n.angle;a===void 0&&(n.position?a=p.angle(e,n.position)-Math.PI/2:a=0);const u=-1*s/i*Math.sin(a),l=(n.angularVelocity??0)+u;return a+=l,Object.freeze({angularVelocity:l*o,angle:a,position:Ju(i,a+Math.PI/2,e)})},ki=(e,r,n)=>{const i=p.sum(r,e);return n===void 0?i:p.clampMagnitude(i,n)},Ku=(e,r,n={})=>{const i=n.diminishBy??.001,s=p.subtract(e,r);return n.range&&p.compare(p.abs(s),n.range)===-2?p.Empty:p.multiply(s,i)},ji=(e,r)=>p.sum(e,r),Ju=(e,r,n)=>qt.toCartesian(e,r,n),bp=Lu(),Ep=Du(),Np=(e=.5)=>{const r=Gu(e);return n=>(n=bp(n),n=Ep(n),n=r(n),n)},Ti={};m(Ti,{saw:()=>Ap,sine:()=>$p,sineBipolar:()=>Pp,spring:()=>zp,square:()=>kp,triangle:()=>Sp});var Uu=Math.PI*2,Mp=(e={},r=0,n=1)=>{const i=e.mass??1,s=e.stiffness??100,o=e.soft??!1,a=e.damping??10,u=e.velocity??.1,l=n-r;if(o||1<=a/(2*Math.sqrt(s*i))){const c=-Math.sqrt(s/i),f=-c*l-u;return h=>n-(l+h*f)*Math.E**(h*c)}else{const c=Math.sqrt(4*i*s-a**2),f=(a*l-2*i*u)/c,h=.5*c/i,d=-(.5*a)/i;return y=>n-(Math.cos(y*h)*l+Math.sin(y*h)*f)*Math.E**(y*d)}};function*zp(e={},r){r===void 0?r=he():typeof r=="number"&&(r=be(r));const n=Mp(e,0,1);let i=e.countdown??10;for(;i>0;){const s=n(r.elapsed/1e3);yield s,s===1?i--:i=100}}function*$p(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=be(e));;)yield(Math.sin(e.elapsed*Uu)+1)/2}function*Pp(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=be(e));;)yield Math.sin(e.elapsed*Uu)}function*Sp(e){for(typeof e=="number"&&(e=be(e));;){let r=e.elapsed;r<.5?r*=2:r=2-r*2,yield r}}function*Ap(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=be(e));;)yield e.elapsed}function*kp(e){for(typeof e=="number"&&(e=be(e));;)yield e.elapsed<.5?0:1}var jp=e=>{const r=e/1e3;let n=performance.now();return()=>{const i=performance.now()-n;return n=performance.now(),r*i}},Tp=e=>{const{relative:r,absolute:n}=e,i=e.clamped??!1,s=e.source??O;if(n!==void 0)return o=>{const a=s()*n*2-n,u=o+a;return i?re(u,0,o):u};if(r!==void 0)return o=>{const a=o*r,u=s()*a*2-a,l=o+u;return i?re(l,0,o):l};throw new Error("Either absolute or relative fields expected")},Ip=(e={})=>{const r=e.clamped??!0;let n=s=>0;if(e.absolute!==void 0){g(e.absolute,r?"percentage":"bipolar","opts.absolute");const s=Jn({min:-e.absolute,max:e.absolute,source:e.source});n=o=>o+s()}else{if(e.relative===void 0)throw new TypeError("Either absolute or relative jitter amount is required.");{const s=e.relative??.1;g(s,r?"percentage":"bipolar","opts.relative"),n=o=>o+na({min:-Math.abs(s*o),max:Math.abs(s*o),source:e.source})}}return s=>{g(s,r?"percentage":"bipolar","value");let o=n(s);return r&&(o=re(o)),o}};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Modulation:{Forces:Ai,Envelopes:Ei,Oscillators:Ti,Easings:Yn}})}catch{}var Cp=(...e)=>Fs(e),Vp=(e,...r)=>Hs(r,e),Rp=(e,r)=>{const n={...e};for(const[i,s]of Object.entries(e))typeof s=="number"?n[i]=r(s):n[i]=s;return n},_p=(...e)=>Bs(e),Op=(...e)=>Ds(e),qp=(...e)=>Gs(e),Hu=e=>!(typeof e!="number"||Number.isNaN(e)),Fp=e=>nv(e);function*Bp(e){for(const r of e)Hu(r)&&(yield r)}var jn=(e,r,n=!0)=>{k(j(e,"","v")),k(It(r,"","every"));let i=e/r;const s=i%1;return i=Math.floor(i),(s===.5&&n||s>.5)&&i++,r*i};function*Wu(e,r,n,i){k(j(e,"","start")),k(j(r,"","end")),k(j(n,"","steps"));const s=i?st(i):a=>a,o=(r-e)/(n-1);if(k(j(o,"","step")),!Number.isFinite(o))throw new TypeError("Calculated step value is infinite");for(let a=0;a<n;a++){const u=e+o*a;yield s(u)}}function Lp(e,r,n){k(j(r,"percentage","rangePercent")),k(j(e,"","baseValue"));const i=e*r,s=o=>{try{k(j(o,"","v"));let a=Math.abs(o-e);return Math.abs(e)<=2&&(a=st(5,a)),a<=i}catch{return!1}};return n===void 0?s:s(n)}var Dp=(e,r)=>{if(we(r))return $i(r,e);if(_(r))return Mi(r,e);if(b(r))return T(e,r);throw new Error("Unknown shape")},Gp=(e,r)=>{if(we(r))return $i(r,e);if(_(r))return Mi(r,e);if(b(r))return T(e,r);throw new Error("Unknown shape")};function le(e,r,n){if(e===void 0)return{x:0,y:0};if(Array.isArray(e)){if(e.length===0)return Object.freeze({x:0,y:0});if(e.length===1)return Object.freeze({x:e[0],y:0});if(e.length===2)return Object.freeze({x:e[0],y:e[1]});if(e.length===3)return Object.freeze({x:e[0],y:e[1],z:e[2]});throw new Error(`Expected array to be 1-3 elements in length. Got ${e.length}.`)}if(b(e))return e;if(typeof e!="number"||typeof r!="number")throw new TypeError(`Expected point or x,y as parameters. Got: a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`);return Object.freeze(typeof n=="number"?{x:e,y:r,z:n}:{x:e,y:r})}var Qu=(...e)=>{const r=e.map(n=>Yu(n));return qs(r)},De={x:0,y:0},Kp=Object.freeze({x:Number.NaN,y:Number.NaN}),Jp=e=>e.x===null&&e.y===null,Up=e=>Number.isNaN(e.x)||Number.isNaN(e.y),_e=(e,...r)=>{if(r.length===0)throw new Error("No points provided");let n=r[0];for(const i of r)n=e(n,i);return n},Hp=(...e)=>_e((r,n)=>r.x<=n.x?r:n,...e),Wp=(...e)=>_e((r,n)=>r.x>=n.x?r:n,...e),Qp=e=>({...e,x:Math.abs(e.x),y:Math.abs(e.y)}),jt=(e,r,n)=>(N(e,"a"),r===void 0?Math.atan2(e.y,e.x):(N(r,"b"),n===void 0?Math.atan2(r.y-e.y,r.x-e.x):(N(n,"c"),Math.atan2(r.y-e.y,r.x-e.x)-Math.atan2(n.y-e.y,n.x-e.x)))),Zu=(...e)=>{if(!Array.isArray(e))throw new Error("Expected list of points");const r=e.reduce((n,i)=>{if(i===void 0)return n;if(Array.isArray(i))throw new TypeError("'points' list contains an array. Did you mean: centroid(...myPoints)?");if(!b(i))throw new Error(`'points' contains something which is not a point: ${JSON.stringify(i)}`);return{x:n.x+i.x,y:n.y+i.y}},{x:0,y:0});return Object.freeze({x:r.x/e.length,y:r.y/e.length})},Ii=(...e)=>{const r=_e((c,f)=>c.x<f.x?c:f,...e),n=_e((c,f)=>c.x>f.x?c:f,...e),i=_e((c,f)=>c.y<f.y?c:f,...e),s=_e((c,f)=>c.y>f.y?c:f,...e),o={x:r.x,y:i.y},a={x:n.x,y:i.y},u={x:n.x,y:s.y},l={x:r.x,y:s.y};return Vu(o,a,u,l)},Yu=e=>[e.x,e.y];function gr(e,r){if(e===void 0)return"(undefined)";if(e===null)return"(null)";const n=r?e.x.toFixed(r):e.x,i=r?e.y.toFixed(r):e.y;if(e.z===void 0)return`(${n},${i})`;{const s=r?e.z.toFixed(r):e.z;return`(${n},${i},${s})`}}var me=(...e)=>{if(e===void 0)throw new Error("parameter 'p' is undefined");if(e.length<2)return!0;for(let r=1;r<e.length;r++)if(e[r].x!==e[0].x||e[r].y!==e[0].y)return!1;return!0},Zp=(e,r,n)=>{N(e,"a"),N(r,"b"),typeof n=="number"?(g(n,"positive","maxRange"),n={x:n,y:n}):N(n,"maxRange");const i=Math.abs(r.x-e.x),s=Math.abs(r.y-e.y);return i<=n.x&&s<=n.y},Yp=(e,r,n,i=!1)=>ce(e,r,n,i),Xp=(e,r)=>{if(Array.isArray(e)){if(e.length!==2)throw new Error("Expected array of length two, got "+e.length);return Object.freeze({x:e[0],y:e[1]})}else{if(e===void 0)e=0;else if(Number.isNaN(e))throw new Error("x is NaN");if(r===void 0)r=0;else if(Number.isNaN(r))throw new Error("y is NaN");return Object.freeze({x:e,y:r})}},Ci=(...e)=>{const r=[];if(Array.isArray(e[0]))for(const n of e){if(n.length%2!==0)throw new Error("coords array should be even-numbered");r.push(Object.freeze({x:n[0],y:n[1]}))}else{if(e.length%2!==0)throw new Error("Expected even number of elements: [x,y,x,y...]");for(let n=0;n<e.length;n+=2)r.push(Object.freeze({x:e[n],y:e[n+1]}))}return r};function Y(e,r,n,i){if(b(e))return N(e,"a"),b(r)?(N(r,"b"),Object.freeze({...e,x:e.x-r.x,y:e.y-r.y})):(n===void 0&&(n=r),Object.freeze({...e,x:e.x-r,y:e.y-n}));if(g(e,"","a"),typeof r!="number")throw new TypeError("Second parameter is expected to by y value");if(g(r,"","b"),Number.isNaN(n))throw new Error("Third parameter is NaN");if(Number.isNaN(i))throw new Error("Fourth parameter is NaN");return n===void 0&&(n=0),i===void 0&&(i=0),Object.freeze({x:e-n,y:r-i})}var em=(e,r)=>Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y")}),tm=(e,...r)=>Xu(...r)(e),Xu=(...e)=>r=>e.reduce((n,i)=>i(n),r),el=(e,r,n)=>{n===void 0&&(n={x:0,y:0});let i=n;for(const s of e)i=r(s,i);return i},ft=function(e,r,n,i){if(e===void 0)throw new TypeError("a missing");let s,o;if(b(e))if(s=e,r===void 0&&(r=De),b(r))o=r;else{if(r===void 0)throw new Error("Expects x coordinate");o={x:r,y:n??r}}else if(!b(r)){if(r===void 0)throw new Error("Expected number as second param");if(s={x:e,y:r},n===void 0)throw new Error("Expects x coordiante");o={x:n,y:i??0}}if(s===void 0)throw new Error(`ptA missing. a: ${JSON.stringify(e)}`);if(o===void 0)throw new Error(`ptB missing. b: ${JSON.stringify(r)}`);return N(s,"a"),N(o,"b"),Object.freeze({x:s.x+o.x,y:s.y+o.y})};function Ft(e,r,n){if(N(e,"a"),typeof r=="number")return typeof n>"u"&&(n=r),g(n,"","y"),g(r,"","x"),Object.freeze({x:e.x*r,y:e.y*n});if(b(r))return N(r,"b"),Object.freeze({x:e.x*r.x,y:e.y*r.y});if(J(r))return ie(r,"rect"),Object.freeze({x:e.x*r.width,y:e.y*r.height});throw new Error(`Invalid arguments. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)}var rm=(e,r)=>Ae(e)?Object.freeze({...e,x:e.x*r,y:e.y*r,z:e.z*r}):Object.freeze({...e,x:e.x*r,y:e.y*r});function wr(e,r,n,i){if(b(e))return N(e,"a"),b(r)?Object.freeze({x:e.x/r.x,y:e.y/r.y}):J(r)?(ie(r,"rect"),Object.freeze({x:e.x/r.width,y:e.y/r.height})):(n===void 0&&(n=r),N(e),g(r,"nonZero","x"),g(n,"nonZero","y"),Object.freeze({x:e.x/r,y:e.y/n}));if(typeof r!="number")throw new TypeError("expected second parameter to be y1 coord");return g(e,"positive","x1"),g(r,"positive","y1"),n===void 0&&(n=1),i===void 0&&(i=n),g(n,"nonZero","x2"),g(i,"nonZero","y2"),Object.freeze({x:e/n,y:r/i})}function nm(e,r,n){const i=le(e,r,n);return cu(i,"divisor"),(s,o,a)=>{const u=le(s,o,a);return typeof u.z>"u"?Object.freeze({x:u.x/i.x,y:u.y/i.y}):Object.freeze({x:u.x/i.x,y:u.y/i.y,z:u.z/(i.z??1)})}}var im=(e,r,n=!0)=>Object.freeze({x:jn(e.x,r.x,n),y:jn(e.y,r.y,n)}),sm=(...e)=>{const r=[...e].sort(tl);if(r.length===1)return r;const n=o=>{const a=[];for(const u of o){for(;a.length>=2;){const l=a.at(-1),c=a.at(-2);if((l.x-c.x)*(u.y-c.y)>=(l.y-c.y)*(u.x-c.x))a.pop();else break}a.push(u)}return a.pop(),a},i=n(r),s=n(r.reverse());return i.length===1&&s.length===1&&me(s[0],i[0])?i:[...i,...s]},om=(e,r)=>e.x<r.x&&e.y<r.y?-2:e.x>r.x&&e.y>r.y?2:e.x<r.x||e.y<r.y?-1:e.x>r.x||e.y>r.y?1:e.x===r.x&&e.x===r.y?0:Number.NaN,tl=(e,r)=>e.x-r.x||e.y-r.y,Tn=(e,r,n)=>{const i=Math.cos(n)*r+e.x,s=Math.sin(n)*r+e.y;return{x:i,y:s}};function ge(e,r,n){n===void 0&&(n={x:0,y:0}),N(n,"origin"),g(r,"","amountRadian");const i=Array.isArray(e);if(r===0)return e;i||(e=[e]);const s=e;for(const[l,c]of s.entries())N(c,`pt[${l}]`);const u=s.map(l=>bi(l,n)).map(l=>iu(l,r)).map(l=>Pe(l,n));return i?u:u[0]}var am=(e,r)=>{const n=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],i=[];for(const[s,o]of e.entries())i[s]=[n[0][0]*o[0]+n[0][1]*o[1],n[1][0]*o[0]+n[1][1]*o[1]];return i},um=(e,r)=>{if(b(e)&&(r=e.y,e=e.x),r===void 0)throw new Error("Expected y");return Math.hypot(e,r)},rl=(e,r)=>{const n=le(e,r),i=um(n);return i===0?De:Object.freeze({...n,x:n.x/i,y:n.y/i})},lm=(e,r,n)=>{const i=le(e,r);return n=n??r,n=n??2,Object.freeze({...i,x:st(n,i.x),y:st(n,i.y)})};function In(e,r,n,i){if(b(e)){if(typeof r=="number"&&n!==void 0)g(r,"positive","width"),g(n,"positive","height");else{if(!J(r))throw new Error("Expected second parameter to be a rect");n=r.height,r=r.width}return Object.freeze({x:e.x/r,y:e.y/n})}else{if(g(e,"positive","x"),typeof r!="number")throw new TypeError("Expecting second parameter to be a number (width)");if(typeof n!="number")throw new TypeError("Expecting third parameter to be a number (height)");if(g(r,"positive","y"),g(n,"positive","width"),i===void 0)throw new Error("Expected height parameter");return g(i,"positive","height"),Object.freeze({x:e/n,y:r/i})}}var cm=e=>(e===void 0&&(e=O),Object.freeze({x:e(),y:e()})),fm=(e,r,n)=>(r===void 0&&(r={x:1,y:1}),n===void 0&&(n={x:0,y:0}),N(e,"pt"),N(r,"ptMax"),N(n,"ptMin"),Object.freeze({x:Nn(e.x,n.x,r.x),y:Nn(e.y,n.y,r.y)})),hm=(e,r="both")=>{switch(r){case"both":return Ae(e)?Object.freeze({...e,x:e.x*-1,y:e.y*-1,z:e.z*-1}):Object.freeze({...e,x:e.x*-1,y:e.y*-1});case"x":return Object.freeze({...e,x:e.x*-1});case"y":return Object.freeze({...e,y:e.y*-1});case"z":{if(Ae(e))return Object.freeze({...e,z:e.z*-1});throw new Error("pt parameter is missing z")}default:throw new Error("Unknown what parameter. Expecting 'both', 'x' or 'y'")}},dm=(e,r=Math.round)=>(N(e,"pt"),Object.freeze({x:r(e.x),y:r(e.y)})),nl=(e,r=1,n=0)=>{const i=T(e);let s=1;return i>r?s=r/i:i<n&&(s=n/i),s===1?e:Ft(e,s,s)};function ym(e,r,n,i){if(b(e))return r===void 0&&(r=0),n===void 0&&(n=1),g(r,"","min"),g(n,"","max"),Object.freeze({x:re(e.x,r,n),y:re(e.y,r,n)});if(r===void 0)throw new Error("Expected y coordinate");return n===void 0&&(n=0),i===void 0&&(i=1),g(e,"","x"),g(r,"","y"),g(n,"","min"),g(i,"","max"),Object.freeze({x:re(e,n,i),y:re(r,n,i)})}var vm=(e,r)=>{const n=le(e,r);let i=0,s=0,o=0,a=performance.now(),u=n;return(c,f)=>{const h=le(c,f);i+=h.x,s+=h.y,o++;const d=T(h,n),y=T(h,u),w=performance.now(),E=y/(w-a);return a=w,u=h,Object.freeze({angle:jt(h,n),distanceFromStart:d,distanceFromLast:y,speed:E,centroid:Zu(h,n),average:{x:i/o,y:s/o}})}},pm=(e,r,n)=>{const i=Y(e,r),s=Y(n,r);return Ae(i)&&Ae(s)?(i.x*s.x+i.y*s.y+i.z*s.z)/(s.x*s.x+s.y*s.y+s.z*s.z):(i.x*s.x+i.y*s.y)/(s.x*s.x+s.y*s.y)},mm=Object.freeze({a:Object.freeze({x:0,y:0}),b:Object.freeze({x:0,y:0})}),gm=Object.freeze({a:Object.freeze({x:Number.NaN,y:Number.NaN}),b:Object.freeze({x:Number.NaN,y:Number.NaN})}),wm=e=>et(e.a)&&et(e.b),xm=e=>tt(e.a)&&tt(e.b),Ee=e=>!(e===void 0||e.a===void 0||e.b===void 0||!b(e.a)||!b(e.b)),il=e=>Array.isArray(e)?!e.some(n=>!Ee(n)):!1,sl=(e,r)=>me(e.a,r.a)&&me(e.b,r.b),ol=(e,r)=>Object.freeze({...e,a:r(e.a),b:r(e.b)}),qr=(e,r="line")=>{if(e===void 0)throw new Error(`${r} undefined`);if(e.a===void 0)throw new Error(`${r}.a undefined. Expected {a:Point, b:Point}. Got: ${JSON.stringify(e)}`);if(e.b===void 0)throw new Error(`${r}.b undefined. Expected {a:Point, b:Point} Got: ${JSON.stringify(e)}`)},bm=(e,r)=>{let n;if(Ee(e))n=e.a,r=e.b;else if(n=e,r===void 0)throw new Error("b point must be provided");return Math.atan2(r.y-n.y,r.x-n.x)},al=(e,r)=>Object.freeze({...e,a:Ft(e.a,r),b:Ft(e.b,r)}),ul=(e,r)=>Object.freeze({...e,a:wr(e.a,r),b:wr(e.b,r)}),ll=(e,r)=>Object.freeze({...e,a:ft(e.a,r),b:ft(e.b,r)}),cl=(e,r)=>Object.freeze({...e,a:Y(e.a,r),b:Y(e.b,r)}),Em=(e,r,n)=>Object.freeze({...e,a:In(e.a,r,n),b:In(e.b,r,n)}),fl=(e,r,n)=>ml(e,r)<=n;function U(e,r){if(il(e))return e.reduce((u,l)=>U(l)+u,0);if(e===void 0)throw new TypeError("Parameter 'aOrLine' is undefined");const[n,i]=Fr(e,r),s=i.x-n.x,o=i.y-n.y;if(n.z!==void 0&&i.z!==void 0){const a=i.z-n.z;return Math.hypot(s,o,a)}else return Math.hypot(s,o)}var hl=(e,r)=>{const[n,i]=Fr(e,r);return ce(.5,n,i)},Fr=(e,r)=>{let n;if(Ee(e))r=e.b,n=e.a;else if(n=e,r===void 0)throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${JSON.stringify(n)} b: ${JSON.stringify(r)}`);return N(n,"a"),N(n,"b"),[n,r]},Vi=(e,r)=>{const n=i=>{const{a:s,b:o}=i,a={x:o.x-s.x,y:o.y-s.y},u={x:r.x-s.x,y:r.y-s.y},l=a.x*a.x+a.y*a.y;let c=u.x*a.x+u.y*a.y;const f=Math.min(1,Math.max(0,c/l));return c=(o.x-s.x)*(r.y-s.y)-(o.y-s.y)*(r.x-s.x),{x:s.x+a.x*f,y:s.y+a.y*f}};if(Array.isArray(e)){const i=e.map(o=>n(o)),s=i.map(o=>T(o,r));return Object.freeze(i[Ls(...s)])}else return Object.freeze(n(e))},Ri=(e,r)=>{let n;if(Ee(e))n=e.a,r=e.b;else if(n=e,r===void 0)throw new Error("b parameter required");if(r===void 0)throw new TypeError("Second point missing");return(r.y-n.y)/(r.x-n.x)},dl=e=>({x:e.b.x-e.a.x,y:e.b.y-e.a.y}),yl=e=>{const r=U(e),n=dl(e);return{x:n.x/r,y:n.y/r}},vl=(e,r,n=0)=>{const i=ce(n,e),s=yl(e);return{x:i.x-s.y*r,y:i.y+s.x*r}},pl=(e,r)=>{const n=dl(e),i=yl(e),s={x:e.a.x-i.y*r,y:e.a.y+i.x*r};return{a:s,b:{x:s.x+n.x,y:s.y+n.y}}},Nm=(e,r)=>{const n=ce(r/2,e),i=ce(.5+r/2,e);return{a:n,b:i}},Mm=(e,r)=>{const n=e.a.y+(r-e.a.x)*Ri(e);return Object.freeze({x:r,y:n})},zm=(e,r)=>{const n=U(e);return Object.freeze({...e,a:e.a,b:Object.freeze({x:e.b.x+(e.b.x-e.a.x)/n*r,y:e.b.y+(e.b.y-e.a.y)/n*r})})};function*$m(e){const{a:r,b:n}=e;let i=Math.floor(r.x),s=Math.floor(r.y);const o=Math.floor(n.x),a=Math.floor(n.y),u=Math.abs(o-i),l=-Math.abs(a-s),c=i<o?1:-1,f=s<a?1:-1;let h=u+l;for(;yield{x:i,y:s},!(i===o&&s===a);){const d=2*h;d>=l&&(h+=l,i+=c),d<=u&&(h+=u,s+=f)}}var ml=(e,r)=>{if(Array.isArray(e)){const n=e.map(i=>Cn(i,r));return qn(n)}else return Cn(e,r)},Cn=(e,r)=>{if(qr(e,"line"),N(r,"point"),U(e)===0)return U(e.a,r);const n=Vi(e,r);return U(n,r)};function ce(e,r,n,i){typeof n=="boolean"&&(i=n,n=void 0),i?g(e,"","amount"):kc(e,"amount");const[s,o]=Fr(r,n),a=U(s,o),u=a*(1-e);if(a===0&&u===0)return Object.freeze({...o});const l=o.x-u*(o.x-s.x)/a,c=o.y-u*(o.y-s.y)/a;return Object.freeze({...o,x:l,y:c})}function gl(e,r){if(Ee(e))qr(e,"a"),r=e.b,e=e.a;else if(r===void 0)throw new Error("Expect second point if first is a point");return gr(e)+"-"+gr(r)}var wl=(e,r,n,i)=>{if(Number.isNaN(e))throw new Error("x1 is NaN");if(Number.isNaN(n))throw new Error("x2 is NaN");if(Number.isNaN(r))throw new Error("y1 is NaN");if(Number.isNaN(i))throw new Error("y2 is NaN");return Br({x:e,y:r},{x:n,y:i})},xl=(e,r)=>{if(Ee(e))return[e.a.x,e.a.y,e.b.x,e.b.y];if(b(e)&&b(r))return[e.x,e.y,r.x,r.y];throw new Error("Expected single line parameter, or a and b points")};function*Pm(e){for(const r of e)yield r.a,yield r.b}var bl=(e,r)=>[`M${e.x} ${e.y} L ${r.x} ${r.y}`],Sm=e=>{if(!Array.isArray(e))throw new Error("arr parameter is not an array");if(e.length!==4)throw new Error("array is expected to have length four");return wl(e[0],e[1],e[2],e[3])},Br=(e,r)=>(N(e,"a"),N(r,"b"),e=Object.freeze({...e}),r=Object.freeze({...r}),Object.freeze({a:e,b:r})),Lr=(...e)=>{const r=[];let n=e[0];for(let i=1;i<e.length;i++)r.push(Br(n,e[i])),n=e[i];return r},Am=(e,r)=>ye(Br(e,r)),El=e=>Ii(e.a,e.b),Nl=(e,r)=>{const n=T(e.a,r),i=U(e);return n/i},ye=e=>{const{a:r,b:n}=e;return Object.freeze({...e,length:()=>U(r,n),interpolate:i=>ce(i,r,n),relativePosition:i=>Nl(e,i),bbox:()=>El(e),toString:()=>gl(r,n),toFlatArray:()=>xl(r,n),toSvgString:()=>bl(r,n),toPoints:()=>[r,n],rotate:(i,s)=>ye(Ml(e,i,s)),nearest:i=>Vi(e,i),sum:i=>ye(ll(e,i)),divide:i=>ye(ul(e,i)),multiply:i=>ye(al(e,i)),subtract:i=>ye(cl(e,i)),midpoint:()=>hl(r,n),distanceToPoint:i=>Cn(e,i),parallel:i=>pl(e,i),perpendicularPoint:(i,s)=>vl(e,i,s),slope:()=>Ri(e),withinRange:(i,s)=>fl(e,i,s),isEqual:i=>sl(e,i),apply:i=>ye(ol(e,i)),kind:"line"})},Ml=(e,r,n)=>r===void 0||r===0?e:(n===void 0&&(n=.5),typeof n=="number"&&(n=ce(n,e.a,e.b)),Object.freeze({...e,a:ge(e.a,r,n),b:ge(e.b,r,n)})),km=(e,r={})=>{const n=Lr(...e);return zl(n.map(i=>ye(i)),r)},zl=(e,r={})=>{const n=r.maxDistanceFromLine??.1;return s=>{const a=e.map((l,c)=>{const f=l.nearest(s),h=T(s,f);return{positionRelative:l.relativePosition(f,n),path:l,index:c,nearest:f,distance:h,rank:Number.MAX_SAFE_INTEGER}}).filter(l=>l.distance<=n),u=Er.sortByNumericProperty(a,"distance");for(let l=0;l<u.length;l++)u[l].rank=l;return u}},$l={};m($l,{CirclePacking:()=>Pl});var Pl={};m(Pl,{random:()=>Vm});var Sl={};m(Sl,{arrow:()=>Cm,center:()=>Tm,isIntersecting:()=>kl,randomPoint:()=>jl,starburst:()=>Im});var jm=(e,r,n)=>{const i=Ni(e,r);if(gt(r))return i<Math.abs(e.radius-r.radius);if(b(r))return n===void 0?i<=e.radius:i<Math.abs(e.radius-n);throw new Error("b parameter is expected to be CirclePositioned or Point")},Al=(e,r,n)=>me(e,r)||jm(e,r,n)?!0:gt(r)?ys(e,r):we(r)?ku(e,r):b(r)&&n!==void 0?ys(e,{...r,radius:n}):!1,kl=(e,r)=>{if(_(e))return Al(e,r);if(we(e))return ju(e,r);throw new Error(`a or b are unknown shapes. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)},jl=(e,r={})=>{if(_(e))return Pu(e,r);if(we(e))return Tu(e,r);throw new Error("Cannot create random point for unknown shape")},Tm=e=>{if(e===void 0)return Object.freeze({x:.5,y:.5});if(J(e))return Pi(e);if(Be.isTriangle(e))return Be.centroid(e);if(gt(e))return bu(e);throw new Error(`Unknown shape: ${JSON.stringify(e)}`)},Im=(e,r=5,n,i=p.Empty,s)=>{D(r,"positive","points");const o=Math.PI*2/r,a=o/2,u=s?.initialAngleRadian??-Math.PI/2;n===void 0&&(n=e/2);let l=u;const c=[];for(let f=0;f<r;f++){const h=Pe(e,l,i),d=Pe(n,l-a,i),y=Pe(n,l+a,i);c.push(d,h),f+1<r&&c.push(y),l+=o}return c},Cm=(e,r,n={})=>{const i=n.tailLength??10,s=n.tailThickness??Math.max(i/5,5),o=n.angleRadian??0,a=n.arrowSize??Math.max(i/5,15),u=Math.PI/2;let l,c;if(r==="tip")l=Be.equilateralFromVertex(e,a,u),c=rt(Se({x:l.a.x-i,y:e.y-s/2},i,s));else if(r==="middle"){const h=i+a/2,d=s/2;l=Be.equilateralFromVertex({x:e.x+a*1.2,y:e.y},a,u),c=rt(Se({x:e.x-h,y:e.y-d},i+a,s))}else c=rt(Se({x:e.x,y:e.y-s/2},i,s)),l=Be.equilateralFromVertex({x:e.x+i+a*.7,y:e.y},a,u);return p.rotate([c[0],c[1],l.a,l.b,l.c,c[2],c[3]],o,e)},Vm=(e,r,n={})=>{if(!Array.isArray(e))throw new Error("Parameter 'circles' is not an array");const i=n.attempts??2e3,s=Nr(e,"radius"),o=[],a=(u,l)=>o.some(c=>Al(c,u,l));for(;s.length>0;){const u=s.pop();if(!u)break;const l={...n,margin:{x:u.radius,y:u.radius}};for(let c=0;c<i;c++){const f=jl(r,l);if(!a(f,u.radius)){o.push(Object.freeze({...u,...f}));break}}}return o},Tt={};m(Tt,{getEnd:()=>_m,getStart:()=>Rm});var Rm=function(e){if(_r(e))return e.a;if(Ee(e))return e.a;throw new Error(`Unknown path type ${JSON.stringify(e)}`)},_m=function(e){if(_r(e))return e.b;if(Ee(e))return e.b;throw new Error(`Unknown path type ${JSON.stringify(e)}`)},Tl={};m(Tl,{access1dArray:()=>n0,allDirections:()=>Dr,array2dUpdater:()=>i0,asRectangles:()=>Bm,cellAtPoint:()=>_l,cellEquals:()=>Cl,cellFromIndex:()=>o0,cellKeyString:()=>Il,cellMiddle:()=>Gm,cells:()=>xt,crossDirections:()=>Ol,getLine:()=>Km,getVectorFromCardinal:()=>Gr,guardCell:()=>fe,indexFromCell:()=>Kr,inside:()=>Vl,isEqual:()=>Fm,neighbours:()=>ql,offset:()=>wt,offsetCardinals:()=>Jm,rectangleForCell:()=>Rl,rows:()=>r0,simpleLine:()=>Um,toArray:()=>Lm,visitArray:()=>s0,visitFor:()=>e0,visitNeigbours:()=>Dm,visitor:()=>Ue,visitorBreadth:()=>Qm,visitorColumn:()=>t0,visitorDepth:()=>Wm,visitorRandom:()=>Ym,visitorRandomContiguous:()=>Zm,visitorRow:()=>Xm});var Om=e=>e===void 0?!1:"x"in e&&"y"in e,qm=e=>!(e===void 0||e[1]===void 0),Fm=(e,r)=>{if(r===void 0||e===void 0)return!1;if("rows"in e&&"cols"in e)if("rows"in r&&"cols"in r){if(e.rows!==r.rows||e.cols!==r.cols)return!1}else return!1;if("size"in e)if("size"in r){if(e.size!==r.size)return!1}else return!1;return!0},Il=e=>`Cell{${e.x},${e.y}}`,Cl=(e,r)=>r===void 0||e===void 0?!1:e.x===r.x&&e.y===r.y,fe=(e,r="Param",n)=>{if(e===void 0)throw new Error(r+" is undefined. Expecting {x,y}");if(e.x===void 0)throw new Error(r+".x is undefined");if(e.y===void 0)throw new Error(r+".y is undefined");if(Number.isNaN(e.x))throw new Error(r+".x is NaN");if(Number.isNaN(e.y))throw new Error(r+".y is NaN");if(!Number.isInteger(e.x))throw new TypeError(r+".x is non-integer");if(!Number.isInteger(e.y))throw new TypeError(r+".y is non-integer");if(n!==void 0&&!Vl(n,e))throw new Error(`${r} is outside of grid. Cell: ${e.x},${e.y} Grid: ${n.cols}, ${n.rows}`)},Ht=(e,r="Param")=>{if(e===void 0)throw new Error(`${r} is undefined. Expecting grid.`);if(!("rows"in e))throw new Error(`${r}.rows is undefined`);if(!("cols"in e))throw new Error(`${r}.cols is undefined`);if(!Number.isInteger(e.rows))throw new TypeError(`${r}.rows is not an integer`);if(!Number.isInteger(e.cols))throw new TypeError(`${r}.cols is not an integer`)},Vl=(e,r)=>!(r.x<0||r.y<0||r.x>=e.cols||r.y>=e.rows),Rl=(e,r)=>{fe(r);const n=e.size,i=r.x*n,s=r.y*n;return Se({x:i,y:s},n,n)};function*Bm(e){for(const r of xt(e))yield Rl(e,r)}var Lm=(e,r)=>{const n=[];for(let i=0;i<e.rows;i++)if(n[i]=Array.from({length:e.cols}),r)for(let s=0;s<e.cols;s++)n[i][s]=r;return n},_l=(e,r)=>{const n=e.size;if(g(n,"positive","grid.size"),r.x<0||r.y<0)return;const i=Math.floor(r.x/n),s=Math.floor(r.y/n);if(!(i>=e.cols)&&!(s>=e.rows))return{x:i,y:s}},Dr=Object.freeze(["n","ne","nw","e","s","se","sw","w"]),Ol=Object.freeze(["n","e","s","w"]),ql=(e,r,n="undefined",i)=>{const s=i??Dr,o=s.map(a=>wt(e,r,Gr(a),n));return _n(s,o)};function*Dm(e,r,n="undefined",i){const o=(i??Dr).map(a=>wt(e,r,Gr(a),n));for(const a of o)a!==void 0&&(yield a)}var Gm=(e,r)=>{fe(r);const n=e.size,i=r.x*n,s=r.y*n;return Object.freeze({x:i+n/2,y:s+n/2})},Km=(e,r)=>{fe(e),fe(r);let n=e.x,i=e.y;const s=Math.abs(r.x-n),o=Math.abs(r.y-i),a=n<r.x?1:-1,u=i<r.y?1:-1;let l=s-o;const c=[];for(;c.push(Object.freeze({x:n,y:i})),!(n===r.x&&i===r.y);){const f=2*l;f>-o&&(l-=o,n+=a),f<s&&(l+=s,i+=u)}return c},Jm=(e,r,n,i="stop")=>{Ht(e,"grid"),fe(r,"start"),D(n,"aboveZero","steps");const s=Dr,o=s.map(u=>Gr(u,n)),a=s.map((u,l)=>wt(e,r,o[l],i));return _n(s,a)},Gr=(e,r=1)=>{let n;switch(e){case"n":{n={x:0,y:-1*r};break}case"ne":{n={x:1*r,y:-1*r};break}case"e":{n={x:1*r,y:0};break}case"se":{n={x:1*r,y:1*r};break}case"s":{n={x:0,y:1*r};break}case"sw":{n={x:-1*r,y:1*r};break}case"w":{n={x:-1*r,y:0};break}case"nw":{n={x:-1*r,y:-1*r};break}default:n={x:0,y:0}}return Object.freeze(n)},Um=function(e,r,n=!1){const i=[];if(e.x===r.x){const s=n?r.y+1:r.y;for(let o=e.y;o<s;o++)i.push({x:e.x,y:o})}else if(e.y===r.y){const s=n?r.x+1:r.x;for(let o=e.x;o<s;o++)i.push({x:o,y:e.y})}else throw new Error(`Only does vertical and horizontal: ${e.x},${e.y} - ${r.x},${r.y}`);return i},wt=function(e,r,n,i="undefined"){fe(r,"start",e),fe(n),Ht(e,"grid");let s=r.x,o=r.y;switch(i){case"wrap":{s+=n.x%e.cols,o+=n.y%e.rows,s<0?s=e.cols+s:s>=e.cols&&(s-=e.cols),o<0?o=e.rows+o:o>=e.rows&&(o-=e.rows);break}case"stop":{s+=n.x,o+=n.y,s=Wi(s,e.cols),o=Wi(o,e.rows);break}case"undefined":{if(s+=n.x,o+=n.y,s<0||o<0||s>=e.cols||o>=e.rows)return;break}case"unbounded":{s+=n.x,o+=n.y;break}default:throw new Error(`Unknown BoundsLogic case ${i}`)}return Object.freeze({x:s,y:o})},Hm=(e,r,n,i)=>{const s=ql(e,r,i,n);return Object.entries(s).filter(a=>qm(a))},Ue=function*(e,r,n,i={}){Ht(r,"grid"),fe(n,"start",r);const s=i.visited??ja(Il),o=e.options??((c,f)=>Hm(c,f,Ol,"undefined"));if(!Om(n))throw new Error("'start' parameter is undefined or not a cell");let a=[n],u=[],l;for(;a.length>0;){if(l===void 0){const c=a.pop();if(c===void 0)break;l=c}if(!s.has(l)){s.add(l),yield l;const c=o(r,l).filter(f=>f[1]===void 0?!1:!s.has(f[1]));if(c.length===0)l!==void 0&&(a=a.filter(f=>Cl(f,l)));else for(const f of c)f!==void 0&&f[1]!==void 0&&u.push(f)}if(u=u.filter(c=>!s.has(c[1])),u.length===0)l=void 0;else{const c=e.select(u);c!==void 0&&(a.push(c[1]),l=c[1])}}},Wm=(e,r,n={})=>Ue({select:i=>i.at(-1)},e,r,n),Qm=(e,r,n={})=>Ue({select:i=>i[0]},e,r,n),Fl=e=>Mr(e),Zm=(e,r,n={})=>Ue({select:Fl},e,r,n),Ym=(e,r,n={})=>Ue({options:(i,s)=>{const o=[];for(const a of xt(i,s))o.push(["n",a]);return o},select:Fl},e,r,n),Xm=(e,r,n={})=>{r||(r={x:0,y:0});const{reversed:i=!1}=n;return Ue({select:u=>u.find(l=>l[0]===(i?"w":"e")),options:(u,l)=>(i?l.x>0?l={x:l.x-1,y:l.y}:l.y>0?l={x:u.cols-1,y:l.y-1}:l={x:u.cols-1,y:u.rows-1}:l.x<u.rows-1?l={x:l.x+1,y:l.y}:l.y<u.rows-1?l={x:0,y:l.y+1}:l={x:0,y:0},[[i?"w":"e",l]])},e,r,n)},e0=(e,r,n,i)=>{D(n,"","steps");const s={reversed:n<0};n=Math.abs(n);let o=r,a=i(e,r,s);a.next();let u=0;for(;u<n;){u++;const{value:l}=a.next();if(l)o=l,s.debug&&console.log(`stepsMade: ${u} cell: ${o.x}, ${o.y} reverse: ${s.reversed}`);else if(n>=e.cols*e.rows)n-=e.cols*e.rows,u=0,a=i(e,r,s),a.next(),o=r,s.debug&&console.log(`resetting visitor to ${n}`);else throw new Error("Value not received by visitor")}return o},t0=(e,r,n={})=>{const{reversed:i=!1}=n;return Ue({select:o=>o.find(a=>a[0]===(i?"n":"s")),options:(o,a)=>(i?a.y>0?a={x:a.x,y:a.y-1}:a.x===0?a={x:o.cols-1,y:o.rows-1}:a={x:a.x-1,y:o.rows-1}:a.y<o.rows-1?a={x:a.x,y:a.y+1}:a.x<o.cols-1?a={x:a.x+1,y:0}:a={x:0,y:0},[[i?"n":"s",a]])},e,r,n)},r0=function*(e,r){r||(r={x:0,y:0});let n=r.y,i=[];for(const s of xt(e,r))s.y===n?i.push(s):(yield i,i=[s],n=s.y);i.length>0&&(yield i)},xt=function*(e,r){r||(r={x:0,y:0}),Ht(e,"grid"),fe(r,"start",e);let{x:n,y:i}=r,s=!0;do yield{x:n,y:i},n++,n===e.cols&&(i++,n=0),i===e.rows&&(i=0,n=0),n===r.x&&i===r.y&&(s=!1);while(s)},n0=(e,r)=>{const n={cols:r,rows:Math.ceil(e.length/r)};return(s,o)=>{const a=Kr(n,s,o);if(a!==void 0)return e[a]}},i0=(e,r)=>(i,s)=>{const o=_l(e,s);if(o===void 0)throw new Error(`Position does not exist. Pos: ${JSON.stringify(s)} Grid: ${JSON.stringify(e)}`);r[o.y][o.x]=i};function*s0(e,r,n,i){if(typeof e>"u")throw new TypeError("First parameter is undefined, expected an array");if(e===null)throw new Error("First parameter is null, expected an array");if(!Array.isArray(e))throw new Error("First parameter should be an array");if(D(r,"aboveZero","cols"),e.length===0)return;const s=i?.boundsWrap??"stop",o=Math.ceil(e.length/r),a={cols:r,rows:o};n===void 0&&(n=xt);const u=n(a,{x:0,y:0},i);for(const l of u){const c=Kr(a,l,s);if(c===void 0)return;yield[e[c],c]}}var Kr=(e,r,n)=>{if(Ht(e,"grid"),r.x<0)switch(n){case"stop":{r={...r,x:0};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r=wt(e,{x:0,y:r.y},{x:r.x,y:0},"wrap");break}}if(r.y<0)switch(n){case"stop":{r={...r,y:0};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r={...r,y:e.rows+r.y};break}}if(r.x>=e.cols)switch(n){case"stop":{r={...r,x:e.cols-1};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r={...r,x:r.x%e.cols};break}}if(r.y>=e.rows)switch(n){case"stop":{r={...r,y:e.rows-1};break}case"unbounded":throw new Error("unbounded not supported");case"undefined":return;case"wrap":{r={...r,y:r.y%e.rows};break}}return r.y*e.cols+r.x},o0=(e,r)=>{let n=0;return n=typeof e=="number"?e:e.cols,D(n,"aboveZero","colsOrGrid"),{x:r%n,y:Math.floor(r/n)}},Bl={};m(Bl,{bbox:()=>Kl,computeDimensions:()=>Jr,distanceToPoint:()=>Dl,fromPaths:()=>Wl,guardContinuous:()=>Ul,interpolate:()=>Ll,relativePosition:()=>Gl,setSegment:()=>a0,toString:()=>Jl,toSvgString:()=>Hl});var a0=(e,r,n)=>{const i=[...e.segments];return i[r]=n,Wl(...i)},Ll=(e,r,n,i)=>{i===void 0&&(i=Jr(e));const s=r*(n?i.totalWidth:i.totalLength);let o=0;const a=n?i.widths:i.lengths;for(const[u,l]of a.entries())if(o+l>=s){let f=(s-o)/l;return f>1&&(f=1),e[u].interpolate(f)}else o+=l;return{x:0,y:0}},Dl=(e,r)=>{if(e.length===0)return 0;let n=e.map((i,s)=>({path:i,index:s,distance:i.distanceToPoint(r)}));if(n=Nr(n,"distance"),n.length===0)throw new Error("Could not look up distances");return n[0].distance},Gl=(e,r,n,i)=>{i===void 0&&(i=Jr(e));let s=e.map((c,f)=>({path:c,index:f,distance:c.distanceToPoint(r)}));if(s=Nr(s,"distance"),s.length<0)throw new Error("Point does not intersect with path");const o=s[0];if(o.distance>n)throw new Error(`Point does not intersect with path. Minimum distance: ${o.distance}, threshold: ${n}`);const a=o.path.relativePosition(r,n);let u=0;for(let c=0;c<o.index;c++)u+=i.lengths[c];u+=i.lengths[o.index]*a;const l=u/i.totalLength;return console.log(`acc: ${u} rel: ${l} on path: ${a} path: ${o.index}`),l},Jr=e=>{const r=e.map(o=>o.bbox().width),n=e.map(o=>o.length());let i=0,s=0;for(const o of n)i+=o;for(const o of r)s+=o;return{totalLength:i,totalWidth:s,widths:r,lengths:n}},Kl=e=>{const n=e.map(i=>i.bbox()).flatMap(i=>rt(i));return p.bbox(...n)},Jl=e=>e.map(r=>r.toString()).join(", "),Ul=e=>{let r=Tt.getEnd(e[0]);for(let n=1;n<e.length;n++){const i=Tt.getStart(e[n]);if(!p.isEqual(i,r))throw new Error("Path index "+n+" does not start at prior path end. Start: "+i.x+","+i.y+" expected: "+r.x+","+r.y);r=Tt.getEnd(e[n])}},Hl=e=>e.flatMap(r=>r.toSvgString()),Wl=(...e)=>{Ul(e);const r=Jr(e);return Object.freeze({segments:e,length:()=>r.totalLength,nearest:n=>{throw new Error("not implemented")},interpolate:(n,i=!1)=>Ll(e,n,i,r),relativePosition:(n,i)=>Gl(e,n,i,r),distanceToPoint:n=>Dl(e,n),bbox:()=>Kl(e),toString:()=>Jl(e),toSvgString:()=>Hl(e),kind:"compound"})},Ql={};m(Ql,{fromDegrees:()=>u0});var u0=(e,r,n=0,i=0,s=360)=>({radiusX:e,radiusY:r,rotation:Fe(n),startAngle:Fe(i),endAngle:Fe(s)}),Zl={};m(Zl,{rdpPerpendicularDistance:()=>Rn,rdpShortestDistance:()=>Vn});var Vn=(e,r=.1)=>{const n=e[0],i=e.at(-1);if(e.length<3)return e;let s=-1,o=0;for(let a=1;a<e.length-1;a++){const u=c0(e[a],n,i);u>o&&(o=u,s=a)}if(o>r){const a=e.slice(0,s+1),u=e.slice(s),l=Vn(a,r),c=Vn(u,r);return[...l.slice(0,-1),...c]}else return[n,i]},Rn=(e,r=.1)=>{const n=e[0],i=e.at(-1);if(e.length<3)return e;let s=-1,o=0;for(let a=1;a<e.length-1;a++){const u=l0(e[a],n,i);u>o&&(o=u,s=a)}if(o>r){const a=e.slice(0,s+1),u=e.slice(s),l=Rn(a,r),c=Rn(u,r);return[...l.slice(0,-1),...c]}else return[n,i]};function l0(e,r,n){let i,s,o;return r.x==n.x?i=Math.abs(e.x-r.x):(s=(n.y-r.y)/(n.x-r.x),o=r.y-s*r.x,i=Math.abs(s*e.x-e.y+o)/Math.sqrt(Math.pow(s,2)+1)),i}var c0=(e,r,n)=>{const i=T(r,n);if(i==0)return T(e,r);const s=((e.x-r.x)*(n.x-r.x)+(e.y-r.y)*(n.y-r.y))/i;return s<0?T(e,r):s>1?T(e,n):T(e,{x:r.x+s*(n.x-r.x),y:r.y+s*(n.y-r.y)})},Yl={};m(Yl,{Direction:()=>Xl,QuadTreeNode:()=>ec,quadTree:()=>f0});var Xl=(e=>(e[e.Nw=0]="Nw",e[e.Ne=1]="Ne",e[e.Sw=2]="Sw",e[e.Se=3]="Se",e))(Xl||{}),f0=(e,r=[],n={})=>{const i={maxItems:n.maxItems??4,maxLevels:n.maxLevels??4},s=new ec(void 0,e,0,i);for(const o of r)s.add(o);return s},ec=class tc{constructor(r,n,i,s){this.boundary=n,this.level=i,this.opts=s,this.#r=r}#e=[];#t=[];#r;getLengthChildren(){return this.#t.length}*parents(){let r=this;for(;r.#r!==void 0;)yield r.#r,r=r.#r}getParent(){return this.#r}*children(){for(const r of this.#t)yield r}getValue(){return this.#e}getIdentity(){return this}direction(r){return this.#t[r]}add(r){if(!kl(this.boundary,r))return!1;if(this.#t.length>0){for(const n of this.#t)n.add(r);return!0}if(this.#e.push(r),this.#e.length>this.opts.maxItems&&this.level<this.opts.maxLevels){this.#t.length===0&&this.#n();for(const n of this.#e)for(const i of this.#t)i.add(n);this.#e=[]}return!0}couldHold(r){return Ut(this.boundary,r)}#n(){const r=this.boundary.width/2,n=this.boundary.height/2,i=this.boundary.x,s=this.boundary.y,a=Ci(i+r,s,i,s,i,s+n,i+r,s+n).map(u=>Se(u,r,n));this.#t=a.map(u=>new tc(this,u,this.level+1,this.opts))}},rc={};m(rc,{scaler:()=>h0});var h0=(e="both",r)=>{const n=r??Iu;let i=1,s=1,o={x:1,y:1};const a=()=>{switch(e){case"height":return{x:s,y:s};case"width":return{x:i,y:i};case"min":return{x:Math.min(i,s),y:Math.min(i,s)};case"max":return{x:Math.max(i,s),y:Math.max(i,s)};default:return{x:i,y:s}}},u=(h,d,y,w)=>{let E=Number.NaN,P=Number.NaN,z=n.width,A=n.height;if(typeof h=="number")if(E=h,typeof d=="number"){if(P=d,y===void 0)return[E,P,z,A];if(J(y))z=y.width,A=y.height;else if(typeof y=="number")if(z=y,typeof w=="number")A=w;else throw new TypeError("Missing final height value");else throw new Error("Missing valid output range")}else if(J(d))z=d.width,A=d.height;else throw new Error("Expected input y or output Rect to follow first number parameter");else if(b(h)){if(E=h.x,P=h.y,d===void 0)return[E,P,z,A];if(J(d))z=d.width,A=d.height;else if(typeof d=="number")if(z=d,typeof y=="number")A=y;else throw new TypeError("Expected height as third parameter after Point and output width");else throw new TypeError("Expected Rect or width as second parameter when first parameter is a Point")}else throw new Error("Expected input Point or x value as first parameter");return[E,P,z,A]},l=(h,d,y,w)=>{const E=u(h,d,y,w);return f(!0,...E)},c=(h,d,y,w)=>{const E=u(h,d,y,w);return f(!1,...E)},f=(h,d,y,w,E)=>{if(Number.isNaN(w))throw new Error("Output width range missing");if(Number.isNaN(E))throw new Error("Output height range missing");return(w!==i||E!==s)&&(i=w,s=E,o=a()),h?{x:d*o.x,y:y*o.y}:{x:d/o.x,y:y/o.y}};return{rel:c,abs:l,width:n.width,height:n.height}},nc={};m(nc,{boxBlurKernel:()=>g0,convolve:()=>oc,convolveCell:()=>sc,convolveImage:()=>y0,edgeDetectionKernel:()=>p0,gaussianBlur3Kernel:()=>w0,gaussianBlur5Kernel:()=>x0,identityKernel:()=>v0,kernel2dToArray:()=>ac,multiply:()=>Wt,rgbReducer:()=>uc,sharpenKernel:()=>m0,unsharpMasking5Kernel:()=>b0});var d0={};m(d0,{accessor:()=>ic});var ic=e=>{const r={rows:e.width,cols:e.height},n=e.data;return(s,o)=>{const a=Kr(r,s,o);if(a===void 0)return;const u=a*4;return{r:n[u],g:n[u+1],b:n[u+2],opacity:n[u+3]}}},Wt=(e,r)=>{const n=e.length,i=e[0].length,s=[];for(let o=0;o<n;o++){s[o]=[];for(let a=0;a<i;a++)s[o][a]=e[o][a]*r}return s};function sc(e,r,n,i,s){const o=r.map(a=>{const u=wt(n,e,a[0],"stop");return u?[a[1],i(u,"undefined")]:[a[1],void 0]});return s(o)}function*y0(e,r){const n={rows:r.width,cols:r.height},i=ic(r);yield*oc(e,n,i,xt(n),uc)}function*oc(e,r,n,i,s,o){if(!o){const u=e.length,l=e[0].length;o={x:Math.floor(u/2),y:Math.floor(l/2)}}const a=ac(e,o);for(const u of i){const l=sc(u,a,r,n,s);yield[u,l]}}var ac=(e,r)=>{const n=[],i=e.length,s=e[0].length;r||(r={x:Math.floor(i/2),y:Math.floor(s/2)});for(let o=0;o<i;o++)for(let a=0;a<s;a++)n.push([{x:o-r.x,y:a-r.y},e[o][a]]);return n},uc=e=>{let r=0,n=0,i=0;for(const o of e){const a=o[1],u=o[0];a!==void 0&&a.opacity!==0&&u!==0&&(r+=a.r*u,n+=a.g*u,i+=a.b*u)}return{r,g:n,b:i,opacity:255}},v0=[[0,0,0],[0,1,0],[0,0,0]],p0=[[0,-1,0],[-1,4,-1],[0,-1,0]],m0=[[0,-1,0],[-1,5,-1],[0,-1,0]],g0=Wt([[1,1,1],[1,1,1],[1,1,1]],1/9),w0=Wt([[1,2,1],[2,4,2],[1,2,1]],1/16),x0=Wt([[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,16,4],[1,4,6,4,1]],1/256),b0=Wt([[1,4,6,4,1],[4,16,24,16,4],[6,24,-476,24,6],[4,16,24,16,4],[1,4,6,4,1]],-1/256),lc={};m(lc,{bbox:()=>dc,distanceCenter:()=>M0,fromDegrees:()=>E0,guard:()=>_i,interpolate:()=>Oi,isArc:()=>cc,isEqual:()=>z0,isPositioned:()=>pe,length:()=>hc,point:()=>xr,toLine:()=>fc,toPath:()=>N0,toSvg:()=>yc});var cc=e=>e.startRadian!==void 0&&e.endRadian!==void 0,pe=e=>e.x!==void 0&&e.y!==void 0,vs=Math.PI*2;function E0(e,r,n,i){const s={radius:e,startRadian:Fe(r),endRadian:Fe(n)};if(b(i)){N(i);const o={...s,x:i.x,y:i.y};return Object.freeze(o)}else return Object.freeze(s)}var fc=e=>gi.fromPoints(xr(e,e.startRadian),xr(e,e.endRadian)),xr=(e,r,n)=>{if(r>e.endRadian)throw new Error("angleRadian beyond end angle of arc");if(r<e.startRadian)throw new Error("angleRadian beyond start angle of arc");return n===void 0&&(n=pe(e)?e:{x:0,y:0}),{x:Math.cos(r)*e.radius+n.x,y:Math.sin(r)*e.radius+n.y}},_i=e=>{if(e===void 0)throw new Error("Arc is undefined");if(pe(e)&&N(e,"arc"),e.radius===void 0)throw new Error(`Arc radius is undefined (${JSON.stringify(e)})`);if(typeof e.radius!="number")throw new Error("Radius must be a number");if(Number.isNaN(e.radius))throw new Error("Radius is NaN");if(e.radius<=0)throw new Error("Radius must be greater than zero");if(e.startRadian===void 0)throw new Error("Arc is missing 'startRadian' field");if(e.endRadian===void 0)throw new Error("Arc is missing 'startRadian' field");if(Number.isNaN(e.endRadian))throw new Error("Arc endRadian is NaN");if(Number.isNaN(e.startRadian))throw new Error("Arc endRadian is NaN");if(e.startRadian>=e.endRadian)throw new Error("startRadian is expected to be les than endRadian")},Oi=(e,r,n)=>(_i(r),xr(r,r.startRadian+(r.endRadian-r.startRadian)*e,n)),N0=e=>(_i(e),Object.freeze({...e,nearest:r=>{throw new Error("not implemented")},interpolate:r=>Oi(r,e),bbox:()=>dc(e),length:()=>hc(e),toSvgString:()=>yc(e),relativePosition:(r,n)=>{throw new Error("Not implemented")},distanceToPoint:r=>{throw new Error("Not implemented")},kind:"arc"})),hc=e=>vs*e.radius*((e.startRadian-e.endRadian)/vs),dc=e=>{if(pe(e)){const r=Oi(.5,e),n=fc(e);return Ii(r,n.a,n.b)}else return{width:e.radius*2,height:e.radius*2}},yc=(e,r,n,i,s)=>{if(cc(e))return pe(e)?ir(e,e.radius,e.startRadian,e.endRadian,r):b(r)?ir(r,e.radius,e.startRadian,e.endRadian,n):ir({x:0,y:0},e.radius,e.startRadian,e.endRadian);if(n===void 0)throw new Error("startAngle undefined");if(i===void 0)throw new Error("endAngle undefined");if(b(e)){if(typeof r=="number"&&typeof n=="number"&&typeof i=="number")return ir(e,r,n,i,s);throw new TypeError("Expected (point, number, number, number). Missing a number param.")}else throw new Error("Expected (point, number, number, number). Missing first point.")},ir=(e,r,n,i,s)=>{(s===void 0||typeof s!="object")&&(s={});const o=i-n===360,a=Pe(r,i-.01,e),u=Pe(r,n,e),{largeArc:l=!1,sweep:c=!1}=s,f=[`
    M ${a.x} ${a.y}
    A ${r} ${r} 0 ${l?"1":"0"} ${c?"1":"0"} ${u.x} ${u.y},
  `];return o&&f.push("z"),f},M0=(e,r)=>T(e,r),z0=(e,r)=>e.radius!==r.radius?!1:pe(e)&&pe(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):!(!(!pe(e)&&!pe(r))||e.endRadian!==r.endRadian||e.startRadian!==r.startRadian),vc={};m(vc,{clampMagnitude:()=>V0,divide:()=>q0,dotProduct:()=>C0,fromLineCartesian:()=>A0,fromLinePolar:()=>k0,fromPointPolar:()=>pc,fromRadians:()=>P0,multiply:()=>O0,normalise:()=>j0,quadrantOffsetAngle:()=>T0,subtract:()=>_0,sum:()=>R0,toCartesian:()=>xe,toPolar:()=>Qt,toRadians:()=>S0,toString:()=>I0});var $0=Object.freeze({x:0,y:0}),or=Math.PI*2,br=Math.PI,P0=e=>Object.freeze({x:Math.cos(e),y:Math.sin(e)}),S0=e=>Math.atan2(e.y,e.x),pc=(e,r="",n=$0)=>{e=Y(e,n);let i=Math.atan2(e.y,e.x);return r==="unipolar"&&i<0?i+=or:r==="bipolar"&&(i>br?i-=or:i<=-br&&(i+=or)),Object.freeze({distance:T(e),angleRadian:i})},A0=e=>Y(e.b,e.a),k0=e=>{qr(e,"line");const r=Y(e.b,e.a);return pc(r)},ne=e=>!!xi(e),Ge=e=>!!b(e),j0=e=>{if(ne(e))return su(e);if(Ge(e))return rl(e);throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},T0=e=>e.x>=0&&e.y>=0?0:e.x<0&&e.y>=0||e.x<0&&e.y<0?br:or,Qt=(e,r=De)=>{if(ne(e))return e;if(Ge(e))return bi(e,r);throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},xe=e=>{if(ne(e))return lu(e);if(Ge(e))return e;throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},I0=(e,r)=>{if(ne(e))return uu(e,r);if(Ge(e))return gr(e,r);throw new Error(`Expected polar/cartesian vector. Got: ${e}`)},C0=(e,r)=>{if(ne(e)&&ne(r))return ou(e,r);if(Ge(e)&&Ge(r))return Qu(e,r);throw new Error("Expected two polar/Cartesian vectors.")},V0=(e,r=1,n=0)=>{if(ne(e))return au(e,r,n);if(Ge(e))return nl(e,r,n);throw new Error("Expected either polar or Cartesian vector")},R0=(e,r)=>{const n=ne(e);e=xe(e),r=xe(r);const i=ft(e,r);return n?Qt(i):i},_0=(e,r)=>{const n=ne(e);e=xe(e),r=xe(r);const i=Y(e,r);return n?Qt(i):i},O0=(e,r)=>{const n=ne(e);e=xe(e),r=xe(r);const i=Ft(e,r);return n?Qt(i):i},q0=(e,r)=>{const n=ne(e);e=xe(e),r=xe(r);const i=wr(e,r);return n?Qt(i):i},mc={};m(mc,{circleRings:()=>J0,circleVogelSpiral:()=>K0,sphereFibonacci:()=>U0});var qi=Math.cos,Fi=Math.sin,F0=Math.asin,Bi=Math.sqrt,B0=Math.pow,Li=Math.PI,L0=Math.PI*2,D0=Li*(3-Bi(5)),G0=(1+Bi(5))/2;function*K0(e,r={}){const n=r.maxPoints??5e3,i=r.density??.95,s=r.rotation??0,o=zi(e??{radius:1,x:0,y:0}),a=o.radius;let u=o.radius*ct(i,0,1,.3,.01);r.spacing&&(u=r.spacing);let l=0,c=0,f=0;for(;c<n&&l<a;)l=u*c**.5,f=s+c*2*Li/G0,yield Object.freeze({x:o.x+l*qi(f),y:o.y+l*Fi(f)}),c++}function*J0(e,r={}){const n=r.rings??5,i=zi(e??{radius:1,x:0,y:0}),s=1/n,o=r.rotation??0;let a=1;yield Object.freeze({x:i.x,y:i.y});for(let u=s;u<=1;u+=s){const l=Math.round(Li/F0(1/(2*a)));for(const c of Wu(0,L0,l+1))yield Object.freeze({x:i.x+u*qi(c+o)*i.radius,y:i.y+u*Fi(c+o)*i.radius});a++}}function*U0(e=100,r=0,n){const i=2/e,s=n??{x:0,y:0,z:0,radius:1};for(let o=0;o<e;o++){const a=o*i-1+i/2,u=Bi(1-B0(a,2)),l=(o+1)%e*D0+r,c=qi(l)*u,f=Fi(l)*u;yield Object.freeze({x:s.x+c*s.radius,y:s.y+a*s.radius,z:s.z+f*s.radius})}}var Be={};m(Be,{Empty:()=>Ag,Equilateral:()=>xc,Isosceles:()=>Ec,Placeholder:()=>kg,Right:()=>bc,angles:()=>Zt,anglesDegrees:()=>_g,apply:()=>Ig,area:()=>wc,barycentricCoord:()=>Pc,barycentricToCartestian:()=>Wg,bbox:()=>$c,centroid:()=>Zr,corners:()=>Rg,edges:()=>Ur,equilateralFromVertex:()=>Jg,fromFlatArray:()=>Hg,fromPoints:()=>Gi,fromRadius:()=>Gg,guard:()=>X,innerCircle:()=>Dg,intersectsPoint:()=>Qg,isAcute:()=>Bg,isEmpty:()=>jg,isEqual:()=>Vg,isEquilateral:()=>Og,isIsosceles:()=>qg,isOblique:()=>Fg,isObtuse:()=>Lg,isPlaceholder:()=>Tg,isRightAngle:()=>zc,isTriangle:()=>Cg,lengths:()=>Di,outerCircle:()=>H0,perimeter:()=>gc,rotate:()=>Zg,rotateByVertex:()=>Kg,toFlatArray:()=>Ug});var X=(e,r="t")=>{if(e===void 0)throw new Error("{$name} undefined");N(e.a,r+".a"),N(e.b,r+".b"),N(e.c,r+".c")},Ur=e=>(X(e),Lr(e.a,e.b,e.c,e.a)),gc=e=>(X(e),Ur(e).reduce((r,n)=>r+U(n),0)),wc=e=>{X(e,"t");const r=Ur(e).map(i=>U(i)),n=(r[0]+r[1]+r[2])/2;return Math.sqrt(n*(n-r[0])*(n-r[1])*(n-r[2]))},H0=e=>{const[r,n,i]=Ur(e).map(a=>U(a)),s=Zr(e);return{radius:r*n*i/Math.sqrt((r+n+i)*(-r+n+i)*(r-n+i)*(r+n-i)),...s}},xc={};m(xc,{area:()=>tg,centerFromA:()=>Q0,centerFromB:()=>Z0,centerFromC:()=>Y0,circumcircle:()=>rg,fromCenter:()=>W0,height:()=>X0,incircle:()=>Hr,perimeter:()=>eg});var ps=Math.PI*4/3,ms=Math.PI*2/3,je=e=>typeof e=="number"?e:e.length,W0=(e,r,n)=>{r||(r=Object.freeze({x:0,y:0}));const i=je(e)/Math.sqrt(3),s=n??Math.PI*1.5,o={x:i*Math.cos(s)+r.x,y:i*Math.sin(s)+r.y},a={x:i*Math.cos(s+ps)+r.x,y:i*Math.sin(s+ps)+r.y},u={x:i*Math.cos(s+ms)+r.x,y:i*Math.sin(s+ms)+r.y};return Object.freeze({a,b:o,c:u})},Q0=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=je(e),{radius:i}=Hr(e);return{x:r.x+n/2,y:r.y-i}},Z0=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const{radius:n}=Hr(e);return{x:r.x,y:r.y+n*2}},Y0=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=je(e),{radius:i}=Hr(e);return{x:r.x-n/2,y:r.y-i}},X0=e=>Math.sqrt(3)/2*je(e),eg=e=>je(e)*3,tg=e=>Math.pow(je(e),2)*Math.sqrt(3)/4,rg=e=>({radius:Math.sqrt(3)/3*je(e)}),Hr=e=>({radius:Math.sqrt(3)/6*je(e)}),bc={};m(bc,{adjacentFromHypotenuse:()=>vg,adjacentFromOpposite:()=>pg,angleAtPointA:()=>ug,angleAtPointB:()=>lg,area:()=>ag,circumcircle:()=>fg,fromA:()=>ng,fromB:()=>ig,fromC:()=>sg,height:()=>Wr,hypotenuseFromAdjacent:()=>gg,hypotenuseFromOpposite:()=>mg,hypotenuseSegments:()=>Qr,incircle:()=>hg,medians:()=>cg,oppositeFromAdjacent:()=>dg,oppositeFromHypotenuse:()=>yg,perimeter:()=>og,resolveLengths:()=>ee});var ng=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=ee(e),i=Qr(e),s=Wr(e),o={x:r.x,y:r.y},a={x:r.x+n.hypotenuse,y:r.y},u={x:r.x+i[1],y:r.y-s};return{a:o,b:a,c:u}},ig=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=ee(e),i=Qr(e),s=Wr(e),o={x:r.x,y:r.y},a={x:r.x-n.hypotenuse,y:r.y},u={x:r.x-i[0],y:r.y-s};return{a,b:o,c:u}},sg=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=Qr(e),i=Wr(e),s={x:r.x,y:r.y},o={x:r.x-n[1],y:r.y+i},a={x:r.x+n[0],y:r.y+i};return{a:o,b:a,c:s}},ee=e=>{const r=e.adjacent,n=e.opposite,i=e.hypotenuse;if(r!==void 0&&n!==void 0)return{...e,adjacent:r,opposite:n,hypotenuse:Math.hypot(r,n)};if(r&&i)return{...e,adjacent:r,hypotenuse:i,opposite:i*i-r*r};if(n&&i)return{...e,hypotenuse:i,opposite:n,adjacent:i*i-n*n};if(e.opposite&&e.hypotenuse&&e.adjacent)return e;throw new Error("Missing at least two edges")},Wr=e=>{const r=ee(e),n=r.opposite*r.opposite/r.hypotenuse,i=r.adjacent*r.adjacent/r.hypotenuse;return Math.sqrt(n*i)},Qr=e=>{const r=ee(e),n=r.opposite*r.opposite/r.hypotenuse,i=r.adjacent*r.adjacent/r.hypotenuse;return[n,i]},og=e=>{const r=ee(e);return r.adjacent+r.hypotenuse+r.opposite},ag=e=>{const r=ee(e);return r.opposite*r.adjacent/2},ug=e=>{const r=ee(e);return Math.acos((r.adjacent*r.adjacent+r.hypotenuse*r.hypotenuse-r.opposite*r.opposite)/(2*r.adjacent*r.hypotenuse))},lg=e=>{const r=ee(e);return Math.acos((r.opposite*r.opposite+r.hypotenuse*r.hypotenuse-r.adjacent*r.adjacent)/(2*r.opposite*r.hypotenuse))},cg=e=>{const r=ee(e),n=r.adjacent*r.adjacent,i=r.hypotenuse*r.hypotenuse,s=r.opposite*r.opposite;return[Math.sqrt(2*(n+i)-s)/2,Math.sqrt(2*(i+s)-n)/2,Math.sqrt(2*(s+n)-i)/2]},fg=e=>({radius:ee(e).hypotenuse/2}),hg=e=>{const r=ee(e);return{radius:(r.adjacent+r.opposite-r.hypotenuse)/2}},dg=(e,r)=>Math.tan(e)*r,yg=(e,r)=>Math.sin(e)*r,vg=(e,r)=>Math.cos(e)*r,pg=(e,r)=>r/Math.tan(e),mg=(e,r)=>r/Math.sin(e),gg=(e,r)=>r/Math.cos(e),Ec={};m(Ec,{apexAngle:()=>wg,area:()=>Eg,baseAngle:()=>Nc,circumcircle:()=>Ng,fromA:()=>$g,fromB:()=>Pg,fromC:()=>Sg,fromCenter:()=>zg,height:()=>Te,incircle:()=>Mc,legHeights:()=>xg,medians:()=>Mg,perimeter:()=>bg});var Nc=e=>Math.acos(e.base/(2*e.legs)),wg=e=>{const r=e.legs*e.legs,n=e.base*e.base;return Math.acos((2*r-n)/(2*r))},Te=e=>{const r=e.legs*e.legs,n=e.base*e.base;return Math.sqrt((4*r-n)/4)},xg=e=>{const r=Nc(e);return e.base*Math.sin(r)},bg=e=>2*e.legs+e.base,Eg=e=>Te(e)*e.base/2,Ng=e=>{const r=Te(e),n=r*r,i=e.base*e.base;return{radius:(4*n+i)/(8*r)}},Mc=e=>{const r=Te(e);return{radius:e.base*r/(2*e.legs+e.base)}},Mg=e=>{const r=e.legs*e.legs,n=e.base*e.base,i=Math.sqrt(r+2*n)/2,s=Math.sqrt(4*r-n)/2;return[i,i,s]},zg=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=Te(e),i=Mc(e).radius,s=n-i,o={x:r.x-e.base/2,y:r.y+i},a={x:r.x+e.base/2,y:r.y+i},u={x:r.x,y:r.y-s};return{a:o,b:a,c:u}},$g=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=Te(e),i={x:r.x,y:r.y},s={x:r.x+e.base,y:r.y},o={x:r.x+e.base/2,y:r.y-n};return{a:i,b:s,c:o}},Pg=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=Te(e),i={x:r.x,y:r.y},s={x:r.x-e.base,y:r.y},o={x:r.x-e.base/2,y:r.y-n};return{a:s,b:i,c:o}},Sg=(e,r)=>{r||(r=Object.freeze({x:0,y:0}));const n=Te(e),i={x:r.x,y:r.y},s={x:r.x-e.base/2,y:r.y+n},o={x:r.x+e.base/2,y:r.y+n};return{a:s,b:o,c:i}},gs=Math.PI*2,Ag=Object.freeze({a:{x:0,y:0},b:{x:0,y:0},c:{x:0,y:0}}),kg=Object.freeze({a:{x:Number.NaN,y:Number.NaN},b:{x:Number.NaN,y:Number.NaN},c:{x:Number.NaN,y:Number.NaN}}),jg=e=>et(e.a)&&et(e.b)&&et(e.c),Tg=e=>tt(e.a)&&tt(e.b)&&tt(e.c),Ig=(e,r)=>Object.freeze({...e,a:r(e.a,"a"),b:r(e.b,"b"),c:r(e.c,"c")}),Cg=e=>{if(e===void 0)return!1;const r=e;return!(!b(r.a)||!b(r.b)||!b(r.c))},Vg=(e,r)=>me(e.a,r.a)&&me(e.b,r.b)&&me(e.c,r.c),Rg=e=>(X(e),[e.a,e.b,e.c]),Di=e=>(X(e),[T(e.a,e.b),T(e.b,e.c),T(e.c,e.a)]),Zt=e=>(X(e),[jt(e.a,e.b),jt(e.b,e.c),jt(e.c,e.a)]),_g=e=>(X(e),wi(Zt(e))),Og=e=>{X(e);const[r,n,i]=Di(e);return r===n&&n===i},qg=e=>{const[r,n,i]=Di(e);return r===n||n===i||i===r},zc=e=>Zt(e).includes(Math.PI/2),Fg=e=>!zc(e),Bg=e=>!Zt(e).some(r=>r>=Math.PI/2),Lg=e=>Zt(e).some(r=>r>Math.PI/2),Zr=e=>{X(e);const r=el([e.a,e.b,e.c],(i,s)=>({x:i.x+s.x,y:i.y+s.y}));return{x:r.x/3,y:r.y/3}},Dg=e=>{const r=Zr(e),n=gc(e)/2;return{radius:wc(e)/n,...r}},Gg=(e,r,n={})=>{g(r,"positive","radius"),N(e,"origin");const i=n.initialAngleRadian??0,o=[i,i+gs*1/3,i+gs*2/3].map(a=>Pe(r,a,e));return Gi(o)},Kg=(e,r,n="b")=>{const i=n==="a"?e.a:n==="b"?e.b:e.c;return Object.freeze({a:ge(e.a,r,i),b:ge(e.b,r,i),c:ge(e.c,r,i)})},Jg=(e,r=10,n=Math.PI/2)=>{e||(e=Object.freeze({x:0,y:0}));const i=Tn(e,r,Math.PI- -n/2),s=Tn(e,r,Math.PI-n/2);return{a:i,b:e,c:s}},Ug=e=>(X(e),[e.a.x,e.a.y,e.b.x,e.b.y,e.c.x,e.c.y]),Hg=e=>{if(!Array.isArray(e))throw new Error("coords expected as array");if(e.length!==6)throw new Error(`coords array expected with 6 elements. Got ${e.length}`);return Gi(Ci(...e))},Gi=e=>{if(!Array.isArray(e))throw new Error("points expected as array");if(e.length!==3)throw new Error(`points array expected with 3 elements. Got ${e.length}`);return{a:e[0],b:e[1],c:e[2]}},$c=(e,r=0)=>{const{a:n,b:i,c:s}=e,o=Math.min(n.x,i.x,s.x)-r,a=Math.max(n.x,i.x,s.x)+r,u=Math.min(n.y,i.y,s.y)-r,l=Math.max(n.y,i.y,s.y)+r;return{x:o,y:u,width:a-o,height:l-u}},Pc=(e,r,n)=>{const i=le(r,n),s=(l,c,f,h)=>(f.y-h.y)*l+(h.x-f.x)*c+f.x*h.y-h.x*f.y,o=s(i.x,i.y,e.b,e.c)/s(e.a.x,e.a.y,e.b,e.c),a=s(i.x,i.y,e.c,e.a)/s(e.b.x,e.b.y,e.c,e.a),u=s(i.x,i.y,e.a,e.b)/s(e.c.x,e.c.y,e.a,e.b);return{a:o,b:a,c:u}},Wg=(e,r)=>{X(e);const{a:n,b:i,c:s}=e,o=n.x*r.a+i.x*r.b+s.x*r.c,a=n.y*r.a+i.y*r.b+s.y*r.c;if(n.z&&i.z&&s.z){const u=n.z*r.a+i.z*r.b+s.z*r.c;return Object.freeze({x:o,y:a,z:u})}else return Object.freeze({x:o,y:a})},Qg=(e,r,n)=>{const i=$c(e),s=le(r,n);if(!Ut(i,s))return!1;const o=Pc(e,s);return 0<=o.a&&o.a<=1&&0<=o.b&&o.b<=1&&0<=o.c&&o.c<=1},Zg=(e,r,n)=>r===void 0||r===0?e:(n===void 0&&(n=Zr(e)),Object.freeze({...e,a:ge(e.a,r,n),b:ge(e.b,r,n),c:ge(e.c,r,n)}));export{Pa as $,Jn as A,du as B,Wh as C,_s as D,Zy as E,Xy as F,Ee as G,Rg as H,d0 as I,rt as J,Iu as K,kr as L,ws as M,zh as N,ho as O,So as P,Mh as Q,Yd as R,eu as S,K as T,Ke as U,oa as V,ue as W,At as X,Fn as Y,Qe as Z,nf as _,Si as a,Ud as a$,sf as a0,yt as a1,yo as a2,ey as a3,Ve as a4,Yy as a5,ah as a6,Tr as a7,lr as a8,xf as a9,Rd as aA,rw as aB,tw as aC,nv as aD,sw as aE,aw as aF,ow as aG,op as aH,Nn as aI,Vd as aJ,ew as aK,Je as aL,ry as aM,ny as aN,Xg as aO,Fs as aP,Hs as aQ,af as aR,fh as aS,Ln as aT,Eo as aU,mh as aV,mo as aW,gf as aX,eh as aY,bt as aZ,oo as a_,Td as aa,wl as ab,le as ac,zv as ad,Ft as ae,Y as af,Hi as ag,rc as ah,vm as ai,gi as aj,vc as ak,T as al,Kp as am,jt as an,nw as ao,ev as ap,Rv as aq,st as ar,lh as as,be as at,Ti as au,nh as av,Yn as aw,rv as ax,tv as ay,Wi as az,yh as b,Jd as b0,Ip as b1,Hd as b2,bo as b3,Ql as b4,Tl as b5,wi as b6,qt as b7,lc as b8,wu as b9,ka as ba,Fe as bb,Xa as bc,Hh as bd,vo as c,qu as d,Ru as e,Bv as f,N as g,iw as h,_r as i,Jo as j,Kv as k,p as l,Er as m,Lv as n,jd as o,Dv as p,Wv as q,lf as r,Ut as s,of as t,ct as u,qv as v,Gp as w,Ls as x,re as y,sp as z};
