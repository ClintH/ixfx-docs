import{g as Ss,f as ns,i as N,r as ar,c as Ee,a as ks,d as Lc,e as Bs,w as Vc,s as Gt,h as Ts,j as qc,k as wn,S as Pe,u as zc,m as jc,l as Wc,I as Oc,n as Uc,o as L,p as ur,t as lr,q as Hc,v as Gc,x as Yc,y as Xc,z as Jc,A as Kc,B as Zc,D as Qc,E as ed,F as td,G as rd,H as nd,J as id,K as _s,L as Dn,M as sd,N as od,O as ad,P as ud,Q as is,R as ld,T as cd,U as dd,V as fd,W as hd,X as vd,Y as Kr,Z as md,_ as Ps,$ as En,a0 as Ns,a1 as Ke,a2 as _t,a3 as Rs,a4 as pd,a5 as gd,a6 as ss,a7 as Ms,C as $s,a8 as Is,a9 as Zr,aa as Ls,ab as yd,ac as wd,ad as Dd,ae as cr,af as Ed,ag as bd,ah as Ad,ai as ut,aj as Cd,ak as xd,al as Fd,am as bn,an as Sd,ao as kd,ap as Bd,aq as Vs,ar as qs,as as Ur,at as os,au as Td,av as as,aw as _d,ax as Pd,ay as Yt,az as Nd,aA as Rd,aB as Md,aC as us,aD as $d,aE as zs,aF as js,aG as Id,aH as lt,aI as Ws,aJ as Os,aK as Ft,aL as Ut,aM as Ld,aN as Vd,aO as ls,aP as qd,aQ as cs,aR as zd,aS as jd,aT as Us,aU as bt,aV as Wd,aW as Od,aX as Ud,aY as ds,aZ as Hd,a_ as Gd,a$ as C,b0 as st,b1 as Qr,b2 as Yd,b3 as fs,b4 as Xd,b5 as Hs,b6 as Jd,b7 as Kd,b8 as Zd,b9 as hs,ba as Qd,bb as ef,bc as vs,bd as tf,be as ms,bf as ps,bg as rf,bh as Hr,bi as Gr,bj as nf,bk as sf,bl as of,bm as af,bn as uf,bo as lf,bp as cf,bq as df,br as ff}from"./chunk-H62DA3UX.2f4e44f0.js";import{_ as x,s as Gs,d as dr,t as M,a as Xt,n as Jt,i as en,b as be,c as hf,e as vf,f as Kt,o as Zt,g as An,h as mf,j as gs,k as fr,l as Ys}from"./chunk-QRUAJLXP.d4cb917b.js";var Cn={};x(Cn,{Elements:()=>Qt,applyOpts:()=>Ne,applyPathOpts:()=>Fn,applyStrokeOpts:()=>qe,clear:()=>yf,createEl:()=>hr,createOrResolve:()=>_e,getBounds:()=>wf,makeHelper:()=>Ef,remove:()=>so,setBounds:()=>Df});var pf=(e,t,r)=>{const n=hr("marker",e);if(t.markerWidth&&n.setAttribute("markerWidth",t.markerWidth?.toString()),t.markerHeight&&n.setAttribute("markerHeight",t.markerHeight?.toString()),t.orient?n.setAttribute("orient",t.orient.toString()):n.setAttribute("orient","auto-start-reverse"),t.viewBox&&n.setAttribute("viewBox",t.viewBox.toString()),t.refX&&n.setAttribute("refX",t.refX.toString()),t.refY&&n.setAttribute("refY",t.refY.toString()),r){const i=r();n.appendChild(i)}return n},Yr=(e,t,r)=>{if(e===null)return"(elem null)";const n=e.ownerSVGElement;if(n===null)throw new Error("parent for elem is null");const i=_e(n,"defs","defs");let s=i.querySelector(`#${t.id}`);if(s!==null)return`url(#${t.id})`;if(t.id==="triangle")t={...t,strokeStyle:"transparent"},t.markerHeight||(t={...t,markerHeight:6}),t.markerWidth||(t={...t,markerWidth:6}),t.refX||(t={...t,refX:t.markerWidth}),t.refY||(t={...t,refY:t.markerHeight}),(!t.fillStyle||t.fillStyle==="none")&&(t={...t,fillStyle:"black"}),t.viewBox||(t={...t,viewBox:"0 0 10 10"}),s=pf(t.id,t,()=>{const o=hr("path");return o.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t&&Ne(o,t),o});else throw new Error(`Do not know how to make ${t.id}`);return s.id=t.id,i.appendChild(s),`url(#${t.id})`},Qt={};x(Qt,{circle:()=>Zs,circleUpdate:()=>Ks,grid:()=>io,group:()=>gf,groupUpdate:()=>Qs,line:()=>er,lineUpdate:()=>eo,path:()=>Xs,pathUpdate:()=>Js,text:()=>no,textPath:()=>ro,textPathUpdate:()=>to,textUpdate:()=>xn});var ys=e=>e>=0&&e<=1?`${e*100}%`:e.toString(),Xs=(e,t,r,n)=>{const i=_e(t,"path",n),s=typeof e=="string"?e:e.join(`
`);return i.setAttributeNS(null,"d",s),t.append(i),Js(i,r)},Js=(e,t)=>(t&&Ne(e,t),t&&qe(e,t),e),Ks=(e,t,r)=>(e.setAttributeNS(null,"cx",t.x.toString()),e.setAttributeNS(null,"cy",t.y.toString()),e.setAttributeNS(null,"r",t.radius.toString()),r&&Ne(e,r),r&&qe(e,r),e),Zs=(e,t,r,n)=>{const i=_e(t,"circle",n);return Ks(i,e,r)},gf=(e,t,r)=>{const n=_e(t,"g",r);return Qs(n,e)},Qs=(e,t)=>{for(const r of t)r.parentNode!==e&&e.append(r);return e},er=(e,t,r,n)=>{const i=_e(t,"line",n);return eo(i,e,r)},eo=(e,t,r)=>(e.setAttributeNS(null,"x1",t.a.x.toString()),e.setAttributeNS(null,"y1",t.a.y.toString()),e.setAttributeNS(null,"x2",t.b.x.toString()),e.setAttributeNS(null,"y2",t.b.y.toString()),r&&Ne(e,r),r&&Fn(e,r),r&&qe(e,r),e),to=(e,t,r)=>(r?.method&&e.setAttributeNS(null,"method",r.method),r?.side&&e.setAttributeNS(null,"side",r.side),r?.spacing&&e.setAttributeNS(null,"spacing",r.spacing),r?.startOffset&&e.setAttributeNS(null,"startOffset",ys(r.startOffset)),r?.textLength&&e.setAttributeNS(null,"textLength",ys(r.textLength)),t&&(e.textContent=t),r&&Ne(e,r),r&&qe(e,r),e),ro=(e,t,r,n,i,s)=>{const o=_e(r,"text",i,"-text");xn(o,void 0,void 0,n);const a=_e(o,"textPath",s);return a.setAttributeNS(null,"href",e),to(a,t,n)},xn=(e,t,r,n)=>(t&&(e.setAttributeNS(null,"x",t.x.toString()),e.setAttributeNS(null,"y",t.y.toString())),r&&(e.textContent=r),n&&(Ne(e,n),n&&qe(e,n),n.anchor&&e.setAttributeNS(null,"text-anchor",n.anchor),n.align&&e.setAttributeNS(null,"alignment-baseline",n.align),(n.userSelect??!0)||(e.style.userSelect="none",e.style.webkitUserSelect="none")),e),no=(e,t,r,n,i)=>{const s=_e(t,"text",i);return xn(s,r,e,n)},io=(e,t,r,n,i,s={})=>{s.strokeStyle||(s={...s,strokeStyle:Ss("bg-dim","silver")}),s.strokeWidth||(s={...s,strokeWidth:1});const o=hr("g");Ne(o,s),Fn(o,s),qe(o,s);let a=0;for(;a<i;){const l=ns(0,a,n,a);er(l,o),a+=r}let u=0;for(;u<n;){const l=ns(u,0,u,i);er(l,o),u+=r}return e.append(o),o},_e=(e,t,r,n)=>{let i=null;if(r!==void 0&&(i=typeof r=="string"?e.querySelector(r):r),i===null){const s=document.createElementNS("http://www.w3.org/2000/svg",t);return e.append(s),r&&typeof r=="string"&&r.startsWith("#")&&(s.id=n!==void 0&&!r.endsWith(n)?r.slice(1)+n:r.slice(1)),s}return i},so=(e,t)=>{if(typeof t=="string"){const r=e.querySelector(t);if(r===null)return;r.remove()}else t.remove()},yf=e=>{let t=e.lastElementChild;for(;t;)t.remove(),t=e.lastElementChild},hr=(e,t)=>{const r=document.createElementNS("http://www.w3.org/2000/svg",e);return t&&(r.id=t),r},Fn=(e,t)=>{t.markerEnd&&e.setAttribute("marker-end",Yr(e,t.markerEnd)),t.markerStart&&e.setAttribute("marker-start",Yr(e,t.markerStart)),t.markerMid&&e.setAttribute("marker-mid",Yr(e,t.markerMid))},Ne=(e,t)=>{t.fillStyle&&e.setAttributeNS(null,"fill",t.fillStyle),t.opacity&&e.setAttributeNS(null,"opacity",t.opacity.toString())},qe=(e,t)=>{t.strokeStyle&&e.setAttributeNS(null,"stroke",t.strokeStyle),t.strokeWidth&&e.setAttributeNS(null,"stroke-width",t.strokeWidth.toString()),t.strokeDash&&e.setAttribute("stroke-dasharray",t.strokeDash),t.strokeLineCap&&e.setAttribute("stroke-linecap",t.strokeLineCap)},wf=e=>{const t=e.getAttributeNS(null,"width"),r=t===null?0:Number.parseFloat(t),n=e.getAttributeNS(null,"height"),i=n===null?0:Number.parseFloat(n);return{width:r,height:i}},Df=(e,t)=>{e.setAttributeNS(null,"width",t.width.toString()),e.setAttributeNS(null,"height",t.height.toString())},Ef=(e,t)=>(t&&(Ne(e,t),qe(e,t)),{remove:n=>{so(e,n)},text:(n,i,s,o)=>no(n,e,i,s,o),textPath:(n,i,s,o,a)=>ro(n,i,e,s,o,a),line:(n,i,s)=>er(n,e,i,s),circle:(n,i,s)=>Zs(n,e,i,s),path:(n,i,s)=>Xs(n,e,i,s),grid:(n,i,s,o,a)=>io(e,n,i,s,o,a),query:n=>e.querySelector(n),get width(){const n=e.getAttributeNS(null,"width");return n===null?0:Number.parseFloat(n)},set width(n){e.setAttributeNS(null,"width",n.toString())},get parent(){return e},get height(){const n=e.getAttributeNS(null,"height");return n===null?0:Number.parseFloat(n)},set height(n){e.setAttributeNS(null,"height",n.toString())},clear:()=>{for(;e.firstChild;)e.lastChild.remove()}});function bf(e){const t=vr(N(e,0),{timer:Re()});return()=>t.isDone}var Af=e=>()=>ze(e,{timer:Re()}),vr=(e,t={})=>{const r=t.clampValue??!1,n=t.wrapValue??!1;if(r&&n)throw new Error("clampValue and wrapValue cannot both be enabled");let i=1;const s=t.timer??Re(),o=()=>{let a=s.elapsed/(e*i);return r?a=Ee(a):n&&a>=1&&(a=a%1),a};return{mod(a){i=a},get isDone(){return o()>=1},get elapsed(){return o()},reset:()=>{s.reset()}}},ze=(e,t={})=>{const r=t.timer??Re(),n=e/1e3;let i=1;const s=()=>{const o=r.elapsed*(n*i),a=o-Math.floor(o);if(a<0)throw new Error(`Unexpected cycle fraction less than 0. Elapsed: ${o} f: ${a}`);if(a>1)throw new Error(`Unexpected cycle fraction more than 1. Elapsed: ${o} f: ${a}`);return a};return{mod:o=>{i=o},reset:()=>{r.reset()},get isDone(){return s()>=1},get elapsed(){return s()}}},Re=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e}}},oo=()=>{let e=0;return{reset:()=>{e=0},get elapsed(){return++e}}},Ze={};x(Ze,{infinity:()=>ao,interval:()=>Cf,once:()=>xf,progress:()=>uo,since:()=>tr,toString:()=>Sn});var tr=()=>{const e=performance.now();return()=>performance.now()-e},Cf=()=>{let e=performance.now();return()=>{const t=performance.now(),r=t-e;return e=t,r}},xf=()=>{const e=Date.now();let t=0;return()=>(t===0&&(t=Date.now()-e),t)},ao=()=>()=>Number.POSITIVE_INFINITY;function uo(e,t={}){const r=N(e);if(!r)throw new Error("duration invalid");const n={...t,timer:Re()},i=vr(r,n);return()=>i.elapsed}var Sn=(e,t=2)=>{let r=0;if(typeof e=="function"){const i=e();return Sn(i)}else typeof e=="number"?r=e:typeof e=="object"&&(r=N(r));let n=N(r);return typeof n>"u"?"(undefined)":n<1e3?`${ar(t,n)}ms`:(n/=1e3,n<120?`${n.toFixed(1)}secs`:(n/=60,n<60?`${n.toFixed(2)}mins`:(n/=60,`${n.toFixed(2)}hrs`)))},Ff={};x(Ff,{arrayElement:()=>ks,arrayIndex:()=>Lc,calculateNonZero:()=>tn,float:()=>lo,floatSource:()=>mr,gaussian:()=>Sf,gaussianSource:()=>co,hue:()=>Bs,integer:()=>Bn,integerSource:()=>kn,integerUniqueGen:()=>ho,minutesMs:()=>Bf,minutesMsSource:()=>vo,secondsMs:()=>Tf,secondsMsSource:()=>mo,shortGuid:()=>kf,string:()=>Gs,weighted:()=>jf,weightedIndex:()=>Vc,weightedInteger:()=>Wf,weightedIntegerSource:()=>Eo,weightedSource:()=>Do});var mr=(e=1)=>{const t=typeof e=="number"?{max:e}:e;let r=t.max,n=t.min??0;const i=t.source??dr;if(M(n,"","min"),M(r,"","max"),!t.min&&r<0&&(n=r,r=0),n>r)throw new Error(`Min is greater than max. Min: ${n} max: ${r}`);return()=>i()*(r-n)+n},lo=(e=1)=>mr(e)(),tn=(e=Math.random)=>{let t=0;for(;t===0;)t=e();return t},Sf=(e=1)=>co(e)(),co=(e=1)=>{const n=()=>{const i=tn(),s=tn();let o=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s);return o=o/10+.5,o>1||o<0?o=n():(o=Math.pow(o,e),o*=1,o+=0),o};return n},kf=(e={})=>{const t=e.source??Math.random,r=Math.trunc(t()*46656),n=Math.trunc(t()*46656),i=`000${r.toString(36)}`.slice(-3),s=`000${n.toString(36)}`.slice(-3);return i+s};function*fo(e,t=0){if(be(e,"","amount"),be(t,"","offset"),e===0)return;let r=0;do yield e<0?-r+t:r+t;while(r++<Math.abs(e)-1)}var kn=e=>{if(typeof e>"u")throw new TypeError("maxOrOptions is undefined");const t=typeof e=="number"?{max:e}:e;let r=Math.floor(t.max),n=Math.floor(t.min??0);!t.min&&r<0&&(r=1,n=t.max);const i=t.source??Math.random;if(n>r)throw new Error(`Min value is greater than max (min: ${n} max: ${r})`);if(Xt(Jt(n,"","min")),Xt(Jt(r,"","max")),r===n)throw new Error(`Max and min values cannot be the same (${r})`);const s=Math.abs(r-n);return()=>Math.floor(i()*s)+n},Bn=e=>kn(e)();function*ho(e){const t=typeof e=="number"?{max:e}:e,r=t.min??0,n=t.max,i=t.source??Math.random,s=t.loop??!1;if(Xt(en(r,"","min")),Xt(en(n,"","max")),r>n)throw new Error(`Min value is greater than max. Min: ${r} Max: ${n}`);const o=[...fo(n-r,r)];let a=Gt(o),u=0;for(;;){if(u===a.length)if(s)a=Gt(o,i);else return;yield a[u++]}}var vo=e=>{const t=typeof e=="number"?{max:e}:e,r=(t.min??0)*60*1e3,n=t.max*60*1e3;return kn({...t,max:n,min:r})},Bf=e=>vo(e)(),mo=e=>{const t=typeof e=="number"?{max:e}:e,r=(t.min??0)*1e3,n=t.max*1e3;return()=>Bn({...t,max:n,min:r})},Tf=e=>mo(e)(),Tn={};x(Tn,{crossfade:()=>$f,fromCubicBezier:()=>Mf,functions:()=>_n,gaussian:()=>wo,get:()=>pr,getEasings:()=>If,mix:()=>yo,tick:()=>Rf,time:()=>Nf,weightedAverage:()=>zf});var ws=Math.PI*2;function ct(e,t,r,n){const i=r===void 0?e:t,s=r===void 0||typeof r=="object"?t:r,a=(n!==void 0?n:typeof r=="number"?{}:r)?.limits??"clamp";M(i,"","a"),M(s,"","b");const u=l=>(a==="clamp"?l=Ee(l):a==="wrap"&&(l>1?l=l%1:l<0&&(l=1+l%1)),M(l,"","amount"),(1-l)*i+l*s);return r===void 0||typeof r=="object"?u:u(e)}var _f=(e,t=0,r=1,n=0)=>{let i=n;return(s,o)=>{if(s!==void 0&&(r=s),o!==void 0&&(t=o),i>=1)return r;const a=ct(i,t,r);return i+=e,a}},Pf=(e,t=0,r=1)=>{const n=uo(e,{clampValue:!0});return(i,s)=>{const o=n();return i!==void 0&&(r=i),s!==void 0&&(t=s),o>=1?r:ct(o,t,r)}},po=(e,t,r)=>{const n=Ts(r-t,0,ws);return ct(e,t,t+(n>Math.PI?n-ws:n))},Ct=Math.sqrt,X=Math.pow,Ds=Math.cos,Ye=Math.PI,At=Math.sin,Nf=function(e,t){return go(e,t,Re)},Rf=function(e,t){return go(e,t,oo)},go=function(e,t,r){const n=typeof e=="function"?e:pr(e);if(n===void 0)throw typeof e=="string"?new Error(`Easing function not found: ${e}`):new Error("Easing function not found");const i=vr(t,{timer:r(),clampValue:!0});let s=1;return{get isDone(){return i.isDone},get runState(){return i.isDone?"idle":"scheduled"},get startCount(){return s},get startCountTotal(){return s},compute:()=>{const o=i.elapsed;return n(o)},reset:()=>{i.reset(),s++}}},Mf=(e,t)=>r=>{const n=1-r,i=n*n,s=r*r,o=s*r;return 3*e*i*r+3*t*n*s+o},yo=(e,t,r,n)=>ct(t,r(e),n(e)),$f=(e,t,r)=>yo(e,e,t,r),pr=function(e){if(e===null)throw new Error("easingName is null");if(e===void 0)throw new Error("easingName is undefined");const t=e.toLocaleLowerCase(),r=Object.entries(_n).find(([n,i])=>n.toLocaleLowerCase()===t);if(r===void 0)throw new Error(`easing not found ('${e})`);return r===void 0?r:r[1]};function*If(){yield*Object.keys(_n)}var wo=(e=.4)=>{const t=1/Ct(2*Ye),r=.5;return n=>{const i=t/e;let s=-2.5,o=(n-r)/e;o*=o,s*=o;const a=i*X(Math.E,s);return a>1?1:a<0?0:a}},jt=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},Lf=e=>e*e*e*e*e,Vf=e=>1-X(1-e,5),qf=e=>e*(1-e)*4,zf=(e,t,r)=>(e*(r-1)+t)/r,_n={smoothstep:e=>e*e*(3-2*e),smootherstep:e=>(e*(e*6-15)+10)*e*e*e,arch:qf,bell:wo(),sineIn:e=>1-Ds(e*Ye/2),sineOut:e=>At(e*Ye/2),quadIn:e=>e*e,quadOut:e=>1-(1-e)*(1-e),sineInOut:e=>-(Ds(Ye*e)-1)/2,quadInOut:e=>e<.5?2*e*e:1-X(-2*e+2,2)/2,cubicIn:e=>e*e*e,cubicOut:e=>1-X(1-e,3),quartIn:e=>e*e*e*e,quartOut:e=>1-X(1-e,4),quintIn:Lf,quintOut:Vf,expoIn:e=>e===0?0:X(2,10*e-10),expoOut:e=>e===1?1:1-X(2,-10*e),quintInOut:e=>e<.5?16*e*e*e*e*e:1-X(-2*e+2,5)/2,expoInOut:e=>e===0?0:e===1?1:e<.5?X(2,20*e-10)/2:(2-X(2,-20*e+10))/2,circIn:e=>1-Ct(1-X(e,2)),circOut:e=>Ct(1-X(e-1,2)),backIn:e=>2.70158*e*e*e-1.70158*e*e,backOut:e=>1+2.70158*X(e-1,3)+1.70158*X(e-1,2),circInOut:e=>e<.5?(1-Ct(1-X(2*e,2)))/2:(Ct(1-X(-2*e+2,2))+1)/2,backInOut:e=>{const r=2.5949095;return e<.5?X(2*e,2)*((r+1)*2*e-r)/2:(X(2*e-2,2)*((r+1)*(e*2-2)+r)+2)/2},elasticIn:e=>{const t=2*Ye/3;return e===0?0:e===1?1:-X(2,10*e-10)*At((e*10-10.75)*t)},elasticOut:e=>{const t=2*Ye/3;return e===0?0:e===1?1:X(2,-10*e)*At((e*10-.75)*t)+1},bounceIn:e=>1-jt(1-e),bounceOut:jt,elasticInOut:e=>{const t=2*Ye/4.5;return e===0?0:e===1?1:e<.5?-(X(2,20*e-10)*At((20*e-11.125)*t))/2:X(2,-20*e+10)*At((20*e-11.125)*t)/2+1},bounceInOut:e=>e<.5?(1-jt(1-2*e))/2:(1+jt(2*e-1))/2},jf=(e="quadIn")=>Do(e)(),Do=(e="quadIn")=>{const t=typeof e=="string"?{easing:e}:e,r=t.source??dr,n=t.easing??"quadIn",i=pr(n);if(i===void 0)throw new Error(`Easing function '${n}' not found.`);return()=>{const o=r();return i(o)}},Eo=e=>{const t=typeof e=="number"?{max:e}:e,r=t.source??dr,n=t.max,i=t.min??0,s=t.easing??"quadIn";if(typeof n>"u")throw new Error("max field is undefined");if(typeof s!="string")throw new TypeError("easing field expected to be string");M(n);const o=pr(s);if(o===void 0)throw new Error(`Easing '${s}' not found`);if(M(i),n<=i)throw new Error("Max should be greater than min");return()=>{const u=Ee(o(r()));return Math.floor(u*(n-i))+i}},Wf=e=>Eo(e)(),V=e=>{if(typeof e=="string"){const r=document.querySelector(e);if(r===null)throw e.startsWith("#")?new Error(`Query '${e}' did not match anything. Try '#id', 'div', or '.class'`):new Error(`Query '${e}' did not match anything. Did you mean '#${e}?`);e=r}else{if(e===null)throw new Error("Param 'domQueryOrEl' is null");if(e===void 0)throw new Error("Param 'domQueryOrEl' is undefined")}return e},dt=e=>e===void 0?[]:e===null?[]:Array.isArray(e)?e:typeof e=="string"?[...document.querySelectorAll(e)]:[e],bo={};x(bo,{button:()=>Ao,buttonCreate:()=>Gf,checkbox:()=>Uf,numeric:()=>Hf,select:()=>Yf,textAreaKeyboard:()=>Of});var Of=e=>{e.addEventListener("keydown",t=>{const r=e.value,n=e.selectionStart,i=e.selectionEnd;if(t.key==="Tab"&&t.shiftKey)return e.value.substring(n-2,n)==="  "&&(e.value=r.slice(0,Math.max(0,n-2))+r.slice(Math.max(0,i))),e.selectionStart=e.selectionEnd=n-2,t.preventDefault(),!1;if(t.key==="Tab")return e.value=r.slice(0,Math.max(0,n))+"  "+r.slice(Math.max(0,i)),e.selectionStart=e.selectionEnd=n+2,t.preventDefault(),!1})},Uf=(e,t)=>{const r=V(e);return t&&r.addEventListener("change",()=>{t(r.checked)}),{get checked(){return r.checked},set checked(n){r.checked=n}}},Hf=(e,t,r)=>{const n=V(e),i=r?"change":"input";return t&&n.addEventListener(i,()=>{t(Number.parseInt(n.value))}),{get value(){return Number.parseInt(n.value)},set value(s){n.value=s.toString()}}},Ao=(e,t)=>{const r=V(e),n=()=>{t&&r.addEventListener("click",t)},i=()=>{t&&r.removeEventListener("click",t)};return n(),{get title(){return r.textContent},set title(s){r.textContent=s},dispose(s=!1){i(),s&&r.remove()},onClick(s){i(),t=s,n()},click(){t&&t()},set disabled(s){r.disabled=s},get el(){return r}}},Gf=(e,t)=>{const r=document.createElement("button"),n=Ao(r,t);return n.title=e,n},Yf=(e,t,r={})=>{const n=V(e),{placeholderOpt:i,shouldAddChoosePlaceholder:s=!1,autoSelectAfterChoice:o=-1}=r,a=()=>{t!==void 0&&t(n.value),o>=0&&(n.selectedIndex=o)};return t&&n.addEventListener("change",u=>{a()}),{set disabled(u){n.disabled=u},get value(){return n.value},get index(){return n.selectedIndex},get isSelectedPlaceholder(){return(s||r.placeholderOpt!==void 0)&&n.selectedIndex===0},setOpts(u,l){n.options.length=0,s?u=["-- Choose --",...u]:i!==void 0&&(u=[i,...u]);let c=0;for(const[d,h]of u.entries()){const f=document.createElement("option");f.value=h,f.innerHTML=h,l!==void 0&&h===l&&(c=d),n.options.add(f)}n.selectedIndex=c},select(u=0,l=!1){n.selectedIndex=u,l&&t&&a()}}},rt=(e,t="log",r)=>n=>{n===void 0?n="(undefined)":typeof n=="object"&&(n=JSON.stringify(n));const i=r??e;switch(t){case"log":{console.log(`%c${e} ${n}`,`color: ${xo(i)}`);break}case"warn":{console.warn(e,n);break}case"error":{console.error(e,n);break}}},Co=(e,t=!0,r)=>t?{log:rt(e,"log",r),warn:rt(e,"warn",r),error:rt(e,"error",r)}:{log:n=>{},warn:rt(e,"warn",r),error:rt(e,"error",r)},Pn=(e,t={})=>{if(e===void 0||typeof e=="boolean"&&!e)return i=>{};const r=t.category??"",n=t.kind??void 0;return typeof e=="boolean"?i=>{const s=typeof i=="string"?{msg:i}:i,o=s.kind??n,a=s.category??r;let u=s.msg;switch(a&&(u=`[${a}] ${u}`),o){case"error":{console.error(u);break}case"warn":{console.warn(u);break}case"info":{console.info(u);break}default:console.log(u)}}:e},Xf=0,xo=qc(new Map,()=>`hsl(${++Xf*137.508},50%,75%)`),ie={};x(ie,{WithEvents:()=>gr,cloneState:()=>rn,done:()=>sn,driver:()=>Kf,fromList:()=>Qf,fromListBidirectional:()=>eh,init:()=>yr,isValidTransition:()=>To,next:()=>Bo,normaliseTargets:()=>So,possible:()=>kt,possibleTargets:()=>Rn,reset:()=>nn,to:()=>Bt,validateMachine:()=>Fo,validateTransition:()=>wr});var Nn=async(e,t={},r)=>{const n=[],i=t.rank??wn;let s=Array.isArray(e)?e:[e];t.shuffle&&(s=Gt(s));for(let o=0;o<s.length;o++){const a=s[o];let u;if(typeof a=="function"?u=await a(r):u=a,u!==void 0&&(n.push(u),n.sort(i)),typeof t.stop<"u"&&t.stop(u,n))break}return t.filter?n.filter(t.filter):n},Jf=async(e,t={},r)=>{const n=await Nn(e,t,r);if(!n||n.length===0)return;const i=t.at??-1;return n.at(i)};async function Kf(e,t){const r=Array.isArray(t)?{handlers:t}:t,n=Pn(r.debug,{category:"StateMachineDriver"}),i=new Map;for(const u of r.handlers){const l=Array.isArray(u.if)?u.if:[u.if];for(const c of l){if(typeof c!="string")throw new TypeError(`Expected single or array of strings for the 'if' field. Got: '${typeof c}'.`);if(i.has(c))throw new Error(`Multiple handlers defined for state '${c}'. There should be at most one.`);i.set(c,u)}}const s={rank:(u,l)=>wn(u.score??0,l.score??0),shuffle:r.shuffleHandlers??!1};let o=yr(e);for(const[u]of i)if(typeof o.machine[u]>"u"&&u!=="__fallback")throw new Error(`StateMachineDriver handler references a state ('${u}') which is not defined on the machine. Therefore this handler will never run.'`);return{reset:()=>{o=nn(o)},getValue:()=>o.value,run:async()=>{n(`Run. State: ${o.value}`);const u=o.value;let l=i.get(u);if(l===void 0&&(n(`  No handler for state '${u}', trying __fallback`),l=i.get("__fallback")),l===void 0){n("  No __fallback handler");return}const c=l.resultChoice==="first"?{...s,stop:f=>f?"reset"in f||"next"in f&&f.next!==void 0:!1}:s,d=await Nn(l.then,c,o);n(`  In state '${o.value}' results: ${d.length}. Choice: ${l.resultChoice}`);let h;switch(l.resultChoice??"highest"){case"highest":{h=d.at(-1);break}case"first":{h=d[0];break}case"lowest":{h=d.at(0);break}case"random":{h=ks(d);break}default:throw new Error(`Unknown 'resultChoice' option: ${l.resultChoice}. Expected highest, first, lowest or random`)}return n(`  Chosen result: ${JSON.stringify(h)}`),h?.reset?o=nn(o):h&&h.next&&(typeof h.next=="boolean"?o=Bo(o):(n(JSON.stringify(d)),o=Bt(o,h.next))),o},to:u=>(o=Bt(o,u),o)}}var gr=class extends Pe{#e;#t;#r;#n=!1;#i=!1;#s=ao();constructor(e,t={}){super();this.#r=t.debug??!1,this.#e=yr(e,t.initial),this.#t=rn(this.#e)}#o(e){this.#i!==e&&(this.#i=e,e?(this.#n=!0,setTimeout(()=>{!this.#n||(this.#n=!1,this.fireEvent("stop",{state:this.#e.value}))},2)):this.#n=!1)}get statesPossible(){return kt(this.#e)}get statesDefined(){return Object.keys(this.#e.machine)}next(){const e=kt(this.#e);return e.length===0?null:(this.state=e[0],e[0])}get isDone(){return sn(this.#e)}reset(){this.#o(!1),this.#e=rn(this.#t),this.#s=tr()}validateTransition(e){wr(this.#e,e)}isValid(e){return To(this.#e,e)}set state(e){const t=this.#e.value;e!==this.#e.value&&(this.#e=Bt(this.#e,e),this.#r&&console.log(`StateMachine: ${t} -> ${e}`),this.#s=tr(),setTimeout(()=>{this.fireEvent("change",{newState:e,priorState:t})},1),sn(this.#e)&&this.#o(!0))}get state(){return this.#e.value}get changedAt(){return this.#s()}get elapsed(){return this.#s()}},rn=e=>Object.freeze({value:e.value,visited:[...e.visited],machine:e.machine}),yr=(e,t)=>{const[r,n]=Fo(e);if(!r)throw new Error(n);const i=t??Object.keys(r.states)[0];if(r.states[i]===void 0)throw new TypeError("Initial state not found");const s=Zf(r.states);if(s===void 0)throw new Error("Could not normalise transitions");return Object.freeze({value:i,visited:[],machine:Object.fromEntries(s)})},nn=e=>yr(e.machine),Fo=e=>e===void 0?[void 0,"Parameter undefined"]:e===null?[void 0,"Parameter null"]:"states"in e?[e,""]:typeof e=="object"?[{states:e},""]:[void 0,`Unexpected type: ${typeof e}. Expected object`],sn=e=>kt(e).length===0,Rn=e=>{ko(e);const t=e.machine[e.value];return t.length===1&&t[0].state===null?[]:t},kt=e=>Rn(e).map(r=>r.state),So=e=>{const t=r=>{if(r===null)return{state:null};if(typeof r=="string")return{state:r};if(typeof r=="object"&&"state"in r){const n=r.state;if(typeof n!="string")throw new TypeError(`Target 'state' field is not a string. Got: ${typeof n}`);return"preconditions"in r?{state:n,preconditions:r.preconditions}:{state:n}}else throw new Error(`Unexpected type: ${typeof r}. Expected string or object with 'state' field.`)};if(Array.isArray(e)){let r=!1;const n=e.map(i=>{const s=t(i);if(!s)throw new Error("Invalid target");return r=r||s.state===null,s});if(r&&n.length>1)throw new Error("Cannot have null as an possible state");return n}else{const r=t(e);return r?[r]:void 0}},Zf=e=>{const t=new Map;for(const[r,n]of Object.entries(e)){if(typeof r>"u")throw new TypeError("Top-level undefined state");if(typeof n>"u")throw new TypeError(`Undefined target state for ${r}`);if(t.has(r))throw new Error(`State defined twice: ${r}`);if(r.includes(" "))throw new Error("State names cannot contain spaces");t.set(r,[])}for(const[r,n]of Object.entries(e)){const i=So(n);if(i===void 0)throw new Error("Could not normalise target");if(i!==null){const s=new Set;for(const o of i){if(s.has(o.state))throw new Error(`Target state '${o.state}' already exists for '${r}'`);if(s.add(o.state),o.state!==null&&!t.has(o.state))throw new Error(`Target state '${o.state}' is not defined as a top-level state. Defined under: '${r}'`)}t.set(r,i)}}return t},ko=e=>{if(e===void 0)throw new TypeError("Parameter 'state' is undefined");if(typeof e.value!="string")throw new TypeError("Existing state is not a string")},Bt=(e,t)=>(ko(e),wr(e,t),Object.freeze({value:t,machine:e.machine,visited:zc([e.visited,[e.value]])})),Bo=e=>{const t=Rn(e).at(0);if(!t||t.state===null)throw new Error(`Not possible to move to a next state from '${e.value}`);return Bt(e,t.state)},To=(e,t)=>{try{return wr(e,t),!0}catch{return!1}},wr=(e,t)=>{if(t===null)throw new Error("Cannot transition to null state");if(t===void 0)throw new Error("Cannot transition to undefined state");if(typeof t!="string")throw new TypeError(`Parameter 'toState' should be a string. Got: ${typeof t}`);const r=kt(e);if(r.length===0)throw new Error("Machine is in terminal state");if(!r.includes(t))throw new Error(`Target state '${t}' not available at current state '${e.value}'. Possible states: ${r.join(", ")}`)},Qf=(...e)=>{const t={};if(!Array.isArray(e))throw new Error("Expected array of strings");if(e.length<=2)throw new Error("Expects at least two states");for(let r=0;r<e.length;r++){const n=e[r];if(typeof n!="string")throw new TypeError(`Expected array of strings. Got type '${typeof n}' at index ${r}`);t[n]=r===e.length-1?null:e[r+1]}return t},eh=(...e)=>{const t={};if(!Array.isArray(e))throw new Error("Expected array of strings");if(e.length<2)throw new Error("Expects at least two states");for(const[r,n]of e.entries()){if(typeof n!="string")throw new TypeError(`Expected array of strings. Got type '${typeof n}' at index ${r}`);t[n]=[]}for(let r=0;r<e.length;r++){const n=t[e[r]];r===e.length-1?e.length>1?n.push(e[r-1]):t[e[r]]=null:(n.push(e[r+1]),r>0&&n.push(e[r-1]))}return t},me=e=>typeof e=="string"?e:e instanceof Error?e.message:e,th={};x(th,{DispatchList:()=>$n,Elapsed:()=>Ze,RequestResponseMatch:()=>yh,StateMachine:()=>ie,SyncWait:()=>Dh,TaskQueueMutable:()=>Eh,WaitForValue:()=>Lo,backoffGenerator:()=>$o,continuously:()=>je,debounce:()=>sh,delay:()=>ah,delayLoop:()=>_o,everyNth:()=>lh,forEach:()=>ch,forEachAsync:()=>dh,frequencyTimer:()=>ze,frequencyTimerSource:()=>Af,hasElapsed:()=>bf,interval:()=>Po,intervalToMs:()=>N,isInterval:()=>Wc,iterateBreadth:()=>Mn,iterateDepth:()=>rh,msElapsedTimer:()=>Re,promiseFromEvent:()=>No,promiseWithResolvers:()=>Ro,rateMinimum:()=>Mo,relativeTimer:()=>vr,repeat:()=>hh,repeatAwait:()=>fh,retryFunction:()=>In,retryTask:()=>Ln,run:()=>Nn,runOnce:()=>wh,runSingle:()=>Jf,singleItem:()=>Ch,sleep:()=>K,sleepWhile:()=>oh,throttle:()=>bh,ticksElapsedTimer:()=>oo,timeout:()=>Pt,updateOutdated:()=>Ah,waitFor:()=>Vn});var rr=(e,t="")=>typeof e=="object"&&"name"in e&&e.name!==void 0?e.name:t;function*Mn(e,t){typeof t>"u"&&(t=rr(e));for(const[r,n]of on(e))yield[n,t];for(const[r,n]of on(e)){const i=rr(n,"?"),s=t.length>0?t+"."+i:i;yield*Mn(n,s)}}function*rh(e,t){typeof t>"u"&&(t=rr(e));for(const[r,n]of on(e)){yield[n,t];const i=rr(n,"?"),s=t.length>0?t+"."+i:i;yield*Mn(n,s)}}function nh(e){return e.seq!==void 0}function ih(e){return e.sel!==void 0}function*on(e){if(nh(e))yield*e.seq.entries();else if(ih(e))yield*e.sel.entries();else if(typeof e!="string")throw new TypeError("Unexpected shape of node. seq/sel missing")}var je=(e,t,r={})=>{let n=N(t,0);be(n,"positive","interval");const i=r.fireBeforeWait??!1,s=r.onStartCalled,o=r.signal;let a=!1,u="idle",l=0,c=0,d=performance.now(),h=t??0,f=!1,m;const p=()=>{m!==void 0&&(globalThis.clearTimeout(m),m=void 0,l=0,d=Number.NaN)},g=S=>{n===0?typeof requestAnimationFrame>"u"?m=globalThis.setTimeout(S,0):(m=void 0,requestAnimationFrame(S)):m=globalThis.setTimeout(S,n)},w=()=>{f||(f=!0,u!=="idle"&&(u="idle",p()))},b=async()=>{if(o?.aborted&&(u="idle"),u==="idle")return;u="running",l++,c++;const S=e(l,performance.now()-d),T=typeof S=="object"?await S:S;if(!f){if(u="scheduled",T!==void 0&&!T){w();return}f||g(b)}},j=()=>{if(a)throw new Error("Disposed");if(f=!1,s!==void 0)switch(s(l,performance.now()-d)){case"cancel":{w();return}case"reset":{G();return}case"dispose":{a=!0,w();return}}u==="idle"&&(l=0,d=performance.now(),u="scheduled",i?b():g(b))},G=()=>{if(a)throw new Error("Disposed");f=!1,l=0,d=Number.NaN,u!=="idle"&&w(),j()};return{start:j,reset:G,cancel:w,get interval(){return h},get runState(){return u},get startCountTotal(){return c},get startCount(){return l},set interval(S){const T=N(S,0);be(T,"positive","interval"),n=T,h=S},get isDisposed(){return a},get elapsedMs(){return performance.now()-d}}},Pt=(e,t)=>{if(e===void 0)throw new Error("callback parameter is undefined");const r=N(t);be(r,"aboveZero","interval");let n,i=0,s=0,o=0,a="idle";const u=()=>{i=0,globalThis.clearTimeout(n),a="idle"},l=async(d=t,h)=>new Promise((m,p)=>{i=performance.now();const g=N(d),w=en(g,"aboveZero","altTimeoutMs");if(!w[0]){p(new Error(w[1]));return}switch(a){case"scheduled":{c();break}}a="scheduled",n=globalThis.setTimeout(async()=>{if(a!=="scheduled"){console.warn("Timeout skipping execution since state is not 'scheduled'"),u();return}const b=h??[];s++,o++,a="running",await e(performance.now()-i,...b),a="idle",u(),m()},g)}),c=()=>{a!=="idle"&&u()};return{start:l,cancel:c,get runState(){return a},get startCount(){return s},get startCountTotal(){return o}}},sh=(e,t)=>{const r=Pt(e,t);return(...n)=>{r.start(void 0,n)}};(typeof window>"u"||!("requestAnimationFrame"in window))&&typeof window>"u"&&(globalThis.requestAnimationFrame=e=>{setTimeout(e,1)});var K=e=>{const t=N(e,1),r=e.signal,n=e.value;return M(t,"positive","timeoutMs"),t===0?new Promise(i=>requestAnimationFrame(s=>{i(n)})):new Promise((i,s)=>{const o=()=>{clearTimeout(a),r?(r.removeEventListener("abort",o),s(new Error(r.reason))):s(new Error("Cancelled"))};r&&r.addEventListener("abort",o);const a=setTimeout(()=>{if(r?.removeEventListener("abort",o),r?.aborted){s(new Error(r.reason));return}i(n)},t)})},oh=async(e,t=100)=>{for(;e();)await K(t)},ah=async(e,t)=>{const r=typeof t=="number"?{millis:t}:t,n=r.delay??"before";(n==="before"||n==="both")&&await K(r);const i=Promise.resolve(await e());return(n==="after"||n==="both")&&await K(r),i};async function*uh(){let e,t=new Promise(i=>e=i),r=0;const n=()=>{e&&e(),t=new Promise(i=>e=i)};try{for(;;)r=globalThis.requestAnimationFrame(n),yield await t}finally{e&&e(),globalThis.cancelAnimationFrame(r)}}async function*_o(e){const t=N(e);if(typeof t>"u")throw new Error("timeout is undefined");if(t<0)throw new Error("Timeout is less than zero");if(t===0)return yield*uh();let r,n=new Promise(o=>r=o),i;const s=()=>{r&&r(),n=new Promise(o=>r=o)};try{for(;;)i=globalThis.setTimeout(s,t),yield await n}finally{r&&r(),i!==void 0&&globalThis.clearTimeout(i),i=void 0}}var $n=class{#e;#t=0;#r=Math.floor(Math.random()*100);constructor(){this.#e=[]}isEmpty(){return this.#e.length===0}add(e,t={}){this.#t++;const r=t.once??!1,n={id:`${this.#r} - ${this.#t}`,handler:e,once:r};return this.#e.push(n),n.id}remove(e){const t=this.#e.length;return this.#e=this.#e.filter(r=>r.id!==e),this.#e.length!==t}notify(e){for(const t of this.#e)t.handler(e),t.once&&this.remove(t.id)}clear(){this.#e=[]}},lh=(e,t)=>{be(e,"positive","nth");let r=0;return n=>(r++,r===e?(r=0,t&&t(n),!0):!1)},ch=(e,t)=>{for(const r of e){const n=t(r);if(typeof n=="boolean"&&!n)break}},dh=async function(e,t,r){if(Array.isArray(e))for(const n of e){const i=await t(n);if(r&&await K(r),typeof i=="boolean"&&!i)break}else for await(const n of e){const i=await t(n);if(r&&await K(r),typeof i=="boolean"&&!i)break}},Po=async function*(e,t={}){const r=typeof t=="number"?{fixed:t}:t,n=r.signal,i=r.delay??"before",s=r.minimum?N(r.minimum):void 0;let o=!1,a=N(r.fixed)??N(r.minimum,0),u=performance.now();const l=async()=>{const d=performance.now()-u;if(typeof s<"u"&&(a=Math.max(0,s-d)),a&&await K({millis:a,signal:n}),u=performance.now(),n?.aborted)throw new Error(`Signal aborted ${n.reason}`)};Array.isArray(e)&&(e=e.values());const c=typeof e=="object"&&"next"in e&&typeof e.next=="function";try{for(;!o;){if(i==="before"&&await l(),typeof e=="function"){const d=await e();if(typeof d>"u")return;yield d}else if(c){const d=await e.next();if(d.done)return;yield d.value}else throw new Error("produce param does not seem to return a value/Promise and is not a generator?");i==="after"&&await l()}}finally{o=!0}},No=(e,t)=>new Promise(r=>{const n=(...i)=>{e.removeEventListener(t,n),Array.isArray(i)&&i.length===1?r(i[0]):r(i)};e.addEventListener(t,n)});function Ro(){let e,t;return{promise:new Promise((n,i)=>{e=n,t=i}),resolve:e,reject:t}}var Mo=e=>{let t=!1;const r=Pt(()=>{t||(r.start(),e.whatToCall(e.fallback()))},e.interval);return e.abort&&e.abort.addEventListener("abort",n=>{t=!0,r.cancel()}),r.start(),n=>{if(t)throw new Error("AbortSignal has been fired");r.start(),e.whatToCall(n)}};function fh(e,t){return typeof e=="number"?ph(e,t):vh(e,t)}function hh(e,t){return typeof e=="number"?gh(e,t):mh(e,t)}async function*vh(e,t){let r=0,n=0;for(;e(r,n);){r++;const i=await t(r,n);i!==void 0&&(yield i,n++)}}function*mh(e,t){let r=0,n=0;for(;e(r,n);){r++;const i=t(r,n);i!==void 0&&(yield i,n++)}}async function*ph(e,t){M(e,"positive","count");let r=0,n=0;for(;e-- >0;){n++;const i=await t(n,r);i!==void 0&&(yield i,r++)}}function*gh(e,t){M(e,"positive","count");let r=0,n=0;for(;e-- >0;){n++;const i=t(n,r);i!==void 0&&(yield i,r++)}}var yh=class extends Pe{timeoutMs;whenUnmatchedResponse;keyRequest;keyResponse;#e=new Map;#t;constructor(e={}){super();if(typeof window>"u"&&(globalThis.window={setTimeout,clearTimeout}),this.timeoutMs=e.timeoutMs??1e3,this.whenUnmatchedResponse=e.whenUnmatchedResponse??"throw",this.#t=je(()=>this.#r(),this.timeoutMs*2),e.key){if(e.keyRequest)throw new Error("Cannot set 'keyRequest' when 'key' is set ");if(e.keyResponse)throw new Error("Cannot set 'keyResponse' when 'key' is set ");this.keyRequest=e.key,this.keyResponse=e.key}else{if(!e.keyRequest||!e.keyResponse)throw new Error("Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set");this.keyRequest=e.keyRequest,this.keyResponse=e.keyResponse}}#r(){const e=[...this.#e.values()],t=Date.now();for(const r of e)if(r.expiresAt<=t){r.promiseReject&&r.promiseReject("Request timeout");const n=r.callback;n&&setTimeout(()=>{n(!0,"Request timeout")},1),this.fireEvent("completed",{request:r.req,response:"Request timeout",success:!1}),this.#e.delete(r.id)}return this.debugDump(),this.#e.size>0}debugDump(){const e=[...this.#e.values()],t=Date.now();for(const r of e){const n=t-r.expiresAt;console.log(`${r.id} Expires in: ${Math.floor(n/1e3)}s`)}}request(e,t){if(t!==void 0){this.#i(e,t);return}return this.#n(e)}requestAndForget(e){const t=this.keyRequest(e);if(this.#e.has(t))throw new Error(`Already a request pending with id '${t}'`);const r={expiresAt:Date.now()+this.timeoutMs,id:t,req:e};this.#e.set(t,r),this.#t.start()}#n(e){const t=this.keyRequest(e);if(this.#e.has(t))throw new Error(`Already a request pending with id '${t}'`);return new Promise((n,i)=>{const s={expiresAt:Date.now()+this.timeoutMs,id:t,req:e,promiseResolve:n,promiseReject:i};this.#e.set(t,s),this.#t.start()})}#i(e,t){const r=this.keyRequest(e);if(this.#e.has(r))throw new Error(`Already a request pending with id '${r}'`);const n={expiresAt:Date.now()+this.timeoutMs,id:r,req:e,callback:t};this.#e.set(r,n),this.#t.start()}response(e,t){const r=this.keyResponse(e),n=this.#e.get(r);if(!n){if(this.whenUnmatchedResponse==="throw")throw new Error(`Unmatched response with id: '${r}'`,{cause:e});return!1}return t?n.expiresAt=Date.now()+this.timeoutMs:this.#e.delete(r),n.promiseResolve&&n.promiseResolve(e),n.callback&&n.callback(!1,e),this.fireEvent("match",{request:n.req,response:e}),t||this.fireEvent("completed",{request:n.req,response:e,success:!0}),!0}};function*$o(e={}){const t=e.startAt??1;let r=e.limitAttempts??Number.MAX_SAFE_INTEGER;const n=e.limitValue,i=e.power??1.1;let s=t;for(be(r,"aboveZero","limitAttempts"),M(t,"","startAt"),M(r,"","limitAttempts"),n!==void 0&&M(n,"","limitValue"),M(i,"","power");r>0;){if(n&&s>=n)return;r--,yield s,s+=Math.pow(s,i)}}var In=(e,t={})=>Ln({async probe(){try{const n=await e();return n===void 0?{value:t.taskValueFallback,success:!1}:{value:n,success:!0}}catch(n){return{success:!1,message:me(n)}}}},t),Ln=async(e,t={})=>{const r=t.abort,n=Pn(t.log),i=t.predelayMs??0,s=tr();let o=0;const a=t.startAt??1e3,u=t.limitAttempts??Number.MAX_SAFE_INTEGER,l=$o({...t,startAt:a,limitAttempts:u});if(a<=0)throw new Error("Param 'initialValue' must be above zero");if(i>0)try{await K({millis:i,signal:r})}catch(c){return{success:!1,attempts:o,value:t.taskValueFallback,elapsed:s(),message:me(c)}}for(const c of l){o++;const d=await e.probe(o);if(d.success)return{success:d.success,value:d.value,attempts:o,elapsed:s()};if(n({msg:`retry attempts: ${o} t: ${Sn(c)}`}),o>=u)break;try{await K({millis:c,signal:r})}catch(h){return{success:!1,attempts:o,value:t.taskValueFallback,message:me(h),elapsed:s()}}}return{message:`Giving up after ${o} attempts.`,success:!1,attempts:o,value:t.taskValueFallback,elapsed:s()}},wh=e=>{let t=!1,r=!1;return()=>(t||(t=!0,r=e()),r)},Dh=class{#e;#t;#r;signal(){this.#e&&(this.#e(),this.#e=void 0),this.#r=Promise.resolve()}flush(){this.#t&&(this.#t("Flushed"),this.#t=void 0),this.#e=void 0,this.#r=void 0}#n(){const e=new Promise((t,r)=>{this.#e=t,this.#t=r});return this.#r=e,e}async forSignal(e){let t=this.#r;if(t||(t=this.#n()),e){const r=this.#t;setTimeout(()=>{r&&r(`Timeout elapsed ${e}`)},e)}await t,this.#r=void 0,this.#e=void 0,this.#t=void 0}async didSignal(e){try{return await this.forSignal(e),!0}catch{return!1}}},Eh=class Io extends Pe{static shared=new Io;_loop;_queue;constructor(){super();this._queue=jc(),this._loop=je(()=>this.processQueue(),100)}enqueue(t){const r=this._queue.enqueue(t);return this._loop.runState==="idle"&&(this.fireEvent("started",{}),this._loop.start()),r}dequeue(){return this._queue.dequeue()}async processQueue(){const t=this._queue.dequeue();if(t===void 0)return this.fireEvent("empty",{}),!1;try{await t()}catch(r){console.error(r)}}clear(){this._queue.length!==0&&(this._queue.clear(),this._loop.cancel(),this.fireEvent("empty",{}))}get isEmpty(){return this._queue.isEmpty}get length(){return this._queue.length}},bh=(e,t)=>{let r=0;return async(...n)=>{const i=performance.now()-r;if(i>=t){const s=e(i,...n);typeof s=="object"&&await s,r=performance.now()}}},Ah=(e,t,r="slow")=>{let n=0,i,s=N(t,1e3);return()=>new Promise(async(o,a)=>{const u=performance.now()-n;if(i===void 0||u>s)try{n=performance.now(),i=await e(u),s=N(t,1e3)}catch(l){r==="fast"?(i=void 0,n=0):r==="backoff"&&(s=Math.floor(s*1.2)),a(l);return}o(i)})},Vn=(e,t,r)=>{let n,i=!1;const s=o=>{n!==void 0&&(window.clearTimeout(n),n=void 0),o?t(o):i=!0,r!==void 0&&r(i)};return n=globalThis.setTimeout(()=>{n=void 0;try{t(`Timeout after ${e}ms`)}finally{r!==void 0&&r(i)}},e),s},Lo=class{#e;#t;#r=!1;constructor(){const{promise:e,resolve:t}=Ro();this.#e=e,this.#t=t}get(){return this.#e}add(e){if(this.#r)throw new Error("QueueSingleUse has already been used");this.#r=!0,this.#t(e)}get isUsed(){return this.#r}},Ch=()=>new Lo,xh={};x(xh,{Async:()=>Vo,Chains:()=>sa,Sync:()=>Oc,chunks:()=>t0,combineLatestToArray:()=>Jh,concat:()=>i0,dropWhile:()=>Qh,equals:()=>g0,every:()=>p0,fill:()=>n0,filter:()=>r0,find:()=>s0,flatten:()=>l0,forEach:()=>o0,fromArray:()=>u0,fromEvent:()=>Uc,fromIterable:()=>w0,isAsyncIterable:()=>L,isIterable:()=>ur,map:()=>a0,max:()=>Zh,min:()=>Kh,reduce:()=>d0,slice:()=>f0,some:()=>c0,toArray:()=>m0,unique:()=>h0,uniqueByValue:()=>v0,until:()=>e0,zip:()=>y0});var Vo={};x(Vo,{chunks:()=>qo,concat:()=>zo,dropWhile:()=>jo,equals:()=>Oo,every:()=>Uo,fill:()=>Ho,filter:()=>Go,find:()=>Yo,flatten:()=>Xo,forEach:()=>Jo,fromArray:()=>qn,fromFunction:()=>Bh,fromFunctionAwaited:()=>kh,fromIterable:()=>zn,map:()=>Ko,max:()=>Zo,min:()=>Qo,nextWithTimeout:()=>jn,reduce:()=>ea,repeat:()=>Fh,slice:()=>ta,some:()=>ra,toArray:()=>Dr,unique:()=>an,uniqueByValue:()=>na,until:()=>Wo,withDelay:()=>Sh,zip:()=>ia});async function*qn(e,t=1){for(const r of e)yield r,await K(t)}async function*zn(e,t=1){for await(const r of e)yield r,await K(t)}async function*qo(e,t){let r=[];for await(const n of e)r.push(n),r.length===t&&(yield r,r=[]);r.length>0&&(yield r)}async function*zo(...e){for await(const t of e)yield*t}async function*jo(e,t){for await(const r of e)t(r)||(yield r)}var Wo=async(e,t)=>{for await(const r of e){const n=await t();if(typeof n=="boolean"&&!n)break}},Fh=async function*(e,t){const r=typeof t=="number"?t:Number.POSITIVE_INFINITY,n=typeof t=="number"?void 0:t;let i=r;for(;;){for await(const s of e())if(yield s,n?.aborted)break;if(Number.isFinite(r)&&(i--,i===0)||n?.aborted)break}};async function Oo(e,t,r){const n=e[Symbol.asyncIterator](),i=t[Symbol.asyncIterator]();for(;;){const s=await n.next(),o=await i.next();if(r!==void 0){if(!r(s.value,o.value))return!1}else if(s.value!==o.value)return!1;if(s.done??o.done)return s.done&&o.done}}async function Uo(e,t){for await(const r of e)if(!await t(r))return!1;return!0}async function*Ho(e,t){for await(const r of e)yield t}async function*Go(e,t){for await(const r of e)!await t(r)||(yield r)}async function Yo(e,t){for await(const r of e)if(await t(r))return r}async function*Xo(e){for await(const t of e)if(typeof t=="object"){if(Array.isArray(t))for(const r of t)yield r;else if(L(t))for await(const r of t)yield r;else if(ur(t))for(const r of t)yield r}else yield t}async function Jo(e,t){for await(const r of e){const n=await t(r);if(typeof n=="boolean"&&!n)break}}async function*Ko(e,t){for await(const r of e)yield t(r)}async function*Zo(e,t=(r,n)=>r>n){let r;for await(const n of e){if(r===void 0){r=n,yield r;continue}t(n,r)&&(r=n,yield n)}}async function*Qo(e,t=(r,n)=>r>n){let r;for await(const n of e){if(r===void 0){r=n,yield r;continue}t(r,n)&&(r=n,yield n)}return r}async function ea(e,t,r){for await(const n of e)r=t(r,n);return r}async function*ta(e,t=0,r=Number.POSITIVE_INFINITY){const n=e[Symbol.asyncIterator]();for(;t>0;t--,r--)await n.next();for await(const i of e)if(r-- >0)yield i;else break}async function*Sh(e,t){for(const r of e)await K(t),yield r}async function jn(e,t){const r=N(t,1e3),n=await Promise.race([(async()=>{await K({millis:r,signal:t.signal})})(),(async()=>await e.next())()]);if(n===void 0)throw new Error("Timeout");return n}async function ra(e,t){for await(const r of e)if(await t(r))return!0;return!1}async function Dr(e,t={}){const r=[],n=e[Symbol.asyncIterator](),i=Date.now(),s=t.limit??Number.POSITIVE_INFINITY,o=N(t.elapsed,Number.POSITIVE_INFINITY);for(;r.length<s&&Date.now()-i<o;){const a=await n.next();if(a.done)break;r.push(a.value)}return r}async function*kh(e){for(;;)yield await e()}function*Bh(e){for(;;)yield e()}async function*an(e){const t=[],r=Array.isArray(e)?e:[e];for await(const n of r)for await(const i of n)t.includes(i)||(t.push(i),yield i)}async function*na(e,t=lr,r=new Set){for await(const n of e){const i=t(n);r.has(i)||(r.add(i),yield n)}}async function*ia(...e){const t=e.map(r=>r[Symbol.asyncIterator]());for(;;){const r=await Promise.all(t.map(n=>n.next()));if(r.some(n=>n.done))return;yield r.map(n=>n.value)}}var sa={};x(sa,{Dom:()=>oa,From:()=>_a,Links:()=>aa,addToArray:()=>Mh,asArray:()=>$h,asCallback:()=>Ih,asPromise:()=>Lh,asValue:()=>Vh,combineLatestToArray:()=>Ra,combineLatestToObject:()=>Gh,isGenFactoryNoInput:()=>un,lazy:()=>Uh,mergeFlat:()=>Hh,prepare:()=>zh,resolveToAsyncGen:()=>Wn,resolveToGen:()=>H,run:()=>qh,runN:()=>Ta,single:()=>Yh,syncToArray:()=>Xh,timestamp:()=>Na});var oa={};x(oa,{perValue:()=>Nh,query:()=>Rh});function un(e){return"_type"in e?e._type==="GenFactoryNoInput":!1}function*Th(e){yield e}async function*_h(e){yield e,await K(1)}function H(e){if(Array.isArray(e)){const t=e.values();return t._name="arrayInput",t}else{if(typeof e=="number"||typeof e=="boolean"||typeof e=="string")return Th(e);if(typeof e=="function")return e()}return e}function Wn(e){if(e!==void 0)return Array.isArray(e)?qn(e):typeof e=="number"||typeof e=="boolean"||typeof e=="string"?_h(e):typeof e=="function"?e():L(e)?e:zn(e)}var Ph=e=>{const t=e??(n=>n),r=new Map;return{has(n){return r.has(t(n))},get(n){return r.get(t(n))},set(n,i){r.set(t(n),i)},entries(){return r.entries()},delete(n){r.delete(n)}}};function Nh(e={}){const t=e.byReference,r=e.tagName??"div";if(t&&e.key)throw new Error("byReference and key options are mutually exclusive");const n=t?void 0:e.key??lr,i=Ph(n),s=e.parentEl??document.body,o=V(s),a=new Set;async function*u(l){for await(const c of H(l)){let d=i.get(c);d||(d=document.createElement(r),i.set(c,d),e.beforeInsert&&e.beforeInsert(d),o.append(d),e.afterInsert&&e.afterInsert(d)),a.add(d),yield{el:d,value:c}}for(const[c,d]of i.entries())a.has(d)||(e.beforeRemove&&e.beforeRemove(d),d.remove(),i.delete(c))}return u._name="dom.perValue",u}function Rh(e={}){const t=e.baseElement??document;async function*r(n){const i=H(n);for await(const s of i)for(const o of t.querySelectorAll(s))yield o}return r._name="dom.query",r}var aa={};x(aa,{average:()=>xa,chunk:()=>Sa,debounce:()=>wa,delay:()=>ya,drop:()=>Ba,duration:()=>ga,filter:()=>ka,max:()=>ba,min:()=>Ea,rank:()=>Aa,rankArray:()=>Ca,reduce:()=>pa,sum:()=>Fa,take:()=>ma,tally:()=>Da,transform:()=>va});var ua=()=>{let e=Number.MIN_SAFE_INTEGER;return r=>{const n=Array.isArray(r)?r:[r];for(const i of n){if(typeof i!="number")break;return e=Math.max(i,e),e}}},la=()=>{let e=Number.MAX_SAFE_INTEGER;return r=>{const n=Array.isArray(r)?r:[r];for(const i of n){if(typeof i!="number")break;return e=Math.min(i,e),e}}},ca=()=>{let e=0;return r=>{const n=Array.isArray(r)?r:[r];for(const i of n){if(typeof i!="number")break;return e+=i,e}}},da=()=>{let e=0,t=0;return n=>{const i=Array.isArray(n)?n:[n];for(const s of i){if(typeof s!="number")break;return t++,e+=s,e/t}}},fa=e=>{let t=0;return n=>(e&&Array.isArray(n)?t+=n.length:t++,t)};function ha(e,t={}){const r=t.includeType,n=t.emitEqualRanked??!1,i=t.emitRepeatHighest??!1;let s;return o=>{if(!(r&&typeof o!==r)){if(s===void 0)return s=o,s;{const a=e(o,s);if(a=="a")return s=o,s;if(a==="eq"&&n)return s;if(i)return s}}}}function va(e){async function*t(r){r=H(r);for await(const n of r)yield e(n)}return t._name="transform",t}function ma(e){async function*t(r){r=H(r);let n=0;for await(const i of r){if(++n>e)break;yield i}}return t._name="take",t}function pa(e){async function*t(r){r=H(r);for await(const n of r)yield e(n)}return t._name="reduce",t}function ga(e){const t=N(e,0);async function*r(n){n=H(n);const i=Ze.since();for await(const s of n){if(i()>t)break;yield s}}return r._name="duration",r}function ya(e){const t=N(e.before,0),r=N(e.after,0);async function*n(i){i=H(i);for await(const s of i)t>0&&await K(t),yield s,r>0&&await K(r)}return n._name="delay",n}function wa(e){const t=N(e,0);async function*r(n){n=H(n);let i=Ze.since();for await(const s of n)i()<t||(yield s,i=Ze.since())}return r._name="debounce",r}function Da(e=!0){async function*t(r){r=H(r);const n=fa(e);for await(const i of r)yield n(i)}return t._name="tally",t}function Ea(){async function*e(t){t=H(t);const r=la();for await(const n of t){const i=r(n);i!==void 0&&(yield i)}}return e._name="min",e}function ba(){async function*e(t){t=H(t);const r=ua();for await(const n of t){const i=r(n);i!==void 0&&(yield i)}}return e._name="max",e}function Aa(e,t={}){async function*r(n){n=H(n);const i=ha(e,t);for await(const s of n){const o=i(s);o!==void 0&&(yield o)}}return r._name="rank",r}function Ca(e,t={}){const r=t.includeType,n=t.emitEqualRanked??!1,i=t.emitRepeatHighest??!1,s=t.withinArrays??!1;async function*o(a){a=H(a);let u;for await(const l of a){let c=!1;s&&(u=void 0);for(const d of l)if(!(r&&typeof d!==r))if(u===void 0)u=d,c=!0;else{const h=e(d,u);h=="a"?(u=d,c=!0):(h==="eq"&&n||i)&&(c=!0)}c&&u&&(yield u)}}return o._name="rankArray",o}function xa(){async function*e(t){t=H(t);const r=da();for await(const n of t){const i=r(n);i!==void 0&&(yield i)}}return e._name="average",e}function Fa(){async function*e(t){t=H(t);const r=ca();for await(const n of t){const i=r(n);i!==void 0&&(yield i)}}return e._name="total",e}function Sa(e,t=!0){be(e,"aboveZero","size");async function*r(n){n=H(n);let i=[];for await(const s of n)i.push(s),i.length>=e&&(yield i,i=[]);t&&i.length>0&&(yield i)}return r._name="chunk",r}function ka(e){async function*t(r){r=H(r);for await(const n of r)e(n)&&(yield n)}return t._name="filter",t}function Ba(e){async function*t(r){r=H(r);for await(const n of r)e(n)||(yield n)}return t._name="drop",t}async function Mh(e,t){const r=typeof t=="function"?t():t;for await(const n of r)e.push(n)}async function $h(e,t={}){const r=typeof e=="function"?e():e;return Dr(r,t)}async function Ih(e,t,r){const n=typeof e=="function"?e():e;for await(const i of n)t(i);r&&r()}function Lh(e){let t;const r=typeof e=="function"?e():e;async function n(){const i=await r.next();if(!i.done)return t=i.value,t}return n}function Vh(e,t){let r=t,n=!1;const i=typeof e=="function"?e():e;function s(){return n||(n=!0,i.next().then(o=>{r=o.value,n=!1}).catch(o=>{throw n=!1,o})),r}return s}async function*Ta(...e){let t;for(const r of e)t=typeof r=="function"?r(t??[]):H(r);if(t!==void 0)for await(const r of t)yield r}async function*qh(e,t,r,n,i,s,o){let a;const u=arguments;for(const l of u)typeof l=="function"?a=l(a??[]):a=H(l);if(a!==void 0)for await(const l of a)yield l}function zh(...e){return r=>Ta(r,...e)}var _a={};x(_a,{array:()=>jh,event:()=>Wh,func:()=>Pa,iterable:()=>Oh,timestamp:()=>Na});function jh(e,t=5){async function*r(){for(const n of e)await K(t),yield n}return r._name="fromArray",r._type="GenFactoryNoInput",r}function Wh(e,t){async function*r(){for(;;)yield await No(e,t)}return r._name="event",r._type="GenFactoryNoInput",r}function Pa(e){async function*t(){for(;;){const r=await e();if(r===void 0)break;yield r}}return t._name="fromFunction",t._type="GenFactoryNoInput",t}function Oh(e){async function*t(){for await(const r of e)yield r}return t._name="fromIterable",t._type="GenFactoryNoInput",t}function Na(e){const t=N(e.interval,0),r=e.asClockTime??!1,n=e.loops??Number.MAX_SAFE_INTEGER;let i=0;const s=N(e.elapsed,Number.MAX_SAFE_INTEGER);async function*o(){const a=Ze.since();for(;i<n&&a()<s;){yield r?Date.now():a();const u=i*t-a();await K(Math.max(0,t+u)),i++}}return o._name="timestamp",o._type="GenFactoryNoInput",o}var Es=e=>e._name??e.name;function Uh(){const e=[];let t;const r=i=>{i===void 0&&(i=t);let s=Wn(i);for(const o of e)if(s===void 0)if(un(o))s=o();else throw new Error(`Function '${Es(o)}' requires input. Provide it to the function, or call 'input' earlier.`);else s=o(s);return s},n={rankArray:(i,s)=>(e.push(Ca(i,s)),n),rank:(i,s)=>(e.push(Aa(i,s)),n),transform:i=>(e.push(va(i)),n),reduce:i=>(e.push(pa(i)),n),drop:i=>(e.push(Ba(i)),n),delay:i=>(e.push(ya(i)),n),duration:i=>(e.push(ga(i)),n),debounce:i=>(e.push(wa(i)),n),fromFunction:i=>(e.push(Pa(i)),n),take:i=>(e.push(ma(i)),n),chunk:(i,s=!0)=>(e.push(Sa(i,s)),n),filter:i=>(e.push(ka(s=>i(s))),n),min:()=>(e.push(Ea()),n),max:()=>(e.push(ba()),n),average:()=>(e.push(xa()),n),sum:()=>(e.push(Fa()),n),tally:i=>(e.push(Da(i)),n),input(i){return t=i,n},asGenerator:r,asAsync(i){let s=i??t;for(const o of e)if(s===void 0&&un(o))s=o();else{if(s===void 0)throw new Error(`Function '${Es(o)}' needs input. Pass in data calling 'asAsync', or call 'input' earlier`);s=o(s)}return n},asArray:async i=>{const s=r(i);return await Dr(s)},firstOutput:async i=>(await r(i).next()).value,lastOutput:async i=>{const s=r(i);let o;for await(const a of s)o=a;return o}};return n}async function*Hh(...e){const t=e.map(a=>Wn(a)),r=Hc.mutable();let n=0;const i=async a=>{if(a===void 0){n++;return}const u=await a.next();u.done?n++:(r.enqueue(u.value),setTimeout(()=>i(a),1))};for(const a of t)setTimeout(()=>i(a),1);const s=10;let o=1;for(;n<t.length;){const a=r.dequeue();a===void 0?o=Math.min(o+1,10):(yield a,o=1),await K(s*o)}}async function*Ra(e,t={}){const r=t.onSourceDone??"break",n=t.finalValue??"undefined",i=t.afterEmit??"last",s=e.map((c,d)=>({waiting:void 0,index:d,gen:H(c),done:!1,lastValue:void 0})),o=()=>!s.some(c=>!c.done),a=()=>s.some(c=>c.waiting!==void 0),u=c=>!c.some(d=>d!==void 0);let l=[];for(;;){const c=[];for(const m of s){if(m.done)continue;if(m.waiting!==void 0){c.push(m.waiting);continue}const p=Promise.resolve((async()=>{if(m.done)return m;const g=await m.gen.next();return m.waiting=void 0,g.done?(m.done=!0,n==="undefined"&&(m.lastValue=void 0)):m.lastValue=g.value,m})());m.waiting=p,c.push(p)}if((await Promise.race(c)).done&&r==="break")break;const h=s.map(m=>m.lastValue);if(h.length===0)return;const f=u(h);if(f&&!a())return;if(!Gc(l,h)&&!f&&(l=h,yield h),i==="undefined")for(const m of s)m.waiting===void 0&&(m.lastValue=void 0);if(o())break}}async function*Gh(e,t={}){const r=t.onSourceDone??"break",n=t.finalValue??"undefined",i=t.afterEmit??"last",s=new Map;for(const[d,h]of Object.entries(e))s.set(d,{gen:H(h),done:!1,lastValue:void 0,waiting:void 0,key:d});const o=()=>!Kr.some(s,d=>!d.done),a=()=>Kr.some(s,d=>d.waiting!==void 0),u=d=>{for(const h of Object.values(d))if(h!==void 0)return!1;return!0},l=()=>{const d={};for(const[h,f]of s)d[h]=f.lastValue;return d};let c;for(;;){const d=[];for(const p of s.values()){if(p.done)continue;if(p.waiting!==void 0){d.push(p.waiting);continue}const g=Promise.resolve((async()=>{if(p.done)return p;const w=await p.gen.next();return p.waiting=void 0,w.done?(p.done=!0,n==="undefined"&&(p.lastValue=void 0)):p.lastValue=w.value,p})());p.waiting=g,d.push(g)}if((await Promise.race(d)).done&&r==="break")break;const f=l(),m=u(f);if(m&&!a())return;if(!Yc(c,f)&&!m&&(c=f,yield f),i==="undefined")for(const p of s.values())p.waiting===void 0&&(p.lastValue=void 0);if(o())break}}async function Yh(e,t){return(await e([t]).next()).value}async function*Xh(e,t={}){const r=t.onSourceDone??"break",n=N(t.maximumWait,2e3),i=t.finalValue??"undefined",s=e.map(c=>({seq:0,lastValue:void 0,gen:H(c),done:!1})),o={millis:n};let a=0;const u=()=>!s.some(c=>!c.done);let l=!0;for(;l;){a++;for(const c of s){if(c.done){c.seq=a;continue}const d=await jn(c.gen,o);if(d.done){if(c.done=!0,c.seq=a,i==="undefined"&&(c.lastValue=void 0),r==="break")return}else c.lastValue=d.value,c.seq=a}if(l){const c=s.filter(d=>d.seq===a).map(d=>d.lastValue);if(c.length===0||!c.some(d=>d!==void 0))return;yield c}u()&&(l=!1)}}function Jh(e,t={}){return Ra(e,t)}function Kh(e,t=(r,n)=>r>n){return L(e)?Qo(e,t):Xc(e,t)}function Zh(e,t=(r,n)=>r>n){return L(e)?Zo(e,t):Jc(e,t)}function Qh(e,t){return L(e)?jo(e,t):Kc(e,t)}function e0(e,t){if(L(e))return Wo(e,t);Zc(e,t)}function t0(e,t){return L(e)?qo(e,t):Qc(e,t)}function r0(e,t){return L(e)?Go(e,t):ed(e,t)}function n0(e,t){return L(e)?Ho(e,t):td(e,t)}function i0(...e){return L(e[0])?zo(...e):rd(...e)}function s0(e,t){return L(e)?Yo(e,t):nd(e,t)}function o0(e,t){if(L(e))return Jo(e,t);id(e,t)}function a0(e,t){return L(e)?Ko(e,t):_s(e,t)}function u0(e,t){return t===void 0?Dn(e):qn(e,t)}function l0(e){return L(e)?Xo(e):sd(e)}function c0(e,t){return L(e)?ra(e,t):od(e,t)}function d0(e,t,r){return L(e)?ea(e,t,r):ad(e,t,r)}function f0(e,t=0,r=Number.POSITIVE_INFINITY){return L(e)?ta(e,t,r):ud(e,r)}function h0(e){return Array.isArray(e)?e.length===0?Dn([]):L(e[0])?an(e):is(e):L(e)?an(e):is(e)}function*v0(e,t=lr,r=new Set){return L(e)?na(e,t,r):ld(e,t,r)}function m0(e,t={}){return L(e)?Dr(e,t):cd(e,t)}function p0(e,t){return L(e)?Uo(e,t):dd(e,t)}function g0(e,t,r){return L(e)&&L(t)?Oo(e,t,r):fd(e,t,r)}function y0(...e){return e.length===0?Dn([]):L(e[0])?ia(...e):hd(...e)}function w0(e,t){return L(e)||t!==void 0?zn(e,t):vd(e)}var On=class{seenCount;storeIntermediate;resetAfterSamples;sampleLimit;id;debug;constructor(e={}){this.id=e.id??"tracker",this.debug=e.debug??!1,this.sampleLimit=e.sampleLimit??-1,this.resetAfterSamples=e.resetAfterSamples??-1,this.storeIntermediate=e.storeIntermediate??(this.sampleLimit>-1||this.resetAfterSamples>-1),this.seenCount=0,this.debug&&console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`)}reset(){this.seenCount=0,this.onReset()}seen(...e){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples?this.reset():this.sampleLimit>0&&this.seenCount>this.sampleLimit*2&&(this.seenCount=this.trimStore(this.sampleLimit),this.onTrimmed()),this.seenCount+=e.length;const t=this.filterData(e);return this.computeResults(t)}},Ma=class{store;gog;constructor(e){this.store=new Map,this.gog=md(this.store,e)}get size(){return this.store.size}has(e){return this.store.has(e)}async seen(e,...t){return(await this.getTrackedValue(e,...t)).seen(...t)}async getTrackedValue(e,...t){if(e===null)throw new Error("id parameter cannot be null");if(e===void 0)throw new Error("id parameter cannot be undefined");return await this.gog(e,t[0])}delete(e){this.store.delete(e)}reset(){this.store=new Map}*ids(){yield*this.store.keys()}*tracked(){yield*this.store.values()}*trackedByAge(){const e=[...this.store.values()];e.sort((t,r)=>{const n=t.elapsed,i=r.elapsed;return n===i?0:n>i?-1:1});for(const t of e)yield t}*valuesByAge(){for(const e of this.trackedByAge())yield e.last}*last(){for(const e of this.store.values())yield e.last}*initialValues(){for(const e of this.store.values())yield e.initial}get(e){return this.store.get(e)}},$a=class extends On{values;timestamps;constructor(e){super(e);this.values=[],this.timestamps=[]}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.timestamps=this.timestamps.slice(-e),this.values.length)}onTrimmed(){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw new Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(e){const r={value:e.at(-1),at:performance.now()},n=e.map(i=>({at:performance.now(),value:i}));if(this.storeIntermediate)this.values.push(...e),this.timestamps.push(...n.map(i=>i.at));else switch(this.values.length){case 0:{this.values.push(r.value),this.timestamps.push(r.at);break}case 2:{this.values[1]=r.value,this.timestamps[1]=r.at;break}case 1:{this.values.push(r.value),this.timestamps.push(r.at);break}}return n}},Un=class extends $a{total=0;min=Number.MAX_SAFE_INTEGER;max=Number.MIN_SAFE_INTEGER;constructor(e){super(e)}get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.total=0,super.onReset()}onTrimmed(){this.min=Ps(this.values),this.max=En(this.values),this.total=Ns(this.values)}computeResults(e){if(e.some(n=>Number.isNaN(n)))throw new Error("Cannot add NaN");const t=e.map(n=>n.value);return this.total=t.reduce((n,i)=>n+i,this.total),this.min=Math.min(...t,this.min),this.max=Math.max(...t,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}},St=(e={})=>new Un(e),D0={};x(D0,{AudioAnalysers:()=>Va,AudioVisualisers:()=>qa,Bluetooth:()=>Ia,Camera:()=>Ha,Codec:()=>Hn,Espruino:()=>ja,FrameProcessor:()=>$0,Serial:()=>Wa,StringReceiveBuffer:()=>Gn,StringWriteBuffer:()=>Yn,VideoFile:()=>Ya,genericStateTransitionsInstance:()=>Xn,reconnectingWebsocket:()=>I0});var Ia={};x(Ia,{NordicBleDevice:()=>La,defaultOpts:()=>Nt});var Hn=class{enc=new TextEncoder;dec=new TextDecoder("utf-8");toBuffer(e){return this.enc.encode(e)}fromBuffer(e){return this.dec.decode(e)}},Gn=class{constructor(e,t=`
`){this.onData=e,this.separator=t}buffer="";stream;async close(){const e=this.stream;!e||(await e.abort(),await e.close())}clear(){this.buffer=""}writable(){return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){const e=this;return new WritableStream({write(t){e.add(t)},close(){e.clear()}})}addImpl(e){const t=e.indexOf(this.separator);if(t<0)return this.buffer+=e,"";const r=e.substring(0,t);try{this.onData(this.buffer+r),e=e.substring(r.length+this.separator.length)}catch(n){console.warn(n)}return this.buffer="",e}add(e){for(;e.length>0;)e=this.addImpl(e)}},Yn=class{constructor(e,t={}){this.dataHandler=e,this.chunkSize=t.chunkSize??-1,this.writer=je(async()=>{await this.onWrite()},t.interval??10)}paused=!1;queue=new Ke;writer;stream;closed=!1;chunkSize;async close(){if(this.closed)return;const e=this.stream?.getWriter();e?.releaseLock(),await e?.close(),this.closed=!0}clear(){if(this.closed)throw new Error("Buffer closed");this.queue=new Ke}writable(){if(this.closed)throw new Error("Buffer closed");return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){const e=this;return new WritableStream({write(t){e.add(t)},close(){e.clear()}})}async onWrite(){if(this.queue.isEmpty)return!1;if(this.paused)return console.warn("WriteBuffer.onWrite: paused..."),!0;const e=this.queue.dequeue();return e===void 0?!1:(await this.dataHandler(e),!0)}get isClosed(){return this.closed}add(e){if(this.closed)throw new Error("Buffer closed");this.chunkSize>0?this.queue.enqueue(...hf(e,this.chunkSize)):this.queue.enqueue(e),this.writer.start()}},Xn=Object.freeze({ready:"connecting",connecting:["connected","closed"],connected:["closed"],closed:"connecting"}),E0=class extends Pe{constructor(e,t){super();this.device=e,this.config=t,this.verboseLogging=t.debug,this.txBuffer=new Yn(async r=>{await this.writeInternal(r)},t),this.rxBuffer=new Gn(r=>{this.fireEvent("data",{data:r})}),this.codec=new Hn,this.states=new gr(Xn,{initial:"ready"}),this.states.addEventListener("change",r=>{this.fireEvent("change",r),this.verbose(`${r.priorState} -> ${r.newState}`),r.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())}),e.addEventListener("gattserverdisconnected",()=>{this.isClosed||(this.verbose("GATT server disconnected"),this.states.state="closed")}),this.verbose(`ctor ${e.name} ${e.id}`)}states;codec;rx;tx;gatt;verboseLogging=!1;rxBuffer;txBuffer;get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw new Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async writeInternal(e){this.verbose(`writeInternal ${e}`);const t=this.tx;if(t===void 0)throw new Error("Unexpectedly without tx characteristic");try{await t.writeValue(this.codec.toBuffer(e))}catch(r){this.warn(r)}}disconnect(){this.states.state==="connected"&&this.gatt?.disconnect()}async connect(){const e=this.config.connectAttempts??3;this.states.state="connecting",this.verbose("connect");const t=this.device.gatt;if(t===void 0)throw new Error("Gatt not available on device");await In(async()=>{this.verbose("connect.retry");const r=await t.connect();this.verbose("Getting primary service");const n=await r.getPrimaryService(this.config.service);this.verbose("Getting characteristics");const i=await n.getCharacteristic(this.config.rxGattCharacteristic),s=await n.getCharacteristic(this.config.txGattCharacteristic);return i.addEventListener("characteristicvaluechanged",o=>{this.onRx(o)}),this.rx=i,this.tx=s,this.gatt=t,this.states.state="connected",await i.startNotifications(),!0},{limitAttempts:e,startAt:200})}onRx(e){if(this.rx===void 0)return;const r=e.target.value;if(r===void 0)return;let n=this.codec.fromBuffer(r.buffer);const i=Kt(n,19),s=Kt(n,17);s&&i<s&&(this.verbose("Tx plz start"),n=Zt(n,s,1),this.txBuffer.paused=!1),i&&i>s&&(this.verbose("Tx plz stop"),n=Zt(n,i,1),this.txBuffer.paused=!0),this.rxBuffer.add(n)}verbose(e){this.verboseLogging&&console.info(`${this.config.name}`,e)}log(e){console.log(`${this.config.name}`,e)}warn(e){console.warn(`${this.config.name}`,e)}},Nt={chunkSize:20,service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",txGattCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",rxGattCharacteristic:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",name:"NordicDevice",connectAttempts:5,debug:!1},La=class extends E0{constructor(e,t={}){super(e,{...Nt,...t})}},Va={};x(Va,{AudioAnalyser:()=>Er,basic:()=>b0,freq:()=>A0,peakLevel:()=>C0});var qa={};x(qa,{default:()=>za});var za=class{freqMaxRange=200;audio;parent;lastPointer={x:0,y:0};pointerDown=!1;pointerClicking=!1;pointerClickDelayMs=100;pointerDelaying=!1;waveTracker;freqTracker;el;constructor(e,t){this.audio=t,this.parent=e,this.waveTracker=St(),this.freqTracker=St(),e.innerHTML=`
    <section>
      <button id="rendererComponentToggle">\u{1F53C}</button>
      <div>
        <h1>Visualiser</h1>
        <div style="display:flex; flex-wrap: wrap">
          <div class="visPanel">
            <h2>Frequency distribution</h2>
            <br />
            <canvas id="rendererComponentFreqData" height="200" width="400"></canvas>
          </div>
          <div class="visPanel">
            <h2>Waveform</h2>
            <button id="rendererComponentWaveReset">Reset</button>
            <div>
              Press and hold on wave to measure
            </div>
            <br />
            <canvas id="rendererComponentWaveData" height="200" width="400"></canvas>
          </div>
        </div>
      </div>
    </section>
    `,this.el=e.children[0],document.getElementById("rendererComponentToggle")?.addEventListener("click",()=>{this.setExpanded(!this.isExpanded())}),this.el.addEventListener("pointermove",r=>this.onPointer(r)),this.el.addEventListener("pointerup",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),this.el.addEventListener("pointerdown",()=>{this.pointerDelaying=!0,setTimeout(()=>{this.pointerDelaying&&(this.pointerDelaying=!1,this.pointerDown=!0)},this.pointerClickDelayMs)}),this.el.addEventListener("pointerleave",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),document.getElementById("rendererComponentWaveReset")?.addEventListener("click",()=>{this.clear()})}renderFreq(e){if(!this.isExpanded()||!e)return;const t=document.getElementById("rendererComponentFreqData");if(t===null)throw new Error("Cannot find canvas element");const r=t.getContext("2d");if(r===null)throw new Error("Cannot create drawing context");const n=e.length,i=t.clientWidth,s=t.clientHeight;r.clearRect(0,0,i,s);const o=this.getPointerRelativeTo(t),a=i/n,u=_t(e);for(let l=0;l<n;l++){if(!Number.isFinite(e[l]))continue;const d=(e[l]-u.min)/this.freqMaxRange,h=Math.abs(s*d),f=s-h,m=l/n*360,p=l*a;if(r.fillStyle="hsl("+m+", 100%, 50%)",o.y>0&&o.y<=s&&o.x>=p&&o.x<=p+a){this.freqTracker.id!==l.toString()&&(this.freqTracker=St({id:l.toString()})),this.freqTracker.seen(e[l]);const g=this.freqTracker.getMinMaxAvg();r.fillStyle="black",this.audio&&r.fillText(`Frequency (${l}) at pointer: ${this.audio.getFrequencyAtIndex(l).toLocaleString("en")} - ${this.audio.getFrequencyAtIndex(l+1).toLocaleString("en")}`,2,10),r.fillText(`Raw value: ${e[l].toFixed(2)}`,2,20),r.fillText(`Min: ${g.min.toFixed(2)}`,2,40),r.fillText(`Max: ${g.max.toFixed(2)}`,60,40),r.fillText(`Avg: ${g.avg.toFixed(2)}`,120,40)}r.fillRect(p,f,a,h)}}isExpanded(){const e=this.el.querySelector("div");if(e===null)throw new Error("contents div not found");return e.style.display===""}setExpanded(e){const t=this.el.querySelector("div"),r=this.el.querySelector("button");if(r===null)throw new Error("Button element not found");if(t===null)throw new Error("Contents element not found");e?(t.style.display="",r.innerText="\u{1F53C}"):(t.style.display="none",r.innerText="\u{1F53D}")}clear(){this.clearCanvas(document.getElementById("rendererComponentFreqData")),this.clearCanvas(document.getElementById("rendererComponentWaveData"))}clearCanvas(e){if(e===null)throw new Error("Canvas is null");const t=e.getContext("2d");if(t===null)throw new Error("Cannot create drawing context");t.fillStyle="white",t.fillRect(0,0,e.clientWidth,e.clientHeight)}renderWave(e,t=!0){if(!this.isExpanded()||!e)return;const r=document.getElementById("rendererComponentWaveData");if(r===null)throw new Error("Cannot find wave canvas");const n=r.getContext("2d");if(n===null)throw new Error("Cannot create drawing context for wave");const i=r.clientWidth,s=r.clientHeight,o=this.getPointerRelativeTo(r),a=20,u=60,l=e.length;n.fillStyle="white",n.fillRect(0,0,u,a);const c=i/l;n.fillStyle="rgba(255, 255, 255, 0.03)",n.fillRect(0,20,i,s),n.fillStyle="red",t?n.fillRect(0,s/2,i,1):n.fillRect(0,s-1,i,1),n.lineWidth=1,n.strokeStyle="black",n.beginPath();let d=0;for(let h=0;h<l;h++){const f=e[h]*s,m=t?s/2-f:s-f;h===0?n.moveTo(d,m):n.lineTo(d,m),d+=c,this.pointerDown&&this.waveTracker.seen(e[h])}if(n.lineTo(i,t?s/2:s),n.stroke(),this.pointerDown){const h=this.waveTracker.getMinMaxAvg();n.fillStyle="rgba(255,255,0,1)",n.fillRect(u,0,150,20),n.fillStyle="black",n.fillText("Min: "+h.min.toFixed(2),60,10),n.fillText("Max: "+h.max.toFixed(2),110,10),n.fillText("Avg: "+h.avg.toFixed(2),160,10)}else this.waveTracker.reset();o.y>0&&o.y<=s&&o.x>=0&&o.x<=i&&(n.fillStyle="black",n.fillText("Level: "+(1-o.y/s).toFixed(2),2,10))}getPointerRelativeTo(e){const t=e.getBoundingClientRect();return{x:this.lastPointer.x-t.left-window.scrollX,y:this.lastPointer.y-t.top-window.scrollY}}onPointer(e){this.lastPointer={x:e.pageX,y:e.pageY},e.preventDefault()}},b0=(e,t={})=>new Er((r,n)=>{const i=new Float32Array(r.frequencyBinCount),s=new Float32Array(r.fftSize);r.getFloatFrequencyData(i),r.getFloatTimeDomainData(s),e(i,s,n)},t),A0=(e,t={})=>new Er((r,n)=>{const i=new Float32Array(r.frequencyBinCount);r.getFloatFrequencyData(i),e(i,n)},t),C0=(e,t={})=>new Er((r,n)=>{const i=new Float32Array(r.fftSize);r.getFloatTimeDomainData(i),e(En(i),n)},t),Er=class{showVis;fftSize;smoothingTimeConstant;#e=!1;debug;#t=!1;visualiser;audioCtx;analyserNode;analyse;constructor(e,t={}){if(this.showVis=t.showVis??!1,this.fftSize=t.fftSize??1024,this.debug=t.debug??!1,this.smoothingTimeConstant=t.smoothingTimeConstant??.8,be(this.fftSize,"positive","opts.fftSize"),M(this.smoothingTimeConstant,"percentage","opts.smoothingTimeConstant"),!vf(this.fftSize))throw new Error(`fftSize must be a power of two from 32 to 32768 (${this.fftSize})`);if(this.fftSize<32)throw new Error("fftSize must be at least 32");if(this.fftSize>32768)throw new Error("fftSize must be no greater than 32768");this.analyse=e,this.paused=!1,this.init();const r=document.querySelector("#audio-visualiser");if(r){const n=new za(r,this);n.setExpanded(this.showVis),this.visualiser=n}}init(){if(this.#t){this.debug&&console.debug("Init already in progress");return}this.#t=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.onMicSuccess(e)}).catch(e=>{this.#t=!1,console.error(e)})}get paused(){return this.#e}set paused(e){e!==this.#e&&(this.#e=e,e?this.debug&&console.log("Paused"):(this.debug&&console.log("Unpaused"),window.requestAnimationFrame(this.analyseLoop.bind(this))))}setup(e,t){const r=e.createAnalyser();return r.fftSize=this.fftSize,r.smoothingTimeConstant=this.smoothingTimeConstant,e.createMediaStreamSource(t).connect(r),r}onMicSuccess(e){try{const t=new AudioContext;t.addEventListener("statechange",()=>{this.debug&&console.log(`Audio context state: ${t.state}`)}),this.audioCtx=t,this.analyserNode=this.setup(t,e),window.requestAnimationFrame(this.analyseLoop.bind(this))}catch(t){this.#t=!1,console.error(t)}}analyseLoop(){if(this.paused){this.debug&&console.log("Paused");return}const e=this.analyserNode;if(e===void 0){console.warn("Analyser undefined");return}try{this.analyse(e,this)}catch(t){console.error(t)}window.requestAnimationFrame(this.analyseLoop.bind(this))}getFrequencyRangeMax(e,t,r){const n=this.sliceByFrequency(e,t,r);return Rs(n)}sliceByFrequency(e,t,r){const n=this.getIndexForFrequency(e),i=this.getIndexForFrequency(t);return r.slice(n,i)}getFrequencyAtIndex(e){const t=this.analyserNode,r=this.audioCtx;if(t===void 0)throw new Error("Analyser not available");if(r===void 0)throw new Error("Audio context not available");if(be(e,"positive","index"),e>t.frequencyBinCount)throw new Error(`Index ${e} exceeds frequency bin count ${t.frequencyBinCount}`);return e*r.sampleRate/(t.frequencyBinCount*2)}getIndexForFrequency(e){const t=this.analyserNode;if(t===void 0)throw new Error("Analyser not available");const r=t.context.sampleRate/2,n=Math.round(e/r*t.frequencyBinCount);return n<0?0:n>=t.frequencyBinCount?t.frequencyBinCount-1:n}},ja={};x(ja,{EspruinoBleDevice:()=>br,EspruinoSerialDevice:()=>Ua,bangle:()=>S0,connectBle:()=>B0,deviceEval:()=>Kn,puck:()=>F0,serial:()=>k0});var br=class extends La{evalTimeoutMs;evalReplyBluetooth=!0;constructor(e,t={}){super(e,t);this.evalTimeoutMs=t.evalTimeoutMs??5*1e3}async writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,t={},r){const n=t.debug??!1;return Kn(e,t,this,"Bluetooth.println",n,r??(s=>{this.warn(s)}))}},Wa={};x(Wa,{Device:()=>Oa});var x0=class extends Pe{states;codec;verboseLogging=!1;name;connectAttempts;chunkSize;rxBuffer;txBuffer;constructor(e={}){super();this.verboseLogging=e.debug??!1,this.chunkSize=e.chunkSize??1024,this.connectAttempts=e.connectAttempts??3,this.name=e.name??"JsonDevice",this.txBuffer=new Yn(async t=>{await this.writeInternal(t)},e),this.rxBuffer=new Gn(t=>{this.fireEvent("data",{data:t})}),this.codec=new Hn,this.states=new gr(Xn,{initial:"ready"}),this.states.addEventListener("change",t=>{this.fireEvent("change",t),this.verbose(`${t.priorState} -> ${t.newState}`),t.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())})}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw new Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async close(){this.states.state==="connected"&&this.onClosed()}async connect(){const e=this.connectAttempts;this.states.state="connecting",await this.onPreConnect(),await In(async()=>(await this.onConnectAttempt(),this.states.state="connected",!0),{limitAttempts:e,startAt:200})}onRx(e){const t=e.target.value;if(t===void 0)return;let r=this.codec.fromBuffer(t.buffer);const n=Kt(r,19),i=Kt(r,17);i&&n<i&&(this.verbose("Tx plz start"),r=Zt(r,i,1),this.txBuffer.paused=!1),n&&n>i&&(this.verbose("Tx plz stop"),r=Zt(r,n,1),this.txBuffer.paused=!0),this.rxBuffer.add(r)}verbose(e){this.verboseLogging&&console.info(`${this.name}`,e)}log(e){console.log(`${this.name}`,e)}warn(e){console.warn(`${this.name}`,e)}},Oa=class extends x0{constructor(e={}){super(e);this.config=e,this.abort=new AbortController;const t=e.eol??`\r
`;this.baudRate=e.baudRate??9600,e.name===void 0&&(this.name="Serial.Device"),this.rxBuffer.separator=t}port;tx;abort;baudRate;async writeInternal(e){if(this.tx===void 0)throw new Error("tx not ready");try{this.tx.write(e)}catch(t){this.warn(t)}}onClosed(){this.tx?.releaseLock(),this.abort.abort("closing port"),this.states.state="closed"}onPreConnect(){return Promise.resolve()}async onConnectAttempt(){let e={};const t={baudRate:this.baudRate};this.config.filters&&(e={filters:[...this.config.filters]}),this.port=await navigator.serial.requestPort(e),this.port.addEventListener("disconnect",o=>{this.close()}),await this.port.open(t);const r=this.port.writable,n=new TextEncoderStream;r!==null&&(n.readable.pipeTo(r,{signal:this.abort.signal}).catch(o=>{console.log("Serial.onConnectAttempt txText pipe:"),console.log(o)}),this.tx=n.writable.getWriter());const i=this.port.readable,s=new TextDecoderStream;i!==null&&(i.pipeTo(s.writable,{signal:this.abort.signal}).catch(o=>{console.log("Serial.onConnectAttempt rxR pipe:"),console.log(o)}),s.readable.pipeTo(this.rxBuffer.writable(),{signal:this.abort.signal}).catch(o=>{console.log("Serial.onConnectAttempt rxText pipe:"),console.log(o);try{this.port?.close()}catch(a){console.log(a)}}))}},Ua=class extends Oa{evalTimeoutMs;evalReplyBluetooth=!1;constructor(e){super(e);e===void 0&&(e={}),this.evalTimeoutMs=e.evalTimeoutMs??5*1e3}async disconnect(){return super.close()}writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,t={},r){const n=t.debug??!1;return Kn(e,t,this,"USB.println",n,r??(s=>{this.warn(s)}))}},F0=async(e={})=>{const t=e.name??"Puck",r=e.debug??!1,n=await navigator.bluetooth.requestDevice({filters:Jn(e,"Puck.js"),optionalServices:[Nt.service]});console.log(n.name);const i=new br(n,{name:t,debug:r});return await i.connect(),i},S0=async(e={})=>{const t=e.name??"Bangle",r=e.debug??!1,n=await navigator.bluetooth.requestDevice({filters:Jn(e,"Bangle.js"),optionalServices:[Nt.service]});console.log(n.name);const i=new br(n,{name:t,debug:r});return await i.connect(),i},k0=async(e={})=>{const t=new Ua(e);return await t.connect(),t},Jn=(e,t)=>{const r=[];return e.filters?r.push(...e.filters):e.name?(r.push({name:e.name}),console.info(`Filtering Bluetooth devices by name '${e.name}'`)):r.push({namePrefix:t}),r},B0=async(e={})=>{const t=await navigator.bluetooth.requestDevice({filters:Jn(e,"Puck.js"),optionalServices:[Nt.service]}),r=new br(t,{name:"Espruino",...e});return await r.connect(),r},Kn=async(e,t={},r,n,i,s)=>{const o=t.timeoutMs??r.evalTimeoutMs,a=t.assumeExclusive??!0;if(typeof e!="string")throw new TypeError("code parameter should be a string");return new Promise((u,l)=>{const c=Gs(5),d=p=>{try{let g=p.data;g.startsWith(">{")&&g.endsWith("}")&&(g=g.slice(1));const w=JSON.parse(g);"reply"in w?w.reply===c?(f(),"result"in w&&u(w.result)):s(`Expected reply ${c}, got ${w.reply}`):s(`Expected packet, missing 'reply' field. Got: ${p.data}`)}catch(g){a?f(p.data):s(g)}},h=p=>{p.newState!=="connected"&&f(`State changed to '${p.newState}', aborting`)};r.addEventListener("data",d),r.addEventListener("change",h);const f=Vn(o,p=>{l(new Error(p))},()=>{r.removeEventListener("data",d),r.removeEventListener("change",h)}),m=`${n}(JSON.stringify({reply:"${c}", result:JSON.stringify(${e})}))
`;i&&s(m),r.write(m)})},Ha={};x(Ha,{dumpDevices:()=>_0,start:()=>Ga});var T0=1e4,_0=async(e="videoinput")=>{const t=await navigator.mediaDevices.enumerateDevices();for(const r of t)r.kind===e&&(console.log(r.label),console.log(` Kind: ${r.kind}`),console.log(` Device id: ${r.deviceId}`))},Ga=async(e={})=>{const t=document.createElement("VIDEO");t.style.display="none",t.playsInline=!0,t.muted=!0,t.classList.add("ixfx-camera"),document.body.append(t);let r=()=>{};const n=()=>{try{r()}catch{}t.remove()};try{return r=(await P0(t,e)).dispose,{videoEl:t,dispose:n}}catch(i){throw console.error(i),n(),i}},P0=async(e,t={})=>{if(e===void 0)throw new Error("videoEl undefined");if(e===null)throw new Error("videoEl null");const r=t.max,n=t.min,i=t.ideal,s={audio:!1,video:{width:{},height:{}}};t.facingMode==="front"&&(t={...t,facingMode:"user"}),t.facingMode==="back"&&(t={...t,facingMode:"environment"}),t.facingMode&&(s.video.facingMode=t.facingMode),t.deviceId&&(s.video.deviceId=t.deviceId),i&&(s.video.width={...s.video.width,ideal:i.width},s.video.height={...s.video.height,ideal:i.height}),r&&(s.video.width={...s.video.width,max:r.width},s.video.height={...s.video.height,max:r.height}),n&&(s.video.width={...s.video.width,min:n.width},s.video.height={...s.video.height,min:n.height});const o=Vn(t.startTimeoutMs??T0,a=>{throw new Error(`Camera getUserMedia failed: ${a}`)});try{const a=await navigator.mediaDevices.getUserMedia(s),u=()=>{e.pause();const d=a.getTracks();for(const h of d)h.stop()};e.srcObject=a,o();const l={videoEl:e,dispose:u};return new Promise((d,h)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{d(l)}).catch(f=>{h(f)})})})}catch(a){throw o(me(a)),a}},Ya={};x(Ya,{start:()=>Xa});var Xa=async e=>{const t=document.createElement("VIDEO");t.style.display="none",t.playsInline=!0,t.muted=!0,t.classList.add("ixfx-video"),document.body.appendChild(t);let r=()=>{};const n=()=>{try{r()}catch{}t.remove()};try{return r=(await N0(t,e)).dispose,{videoEl:t,dispose:n}}catch(i){throw console.error(i),n(),i}},N0=async(e,t)=>{if(e===void 0)throw new Error("videoEl undefined");if(e===null)throw new Error("videoEl null");const r=URL.createObjectURL(t);e.src=r,e.loop=!0;const i={videoEl:e,dispose:()=>{e.pause()}};return new Promise((o,a)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{o(i)}).catch(u=>{a(u)})})})},Zn={};x(Zn,{capture:()=>M0,frames:()=>R0,manualCapture:()=>Ja});async function*R0(e,t={}){const r=t.maxIntervalMs??0,n=t.showCanvas??!1;let i=t.canvasEl,s,o;s=o=0,i===void 0&&(i=document.createElement("CANVAS"),i.classList.add("ixfx-frames"),n||(i.style.display="none"),document.body.appendChild(i));const a=()=>{i!==void 0&&(s=e.videoWidth,o=e.videoHeight,i.width=s,i.height=o)};let u=null;const l=_o(r);for await(const c of l){if((s===0||o===0)&&a(),s===0||o===0)continue;if(u===null&&(u=i.getContext("2d")),u===null)return;u.drawImage(e,0,0,s,o),yield u.getImageData(0,0,s,o)}}var M0=(e,t={})=>{const r=t.maxIntervalMs??0,n=t.showCanvas??!1,i=t.onFrame,s=e.videoWidth,o=e.videoHeight,a=document.createElement("CANVAS");a.classList.add("ixfx-capture"),n||(a.style.display="none"),a.width=s,a.height=o;let u=null,l;t.workerScript&&(l=new Worker(t.workerScript));const c=l||i;!c&&!n&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");const d=je(()=>{if(u===null&&(u=a.getContext("2d")),u===null)return;u.drawImage(e,0,0,s,o);let h;if(c&&(h=u.getImageData(0,0,s,o)),l&&l.postMessage({pixels:h.data.buffer,width:s,height:o,channels:4},[h.data.buffer]),i)try{i(h)}catch(f){console.error(f)}},r);return{start:()=>d.start(),cancel:()=>d.cancel(),canvasEl:a}},Ja=(e,t={})=>{const r=t.showCanvas??!1,n=e.videoWidth,i=e.videoHeight,s=t.canvasEl!==void 0;let o=t.canvasEl;return o||(o=document.createElement("CANVAS"),o.classList.add("ixfx-capture"),document.body.append(o),r||(o.style.display="none")),o.width=n,o.height=i,{canvasEl:o,capture:()=>{let c;if(c||(c=o?.getContext("2d",{willReadFrequently:!0})),!c)throw new Error("Could not create graphics context");c.drawImage(e,0,0,n,i);const d=c.getImageData(0,0,n,i);return d.currentTime=e.currentTime,t.postCaptureDraw&&t.postCaptureDraw(c,n,i),d},dispose:()=>{if(!s)try{o?.remove()}catch{}}}},$0=class{_source;_state;_teardownNeeded=!1;_cameraConstraints;_cameraStartResult;_videoSourceCapture;_videoFile;_videoStartResult;_showCanvas;_showPreview;_postCaptureDraw;_timer;_captureCanvasEl;constructor(e={}){this._state="ready",this._source="",this._timer=performance.now(),this._showCanvas=e.showCanvas??!1,this._showPreview=e.showPreview??!1,this._cameraConstraints=e.cameraConstraints??void 0,this._captureCanvasEl=e.captureCanvasEl??void 0,this._postCaptureDraw=e.postCaptureDraw}showPreview(e){if(this._state==="disposed")throw new Error("Disposed");let t;switch(this._source){case"camera":{t=this._cameraStartResult?.videoEl,t!==void 0&&(t.style.display=e?"block":"none");break}}this._showPreview=e}showCanvas(e){if(this._state==="disposed")throw new Error("Disposed");let t;if(this._source==="camera"||this._source==="video")t=this._videoSourceCapture?.canvasEl,t!==void 0&&(t.style.display=e?"block":"none");else throw new Error(`Source not implemented: ${this._source}`);this._showCanvas=e}getCapturer(){if(this._state==="disposed")throw new Error("Disposed");if(this._source==="camera"||this._source==="video")return this._videoSourceCapture;throw new Error(`Source kind not supported ${this._source}`)}async useCamera(e){if(this._state==="disposed")throw new Error("Disposed");this._source="camera",this._teardownNeeded&&this.teardown(),e&&this._cameraConstraints,await this.init()}async useVideo(e){if(this._state==="disposed")throw new Error("Disposed");this._source="video",this._teardownNeeded&&this.teardown(),this._videoFile=e,await this.init()}async initCamera(){const e=await Ga(this._cameraConstraints);if(e===void 0)throw new Error("Could not start camera");this._cameraStartResult=e,this.postInit(e)}async initVideo(){if(!this._videoFile)throw new Error("Video file not defined");const e=await Xa(this._videoFile);this._videoStartResult=e,this.postInit(e)}async postInit(e){this._showPreview&&(e.videoEl.style.display="block"),this._videoSourceCapture=Ja(e.videoEl,{postCaptureDraw:this._postCaptureDraw,showCanvas:this._showCanvas,canvasEl:this._captureCanvasEl}),this._teardownNeeded=!0,this._cameraStartResult=e}dispose(){this._state!=="disposed"&&(this.teardown(),this._state="disposed")}async init(){switch(this._timer=performance.now(),this._source){case"camera":{await this.initCamera();break}case"video":{await this.initVideo();break}}this._state="initialised"}teardown(){if(!!this._teardownNeeded){switch((this._source==="camera"||this._source==="video")&&this._videoSourceCapture?.dispose(),this._source){case"camera":{this._cameraStartResult?.dispose();break}case"video":{this._videoStartResult?.dispose();break}}this._teardownNeeded=!1}}getFrame(){if(this._state==="disposed")throw new Error("Disposed");switch(this._source){case"camera":return this.getFrameCamera();case"video":return this.getFrameCamera();default:throw new Error(`source type unhandled ${this._source}`)}}getTimestamp(){return performance.now()-this._timer}getFrameCamera(){return this._videoSourceCapture?.capture()}},I0=(e,t={})=>{const r=N(t.startDelay,2e3),n=N(t.maxDelay,r*10),i=N(t.checkStateMs,5e3);if(r>n)throw new Error("startDelay should be less than maxDelay");if(i<0)throw new Error("Param 'checkState' should be above zero");let s=!0,o=ie.init({closed:"connecting",open:"closed",connecting:["closed","open"]}),a;const u=g=>{t.onError?t.onError(g):(console.log("rw on error",g),console.error(` error: ${g.error}`),console.error(` type: ${g.type}`),console.error(` error msg: ${g.message}`))},l=g=>{t.onMessage&&t.onMessage(g.data)},c=async()=>{if(o.value==="connecting")throw new Error("Cannot connect twice");o=ie.to(o,"connecting"),a!==void 0&&(a.removeEventListener("error",u),t.onMessage&&a.removeEventListener("message",l),a=void 0);const g=await Ln({async probe(b){try{const j=new WebSocket(e);return(await pd(j,["open","error"],{timeout:1e3})).type==="open"?{success:!0,value:j}:{success:!1,value:void 0}}catch(j){return{success:!1,message:me(j)}}}},{predelayMs:r,limitAttempts:t.limitAttempts});a=g.value;let w=!1;return g.success&&a?(a.addEventListener("error",u),t.onMessage&&a.addEventListener("message",l),w=!0,o=ie.to(o,"open"),t.onConnected&&t.onConnected()):o=ie.to(o,"closed"),w},d=g=>{if(a)a.readyState===a.OPEN?a.send(g):h();else throw new Error("Not connected")},h=()=>{o.value!=="closed"&&(o.value==="open"&&(o=ie.to(o,"closed"),t.onDisconnected&&t.onDisconnected()),s&&o.value!=="connecting"&&(console.log("Scheduling connect"),setTimeout(()=>{c()},100)))},f=()=>a?a.readyState===a.OPEN:!1,m=()=>{s=!1,o=ie.to(o,"closed"),a?.close(),t.onDisconnected&&t.onDisconnected()},p=()=>(s=!0,o.value==="open"?Promise.resolve(!0):o.value==="connecting"?Promise.resolve(!1):c());return c(),setInterval(()=>{if(!!a)switch(a.readyState){case a.CLOSED:{o.value==="open"&&h();break}}},i),{send:d,isConnected:f,close:m,open:p}},L0={};x(L0,{getSorter:()=>Ka,minMaxAvg:()=>Za});var Wt=(e,t=!1)=>r=>{const n=r.toSorted((i,s)=>wn(i[e],s[e]));return t?n.reverse():n},Ka=e=>{switch(e){case"value":return Wt(1,!1);case"value-reverse":return Wt(1,!0);case"key":return Wt(0,!1);case"key-reverse":return Wt(0,!0);default:throw new Error(`Unknown sorting value '${e}'. Expecting: value, value-reverse, key or key-reverse`)}},Za=(e,t)=>{const r=t??(i=>i[1]),n=e.map(i=>r(i));return _t(n)},Qa=(e,t)=>gd(Object.keys(e),Object.keys(t)),V0=(e,t)=>{const r=Ar(e,t,!0);if(Object.entries(r.added).length>0)throw new Error("Shape of data has changed");if(Object.entries(r.removed).length>0)throw new Error("Shape of data has changed");return eu(r,t)},eu=(e,t)=>{const r={};if(e.isArray)return t;for(const n of Object.entries(e.changed))r[n[0]]=n[1];for(const n of Object.entries(e.added))r[n[0]]=n[1];for(const n of Object.entries(e.children))n[1].hasChanged&&(r[n[0]]=eu(n[1],t[n[0]]));return r},xt=(e,t,r=Ms)=>{if(!Array.isArray(e))throw new Error("Param 'a' is not an array");if(!Array.isArray(t))throw new Error("Param 'b' is not an array");const n=Ar(e,t,!1,r);if(!n.isArray)throw new Error("Change set does not have arrays as parameters");const i=o=>{if(o.startsWith("_"))return Number.parseInt(o.slice(1));throw new Error(`Unexpected key '${o}'`)};return{...n,added:ss(n.added,i),changed:ss(n.changed,i),removed:n.removed.map(o=>i(o)),summary:n.summary.map(o=>[o[0],i(o[1]),o[2]])}},Ar=(e,t,r=!1,n=Ms)=>{const i=Object.entries(e),s=Object.entries(t),o=new Set,a={},u={},l={},c=[],d=Array.isArray(e),h=new Array;let f=!1;for(const m of i){const p=d?`_${m[0]}`:m[0],g=m[1],w=t[m[0]];if(o.add(m[0]),w===void 0){f=!0,r&&!d?(a[p]=w,h.push(["mutate",p,w])):(c.push(p),h.push(["del",p,g]));continue}if(typeof g=="object"){const b=Ar(g,w,r,n);b.hasChanged&&(f=!0),l[p]=b;const j=b.summary.map(G=>[G[0],p+"."+G[1],G[2]]);h.push(...j)}else n(g,w)||(a[p]=w,f=!0,h.push(["mutate",p,w]))}if(!r||d)for(const m of s){const p=d?`_${m[0]}`:m[0];o.has(m[0])||(u[p]=m[1],f=!0,h.push(["add",p,m[1]]))}return{changed:a,added:u,removed:c,children:l,hasChanged:f,isArray:d,summary:h}},Qn=mf({"node_modules/json5/dist/index.js"(e,t){(function(r,n){typeof e=="object"&&typeof t<"u"?t.exports=n():typeof define=="function"&&define.amd?define(n):r.JSON5=n()})(e,function(){function r(v,y){return y={exports:{}},v(y,y.exports),y.exports}var n=r(function(v){var y=v.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=y)}),i=r(function(v){var y=v.exports={version:"2.6.5"};typeof __e=="number"&&(__e=y)});i.version;var s=function(v){return typeof v=="object"?v!==null:typeof v=="function"},o=function(v){if(!s(v))throw TypeError(v+" is not an object!");return v},a=function(v){try{return!!v()}catch{return!0}},u=!a(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),l=n.document,c=s(l)&&s(l.createElement),d=function(v){return c?l.createElement(v):{}},h=!u&&!a(function(){return Object.defineProperty(d("div"),"a",{get:function(){return 7}}).a!=7}),f=function(v,y){if(!s(v))return v;var A,E;if(y&&typeof(A=v.toString)=="function"&&!s(E=A.call(v))||typeof(A=v.valueOf)=="function"&&!s(E=A.call(v))||!y&&typeof(A=v.toString)=="function"&&!s(E=A.call(v)))return E;throw TypeError("Can't convert object to primitive value")},m=Object.defineProperty,p=u?Object.defineProperty:function(y,A,E){if(o(y),A=f(A,!0),o(E),h)try{return m(y,A,E)}catch{}if("get"in E||"set"in E)throw TypeError("Accessors not supported!");return"value"in E&&(y[A]=E.value),y},g={f:p},w=function(v,y){return{enumerable:!(v&1),configurable:!(v&2),writable:!(v&4),value:y}},b=u?function(v,y,A){return g.f(v,y,w(1,A))}:function(v,y,A){return v[y]=A,v},j={}.hasOwnProperty,G=function(v,y){return j.call(v,y)},S=0,T=Math.random(),oe=function(v){return"Symbol(".concat(v===void 0?"":v,")_",(++S+T).toString(36))},Z=r(function(v){var y="__core-js_shared__",A=n[y]||(n[y]={});(v.exports=function(E,F){return A[E]||(A[E]=F!==void 0?F:{})})("versions",[]).push({version:i.version,mode:"global",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),k=Z("native-function-to-string",Function.toString),Ji=r(function(v){var y=oe("src"),A="toString",E=(""+k).split(A);i.inspectSource=function(F){return k.call(F)},(v.exports=function(F,R,I,ue){var Q=typeof I=="function";Q&&(G(I,"name")||b(I,"name",R)),F[R]!==I&&(Q&&(G(I,y)||b(I,y,F[R]?""+F[R]:E.join(String(R)))),F===n?F[R]=I:ue?F[R]?F[R]=I:b(F,R,I):(delete F[R],b(F,R,I)))})(Function.prototype,A,function(){return typeof this=="function"&&this[y]||k.call(this)})}),Ki=function(v){if(typeof v!="function")throw TypeError(v+" is not a function!");return v},pt=function(v,y,A){if(Ki(v),y===void 0)return v;switch(A){case 1:return function(E){return v.call(y,E)};case 2:return function(E,F){return v.call(y,E,F)};case 3:return function(E,F,R){return v.call(y,E,F,R)}}return function(){return v.apply(y,arguments)}},gt="prototype",q=function(v,y,A){var E=v&q.F,F=v&q.G,R=v&q.S,I=v&q.P,ue=v&q.B,Q=F?n:R?n[y]||(n[y]={}):(n[y]||{})[gt],Ue=F?i:i[y]||(i[y]={}),et=Ue[gt]||(Ue[gt]={}),ge,De,le,tt;F&&(A=y);for(ge in A)De=!E&&Q&&Q[ge]!==void 0,le=(De?Q:A)[ge],tt=ue&&De?pt(le,n):I&&typeof le=="function"?pt(Function.call,le):le,Q&&Ji(Q,ge,le,v&q.U),Ue[ge]!=le&&b(Ue,ge,tt),I&&et[ge]!=le&&(et[ge]=le)};n.core=i,q.F=1,q.G=2,q.S=4,q.P=8,q.B=16,q.W=32,q.U=64,q.R=128;var fe=q,$e=Math.ceil,yt=Math.floor,wt=function(v){return isNaN(v=+v)?0:(v>0?yt:$e)(v)},$r=function(v){if(v==null)throw TypeError("Can't call method on  "+v);return v},$t=function(v){return function(y,A){var E=String($r(y)),F=wt(A),R=E.length,I,ue;return F<0||F>=R?v?"":void 0:(I=E.charCodeAt(F),I<55296||I>56319||F+1===R||(ue=E.charCodeAt(F+1))<56320||ue>57343?v?E.charAt(F):I:v?E.slice(F,F+2):(I-55296<<10)+(ue-56320)+65536)}},Ir=$t(!1);fe(fe.P,"String",{codePointAt:function(y){return Ir(this,y)}}),i.String.codePointAt;var Lr=Math.max,wc=Math.min,Dc=function(v,y){return v=wt(v),v<0?Lr(v+y,0):wc(v,y)},Zi=String.fromCharCode,Qi=String.fromCodePoint;fe(fe.S+fe.F*(!!Qi&&Qi.length!=1),"String",{fromCodePoint:function(y){for(var A=arguments,E=[],F=arguments.length,R=0,I;F>R;){if(I=+A[R++],Dc(I,1114111)!==I)throw RangeError(I+" is not a valid code point");E.push(I<65536?Zi(I):Zi(((I-=65536)>>10)+55296,I%1024+56320))}return E.join("")}}),i.String.fromCodePoint;var Ec=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,bc=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Ac=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Vr={Space_Separator:Ec,ID_Start:bc,ID_Continue:Ac},J={isSpaceSeparator:function(y){return typeof y=="string"&&Vr.Space_Separator.test(y)},isIdStartChar:function(y){return typeof y=="string"&&(y>="a"&&y<="z"||y>="A"&&y<="Z"||y==="$"||y==="_"||Vr.ID_Start.test(y))},isIdContinueChar:function(y){return typeof y=="string"&&(y>="a"&&y<="z"||y>="A"&&y<="Z"||y>="0"&&y<="9"||y==="$"||y==="_"||y==="\u200C"||y==="\u200D"||Vr.ID_Continue.test(y))},isDigit:function(y){return typeof y=="string"&&/[0-9]/.test(y)},isHexDigit:function(y){return typeof y=="string"&&/[0-9A-Fa-f]/.test(y)}},qr,ae,xe,It,Ie,pe,ee,zr,Dt,Cc=function(y,A){qr=String(y),ae="start",xe=[],It=0,Ie=1,pe=0,ee=void 0,zr=void 0,Dt=void 0;do ee=xc(),kc[ae]();while(ee.type!=="eof");return typeof A=="function"?jr({"":Dt},"",A):Dt};function jr(v,y,A){var E=v[y];if(E!=null&&typeof E=="object")if(Array.isArray(E))for(var F=0;F<E.length;F++){var R=String(F),I=jr(E,R,A);I===void 0?delete E[R]:Object.defineProperty(E,R,{value:I,writable:!0,enumerable:!0,configurable:!0})}else for(var ue in E){var Q=jr(E,ue,A);Q===void 0?delete E[ue]:Object.defineProperty(E,ue,{value:Q,writable:!0,enumerable:!0,configurable:!0})}return A.call(v,y,E)}var P,B,Et,Fe,$;function xc(){for(P="default",B="",Et=!1,Fe=1;;){$=Se();var v=es[P]();if(v)return v}}function Se(){if(qr[It])return String.fromCodePoint(qr.codePointAt(It))}function D(){var v=Se();return v===`
`?(Ie++,pe=0):v?pe+=v.length:pe++,v&&(It+=v.length),v}var es={default:function(){switch($){case"	":case"\v":case"\f":case" ":case"\xA0":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":D();return;case"/":D(),P="comment";return;case void 0:return D(),W("eof")}if(J.isSpaceSeparator($)){D();return}return es[ae]()},comment:function(){switch($){case"*":D(),P="multiLineComment";return;case"/":D(),P="singleLineComment";return}throw O(D())},multiLineComment:function(){switch($){case"*":D(),P="multiLineCommentAsterisk";return;case void 0:throw O(D())}D()},multiLineCommentAsterisk:function(){switch($){case"*":D();return;case"/":D(),P="default";return;case void 0:throw O(D())}D(),P="multiLineComment"},singleLineComment:function(){switch($){case`
`:case"\r":case"\u2028":case"\u2029":D(),P="default";return;case void 0:return D(),W("eof")}D()},value:function(){switch($){case"{":case"[":return W("punctuator",D());case"n":return D(),We("ull"),W("null",null);case"t":return D(),We("rue"),W("boolean",!0);case"f":return D(),We("alse"),W("boolean",!1);case"-":case"+":D()==="-"&&(Fe=-1),P="sign";return;case".":B=D(),P="decimalPointLeading";return;case"0":B=D(),P="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":B=D(),P="decimalInteger";return;case"I":return D(),We("nfinity"),W("numeric",1/0);case"N":return D(),We("aN"),W("numeric",NaN);case'"':case"'":Et=D()==='"',B="",P="string";return}throw O(D())},identifierNameStartEscape:function(){if($!=="u")throw O(D());D();var y=Wr();switch(y){case"$":case"_":break;default:if(!J.isIdStartChar(y))throw ts();break}B+=y,P="identifierName"},identifierName:function(){switch($){case"$":case"_":case"\u200C":case"\u200D":B+=D();return;case"\\":D(),P="identifierNameEscape";return}if(J.isIdContinueChar($)){B+=D();return}return W("identifier",B)},identifierNameEscape:function(){if($!=="u")throw O(D());D();var y=Wr();switch(y){case"$":case"_":case"\u200C":case"\u200D":break;default:if(!J.isIdContinueChar(y))throw ts();break}B+=y,P="identifierName"},sign:function(){switch($){case".":B=D(),P="decimalPointLeading";return;case"0":B=D(),P="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":B=D(),P="decimalInteger";return;case"I":return D(),We("nfinity"),W("numeric",Fe*(1/0));case"N":return D(),We("aN"),W("numeric",NaN)}throw O(D())},zero:function(){switch($){case".":B+=D(),P="decimalPoint";return;case"e":case"E":B+=D(),P="decimalExponent";return;case"x":case"X":B+=D(),P="hexadecimal";return}return W("numeric",Fe*0)},decimalInteger:function(){switch($){case".":B+=D(),P="decimalPoint";return;case"e":case"E":B+=D(),P="decimalExponent";return}if(J.isDigit($)){B+=D();return}return W("numeric",Fe*Number(B))},decimalPointLeading:function(){if(J.isDigit($)){B+=D(),P="decimalFraction";return}throw O(D())},decimalPoint:function(){switch($){case"e":case"E":B+=D(),P="decimalExponent";return}if(J.isDigit($)){B+=D(),P="decimalFraction";return}return W("numeric",Fe*Number(B))},decimalFraction:function(){switch($){case"e":case"E":B+=D(),P="decimalExponent";return}if(J.isDigit($)){B+=D();return}return W("numeric",Fe*Number(B))},decimalExponent:function(){switch($){case"+":case"-":B+=D(),P="decimalExponentSign";return}if(J.isDigit($)){B+=D(),P="decimalExponentInteger";return}throw O(D())},decimalExponentSign:function(){if(J.isDigit($)){B+=D(),P="decimalExponentInteger";return}throw O(D())},decimalExponentInteger:function(){if(J.isDigit($)){B+=D();return}return W("numeric",Fe*Number(B))},hexadecimal:function(){if(J.isHexDigit($)){B+=D(),P="hexadecimalInteger";return}throw O(D())},hexadecimalInteger:function(){if(J.isHexDigit($)){B+=D();return}return W("numeric",Fe*Number(B))},string:function(){switch($){case"\\":D(),B+=Fc();return;case'"':if(Et)return D(),W("string",B);B+=D();return;case"'":if(!Et)return D(),W("string",B);B+=D();return;case`
`:case"\r":throw O(D());case"\u2028":case"\u2029":Bc($);break;case void 0:throw O(D())}B+=D()},start:function(){switch($){case"{":case"[":return W("punctuator",D())}P="value"},beforePropertyName:function(){switch($){case"$":case"_":B=D(),P="identifierName";return;case"\\":D(),P="identifierNameStartEscape";return;case"}":return W("punctuator",D());case'"':case"'":Et=D()==='"',P="string";return}if(J.isIdStartChar($)){B+=D(),P="identifierName";return}throw O(D())},afterPropertyName:function(){if($===":")return W("punctuator",D());throw O(D())},beforePropertyValue:function(){P="value"},afterPropertyValue:function(){switch($){case",":case"}":return W("punctuator",D())}throw O(D())},beforeArrayValue:function(){if($==="]")return W("punctuator",D());P="value"},afterArrayValue:function(){switch($){case",":case"]":return W("punctuator",D())}throw O(D())},end:function(){throw O(D())}};function W(v,y){return{type:v,value:y,line:Ie,column:pe}}function We(v){for(var y=0,A=v;y<A.length;y+=1){var E=A[y],F=Se();if(F!==E)throw O(D());D()}}function Fc(){var v=Se();switch(v){case"b":return D(),"\b";case"f":return D(),"\f";case"n":return D(),`
`;case"r":return D(),"\r";case"t":return D(),"	";case"v":return D(),"\v";case"0":if(D(),J.isDigit(Se()))throw O(D());return"\0";case"x":return D(),Sc();case"u":return D(),Wr();case`
`:case"\u2028":case"\u2029":return D(),"";case"\r":return D(),Se()===`
`&&D(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw O(D());case void 0:throw O(D())}return D()}function Sc(){var v="",y=Se();if(!J.isHexDigit(y)||(v+=D(),y=Se(),!J.isHexDigit(y)))throw O(D());return v+=D(),String.fromCodePoint(parseInt(v,16))}function Wr(){for(var v="",y=4;y-- >0;){var A=Se();if(!J.isHexDigit(A))throw O(D());v+=D()}return String.fromCodePoint(parseInt(v,16))}var kc={start:function(){if(ee.type==="eof")throw Oe();Or()},beforePropertyName:function(){switch(ee.type){case"identifier":case"string":zr=ee.value,ae="afterPropertyName";return;case"punctuator":Lt();return;case"eof":throw Oe()}},afterPropertyName:function(){if(ee.type==="eof")throw Oe();ae="beforePropertyValue"},beforePropertyValue:function(){if(ee.type==="eof")throw Oe();Or()},beforeArrayValue:function(){if(ee.type==="eof")throw Oe();if(ee.type==="punctuator"&&ee.value==="]"){Lt();return}Or()},afterPropertyValue:function(){if(ee.type==="eof")throw Oe();switch(ee.value){case",":ae="beforePropertyName";return;case"}":Lt()}},afterArrayValue:function(){if(ee.type==="eof")throw Oe();switch(ee.value){case",":ae="beforeArrayValue";return;case"]":Lt()}},end:function(){}};function Or(){var v;switch(ee.type){case"punctuator":switch(ee.value){case"{":v={};break;case"[":v=[];break}break;case"null":case"boolean":case"numeric":case"string":v=ee.value;break}if(Dt===void 0)Dt=v;else{var y=xe[xe.length-1];Array.isArray(y)?y.push(v):Object.defineProperty(y,zr,{value:v,writable:!0,enumerable:!0,configurable:!0})}if(v!==null&&typeof v=="object")xe.push(v),Array.isArray(v)?ae="beforeArrayValue":ae="beforePropertyName";else{var A=xe[xe.length-1];A==null?ae="end":Array.isArray(A)?ae="afterArrayValue":ae="afterPropertyValue"}}function Lt(){xe.pop();var v=xe[xe.length-1];v==null?ae="end":Array.isArray(v)?ae="afterArrayValue":ae="afterPropertyValue"}function O(v){return Vt(v===void 0?"JSON5: invalid end of input at "+Ie+":"+pe:"JSON5: invalid character '"+rs(v)+"' at "+Ie+":"+pe)}function Oe(){return Vt("JSON5: invalid end of input at "+Ie+":"+pe)}function ts(){return pe-=5,Vt("JSON5: invalid identifier character at "+Ie+":"+pe)}function Bc(v){console.warn("JSON5: '"+rs(v)+"' in strings is not valid ECMAScript; consider escaping")}function rs(v){var y={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(y[v])return y[v];if(v<" "){var A=v.charCodeAt(0).toString(16);return"\\x"+("00"+A).substring(A.length)}return v}function Vt(v){var y=new SyntaxError(v);return y.lineNumber=Ie,y.columnNumber=pe,y}var Tc=function(y,A,E){var F=[],R="",I,ue,Q="",Ue;if(A!=null&&typeof A=="object"&&!Array.isArray(A)&&(E=A.space,Ue=A.quote,A=A.replacer),typeof A=="function")ue=A;else if(Array.isArray(A)){I=[];for(var et=0,ge=A;et<ge.length;et+=1){var De=ge[et],le=void 0;typeof De=="string"?le=De:(typeof De=="number"||De instanceof String||De instanceof Number)&&(le=String(De)),le!==void 0&&I.indexOf(le)<0&&I.push(le)}}return E instanceof Number?E=Number(E):E instanceof String&&(E=String(E)),typeof E=="number"?E>0&&(E=Math.min(10,Math.floor(E)),Q="          ".substr(0,E)):typeof E=="string"&&(Q=E.substr(0,10)),tt("",{"":y});function tt(z,re){var _=re[z];switch(_!=null&&(typeof _.toJSON5=="function"?_=_.toJSON5(z):typeof _.toJSON=="function"&&(_=_.toJSON(z))),ue&&(_=ue.call(re,z,_)),_ instanceof Number?_=Number(_):_ instanceof String?_=String(_):_ instanceof Boolean&&(_=_.valueOf()),_){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof _=="string")return qt(_);if(typeof _=="number")return String(_);if(typeof _=="object")return Array.isArray(_)?$c(_):Rc(_)}function qt(z){for(var re={"'":.1,'"':.2},_={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},te="",ye=0;ye<z.length;ye++){var ne=z[ye];switch(ne){case"'":case'"':re[ne]++,te+=ne;continue;case"\0":if(J.isDigit(z[ye+1])){te+="\\x00";continue}}if(_[ne]){te+=_[ne];continue}if(ne<" "){var He=ne.charCodeAt(0).toString(16);te+="\\x"+("00"+He).substring(He.length);continue}te+=ne}var ke=Ue||Object.keys(re).reduce(function(Le,Ge){return re[Le]<re[Ge]?Le:Ge});return te=te.replace(new RegExp(ke,"g"),_[ke]),ke+te+ke}function Rc(z){if(F.indexOf(z)>=0)throw TypeError("Converting circular structure to JSON5");F.push(z);var re=R;R=R+Q;for(var _=I||Object.keys(z),te=[],ye=0,ne=_;ye<ne.length;ye+=1){var He=ne[ye],ke=tt(He,z);if(ke!==void 0){var Le=Mc(He)+":";Q!==""&&(Le+=" "),Le+=ke,te.push(Le)}}var Ge;if(te.length===0)Ge="{}";else{var zt;if(Q==="")zt=te.join(","),Ge="{"+zt+"}";else{var Ic=`,
`+R;zt=te.join(Ic),Ge=`{
`+R+zt+`,
`+re+"}"}}return F.pop(),R=re,Ge}function Mc(z){if(z.length===0)return qt(z);var re=String.fromCodePoint(z.codePointAt(0));if(!J.isIdStartChar(re))return qt(z);for(var _=re.length;_<z.length;_++)if(!J.isIdContinueChar(String.fromCodePoint(z.codePointAt(_))))return qt(z);return z}function $c(z){if(F.indexOf(z)>=0)throw TypeError("Converting circular structure to JSON5");F.push(z);var re=R;R=R+Q;for(var _=[],te=0;te<z.length;te++){var ye=tt(String(te),z);_.push(ye!==void 0?ye:"null")}var ne;if(_.length===0)ne="[]";else if(Q===""){var He=_.join(",");ne="["+He+"]"}else{var ke=`,
`+R,Le=_.join(ke);ne=`[
`+R+Le+`,
`+re+"]"}return F.pop(),R=re,ne}},_c={parse:Cc,stringify:Tc},Pc=_c,Nc=Pc;return Nc})}}),q0={};x(q0,{Dom:()=>_u,From:()=>Ve,Ops:()=>ji,Sinks:()=>wp,annotate:()=>ii,annotateWithOp:()=>su,average:()=>vi,batch:()=>si,cache:()=>Dp,chainer:()=>O0,cloneFromFields:()=>ou,combineLatestToArray:()=>oi,combineLatestToObject:()=>xr,count:()=>cv,debounce:()=>ci,drop:()=>W0,elapsed:()=>cu,field:()=>Fr,filter:()=>di,hasLast:()=>ft,isReactive:()=>Cr,isTrigger:()=>ru,isTriggerFunction:()=>ri,isTriggerGenerator:()=>ni,isTriggerValue:()=>ti,isWrapped:()=>tu,isWritable:()=>ei,manual:()=>nc,max:()=>fi,messageHasValue:()=>se,messageIsDoneSignal:()=>Ae,messageIsSignal:()=>Rt,min:()=>hi,opify:()=>ve,pipe:()=>fu,prepare:()=>uv,rank:()=>du,resolveSource:()=>Y,resolveTriggerValue:()=>nu,run:()=>U0,runHead:()=>H0,setHtmlText:()=>xi,singleFromArray:()=>hu,split:()=>gi,splitLabelled:()=>yi,sum:()=>mi,switcher:()=>wi,symbol:()=>Bu,syncToArray:()=>Sr,syncToObject:()=>kr,takeNextValue:()=>Ep,tally:()=>pi,tapOps:()=>bi,tapProcess:()=>Di,tapStream:()=>Ei,throttle:()=>Ai,timeoutTrigger:()=>Ci,to:()=>bp,toArray:()=>Bi,toArrayOrThrow:()=>Tu,toGenerator:()=>lv,transform:()=>Me,withValue:()=>mu,wrap:()=>U});function Rt(e){return e.value!==void 0?!1:"signal"in e&&e.signal!==void 0}function Ae(e){return e.value!==void 0?!1:"signal"in e&&e.signal==="done"}function se(e){return e.value!==void 0}var ft=e=>Cr(e)?e.last()!==void 0:!1,Cr=e=>typeof e!="object"||e===null?!1:"on"in e&&"onValue"in e,ei=e=>Cr(e)?"set"in e:!1,tu=e=>!(typeof e!="object"||!("source"in e)||!("annotateElapsed"in e)),ve=(e,...t)=>r=>e(r,...t),ti=e=>"value"in e,ri=e=>"fn"in e,ni=e=>ur(e),ru=e=>typeof e!="object"?!1:!!(ti(e)||ri(e)||ni(e));function nu(e){if(ti(e))return[e.value,!1];if(ri(e)){const t=e.fn();return t===void 0?[void 0,!0]:[t,!1]}if(ni(e)){const t=e.gen.next();return t.done?[void 0,!0]:[t.value,!1]}throw new Error("Invalid trigger. Missing 'value' or 'fn' fields")}function iu(e,t={}){const r=t.maximumRepeats??Number.MAX_SAFE_INTEGER,n=t.closeOnError??!0,i=N(t.interval,1),s=t.interval!==void 0,o=N(t.predelay,1),a=t.lazy??"very",u=t.signal,l=new AbortController,c=p=>{l.abort(p)};let d=0;if(t.maximumRepeats&&!s)throw new Error("'maximumRepeats' has no purpose if 'loop' is not set to true");const h=p=>{m.dispose(p),f.cancel()},f=je(async()=>{o&&await K(o);try{if(u?.aborted)return h(`Signal (${u.aborted})`),!1;const p=await e(c);m.set(p),d++}catch(p){if(n)return h(`Function error: ${me(p)}`),!1;m.signal("warn",me(p))}if(!s)return h("fromFunction done"),!1;if(l.signal.aborted)return h(`callback function aborted (${l.signal.reason})`),!1;if(d>=r)return h(`Maximum repeats reached ${r.toString()}`),!1},i),m=ht({lazy:a,onStart(){f.start()},onStop(){f.cancel()}});return a==="never"&&f.start(),m}function ln(e,t={}){const r=t.lazy??"very",n=t.traceLifecycle?f=>{console.log(`Rx.From.iterator ${f}`)}:f=>{},i=N(t.readInterval,5),s=N(t.readTimeout,5*60*1e3),o=t.whenStopped??"continue";let a,u,l=ie.init({idle:["wait_for_next"],wait_for_next:["processing_result","stopping","disposed"],processing_result:["queued","disposed","stopping"],queued:["wait_for_next","disposed","stopping"],stopping:"idle",disposed:null},"idle");const c=()=>{n("onExternalSignal"),u?.abort(t.signal?.reason)};t.signal&&t.signal.addEventListener("abort",c,{once:!0});const d=async()=>{n(`read. State: ${l.value}`),u=new AbortController;try{l=ie.to(l,"wait_for_next");const f=await jn(a,{signal:u.signal,millis:s});if(l=ie.to(l,"processing_result"),u?.abort("nextWithTimeout completed"),f.done&&(n("read v.done true"),h.dispose("Generator complete"),l=ie.to(l,"disposed")),l.value==="stopping"){n("read. sm.value = stopping"),l=ie.to(l,"idle");return}if(l.value==="disposed"){n("read. sm.value = disposed");return}h.set(f.value)}catch(f){h.dispose(`Generator error: ${f.toString()}`);return}l.value==="processing_result"?(l=ie.to(l,"queued"),n(`scheduling read. State: ${l.value}`),setTimeout(d,i)):l=ie.to(l,"idle")},h=ht({...t,lazy:r,onStart(){n(`onStart state: ${l.value} whenStopped: ${o}`),l.value==="idle"&&((l.value==="idle"&&o==="reset"||a===void 0)&&(a=L(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]()),d())},onStop(){n(`onStop state: ${l.value} whenStopped: ${o}`),l=ie.to(l,"stopping"),o==="reset"&&(n("onStop reiniting iterator"),a=L(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]())},onDispose(f){n(`onDispose (${f})`),u?.abort(`Rx.From.iterator disposed (${f})`),t.signal&&t.signal.removeEventListener("abort",c)}});return h}var Y=(e,t={})=>{if(Cr(e))return e;const r=t.generator??{lazy:"initial",interval:5},n=t.function??{lazy:"very"};if(Array.isArray(e))return ln(e.values(),r);if(typeof e=="function")return iu(e,n);if(typeof e=="object"){if(tu(e))return e.source;if(ur(e)||L(e))return ln(e,r)}throw new TypeError(`Unable to resolve source. Supports: array, Reactive, Async/Iterable. Got type: ${typeof e}`)},he=(e,t)=>{const r=t.lazy??"initial",n=t.disposeIfSourceDone??!0,i=t.onValue??(c=>{}),s=Y(e);let o;const a=()=>{o===void 0&&(t.onStart&&t.onStart(),o=s.on(c=>{Rt(c)?c.signal==="done"?(u(),n&&l.dispose(`Upstream source has completed (${c.context??""})`)):l.through(c):se(c)&&i(c.value)}))},u=()=>{o!==void 0&&(o(),o=void 0,t.onStop&&t.onStop())},l=ht({...t,lazy:r,onStart(){a()},onStop(){u()}});return l};function ht(e){const t=e.lazy??"initial",r=e.onStop??(()=>{}),n=e.onStart??(()=>{}),i=ce({...e,onFirstSubscribe(){t!=="never"&&n()},onNoSubscribers(){t==="very"&&r()}});return t==="never"&&n(),i}function ce(e={}){let t,r=!1,n=!1,i=!0;const s=e.onFirstSubscribe??void 0,o=e.onNoSubscribers??void 0,a=()=>{t!==void 0&&(!t.isEmpty||i||(i=!0,n=!1,o&&o()))},u=l=>{if(r)throw new Error("Disposed, cannot subscribe");t===void 0&&(t=new $n);const c=t.add(l);return i=!1,n||(n=!0,s&&setTimeout(()=>{s()},10)),()=>{t?.remove(c),a()}};return{dispose:l=>{r||(t?.notify({value:void 0,signal:"done",context:`Disposed: ${l}`}),r=!0,e.onDispose&&e.onDispose(l))},isDisposed:()=>r,reset:()=>{t?.clear(),a()},set:l=>{if(r)throw new Error("Disposed, cannot set");t?.notify({value:l})},through:l=>{if(r)throw new Error("Disposed, cannot through");t?.notify(l)},signal:(l,c)=>{if(r)throw new Error("Disposed, cannot signal");t?.notify({signal:l,value:void 0,context:c})},on:l=>u(l),onValue:l=>u(d=>{se(d)&&l(d.value)})}}var Ce=e=>({on:e.on,dispose:e.dispose,isDisposed:e.isDisposed,onValue:e.onValue});function ii(e,t,r={}){const n=he(e,{...r,onValue(i){const s=t(i);n.set({value:i,annotation:s})}});return Ce(n)}function su(e,t){const r=Y(e),n=t(r);return kr({value:r,annotation:n})}function si(e,t={}){const r=new Ke,n=t.quantity??0,i=t.returnRemainder??!0,s={...t,onStop(){if(i&&!r.isEmpty){const l=r.toArray();r.clear(),o.set(l)}},onValue(l){r.enqueue(l),n>0&&r.length>=n&&a(),u!==void 0&&u.runState==="idle"&&u.start()}},o=he(e,s),a=()=>{if(r.isEmpty)return;u!==void 0&&u.start();const l=r.toArray();r.clear(),o.set(l)},u=t.elapsed?Pt(a,t.elapsed):void 0;return Ce(o)}function Me(e,t,r={}){const n=r.traceInput??!1,i=r.traceOutput??!1,s=he(e,{lazy:"initial",...r,onValue(o){const a=t(o);n&&i?console.log(`Rx.Ops.transform input: ${JSON.stringify(o)} output: ${JSON.stringify(a)}`):n?console.log(`Rx.Ops.transform input: ${JSON.stringify(o)}`):i&&console.log(`Rx.Ops.transform output: ${JSON.stringify(a)}`),s.set(a)}});return Ce(s)}var ou=e=>Me(e,t=>{const r=[];for(const n in t){const i=t[n];Is(i)&&r.push([n,i])}return Object.fromEntries(r)});function oi(e,t={}){const r=ce(),n=t.onSourceDone??"break",i=[],s=e.map(c=>Y(c)),o=()=>{},a=s.map(c=>o),u=s.map(c=>!1),l=()=>{for(const c of a)c()};for(const[c,d]of s.entries())i[c]=void 0,a[c]=d.on(h=>{if(Ae(h)){if(u[c]=!0,a[c](),a[c]=o,n==="break"){l(),r.dispose("Source has completed and 'break' is set");return}u.includes(!1)||(l(),r.dispose("All sources completed"))}else se(h)&&(i[c]=h.value,r.set([...i]))});return{dispose:r.dispose,isDisposed:r.isDisposed,on:r.on,onValue:r.onValue}}var au={};x(au,{applyChanges:()=>j0,compareData:()=>ot,getField:()=>li,getPaths:()=>uu,getPathsAndData:()=>fn,updateByPath:()=>ui});var bs=An(Qn(),1),z0=e=>[...Object.entries(e)].length===0,ai=(e,t,r)=>bs.stringify(e)===bs.stringify(t),As=(e,t)=>{if(t){const r=[];for(const n in e){const i=e[n];Is(i)&&r.push([n,i])}return r}else return Object.entries(e)};function*ot(e,t,r={}){if(e===void 0){yield{path:r.pathPrefix??"",value:t,state:"added"};return}if(t===void 0){yield{path:r.pathPrefix??"",previous:e,value:void 0,state:"removed"};return}const n=r.pathPrefix??"",i=r.deepEntries??!1,s=r.eq??ai,o=r.includeMissingFromA??!1,a=r.includeParents??!1;if(Zr(e)&&Zr(t)){e!==t&&(yield{path:n,value:t,previous:e,state:"change"});return}const u=As(e,i),l=new Set;for(const[c,d]of u)if(l.add(c),typeof d=="object"){const h=[...ot(d,t[c],{...r,pathPrefix:n+c+"."})];if(h.length>0){for(const f of h)yield f;a&&(yield{path:n+c,value:t[c],previous:d,state:"change"})}}else{const h=n+c;if(c in t){const f=t[c];s(d,f,h)||(yield{path:h,previous:d,value:f,state:"change"})}else yield{path:h,previous:d,value:void 0,state:"removed"}}if(o){const c=As(t,i);for(const[d,h]of c)l.has(d)||(yield{path:n+d,previous:void 0,value:h,state:"added"})}}var j0=(e,t)=>{for(const r of t)e=ui(e,r.path,r.value);return e},ui=(e,t,r,n=!1)=>{if(t===void 0)throw new Error("Parameter 'path' is undefined");if(typeof t!="string")throw new Error(`Parameter 'path' should be a string. Got: ${typeof t}`);if(e===void 0)throw new Error("Parameter 'target' is undefined");if(e===null)throw new Error("Parameter 'target' is null");const i=t.split(".");return cn(e,i,r,n)},cn=(e,t,r,n)=>{if(t.length===0){if(n)return r;if(Array.isArray(e)&&!Array.isArray(r))throw new Error(`Expected array value, got: '${JSON.stringify(r)}'. Set allowShapeChange=true to ignore.`);if(!Array.isArray(e)&&Array.isArray(r))throw new Error(`Unexpected array value, got: '${JSON.stringify(r)}'. Set allowShapeChange=true to ignore.`);if(typeof e!=typeof r)throw new Error(`Cannot reassign object type. (${typeof e} -> ${typeof r}). Set allowShapeChange=true to ignore.`);if(typeof e=="object"&&!Array.isArray(e)){const o=Qa(e,r);if(o.a.length>0)throw new Error(`New value is missing key(s): ${o.a.join(",")}`);if(o.b.length>0)throw new Error(`New value cannot add new key(s): ${o.b.join(",")}`)}return r}const i=t.shift();if(!i)return r;if(Ls(i)&&Array.isArray(e)){const o=Number.parseInt(i);if(o>=e.length&&!n)throw new Error(`Array index ${o.toString()} is outside of the existing length of ${e.length.toString()}. Use allowShapeChange=true to permit this.`);const a=[...e];return a[o]=cn(a[o],t,r,n),a}else if(i in e){const o={...e};return o[i]=cn(o[i],t,r,n),o}else throw new Error(`Path ${i} not found in data`)},li=(e,t)=>{if(typeof t!="string")throw new Error(`Parameter 'path' ought to be a string. Got: '${typeof t}'`);if(t.length===0)throw new Error("Parameter 'path' is empty");if(e===void 0)throw new Error("Parameter 'object' is undefined");if(e===null)throw new Error("Parameter 'object' is null");const r=t.split(".");return dn(e,r)},dn=(e,t)=>{if(e===void 0)throw new Error("Parameter 'object' is undefined");if(t.length===0)throw new Error("Path run out");const r=t.shift();if(!r)throw new Error("Unexpected empty split path");if(Ls(r)&&Array.isArray(e)){const i=Number.parseInt(r);return t.length===0?e[i]:dn(e[i],t)}else{if(r in e)return t.length===0?e[r]:dn(e[r],t);throw new Error(`Path '${r}' not found in data`)}};function*uu(e,t=!1){if(e==null)return;const r=yd(e);for(const n of r){if(n.nodeValue===void 0&&t)continue;let i=n.name;n.ancestors.length>0&&(i=n.ancestors.join(".")+"."+i),yield i}}function*fn(e,t=Number.MAX_SAFE_INTEGER,r=""){e!==null&&e!==void 0&&(yield*lu(e,r,t))}function*lu(e,t,r){if(!(r<=0)&&typeof e=="object")for(const n of Object.entries(e)){const i=(t.length>0?t+".":"")+n[0];yield{path:i,value:n[1]},yield*lu(n[1],i,r-1)}}function Mt(e,t={}){const r=t.eq??ai,n=ce(),i=ce(),s=new Map;let o=e,a=!1;const u=f=>{const m=[...ot(o??{},f,{...t,includeMissingFromA:!0})];m.length!==0&&(o=f,n.set(f),i.set(m))},l=(f,m)=>{const p=s.get(f.toLowerCase());p!==void 0&&p.notify(m)},c=f=>{if(o===void 0){o=f,n.set(o);for(const[m,p]of Object.entries(f))l(m,p);return o}else{const m=[...ot(o,f)],p=m.filter(g=>g.state!=="removed");if(p.length===0)return o;o={...o,...f},n.set(o),i.set(m);for(const g of p)l(g.path,g.value);return o}};return{dispose:f=>{a||(i.dispose(f),n.dispose(f),a=!0)},isDisposed(){return a},updateField:(f,m)=>{if(o===void 0)throw new Error("Cannot update value when it has not already been set");const p=li(o,f);if(r(p,m,f))return;let g=[...ot(p,m,{...t,includeMissingFromA:!0})];g=g.map(b=>b.path.length>0?{...b,path:f+"."+b.path}:{...b,path:f});const w=ui(o,f,m,!0);o=w,n.set(w),i.set(g),l(f,m)},last:()=>o,on:n.on,onValue:n.onValue,onDiff:i.onValue,onField(f,m){let p=s.get(f.toLowerCase());p===void 0&&(p=new $n,s.set(f.toLowerCase(),p));const g=p.add(w=>{setTimeout(()=>{m(w,f)},1)});return()=>p.remove(g)},set:u,update:c}}function xr(e,t={}){const r=t.disposeSources??!0,n=Mt(void 0),i=t.onSourceDone??"break",s=new Map;for(const[d,h]of Object.entries(e)){const f="last"in h?h.last():void 0,m={source:Y(h),done:!1,data:f,off:()=>{}};s.set(d,m)}const o=Object.fromEntries(Object.entries(s).map(d=>[d[0],d[1].source])),a=()=>Kr.some(s,d=>!d.done),u=()=>{for(const d of s.values())d.off()},l=()=>{const d={};for(const[h,f]of s)f.data!==void 0&&(d[h]=f.data);return d},c=d=>{d.off=d.source.on(h=>{if(Ae(h)){if(d.done=!0,d.off(),d.off=()=>{},i==="break"){u(),n.dispose("Source has completed and 'break' is behaviour");return}a()||(u(),n.dispose("All sources completed"))}else se(h)&&(d.data=h.value,n.set(l()))})};for(const d of s.values())c(d);return{...n,hasSource(d){return s.has(d)},replaceSource(d,h){const f=s.get(d);if(f===void 0)throw new Error(`Field does not exist: '${d}'`);f.off();const m=Y(h);f.source=m,c(f)},setWith(d){let h={};for(const[f,m]of Object.entries(d)){const p=s.get(f);p!==void 0&&(ei(p.source)&&(p.source.set(m),h[f]=m),p.data=m)}return h},sources:o,last(){return l()},dispose(d){if(u(),n.dispose(d),r)for(const h of s.values())h.source.dispose("Part of disposed mergeToObject")}}}function ci(e,t={}){const r=N(t.elapsed,50);let n;const i=Pt(()=>{const o=n;o&&(s.set(o),n=void 0)},r),s=he(e,{...t,onValue(o){n=o,i.start()}});return Ce(s)}var cu=e=>{let t=0;return Me(e,r=>{const n=t===0?0:Date.now()-t;return t=Date.now(),n})};function Fr(e,t,r={}){const n=r.fallbackFieldValue,i=r.fallbackObject,s=he(e,{disposeIfSourceDone:!0,...r,onValue(o){let a;t in o?a=o[t]:i&&t in i&&(a=i[t]),a===void 0&&(a=n),a!==void 0&&s.set(a)}});return Ce(s)}function di(e,t,r){const n=he(e,{...r,onValue(i){t(i)&&n.set(i)}});return Ce(n)}function W0(e,t,r){const n=he(e,{...r,onValue(i){t(i)||n.set(i)}});return Ce(n)}function fi(e,t){const r=ua();return vt(r,"max",e,t)}function hi(e,t){const r=la();return vt(r,"min",e,t)}function vi(e,t){const r=da();return vt(r,"average",e,t)}function mi(e,t){const r=ca();return vt(r,"sum",e,t)}function pi(e,t={}){const r=t.countArrayItems??!0,n=fa(r);return vt(n,"tally",e,t)}function du(e,t,r){const n=ha(t,r);return vt(n,"rank",e,r)}function vt(e,t,r,n={}){const i=n.annotate;let s;const o=n.skipUndefined??!0,a=n.skipIdentical??!0,u=he(r,{...n,onValue(l){const c=e(l);if(!(c===void 0&&o)&&!(a&&c===s))if(s=c,i){const d={value:l};d[t]=c,u.set(d)}else u.set(c)}});return Ce(u)}var fu=(...e)=>{const t=ce(),r=[],n=i=>{for(const s of e)s.isDisposed||s.dispose(i);for(const s of r)s();t.dispose(i)};for(let i=0;i<e.length;i++)r.push(e[i].on(s=>{const o=i===e.length-1;se(s)?o?t.set(s.value):e[i+1].set(s.value):Ae(s)&&n("Upstream disposed")}));return{on:t.on,onValue:t.onValue,dispose(i){n(i)},isDisposed(){return t.isDisposed()}}};function hu(e,t={}){const r=t.order??"default";if(!t.at&&!t.predicate)throw new Error("Options must have 'predicate' or 'at' fields");let n=s=>s;r==="random"?n=Gt:typeof r=="function"&&(n=s=>s.toSorted(r));const i=he(e,{onValue(s){if(s=n(s),t.predicate)for(const o of s)t.predicate(o)&&i.set(o);else t.at&&i.set(s.at(t.at))}});return i}var gi=(e,t={})=>{const r=t.quantity??2,n=[],i=Y(e);for(let s=0;s<r;s++)n.push(he(i,{disposeIfSourceDone:!0,lazy:"initial"}));return n},yi=(e,t)=>{const r=Y(e),n={};for(const i of t)n[i]=he(r,{lazy:"initial",disposeIfSourceDone:!0});return n},wi=(e,t,r={})=>{const n=r.match??"first",i=Y(e);let s=!1;const o={};for(const l of Object.keys(t))o[l]=ce();const a=()=>{if(!s){u(),s=!0;for(const l of Object.values(o))l.dispose("switcher source dispose")}},u=i.on(l=>{if(se(l)){for(const[c,d]of Object.entries(t))if(d(l.value)&&(o[c].set(l.value),n==="first"))break}else Ae(l)&&a()});return o};function Sr(e,t={}){const r=t.onSourceDone??"break",n=t.finalValue??"undefined",i=N(t.maximumWait,2e3);let s;const o=[],a=e.map(g=>({finalData:void 0,done:!1,source:Y(g),unsub:()=>{}})),u=()=>{for(const g of a)g.unsub(),g.unsub=()=>{}},l=()=>{for(let g=0;g<o.length;g++)if(!(r==="allow"&&a[g].done)&&o[g]===void 0)return!1;return!0},c=()=>a.some(g=>!g.done),d=()=>{for(let g=0;g<o.length;g++)n==="last"&&a[g].done||(o[g]=void 0)},h=()=>{f(`Sync timeout exceeded (${i.toString()})`)},f=g=>{s&&clearTimeout(s),u(),p.dispose(g)},m=()=>{s=setTimeout(h,i);for(const[g,w]of a.entries())o[g]=void 0,w.unsub=w.source.on(b=>{if(Rt(b)){if(b.signal==="done"){if(w.finalData=o[g],w.unsub(),w.done=!0,w.unsub=()=>{},n==="undefined"&&(o[g]=void 0),r==="break"){f(`Source '${g.toString()}' done, and onSourceDone:'break' is set`);return}if(!c()){f("All sources done");return}}return}o[g]=b.value,l()&&(p.set([...o]),d(),s&&clearTimeout(s),s=setTimeout(h,i))})},p=ce({onFirstSubscribe(){u(),m()},onNoSubscribers(){s&&clearTimeout(s),u()}});return{dispose:p.dispose,isDisposed:p.isDisposed,on:p.on,onValue:p.onValue}}function kr(e,t={}){const r=Object.keys(e),n=Object.values(e),i=Sr(n,t);return Me(i,o=>wd(r,o))}function vu(...e){return t=>{let r=t;for(const n of e)r=n(r);return r}}function Di(e,...t){const r=Y(e),n=vu(...t);return r.onValue(i=>{n(i)}),r}function Ei(e,t){const r=Y(e);return r.onValue(n=>{t.set(n)}),r}var bi=(e,...t)=>{for(const r of t)e=r(e);return e};function Ai(e,t={}){const r=N(t.elapsed,0);let n=performance.now(),i;const s=he(e,{...t,onValue(a){i=a,o()}}),o=()=>{const a=performance.now();r>0&&a-n>r&&(n=a,i!==void 0&&s.set(i))};return Ce(s)}function Ci(e,t){let r;const n=t.immediate??!0,i=t.repeat??!1,s=N(t.interval,1e3);if(!ru(t))throw new Error("Param 'options' does not contain trigger 'value' or 'fn' fields");const o=()=>{const[u,l]=nu(t);if(l)a.dispose("Trigger completed");else{if(a.isDisposed())return;a.set(u),i&&(r=setTimeout(o,s))}},a=he(e,{disposeIfSourceDone:!0,onValue(u){r&&clearTimeout(r),r=setTimeout(o,s),a.set(u)},onDispose(){r&&clearTimeout(r)}});return n&&!r&&(r=setTimeout(o,s)),a}function mu(e,t){let r=t.initial;const n=he(e,{...t,onValue(s){r=s,n.set(s)}});return{...Ce(n),last(){return r}}}function pu(e,t){return Br("textContent",e,t)}function gu(e,t){return Br("innerHTML",e,t)}function Br(e,t,r){let n=[];const i=s=>{const o=typeof s,a=o==="string"||o==="number"||o==="boolean"?s:JSON.stringify(s);n.length===0&&(n=dt(t));for(const u of n)u[e]=a;return a};return r===void 0?i:i(r)}var xi=(e,t)=>{let r,n;if(typeof t=="string"&&(n={query:t}),typeof t=="object"&&("nodeName"in t?n={el:t}:n=t),n===void 0)throw new TypeError("Missing element as second parameter or option");if("el"in n)r=n.el;else if("query"in n)r=document.querySelector(n.query);else throw new TypeError("Options does not include 'el' or 'query' fields");if(r==null)throw new Error("Element could not be resolved.");const i=Y(e),s=Br(n.asHtml?"innerHTML":"textContent",r);return i.onValue(a=>{s(a)})};function O0(...e){return t=>{for(const r of e)t=r(t);return t}}function U0(e,...t){let r=Y(e);for(const n of t)r=n(r);return r}function H0(e,...t){let r=Y(e),n=r;for(const s of t)n=s(n);const i=n;return ei(r)?{...i,set(s){r.set(s)}}:i}var yu={};x(yu,{adjacentVertices:()=>ki,areAdjacent:()=>rv,bfs:()=>nv,clone:()=>sv,connect:()=>Au,connectTo:()=>vn,createVertex:()=>wu,dfs:()=>Cu,disconnect:()=>bu,distance:()=>Du,distanceDefault:()=>ev,dumpGraph:()=>Y0,edges:()=>Eu,getCycles:()=>Su,getOrCreate:()=>hn,getOrFail:()=>Q0,graph:()=>xu,graphFromVertices:()=>Fu,hasNoOuts:()=>K0,hasOnlyOuts:()=>Z0,hasOut:()=>Qe,isAcyclic:()=>ov,pathDijkstra:()=>iv,toAdjacencyMatrix:()=>G0,topologicalSort:()=>av,transitiveReduction:()=>ku,updateGraphVertex:()=>Tr,vertexHasOut:()=>J0,vertices:()=>Si});var Fi=class{rows=[];rowLabels=[];colLabels=[];labelColumns(...e){this.colLabels=e}labelColumn(e,t){this.colLabels[e]=t}getColumnLabelIndex(e){for(const[t,r]of this.colLabels.entries())if(r===e)return t}print(){console.table([...this.rowsWithLabelsObject()])}*rowsWithLabelsArray(){for(let e=0;e<this.rows.length;e++)yield this.getRowWithLabelsArray(e)}asArray(){const e=[];for(const t of this.rows)t===void 0?e.push([]):e.push([...t]);return e}get rowCount(){return this.rows.length}get columnCount(){const e=this.rows.map(t=>t.length);return Math.max(...e)}*rowsWithLabelsObject(){for(let e=0;e<this.rows.length;e++)yield this.getRowWithLabelsObject(e)}labelRows(...e){this.rowLabels=e}appendRow(...e){this.rows.push(e)}getRowWithLabelsArray(e){const t=this.rows.at(e);if(t!==void 0)return t.map((r,n)=>[this.colLabels.at(n),r])}getRowWithLabelsObject(e){const t=this.rows.at(e);if(t===void 0)return;const r={};for(let n=0;n<this.colLabels.length;n++){const i=this.colLabels.at(n)??n.toString();r[i]=t[n]}return r}getOrCreateRow(e){let t=this.rows.at(e);return t===void 0&&(t=[],this.rows[e]=t),t}row(e){return this.rows.at(e)}set(e,t,r){const n=this.getOrCreateRow(e);n[t]=r}get(e,t){const r=this.getOrCreateRow(e),n=typeof t=="number"?t:this.getColumnLabelIndex(t);if(n===void 0)throw new Error(`Column not found: ${t}`);return r[n]}setRow(e,t,r){const n=this.getOrCreateRow(e);for(let i=0;i<t;i++)n[i]=r}},wu=e=>({id:e,out:[]});function G0(e){const t=[...e.vertices.values()],r=new Fi;r.labelColumns(...t.map(n=>n.id)),r.labelRows(...t.map(n=>n.id));for(let n=0;n<t.length;n++){r.setRow(n,t.length,!1);const i=t[n];for(const[s,o]of t.entries())i.out.some(a=>a.id===o.id)&&r.set(n,s,!0)}return r}var Y0=e=>X0(e).join(`
`),X0=e=>{const t=[],r="vertices"in e?e.vertices.values():e;for(const n of r){const i=tv(n);t.push(...i.map(s=>` ${s}`))}return t},Du=(e,t)=>t.weight!==void 0?t.weight:1;function*Eu(e){const t=[...e.vertices.values()];for(const r of t)for(const n of r.out)yield n}function*Si(e){const t=[...e.vertices.values()];for(const r of t)yield r}function*ki(e,t){if(t===void 0)return;const r=typeof t=="string"?e.vertices.get(t):t;if(r===void 0)throw new Error(`Vertex not found ${JSON.stringify(t)}`);for(const n of r.out){const i=e.vertices.get(n.id);if(i===void 0)throw new Error(`Could not find vertex: ${n.id}`);yield i}}var J0=(e,t)=>{if(e===void 0)return!1;const r=typeof t=="string"?t:t.id;return e.out.some(n=>n.id===r)},K0=(e,t)=>{const r=typeof t=="string"?e.vertices.get(t):t;return r===void 0?!1:r.out.length===0},Z0=(e,t,...r)=>{const n=Te(e,t),i=r.map(s=>Te(e,s));if(i.length!==n.out.length)return!1;for(const s of i)if(!Qe(e,n,s))return!1;return!0},Qe=(e,t,r)=>{const n=Te(e,t),i=typeof r=="string"?r:r.id;return n.out.some(s=>s.id===i)},hn=(e,t)=>{const r=e.vertices.get(t);if(r!==void 0)return{graph:e,vertex:r};const n=wu(t);return{graph:Tr(e,n),vertex:n}},Q0=(e,t)=>{const r=e.vertices.get(t);if(r===void 0)throw new Error(`Vertex '${t}' not found in graph`);return r},Tr=(e,t)=>({...e,vertices:e.vertices.set(t.id,t)}),ev=(e,t)=>t.weight!==void 0?t.weight:1;function bu(e,t,r){const n=Te(e,t),i=Te(e,r);return Qe(e,n,i)?Tr(e,{...n,out:n.out.filter(s=>s.id!==i.id)}):e}function vn(e,t,r,n){const i=hn(e,t);e=i.graph;const s=hn(e,r);e=s.graph;const o={id:r,weight:n};return Qe(e,i.vertex,s.vertex)||(e=Tr(e,{...i.vertex,out:[...i.vertex.out,o]})),{graph:e,edge:o}}function Au(e,t){const{to:r,weight:n,from:i}=t,s=t.bidi??!1,o=Array.isArray(r)?r:[r];for(const a of o)e=vn(e,i,a,n).graph;if(!s)return e;for(const a of o)e=vn(e,a,i,n).graph;return e}var tv=e=>{const t=[e.id],r=n=>n.weight===void 0?n.id:`${n.id} (${n.weight})`;for(const n of e.out)t.push(` -> ${r(n)}`);return e.out.length===0&&(t[0]+=" (terminal)"),t};function rv(e,t,r){if(Qe(e,t,r.id)||Qe(e,r,t.id))return!0}function Te(e,t){const r=typeof t=="string"?e.vertices.get(t):t;if(r===void 0)throw new Error(`Id not found ${t}`);return r}function*nv(e,t,r){const n=Te(e,t),i=r===void 0?void 0:Te(e,r),s=new Ke,o=new Set;for(s.enqueue(n);!s.isEmpty;){const a=s.dequeue();if(yield a,i!==void 0&&i===a)return;for(const u of ki(e,a))o.has(u.id)||(o.add(u.id),s.enqueue(Te(e,u.id)))}}function*Cu(e,t){const r=Te(e,t),n=new Hs,i=new Set;for(n.push(r);!n.isEmpty;){const s=n.pop();if(s!==void 0&&!i.has(s.id)){i.add(s.id),yield s;for(const o of s.out){const a=e.vertices.get(o.id);a&&n.push(a)}}}}var iv=(e,t)=>{const r=typeof t=="string"?e.vertices.get(t):t;if(r===void 0)throw new Error("source vertex not found");const n=new Map,i=new Map;n.set(r.id,0);const s=new Dd,o=[...e.vertices.values()];for(const u of o)u.id!==r.id&&(n.set(u.id,Number.MAX_SAFE_INTEGER),i.set(u.id,null)),s.enqueueWithPriority(u.id,Number.MAX_SAFE_INTEGER);for(;!s.isEmpty;){const u=s.dequeueMin();if(u===void 0)throw new Error("Bug. Queue unexpectedly empty");const l=e.vertices.get(u);for(const c of l.out){const d=n.get(u)+Du(e,c);d<n.get(c.id)&&(n.set(c.id,d),i.set(c.id,l),s.changePriority(c.id,d,!0))}}return{distances:n,previous:i,pathTo:u=>{const l=[];for(;u!==r.id;){const c=i.get(u);if(c==null)throw new Error(`Id not present: ${u}`);l.push({id:u,weight:n.get(u)}),u=c.id}return l}}},sv=e=>({vertices:cr([...e.vertices.entries()])}),xu=(...e)=>{let t={vertices:cr()};for(const r of e)t=Au(t,r);return t};function ov(e){return Su(e).length===0}function av(e){const t=new Ed(0);for(const s of Eu(e))t.add(s.id,1);const r=new Ke;let n=0;for(const s of Si(e))t.get(s.id)===0&&r.enqueue(s),n++;const i=[];for(;!r.isEmpty;){const s=r.dequeue();i.push(s);for(const o of s.out)t.subtract(o.id,1)===0&&r.enqueue(e.vertices.get(o.id))}if(i.length!==n)throw new Error("Graph contains cycles");return Fu(i)}function Fu(e){const t=_s(e,n=>[n.id,n]);return{vertices:cr([...t])}}function Su(e){let t=0;const r=new Hs,n=new Map,i=[];for(const o of e.vertices.values())n.set(o.id,{...o,lowlink:Number.NaN,index:Number.NaN,onStack:!1});const s=o=>{o.index=t,o.lowlink=t,t++,r.push(o),o.onStack=!0;for(const a of o.out){const u=n.get(a.id);Number.isNaN(u.index)?(s(u),o.lowlink=Math.min(o.lowlink,u.lowlink)):u.onStack&&(o.lowlink=Math.min(o.lowlink,u.lowlink))}if(o.lowlink===o.index){const a=[];let u;for(;o!==u;)u=r.pop(),u.onStack=!1,a.push({id:u.id,out:u.out});a.length>1&&i.push(a)}};for(const o of n.values())Number.isNaN(o.index)&&s(o);return i}function ku(e){for(const t of Si(e))for(const r of ki(e,t))for(const n of Cu(e,r))if(r.id!==n.id&&Qe(e,t,n)){const i=bu(e,t,n);return ku(i)}return e}function uv(e){let t=xu();const r=ce();return{dispose:r.dispose,isDisposed:r.isDisposed,graph:t,on:r.on,onValue:r.onValue}}var Bu=Symbol("Rx");async function Bi(e,t={}){const r=t.limit??Number.MAX_SAFE_INTEGER,n=N(t.maximumWait,10*1e3),i=t.underThreshold??"partial",s=[],o=Y(e);return new Promise((u,l)=>{const c=()=>{if(clearTimeout(d),h(),s.length<r&&i==="throw"){l(new Error(`Threshold not reached. Wanted: ${r} got: ${s.length}. Maximum wait: ${n}`));return}if(s.length<r&&i==="fill")for(let f=0;f<r;f++)s[f]===void 0&&(s[f]=t.fillValue);u(s)},d=setTimeout(()=>{c()},n),h=o.on(f=>{Ae(f)?c():se(f)&&(s.push(f.value),s.length===r&&c())})})}async function Tu(e,t={}){const r=t.limit??Number.MAX_SAFE_INTEGER,n=t.maximumWait??5*1e3,i=await Bi(e,{limit:r,maximumWait:n,underThreshold:"partial"});if(t.limit&&i.length<t.limit)throw new Error(`Threshold not reached. Wanted: ${t.limit}, got ${i.length}`);return i}async function*lv(e){const t=Y(e);let r=a=>{},n=a=>{};const i=()=>new Promise((a,u)=>{r=a,n=u});let s=i(),o=!0;for(t.on(a=>{se(a)?(r(a.value),s=i()):Ae(a)&&(o=!1,n("Source has completed"))});o;)yield await s}var nr=(e,t)=>{const n=Object.entries(e).map(([i,s],o)=>[i,t({value:s,field:i,index:o})]);return Object.fromEntries(n)};function U(e){return{source:Y(e),enacts:{setHtmlText:t=>xi(e,t)},annotate:t=>{const r=ii(e,t);return U(r)},batch:t=>U(si(e,t)),debounce:(t={})=>U(ci(e,t)),field:(t,r={})=>{const n=Fr(e,t,r);return U(n)},filter:(t,r)=>U(di(e,t,r)),combineLatestToArray:(t,r={})=>{const n=[e,...t];return U(oi(n,r))},combineLatestToObject:(t,r)=>{const n=r.name??"source",i={...t};return i[n]=e,U(xr(i,r))},min:(t={})=>U(hi(e,t)),max:(t={})=>U(fi(e,t)),average:(t={})=>U(vi(e,t)),sum:(t={})=>U(mi(e,t)),tally:(t={})=>U(pi(e,t)),split:(t={})=>gi(e,t).map(n=>U(n)),splitLabelled:(...t)=>{const r=yi(e,t);return nr(r,i=>U(i.value))},switcher:(t,r={})=>{const n=wi(e,t,r);return nr(n,s=>U(s.value))},syncToArray:(t,r={})=>{const n=[e,...t].map(s=>Y(s)),i=Sr(n,r);return U(i)},syncToObject:(t,r={})=>{const n=r.name??"source",i={...t};return i[n]=e,U(kr(i,r))},tapProcess:(...t)=>(Di(e,...t),U(e)),tapStream:t=>(Ei(e,t),U(e)),tapOps:(t,...r)=>(bi(t,...r),U(t)),throttle:(t={})=>U(Ai(e,t)),transform:(t,r={})=>U(Me(e,t,r)),timeoutTrigger:t=>U(Ci(e,t)),toArray:t=>Bi(e,t),toArrayOrThrow:t=>Tu(e,t),onValue:t=>{Y(e).on(n=>{se(n)&&t(n.value)})}}}function cv(e={}){const t=e.lazy??"initial",r=N(e.interval,1e3),n=e.amount??1,i=e.offset??0;let s=0,o=i;const a=c=>{l.dispose(c)},u=je(()=>{if(e.signal?.aborted)return a(`Aborted (${e.signal.reason})`),!1;if(l.set(o),o+=1,s++,s>=n)return a("Limit reached"),!1},r),l=ht({onStart(){u.start()},onStop(){u.cancel()},onDispose(){u.cancel()},lazy:t});return l}var _u={};x(_u,{bind:()=>Ru,bindDiffUpdate:()=>wv,bindElement:()=>_r,bindHtml:()=>pv,bindText:()=>vv,bindUpdate:()=>yv,bindValueText:()=>mv,elements:()=>Dv,fromDomQuery:()=>hv,win:()=>Ev});function*dv(e,t="."){for(;e.length>0;){yield e;const r=fr(e,t);if(r===e)break;e=r}}function*fv(e,t="."){for(;e.length>0;){yield e;const r=Ys(e,t,{ifNoMatch:"original",fromEnd:!0});if(r===e)break;e=r}}function hv(e){const t=[...document.querySelectorAll(e)];return Mt(t)}var vv=(e,t,r={})=>_r(e,t,{...r,elField:"textContent"}),mv=(e,t,r={})=>_r(e,t,{...r,elField:"value",attribName:"value"}),pv=(e,t,r={})=>_r(e,t,{...r,elField:"innerHTML"}),_r=(e,t,...r)=>{if(t===null)throw new Error("Param 'elOrQuery' is null");if(t===void 0)throw new Error("Param 'elOrQuery' is undefined");const n=V(t);let i=[];r.length===0?i.push({elField:"textContent"}):i=[...r];const s=i.map(o=>"element"in o?o:{...o,element:n});return Ru(e,...s)},gv=(e,t)=>{const r=Pu(e);return n=>{r(n,t)}},Pu=e=>{if(e.elField!==void 0||e.cssVariable===void 0&&e.attribName===void 0&&e.cssProperty===void 0&&e.textContent===void 0&&e.htmlContent===void 0){const t=e.elField??"textContent";return(r,n)=>{n[t]=r}}if(e.attribName!==void 0){const t=e.attribName;return(r,n)=>{n.setAttribute(t,r)}}if(e.textContent)return(t,r)=>{r.textContent=t};if(e.htmlContent)return(t,r)=>{r.innerHTML=t};if(e.cssVariable!==void 0){let t=e.cssVariable;return t.startsWith("--")||(t="--"+t),(r,n)=>{n.style.setProperty(t,r)}}return e.cssProperty!==void 0?(t,r)=>{r.style[e.cssProperty]=t}:(t,r)=>{}},Nu=e=>{if(!(!e.transform&&!e.transformValue)){if(e.transformValue){if(e.sourceField===void 0)throw new Error("Expects 'sourceField' to be set when 'transformValue' is set");return t=>{const r=t[e.sourceField];return e.transformValue(r)}}else if(e.transform){if(e.sourceField!==void 0)throw new Error("If 'transform' is set, 'sourceField' is ignored");return t=>e.transform(t)}}},Ru=(e,...t)=>{const r=t.map(o=>{if(o.element&&o.element!==void 0)return o;if(o.query)return{...o,element:V(o.query)};throw new Error(`Unable to resolve element. Missing 'element' or 'query' values on bind. ${JSON.stringify(o)}`)}),n=r.map(o=>({update:gv(o,o.element),transformer:Nu(o),sourceField:o.sourceField})),i=o=>{for(const a of n)if(a.transformer)a.update(a.transformer(o));else{const u=a.sourceField?o[a.sourceField]:o;typeof u=="object"?(a.sourceField,a.update(JSON.stringify(u))):a.update(u)}},s=e.on(o=>{se(o)?i(o.value):Rt(o)&&console.warn(o)});return ft(e)&&i(e.last()),{remove:o=>{if(s(),o)for(const a of r)a.element.remove()}}},yv=(e,t,r)=>{const n=V(t),i=o=>{r(o,n)},s=e.on(o=>{se(o)?(console.log(o),i(o.value)):console.warn(o)});return ft(e)&&i(e.last()),{remove:o=>{s(),o&&n.remove()}}},wv=(e,t,r,n={})=>{if(t===null)throw new Error("Param 'elOrQuery' is null");if(t===void 0)throw new Error("Param 'elOrQuery' is undefined");const i=V(t),s=u=>{r(u,i)},o=e.onDiff(u=>{s(u)}),a=()=>{ft(e)&&n.initial&&n.initial(e.last(),i)};return a(),{refresh:()=>{a()},remove:u=>{o(),u&&i.remove()}}},Dv=(e,t)=>{const r=t.container?V(t.container):document.body,n=t.defaultTag??"div",i=new Map,s=new Map;for(const[d,h]of Object.entries(t.binds??{})){const f=h.tagName??n;s.set(d,{...h,update:Pu(h),transform:Nu(h),tagName:f,path:d})}const o=d=>{const h=tf(s,dv(d));if(h!==void 0)return h;if(!d.includes("."))return s.get("_root")};function*a(d){for(const h of fv(d))s.has(h)&&(yield s.get(h));s.has("_root")&&d.includes(".")&&(yield s.get("_root"))}const u=(d,h)=>{const f=Xr(d);console.log(`Rx.Dom.elements.create: ${d} rooted: ${f} value: ${JSON.stringify(h)}`);const m=o(Xr(d));let p=n;m?.tagName&&(p=m.tagName);const g=document.createElement(p);g.setAttribute("data-path",d),l(d,g,h);let w;for(const b of a(f))if(b?.nestChildren){const j=Ys(d,"."),G=b.path.replace("_root",j);if(w=i.get(G),w!==void 0)break}(w??r).append(g),i.set(d,g),console.log(`Added el: ${d}`)},l=(d,h,f)=>{console.log(`Rx.dom.update path: ${d} value:`,f);const m=o(Xr(d));m===void 0?(typeof f=="object"&&(f=JSON.stringify(f)),h.textContent=f):(m.transform&&(f=m.transform(f)),m.update(f,h))},c=d=>{const h=new Ke({},d);let f=h.dequeue();const m=new Set;for(;f!==void 0;){const p=f.path;if(!("previous"in f)||f.previous===void 0){console.log(`Rx.Dom.elements.changes no previous. path: ${p}`),u(p,f.value);const g=[...fn(f.value,Number.MAX_SAFE_INTEGER,p)];console.log(g);for(const w of g)m.has(w.path)||(h.enqueue(w),m.add(w.path))}else if(f.value===void 0){const g=i.get(p);g===void 0?console.warn(`No element to delete? ${p} `):(console.log(`Rx.Dom.elements.changes delete ${p}`),g.remove())}else{const g=i.get(p);g===void 0?(console.warn(`Rx.Dom.elements.changes No element to update ? ${p} `),u(p,f.value)):l(p,g,f.value)}f=h.dequeue()}};if(e.onDiff(d=>{c(d)}),ft(e)){const d=e.last();c([...fn(d,1)])}},Xr=e=>{const t=fr(e,".");return t===e?"_root":"_root."+t};function Ev(){const e=()=>({width:window.innerWidth,height:window.innerHeight}),t=Ve.event(window,"resize",{lazy:"very",transform:()=>e()}),r=Ve.event(window,"pointermove",{lazy:"very",transform:i=>{if(i===void 0)return{x:0,y:0};const s=i;return{x:s.x,y:s.y}}});return{dispose:(i="Reactive.win.dispose")=>{t.dispose(i),r.dispose(i)},size:t,pointer:r}}var Ve={};x(Ve,{array:()=>Mu,arrayObject:()=>Av,boolean:()=>Cv,domHslInputValue:()=>hp,domInputValue:()=>zi,domNumberInputValue:()=>fp,event:()=>$u,eventField:()=>xv,eventTrigger:()=>Iu,func:()=>iu,iterator:()=>ln,number:()=>mp,object:()=>Mt,objectProxy:()=>tc,objectProxySymbol:()=>pp,observable:()=>gp,observableWritable:()=>rc,of:()=>bv,pinged:()=>vp,string:()=>yp});var bv=(e,t={})=>{if(Array.isArray(e))return Mu(e,t)},Mu=(e,t={})=>{const r=t.lazy??"initial",n=t.signal,i=t.whenStopped??"continue",s=t.debugLifecycle??!1,o=[...e];if(r!=="very"&&i==="reset")throw new Error(`whenStopped:'reset' has no effect with 'lazy:${r}'. Use lazy:'very' instead.`);const a=N(t.interval,5);let u=0,l=o[0];const c=ht({...t,lazy:r,onStart(){s&&console.log("Rx.readFromArray:onStart"),d.start()},onStop(){s&&console.log(`Rx.readFromArray:onStop. whenStopped: ${i} index: ${u}`),d.cancel(),i==="reset"&&(u=0)}}),d=je(()=>{if(n?.aborted)return c.dispose(`Signalled (${n.reason})`),!1;if(l=o[u],u++,c.set(l),u===o.length)return c.dispose("Source array complete"),!1},a);return r||d.start(),{dispose:c.dispose,isDisposed:c.isDisposed,isDone(){return u===o.length},last(){return l},on:c.on,onValue:c.onValue}};function Av(e=[],t={}){const r=t.eq??bd,n=ce(),i=ce();let s=e,o=!1;const a=p=>{xt(s,p,r),s=p,n.set([...p])},u=(p,g)=>{s[p]=g,n.set([...s])},l=p=>{s=[...s,p],n.set([...s]);const g=["add",s.length-1,p];i.set([g])},c=p=>{const g=Jd(s,p);if(g.length===s.length)return;const w=xt(s,g,r);s=g,n.set([...s]),i.set(w.summary)},d=p=>{const g=s.filter(j=>!p(j)),w=s.length-g.length,b=xt(s,g,r);return s=g,n.set([...s]),i.set(b.summary),w},h=(p,g)=>{const w=Kd(s,p,g),b=xt(s,w,r);s=w,n.set([...s]),i.set(b.summary)};return{dispose:p=>{o||(n.dispose(p),o=!0)},isDisposed(){return o},last:()=>s,on:n.on,onArray:i.on,onValue:n.onValue,setAt:u,push:l,deleteAt:c,deleteWhere:d,insertAt:h,set:a}}function Cv(e){let t=e;const r=ce(),n=i=>{t=i,r.set(i)};return{dispose:r.dispose,isDisposed:r.isDisposed,last:()=>t,on:r.on,onValue:r.onValue,set:n}}function xv(e,t,r,n,i={}){const s={};return s[r]=n,Fr($u(e,t,s,i),r,i)}function $u(e,t,r,n={}){let i;if(typeof e=="string"){if(i=document.querySelector(e),i===null)throw new Error(`Target query did not resolve to an element. Query: '${e}'`)}else i=e;if(i===null)throw new Error("Param 'targetOrQuery' is null");const s=n.debugLifecycle??!1,o=n.debugFiring??!1,a=n.lazy??!1;r===void 0&&(r={});const u=Mt(r,{deepEntries:!0});let l=!1,c=!1;const d=m=>{o&&console.log(`Reactive.event '${t}' firing '${JSON.stringify(m)}`),u.set(m)},h=()=>{!l||(l=!1,i.removeEventListener(t,d),s&&console.log(`Rx.From.event remove '${t}'`))},f=()=>{l||(l=!0,i.addEventListener(t,d),s&&console.log(`Rx.From.event add '${t}'`))};return a||f(),{last:()=>(a&&f(),u.last()),dispose:m=>{c||(c=!0,h(),u.dispose(m))},isDisposed(){return c},on:m=>(a&&f(),u.on(m)),onValue:m=>(a&&f(),u.onValue(m))}}function Iu(e,t,r={}){let n;if(typeof e=="string"){if(n=document.querySelector(e),n===null)throw new Error(`Target query did not resolve to an element. Query: '${e}'`)}else n=e;if(n===null)throw new Error("Param 'targetOrQuery' is null");const i=r.debugLifecycle??!1,s=r.debugFiring??!1,o=r.fireInitial??!1;let a=0;const u=Ze.interval(),l=ht({lazy:r.lazy??"very",onStart(){n.addEventListener(t,c),i&&console.log(`Rx.From.eventTrigger add '${t}'`),o&&a===0&&c()},onStop(){n.removeEventListener(t,c),i&&console.log(`Rx.From.eventTrigger remove '${t}'`)}}),c=d=>{s&&console.log(`Rx.From.eventTrigger '${t}' triggered'`),l.set({sinceLast:u(),total:++a})};return l}var Fv={};x(Fv,{Bipolar:()=>Lu,Correlate:()=>ju,FrequencyMutable:()=>Ou,Graphs:()=>nl,IntervalTracker:()=>Uu,Normalise:()=>Gu,NumberTracker:()=>Un,Pathed:()=>au,PointTracker:()=>Ti,Pool:()=>Ju,PrimitiveTracker:()=>$a,Table:()=>Fi,TrackedPointMap:()=>Yu,TrackedValueMap:()=>Ma,TrackerBase:()=>On,changedDataFields:()=>V0,clamp:()=>Ee,clampIndex:()=>Ad,compareArrays:()=>xt,compareData:()=>Ar,compareDataExecute:()=>jv,compareKeys:()=>Qa,fieldResolve:()=>el,fieldResolver:()=>Yv,flip:()=>Ht,frequencyMutable:()=>Nv,interpolate:()=>ct,interpolateAngle:()=>po,interpolatorInterval:()=>Pf,interpolatorStepped:()=>_f,intervalTracker:()=>Rv,isEmptyEntries:()=>z0,isEqualContextString:()=>ai,keysToNumbers:()=>Mv,mapObjectShallow:()=>nr,movingAverage:()=>Iv,movingAverageLight:()=>Hu,movingAverageTimed:()=>$v,noiseFilter:()=>Vv,numberTracker:()=>St,piPi:()=>sm,pointTracker:()=>Ov,pointsTracker:()=>Xu,processChain:()=>vu,proportion:()=>Hv,pull:()=>tl,reactiveUpdate:()=>Xv,scale:()=>ut,scaleClamped:()=>Cd,scalePercent:()=>xd,scalePercentages:()=>Fd,scaler:()=>bn,scalerPercent:()=>Sd,softmax:()=>Jv,trackUnique:()=>Kv,trackUniqueInstances:()=>rl,wrap:()=>Ts,wrapInteger:()=>kd,wrapRange:()=>Bd});var Lu={};x(Lu,{clamp:()=>Xe,fromScalar:()=>Sv,immutable:()=>nt,random:()=>Tv,randomSource:()=>qu,scale:()=>kv,scaleClamped:()=>Bv,toScalar:()=>Vu,towardZero:()=>zu});var nt=(e=0)=>{const t=typeof e=="number"?e:e.value;if(t>1)throw new Error("Cannot be larger than 1");if(t<-1)throw new Error("Cannot be smaller than -1");if(Number.isNaN(t))throw new Error("startingValue is NaN");const r=t;return{[Symbol.toPrimitive](n){return n==="number"?r:n==="string"?r.toString():!0},value:r,towardZero:n=>nt(zu(r,n)),add:n=>nt(Xe(r+n)),multiply:n=>nt(Xe(r*n)),inverse:()=>nt(-r),interpolate:(n,i)=>nt(Xe(ct(n,r,i))),asScalar:()=>Vu(r)}},Vu=e=>{if(typeof e!="number")throw new Error(`Expected v to be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw new Error("Parameter is NaN");return(e+1)/2},Sv=e=>(M(e,"percentage","v"),e*2-1),kv=(e,t,r)=>Xe(bn(t,r,-1,1)(e)),Bv=(e,t,r)=>bn(t,r,-1,1)(e),qu=e=>{const t=mr(e);return()=>t()*2-1},Tv=e=>qu(e)(),Xe=e=>{if(typeof e!="number")throw new Error(`Parameter must be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw new Error("v parameter is NaN");return e>1?1:e<-1?-1:e},zu=(e,t)=>{if(typeof e!="number")throw new Error(`Parameter 'v' must be a number. Got: ${typeof e}`);if(typeof t!="number")throw new Error(`Parameter 'amt' must be a number. Got: ${typeof t}`);if(t<0)throw new Error("Parameter 'amt' must be positive");return e<0?(e+=t,e>0&&(e=0)):e>0&&(e-=t,e<0&&(e=0)),e},ju={};x(ju,{align:()=>Wu,alignById:()=>Pv});var _v=(e,t)=>e.score>t.score?-1:e.score<t.score?1:0,Wu=(e,t,r,n={})=>{const i=n.matchThreshold??0,s=n.debug??!1,o=new Map,a=[],u=new Map;t?.forEach((l,c)=>{if(l===void 0)throw new Error(`'lastData' contains undefined (index: ${c})`);u.set(l.id,l)});for(let l=0;l<r.length;l++){const c=r[l];if(!t||t.length===0){s&&console.debug(`Correlate.align() new id: ${c.id}`),a.push(c);continue}const d=Array.from(u.values()).map(f=>({id:f.id,score:f===null?-1:e(f,c),last:f}));if(d.length===0){s&&console.debug(`Correlate.align() no valid last values id: ${c.id}`),a.push(c);continue}d.sort(_v);const h=d[0];if(h.score<i){s&&console.debug(`Correlate.align() new item does not reach threshold. Top score: ${h.score} id: ${c.id}`),a.push(c);continue}s&&h.id!==c.id&&console.log(`Correlate.align() Remapped ${c.id} -> ${h.id} (score: ${h.score})`),o.set(h.id,{...c,id:h.id}),u.delete(h.id)}return a.forEach(l=>o.set(l.id,l)),Array.from(o.values())},Pv=(e,t={})=>{let r=[];return i=>(r=Wu(e,r,i,t),[...r])},Ht=e=>(typeof e=="function"&&(e=e()),M(e,"percentage","v"),1-e),Ou=class extends Pe{#e;#t;constructor(e){super();this.#e=new Map,e===void 0&&(e=t=>{if(t===void 0)throw new Error("Cannot create key for undefined");return typeof t=="string"?t:JSON.stringify(t)}),this.#t=e}clear(){this.#e.clear(),this.fireEvent("change",{context:this})}keys(){return this.#e.keys()}values(){return this.#e.values()}toArray(){return[...this.#e.entries()]}debugString(){let e="";for(const[t,r]of this.#e.entries())e+=`${t}: ${r}, `;return e.endsWith(", ")?e.slice(0,Math.max(0,e.length-2)):e}frequencyOf(e){if(typeof e=="string")return this.#e.get(e);const t=this.#t(e);return this.#e.get(t)}relativeFrequencyOf(e){let t;if(typeof e=="string")t=this.#e.get(e);else{const n=this.#t(e);t=this.#e.get(n)}if(t===void 0)return;const r=this.minMaxAvg();return t/r.total}entries(){return[...this.#e.entries()]}minMaxAvg(){return Za(this.entries())}entriesSorted(e="value"){return Ka(e)(this.entries())}add(...e){if(e===void 0)throw new Error("value parameter is undefined");const t=e.map(r=>this.#t(r));for(const r of t){const n=this.#e.get(r)??0;this.#e.set(r,n+1)}this.fireEvent("change",{context:this})}},Nv=e=>new Ou(e),Uu=class extends Un{lastMark=0;mark(){this.lastMark>0&&this.seen(performance.now()-this.lastMark),this.lastMark=performance.now()}},Rv=e=>new Uu(e),Mv=(e,t="throw")=>{const r={};for(const n of Object.entries(e)){const i=Number.parseInt(n[0]);if(Number.isNaN(i))switch(t){case"throw":throw new TypeError(`Cannot convert key '${n[0]}' to an integer`);case"ignore":continue;case"keep":{r[n[0]]=n[1];continue}default:throw new Error("Param 'onInvalidKey' should be: 'throw', 'ignore' or 'keep'.")}r[i]=n[1]}return r},Hu=(e=3)=>{M(e,"aboveZero","scaling");let t=0,r=0;return n=>(Jt(n,"","v")[0]&&n!==void 0&&(r++,t=t+(n-t)/Math.min(r,e)),t)},$v=e=>{const t=Hu(),r=Mo({...e,whatToCall:n=>{t(n)},fallback(){return e.default??0}});return n=>(r(n),t())},Iv=(e=100,t)=>{const r=new Ke({capacity:e,discardPolicy:"older"});return n=>(Jt(n)[0]&&n!==void 0&&r.enqueue(n),t===void 0?Vs(r.data):qs(r.data,t))},Lv=Math.PI*2,Cs=(e,t)=>{const r=Lv*t*e;return r/(r+1)},xs=(e,t,r)=>e*t+(1-e)*r,Vv=(e=1,t=0,r=1)=>{let n=0,i=0,s=0;return(a,u)=>{u===void 0&&(u=performance.now());const l=u-s,c=Cs(l,r),d=(a-n)/l,h=xs(c,d,i),f=e+t*Math.abs(h),m=Cs(l,f),p=xs(m,a,n);return n=p,i=h,s=u,p}},Gu={};x(Gu,{array:()=>zv,stream:()=>qv});var qv=(e,t)=>{let r=e??Number.MAX_SAFE_INTEGER,n=t??Number.MIN_SAFE_INTEGER;return M(e),M(t),i=>(M(i),r=Math.min(r,i),n=Math.max(n,i),ut(i,r,n))},zv=(e,t,r)=>{if(!Array.isArray(e))throw new TypeError(`Param 'values' should be an array. Got: ${typeof e}`);const n=_t(e),i=t??n.min,s=r??n.max;return e.map(o=>Ee(ut(o,i,s)))},jv=(e,t)=>{let r=e;const n=new Map;for(const[i,s]of Object.entries(t.onFieldChange))n.set(i.replaceAll("_","."),s);return i=>{const s=ot(r,i,{includeParents:!0});for(const o of s){const a=n.get(o.path);a&&(o.value=a(o.value,o.previous,o.path))}return console.log("post",JSON.stringify(s)),r}},Wv=class extends On{values;constructor(e={}){super(e);this.values=[]}onTrimmed(){}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.values.length)}onReset(){this.values=[]}filterData(e){const t=e.map(n=>"at"in n?n:{...n,at:Date.now()}),r=t.at(-1);if(this.storeIntermediate)this.values.push(...t);else switch(this.values.length){case 0:{this.values.push(r);break}case 1:{this.values.push(r);break}case 2:{this.values[1]=r;break}}return t}get last(){return this.values.length===1?this.values[0]:this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){return Date.now()-this.values[0].at}},Ti=class extends Wv{initialRelation;lastResult;constructor(e={}){super(e)}onTrimmed(){this.initialRelation=void 0}get x(){return this.last.x}get y(){return this.last.y}onReset(){super.onReset(),this.lastResult=void 0,this.initialRelation=void 0}seenEvent(e){if("getCoalescedEvents"in e){const r=e.getCoalescedEvents().map(n=>({x:n.clientX,y:n.clientY}));return this.seen(...r)}else return this.seen({x:e.clientX,y:e.clientY})}computeResults(e){const t=this.last,r=this.values.at(-2);if(this.initialRelation===void 0&&this.initial)this.initialRelation=Ur(this.initial);else if(this.initialRelation===void 0)throw new Error("Bug: No initialRelation, and this.inital is undefined?");const n=r===void 0?Ur(t):Ur(r),i=this.initialRelation(t),s=r===void 0?0:os(r,t)/(t.at-r.at),o={...n(t),speed:s},a={fromInitial:i,fromLast:o,values:[...this.values]};return this.lastResult=a,a}get line(){return this.values.length===1?[]:Td(...this.values)}get vectorPolar(){return as.fromLinePolar(this.lineStartEnd)}get vectorCartesian(){return as.fromLineCartesian(this.lineStartEnd)}get lineStartEnd(){const e=this.initial;return this.values.length<2||!e?_d:{a:e,b:this.last}}distanceFromStart(){const e=this.initial;return this.values.length>=2&&e!==void 0?Pd(e,this.last):0}difference(){const e=this.initial;return this.values.length>=2&&e!==void 0?Yt(this.last,e):Nd}angleFromStart(){const e=this.initial;if(e!==void 0&&this.values.length>2)return Rd(e,this.last)}get length(){if(this.values.length===1)return 0;const e=this.line;return os(e)}},Yu=class extends Ma{constructor(e={}){super((t,r)=>{if(r===void 0)throw new Error("Requires start point");const n=new Ti({...e,id:t});return n.seen(r),n})}seenEvent(e){if("getCoalescedEvents"in e){const r=e.getCoalescedEvents().map(n=>super.seen(n.pointerId.toString(),n));return Promise.all(r)}else return Promise.all([super.seen(e.pointerId.toString(),e)])}},Xu=(e={})=>new Yu(e),Ov=(e={})=>new Ti(e),Ju={};x(Ju,{Pool:()=>Qu,PoolUser:()=>Ku,Resource:()=>Zu,create:()=>Uv});var Ku=class extends Pe{constructor(e,t){super();this.key=e,this.resource=t,this._lastUpdate=performance.now(),this._pool=t.pool,this._userExpireAfterMs=this._pool.userExpireAfterMs,this._state="idle",this._pool.log.log(`PoolUser ctor key: ${this.key}`)}_lastUpdate;_pool;_state;_userExpireAfterMs;toString(){return this.isDisposed?"PoolUser. State: disposed":`PoolUser. State: ${this._state} Elapsed: ${performance.now()-this._lastUpdate} Data: ${JSON.stringify(this.resource.data)}`}keepAlive(){if(this._state==="disposed")throw new Error("PoolItem disposed");this._lastUpdate=performance.now()}_dispose(e,t){if(this._state==="disposed")return;const r=this.resource;this._state="disposed",r._release(this),this._pool.log.log(`PoolUser dispose key: ${this.key} reason: ${e}`),this.fireEvent("disposed",{data:t,reason:e}),super.clearEventListeners()}release(e){if(this.isDisposed)throw new Error("User disposed");const r=this.resource.data;this._pool.log.log(`PoolUser release key: ${this.key} reason: ${e}`),this.fireEvent("released",{data:r,reason:e}),this._dispose(`release-${e}`,r)}get data(){if(this.isDisposed)throw new Error("User disposed");return this.resource.data}get isExpired(){return this._userExpireAfterMs>0?performance.now()>this._lastUpdate+this._userExpireAfterMs:!1}get elapsed(){return performance.now()-this._lastUpdate}get isDisposed(){return this._state==="disposed"}get isValid(){return!(this.isDisposed||this.isExpired||this.resource.isDisposed)}},Zu=class{constructor(e,t){if(this.pool=e,t===void 0)throw new Error("Parameter 'data' is undefined");if(e===void 0)throw new Error("Parameter 'pool' is undefined");this.#t=t,this.#s=0,this.#i=e.resourcesWithoutUserExpireAfterMs,this.#n=e.capacityPerResource,this.#r=[],this.#e="idle"}#e;#t;#r;#n;#i;#s;get data(){if(this.#e==="disposed")throw new Error("Resource disposed");return this.#t}updateData(e){if(this.#e==="disposed")throw new Error("Resource disposed");if(e===void 0)throw new Error("Parameter 'data' is undefined");this.#t=e}toString(){return`Resource (expired: ${this.isExpiredFromUsers} users: ${this.#r.length}, state: ${this.#e}) data: ${JSON.stringify(this.data)}`}_assign(e){if(this.#r.find(r=>r===e||r.key===e.key))throw new Error("User instance already assigned to resource");this.#r.push(e),this.#s=performance.now()}_release(e){this.#r=this.#r.filter(t=>t!==e),this.pool._release(e),this.#s=performance.now()}get hasUserCapacity(){return this.usersCount<this.#n}get usersCount(){return this.#r.length}get isExpiredFromUsers(){return this.#i<=0||this.#r.length>0?!1:performance.now()>this.#i+this.#s}get isDisposed(){return this.#e==="disposed"}dispose(e){if(this.#e==="disposed")return;const t=this.#t;this.#e="disposed",this.pool.log.log(`Resource disposed (${e})`);for(const r of this.#r)r._dispose(`resource-${e}`,t);this.#r=[],this.#s=performance.now(),this.pool._releaseResource(this,e),this.pool.freeResource&&this.pool.freeResource(t)}},Qu=class{_resources;_users;capacity;userExpireAfterMs;resourcesWithoutUserExpireAfterMs;capacityPerResource;fullPolicy;generateResource;freeResource;log;constructor(e={}){this.capacity=e.capacity??-1,this.fullPolicy=e.fullPolicy??"error",this.capacityPerResource=e.capacityPerResource??1,this.userExpireAfterMs=e.userExpireAfterMs??-1,this.resourcesWithoutUserExpireAfterMs=e.resourcesWithoutUserExpireAfterMs??-1,this.generateResource=e.generate,this.freeResource=e.free,this._users=new Map,this._resources=[],this.log=Co("Pool",e.debug??!1);const t=Math.max(this.userExpireAfterMs,this.resourcesWithoutUserExpireAfterMs);t>0&&setInterval(()=>{this.maintain()},t*1.1)}dumpToString(){let e=`Pool
    capacity: ${this.capacity} userExpireAfterMs: ${this.userExpireAfterMs} capacityPerResource: ${this.capacityPerResource}
    resources count: ${this._resources.length}`;const t=this._resources.map(r=>r.toString()).join(`\r
	`);e+=`\r
Resources:\r
	`+t,e+=`\r
Users: \r
`;for(const[r,n]of this._users.entries())e+=`	k: ${r} v: ${n.toString()}\r
`;return e}getUsersByLongestElapsed(){return[...this._users.values()].sort((e,t)=>{const r=e.elapsed,n=t.elapsed;return r===n?0:r<n?1:-1})}getResourcesSortedByUse(){return[...this._resources].sort((e,t)=>e.usersCount===t.usersCount?0:e.usersCount<t.usersCount?-1:1)}addResource(e){if(e===void 0)throw new Error("Cannot add undefined resource");if(e===null)throw new Error("Cannot add null resource");if(this.capacity>0&&this._resources.length===this.capacity)throw new Error(`Capacity limit (${this.capacity}) reached. Cannot add more.`);this.log.log(`Adding resource: ${JSON.stringify(e)}`);const t=new Zu(this,e);return this._resources.push(t),t}maintain(){let e=!1;const t=[];for(const n of this._resources)n.isDisposed?(this.log.log(`Maintain, disposed resource: ${JSON.stringify(n.data)}`),t.push(n)):n.isExpiredFromUsers&&(this.log.log(`Maintain, expired resource: ${JSON.stringify(n.data)}`),t.push(n));if(t.length>0){for(const n of t)n.dispose("diposed/expired");e=!0}const r=[];for(const[n,i]of this._users.entries())i.isValid||(this.log.log(`Maintain. Invalid user: ${i.key} (Disposed: ${i.isDisposed} Expired: ${i.isExpired} Resource disposed: ${i.resource.isDisposed})`),r.push(n),i._dispose("invalid",i.data));for(const n of r)this._users.delete(n),e=!0;e&&this.log.log(`End: resource len: ${this._resources.length} users: ${this.usersLength}`)}*resources(){const e=[...this._resources];for(const t of e)yield t}*values(){const e=[...this._resources];for(const t of e)yield t.data}release(e,t){const r=this._users.get(e);!r||r.release(t??"Pool.release")}_release(e){this._users.delete(e.key)}_releaseResource(e,t){this._resources=this._resources.filter(r=>r!==e)}hasResource(e){return this._resources.find(r=>r.data===e)!==void 0}hasUser(e){return this._users.has(e)}_assign(e,t){const r=new Ku(e,t);return this._users.set(e,r),t._assign(r),r}_findUser(e){const t=this.getResourcesSortedByUse();if(t.length>0&&t[0].hasUserCapacity)return this._assign(e,t[0]);if(this.generateResource&&(this.capacity<0||this._resources.length<this.capacity)){this.log.log(`capacity: ${this.capacity} resources: ${this._resources.length}`);const r=this.addResource(this.generateResource());return this._assign(e,r)}}get usersLength(){return[...this._users.values()].length}useValue(e){return this.use(e).resource.data}use(e){const t=this._users.get(e);if(t)return t.keepAlive(),t;this.maintain();const r=this._findUser(e);if(r)return r;if(this.fullPolicy==="error")throw new Error(`Pool is fully used (fullPolicy: ${this.fullPolicy}, capacity: ${this.capacity})`);if(this.fullPolicy==="evictOldestUser"){const n=this.getUsersByLongestElapsed();if(n.length>0){this.release(n[0].key,"evictedOldestUser");const i=this._findUser(e);if(i)return i}}throw new Error(`Pool is fully used (${this.fullPolicy})`)}},Uv=(e={})=>new Qu(e),Hv=(e,t)=>(typeof e=="function"&&(e=e()),typeof t=="function"&&(t=t()),M(e,"percentage","v"),M(t,"percentage","t"),e*t);async function Gv(e){return typeof e=="object"&&"next"in e?(await e.next()).value:typeof e=="function"?await e():e}async function el(e){const t=[];for(const r of Object.entries(e)){const n=r[0],i=r[1],s=await Gv(i);t.push([n,s])}return Object.fromEntries(t)}function Yv(e){return()=>el(e)}function Xv(e,t){const r=Ve.object(e);let n=async()=>r.last(),i=(o,a,u)=>{};const s=o=>r.update(o);if(t!==void 0){const o=tl(t);n=async()=>{const a=await o.compute();return s(a)},i=o.replaceSource}return{...r,pull:n,replaceSource:i}}function tl(e){const t={},r={},n={},i=(f,m)=>{if(Array.isArray(m)||Zr(m))r[f]=m;else if(typeof m=="function")n[f]=m;else try{const p=Y(m);o.replaceSource(f,p)}catch{r[f]=m}},s=(f,m)=>{if(f in t){const p=t[f];return delete t[f],m&&p.dispose("ResolveFields.pull.removeSource"),p}else if(f in r){const p=r[f];return delete r[f],p}else if(f in n){const p=n[f];return delete n[f],p}else throw new Error(`Field '${f}' not found`)};for(const[f,m]of Object.entries(e))i(f,m);const o=xr(t,{onSourceDone:"allow"});let a;const u=o.onValue(f=>{a=f}),l=async()=>{const f={};for(const[m,p]of Object.entries(n))f[m]=await p();return f};let c=nr(e,f=>{});return{last:()=>c,compute:async()=>(c={...r,...a,...await l()},c),dispose:()=>{u(),o.dispose("ResolveFields.dispose")},replaceSource:(f,m,p)=>{const g=s(f,p);return i(f,m),g}}}var Jv=e=>{const t=e.reduce((i,s)=>Math.max(i,s),Number.NEGATIVE_INFINITY),r=e.map(i=>Math.exp(i-t)),n=r.reduce((i,s)=>i+s);return r.map(i=>i/n)},Kv=(e=lr)=>{const t=new Set;return r=>{if(r===null)throw new TypeError("Param 'value' cannot be null");if(r===void 0)throw new TypeError("Param 'value' cannot be undefined");const n=typeof r=="string"?r:e(r);return t.has(n)?!1:(t.add(n),!0)}},rl=()=>{const e=new Set;return t=>{if(t===null)throw new TypeError("Param 'value' cannot be null");if(t===void 0)throw new TypeError("Param 'value' cannot be undefined");return e.has(t)?!1:(e.add(t),!0)}},nl={};x(nl,{Directed:()=>yu,Undirected:()=>il});var il={};x(il,{adjacentVertices:()=>nm,connect:()=>ll,connectTo:()=>ul,createVertex:()=>sl,dumpGraph:()=>em,edgesForVertex:()=>im,getConnection:()=>_i,getOrCreate:()=>mn,graph:()=>Zv,hasConnection:()=>al,toAdjacencyMatrix:()=>Qv,updateGraphVertex:()=>ol});var sl=e=>({id:e}),ol=(e,t)=>({...e,vertices:e.vertices.set(t.id,t)}),mn=(e,t)=>{const r=e.vertices.get(t);if(r!==void 0)return{graph:e,vertex:r};const n=sl(t);return{graph:ol(e,n),vertex:n}};function ir(e,t){const r=typeof t=="string"?e.vertices.get(t):t;if(r===void 0)throw new Error(`Id not found ${t}`);return r}var al=(e,t,r)=>_i(e,t,r)!==void 0,_i=(e,t,r)=>{const n=ir(e,t),i=ir(e,r);for(const s of e.edges)if(s.a==n.id&&s.b===i.id||s.a==i.id&&s.b===n.id)return s};function ul(e,t,r,n){e=mn(e,t).graph,e=mn(e,r).graph;let o=_i(e,t,r);return o!==void 0?{graph:e,edge:o}:(o={a:t,b:r,weight:n},{graph:{...e,edges:[...e.edges,o]},edge:o})}function ll(e,t){const{a:r,weight:n,b:i}=t,s=Array.isArray(i)?i:[i];for(const o of s)e=ul(e,r,o,n).graph;return e}var Zv=(...e)=>{let t={vertices:cr(),edges:[]};for(const r of e)t=ll(t,r);return t};function Qv(e){const t=[...e.vertices.values()],r=new Fi;r.labelColumns(...t.map(n=>n.id)),r.labelRows(...t.map(n=>n.id));for(let n=0;n<t.length;n++){r.setRow(n,t.length,!1);const i=t[n];for(const[s,o]of t.entries())al(e,i,o)&&r.set(n,s,!0)}return r}var em=e=>tm(e).join(`
`),tm=e=>{const t=[];t.push(`Vertices: ${[...e.vertices.values()].map(r=>r.id).join(", ")}`),t.push("Edges:");for(const r of e.edges)t.push(rm(r));return t},rm=e=>{const t=e.weight?` (${e.weight})`:"";return`${e.a} <-> ${e.b}${t}`};function*nm(e,t){if(t===void 0)return;if((typeof t=="string"?e.vertices.get(t):t)===void 0)throw new Error(`Vertex not found ${JSON.stringify(t)}`);for(const n of e.edges)n.a===t?yield ir(e,n.b):n.b===t&&(yield ir(e,n.a))}function*im(e,t){if(t===void 0)return;if((typeof t=="string"?e.vertices.get(t):t)===void 0)throw new Error(`Vertex not found ${JSON.stringify(t)}`);for(const n of e.edges)n.a===t?yield n:n.b===t&&(yield n)}var sm=Math.PI*2,cl={};x(cl,{BipolarView:()=>Ml,Colour:()=>$s,Drawing:()=>Pi,ImageDataGrid:()=>Md,Palette:()=>Vi,Plot2:()=>Mi,PlotOld:()=>$l,SceneGraph:()=>$i,Svg:()=>Cn,Video:()=>Zn,scaleCanvas:()=>Sl});var Pi={};x(Pi,{arc:()=>hl,bezier:()=>pl,circle:()=>sr,connectedPoints:()=>Pr,copyToImg:()=>dm,dot:()=>we,drawingStack:()=>it,ellipse:()=>cm,getContext:()=>fl,line:()=>Ri,lineThroughPoints:()=>lm,makeHelper:()=>om,paths:()=>vl,pointLabels:()=>Nr,rect:()=>yl,textBlock:()=>wl,textBlockAligned:()=>mm,textHeight:()=>vm,textRect:()=>Rr,textWidth:()=>or,translatePoint:()=>ml,triangle:()=>hm});var dl=Math.PI*2,fl=e=>{if(e===null)throw new Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw new Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");const t=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?V(e).getContext("2d"):e;if(t===null)throw new Error("Could not create 2d context for canvas");return t},om=(e,t)=>{const r=fl(e);return{ctx:r,paths(n,i){vl(r,n,i)},line(n,i){Ri(r,n,i)},rect(n,i){yl(r,n,i)},bezier(n,i){pl(r,n,i)},connectedPoints(n,i){Pr(r,n,i)},pointLabels(n,i){Nr(r,n,i)},dot(n,i){we(r,n,i)},circle(n,i){sr(r,n,i)},arc(n,i){hl(r,n,i)},textBlock(n,i){i.bounds===void 0&&t!==void 0&&(i={...i,bounds:{...t,x:0,y:0}}),wl(r,n,i)}}},Ni=e=>am(e.strokeStyle,e.fillStyle),de=(e,t={},...r)=>{if(e===void 0)throw new Error("ctx undefined");const n=it(e).push(Ni(t),...r);return n.apply(),n},hl=(e,t,r={})=>{de(e,r);const n=s=>{e.beginPath(),e.arc(s.x,s.y,s.radius,s.startRadian,s.endRadian),e.stroke()},i=Array.isArray(t)?t:[t];for(const s of i)n(s)},am=(e,t)=>n=>{t&&(n.fillStyle=t),e&&(n.strokeStyle=e)},um=(e,t,r)=>i=>{e&&(i.lineWidth=e),t&&(i.lineJoin=t),r&&(i.lineCap=r)},it=(e,t)=>(t===void 0&&(t=new us),{push:(...s)=>{t===void 0&&(t=new us);const o=t.push(...s);for(const a of s)a(e);return it(e,o)},pop:()=>{const s=t?.pop();return it(e,s)},apply:()=>{if(t===void 0)return it(e);for(const s of t.data)s(e);return it(e,t)}}),lm=(e,t,r)=>{de(e,r),e.moveTo(t[0].x,t[0].y);for(const[n,i]of t.entries()){if(n+2>=t.length)continue;const s=t[n+1],o={x:(i.x+s.x)/2,y:(i.y+s.y)/2},a=(o.x+i.x)/2,u=(o.x+s.x)/2;e.quadraticCurveTo(a,s.y,o.x,o.y),e.quadraticCurveTo(u,s.y,s.x,s.y)}},sr=(e,t,r={})=>{de(e,r);const n=i=>{e.beginPath(),e.arc(i.x,i.y,i.radius,0,dl),r.strokeStyle&&e.stroke(),r.fillStyle&&e.fill()};if(Array.isArray(t))for(const i of t)n(i);else n(t)},cm=(e,t,r={})=>{de(e,r);const n=s=>{e.beginPath();const o=s.rotation??0,a=s.startAngle??0,u=s.endAngle??dl;e.ellipse(s.x,s.y,s.radiusX,s.radiusY,o,a,u),r.strokeStyle&&e.stroke(),r.fillStyle&&e.fill()},i=Array.isArray(t)?t:[t];for(const s of i)n(s)},vl=(e,t,r={})=>{de(e,r);const n=i=>{if(js(i))gl(e,i,r);else if(Zd(i))Ri(e,i,r);else throw new Error(`Unknown path type ${JSON.stringify(i)}`)};if(Array.isArray(t))for(const i of t)n(i);else n(t)},Pr=(e,t,r={})=>{const n=r.loop??!1;if($d(t),t.length!==0){for(const[i,s]of t.entries())zs(s,`Index ${i}`);de(e,r),r.lineWidth&&(e.lineWidth=r.lineWidth),e.beginPath(),e.moveTo(t[0].x,t[0].y);for(const i of t)e.lineTo(i.x,i.y);n&&e.lineTo(t[0].x,t[0].y),(r.strokeStyle||r.strokeStyle===void 0&&r.fillStyle===void 0)&&e.stroke(),r.fillStyle&&e.fill()}},Nr=(e,t,r={},n)=>{if(t.length!==0){for(const[i,s]of t.entries())zs(s,`Index ${i}`);de(e,r);for(const[i,s]of t.entries()){const o=n!==void 0&&i<n.length?n[i]:i.toString();e.fillText(o.toString(),s.x,s.y)}}},ml=(e,t)=>{const r=e.getTransform();return{x:t.x*r.a+t.y*r.c+r.e,y:t.x*r.b+t.y*r.d+r.f}},dm=e=>{const t=document.createElement("img");return t.src=e.toDataURL("image/jpeg"),t},we=(e,t,r)=>{r===void 0&&(r={});const n=r.radius??10;de(e,r),(()=>{if(e.beginPath(),Array.isArray(t))for(const s of t)e.arc(s.x,s.y,n,0,2*Math.PI);else{const s=t;e.arc(s.x,s.y,n,0,2*Math.PI)}})(),(r.filled||!r.stroke)&&e.fill(),r.stroke&&(r.strokeWidth&&(e.lineWidth=r.strokeWidth),e.stroke())},pl=(e,t,r)=>{js(t)?gl(e,t,r):Id(t)&&fm(e,t,r)},fm=(e,t,r={})=>{let n=de(e,r);const{a:i,b:s,cubic1:o,cubic2:a}=t,u=r.debug??!1;e.beginPath(),e.moveTo(i.x,i.y),e.bezierCurveTo(o.x,o.y,a.x,a.y,s.x,s.y),e.stroke(),u&&(n=n.push(Ni({...r,strokeStyle:lt(r.strokeStyle??"silver",.6),fillStyle:lt(r.fillStyle??"yellow",.4)})),n.apply(),e.moveTo(i.x,i.y),e.lineTo(o.x,o.y),e.stroke(),e.moveTo(s.x,s.y),e.lineTo(a.x,a.y),e.stroke(),e.fillText("a",i.x+5,i.y),e.fillText("b",s.x+5,s.y),e.fillText("c1",o.x+5,o.y),e.fillText("c2",a.x+5,a.y),we(e,o,{radius:3}),we(e,a,{radius:3}),we(e,i,{radius:3}),we(e,s,{radius:3}),n=n.pop(),n.apply())},gl=(e,t,r={})=>{const{a:n,b:i,quadratic:s}=t,o=r.debug??!1;let a=de(e,r);e.beginPath(),e.moveTo(n.x,n.y),e.quadraticCurveTo(s.x,s.y,i.x,i.y),e.stroke(),o&&(a=a.push(Ni({...r,strokeStyle:lt(r.strokeStyle??"silver",.6),fillStyle:lt(r.fillStyle??"yellow",.4)})),Pr(e,[n,s,i]),e.fillText("a",n.x+5,n.y),e.fillText("b",i.x+5,i.y),e.fillText("h",s.x+5,s.y),we(e,s,{radius:3}),we(e,n,{radius:3}),we(e,i,{radius:3}),a=a.pop(),a.apply())},Ri=(e,t,r={})=>{const n=r.debug??!1,i=um(r.lineWidth,r.lineJoin,r.lineCap);de(e,r,i);const s=o=>{const{a,b:u}=o;e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(u.x,u.y),n&&(e.fillText("a",a.x,a.y),e.fillText("b",u.x,u.y),we(e,a,{radius:5,strokeStyle:"black"}),we(e,u,{radius:5,strokeStyle:"black"})),e.stroke()};if(Array.isArray(t))for(const o of t)s(o);else s(t)},hm=(e,t,r={})=>{de(e,r);const n=i=>{Pr(e,hs(i),{...r,loop:!0}),r.debug&&Nr(e,hs(i),void 0,["a","b","c"])};if(Array.isArray(t))for(const i of t)n(i);else n(t)},yl=(e,t,r={})=>{de(e,r);const n=r.filled??r.fillStyle!==void 0,i=r.stroked??r.strokeStyle!==void 0,s=o=>{const a="x"in o?o.x:0,u="y"in o?o.y:0;n&&e.fillRect(a,u,o.width,o.height),(i??!0)&&e.strokeRect(a,u,o.width,o.height),r.debug&&Nr(e,Qd(o),void 0,["NW","NE","SE","SW"])};if(Array.isArray(t))for(const o of t)s(o);else s(t)},or=(e,t,r=0,n)=>Rr(e,t,r,n).width,Rr=(e,t,r=0,n)=>{if(t==null||t.length===0)return Ws;const i=e.measureText(t);return{width:n?Os(i.width,n)+r:i.width+r,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent+r+r}},vm=(e,t,r=0)=>Rr(e,t,r).height,wl=(e,t,r)=>{de(e,r);const n=r.anchorPadding??0,i=r.anchor,s=r.bounds??{x:0,y:0,width:1e6,height:1e6},o=t.map(f=>e.measureText(f)),a=o.map(f=>f.width),u=o.map(f=>f.actualBoundingBoxAscent+f.actualBoundingBoxDescent),l=Math.max(...a),c=u.reduce((f,m)=>f+m,0);let{x:d,y:h}=i;i.x+l>s.width?d=s.width-(l+n):d-=n,d<s.x&&(d=s.x+n),i.y+c>s.height?h=s.height-(c+n):h-=n,h<s.y&&(h=s.y+n);for(const[f,m]of t.entries())e.fillText(m,d,h),h+=u[f]},mm=(e,t,r)=>{const{bounds:n}=r,{horiz:i="left",vert:s="top"}=r,o=typeof t=="string"?[t]:t;de(e,r),e.save(),e.translate(n.x,n.y),e.textAlign="left",e.textBaseline="top";const a=n.width/2,u=n.height/2,l=o.map(f=>e.measureText(f)),c=l.map(f=>f.actualBoundingBoxAscent+f.actualBoundingBoxDescent),d=c.reduce((f,m)=>f+m,0);let h=0;s==="center"?h=u-d/2:s==="bottom"&&(h=n.height-d);for(const[f,m]of o.entries()){let p=0;i==="center"?p=a-l[f].width/2:i==="right"&&(p=n.width-l[f].width),e.fillText(m,p,h),h+=c[f]}e.restore()},Mi={};x(Mi,{AxisX:()=>Nl,AxisY:()=>Rl,Legend:()=>Pl,Plot:()=>xm,PlotArea:()=>_l,Series:()=>Tl});var $i={};x($i,{Box:()=>Al,CanvasBox:()=>mt,CanvasLayoutState:()=>xl,CanvasMeasureState:()=>Cl,LayoutState:()=>bl,MeasureState:()=>El,boxRectFromPx:()=>gm,boxRectFromRectPx:()=>ym,boxUnitFromPx:()=>Be});var pm=(e,t)=>Object.freeze({...e,width:Math.min(e.width,t.width),height:Math.min(e.height,t.height)}),Be=e=>({type:"px",value:e}),gm=(e,t,r,n)=>({x:Be(e),y:Be(t),width:Be(r),height:Be(n)}),ym=e=>({x:Be(e.x),y:Be(e.y),width:Be(e.width),height:Be(e.height)}),Ot=(e,t)=>e.type==="px"&&t.type==="px"?e.value===t.value:!1,wm=(e,t)=>e===void 0&&t===void 0?!0:!(e===void 0||t===void 0||e.x&&t.x&&!Ot(e.x,t.x)||e.y&&t.y&&!Ot(e.y,t.y)||e.width&&t.width&&!Ot(e.width,t.width)||e.height&&t.height&&!Ot(e.height,t.height)),Dl=class{bounds;pass;constructor(e){this.bounds=e,this.pass=0}resolveToPx(e,t,r){if(e===void 0&&r!==void 0)return r;if(e!==void 0){if(e.type===void 0)throw new TypeError("Expected 'type' and 'value' fields. Type is missing");if(e.value===void 0)throw new TypeError("Expected 'type' and 'value' fields. Value is missing");if(e.type==="px")return e.value;if(e.type==="pc")return e.value*t;throw new Error(`Unknown unit type: ${e.type}`)}}resolveBox(e){if(e===void 0)return;const t=this.resolveToPx(e.x,this.bounds.width),r=this.resolveToPx(e.y,this.bounds.height),n=this.resolveToPx(e.width,this.bounds.width),i=this.resolveToPx(e.height,this.bounds.height);if(!n||!i)throw new TypeError("Expected width and height");if(t===void 0&&r===void 0)return Object.freeze({width:n,height:i});if(!t||!r)throw new TypeError("Expected x and y");return Object.freeze({x:t,y:r,width:n,height:i})}},El=class extends Dl{measurements;constructor(e){super(e);this.measurements=new Map}getActualSize(e){const t=this.measurements.get(e);if(t!==void 0&&!Ft(t.actual))return t.actual}whatIsMeasured(){return[...this.measurements.keys()]}},bl=class extends Dl{layouts;constructor(e){super(e);this.layouts=new Map}},Al=class{canvasRegion=Ut;_desiredRect;_measuredSize;_layoutPosition;children=[];_parent;_idMap=new Map;debugLayout=!1;_visible=!0;_ready=!0;takesSpaceWhenInvisible=!1;_needsMeasuring=!0;_needsLayoutX=!0;_needsDrawing=!0;debugHue=Bs();id;constructor(e,t){this.id=t,this._parent=e,e?.onChildAdded(this)}hasChild(e){const t=this.children.find(n=>n===e),r=this.children.find(n=>n.id===e.id);return t!==void 0||r!==void 0}notify(e,t){this.onNotify(e,t);for(const r of this.children)r.notify(e,t)}*getChildren(){return this.children.entries()}onNotify(e,t){}onChildAdded(e){if(e.hasChild(this))throw new Error("Recursive");if(e===this)throw new Error("Cannot add self as child");if(this.hasChild(e))throw new Error("Child already present");this.children.push(e),this._idMap.set(e.id,e),this.layoutInvalidated("Box.onChildAdded")}setReady(e,t=!1){if(this._ready=e,t)for(const r of this.children)r.setReady(e,t)}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.layoutInvalidated("Box.set visible"))}get desiredRegion(){return this._desiredRect}set desiredRegion(e){wm(e,this._desiredRect)||(this._desiredRect=e,this.layoutInvalidated("set desiredRegion"))}layoutInvalidated(e){if(e===void 0)debugger;this.debugLog(`layoutInvalidated ${e}`),this._needsMeasuring=!0,this._needsLayoutX=!0,this._needsDrawing=!0,this.notifyChildLayoutNeeded()}drawingInvalidated(e){this._needsDrawing=!0}notifyChildLayoutNeeded(){this._needsDrawing=!0,this._needsLayoutX=!0,this._needsMeasuring=!0,this._parent!==void 0&&this._parent.notifyChildLayoutNeeded()}get root(){return this._parent===void 0?this:this._parent.root}measurePreflight(){}measureApply(e){this._needsMeasuring=!1;const t=this._measuredSize===void 0?!0:!Ld(e.actual,this._measuredSize);t&&(this._needsLayoutX=!0),this._measuredSize={width:e.actual.width,height:e.actual.height};for(const r of e.children)r!==void 0&&r.ref.measureApply(r);return t&&this.root.notify("measureApplied",this),t}layoutApply(e){this._needsLayoutX=!1;const t=this._layoutPosition===void 0?!0:!Vd(e.actual,this._layoutPosition);this._layoutPosition={x:e.actual.x,y:e.actual.y};for(const r of e.children)r!==void 0&&r.ref.layoutApply(r);return t&&this.root.notify("layoutApplied",this),t}debugLog(e){!this.debugLayout||console.log(this.id,e)}layoutStart(e,t,r,n){const i={ref:this,actual:ef,children:[]};t.layouts.set(this.id,i);const s=this.layoutSelf(e,t,n);if(this.root.notify("laidout",this),s!==void 0&&(i.actual=s,i.children=this.children.map(o=>o.layoutStart(e,t,r,i)),!(ls(i.children).length<this.children.length)))return i}layoutSelf(e,t,r){const n=t.resolveBox(this._desiredRect),i=n===void 0?0:"x"in n?n.x:0,s=n===void 0?0:"y"in n?n.y:0;if(i===void 0)debugger;if(s===void 0)debugger;return{x:i,y:s}}measureStart(e,t,r){this.measurePreflight();const n={ref:this,actual:vs,children:[]};if(e.measurements.set(this.id,n),!this._visible&&!this.takesSpaceWhenInvisible)n.actual=qd;else{let i=this._measuredSize;if((this._needsMeasuring||this._measuredSize===void 0)&&(i=this.measureSelf(e,r),this.root.notify("measured",this)),typeof i=="string")return;if(i===void 0)return;n.actual=i}if(n.children=this.children.map(i=>i.measureStart(e,t,n)),!(ls(n.children).length<this.children.length))return n}measureSelf(e,t){let r=vs;const n=t?t.actual:e.bounds,i=e.resolveBox(this._desiredRect);return r=i?pm(i,n):n,Ft(r)?"Box.measureSelf - No size for box?":r}update(e,t=!1){if(e===void 0)throw new Error("context is undefined");if(!this._needsMeasuring&&!this._needsLayoutX&&!t)return;const[r,n]=this.updateBegin(e);let i=5,s=!1,o=!1;if(this._needsMeasuring||t){for(;i--;){const a=this.measureStart(r,t);if(a!==void 0){if(this.measureApply(a),!this._ready)return;s=!0}}s||this.debugLog("Ran out of measurement attempts")}if(this._needsLayoutX||t){const a=this.layoutStart(r,n,t);a===void 0?this.debugLog("Warning: could not layout"):(this.layoutApply(a),o=!0)}this.updateComplete(s,o)}},Cl=class extends El{ctx;constructor(e,t){super(e);if(this.ctx=t,t===void 0)throw new Error("ctx is undefined")}},xl=class extends bl{ctx;constructor(e,t){super(e);if(this.ctx=t,t===void 0)throw new Error("ctx is undefined")}},mt=class Fl extends Al{bounds;constructor(t,r,n){super(t,r);this.bounds=n,this.debugLog(`CanvasBox ctor bounds: ${JSON.stringify(n)}`)}static fromCanvas(t){return new Fl(void 0,"canvas-box",t.getBoundingClientRect())}addEventHandlers(t){t.addEventListener("pointermove",r=>{const n={x:r.offsetX,y:r.offsetY};this.notifyPointerMove(n)}),t.addEventListener("pointerleave",r=>{this.notifyPointerLeave()}),t.addEventListener("click",r=>{const n={x:r.offsetX,y:r.offsetY};this.notifyClick(n)})}onClick(t){}notifyClick(t){if(!Ft(this.canvasRegion)&&cs(this.canvasRegion,t)){const r=Yt(t,this.canvasRegion.x,this.canvasRegion.y);this.onClick(r);for(const n of this.children)n.notifyClick(r)}}notifyPointerLeave(){this.onPointerLeave();for(const t of this.children)t.notifyPointerLeave()}notifyPointerMove(t){if(!Ft(this.canvasRegion)&&cs(this.canvasRegion,t)){const r=Yt(t,this.canvasRegion.x,this.canvasRegion.y);this.onPointerMove(r);for(const n of this.children)n.notifyPointerMove(r)}}onPointerLeave(){}onPointerMove(t){}update(t,r=!1){super.update(t,r),this.draw(t,r)}getBounds(){return this.bounds===void 0&&this._parent?this._parent.bounds:this.bounds}updateBegin(t){if(t===void 0)throw new Error("Context is undefined");let r=this.getBounds();return r===void 0&&(this.debugLog("No bounds for element or parent, using canvas bounds"),r={x:0,y:0,width:t.canvas.width,height:t.canvas.height}),[new Cl(r,t),new xl(r,t)]}updateComplete(t,r){this.canvasRegion=Ut}measureApply(t){const r=super.measureApply(t);return r&&(this.canvasRegion=Ut),r}layoutApply(t){const r=super.layoutApply(t);return r&&(this.canvasRegion=Ut),r}draw(t,r=!1){if(this._needsDrawing||r){if(Ft(this.canvasRegion)){if(this._layoutPosition===void 0||this._measuredSize===void 0)return;this.canvasRegion={x:this._layoutPosition.x,y:this._layoutPosition.y,width:this._measuredSize.width,height:this._measuredSize.height}}this._needsLayoutX||this._needsMeasuring,t.save();const n=this.canvasRegion;t.translate(n.x,n.y),this.debugLayout&&(t.lineWidth=1,t.strokeStyle=`hsl(${this.debugHue}, 100%, 50%)`,t.strokeRect(0,0,n.width,n.height),t.fillStyle=t.strokeStyle,t.fillText(this.id,10,10,n.width),t.beginPath(),t.moveTo(0,0),t.lineTo(n.width,n.height),t.stroke()),this.drawSelf(t),this._needsDrawing=!1,t.restore()}for(const n of this.children)n.draw(t,r)}drawSelf(t){}},Sl=e=>{const t=V(e),r=window.devicePixelRatio;return t.style.width=t.width+"px",t.style.height=t.height+"px",t.width*=devicePixelRatio,t.height*=devicePixelRatio,{ctx:(()=>{const i=t.getContext("2d");if(i===null)throw new Error("Could not get drawing context");return i.save(),i.scale(r,r),i})(),element:t,bounds:t.getBoundingClientRect()}},kl={};x(kl,{resizeObservable:()=>Ii,themeChange:()=>Dm,windowResize:()=>Tt});var Tt=e=>ji.debounce({elapsed:e??100})(Ve.event(window,"resize",{innerWidth:0,innerHeight:0})),Dm=()=>Ve.observable(t=>{const r=new MutationObserver(i=>{t.set(i)}),n={attributeFilter:["class"],attributes:!0};return r.observe(document.documentElement,n),()=>{r.disconnect()}}),Ii=(e,t)=>{if(e===null)throw new Error("elem parameter is null. Expected element to observe");if(e===void 0)throw new Error("elem parameter is undefined. Expected element to observe");const r=Ve.observable(n=>{const i=new ResizeObserver(s=>{n.set(s)});return i.observe(e),()=>{i.unobserve(e)}});return ji.debounce({elapsed:t??100})(r)},Li=(e,t,r=100)=>{const n=V(e);if(n.nodeName!=="CANVAS")throw new Error(`Expected HTML element with node name CANVAS, not ${n.nodeName}`);const i=n.parentElement;if(i===null)throw new Error("Element has no parent");const s=n.getContext("2d");if(s===null)throw new Error("Could not create drawing context");return n.style.width="100%",n.style.height="100%",Ii(i,r).onValue(a=>{const u=a.find(d=>d.target===i);if(u===void 0)return;const l=u.contentRect.width,c=u.contentRect.height;if(n.setAttribute("width",n.offsetWidth+"px"),n.setAttribute("height",n.offsetHeight+"px"),t!==void 0){const d={min:Math.min(l,c),max:Math.max(l,c),width:l,height:c,center:{x:l/2,y:c/2}};t({ctx:s,el:n,bounds:d})}})},Em=(e,t,r=!1)=>{if(e==null)throw new Error("domQueryOrEl is null or undefined");const n=V(e);if(n.nodeName!=="CANVAS")throw new Error(`Expected HTML element with node name CANVAS, not ${n.nodeName}`);const i=n.getContext("2d");if(i===null)throw new Error("Could not create drawing context");const s=()=>{const a=window.innerWidth,u=window.innerHeight;if(n.width=a,n.height=u,t!==void 0){const l={min:Math.min(a,u),max:Math.max(a,u),width:a,height:u,center:{x:a/2,y:u/2}};t({ctx:i,el:n,bounds:l})}};r||(n.style.top="0",n.style.left="0",n.style.zIndex="-100",n.style.position="fixed");const o=Tt();return o.onValue(s),s(),o},Bl=class{data;series;dirty=!1;type="array";_range;constructor(e){this.series=e,this.data=[],this.dirty=!0}clear(){this.set([]),this._range=void 0}set(e){this.data=e,this.dirty=!0}get length(){return this.data.length}get range(){if(!this.dirty&&this._range!==void 0)return this._range;this.dirty=!1;const e=_t(this.data);return this._range===void 0||e.max!==this._range.max||e.min!==this._range.min?(this._range=e,{...this._range,changed:!0}):{...this._range,changed:!1}}add(e){this.data=[...this.data,e],this.dirty=!0}},bm=class extends Bl{desiredDataPointMinWidth=5;add(e){const t=this.series.lastPxPerPt;if(t>-1&&t<this.desiredDataPointMinWidth){const r=Math.floor(this.desiredDataPointMinWidth/t),n=[...this.data.slice(r),e];super.set(n)}else super.add(e)}},Tl=class{constructor(e,t,r,n){if(this.plot=r,this.name=e,this.drawingStyle=n.drawingStyle??"line",this.colour=n.colour,this.width=n.width??3,this.axisRange=n.axisRange??{min:Number.NaN,max:Number.NaN},this._visualRange={...this.axisRange},this._visualRangeStretch=n.visualRangeStretch??!0,t==="array")this.source=new Bl(this);else if(t==="stream")this.source=new bm(this);else throw new Error("Unknown sourceType. Expected array|stream")}name;colour;source;drawingStyle;width=3;dataHitPoint;tooltip;precision=2;axisRange;lastPxPerPt=-1;_visualRange;_visualRangeStretch;formatValue(e){return e.toFixed(this.precision)}get visualRange(){let e=this._visualRange;const t=this.source.range;let r=!1;if(t.changed)if(this._visualRangeStretch){const n=Math.min(gs(e.min,t.min),t.min),i=Math.max(gs(e.max,t.max),t.max);(n!==e.min||i!==e.max)&&(e={min:n,max:i},r=!0)}else Am(t,e)||(e=t,r=!0);return this._visualRange=e,{...e,changed:r}}scaleValue(e){if(this.source===void 0)return e;const t=this.visualRange;return t.changed&&this.plot.notify("range-change",this.plot.plotArea),t.min==t.max?.5:ut(e,t.min,t.max)}add(e){M(e,"","value"),this.source.add(e),this.plot.plotArea.drawingInvalidated("Series.add")}clear(){this.source.clear(),this._visualRange={...this.axisRange},this.plot.plotArea.layoutInvalidated("Series.clear")}},_l=class extends mt{constructor(e,t){super(e,"PlotArea",t);this.plot=e}paddingPx=5;piPi=Math.PI*2;pointerDistanceThreshold=20;lastRangeChange=0;pointer;clear(){this.lastRangeChange=0,this.pointer=void 0}measureSelf(e,t){const r=e.getActualSize("AxisY"),n=this.paddingPx,i=e.getActualSize("Legend"),s=i?.height??0,o=e.getActualSize("AxisX"),a=o?.height??0;return r?i?o?{width:e.bounds.width-r.width-this.paddingPx,height:e.bounds.height-s-a-n}:"No AxisX":"No Legend":`No AxisY. Measured: ${e.whatIsMeasured().join(", ")}`}layoutSelf(e,t,r){const n=e.getActualSize("AxisY"),i=this.paddingPx;return{x:n?.width??0,y:i}}onNotify(e,t){e==="measureApplied"&&t===this.plot.axisY&&this.layoutInvalidated("PlotArea.onNotify measureApplied to axisY"),e==="laidout"&&t===this.plot.legend&&this.layoutInvalidated("PlotArea.onNotify laidout to legend")}onPointerLeave(){for(const e of this.plot.series.values())e.tooltip=void 0;this.pointer=void 0,this.plot.legend.drawingInvalidated("PlotArea.onPointerLeave")}onPointerMove(e){this.pointer=e,this.plot.legend.drawingInvalidated("PlotArea.onPointerMove")}measurePreflight(){this.updateTooltip()}updateTooltip(){const e=this.pointer;if(e!==void 0){for(const t of this.plot.series.values()){if(e===void 0){t.tooltip=void 0;return}if(t.dataHitPoint===void 0)return;const r=t.dataHitPoint(e);if(r[0]===void 0||r[1]>this.pointerDistanceThreshold)return;t.tooltip=t.formatValue(r[0].value)}this.plot.legend.drawingInvalidated("PlotArea.updateTooltip")}}drawSelf(e){if(this.plot.frozen)return;const t=this.plot.seriesArray();e.clearRect(0,-1,this.canvasRegion.width,this.canvasRegion.height);for(const r of t)if(r.source.type==="array"||r.source.type==="stream"){const n=r.source;if(n.data===void 0)return;const i=[...n.data];this.drawDataSet(r,i,e)}else console.warn(`Unknown data source type ${r.source.type}`)}computeY(e,t){const r=e.scaleValue(t);return Ht(r)*this.canvasRegion.height+this.paddingPx}drawDataSet(e,t,r){const n=this.paddingPx+e.width,i=zd(this.canvasRegion,n*2,n*3.5),s=i.width/t.length;e.lastPxPerPt=s;let o=n;r.strokeStyle=e.colour,r.lineWidth=e.width;const a=[];if(e.dataHitPoint=u=>{const l=a.map(h=>jd(u,h)),c=Us(...l);return[a[c],l[c]]},e.drawingStyle==="line"){let u=0;r.beginPath();for(let l=0;l<t.length;l++){const c=Ee(e.scaleValue(t[l]));u=n+this.paddingPx+i.height*Ht(c),a.push({x:o,y:u,index:l,value:t[l]}),l==0?r.moveTo(o+s/2,u):r.lineTo(o+s/2,u),u>this.canvasRegion.height&&console.warn(`${u} h: ${this.canvasRegion.height}`),o+=s}r.strokeStyle=e.colour,r.stroke()}else if(e.drawingStyle==="dotted"){let u=0;r.fillStyle=e.colour;for(let l=0;l<t.length;l++){const c=e.scaleValue(t[l]);u=n+i.height*Ht(c),r.beginPath(),r.arc(o+s/2,u,e.width,0,this.piPi),r.fill(),a.push({radius:e.width,x:o,y:u,index:l,value:t[l]}),o+=s}}else if(e.drawingStyle==="bar"){r.fillStyle=e.colour;const u=Math.ceil(s*.1);for(let l=0;l<t.length;l++){const c=e.scaleValue(t[l]),d=i.height*c,h={x:o+u,y:i.height-d+n,width:s-u,height:d,index:l,value:t[l]};r.fillRect(h.x,h.y,h.width,h.height),a.push(h),o+=s}}}},Pl=class extends mt{constructor(e,t){super(e,"Legend",t);this.plot=e}sampleSize={width:10,height:10};padding=3;widthSnapping=20;labelMeasurements=new Map;clear(){}layoutSelf(e,t,r){const i=e.getActualSize("AxisY")?.width??0,s=this._measuredSize?.height??0;return{x:i,y:t.bounds.height-s}}measureSelf(e,t){const r=this.plot.seriesArray(),n=this.sampleSize,i=this.padding,s=this.widthSnapping,o=e.ctx,u=e.measurements.get("AxisY")?.actual.width??0;let l=i,c=i;const d=e.bounds.width-u-i;let h=0;for(const f of r){const m=l;l+=n.width+i,o.textBaseline="middle";const p=Rr(o,f.name,i,s);l+=or(o,f.name,i,s),f.tooltip&&(l+=or(o,f.tooltip,i,s));const g={width:10,height:10,x:m,y:c};this.labelMeasurements.set(f.name,g),h=Math.min(n.height+i+i,p.height+i+i),l+=i,l>d&&(l=i,c+=h)}return{width:d,height:c+h}}drawSelf(e){const t=this.plot.seriesArray(),r=this.sampleSize,n=this.padding;this.debugLog("drawSelf"),e.clearRect(0,0,this.canvasRegion.width,this.canvasRegion.height);for(const i of t){const s=this.labelMeasurements.get(i.name);if(s===void 0)continue;let o=s.x;e.fillStyle=i.colour,e.fillRect(o,s.y,r.width,r.height),o+=r.width+n,e.textBaseline="middle",e.fillStyle=this.plot.legendTextColour,e.fillText(i.name,o,s.y+r.height/2),i.tooltip&&(e.fillStyle=this.plot.legendTextColour,e.fillText(i.tooltip,s.x,s.y+r.height/2))}}onNotify(e,t){this.debugLog(`onNotify ${e} source: ${t.id}`),e==="measureApplied"&&t===this._parent.axisY&&this.layoutInvalidated("Legend.onNotify measureApplied to axisY")}},Nl=class extends mt{constructor(e,t){super(e,"AxisX",t);this.plot=e}paddingPx=2;colour;clear(){}onNotify(e,t){e==="measureApplied"&&t===this.plot.axisY&&this.layoutInvalidated("AxisX.onNotify measureApplied to axisY")}drawSelf(e){const t=this.plot,r=this.canvasRegion,n=t.axisStrokeWidth,i=this.colour??t.axisStrokeColour;e.strokeStyle=i,e.clearRect(0,0,r.width,r.height),e.beginPath(),e.lineWidth=n,e.moveTo(0,n/2),e.lineTo(r.width,n/2),e.stroke()}measureSelf(e,t){const r=this.plot,n=this.paddingPx,s=e.measurements.get("AxisY")?.actual.width??0,o=0,a=r.axisStrokeWidth+o+n+n;return{width:e.bounds.width-s-n,height:a}}layoutSelf(e,t,r){const n=e.measurements.get("AxisY"),s=e.getActualSize("Legend")?.height??0,o=n?.actual.width??0,a=this._measuredSize?.height??0;return{x:o,y:e.bounds.height-a-s}}},Am=(e,t)=>e.max===t.max&&e.min===t.min,Cm=e=>e.max===e.min,Rl=class extends mt{constructor(e,t){super(e,"AxisY",t);this.plot=e,this.lastRange={min:0,max:0}}_maxDigits=1;seriesToShow;paddingPx=2;colour;lastRange;lastPlotAreaHeight=0;clear(){this.lastRange={min:0,max:0},this.lastPlotAreaHeight=0}measurePreflight(){}onNotify(e,t){const r=this.plot.plotArea;if(e==="range-change"){this.drawingInvalidated("range-change");return}e==="measureApplied"&&t===r&&r.canvasRegion.height!==this.lastPlotAreaHeight&&(this.lastPlotAreaHeight=r.canvasRegion.height,this.drawingInvalidated("AxisY.onNotify height change"))}measureSelf(e){if(e.ctx===void 0)throw new Error("opts.ctx is undefined");const t=this.paddingPx;let r=this.plot.axisStrokeWidth+t;const n=this.getSeries();if(n!==void 0){const s=n.visualRange;this._maxDigits=Math.ceil(s.max).toString().length+n.precision+1;const o="9".repeat(this._maxDigits);r+=or(e.ctx,o,t*2)}return{width:e.resolveToPx(this.desiredRegion?.width,r,r),height:e.bounds.height}}layoutSelf(e,t,r){return{x:0,y:0}}drawSelf(e){const t=this.getSeries();if(t===void 0){if(this.seriesToShow===void 0)return;console.warn(`Plot AxisY series '${this.seriesToShow}' is missing.`)}else this.seriesAxis(t,e)}getSeries(){return this.seriesToShow===void 0?this.plot.seriesArray()[0]:this.plot.series.get(this.seriesToShow)}seriesAxis(e,t){const r=this.plot,n=r.plotArea,i=this.canvasRegion,s=this.paddingPx,o=e.visualRange,a=r.axisStrokeWidth,u=this.colour??r.axisStrokeColour;if(t.strokeStyle=u,t.fillStyle=u,Number.isNaN(o.min)&&Number.isNaN(o.max))return;this.lastRange=o,t.clearRect(0,0,i.width,i.height),t.beginPath(),t.lineWidth=a;const l=i.width-a/2;t.moveTo(l,n.paddingPx+a),t.lineTo(l,n.canvasRegion.height+s+a+a),t.stroke(),t.textBaseline="top";const c=i.width-s*4;t.fillStyle=r.axisTextColour,Cm(o)?(this.debugLog("rangeSinglePoint"),Jr(t,e.formatValue(o.max),d=>[c-d.width,n.computeY(e,o.max)-s*4])):(Jr(t,e.formatValue(o.max),d=>[c-d.width,n.computeY(e,o.max)+a/2]),Jr(t,e.formatValue(o.min),d=>[c-d.width,n.computeY(e,o.min)-5]))}},Jr=(e,t,r)=>{if(e===void 0)throw new Error("ctx is undefined");const n=e.measureText(t),i=r(n);e.fillText(t,i[0],i[1])},xm=class extends mt{plotArea;legend;axisX;axisY;axisStrokeColour;axisTextColour;legendTextColour;axisStrokeWidth;series;_frozen=!1;_canvasEl;_ctx;defaultSeriesOpts;constructor(e,t={}){const{ctx:r,element:n,bounds:i}=Sl(e);super(void 0,"Plot");this._canvasEl=n,this._ctx=r,t.autoSize&&Li(n,s=>{this.drawingInvalidated("resize"),this.layoutInvalidated("resize"),this.update(s.ctx,!0)}),this.axisStrokeColour=t.axisStrokeColour??"black",this.axisTextColour=t.axisTextColour??"black",this.legendTextColour=t.legendTextColour??"black",this.axisStrokeWidth=t.axisStrokeWidth??3,this.series=new Map,this.plotArea=new _l(this,i),this.legend=new Pl(this,i),this.axisX=new Nl(this,i),this.axisY=new Rl(this,i)}update(e,t=!1){e===void 0&&(e=this._ctx),super.update(e,t)}clearSeries(){for(const e of this.series.values())e.clear();this.update()}clear(){this.series=new Map,this.plotArea.clear(),this.legend.clear(),this.axisX.clear(),this.axisY.clear(),this.layoutInvalidated("Plot.clear"),this.drawingInvalidated("Plot.clear"),this.update()}get frozen(){return this._frozen}set frozen(e){this._frozen=e,e?(this._canvasEl.classList.add("frozen"),this._canvasEl.title="Plot frozen. Tap to unfreeze"):(this._canvasEl.title="",this._canvasEl.classList.remove("frozen"))}seriesArray(){return[...this.series.values()]}get seriesLength(){return this.series.size}plot(e){const t=uu(e,!0);let r=!1;for(const n of t){let i=this.series.get(n);i===void 0&&(i=this.createSeries(n,"stream"),i.drawingStyle="line",r=!0),i.add(li(e,n))}r&&this.legend.layoutInvalidated("new series"),this.update()}createSeriesFromObject(e,t=""){const r=Object.keys(e),n=i=>{const s=e[i];return typeof s=="object"?this.createSeriesFromObject(s,`${t}${i}.`):typeof s=="number"?[this.createSeries(i,"stream")]:[]};return r.flatMap(i=>n(i))}createSeries(e,t="array",r){const n=this.seriesLength;if(e===void 0&&(e=`series-${n}`),this.series.has(e))throw new Error(`Series name '${e}' already in use`);let i={colour:`hsl(${n*25%360}, 70%,50%)`,...r};this.defaultSeriesOpts&&(i={...this.defaultSeriesOpts,...i});const s=new Tl(e,t,this,i);return this.series.set(e,s),this.setReady(!0,!0),this.plotArea.drawingInvalidated("Plot.createSeries"),s}},Vi={};x(Vi,{create:()=>Fm});var Fm=e=>new Sm(e),Sm=class{#e=new Map;#t=new Map;fallbacks;#r=0;#n;constructor(e){e!==void 0?this.fallbacks=e:this.fallbacks=["red","blue","green","orange"],this.#n=document.body}setElementBase(e){this.#n=e}add(e,t){this.#e.set(e,t)}alias(e,t){this.#t.set(e,t)}get(e,t){const r=this.#t.get(e);r!==void 0&&(e=r);const n=this.#e.get(e);if(n!==void 0)return n;const i="--"+e;let s=getComputedStyle(this.#n).getPropertyValue(i).trim();if(s===void 0||s.length===0){if(t!==void 0)return t;s=this.fallbacks[this.#r],this.#r++,this.#r===this.fallbacks.length&&(this.#r=0)}return s}getOrAdd(e,t){if(this.has(e))return this.get(e);const r=this.get(e,t);return this.add(e,r),r}has(e){return this.#e.has(e)}},Ml={};x(Ml,{init:()=>km});function Fs(e,t,r){const n=e.getAttribute(t);return n===null?r:Number.parseInt(n)}var km=(e,t={})=>{const r=document.querySelector(e);if(!r)throw new Error(`Element query could not be found (${e})`);const n=t.labels??["x","y"],i=t.labelPrecision??2,s=t.asPercentages??!1,o=t.displayLastValues??0,a=t.showWhiskers??!0,u=t.showDot??!0,l=t.showLabels??!0,c=t.yAxisBottomNegative??!0,d=bt(t.axisColour,"silver"),h=bt(t.bgColour,"white"),f=bt(t.whiskerColour,"black"),m=bt(t.dotColour,t.whiskerColour,"black"),p=bt(t.labelColour,t.axisColour,"silver"),g=t.axisWidth??1*window.devicePixelRatio,w=t.dotRadius??5*window.devicePixelRatio,b=t.padding??10*window.devicePixelRatio,j=t.whiskerSize??5*window.devicePixelRatio,G=t.width??Fs(r,"width",200)*window.devicePixelRatio,S=t.height??Fs(r,"height",200)*window.devicePixelRatio;let T;o>0&&(T=Wd({capacity:o,discardPolicy:"older"})),r.width=G,r.height=S,r.style.width=`${G/window.devicePixelRatio}px`,r.style.height=`${S/window.devicePixelRatio}px`;const oe=S/2,Z=G/2,k=r.getContext("2d");if(!k)throw new Error("Could not create drawing context");window.devicePixelRatio>=2&&(k.font="20px sans-serif");const pt=s?q=>`${Math.round(q*100)}%`:q=>q.toFixed(i);l?(n[0]=n[0]+":",n[1]=n[1]+":"):(n[0]="",n[1]="");const gt=t.renderBackground??((q,fe,$e)=>{t.bgColour==="transparent"?q.clearRect(0,0,fe,$e):(q.fillStyle=h,q.fillRect(0,0,fe,$e))});return(q,fe)=>{q=Xe(q),fe=Xe(fe),gt(k,G,S),k.fillStyle=p,k.textBaseline="top",k.save(),k.translate(Z,oe),k.rotate(-Math.PI/2),k.fillText((n[1]+" "+pt(fe)).trim(),-Z+b,1),k.restore(),k.fillText((n[0]+" "+pt(q)).trim(),b,Z+2),c||(fe*=-1),k.strokeStyle=d,k.lineWidth=g,k.beginPath(),k.moveTo(b,oe),k.lineTo(G-b,oe),k.moveTo(Z,b),k.lineTo(Z,S-b),k.stroke(),k.closePath();const $e=(S-b-b)/2*-fe,yt=(G-b-b)/2*q,wt={x:yt,y:$e,radius:w};if(T&&(T=T.enqueue(wt)),k.save(),k.translate(Z,oe),u)if(T){const $r=1/T.length;let $t=1;T.forEach(Ir=>{const Lr=lt(m,$t);sr(k,Ir,{fillStyle:Lr}),$t-=$r})}else sr(k,wt,{fillStyle:m});a&&(k.strokeStyle=f,k.beginPath(),k.moveTo(0,$e-j),k.lineTo(0,$e+j),k.moveTo(yt-j,0),k.lineTo(yt+j,0),k.stroke(),k.closePath()),k.restore()}},$l={};x($l,{add:()=>Il,calcScale:()=>qi,defaultAxis:()=>pn,draw:()=>at,drawValue:()=>Ll,plot:()=>Im});var Bm=Math.PI*2,pn=e=>({endWith:"none",lineWidth:1,namePosition:"none",name:e,showLabels:e==="y",showLine:!0,textSize:e==="y"?20:10}),qi=(e,t,r)=>{const n=[];for(const i of e.keys()){const s=[...e.get(i)];if(s.length===0)break;let{min:o,max:a}=_t(s),u=a-o,l;r!==void 0&&(l=r[i]),l==null&&(l=t.defaultSeriesVariable?Ss("accent",t.defaultSeriesColour):t.defaultSeriesColour),u===0&&(u=o,o=o-u/2,a=a+u/2),n.push({min:o,max:a,range:u,name:i,colour:l})}return n},Il=(e,t,r="")=>{e.addKeyedValues(r,t)},Ll=(e,t,r)=>{const n={...r,translucentPlot:!0,leadingEdgeDot:!1};at(t,n),r={...r,highlightIndex:e,leadingEdgeDot:!0,translucentPlot:!1,style:"none",clearCanvas:!1},at(t,r)},Tm=(e,t,r)=>qi(e,r,r.seriesColours).map(n=>({...n,range:t[1]-t[0],min:t[0],max:t[1]})),at=(e,t)=>{const{x:r,y:n,ctx:i,canvasSize:s}=t,o=t.margin,a=t.y.scaleRange?Tm(e,t.y.scaleRange,t):qi(e,t,t.seriesColours);t.clearCanvas&&i.clearRect(0,0,s.width,s.height),t.debug&&(i.strokeStyle="orange",i.strokeRect(0,0,s.width,s.height)),i.translate(o,o);const u=t.plotSize??ql(s,t),l={height:u.height+o+o,width:u.width};if(n.showLabels||n.showLine){for(const d of a)n.allowedSeries!==void 0&&!n.allowedSeries.includes(d.name)||_m(d,l,t);a.length>0&&n.showLine&&Pm(l,a[0],t)}if((r.showLabels||r.showLine)&&a.length>0){const d=n.labelRange?n.labelRange[0]:a[0].min;Rm(u.width,Je(d,a[0],u.height)+o+r.lineWidth,t)}const c={...t,plotSize:u};ml(i,t.pointer);for(const d of a){const h=e.getSource(d.name);if(h===void 0)continue;let f=e.typeName==="circular"?h.pointer-1:h.length-1;t.highlightIndex!==void 0&&(f=t.highlightIndex),i.save(),i.translate(0,o+o),Mm(d,h,u,c,f),i.restore()}t.showLegend&&(i.save(),i.translate(0,u.height+o+o+o),u.width,t.x.textSize+o+o,Nm(a,t),i.restore()),i.resetTransform()},_m=(e,t,r)=>{const{ctx:n,y:i,digitsPrecision:s,margin:o}=r,{height:a}=t;r.debug&&(n.strokeStyle="purple",n.strokeRect(0,0,i.textSize,a+o)),n.fillStyle=e.colour.length>0?e.colour:"white",i.colour&&(n.fillStyle=i.colour);const u=i.labelRange?i.labelRange[0]:e.min,l=i.labelRange?i.labelRange[1]:e.max,c=i.labelRange?l-u:e.range,d=u+c/2,h=r.textHeight/2;n.textBaseline="top",n.fillText(u.toFixed(s),0,Je(u,e,a)-h),n.fillText(d.toFixed(s),0,Je(d,e,a)-h),n.fillText(l.toFixed(s),0,Je(l,e,a)-o),n.translate(i.textSize+o,0)},Pm=(e,t,r)=>{if(t===void 0)throw new Error("series undefined");const{ctx:n,y:i}=r,{height:s}=e,o=i.labelRange?i.labelRange[0]:t.min,a=i.labelRange?i.labelRange[1]:t.max,u=Je(o,t,s),l=Je(a,t,s);n.translate(i.lineWidth,0),n.lineWidth=i.lineWidth,n.beginPath(),n.moveTo(0,u),n.lineTo(0,l),n.strokeStyle=t.colour,i.colour&&(n.strokeStyle=i.colour),n.stroke(),n.translate(i.lineWidth,0)},Nm=(e,t,r)=>{const{ctx:n}=t,i=10;let s=0;const o=t.margin*3,a=t.margin;n.lineWidth=t.lineWidth;for(const u of e){n.moveTo(s,o),n.strokeStyle=u.colour,n.lineTo(s+i,o),n.stroke(),s+=i+t.margin;let l=u.name;u.lastValue&&(l+=" "+u.lastValue.toFixed(t.digitsPrecision));const c=n.measureText(l);n.fillStyle=u.colour,n.fillText(l,s,a),s+=c.width}},Rm=(e,t,r)=>{const{ctx:n,x:i,y:s}=r;!i.showLine||(i.colour&&(n.strokeStyle=i.colour),n.lineWidth=i.lineWidth,n.beginPath(),n.moveTo(0,t),n.lineTo(e,t),n.stroke())},Mm=(e,t,r,n,i)=>{const{ctx:s,lineWidth:o,translucentPlot:a=!1,margin:u,x:l}=n,c=n.style??"connected",d=r.height-u;let h=1;if(l.scaleRange){const w=l.scaleRange[1]-l.scaleRange[0];h=r.width/w}else h=n.capacity===0?r.width/t.length:r.width/n.capacity;const f=n.coalesce&&h<0?Math.floor(1/h):1;let m=0,p;n.debug&&(s.strokeStyle="green",s.strokeRect(0,0,r.width,r.height));const g=w=>a?lt(w,.2):w;c==="dots"?s.fillStyle=g(e.colour):c==="none"||(s.beginPath(),s.lineWidth=o,s.strokeStyle=g(e.colour));for(let w=0;w<t.length;w+=f){const b=Je(t[w],e,d)-1;c==="dots"?(s.beginPath(),s.arc(m,b,o,0,Bm),s.fill()):c==="none"||(w==0&&s.moveTo(m,b),s.lineTo(m,b)),w===i&&(p={x:m,y:b},e.lastValue=t[w]),m+=h}c==="connected"&&s.stroke(),p!==void 0&&n.leadingEdgeDot&&(s.beginPath(),s.fillStyle=g(e.colour),s.arc(p.x,p.y,3,0,2*Math.PI),s.fill())},Je=(e,t,r)=>(1-(e-t.min)/t.range)*r,Vl=(e,t,r,n)=>{let i=e;r.showLabels&&(i+=r.textSize),r.showLine&&(i+=r.lineWidth),(r.showLabels||r.showLine)&&(i+=e+e);const s=e,o=e+e;let a=e+e;return a+=t.showLabels?t.textSize:e,t.showLine&&(a+=t.lineWidth),(t.showLabels||t.showLine)&&(a+=e),n&&(a+=t.textSize),{left:i,right:s,top:o,bottom:a}},ql=(e,t)=>{const{width:r,height:n}=e,i=Vl(t.margin,t.x,t.y,t.showLegend);return{width:r-i.left-i.right,height:n-i.top-i.bottom}},$m=(e,t)=>{const{width:r,height:n}=e,i=Vl(t.margin,t.x,t.y,t.showLegend);return{width:r+i.left+i.right,height:n+i.top+i.bottom}},Im=(e,t)=>{if(e===null)throw new Error("parentElOrQuery is null. Expected string or element");const r=V(e);let n,i=!0,s=t.plotSize,o;r.nodeName==="CANVAS"?(n=r,i=!1,o={width:n.width,height:n.height}):(n=document.createElement("CANVAS"),r.append(n),s=t.plotSize,o={width:n.width,height:n.height});const a={x:0,y:0},u=w=>{a.x=w.offsetX,a.y=w.offsetY};n.addEventListener("pointermove",u);const l=n.getContext("2d"),c=t.capacity??10,d=c>0?Od({capacity:c}):Ud(),h=l.measureText("Xy"),f=t.coalesce??!0;if(l===null)throw new Error("Drawing context not available");let m=pn("x");t.x&&(m={...m,...t.x});let p=pn("y");t.y&&(p={...p,...t.y});let g={...t,y:p,x:m,pointer:a,capacity:c,coalesce:f,plotSize:s,canvasSize:o,ctx:l,textHeight:t.textHeight??h.actualBoundingBoxAscent+h.actualBoundingBoxDescent,style:t.style??"connected",defaultSeriesColour:t.defaultSeriesColour??"yellow",margin:3,clearCanvas:!0,leadingEdgeDot:!0,debug:t.debug??!1,digitsPrecision:t.digitsPrecision??2,lineWidth:t.lineWidth??2,showLegend:t.showLegend??!1};if(s){const w=$m(s,g);n.width=w.width,n.height=w.height,g.canvasSize=w}return t.autoSizeCanvas&&Li(n,w=>{const b=w.bounds;g={...g,plotSize:ql(b,g),canvasSize:b},at(d,g)}),{drawValue:w=>{Ll(w,d,g)},dispose:()=>{n.removeEventListener("pointermove",u),i&&n.remove()},add:(w,b="",j=!1)=>{Il(d,w,b),!j&&at(d,g)},draw:()=>{at(d,g)},clear:()=>{d.clear()}}};try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{SceneGraph:$i,Plot2:Mi,Drawing:Pi,Svg:Cn,Palette:Vi,Colour:$s,Video:Zn}})}catch{}var Lm={};x(Lm,{CanvasHelper:()=>Vm,DataDisplay:()=>Om,DataTable:()=>Ul,DragDrop:()=>Xl,Forms:()=>bo,Rx:()=>kl,Variables:()=>Ol,byId:()=>dp,cardinalPosition:()=>ep,clear:()=>ap,copyToClipboard:()=>up,createAfter:()=>sp,createIn:()=>op,cycleCssClass:()=>np,defaultErrorHandler:()=>Xm,el:()=>Hm,elRequery:()=>Gm,fullSizeCanvas:()=>Em,fullSizeElement:()=>Jl,getTranslation:()=>ip,inlineConsole:()=>Km,insertSorted:()=>lp,log:()=>Kl,parentSize:()=>Ym,parentSizeCanvas:()=>Li,pointScaler:()=>Zl,pointerVisualise:()=>Zm,positionFn:()=>Ql,positionFromMiddle:()=>rp,positionRelative:()=>tp,query:()=>yn,reconcileChildren:()=>cp,resolveEl:()=>V,resolveEls:()=>dt,setCssClass:()=>zl,setCssDisplay:()=>Wl,setCssToggle:()=>jl,setHtml:()=>gu,setProperty:()=>Br,setText:()=>pu,viewportToSpace:()=>ec});var Vm=class extends Pe{el;opts;#e;#t=Ws;#r;constructor(e,t={}){super();if(!e)throw new Error("Param 'domQueryOrEl' is null or undefined");if(this.el=V(e),this.el.nodeName!=="CANVAS")throw new Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);this.opts={fill:t.fill??"none",height:t.height??-1,width:t.width??-1,zIndex:t.zIndex??-1,scaleBy:t.scaleBy??"both",onResize:t.onResize,clearOnResize:t.clearOnResize??!0,draw:t.draw,skipCss:t.skipCss??!1},this.#e=ds("both"),this.#a()}#n(e=!1){if(this.#r===void 0||e){const t=this.ratio,r=this.el.getContext("2d");if(r===null)throw new Error("Could not create drawing context");this.#r=r,r.setTransform(1,0,0,1,0,0),r.scale(t,t)}return this.#r}#i(e){Hd(e,"logicalSize");const t=window.devicePixelRatio||1;this.#e=ds(this.opts.scaleBy,e);const r=Gd(e,t,t);this.el.width=r.width,this.el.height=r.height,this.el.style.width=e.width.toString()+"px",this.el.style.height=e.height.toString()+"px",this.#n(!0),this.opts.clearOnResize&&this.ctx.clearRect(0,0,this.width,this.height),this.#t=e;const n=this.opts.onResize;n&&setTimeout(()=>{n(this.ctx,this.size,this)},100),this.fireEvent("resize",{ctx:this.ctx,size:this.#t,helper:this})}#s(){const e=this.el.parentElement;if(!e)return;const t=e.getBoundingClientRect();this.#i({width:t.width,height:t.height})}#o(){this.#i({width:window.innerWidth,height:window.innerHeight})}#a(){switch(this.opts.fill){case"viewport":{this.opts.skipCss||(this.el.style.position="absolute",this.el.style.left="0px",this.el.style.top="0px",this.el.style.zIndex=this.opts.zIndex.toString()),Tt().onValue(()=>{this.#o()}),this.#o();break}case"parent":{if(!this.el.parentElement)throw new Error("Canvas element has no parent?!");this.opts.skipCss||(this.el.style.position="relative",this.el.style.left="0px",this.el.style.top="0px"),Tt().onValue(()=>{this.#s()}),this.#s();break}case"none":{let{width:t,height:r}=this.el.getBoundingClientRect();this.opts.width>0&&(t=this.opts.width),this.opts.height>0&&(r=this.opts.height);const n={width:t,height:r};this.#i(n);break}default:throw new Error("Unknown 'fill' value. Expecting: 'none', 'viewport' or 'fill'")}const e=this.opts.draw;if(e){const t=()=>{e(this.ctx,this.#t,this),requestAnimationFrame(t)};setTimeout(()=>{t()},100)}}clear(){this.#r&&this.#r.clearRect(0,0,this.width,this.height)}get ctx(){if(this.#r===void 0)throw new Error("Context not available");return this.#n()}get width(){return this.#t.width}get height(){return this.#t.height}get size(){return this.#t}get ratio(){return window.devicePixelRatio||1}get dimensionMin(){return Math.min(this.width,this.height)}get dimensionMax(){return Math.max(this.width,this.height)}get toAbsolute(){return this.#e.abs}get toRelative(){return this.#e.rel}get center(){return{x:this.width/2,y:this.height/2}}},zl=(e,t,r)=>{const n=dt(e);if(n.length!==0)for(const i of n)t?i.classList.add(r):i.classList.remove(r)},jl=(e,t)=>{const r=dt(e);if(r.length!==0)for(const n of r)n.classList.toggle(t)},Wl=(e,t)=>{const r=dt(e);if(r.length!==0)for(const n of r)n.style.display=t},Ol={};x(Ol,{parseAsAttributes:()=>qm,setFromVariables:()=>zm});var qm=e=>e.map(t=>{let r;Array.isArray(t)&&(r=t[1],t=t[0]);const n=t.indexOf("-");if(n<0)throw new Error("Simple expression expects form of: 'elementid-attribute'");return{variable:t,attribute:t.slice(n+1),id:t.slice(0,n),defaultValue:r}}),zm=(e,...t)=>{const r=V(e),n=window.getComputedStyle(r);for(const i of t){const s=fr(i.variable,"--");let o=n.getPropertyValue(`--${s}`);if(o===null||o.length===0){if(i.defaultValue===void 0)continue;o=i.defaultValue}let a,u;if("query"in i&&i.query!==void 0?a=i.query:"id"in i&&i.id!==void 0?a=`#${i.id}`:"element"in i&&i.element!==void 0&&(u=Array.isArray(i.element)?i.element:[i.element]),a===void 0){if(u===void 0)throw new Error("Missing query, id or element")}else u=[...r.querySelectorAll(a)];if(u!==null&&u!==void 0)if(i.attribute)for(const l of u)l.setAttribute(i.attribute,o);else if(i.field)for(const l of u)l[i.field]=o;else throw new Error(`Neither 'attribute' or 'field' to set is defined in option (${JSON.stringify(i)})`)}},Ul={};x(Ul,{fromList:()=>Wm,fromObject:()=>Yl});var Hl=An(Qn(),1),jm=(e,t)=>{if(e===null)return"(null)";if(e===void 0)return"(undefined)";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return`"${e}"`;if(typeof e=="number"){let r=e;return t.roundNumbers!==void 0&&(r=ar(t.roundNumbers,e)),t.precision!==void 0?r.toFixed(t.precision):r.toString()}return typeof e=="object"?Gl(e,t):Hl.default.stringify(e)},Gl=(e,t)=>{let r='<div style="display:grid; grid-template-columns: repeat(2, 1fr)">';for(const n of Object.entries(e)){const i=jm(n[1],t);r+=`<div class="label" style="display:table-cell">${n[0]}</div>
      <div class="data" style="display:table-cell">${i}</div>`}return r+="</div>",r},Wm=(e,t)=>{const r=V(e);let n=document.createElement("DIV");r.append(n);const i=()=>n?(n.remove(),n=void 0,!0):!1,s=o=>{const a=new Set;for(const[l,c]of o){const d=`table-${l}`;a.add(d);let h=r.querySelector(`#${d}`);if(h===null){if(h=document.createElement("table"),!h)throw new Error("Could not create table element");h.id=d,r.append(h)}gn(h,c)}const u=Array.from(r.querySelectorAll("table"));for(const l of u)a.has(l.id)||l.remove()};return t&&s(t),{update:s,remove:i}},gn=(e,t,r={})=>{const n=r.precision??2,i=r.idPrefix??"",s=r.objectsAsTables??!1;if(t===void 0){e.innerHTML="";return}const o=new Set;for(const[u,l]of Object.entries(t)){const c=`${i}-row-${u}`;o.add(c);let d=e.querySelector(`tr[data-key='${c}']`);if(d===null){d=document.createElement("tr"),e.append(d),d.setAttribute("data-key",c);const m=document.createElement("td");m.textContent=u,m.classList.add("label"),d.append(m)}let h=d.querySelector(`td[data-key='${c}-val']`);h===null&&(h=document.createElement("td"),h.classList.add("data"),h.setAttribute("data-key",`${c}-val`),d.append(h));let f;r.formatter&&(f=r.formatter(l,u)),f===void 0&&(typeof l=="object"?f=s?Gl(l,r):Hl.default.stringify(l):typeof l=="number"?f=r.roundNumbers?Math.round(l).toString():l.toFixed(n):typeof l=="boolean"?f=l?"true":"false":typeof l=="string"?f=`"${l}"`:f=JSON.stringify(l)),h.innerHTML=f}const a=Array.from(e.querySelectorAll("tr"));for(const u of a){const l=u.getAttribute("data-key");o.has(l)||u.remove()}},Yl=(e,t,r)=>{const n=V(e),i=r?.idPrefix??Math.floor(Math.random()*1e3).toString();let s=document.createElement("table");n.append(s);const o=()=>s?(s.remove(),s=void 0,!0):!1;return t&&gn(s,t,r),{remove:o,update:u=>{if(!s)throw new Error("Table disposed");gn(s,u,{...r,idPrefix:i})}}},Om=class{dataTable;constructor(e={}){const t=e.theme??"dark";if(document.querySelector("#ixfx-data-display")!==null)throw new Error("DataDisplay already loaded on this page");const n=document.createElement("div");n.id="ixfx-data-display",n.classList.add(`theme-${t}`);const i=document.createElement("style");i.textContent=`
    #ixfx-data-display {
      background: white;
      color: black;
      border: 2px solid hsl(0deg 0.61% 90%);
      border-radius: 4px;
      z-index: 1000;
      opacity: 40%;
      padding: 1em;
      font-family: monospace;
      position: fixed;
      right: 1em;
      top: 1em;
    }
    #ixfx-data-display.theme-dark {
      background: black;
      color: white;
      border: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display:hover {
      opacity: 100%;
    }
    #ixfx-data-display table {
      border-collapse: collapse;
    }
    #ixfx-data-display tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 90%);
    }
    #ixfx-data-display.dark tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display td {
      padding-bottom: 0.4em;
      padding-top: 0.4em;
    }
    #ixfx-data-display .label {
      color: hsl(0deg 0.61% 60%);
      text-align: right;
      padding-right: 0.5em;
    }
    #ixfx-data-display.theme-dark .label {
      color: gray;
    }
    `,n.style.display="inline-block",document.body.append(i),document.body.append(n),this.dataTable=Yl(n,void 0,{objectsAsTables:!0,roundNumbers:2})}update(e){this.dataTable.update(e)}},Xl={};x(Xl,{draggable:()=>Um});var Um=(e,t)=>{let r=C.Placeholder,n;const i=()=>{e.classList.contains("drag-sel")&&e.classList.remove("drag-sel")},s=d=>{e.classList.contains("drag-sel")?e.classList.remove("drag-sel"):e.classList.add("drag-sel"),d.stopPropagation()};e.ownerDocument.addEventListener("click",i),e.addEventListener("click",s);const o=()=>{e.classList.remove("drag-progress"),e.ownerDocument.removeEventListener("pointermove",u),e.ownerDocument.removeEventListener("pointerup",l),e.ownerDocument.removeEventListener("pointercancel",c)},a=()=>{console.log("drag dispose"),e.classList.contains("drag-progress")?c(void 0,"dispose"):o(),e.ownerDocument.removeEventListener("click",i),e.removeEventListener("click",s)},u=d=>{d.preventDefault(),d.stopPropagation();const f={delta:C.isPlaceholder(r)?{x:d.offsetX,y:d.offsetY}:{x:d.x-r.x,y:d.y-r.y},initial:r,token:n};typeof t.progress<"u"&&!t.progress(f)&&c(void 0,"discontinued")},l=d=>{o();const h={x:d.x-r.x,y:d.y-r.y},f={initial:r,token:n,delta:h};typeof t.success<"u"&&t.success(f)},c=(d,h="pointercancel")=>{o();const f={token:n,initial:r,delta:{x:-1,y:-1}};typeof t.abort<"u"&&t.abort(h,f)};return e.addEventListener("pointerdown",d=>{if(!e.classList.contains("drag-sel"))return;r={x:d.x,y:d.y};const f=typeof t.start>"u"?{allow:!0,token:n}:t.start();!f.allow||(n=f.token,e.classList.add("drag-progress"),e.ownerDocument.addEventListener("pointermove",u),e.ownerDocument.addEventListener("pointerup",l),e.ownerDocument.addEventListener("pointercancel",c))}),a},Hm=e=>{const t=dt(e),r=pu(t),n=gu(t);return{text:r,html:n,cssDisplay:i=>{Wl(t,i)},cssClass:(i,s)=>{zl(t,i,s)},cssToggle:i=>{jl(t,i)},el:()=>t[0],els:()=>t}},Gm=e=>{},Jl=(e,t)=>{const r=V(e),n=Tt(),i=()=>{const s=window.innerWidth,o=window.innerHeight;if(r.setAttribute("width",s.toString()),r.setAttribute("height",o.toString()),t!==void 0){const a={min:Math.min(s,o),max:Math.max(s,o),width:s,height:o,center:{x:s/2,y:o/2}};t({el:r,bounds:a})}};return n.onValue(i),i(),n},Ym=(e,t,r=100)=>{const n=V(e),i=n.parentElement;if(i===null)throw new Error("Element has no parent");return Ii(i,r).onValue(o=>{const a=o.find(c=>c.target===i);if(a===void 0)return;const u=a.contentRect.width,l=a.contentRect.height;if(n.setAttribute("width",`${u}px`),n.setAttribute("height",`${l}px`),t!==void 0){const c={min:Math.min(u,l),max:Math.max(u,l),width:u,height:l,center:{x:u/2,y:l/2}};t({el:n,bounds:c})}})},Xm=()=>{let e=!0;const t=document.createElement("div");t.style.color="black",t.style.border="2px solid red",t.style.backgroundColor="hsl(0, 80%, 90%)",t.style.padding="1em",t.style.display="none",t.style.top="1em",t.style.left="1em",t.style.position="absolute",t.style.fontFamily="monospace";const r=document.createElement("div");r.style.maxWidth="50vw",r.style.maxHeight="50vh",r.style.overflowY="scroll",t.innerHTML="<h1>Error</h1>",t.append(r);const n=u=>{u.style.padding="0.3em",u.style.marginTop="1em"},i=document.createElement("button");i.textContent="Close",i.addEventListener("click",()=>{a()});const s=document.createElement("button");s.textContent="Stop displaying errors",s.addEventListener("click",()=>{e=!1,a()}),n(i),n(s),t.append(i),t.append(s),document.body.append(t);const o=u=>{t.style.display="inline",r.innerHTML+=u.stack?`<pre>${u.stack}</pre>`:`<p>${me(u)}</p>`},a=()=>{t.style.display="none"};return window.onerror=(u,l,c,d,h)=>{e&&(h?(console.log(h),o(h)):(console.log(u),o(u)))},window.addEventListener("unhandledrejection",u=>{console.log(u.reason),e&&o(u.reason)}),{show:o,hide:a}},Jm=(e,t)=>{const r=document.createElement("style");r.textContent=t;let n;return e.shadowRoot?(n=e.shadowRoot,n.innerHTML=""):n=e.attachShadow({mode:"open"}),n.append(r),n},Kl=(e,t={})=>{const{capacity:r=0,monospaced:n=!0,timestamp:i=!1,collapseDuplicates:s=!0,css:o=""}=t;let a=0,u,l=0;const c=V(e),h=Jm(c,`
  .log {
    font-family: ${n?'Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", Monaco, "Courier New", Courier, monospace':"normal"};
    background-color: var(--code-background-color);
    padding: var(--padding1, 0.2em);
    overflow-y: auto;
    height:100%;
  }
  .timestamp {
    margin-right: 0.5em;
    opacity: 0.5;
    font-size: 70%;
    align-self: center;
  }
  .line {
    display: flex;
    padding-bottom: 0.1em;
    padding-top: 0.1em;
  }
  .line:hover {
  
  }
  .error {
    color: red;
  }
  .badge {
    border: 1px solid currentColor;
    align-self: center;
    font-size: 70%;
    padding-left: 0.2em;
    padding-right: 0.2em;
    border-radius: 1em;
    margin-left: 0.5em;
    margin-right: 0.5em;
  }
  .msg {
    flex: 1;
    word-break: break-word;
  }
  ${o}
  `),f=document.createElement("div");f.className="log",h.append(f);const m=S=>{const T=document.createElement("div");if(typeof S=="string")T.innerHTML=S;else if(S instanceof Error){const oe=S.stack;T.innerHTML=oe===void 0?S.toString():oe.toString()}else T.innerHTML=S;T.classList.add("error"),b(T),u=void 0,l=0};let p=0;const g=(S="")=>{const T=w(S);return T&&(T.classList.add("warning"),T)},w=(S="")=>{let T;const oe=window.performance.now()-p;if(!(t.minIntervalMs&&oe<t.minIntervalMs))if(p=window.performance.now(),typeof S=="object"?T=JSON.stringify(S):S===void 0?T="(undefined)":S===null?T="(null)":typeof S=="number"?(Number.isNaN(T)&&(T="(NaN)"),T=S.toString()):T=S,T.length===0){const Z=document.createElement("hr");u=void 0,b(Z)}else if(T===u&&s){const Z=f.firstElementChild;let k=Z.querySelector(".badge");return k===null&&(k=document.createElement("div"),k.className="badge",Z.insertAdjacentElement("beforeend",k)),Z!==null&&(k.textContent=(++l).toString()),Z}else{const Z=document.createElement("div");return Z.textContent=T,b(Z),u=T,Z}},b=S=>{if(i){const T=document.createElement("div"),oe=document.createElement("div");oe.className="timestamp",oe.textContent=new Date().toLocaleTimeString(),T.append(oe,S),S.classList.add("msg"),T.classList.add("line"),S=T}else S.classList.add("line","msg");if(t.reverse?f.append(S):f.insertBefore(S,f.firstChild),r>0&&++a>r*2)for(;a>r;)f.lastChild?.remove(),a--;t.reverse&&(f.scrollTop=f.scrollHeight),l=0};return{error:m,log:w,warn:g,append:b,clear:()=>{f.innerHTML="",u=void 0,l=0,a=0},dispose:()=>{f.remove()},get isEmpty(){return a===0}}},Km=(e={})=>{const t={log:console.log,error:console.error,warn:console.warn},r=document.createElement("DIV");r.id="ixfx-log",r.style.position="fixed",r.style.left="0px",r.style.top="0px",r.style.pointerEvents="none",r.style.display="none",document.body.prepend(r);const n=Kl(r,e),i=s=>{r.style.display=s?"block":"none"};console.error=(s,...o)=>{n.error(s),o.length>0&&n.error(o),t.error(s,...o),i(!0)},console.warn=(s,...o)=>{n.warn(s),o.length>0&&n.warn(o),i(!0)},console.log=(s,...o)=>{n.log(s),o.length>0&&n.log(o),t.log(s,...o),i(!0)},window.onerror=(s,o,a,u,l)=>{const c=o===void 0?"":fr(o,"/",{fromEnd:!0}),d=me(l);n.error(d+` (${c}:${a})`),i(!0)}},Zm=(e,t={})=>{const r=t.touchRadius??45,n=t.touchRadius??20,i=t.trace??!1,s=t.hue??100,o=`hsla(${s}, 100%, 10%, 10%)`;let a=s;const u=V(e),l=Xu({storeIntermediate:i}),c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.id="pointerVis",c.style.zIndex="-1000",c.style.position="fixed",c.style.top="0",c.style.left="0",c.style.width="100%",c.style.height="100%",c.style.boxSizing="border-box",c.style.border="3px solid red",c.style.pointerEvents="none",c.style.touchAction="none",Jl(c);let d=0;const h=m=>{const p=m.pointerId.toString();l.delete(p),a=s,c.querySelector(`#pv-start-${p}`)?.remove();for(let g=0;g<d+10;g++)c.querySelector(`#pv-progress-${p}-${g}`)?.remove();d=0},f=async m=>{const p=m.pointerId.toString(),g={x:m.x,y:m.y},w=m.pointerType;if(m.type==="pointermove"&&!l.has(p))return;const b=await l.seen(m.pointerId.toString(),{x:m.clientX,y:m.clientY});if(b.values.length===1){const S=Qt.circle({...b.values[0],radius:w==="touch"?r:n},c,{fillStyle:o},`#pv-start-${p}`);S.style.pointerEvents="none",S.style.touchAction="none"}const j=`hsla(${a}, 100%, 50%, 50%)`,G=Qt.circle({...g,radius:w==="touch"?r:n},c,{fillStyle:j},`#pv-progress-${p}-${b.values.length}`);G.style.pointerEvents="none",G.style.touchAction="none",a+=1,d=b.values.length};document.body.append(c),u.addEventListener("pointerdown",f),u.addEventListener("pointermove",f),u.addEventListener("pointerup",h),u.addEventListener("pointerleave",h),u.addEventListener("contextmenu",m=>{m.preventDefault()})};async function*yn(e,t={}){if(typeof e=="string")return yn([e],t);if(typeof e=="object"&&"nodeName"in e)return yn([e],t);const n=t??!1?rl():i=>!0;if(Array.isArray(e))for(const i of e)if(typeof i=="string")for(const s of document.querySelectorAll(i)){const o=s;n(o)&&(yield o)}else n(i)&&(yield i);else for await(const i of e)if(typeof i=="string")for(const s of document.querySelectorAll(i))n(s)&&(yield s);else n(i)&&(yield i)}var Qm=An(Qn(),1),Zl=(e="viewport")=>{switch(e){case"viewport":return(t,r)=>{const n=st(t,r);return Object.freeze({x:n.x/window.innerWidth,y:n.y/window.innerHeight})};case"screen":return(t,r)=>{const n=st(t,r);return Object.freeze({x:n.x/screen.width,y:n.y/screen.height})};case"document":return(t,r)=>{const n=st(t,r);return Object.freeze({x:n.x/document.body.scrollWidth,y:n.y/document.body.scrollHeight})};default:throw new Error(`Unknown 'reference' parameter: ${JSON.stringify(e)}`)}},Ql=(e,t={})=>{const r=t.target??"viewport",n=t.relative??!1,i=t.anchor??"nw",s=V(e),o=ec(r);if(n){const a=Zl(r);return()=>a(o(Qr(s.getBoundingClientRect(),i)))}else return()=>o(Qr(s.getBoundingClientRect(),i))},ep=(e,t="nw")=>{const r=V(e);return Qr(r.getBoundingClientRect(),t)},tp=(e,t="viewport")=>Ql(e,{relative:!0,target:t})(),ec=(e="viewport")=>{switch(e){case"screen":return(t,r)=>{const n=st(t,r);return Object.freeze({x:n.x+window.screenX,y:n.y+window.screenY})};case"document":return(t,r)=>{const n=st(t,r);return Object.freeze({x:n.x+window.scrollX,y:n.y+window.scrollY})};case"viewport":return(t,r)=>{const n=st(t,r);return Object.freeze({x:n.x,y:n.y})};default:throw new Error(`Unexpected target coordinate space: ${e}. Expected: viewport, document or screen`)}},rp=(e,t,r="window")=>{if(!e)throw new Error("domQueryOrEl is null or undefined");const n=V(e),i=Yd(t,window.innerWidth,window.innerHeight),s=n.getBoundingClientRect(),o=Yt(i,s.width/2,s.height/2);n.style.transform=`translate(${o.x}px, ${o.y}px)`},np=(e,t)=>{if(!(e===null||!e)){if(!Array.isArray(t))throw new TypeError("List should be an array of strings");for(let r=0;r<t.length;r++)if(e.classList.contains(t[r])){e.classList.remove(t[r]),r+1<t.length?e.classList.add(t[r+1]):e.classList.add(t[0]);return}e.classList.add(t[0])}},ip=e=>{const t=V(e),n=window.getComputedStyle(t).transform;if(n==="none"||typeof n>"u")return{x:0,y:0,z:0};const i=n.includes("3d")?"3d":"2d",s=n.match(/matrix.*\((.+)\)/)[1].split(", ");return i==="2d"?{x:Number.parseFloat(s[4]),y:Number.parseFloat(s[5]),z:0}:i==="3d"?{x:Number.parseFloat(s[12]),y:Number.parseFloat(s[13]),z:Number.parseFloat(s[14])}:{x:0,y:0,z:0}},sp=(e,t)=>{const r=document.createElement(t);return e.parentElement?.insertBefore(r,e.nextSibling),r},op=(e,t)=>{const r=document.createElement(t);return e.append(r),r},ap=e=>{let t=e.lastElementChild;for(;t;)t.remove(),t=e.lastElementChild},up=e=>new Promise((r,n)=>{const i=Qm.default.stringify(e);navigator.clipboard.writeText(JSON.stringify(i)).then(()=>{r(!0)},s=>{console.warn("Could not copy to clipboard"),console.log(i),n(new Error(s))})}),lp=(e,t)=>{const r=t.getAttribute("data-sort")??"";let n,i;for(const s of e.children){const o=s.getAttribute("data-sort")??"";if(r>=o&&(n=s),r<=o&&(i=s),n!==void 0&&i!==void 0)break}n!==void 0?n.insertAdjacentElement("afterend",t):i===void 0?e.append(t):i.insertAdjacentElement("beforebegin",t)},cp=(e,t,r)=>{if(e===null)throw new Error("parentEl is null");if(e===void 0)throw new Error("parentEl is undefined");const n=new Set;for(const[s,o]of t){const a=`c-${s}`,u=e.querySelector(`#${a}`),l=r(o,u);u!==l&&(l.id=a,e.append(l)),n.add(a)}const i=[];for(const s of e.children)n.has(s.id)||i.push(s);for(const s of i)s.remove()},dp=e=>{const t=document.getElementById(e);if(t===null)throw new Error(`HTML element with id '${e}' not found`);return t};function fp(e,t={}){const r=zi(e,t),n=r.el,i=t.relative??!1,s=t.inverted??!1,o=Me(r,u=>Number.parseFloat(u));return i&&(n.max=s?"0":"1",n.min=s?"1":"0",n.hasAttribute("step")||(n.step="0.1")),n.type="range",{...o,last(){return Number.parseFloat(r.last())},set:u=>{r.set(u.toString())}}}function hp(e,t={}){const r=zi(e,{...t,upstreamFilter(i){return typeof i=="object"?cl.Colour.toHex(i):i}});return{...Me(r,i=>fs(i)),last(){return fs(r.last())},set(i){r.set(Xd(i))}}}function zi(e,t={}){const r=typeof e=="string"?document.querySelector(e):e;if(r===null&&typeof e=="string")throw new Error(`Element query could not be resolved '${e}'`);if(r===null)throw new Error("targetOrQuery is null");const n=V(e),s=(t.when??"changed")==="changed"?"change":"input",o=t.emitInitialValue??!1,a=t.fallbackValue??"",u=t.upstreamSource;let l=()=>{},c=t.attributeName,d=t.fieldName;d===void 0&&c===void 0&&(c=d="value");const h=()=>{let w;return c&&(w=n.getAttribute(c)),d&&(w=n[d]),w==null&&(w=a),w},f=w=>{c&&n.setAttribute(c,w),d&&(n[d]=w)},m=w=>{w=t.upstreamFilter?t.upstreamFilter(w):w,f(w)};u&&(l=u.onValue(m),ft(u)&&m(u.last()));const p=Iu(n,s,{fireInitial:o,debugFiring:t.debugFiring??!1,debugLifecycle:t.debugLifecycle??!1}),g=Me(p,w=>h());return{...g,el:n,last(){return h()},set(w){f(w)},dispose(w){l(),g.dispose(w),p.dispose(w)}}}function vp(e,t,r={}){const n=r.closeOnError??!0,i=r.lazy??"initial",s=new AbortController,o=h=>{s.abort(h)};let a;r.signal&&r.signal.addEventListener("abort",h=>{c(`Signal received (${r.signal?.reason})`)});const u=ce({onFirstSubscribe(){i!=="never"&&a===void 0&&l()},onNoSubscribers(){i==="very"&&a!==void 0&&(a(),a=void 0)}}),l=()=>{a=e.on(h=>{Ae(h)?c("Upstream closed"):Rt(h)?u.signal(h.signal):se(h)&&d(h.value)})},c=h=>{u.dispose(h),a&&a()},d=async h=>{try{const f=await t(h,o);if(u.set(f),s.signal.aborted)return c(`callback function aborted (${s.signal.reason})`),!1}catch(f){if(n)return c(`Function error: ${me(f)}`),!1;u.signal("warn",me(f))}};return i==="never"&&l(),u}function mp(e){let t=e;const r=ce(),n=i=>{t=i,r.set(i)};return{dispose:r.dispose,isDisposed:r.isDisposed,last:()=>t,on:r.on,onValue:r.onValue,set:n}}var tc=e=>{const t=Mt(e);return{proxy:new Proxy(e,{set(n,i,s,o){const a=Array.isArray(n);if(a&&i==="length")return!0;if(typeof i=="string"&&t.updateField(i,s),a&&typeof i=="string"){const u=Number.parseInt(i);if(!Number.isNaN(u))return n[u]=s,!0}return n[i]=s,!0}}),rx:t}},pp=e=>{const{proxy:t,rx:r}=tc(e),n=t;return n[Bu]=r,n};function gp(e){const t=rc(e);return{dispose:t.dispose,isDisposed:t.isDisposed,on:t.on,onValue:t.onValue}}function rc(e){let t=()=>{};const r=nc({onFirstSubscribe(){t=e(r)},onNoSubscribers(){t&&t()}});return{...r,onValue:n=>r.on(i=>{se(i)&&n(i.value)})}}function yp(e){let t=e;const r=ce(),n=i=>{t=i,r.set(i)};return{dispose:r.dispose,isDisposed:r.isDisposed,last:()=>t,on:r.on,onValue:r.onValue,set:n}}function nc(e={}){const t=ce(e);return{dispose:t.dispose,isDisposed:t.isDisposed,set(r){t.set(r)},on:t.on,onValue:t.onValue}}var wp={setHtmlText:e=>t=>{xi(t,e)}},ji={annotate:e=>ve(ii,e),annotateWithOp:e=>ve(su,e),batch:e=>t=>si(t,e),cloneFromFields:()=>e=>ou(e),combineLatestToArray:(e={})=>t=>oi(t,e),combineLatestToObject:(e={})=>t=>xr(t,e),debounce:e=>t=>ci(t,e),elapsed:()=>ve(cu),field:(e,t)=>r=>Fr(r,e,t),filter:e=>ve(di,e),min:e=>ve(hi,e),max:e=>ve(fi,e),sum:e=>ve(mi,e),average:e=>ve(vi,e),tally:e=>ve(pi,e),rank:(e,t)=>ve(du,e,t),pipe:(...e)=>t=>{const n=[Y(t),...e];return fu(...n)},singleFromArray:(e={})=>t=>hu(t,e),split:(e={})=>t=>gi(t,e),splitLabelled:e=>t=>yi(t,e),switcher:(e,t={})=>r=>wi(r,e,t),syncToArray:(e={})=>t=>Sr(t,e),syncToObject:(e={})=>t=>kr(t,e),tapProcess:e=>t=>Di(t,e),tapStream:e=>t=>Ei(t,e),tapOps:(...e)=>t=>bi(t,...e),throttle:e=>ve(Ai,e),timeoutTrigger:e=>t=>Ci(t,e),transform:(e,t={})=>r=>Me(r,e,t),withValue:e=>ve(mu,e)};function Dp(e,t){let r=t;return e.onValue(n=>{r=n}),{...e,last(){return r},reset(){r=void 0}}}async function Ep(e,t=1e3){const r=Y(e);let n=()=>{},i;return new Promise((o,a)=>{n=r.on(u=>{i&&clearTimeout(i),se(u)?(n(),o(u.value)):Ae(u)&&(a(new Error(`Source closed. ${u.context??""}`)),n())}),i=setTimeout(()=>{i=void 0,n(),a(new Error(`Timeout waiting for value (${JSON.stringify(t)})`))},N(t))})}var bp=(e,t,r,n=!1)=>{const i=e.on(s=>{if(se(s)){const o=r?r(s.value):s.value;t.set(o)}else Ae(s)?(i(),n&&t.dispose(`Source closed (${s.context??""})`)):console.warn(`Unsupported message: ${JSON.stringify(s)}`)});return i},ic=function(e=.1,t,r,n,i){return t===void 0&&(t=0),r===void 0&&(r=1),n===void 0&&(n=t),M(e,"bipolar","interval"),M(r,"bipolar","end"),M(n,"bipolar","offset"),M(t,"bipolar","start"),Wi(e,t,r,n,i)},Wi=function*(e,t,r,n,i){if(t===void 0)throw new Error("Parameter 'lower' is undefined");if(e===void 0)throw new Error("Parameter 'interval' is undefined");if(r===void 0)throw new Error("Parameter 'upper' is undefined");if(i===void 0&&e<=1&&e>=0?i=10/e:i===void 0&&(i=1234),Number.isNaN(e))throw new Error("interval parameter is NaN");if(Number.isNaN(t))throw new Error("lower parameter is NaN");if(Number.isNaN(r))throw new Error("upper parameter is NaN");if(Number.isNaN(n))throw new Error("upper parameter is NaN");if(t>=r)throw new Error("lower must be less than upper");if(e===0)throw new Error("Interval cannot be zero");const s=r-t;if(Math.abs(e)>=s)throw new Error(`Interval should be between -${s} and ${s}`);let o=e>0;if(r=Math.floor(r*i),t=Math.floor(t*i),e=Math.floor(Math.abs(e*i)),e===0)throw new Error(`Interval is zero (rounding: ${i})`);if(n=n===void 0?t:Math.floor(n*i),n>r||n<t)throw new Error(`Start (${n/i}) must be within lower (${t/i}) and upper (${r/i})`);let a=n;yield a/i;let u=!0;for(;;)a=a+(o?e:-e),o&&a>=r?(o=!1,a=r,a===r&&u&&(a=t,o=!0)):!o&&a<=t&&(o=!0,a=t,a===t&&u&&(a=r,o=!1)),yield a/i,u=!1},sc=e=>{const{relative:t,absolute:r}=e,n=e.clamped??!1,i=e.source??dr;if(r!==void 0)return s=>{const o=i()*r*2-r,a=s+o;return n?Ee(a,0,s):a};if(t!==void 0)return s=>{const o=s*t,a=i()*o*2-o,u=s+a;return n?Ee(u,0,s):u};throw new Error("Either absolute or relative fields expected")},oc=(e={})=>{const t=e.clamped??!0;let r=i=>0;if(e.absolute!==void 0){M(e.absolute,t?"percentage":"bipolar","opts.absolute");const i=mr({min:-e.absolute,max:e.absolute,source:e.source});r=s=>s+i()}else{if(e.relative===void 0)throw new TypeError("Either absolute or relative jitter amount is required.");{const i=e.relative??.1;M(i,t?"percentage":"bipolar","opts.relative"),r=s=>s+lo({min:-Math.abs(i*s),max:Math.abs(i*s),source:e.source})}}return i=>{M(i,t?"percentage":"bipolar","value");let s=r(i);return t&&(s=Ee(s)),s}},Ap={};x(Ap,{Easings:()=>Tn,Envelopes:()=>Oi,Forces:()=>Hi,Oscillators:()=>Xi,adsr:()=>Ui,adsrIterable:()=>uc,defaultAdsrOpts:()=>ac,jitter:()=>oc,jitterAbsolute:()=>sc,perMinute:()=>Yp,perSecond:()=>pc,pingPong:()=>Wi,pingPongPercent:()=>ic});var Oi={};x(Oi,{adsr:()=>Ui,adsrIterable:()=>uc,defaultAdsrOpts:()=>ac});var ac=()=>({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1}),Cp=Object.freeze({attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null}),xp=class extends Pe{#e;#t;#r;#n;#i;attackDuration;decayDuration;releaseDuration;decayDurationTotal;shouldLoop;constructor(e){super();this.attackDuration=e.attackDuration??300,this.decayDuration=e.decayDuration??500,this.releaseDuration=e.releaseDuration??1e3,this.shouldLoop=e.shouldLoop??!1,this.#e=new gr(Cp,{initial:"attack"}),this.#e.addEventListener("change",t=>{t.newState==="release"&&this.#i&&this.#r?.reset(),super.fireEvent("change",t)}),this.#e.addEventListener("stop",t=>{super.fireEvent("complete",t)}),this.#t=Re,this.#n=this.#i=!1,this.decayDurationTotal=this.attackDuration+this.decayDuration}switchState(){if(this.#r===void 0)return!1;let e=this.#r.elapsed;const t=this.#i&&!this.#n;let r=!1;do switch(r=!1,this.#e.state){case"attack":{(e>this.attackDuration||t)&&(this.#e.next(),r=!0);break}case"decay":{(e>this.decayDurationTotal||t)&&(this.#e.next(),r=!0);break}case"sustain":{(!this.#n||t)&&(e=0,this.#e.next(),this.#r.reset(),r=!0);break}case"release":{e>this.releaseDuration&&(this.#e.next(),r=!0);break}case"complete":this.shouldLoop&&this.trigger(this.#i)}while(r);return r}computeRaw(e=!0){if(this.#r===void 0)return[void 0,0,this.#e.state];e&&this.switchState();const t=this.#e.state,r=this.#r.elapsed;let n=0;const i=this.#e.state;switch(i){case"attack":{n=r/this.attackDuration;break}case"decay":{n=(r-this.attackDuration)/this.decayDuration;break}case"sustain":{n=1;break}case"release":{n=Math.min(r/this.releaseDuration,1);break}case"complete":return[void 0,1,t];default:throw new Error(`State machine in unknown state: ${i}`)}return[i,n,t]}get isDone(){return this.#e.isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),this.#e.reset(),this.#r=this.#t(),this.#n=e,this.#i=e}compute(){}release(){this.isDone||!this.#i||(this.#n=!1,this.compute())}},Fp=class extends xp{attackPath;decayPath;releasePath;initialLevel;peakLevel;releaseLevel;sustainLevel;attackBend;decayBend;releaseBend;initialLevelOverride;retrigger;releasedAt;constructor(e){super(e);this.initialLevel=e.initialLevel??0,this.peakLevel=e.peakLevel??1,this.releaseLevel=e.releaseLevel??0,this.sustainLevel=e.sustainLevel??.75,this.retrigger=e.retrigger??!0,this.attackBend=e.attackBend??0,this.releaseBend=e.releaseBend??0,this.decayBend=e.decayBend??0;const t=1;this.attackPath=Hr(Gr({x:0,y:this.initialLevel},{x:t,y:this.peakLevel},-this.attackBend)),this.decayPath=Hr(Gr({x:0,y:this.peakLevel},{x:t,y:this.sustainLevel},-this.decayBend)),this.releasePath=Hr(Gr({x:0,y:this.sustainLevel},{x:t,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){const[e,t,r]=this.compute();!Number.isNaN(t)&&t>0&&(this.initialLevelOverride=t)}}get value(){return this.compute(!0)[1]}compute(e=!0){const[t,r]=super.computeRaw(e);if(t===void 0)return[void 0,Number.NaN,Number.NaN];let n;switch(t){case"attack":{n=this.attackPath.interpolate(r).y,this.initialLevelOverride!==void 0&&(n=ut(n,0,1,this.initialLevelOverride,1)),this.releasedAt=n;break}case"decay":{n=this.decayPath.interpolate(r).y,this.releasedAt=n;break}case"sustain":{n=this.sustainLevel,this.releasedAt=n;break}case"release":{n=this.releasePath.interpolate(r).y,this.releasedAt!==void 0&&(n=ut(n,0,this.sustainLevel,0,this.releasedAt));break}case"complete":{n=this.releaseLevel,this.releasedAt=void 0;break}default:throw new Error(`Unknown state: ${t}`)}return[t,n,r]}},Ui=e=>new Fp(e);async function*uc(e){const t=Ui(e.env),r=e.sampleRateMs??100;t.trigger();for await(const n of Po(()=>{if(!t.isDone)return t.value},{fixed:r,signal:e.signal}))yield n}var Hi={};x(Hi,{accelerationForce:()=>Pp,angleFromAccelerationForce:()=>dc,angleFromVelocityForce:()=>fc,angularForce:()=>cc,apply:()=>_p,attractionForce:()=>Bp,computeAccelerationToTarget:()=>hc,computeAttractionForce:()=>lc,computePositionFromAngle:()=>vc,computePositionFromVelocity:()=>Yi,computeVelocity:()=>Gi,constrainBounce:()=>kp,guard:()=>Sp,magnitudeForce:()=>Np,nullForce:()=>Rp,orientationForce:()=>qp,pendulumForce:()=>Ip,springForce:()=>$p,targetForce:()=>Tp,velocityForce:()=>Mp});var Sp=(e,t="t")=>{if(e===void 0)throw new Error(`Parameter ${t} is undefined. Expected ForceAffected`);if(e===null)throw new Error(`Parameter ${t} is null. Expected ForceAffected`);if(typeof e!="object")throw new TypeError(`Parameter ${t} is type ${typeof e}. Expected object of shape ForceAffected`)},kp=(e,t=1)=>{e||(e={width:1,height:1});const r=ms(e,"left"),n=ms(e,"right"),i=ps(e,"top"),s=ps(e,"bottom");return o=>{const a=Yi(o.position??C.Empty,o.velocity??C.Empty);let u=o.velocity??C.Empty,{x:l,y:c}=a;return l>n?(l=n,u=C.invert(C.multiply(u,t),"x")):l<r&&(l=r,u=C.invert(C.multiply(u,t),"x")),c>s?(c=s,u=C.multiply(C.invert(u,"y"),t)):a.y<i&&(c=i,u=C.invert(C.multiply(u,t),"y")),Object.freeze({...o,position:{x:l,y:c},velocity:u})}},Bp=(e,t,r={})=>n=>{let i=n.acceleration??C.Empty;for(const s of e){if(s===n)continue;const o=lc(s,n,t,r);i=C.sum(i,o)}return{...n,acceleration:i}},lc=(e,t,r,n={})=>{if(e.position===void 0)throw new Error("attractor.position not set");if(t.position===void 0)throw new Error("attractee.position not set");const i=n.min??.01,s=n.max??.7,o=C.normalise(C.subtract(e.position,t.position)),a=Ee(C.distance(o),i,s);return C.multiply(o,r*(e.mass??1)*(t.mass??1)/(a*a))},Tp=(e,t={})=>n=>{const i=hc(e,n.position??{x:.5,y:.5},t);return{...n,acceleration:C.sum(n.acceleration??C.Empty,i)}},_p=(e,...t)=>{if(e===void 0)throw new Error("t parameter is undefined");for(const s of t)s!=null&&(e=typeof s=="function"?s(e):{...e,acceleration:C.sum(e.acceleration??C.Empty,s)});const r=Gi(e.acceleration??C.Empty,e.velocity??C.Empty),n=Yi(e.position??C.Empty,r);return{...e,position:n,velocity:r,acceleration:C.Empty}},Pp=(e,t="ignored")=>r=>Object.freeze({...r,acceleration:Mr(e,r,t)}),Mr=(e,t,r="ignored")=>{let n;switch(r){case"dampen":{n=i=>nf(e,i,i);break}case"multiply":{n=i=>C.multiply(e,i,i);break}case"ignored":{n=i=>e;break}default:throw new Error(`Unknown 'mass' parameter '${r}. Expected 'dampen', 'multiply' or 'ignored'`)}return C.sum(t.acceleration??C.Empty,n(t.mass??1))},Np=(e,t="ignored")=>r=>{if(r.velocity===void 0)return r;const n=C.distance(C.normalise(r.velocity)),i=e*n*n,s=C.multiply(C.invert(r.velocity),i);return Object.freeze({...r,acceleration:Mr(s,r,t)})},Rp=e=>e,Mp=(e,t)=>{const r=C.pipeline(C.invert,n=>C.multiply(n,e));return n=>{if(n.velocity===void 0)return n;const i=r(n.velocity);return Object.freeze({...n,acceleration:Mr(i,n,t)})}},cc=()=>e=>{const t=e.angularAcceleration??0,r=e.angularVelocity??0,n=e.angle??0,i=r+t,s=n+i;return Object.freeze({...e,angle:s,angularVelocity:i,angularAcceleration:0})},dc=(e=20)=>t=>{const r=t.acceleration??C.Empty;return Object.freeze({...t,angularAcceleration:r.x*e})},fc=(e=1)=>t=>{const r=C.angle(t.velocity??C.Empty);return Object.freeze({...t,angle:e<1?po(e,t.angle??0,r):r})},$p=(e,t=.5,r=2e-4,n=.999)=>i=>{const s=C.subtract(i.position??C.Empty,e),o=C.distance(s),a=Math.abs(t-o),u=C.pipelineApply(s,C.normalise,h=>C.multiply(h,-r*a)),l=Mr(u,i,"dampen"),c=Gi(l??C.Empty,i.velocity??C.Empty),d=C.multiply(c,n,n);return{...i,velocity:d,acceleration:C.Empty}},Ip=(e,t={})=>r=>{e||(e={x:0,y:0});const n=t.length??C.distance(e,r.position??C.Empty),i=t.speed??.001,s=t.damping??.995;let o=r.angle;o===void 0&&(r.position?o=C.angle(e,r.position)-Math.PI/2:o=0);const a=-1*i/n*Math.sin(o),u=(r.angularVelocity??0)+a;return o+=u,Object.freeze({angularVelocity:u*s,angle:o,position:vc(n,o+Math.PI/2,e)})},Gi=(e,t,r)=>{const n=C.sum(t,e);return r===void 0?n:C.clampMagnitude(n,r)},hc=(e,t,r={})=>{const n=r.diminishBy??.001,i=C.subtract(e,t);return r.range&&C.compare(C.abs(i),r.range)===-2?C.Empty:C.multiply(i,n)},Yi=(e,t)=>C.sum(e,t),vc=(e,t,r)=>rf.toCartesian(e,t,r),Lp=cc(),Vp=dc(),qp=(e=.5)=>{const t=fc(e);return r=>(r=Lp(r),r=Vp(r),r=t(r),r)},Xi={};x(Xi,{saw:()=>Hp,sine:()=>Wp,sineBipolar:()=>Op,spring:()=>jp,square:()=>Gp,triangle:()=>Up});var mc=Math.PI*2,zp=(e={},t=0,r=1)=>{const n=e.mass??1,i=e.stiffness??100,s=e.soft??!1,o=e.damping??10,a=e.velocity??.1,u=r-t;if(s||1<=o/(2*Math.sqrt(i*n))){const l=-Math.sqrt(i/n),c=-l*u-a;return d=>r-(u+d*c)*Math.E**(d*l)}else{const l=Math.sqrt(4*n*i-o**2),c=(o*u-2*n*a)/l,d=.5*l/n,h=-(.5*o)/n;return f=>r-(Math.cos(f*d)*u+Math.sin(f*d)*c)*Math.E**(f*h)}};function*jp(e={},t){t===void 0?t=Re():typeof t=="number"&&(t=ze(t));const r=zp(e,0,1);let n=e.countdown??10;for(;n>0;){const i=r(t.elapsed/1e3);yield i,i===1?n--:n=100}}function*Wp(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=ze(e));;)yield(Math.sin(e.elapsed*mc)+1)/2}function*Op(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=ze(e));;)yield Math.sin(e.elapsed*mc)}function*Up(e){for(typeof e=="number"&&(e=ze(e));;){let t=e.elapsed;t<.5?t*=2:t=2-t*2,yield t}}function*Hp(e){if(e===void 0)throw new TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=ze(e));;)yield e.elapsed}function*Gp(e){for(typeof e=="number"&&(e=ze(e));;)yield e.elapsed<.5?0:1}var pc=(e,t={})=>{const r=e/1e3,n=t.min??Number.MIN_SAFE_INTEGER,i=t.max??Number.MAX_SAFE_INTEGER;let s=performance.now();return()=>{const o=performance.now(),a=o-s;s=o;const u=r*a;return u>i?i:u<n?n:u}},Yp=(e,t={})=>pc(e/60,t);try{typeof window<"u"&&(window.ixfx={...window.ixfx,Modulation:{Forces:Hi,Envelopes:Oi,Oscillators:Xi,Easings:Tn}})}catch{}var Xp={};x(Xp,{applyToValues:()=>Jp,average:()=>Vs,averageWeighted:()=>qs,count:()=>fo,dotProduct:()=>sf,filter:()=>Kp,isApproximately:()=>eg,isValid:()=>gc,jitter:()=>oc,jitterAbsolute:()=>sc,linearSpace:()=>of,max:()=>Rs,maxFast:()=>En,maxIndex:()=>af,min:()=>uf,minFast:()=>Ps,minIndex:()=>Us,numericPercent:()=>Qp,numericRange:()=>yc,numericRangeRaw:()=>Zp,pingPong:()=>Wi,pingPongPercent:()=>ic,quantiseEvery:()=>lf,randomInteger:()=>Bn,randomUniqueInteger:()=>ho,relativeDifference:()=>tg,round:()=>ar,roundUpToMultiple:()=>Os,total:()=>cf,totalFast:()=>Ns,tracker:()=>rg,validNumbers:()=>df,weight:()=>ff});var Jp=(e,t)=>{const r={...e};for(const[n,i]of Object.entries(e))typeof i=="number"?r[n]=t(i):r[n]=i;return r},gc=e=>!(typeof e!="number"||Number.isNaN(e));function*Kp(e){for(const t of e)gc(t)&&(yield t)}var Zp=function*(e,t=0,r,n=!1){if(e<=0)throw new Error("Interval is expected to be above zero");r===void 0&&(r=Number.MAX_SAFE_INTEGER);let i=t;do for(;i<r;)yield i,i+=e;while(n)},yc=function*(e,t=0,r,n=!1,i){M(e,"nonZero");const s=e<0;if(r!==void 0){if(s&&t<r)throw new Error(`Interval of ${e} will never go from ${t} to ${r}`);if(!s&&t>r)throw new Error(`Interval of ${e} will never go from ${t} to ${r}`)}i=i??1e3,r===void 0?r=Number.MAX_SAFE_INTEGER:r*=i,e=e*i;do{let o=t*i;for(;!s&&o<=r||s&&o>=r;)yield o/i,o+=e}while(n)},Qp=function(e=.01,t=!1,r=0,n=1){return M(e,"percentage","interval"),M(r,"percentage","start"),M(n,"percentage","end"),yc(e,r,n,t)};function eg(e,t,r){M(t,"percentage","rangePercent"),M(e,"","baseValue");const n=e*t,i=s=>{try{M(s,"","v");let o=Math.abs(s-e);return Math.abs(e)<=2&&(o=ar(5,o)),o<=n}catch{return!1}};return r===void 0?i:i(r)}var tg=e=>t=>t/e,rg=e=>St(e),ng={};x(ng,{getErrorMessage:()=>me,logColours:()=>xo,logSet:()=>Co,logger:()=>rt,resolveLogOption:()=>Pn});export{Ao as A,gr as B,Pi as D,Tn as E,bo as F,Gu as N,Xi as O,$l as P,Qt as S,Ui as a,Vi as b,up as c,ac as d,sh as e,ze as f,je as g,th as h,jf as i,oc as j,Sf as k,Kl as l,hh as m,Xp as n,kl as o,Ef as p,Xl as q,V as r,Cn as s,sp as t,op as u,Ka as v,Wf as w,Nv as x,Ff as y,Yf as z};
