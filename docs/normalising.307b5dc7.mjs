import { c as createMetadata, a as createAstro, b as createComponent, r as render, d as renderComponent } from './chunks/index.7bfc2e7e.mjs';
import { $ as $$module1, a as $$MainLayout } from './chunks/MainLayout.fae6d6b7.mjs';
import 'shorthash';
import 'serialize-javascript';
import 'preact/hooks';
import 'preact/jsx-runtime';
import 'lit';

const metadata = { "headers": [{ "depth": 2, "slug": "arrays", "text": "Arrays" }, { "depth": 2, "slug": "individual-values", "text": "Individual values" }, { "depth": 3, "slug": "stream", "text": "Stream" }, { "depth": 3, "slug": "scale", "text": "Scale" }, { "depth": 2, "slug": "geometry", "text": "Geometry" }, { "depth": 2, "slug": "bipolar-values", "text": "Bipolar values" }], "source": "\n<script type=\"module\" hoist>\n  import '/src/components/ReplPad';\n<\/script>\n\nData coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to _normalise_ it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).\n\nNormalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.\n\nIt's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:\n\n```js\n// Normalised value\nconst v = 0.5;\n\n// Get x coordinate at 50%\nconst x = v * window.innerWidth;\n\n// Get a hue at 50%\nconst hue = v * 360;\n```\n\nThe basic steps then are:\n1. Receive data from an event, sensor, stream etc\n2. Normalise on 0..1 scale, discarding original value\n3. Do additional processing on normalised value as needed, applying to state\n4. Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also [`scalePercent`](https://clinth.github.io/ixfx/functions/Data.scalePercent.html))\n\nFor simple normalisation, some sense of the _input_ range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.\n\nSee also\n* [Data clean up](../../data/cleanup/)\n\n## Arrays\n\nIf you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. [`Normalise.array(source)`](https://clinth.github.io/ixfx/functions/Data.Normalise.array.html) returns a normalised copy of `source`, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: `Normalise.array(source, min, max)`.\n\n```js\n// repl-pad\nimport { Normalise } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Normalise with the largest value being 100%, the smallest 0%\n// Yields: [1, 0.2, 0, 0.5]\nNormalise.array([100,20,0,50]);\n\n// Normalise with a forced min/max range\n// Values outside of range will be clipped\n// Yields: [1, 0.4, 0, 1]\nNormalise.array([100,20,0,50], 0, 50); // Range 0-50\n```\n\n[`minMaxAvg`](https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html) might also be a useful when working with arrays. It returns the minimum, maximum, average and total.\n\n```js\n// repl-pad\nimport {Arrays} from 'https://unpkg.com/ixfx/dist/collections.js';\n\n// Yields: {total:170, max:100, min:0, avg:42.5}\nconst mma = Arrays.minMaxAvg([100,20,0,50]);\n```\n\n## Individual values\n\nIt's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. `Normalise.stream` remembers the range of values, producing an adaptive normalisation. `scale` can also be used for normalisation, but you must provide the expected min and max value.\n\n### Stream\n\n[`Normalise.stream`](https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html) creates a normalise function which automatically adapts as values are processed.\n\n```js\n// repl-pad\nimport { Normalise } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise a streaming normaliser\nconst n = Normalise.stream();\n\n// Yields 1, because 5 is the highest seen\nn(5);\n\n// Yields 1, because now 10 is the highest seen\nn(10);\n\n// Yields 0, because it's so far the lowest seen\nn(5);\n\n// Yields 0.5, becaause it's in the middle of the range seen thus far\nn(7.5);\n\n// Yields 1, because now it's the largest seen\nn(11);\n```\n\nIt should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.\n\nIt's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.\n\n```js\n// repl-pad\nimport {Normalise} from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise normaliser, assuming range of 0-10 \nconst n = Normalise.stream(0, 10);\n\n// Yields 0.5, because it's in the middle of the primed range\nn(5);\n\n// Yields 1, with 11 now treated as the max\nn(11);\n```\n\n### Scale\n\nIn contrast to `stream`, [`scale`](https://clinth.github.io/ixfx/functions/Data.scale.html) keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.\n\nFor example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to _scale_ from an input range of 0...1024 to an output range of 0..1.\n\nA basic scale function (included in ixfx) looks like this:\n\n```js\n// repl-pad\nconst scale = (v, inMin, inMax, outMin, outMax) => {\n  return (v - inMin) / (inMax - inMin) * (outMax - outMin) + outMin;\n};\n\nscale(105, 0, 1024, 0, 1);\n// Yields: 0.102\n```\n\nThe ixfx scale function optionally allows the scaling to be _eased_ (for non-linear scaling), and if `outMin`/`outMax` are not specified, a 0..1 range is presumed.\n\nIts function signature looks like this:\n\n```js\nscale(v:number, \n      inMin:number, inMax:number, \n      outMin?:number, outMax?:number, easing?:EasingFn):number\n```\n\nThis is how it looks in action:\n\n```js\n// repl-pad#1\nimport { scale } from 'https://unpkg.com/ixfx/dist/data.js'\n\n// Scales 10 on the range of 0-100, \n// with an output range of 0-1.\n// Yields 0.10\nscale(10, 0, 100); // 0.1\n\n// Scales 20 on a range of 20-40\n// Yields 0\nscale(20, 20, 40); // 0\n```\n\n`scale` can also map to an output range other than the default of 0..1:\n\n```js\n// repl-pad#1\n// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)\n// to an output range of 100-200, yielding 150 (50% of the range 100-200)\nscale(30, 20, 40, 100, 200); // 150\n```\n\nIf the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use [`clamp`](../data/cleanup/#clamping) to ensure the output range is respected:\n\n```js\n// repl-pad\nimport { scale, clamp, scaleClamped } from 'https://unpkg.com/ixfx/dist/data.js'\n// 11 is beyond input range of 0-10, so we get\n// an output beyond expected range of 0..1:\nscale(11, 0, 10); // 1.1\n\n// Clamp solves that:\nclamp(scale(11, 0, 10)); // 1\n\n// Alternatively, use scaleClamped:\n// scaleClamped(value, inMin, inMax, outMin, outMax, easing)\nscaleClamped(11, 0, 10, 0, 1);\n```\n\nTo have a reusable scaling function with the settings 'baked in', use `scaler`. \n\n```js\n// repl-pad\nimport { scaler } from 'https://unpkg.com/ixfx/dist/data.js'\n//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)\n//  ie: returns a function that scales a value with \n//  the input range of 10..100 and default output range of 0..1\nconst s = scaler(10,100);\n\ns(20); // Reusable scale function with values baked-in\n```\n\nIf the input range is a percentage, [`scalePercentages`](https://clinth.github.io/ixfx/functions/Data.scalePercentages.html) adapts to a new output percentage range. While `scale` can be used for this, `scalePercentage` will throw errors if values are outside of legit percentage ranges, helping you to catch errors.\n\n```js\n// repl-pad\nimport { scalePercentages } from 'https://unpkg.com/ixfx/dist/data.js'\n// Scale 0.5 to be on a 0.0->0.10 range\nscalePercentages(0.5, 0, 0.10) // 0.05 (5%)\n```\n\nVery similarly named is [`scalePercentage`](https://clinth.github.io/ixfx/functions/Data.scalePercent.html). It also works with an input percentage range, but it has no restrictions on output range.\n\n```js\n// repl-pad\nimport { scalePercent } from 'https://unpkg.com/ixfx/dist/data.js'\n// Scales 50% to the range of 10->20\nscalePercent(0.5, 10, 20); // 15\n```\n\n## Geometry\n\nWorking with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of [points](../../types/geometry/point/) from a computer vision library for the location of a detected nose. This position might be in _camera coordinates_, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.\n\nYou don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:\n\n```js\nconst cameraBounds = {width: 1024, height: 768};\nconst pt = {x:500, 300};\n\nconst normalised = {\n  x: pt.x / cameraBounds.width,\n  y: pt.y / cameraBounds.height\n};\n```\n\nYou might also want to verify the points don't exceed 0..1. \n\n```js\nimport { clamp } from 'https://unpkg.com/ixfx/dist/data.js';\nconst normalisedClamped = {\n  x: clamp(pt.x / cameraBounds.width),\n  y: clamp(pt.y / cameraBounds.height\n};\n```\n\nWith ixfx, normalising points is possible using [`Points.normaliseByRect`](https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html)\n\n```js\nimport { Points } from 'https://unpkg.com/ixfx/dist/geometry.js';\nconst cameraBounds = { width: 1024, height: 768 };\nconst pt = { x:500, 300 };\n\n// Convert point to 0..1 scale, based on camera frame\nconst normalised = Points.normaliseByRect(pt, cameraBounds);\n```\n\n[`Points.clamp`](https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html) will clamp both _x_ and _y_, so our earlier example could be simplified to:\n\n```js\nconst normalised = Points.clamp(Points.normaliseByRect(pt, cameraBounds));\n```\n\nIf you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. [`Points.multiply`](https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html) can be used for this:\n\n```js\nimport { Point } from 'https://unpkg.com/ixfx/dist/geometry.js';\n\n// 1,1 is normalised, meaning {x:100%, y:100%}\nconst pt = { x:1, y:1 };\n\n// Now we have it in absolute viewport coordinates\nconst screenPt = Points.multiply(pt, window.innerWidth, window.innerHeight);\n```\n\n## Bipolar values\n\nThe scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.\n\nAn obvious use case is panning of audio in the stereo field:\n\n```js\npan = -1; // Far left\npan =  0; // Center\npan =  1; // Far right\n```\n\nAs with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.\n\nixfx has the [Data.Bipolar](https://clinth.github.io/ixfx/modules/Data.Bipolar.html) for this.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Clamp an input value to -1..1 range\nBipolar.clamp(1.1); // 1\n\n// Scale an input value on a specified range to -1..1\n// In this case, 50 is the value to scale, and 0..100 is the expected range\nBipolar.scale(50, 0, 100);  // 0, because it's in the middle of the 0..100 range\n```\n\n[`toScalar`](https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html) and [`fromScalar`](https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html) are used for converting between bipolar -1..1 and scalar 0..1.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\nBipolar.fromScalar(0);   // -1;\nBipolar.fromScalar(0.5); // 0;\nBipolar.fromScalar(1);   // 1;\n\n// Convert bipolar value into scalar 0..1 scale\nBipolar.toScalar(-1); // 0\nBipolar.toScalar(0);  // 0.5\nBipolar.toScalar(1);  // 1\n```\n\nA common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. [`towardZero`](https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html) helps.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Syntax:\n// towardZero(bipolarValue, amountToNudgeBy);\n\n// Nudge -1 toward zero by 0.1\nBipolar.towardZero(-1, 0.1); // -0.9\n\n// Nudge 1 toward zero by 0.1\nBipolar.towardZero( 1, 0.1); // 0.9\n```\n\nIf you're working with bipolar values a lot, there's also [Data.Bipolar.immutable](https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html). It returns an immutable wrapper around a value, hanging the same functions off it.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// If you don't provide an initial value, 0 is used\nlet b = Bipolar.immutable(); // { value: 0}\n\n// Add 0.1 to the bipolar value\nb = b.add(0.1);\n\n// Get the value as a number with value property\nb.value; // 0.1\n```\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise a bipolar value with a default of 1\nb = Bipolar.immutable(1);\n\nb = b.add(-0.5);        // { value: 0.5 }\nb = b.multiply(0.1);    // { value: 0.05 }\nb = b.inverse();        // { value: -0.05 }\nb = b.towardZero(0.01); // { value: -0.04 }\n\n// Interpolate to a value of 1 by 0.1\nb = b.interpolate(0.1, 1);\n```\n\nThe wrapper converts to a number when needed:\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\nlet b = Bipolar.immutable(1); // { value: 1 }\nconst x = b + 10; // x = 11\n````", "html": `<script type="module" hoist>
  import '/src/components/ReplPad';
<\/script>
<p>Data coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to <em>normalise</em> it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).</p>
<p>Normalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.</p>
<p>It's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Normalised value</span>
<span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

<span class="token comment">// Get x coordinate at 50%</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> v <span class="token operator">*</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>

<span class="token comment">// Get a hue at 50%</span>
<span class="token keyword">const</span> hue <span class="token operator">=</span> v <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span></code></pre>
<p>The basic steps then are:</p>
<ol>
<li>Receive data from an event, sensor, stream etc</li>
<li>Normalise on 0..1 scale, discarding original value</li>
<li>Do additional processing on normalised value as needed, applying to state</li>
<li>Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code is:raw>scalePercent</code></a>)</li>
</ol>
<p>For simple normalisation, some sense of the <em>input</em> range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.</p>
<p>See also</p>
<ul>
<li><a href="../../data/cleanup/">Data clean up</a></li>
</ul>
<h2 id="arrays">Arrays</h2>
<p>If you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. <a href="https://clinth.github.io/ixfx/functions/Data.Normalise.array.html"><code is:raw>Normalise.array(source)</code></a> returns a normalised copy of <code is:raw>source</code>, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: <code is:raw>Normalise.array(source, min, max)</code>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with the largest value being 100%, the smallest 0%</span>
<span class="token comment">// Yields: [1, 0.2, 0, 0.5]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with a forced min/max range</span>
<span class="token comment">// Values outside of range will be clipped</span>
<span class="token comment">// Yields: [1, 0.4, 0, 1]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Range 0-50</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html"><code is:raw>minMaxAvg</code></a> might also be a useful when working with arrays. It returns the minimum, maximum, average and total.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Arrays<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/collections.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Yields: {total:170, max:100, min:0, avg:42.5}</span>
<span class="token keyword">const</span> mma <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">minMaxAvg</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="individual-values">Individual values</h2>
<p>It's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. <code is:raw>Normalise.stream</code> remembers the range of values, producing an adaptive normalisation. <code is:raw>scale</code> can also be used for normalisation, but you must provide the expected min and max value.</p>
<h3 id="stream">Stream</h3>
<p><a href="https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html"><code is:raw>Normalise.stream</code></a> creates a normalise function which automatically adapts as values are processed.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a streaming normaliser</span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because 5 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now 10 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0, because it's so far the lowest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, becaause it's in the middle of the range seen thus far</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now it's the largest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.</p>
<p>It's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Normalise<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise normaliser, assuming range of 0-10 </span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, because it's in the middle of the primed range</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, with 11 now treated as the max</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="scale">Scale</h3>
<p>In contrast to <code is:raw>stream</code>, <a href="https://clinth.github.io/ixfx/functions/Data.scale.html"><code is:raw>scale</code></a> keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.</p>
<p>For example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to <em>scale</em> from an input range of 0...1024 to an output range of 0..1.</p>
<p>A basic scale function (included in ixfx) looks like this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">const</span> <span class="token function-variable function">scale</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> inMin<span class="token punctuation">,</span> inMax<span class="token punctuation">,</span> outMin<span class="token punctuation">,</span> outMax</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>v <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>inMax <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>outMax <span class="token operator">-</span> outMin<span class="token punctuation">)</span> <span class="token operator">+</span> outMin<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Yields: 0.102</span></code></pre>
<p>The ixfx scale function optionally allows the scaling to be <em>eased</em> (for non-linear scaling), and if <code is:raw>outMin</code>/<code is:raw>outMax</code> are not specified, a 0..1 range is presumed.</p>
<p>Its function signature looks like this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token function">scale</span><span class="token punctuation">(</span>v<span class="token operator">:</span>number<span class="token punctuation">,</span> 
      <span class="token literal-property property">inMin</span><span class="token operator">:</span>number<span class="token punctuation">,</span> <span class="token literal-property property">inMax</span><span class="token operator">:</span>number<span class="token punctuation">,</span> 
      outMin<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> outMax<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> easing<span class="token operator">?</span><span class="token operator">:</span>EasingFn<span class="token punctuation">)</span><span class="token operator">:</span>number</code></pre>
<p>This is how it looks in action:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>

<span class="token comment">// Scales 10 on the range of 0-100, </span>
<span class="token comment">// with an output range of 0-1.</span>
<span class="token comment">// Yields 0.10</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.1</span>

<span class="token comment">// Scales 20 on a range of 20-40</span>
<span class="token comment">// Yields 0</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span></code></pre>
<p><code is:raw>scale</code> can also map to an output range other than the default of 0..1:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token comment">// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)</span>
<span class="token comment">// to an output range of 100-200, yielding 150 (50% of the range 100-200)</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 150</span></code></pre>
<p>If the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use <a href="../data/cleanup/#clamping"><code is:raw>clamp</code></a> to ensure the output range is respected:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale<span class="token punctuation">,</span> clamp<span class="token punctuation">,</span> scaleClamped <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// 11 is beyond input range of 0-10, so we get</span>
<span class="token comment">// an output beyond expected range of 0..1:</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.1</span>

<span class="token comment">// Clamp solves that:</span>
<span class="token function">clamp</span><span class="token punctuation">(</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Alternatively, use scaleClamped:</span>
<span class="token comment">// scaleClamped(value, inMin, inMax, outMin, outMax, easing)</span>
<span class="token function">scaleClamped</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>To have a reusable scaling function with the settings 'baked in', use <code is:raw>scaler</code>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scaler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)</span>
<span class="token comment">//  ie: returns a function that scales a value with </span>
<span class="token comment">//  the input range of 10..100 and default output range of 0..1</span>
<span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">scaler</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">s</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reusable scale function with values baked-in</span></code></pre>
<p>If the input range is a percentage, <a href="https://clinth.github.io/ixfx/functions/Data.scalePercentages.html"><code is:raw>scalePercentages</code></a> adapts to a new output percentage range. While <code is:raw>scale</code> can be used for this, <code is:raw>scalePercentage</code> will throw errors if values are outside of legit percentage ranges, helping you to catch errors.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercentages <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scale 0.5 to be on a 0.0->0.10 range</span>
<span class="token function">scalePercentages</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.10</span><span class="token punctuation">)</span> <span class="token comment">// 0.05 (5%)</span></code></pre>
<p>Very similarly named is <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code is:raw>scalePercentage</code></a>. It also works with an input percentage range, but it has no restrictions on output range.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scales 50% to the range of 10->20</span>
<span class="token function">scalePercent</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span></code></pre>
<h2 id="geometry">Geometry</h2>
<p>Working with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of <a href="../../types/geometry/point/">points</a> from a computer vision library for the location of a detected nose. This position might be in <em>camera coordinates</em>, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.</p>
<p>You don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> normalised <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>You might also want to verify the points don't exceed 0..1.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> clamp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> normalisedClamped <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>With ixfx, normalising points is possible using <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html"><code is:raw>Points.normaliseByRect</code></a></p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Points <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Convert point to 0..1 scale, based on camera frame</span>
<span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html"><code is:raw>Points.clamp</code></a> will clamp both <em>x</em> and <em>y</em>, so our earlier example could be simplified to:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span>Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html"><code is:raw>Points.multiply</code></a> can be used for this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>

<span class="token comment">// 1,1 is normalised, meaning {x:100%, y:100%}</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Now we have it in absolute viewport coordinates</span>
<span class="token keyword">const</span> screenPt <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="bipolar-values">Bipolar values</h2>
<p>The scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.</p>
<p>An obvious use case is panning of audio in the stereo field:</p>
<pre class="language-js"><code is:raw class="language-js">pan <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far left</span>
pan <span class="token operator">=</span>  <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Center</span>
pan <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far right</span></code></pre>
<p>As with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.</p>
<p>ixfx has the <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.html">Data.Bipolar</a> for this.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Clamp an input value to -1..1 range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Scale an input value on a specified range to -1..1</span>
<span class="token comment">// In this case, 50 is the value to scale, and 0..100 is the expected range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0, because it's in the middle of the 0..100 range</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html"><code is:raw>toScalar</code></a> and <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html"><code is:raw>fromScalar</code></a> are used for converting between bipolar -1..1 and scalar 0..1.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// -1;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 1;</span>

<span class="token comment">// Convert bipolar value into scalar 0..1 scale</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0.5</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span></code></pre>
<p>A common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html"><code is:raw>towardZero</code></a> helps.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Syntax:</span>
<span class="token comment">// towardZero(bipolarValue, amountToNudgeBy);</span>

<span class="token comment">// Nudge -1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -0.9</span>

<span class="token comment">// Nudge 1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.9</span></code></pre>
<p>If you're working with bipolar values a lot, there's also <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html">Data.Bipolar.immutable</a>. It returns an immutable wrapper around a value, hanging the same functions off it.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// If you don't provide an initial value, 0 is used</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 0}</span>

<span class="token comment">// Add 0.1 to the bipolar value</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the value as a number with value property</span>
b<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 0.1</span></code></pre>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a bipolar value with a default of 1</span>
b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: 0.5 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// { value: 0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: -0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: -0.04 }</span>

<span class="token comment">// Interpolate to a value of 1 by 0.1</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The wrapper converts to a number when needed:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 1 }</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// x = 11</span></code></pre>` };
const frontmatter = { "title": "Normalising", "astro": { "headers": [{ "depth": 2, "slug": "arrays", "text": "Arrays" }, { "depth": 2, "slug": "individual-values", "text": "Individual values" }, { "depth": 3, "slug": "stream", "text": "Stream" }, { "depth": 3, "slug": "scale", "text": "Scale" }, { "depth": 2, "slug": "geometry", "text": "Geometry" }, { "depth": 2, "slug": "bipolar-values", "text": "Bipolar values" }], "source": "\n<script type=\"module\" hoist>\n  import '/src/components/ReplPad';\n<\/script>\n\nData coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to _normalise_ it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).\n\nNormalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.\n\nIt's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:\n\n```js\n// Normalised value\nconst v = 0.5;\n\n// Get x coordinate at 50%\nconst x = v * window.innerWidth;\n\n// Get a hue at 50%\nconst hue = v * 360;\n```\n\nThe basic steps then are:\n1. Receive data from an event, sensor, stream etc\n2. Normalise on 0..1 scale, discarding original value\n3. Do additional processing on normalised value as needed, applying to state\n4. Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also [`scalePercent`](https://clinth.github.io/ixfx/functions/Data.scalePercent.html))\n\nFor simple normalisation, some sense of the _input_ range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.\n\nSee also\n* [Data clean up](../../data/cleanup/)\n\n## Arrays\n\nIf you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. [`Normalise.array(source)`](https://clinth.github.io/ixfx/functions/Data.Normalise.array.html) returns a normalised copy of `source`, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: `Normalise.array(source, min, max)`.\n\n```js\n// repl-pad\nimport { Normalise } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Normalise with the largest value being 100%, the smallest 0%\n// Yields: [1, 0.2, 0, 0.5]\nNormalise.array([100,20,0,50]);\n\n// Normalise with a forced min/max range\n// Values outside of range will be clipped\n// Yields: [1, 0.4, 0, 1]\nNormalise.array([100,20,0,50], 0, 50); // Range 0-50\n```\n\n[`minMaxAvg`](https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html) might also be a useful when working with arrays. It returns the minimum, maximum, average and total.\n\n```js\n// repl-pad\nimport {Arrays} from 'https://unpkg.com/ixfx/dist/collections.js';\n\n// Yields: {total:170, max:100, min:0, avg:42.5}\nconst mma = Arrays.minMaxAvg([100,20,0,50]);\n```\n\n## Individual values\n\nIt's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. `Normalise.stream` remembers the range of values, producing an adaptive normalisation. `scale` can also be used for normalisation, but you must provide the expected min and max value.\n\n### Stream\n\n[`Normalise.stream`](https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html) creates a normalise function which automatically adapts as values are processed.\n\n```js\n// repl-pad\nimport { Normalise } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise a streaming normaliser\nconst n = Normalise.stream();\n\n// Yields 1, because 5 is the highest seen\nn(5);\n\n// Yields 1, because now 10 is the highest seen\nn(10);\n\n// Yields 0, because it's so far the lowest seen\nn(5);\n\n// Yields 0.5, becaause it's in the middle of the range seen thus far\nn(7.5);\n\n// Yields 1, because now it's the largest seen\nn(11);\n```\n\nIt should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.\n\nIt's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.\n\n```js\n// repl-pad\nimport {Normalise} from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise normaliser, assuming range of 0-10 \nconst n = Normalise.stream(0, 10);\n\n// Yields 0.5, because it's in the middle of the primed range\nn(5);\n\n// Yields 1, with 11 now treated as the max\nn(11);\n```\n\n### Scale\n\nIn contrast to `stream`, [`scale`](https://clinth.github.io/ixfx/functions/Data.scale.html) keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.\n\nFor example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to _scale_ from an input range of 0...1024 to an output range of 0..1.\n\nA basic scale function (included in ixfx) looks like this:\n\n```js\n// repl-pad\nconst scale = (v, inMin, inMax, outMin, outMax) => {\n  return (v - inMin) / (inMax - inMin) * (outMax - outMin) + outMin;\n};\n\nscale(105, 0, 1024, 0, 1);\n// Yields: 0.102\n```\n\nThe ixfx scale function optionally allows the scaling to be _eased_ (for non-linear scaling), and if `outMin`/`outMax` are not specified, a 0..1 range is presumed.\n\nIts function signature looks like this:\n\n```js\nscale(v:number, \n      inMin:number, inMax:number, \n      outMin?:number, outMax?:number, easing?:EasingFn):number\n```\n\nThis is how it looks in action:\n\n```js\n// repl-pad#1\nimport { scale } from 'https://unpkg.com/ixfx/dist/data.js'\n\n// Scales 10 on the range of 0-100, \n// with an output range of 0-1.\n// Yields 0.10\nscale(10, 0, 100); // 0.1\n\n// Scales 20 on a range of 20-40\n// Yields 0\nscale(20, 20, 40); // 0\n```\n\n`scale` can also map to an output range other than the default of 0..1:\n\n```js\n// repl-pad#1\n// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)\n// to an output range of 100-200, yielding 150 (50% of the range 100-200)\nscale(30, 20, 40, 100, 200); // 150\n```\n\nIf the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use [`clamp`](../data/cleanup/#clamping) to ensure the output range is respected:\n\n```js\n// repl-pad\nimport { scale, clamp, scaleClamped } from 'https://unpkg.com/ixfx/dist/data.js'\n// 11 is beyond input range of 0-10, so we get\n// an output beyond expected range of 0..1:\nscale(11, 0, 10); // 1.1\n\n// Clamp solves that:\nclamp(scale(11, 0, 10)); // 1\n\n// Alternatively, use scaleClamped:\n// scaleClamped(value, inMin, inMax, outMin, outMax, easing)\nscaleClamped(11, 0, 10, 0, 1);\n```\n\nTo have a reusable scaling function with the settings 'baked in', use `scaler`. \n\n```js\n// repl-pad\nimport { scaler } from 'https://unpkg.com/ixfx/dist/data.js'\n//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)\n//  ie: returns a function that scales a value with \n//  the input range of 10..100 and default output range of 0..1\nconst s = scaler(10,100);\n\ns(20); // Reusable scale function with values baked-in\n```\n\nIf the input range is a percentage, [`scalePercentages`](https://clinth.github.io/ixfx/functions/Data.scalePercentages.html) adapts to a new output percentage range. While `scale` can be used for this, `scalePercentage` will throw errors if values are outside of legit percentage ranges, helping you to catch errors.\n\n```js\n// repl-pad\nimport { scalePercentages } from 'https://unpkg.com/ixfx/dist/data.js'\n// Scale 0.5 to be on a 0.0->0.10 range\nscalePercentages(0.5, 0, 0.10) // 0.05 (5%)\n```\n\nVery similarly named is [`scalePercentage`](https://clinth.github.io/ixfx/functions/Data.scalePercent.html). It also works with an input percentage range, but it has no restrictions on output range.\n\n```js\n// repl-pad\nimport { scalePercent } from 'https://unpkg.com/ixfx/dist/data.js'\n// Scales 50% to the range of 10->20\nscalePercent(0.5, 10, 20); // 15\n```\n\n## Geometry\n\nWorking with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of [points](../../types/geometry/point/) from a computer vision library for the location of a detected nose. This position might be in _camera coordinates_, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.\n\nYou don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:\n\n```js\nconst cameraBounds = {width: 1024, height: 768};\nconst pt = {x:500, 300};\n\nconst normalised = {\n  x: pt.x / cameraBounds.width,\n  y: pt.y / cameraBounds.height\n};\n```\n\nYou might also want to verify the points don't exceed 0..1. \n\n```js\nimport { clamp } from 'https://unpkg.com/ixfx/dist/data.js';\nconst normalisedClamped = {\n  x: clamp(pt.x / cameraBounds.width),\n  y: clamp(pt.y / cameraBounds.height\n};\n```\n\nWith ixfx, normalising points is possible using [`Points.normaliseByRect`](https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html)\n\n```js\nimport { Points } from 'https://unpkg.com/ixfx/dist/geometry.js';\nconst cameraBounds = { width: 1024, height: 768 };\nconst pt = { x:500, 300 };\n\n// Convert point to 0..1 scale, based on camera frame\nconst normalised = Points.normaliseByRect(pt, cameraBounds);\n```\n\n[`Points.clamp`](https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html) will clamp both _x_ and _y_, so our earlier example could be simplified to:\n\n```js\nconst normalised = Points.clamp(Points.normaliseByRect(pt, cameraBounds));\n```\n\nIf you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. [`Points.multiply`](https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html) can be used for this:\n\n```js\nimport { Point } from 'https://unpkg.com/ixfx/dist/geometry.js';\n\n// 1,1 is normalised, meaning {x:100%, y:100%}\nconst pt = { x:1, y:1 };\n\n// Now we have it in absolute viewport coordinates\nconst screenPt = Points.multiply(pt, window.innerWidth, window.innerHeight);\n```\n\n## Bipolar values\n\nThe scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.\n\nAn obvious use case is panning of audio in the stereo field:\n\n```js\npan = -1; // Far left\npan =  0; // Center\npan =  1; // Far right\n```\n\nAs with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.\n\nixfx has the [Data.Bipolar](https://clinth.github.io/ixfx/modules/Data.Bipolar.html) for this.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Clamp an input value to -1..1 range\nBipolar.clamp(1.1); // 1\n\n// Scale an input value on a specified range to -1..1\n// In this case, 50 is the value to scale, and 0..100 is the expected range\nBipolar.scale(50, 0, 100);  // 0, because it's in the middle of the 0..100 range\n```\n\n[`toScalar`](https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html) and [`fromScalar`](https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html) are used for converting between bipolar -1..1 and scalar 0..1.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\nBipolar.fromScalar(0);   // -1;\nBipolar.fromScalar(0.5); // 0;\nBipolar.fromScalar(1);   // 1;\n\n// Convert bipolar value into scalar 0..1 scale\nBipolar.toScalar(-1); // 0\nBipolar.toScalar(0);  // 0.5\nBipolar.toScalar(1);  // 1\n```\n\nA common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. [`towardZero`](https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html) helps.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Syntax:\n// towardZero(bipolarValue, amountToNudgeBy);\n\n// Nudge -1 toward zero by 0.1\nBipolar.towardZero(-1, 0.1); // -0.9\n\n// Nudge 1 toward zero by 0.1\nBipolar.towardZero( 1, 0.1); // 0.9\n```\n\nIf you're working with bipolar values a lot, there's also [Data.Bipolar.immutable](https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html). It returns an immutable wrapper around a value, hanging the same functions off it.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// If you don't provide an initial value, 0 is used\nlet b = Bipolar.immutable(); // { value: 0}\n\n// Add 0.1 to the bipolar value\nb = b.add(0.1);\n\n// Get the value as a number with value property\nb.value; // 0.1\n```\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise a bipolar value with a default of 1\nb = Bipolar.immutable(1);\n\nb = b.add(-0.5);        // { value: 0.5 }\nb = b.multiply(0.1);    // { value: 0.05 }\nb = b.inverse();        // { value: -0.05 }\nb = b.towardZero(0.01); // { value: -0.04 }\n\n// Interpolate to a value of 1 by 0.1\nb = b.interpolate(0.1, 1);\n```\n\nThe wrapper converts to a number when needed:\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\nlet b = Bipolar.immutable(1); // { value: 1 }\nconst x = b + 10; // x = 11\n````", "html": `<script type="module" hoist>
  import '/src/components/ReplPad';
<\/script>
<p>Data coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to <em>normalise</em> it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).</p>
<p>Normalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.</p>
<p>It's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Normalised value</span>
<span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

<span class="token comment">// Get x coordinate at 50%</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> v <span class="token operator">*</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>

<span class="token comment">// Get a hue at 50%</span>
<span class="token keyword">const</span> hue <span class="token operator">=</span> v <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span></code></pre>
<p>The basic steps then are:</p>
<ol>
<li>Receive data from an event, sensor, stream etc</li>
<li>Normalise on 0..1 scale, discarding original value</li>
<li>Do additional processing on normalised value as needed, applying to state</li>
<li>Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code is:raw>scalePercent</code></a>)</li>
</ol>
<p>For simple normalisation, some sense of the <em>input</em> range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.</p>
<p>See also</p>
<ul>
<li><a href="../../data/cleanup/">Data clean up</a></li>
</ul>
<h2 id="arrays">Arrays</h2>
<p>If you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. <a href="https://clinth.github.io/ixfx/functions/Data.Normalise.array.html"><code is:raw>Normalise.array(source)</code></a> returns a normalised copy of <code is:raw>source</code>, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: <code is:raw>Normalise.array(source, min, max)</code>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with the largest value being 100%, the smallest 0%</span>
<span class="token comment">// Yields: [1, 0.2, 0, 0.5]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with a forced min/max range</span>
<span class="token comment">// Values outside of range will be clipped</span>
<span class="token comment">// Yields: [1, 0.4, 0, 1]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Range 0-50</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html"><code is:raw>minMaxAvg</code></a> might also be a useful when working with arrays. It returns the minimum, maximum, average and total.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Arrays<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/collections.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Yields: {total:170, max:100, min:0, avg:42.5}</span>
<span class="token keyword">const</span> mma <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">minMaxAvg</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="individual-values">Individual values</h2>
<p>It's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. <code is:raw>Normalise.stream</code> remembers the range of values, producing an adaptive normalisation. <code is:raw>scale</code> can also be used for normalisation, but you must provide the expected min and max value.</p>
<h3 id="stream">Stream</h3>
<p><a href="https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html"><code is:raw>Normalise.stream</code></a> creates a normalise function which automatically adapts as values are processed.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a streaming normaliser</span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because 5 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now 10 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0, because it's so far the lowest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, becaause it's in the middle of the range seen thus far</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now it's the largest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.</p>
<p>It's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Normalise<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise normaliser, assuming range of 0-10 </span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, because it's in the middle of the primed range</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, with 11 now treated as the max</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="scale">Scale</h3>
<p>In contrast to <code is:raw>stream</code>, <a href="https://clinth.github.io/ixfx/functions/Data.scale.html"><code is:raw>scale</code></a> keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.</p>
<p>For example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to <em>scale</em> from an input range of 0...1024 to an output range of 0..1.</p>
<p>A basic scale function (included in ixfx) looks like this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">const</span> <span class="token function-variable function">scale</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> inMin<span class="token punctuation">,</span> inMax<span class="token punctuation">,</span> outMin<span class="token punctuation">,</span> outMax</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>v <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>inMax <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>outMax <span class="token operator">-</span> outMin<span class="token punctuation">)</span> <span class="token operator">+</span> outMin<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Yields: 0.102</span></code></pre>
<p>The ixfx scale function optionally allows the scaling to be <em>eased</em> (for non-linear scaling), and if <code is:raw>outMin</code>/<code is:raw>outMax</code> are not specified, a 0..1 range is presumed.</p>
<p>Its function signature looks like this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token function">scale</span><span class="token punctuation">(</span>v<span class="token operator">:</span>number<span class="token punctuation">,</span> 
      <span class="token literal-property property">inMin</span><span class="token operator">:</span>number<span class="token punctuation">,</span> <span class="token literal-property property">inMax</span><span class="token operator">:</span>number<span class="token punctuation">,</span> 
      outMin<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> outMax<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> easing<span class="token operator">?</span><span class="token operator">:</span>EasingFn<span class="token punctuation">)</span><span class="token operator">:</span>number</code></pre>
<p>This is how it looks in action:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>

<span class="token comment">// Scales 10 on the range of 0-100, </span>
<span class="token comment">// with an output range of 0-1.</span>
<span class="token comment">// Yields 0.10</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.1</span>

<span class="token comment">// Scales 20 on a range of 20-40</span>
<span class="token comment">// Yields 0</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span></code></pre>
<p><code is:raw>scale</code> can also map to an output range other than the default of 0..1:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token comment">// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)</span>
<span class="token comment">// to an output range of 100-200, yielding 150 (50% of the range 100-200)</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 150</span></code></pre>
<p>If the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use <a href="../data/cleanup/#clamping"><code is:raw>clamp</code></a> to ensure the output range is respected:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale<span class="token punctuation">,</span> clamp<span class="token punctuation">,</span> scaleClamped <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// 11 is beyond input range of 0-10, so we get</span>
<span class="token comment">// an output beyond expected range of 0..1:</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.1</span>

<span class="token comment">// Clamp solves that:</span>
<span class="token function">clamp</span><span class="token punctuation">(</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Alternatively, use scaleClamped:</span>
<span class="token comment">// scaleClamped(value, inMin, inMax, outMin, outMax, easing)</span>
<span class="token function">scaleClamped</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>To have a reusable scaling function with the settings 'baked in', use <code is:raw>scaler</code>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scaler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)</span>
<span class="token comment">//  ie: returns a function that scales a value with </span>
<span class="token comment">//  the input range of 10..100 and default output range of 0..1</span>
<span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">scaler</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">s</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reusable scale function with values baked-in</span></code></pre>
<p>If the input range is a percentage, <a href="https://clinth.github.io/ixfx/functions/Data.scalePercentages.html"><code is:raw>scalePercentages</code></a> adapts to a new output percentage range. While <code is:raw>scale</code> can be used for this, <code is:raw>scalePercentage</code> will throw errors if values are outside of legit percentage ranges, helping you to catch errors.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercentages <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scale 0.5 to be on a 0.0->0.10 range</span>
<span class="token function">scalePercentages</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.10</span><span class="token punctuation">)</span> <span class="token comment">// 0.05 (5%)</span></code></pre>
<p>Very similarly named is <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code is:raw>scalePercentage</code></a>. It also works with an input percentage range, but it has no restrictions on output range.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scales 50% to the range of 10->20</span>
<span class="token function">scalePercent</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span></code></pre>
<h2 id="geometry">Geometry</h2>
<p>Working with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of <a href="../../types/geometry/point/">points</a> from a computer vision library for the location of a detected nose. This position might be in <em>camera coordinates</em>, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.</p>
<p>You don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> normalised <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>You might also want to verify the points don't exceed 0..1.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> clamp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> normalisedClamped <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>With ixfx, normalising points is possible using <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html"><code is:raw>Points.normaliseByRect</code></a></p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Points <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Convert point to 0..1 scale, based on camera frame</span>
<span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html"><code is:raw>Points.clamp</code></a> will clamp both <em>x</em> and <em>y</em>, so our earlier example could be simplified to:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span>Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html"><code is:raw>Points.multiply</code></a> can be used for this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>

<span class="token comment">// 1,1 is normalised, meaning {x:100%, y:100%}</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Now we have it in absolute viewport coordinates</span>
<span class="token keyword">const</span> screenPt <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="bipolar-values">Bipolar values</h2>
<p>The scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.</p>
<p>An obvious use case is panning of audio in the stereo field:</p>
<pre class="language-js"><code is:raw class="language-js">pan <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far left</span>
pan <span class="token operator">=</span>  <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Center</span>
pan <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far right</span></code></pre>
<p>As with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.</p>
<p>ixfx has the <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.html">Data.Bipolar</a> for this.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Clamp an input value to -1..1 range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Scale an input value on a specified range to -1..1</span>
<span class="token comment">// In this case, 50 is the value to scale, and 0..100 is the expected range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0, because it's in the middle of the 0..100 range</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html"><code is:raw>toScalar</code></a> and <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html"><code is:raw>fromScalar</code></a> are used for converting between bipolar -1..1 and scalar 0..1.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// -1;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 1;</span>

<span class="token comment">// Convert bipolar value into scalar 0..1 scale</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0.5</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span></code></pre>
<p>A common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html"><code is:raw>towardZero</code></a> helps.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Syntax:</span>
<span class="token comment">// towardZero(bipolarValue, amountToNudgeBy);</span>

<span class="token comment">// Nudge -1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -0.9</span>

<span class="token comment">// Nudge 1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.9</span></code></pre>
<p>If you're working with bipolar values a lot, there's also <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html">Data.Bipolar.immutable</a>. It returns an immutable wrapper around a value, hanging the same functions off it.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// If you don't provide an initial value, 0 is used</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 0}</span>

<span class="token comment">// Add 0.1 to the bipolar value</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the value as a number with value property</span>
b<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 0.1</span></code></pre>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a bipolar value with a default of 1</span>
b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: 0.5 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// { value: 0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: -0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: -0.04 }</span>

<span class="token comment">// Interpolate to a value of 1 by 0.1</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The wrapper converts to a number when needed:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 1 }</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// x = 11</span></code></pre>` } };
const $$metadata = createMetadata("/src/pages/data/normalising.md", { modules: [{ module: $$module1, specifier: "../../layouts/MainLayout.astro", assert: {} }], hydratedComponents: [], clientOnlyComponents: [], hydrationDirectives: /* @__PURE__ */ new Set([]), hoisted: [{ type: "inline", value: `
  import '/src/components/ReplPad';
` }] });
const $$Astro = createAstro("/src/pages/data/normalising.md", "https://clinth.github.io/ixfx-docs/", "file:///Users/af4766/repos/ixfx-docs/");
const $$Normalising = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Normalising;
  const $$content = { "title": "Normalising", "astro": { "headers": [{ "depth": 2, "slug": "arrays", "text": "Arrays" }, { "depth": 2, "slug": "individual-values", "text": "Individual values" }, { "depth": 3, "slug": "stream", "text": "Stream" }, { "depth": 3, "slug": "scale", "text": "Scale" }, { "depth": 2, "slug": "geometry", "text": "Geometry" }, { "depth": 2, "slug": "bipolar-values", "text": "Bipolar values" }], "source": "\n<script type=\"module\" hoist>\n  import '/src/components/ReplPad';\n<\/script>\n\nData coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to _normalise_ it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).\n\nNormalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.\n\nIt's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:\n\n```js\n// Normalised value\nconst v = 0.5;\n\n// Get x coordinate at 50%\nconst x = v * window.innerWidth;\n\n// Get a hue at 50%\nconst hue = v * 360;\n```\n\nThe basic steps then are:\n1. Receive data from an event, sensor, stream etc\n2. Normalise on 0..1 scale, discarding original value\n3. Do additional processing on normalised value as needed, applying to state\n4. Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also [`scalePercent`](https://clinth.github.io/ixfx/functions/Data.scalePercent.html))\n\nFor simple normalisation, some sense of the _input_ range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.\n\nSee also\n* [Data clean up](../../data/cleanup/)\n\n## Arrays\n\nIf you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. [`Normalise.array(source)`](https://clinth.github.io/ixfx/functions/Data.Normalise.array.html) returns a normalised copy of `source`, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: `Normalise.array(source, min, max)`.\n\n```js\n// repl-pad\nimport { Normalise } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Normalise with the largest value being 100%, the smallest 0%\n// Yields: [1, 0.2, 0, 0.5]\nNormalise.array([100,20,0,50]);\n\n// Normalise with a forced min/max range\n// Values outside of range will be clipped\n// Yields: [1, 0.4, 0, 1]\nNormalise.array([100,20,0,50], 0, 50); // Range 0-50\n```\n\n[`minMaxAvg`](https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html) might also be a useful when working with arrays. It returns the minimum, maximum, average and total.\n\n```js\n// repl-pad\nimport {Arrays} from 'https://unpkg.com/ixfx/dist/collections.js';\n\n// Yields: {total:170, max:100, min:0, avg:42.5}\nconst mma = Arrays.minMaxAvg([100,20,0,50]);\n```\n\n## Individual values\n\nIt's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. `Normalise.stream` remembers the range of values, producing an adaptive normalisation. `scale` can also be used for normalisation, but you must provide the expected min and max value.\n\n### Stream\n\n[`Normalise.stream`](https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html) creates a normalise function which automatically adapts as values are processed.\n\n```js\n// repl-pad\nimport { Normalise } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise a streaming normaliser\nconst n = Normalise.stream();\n\n// Yields 1, because 5 is the highest seen\nn(5);\n\n// Yields 1, because now 10 is the highest seen\nn(10);\n\n// Yields 0, because it's so far the lowest seen\nn(5);\n\n// Yields 0.5, becaause it's in the middle of the range seen thus far\nn(7.5);\n\n// Yields 1, because now it's the largest seen\nn(11);\n```\n\nIt should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.\n\nIt's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.\n\n```js\n// repl-pad\nimport {Normalise} from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise normaliser, assuming range of 0-10 \nconst n = Normalise.stream(0, 10);\n\n// Yields 0.5, because it's in the middle of the primed range\nn(5);\n\n// Yields 1, with 11 now treated as the max\nn(11);\n```\n\n### Scale\n\nIn contrast to `stream`, [`scale`](https://clinth.github.io/ixfx/functions/Data.scale.html) keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.\n\nFor example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to _scale_ from an input range of 0...1024 to an output range of 0..1.\n\nA basic scale function (included in ixfx) looks like this:\n\n```js\n// repl-pad\nconst scale = (v, inMin, inMax, outMin, outMax) => {\n  return (v - inMin) / (inMax - inMin) * (outMax - outMin) + outMin;\n};\n\nscale(105, 0, 1024, 0, 1);\n// Yields: 0.102\n```\n\nThe ixfx scale function optionally allows the scaling to be _eased_ (for non-linear scaling), and if `outMin`/`outMax` are not specified, a 0..1 range is presumed.\n\nIts function signature looks like this:\n\n```js\nscale(v:number, \n      inMin:number, inMax:number, \n      outMin?:number, outMax?:number, easing?:EasingFn):number\n```\n\nThis is how it looks in action:\n\n```js\n// repl-pad#1\nimport { scale } from 'https://unpkg.com/ixfx/dist/data.js'\n\n// Scales 10 on the range of 0-100, \n// with an output range of 0-1.\n// Yields 0.10\nscale(10, 0, 100); // 0.1\n\n// Scales 20 on a range of 20-40\n// Yields 0\nscale(20, 20, 40); // 0\n```\n\n`scale` can also map to an output range other than the default of 0..1:\n\n```js\n// repl-pad#1\n// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)\n// to an output range of 100-200, yielding 150 (50% of the range 100-200)\nscale(30, 20, 40, 100, 200); // 150\n```\n\nIf the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use [`clamp`](../data/cleanup/#clamping) to ensure the output range is respected:\n\n```js\n// repl-pad\nimport { scale, clamp, scaleClamped } from 'https://unpkg.com/ixfx/dist/data.js'\n// 11 is beyond input range of 0-10, so we get\n// an output beyond expected range of 0..1:\nscale(11, 0, 10); // 1.1\n\n// Clamp solves that:\nclamp(scale(11, 0, 10)); // 1\n\n// Alternatively, use scaleClamped:\n// scaleClamped(value, inMin, inMax, outMin, outMax, easing)\nscaleClamped(11, 0, 10, 0, 1);\n```\n\nTo have a reusable scaling function with the settings 'baked in', use `scaler`. \n\n```js\n// repl-pad\nimport { scaler } from 'https://unpkg.com/ixfx/dist/data.js'\n//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)\n//  ie: returns a function that scales a value with \n//  the input range of 10..100 and default output range of 0..1\nconst s = scaler(10,100);\n\ns(20); // Reusable scale function with values baked-in\n```\n\nIf the input range is a percentage, [`scalePercentages`](https://clinth.github.io/ixfx/functions/Data.scalePercentages.html) adapts to a new output percentage range. While `scale` can be used for this, `scalePercentage` will throw errors if values are outside of legit percentage ranges, helping you to catch errors.\n\n```js\n// repl-pad\nimport { scalePercentages } from 'https://unpkg.com/ixfx/dist/data.js'\n// Scale 0.5 to be on a 0.0->0.10 range\nscalePercentages(0.5, 0, 0.10) // 0.05 (5%)\n```\n\nVery similarly named is [`scalePercentage`](https://clinth.github.io/ixfx/functions/Data.scalePercent.html). It also works with an input percentage range, but it has no restrictions on output range.\n\n```js\n// repl-pad\nimport { scalePercent } from 'https://unpkg.com/ixfx/dist/data.js'\n// Scales 50% to the range of 10->20\nscalePercent(0.5, 10, 20); // 15\n```\n\n## Geometry\n\nWorking with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of [points](../../types/geometry/point/) from a computer vision library for the location of a detected nose. This position might be in _camera coordinates_, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.\n\nYou don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:\n\n```js\nconst cameraBounds = {width: 1024, height: 768};\nconst pt = {x:500, 300};\n\nconst normalised = {\n  x: pt.x / cameraBounds.width,\n  y: pt.y / cameraBounds.height\n};\n```\n\nYou might also want to verify the points don't exceed 0..1. \n\n```js\nimport { clamp } from 'https://unpkg.com/ixfx/dist/data.js';\nconst normalisedClamped = {\n  x: clamp(pt.x / cameraBounds.width),\n  y: clamp(pt.y / cameraBounds.height\n};\n```\n\nWith ixfx, normalising points is possible using [`Points.normaliseByRect`](https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html)\n\n```js\nimport { Points } from 'https://unpkg.com/ixfx/dist/geometry.js';\nconst cameraBounds = { width: 1024, height: 768 };\nconst pt = { x:500, 300 };\n\n// Convert point to 0..1 scale, based on camera frame\nconst normalised = Points.normaliseByRect(pt, cameraBounds);\n```\n\n[`Points.clamp`](https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html) will clamp both _x_ and _y_, so our earlier example could be simplified to:\n\n```js\nconst normalised = Points.clamp(Points.normaliseByRect(pt, cameraBounds));\n```\n\nIf you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. [`Points.multiply`](https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html) can be used for this:\n\n```js\nimport { Point } from 'https://unpkg.com/ixfx/dist/geometry.js';\n\n// 1,1 is normalised, meaning {x:100%, y:100%}\nconst pt = { x:1, y:1 };\n\n// Now we have it in absolute viewport coordinates\nconst screenPt = Points.multiply(pt, window.innerWidth, window.innerHeight);\n```\n\n## Bipolar values\n\nThe scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.\n\nAn obvious use case is panning of audio in the stereo field:\n\n```js\npan = -1; // Far left\npan =  0; // Center\npan =  1; // Far right\n```\n\nAs with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.\n\nixfx has the [Data.Bipolar](https://clinth.github.io/ixfx/modules/Data.Bipolar.html) for this.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Clamp an input value to -1..1 range\nBipolar.clamp(1.1); // 1\n\n// Scale an input value on a specified range to -1..1\n// In this case, 50 is the value to scale, and 0..100 is the expected range\nBipolar.scale(50, 0, 100);  // 0, because it's in the middle of the 0..100 range\n```\n\n[`toScalar`](https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html) and [`fromScalar`](https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html) are used for converting between bipolar -1..1 and scalar 0..1.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\nBipolar.fromScalar(0);   // -1;\nBipolar.fromScalar(0.5); // 0;\nBipolar.fromScalar(1);   // 1;\n\n// Convert bipolar value into scalar 0..1 scale\nBipolar.toScalar(-1); // 0\nBipolar.toScalar(0);  // 0.5\nBipolar.toScalar(1);  // 1\n```\n\nA common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. [`towardZero`](https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html) helps.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Syntax:\n// towardZero(bipolarValue, amountToNudgeBy);\n\n// Nudge -1 toward zero by 0.1\nBipolar.towardZero(-1, 0.1); // -0.9\n\n// Nudge 1 toward zero by 0.1\nBipolar.towardZero( 1, 0.1); // 0.9\n```\n\nIf you're working with bipolar values a lot, there's also [Data.Bipolar.immutable](https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html). It returns an immutable wrapper around a value, hanging the same functions off it.\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// If you don't provide an initial value, 0 is used\nlet b = Bipolar.immutable(); // { value: 0}\n\n// Add 0.1 to the bipolar value\nb = b.add(0.1);\n\n// Get the value as a number with value property\nb.value; // 0.1\n```\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n\n// Initialise a bipolar value with a default of 1\nb = Bipolar.immutable(1);\n\nb = b.add(-0.5);        // { value: 0.5 }\nb = b.multiply(0.1);    // { value: 0.05 }\nb = b.inverse();        // { value: -0.05 }\nb = b.towardZero(0.01); // { value: -0.04 }\n\n// Interpolate to a value of 1 by 0.1\nb = b.interpolate(0.1, 1);\n```\n\nThe wrapper converts to a number when needed:\n\n```js\n// repl-pad\nimport { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\nlet b = Bipolar.immutable(1); // { value: 1 }\nconst x = b + 10; // x = 11\n````", "html": `<script type="module" hoist>
  import '/src/components/ReplPad';
<\/script>
<p>Data coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to <em>normalise</em> it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).</p>
<p>Normalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.</p>
<p>It's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Normalised value</span>
<span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

<span class="token comment">// Get x coordinate at 50%</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> v <span class="token operator">*</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>

<span class="token comment">// Get a hue at 50%</span>
<span class="token keyword">const</span> hue <span class="token operator">=</span> v <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span></code></pre>
<p>The basic steps then are:</p>
<ol>
<li>Receive data from an event, sensor, stream etc</li>
<li>Normalise on 0..1 scale, discarding original value</li>
<li>Do additional processing on normalised value as needed, applying to state</li>
<li>Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code is:raw>scalePercent</code></a>)</li>
</ol>
<p>For simple normalisation, some sense of the <em>input</em> range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.</p>
<p>See also</p>
<ul>
<li><a href="../../data/cleanup/">Data clean up</a></li>
</ul>
<h2 id="arrays">Arrays</h2>
<p>If you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. <a href="https://clinth.github.io/ixfx/functions/Data.Normalise.array.html"><code is:raw>Normalise.array(source)</code></a> returns a normalised copy of <code is:raw>source</code>, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: <code is:raw>Normalise.array(source, min, max)</code>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with the largest value being 100%, the smallest 0%</span>
<span class="token comment">// Yields: [1, 0.2, 0, 0.5]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with a forced min/max range</span>
<span class="token comment">// Values outside of range will be clipped</span>
<span class="token comment">// Yields: [1, 0.4, 0, 1]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Range 0-50</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html"><code is:raw>minMaxAvg</code></a> might also be a useful when working with arrays. It returns the minimum, maximum, average and total.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Arrays<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/collections.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Yields: {total:170, max:100, min:0, avg:42.5}</span>
<span class="token keyword">const</span> mma <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">minMaxAvg</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="individual-values">Individual values</h2>
<p>It's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. <code is:raw>Normalise.stream</code> remembers the range of values, producing an adaptive normalisation. <code is:raw>scale</code> can also be used for normalisation, but you must provide the expected min and max value.</p>
<h3 id="stream">Stream</h3>
<p><a href="https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html"><code is:raw>Normalise.stream</code></a> creates a normalise function which automatically adapts as values are processed.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a streaming normaliser</span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because 5 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now 10 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0, because it's so far the lowest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, becaause it's in the middle of the range seen thus far</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now it's the largest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.</p>
<p>It's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Normalise<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise normaliser, assuming range of 0-10 </span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, because it's in the middle of the primed range</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, with 11 now treated as the max</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="scale">Scale</h3>
<p>In contrast to <code is:raw>stream</code>, <a href="https://clinth.github.io/ixfx/functions/Data.scale.html"><code is:raw>scale</code></a> keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.</p>
<p>For example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to <em>scale</em> from an input range of 0...1024 to an output range of 0..1.</p>
<p>A basic scale function (included in ixfx) looks like this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">const</span> <span class="token function-variable function">scale</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> inMin<span class="token punctuation">,</span> inMax<span class="token punctuation">,</span> outMin<span class="token punctuation">,</span> outMax</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>v <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>inMax <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>outMax <span class="token operator">-</span> outMin<span class="token punctuation">)</span> <span class="token operator">+</span> outMin<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Yields: 0.102</span></code></pre>
<p>The ixfx scale function optionally allows the scaling to be <em>eased</em> (for non-linear scaling), and if <code is:raw>outMin</code>/<code is:raw>outMax</code> are not specified, a 0..1 range is presumed.</p>
<p>Its function signature looks like this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token function">scale</span><span class="token punctuation">(</span>v<span class="token operator">:</span>number<span class="token punctuation">,</span> 
      <span class="token literal-property property">inMin</span><span class="token operator">:</span>number<span class="token punctuation">,</span> <span class="token literal-property property">inMax</span><span class="token operator">:</span>number<span class="token punctuation">,</span> 
      outMin<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> outMax<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> easing<span class="token operator">?</span><span class="token operator">:</span>EasingFn<span class="token punctuation">)</span><span class="token operator">:</span>number</code></pre>
<p>This is how it looks in action:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>

<span class="token comment">// Scales 10 on the range of 0-100, </span>
<span class="token comment">// with an output range of 0-1.</span>
<span class="token comment">// Yields 0.10</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.1</span>

<span class="token comment">// Scales 20 on a range of 20-40</span>
<span class="token comment">// Yields 0</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span></code></pre>
<p><code is:raw>scale</code> can also map to an output range other than the default of 0..1:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token comment">// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)</span>
<span class="token comment">// to an output range of 100-200, yielding 150 (50% of the range 100-200)</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 150</span></code></pre>
<p>If the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use <a href="../data/cleanup/#clamping"><code is:raw>clamp</code></a> to ensure the output range is respected:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale<span class="token punctuation">,</span> clamp<span class="token punctuation">,</span> scaleClamped <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// 11 is beyond input range of 0-10, so we get</span>
<span class="token comment">// an output beyond expected range of 0..1:</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.1</span>

<span class="token comment">// Clamp solves that:</span>
<span class="token function">clamp</span><span class="token punctuation">(</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Alternatively, use scaleClamped:</span>
<span class="token comment">// scaleClamped(value, inMin, inMax, outMin, outMax, easing)</span>
<span class="token function">scaleClamped</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>To have a reusable scaling function with the settings 'baked in', use <code is:raw>scaler</code>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scaler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)</span>
<span class="token comment">//  ie: returns a function that scales a value with </span>
<span class="token comment">//  the input range of 10..100 and default output range of 0..1</span>
<span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">scaler</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">s</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reusable scale function with values baked-in</span></code></pre>
<p>If the input range is a percentage, <a href="https://clinth.github.io/ixfx/functions/Data.scalePercentages.html"><code is:raw>scalePercentages</code></a> adapts to a new output percentage range. While <code is:raw>scale</code> can be used for this, <code is:raw>scalePercentage</code> will throw errors if values are outside of legit percentage ranges, helping you to catch errors.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercentages <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scale 0.5 to be on a 0.0->0.10 range</span>
<span class="token function">scalePercentages</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.10</span><span class="token punctuation">)</span> <span class="token comment">// 0.05 (5%)</span></code></pre>
<p>Very similarly named is <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code is:raw>scalePercentage</code></a>. It also works with an input percentage range, but it has no restrictions on output range.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scales 50% to the range of 10->20</span>
<span class="token function">scalePercent</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span></code></pre>
<h2 id="geometry">Geometry</h2>
<p>Working with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of <a href="../../types/geometry/point/">points</a> from a computer vision library for the location of a detected nose. This position might be in <em>camera coordinates</em>, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.</p>
<p>You don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> normalised <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>You might also want to verify the points don't exceed 0..1.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> clamp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> normalisedClamped <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>With ixfx, normalising points is possible using <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html"><code is:raw>Points.normaliseByRect</code></a></p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Points <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Convert point to 0..1 scale, based on camera frame</span>
<span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html"><code is:raw>Points.clamp</code></a> will clamp both <em>x</em> and <em>y</em>, so our earlier example could be simplified to:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span>Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html"><code is:raw>Points.multiply</code></a> can be used for this:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>

<span class="token comment">// 1,1 is normalised, meaning {x:100%, y:100%}</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Now we have it in absolute viewport coordinates</span>
<span class="token keyword">const</span> screenPt <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="bipolar-values">Bipolar values</h2>
<p>The scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.</p>
<p>An obvious use case is panning of audio in the stereo field:</p>
<pre class="language-js"><code is:raw class="language-js">pan <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far left</span>
pan <span class="token operator">=</span>  <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Center</span>
pan <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far right</span></code></pre>
<p>As with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.</p>
<p>ixfx has the <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.html">Data.Bipolar</a> for this.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Clamp an input value to -1..1 range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Scale an input value on a specified range to -1..1</span>
<span class="token comment">// In this case, 50 is the value to scale, and 0..100 is the expected range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0, because it's in the middle of the 0..100 range</span></code></pre>
<p><a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html"><code is:raw>toScalar</code></a> and <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html"><code is:raw>fromScalar</code></a> are used for converting between bipolar -1..1 and scalar 0..1.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// -1;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 1;</span>

<span class="token comment">// Convert bipolar value into scalar 0..1 scale</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0.5</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span></code></pre>
<p>A common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html"><code is:raw>towardZero</code></a> helps.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Syntax:</span>
<span class="token comment">// towardZero(bipolarValue, amountToNudgeBy);</span>

<span class="token comment">// Nudge -1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -0.9</span>

<span class="token comment">// Nudge 1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.9</span></code></pre>
<p>If you're working with bipolar values a lot, there's also <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html">Data.Bipolar.immutable</a>. It returns an immutable wrapper around a value, hanging the same functions off it.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// If you don't provide an initial value, 0 is used</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 0}</span>

<span class="token comment">// Add 0.1 to the bipolar value</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the value as a number with value property</span>
b<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 0.1</span></code></pre>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a bipolar value with a default of 1</span>
b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: 0.5 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// { value: 0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: -0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: -0.04 }</span>

<span class="token comment">// Interpolate to a value of 1 by 0.1</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The wrapper converts to a number when needed:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 1 }</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// x = 11</span></code></pre>` } };
  const SCRIPTS = [
    { props: { "type": "module", "hoist": true }, children: `import '/src/components/ReplPad';` }
  ];
  for (const SCRIPT of SCRIPTS)
    $$result.scripts.add(SCRIPT);
  return render`${renderComponent($$result, "Layout", $$MainLayout, { "content": $$content }, { "default": () => render`<p>Data coming in from events, sensors etc. can have radically different scales or units. Rather than having to juggle these differences throughout your code, a strategy is to try to <em>normalise</em> it as soon as you can, getting it on a relative percentage scale of 0..1 (0% .. 100%).</p><p>Normalisation allows values to be compared more readily: 0.5 (ie. 50%) can represent half volume level, or half of the screen width. That's easier to manage than having to work with the equivalent absolute values of -12dB and 800, and much less of your code has to change if different scaling is needed later on.</p><p>It's easy to apply modulation factors and eventually to map the relative value to some absolute value in the output domain. For example:</p><pre class="language-js"><code class="language-js"><span class="token comment">// Normalised value</span>
<span class="token keyword">const</span> v <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

<span class="token comment">// Get x coordinate at 50%</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> v <span class="token operator">*</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>

<span class="token comment">// Get a hue at 50%</span>
<span class="token keyword">const</span> hue <span class="token operator">=</span> v <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">;</span></code></pre><p>The basic steps then are:</p><ol>
<li>Receive data from an event, sensor, stream etc</li>
<li>Normalise on 0..1 scale, discarding original value</li>
<li>Do additional processing on normalised value as needed, applying to state</li>
<li>Map relative state values to output domains, eg pixels, sound level, pulse-width modulation... (see also <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code>scalePercent</code></a>)</li>
</ol><p>For simple normalisation, some sense of the <em>input</em> range of values is needed: a minimum and maximum. For example, although an analog input value might theoretically be in the range of 0..1023, perhaps we've empirically discovered that the usable range is actually 0..400. This would constitute the range of the value.</p><p>See also</p><ul>
<li><a href="../../data/cleanup/">Data clean up</a></li>
</ul><h2 id="arrays">Arrays</h2><p>If you have all the data in advance, it's easy enough to 'perfectly' normalise, because the smallest and largest value can be determined. <a href="https://clinth.github.io/ixfx/functions/Data.Normalise.array.html"><code>Normalise.array(source)</code></a> returns a normalised copy of <code>source</code>, such that the smallest value becomes 0 and the largest value 1. A range can be forced by passing in a min and max: <code>Normalise.array(source, min, max)</code>.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with the largest value being 100%, the smallest 0%</span>
<span class="token comment">// Yields: [1, 0.2, 0, 0.5]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Normalise with a forced min/max range</span>
<span class="token comment">// Values outside of range will be clipped</span>
<span class="token comment">// Yields: [1, 0.4, 0, 1]</span>
Normalise<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Range 0-50</span></code></pre><p><a href="https://clinth.github.io/ixfx/functions/Collections.Arrays.minMaxAvg.html"><code>minMaxAvg</code></a> might also be a useful when working with arrays. It returns the minimum, maximum, average and total.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Arrays<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/collections.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Yields: {total:170, max:100, min:0, avg:42.5}</span>
<span class="token keyword">const</span> mma <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">minMaxAvg</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="individual-values">Individual values</h2><p>It's not always feasible to normalise knowing in advance all the possible values, or even knowing the range. <code>Normalise.stream</code> remembers the range of values, producing an adaptive normalisation. <code>scale</code> can also be used for normalisation, but you must provide the expected min and max value.</p><h3 id="stream">Stream</h3><p><a href="https://clinth.github.io/ixfx/functions/Data.Normalise.stream.html"><code>Normalise.stream</code></a> creates a normalise function which automatically adapts as values are processed.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Normalise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a streaming normaliser</span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because 5 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now 10 is the highest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0, because it's so far the lowest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, becaause it's in the middle of the range seen thus far</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, because now it's the largest seen</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>It should be clear from the examples that different input values may produce the same output value, depending on what has been seen before. For example, an input of 5 yields 1 if 5 is the highest value, but 5 yields 0.05 if 100 is the highest value. It's good to remember then that normalised values aren't necessarily comparable to each other.</p><p>It's possible to 'prime' the normalisation if you know in advance what range of values to expect. If a value exceeds the range, the range is updated to encompass the new minimum or maximum.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Normalise<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise normaliser, assuming range of 0-10 </span>
<span class="token keyword">const</span> n <span class="token operator">=</span> Normalise<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 0.5, because it's in the middle of the primed range</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Yields 1, with 11 now treated as the max</span>
<span class="token function">n</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="scale">Scale</h3><p>In contrast to <code>stream</code>, <a href="https://clinth.github.io/ixfx/functions/Data.scale.html"><code>scale</code></a> keeps no record of the current minimum or maximum, but normalises based on the provided range. Use this when you know what the range will be.</p><p>For example, say you have a value of 105, that lies on a scale of 0..1024. What is the proportional value of 105? We want to <em>scale</em> from an input range of 0...1024 to an output range of 0..1.</p><p>A basic scale function (included in ixfx) looks like this:</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">const</span> <span class="token function-variable function">scale</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> inMin<span class="token punctuation">,</span> inMax<span class="token punctuation">,</span> outMin<span class="token punctuation">,</span> outMax</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>v <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>inMax <span class="token operator">-</span> inMin<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>outMax <span class="token operator">-</span> outMin<span class="token punctuation">)</span> <span class="token operator">+</span> outMin<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Yields: 0.102</span></code></pre><p>The ixfx scale function optionally allows the scaling to be <em>eased</em> (for non-linear scaling), and if <code>outMin</code>/<code>outMax</code> are not specified, a 0..1 range is presumed.</p><p>Its function signature looks like this:</p><pre class="language-js"><code class="language-js"><span class="token function">scale</span><span class="token punctuation">(</span>v<span class="token operator">:</span>number<span class="token punctuation">,</span> 
      <span class="token literal-property property">inMin</span><span class="token operator">:</span>number<span class="token punctuation">,</span> <span class="token literal-property property">inMax</span><span class="token operator">:</span>number<span class="token punctuation">,</span> 
      outMin<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> outMax<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span> easing<span class="token operator">?</span><span class="token operator">:</span>EasingFn<span class="token punctuation">)</span><span class="token operator">:</span>number</code></pre><p>This is how it looks in action:</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>

<span class="token comment">// Scales 10 on the range of 0-100, </span>
<span class="token comment">// with an output range of 0-1.</span>
<span class="token comment">// Yields 0.10</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.1</span>

<span class="token comment">// Scales 20 on a range of 20-40</span>
<span class="token comment">// Yields 0</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span></code></pre><p><code>scale</code> can also map to an output range other than the default of 0..1:</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad#1</span>
<span class="token comment">// Maps the value 30 from an input range of 20-40 (thus 30 = 0.5 or 50%)</span>
<span class="token comment">// to an output range of 100-200, yielding 150 (50% of the range 100-200)</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 150</span></code></pre><p>If the input value is outside of the specified input range, the output value will likewise be outside of the output range. Use <a href="../data/cleanup/#clamping"><code>clamp</code></a> to ensure the output range is respected:</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scale<span class="token punctuation">,</span> clamp<span class="token punctuation">,</span> scaleClamped <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// 11 is beyond input range of 0-10, so we get</span>
<span class="token comment">// an output beyond expected range of 0..1:</span>
<span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.1</span>

<span class="token comment">// Clamp solves that:</span>
<span class="token function">clamp</span><span class="token punctuation">(</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Alternatively, use scaleClamped:</span>
<span class="token comment">// scaleClamped(value, inMin, inMax, outMin, outMax, easing)</span>
<span class="token function">scaleClamped</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>To have a reusable scaling function with the settings 'baked in', use <code>scaler</code>.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scaler <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">//  Signature: scaler(inMin?, inMax?, outMin?, outMax?, easingFn?)</span>
<span class="token comment">//  ie: returns a function that scales a value with </span>
<span class="token comment">//  the input range of 10..100 and default output range of 0..1</span>
<span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">scaler</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">s</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Reusable scale function with values baked-in</span></code></pre><p>If the input range is a percentage, <a href="https://clinth.github.io/ixfx/functions/Data.scalePercentages.html"><code>scalePercentages</code></a> adapts to a new output percentage range. While <code>scale</code> can be used for this, <code>scalePercentage</code> will throw errors if values are outside of legit percentage ranges, helping you to catch errors.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercentages <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scale 0.5 to be on a 0.0->0.10 range</span>
<span class="token function">scalePercentages</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.10</span><span class="token punctuation">)</span> <span class="token comment">// 0.05 (5%)</span></code></pre><p>Very similarly named is <a href="https://clinth.github.io/ixfx/functions/Data.scalePercent.html"><code>scalePercentage</code></a>. It also works with an input percentage range, but it has no restrictions on output range.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> scalePercent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span>
<span class="token comment">// Scales 50% to the range of 10->20</span>
<span class="token function">scalePercent</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span></code></pre><h2 id="geometry">Geometry</h2><p>Working with normalised geometric references can be useful for the same reason as normalised plain numbers. For example, perhaps you have a stream of <a href="../../types/geometry/point/">points</a> from a computer vision library for the location of a detected nose. This position might be in <em>camera coordinates</em>, meaning that 0,0 represents the top-left corner of a frame from the camera. The max width and height will be determined by the resolution setting of the camera/library.</p><p>You don't want to have to think about the scale of camera coordinates throughout the code, and importantly, it may change if you opt for a different camera resolution. Normalising to 0,0 - 1,1 may be the answer:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> normalised <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>You might also want to verify the points don't exceed 0..1.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> clamp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> normalisedClamped <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>x <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token function">clamp</span><span class="token punctuation">(</span>pt<span class="token punctuation">.</span>y <span class="token operator">/</span> cameraBounds<span class="token punctuation">.</span>height
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>With ixfx, normalising points is possible using <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.normaliseByRect.html"><code>Points.normaliseByRect</code></a></p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Points <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cameraBounds <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">768</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Convert point to 0..1 scale, based on camera frame</span>
<span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://clinth.github.io/ixfx/functions/Geometry.Points.clamp.html"><code>Points.clamp</code></a> will clamp both <em>x</em> and <em>y</em>, so our earlier example could be simplified to:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> normalised <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span>Points<span class="token punctuation">.</span><span class="token function">normaliseByRect</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> cameraBounds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If you have a normalised point, you will likely need to map it to an absolute space at some point, for example to the dimensions of the viewport. <a href="https://clinth.github.io/ixfx/functions/Geometry.Points.multiply.html"><code>Points.multiply</code></a> can be used for this:</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/geometry.js'</span><span class="token punctuation">;</span>

<span class="token comment">// 1,1 is normalised, meaning {x:100%, y:100%}</span>
<span class="token keyword">const</span> pt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Now we have it in absolute viewport coordinates</span>
<span class="token keyword">const</span> screenPt <span class="token operator">=</span> Points<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="bipolar-values">Bipolar values</h2><p>The scalar range of 0..1 works for most cases, but sometimes the bipolar scale of -1..1 makes more sense. In this range, 0 represents neutral. It's still a percentage scaling, but now -100% to 100%, rather than 0 to 100%.</p><p>An obvious use case is panning of audio in the stereo field:</p><pre class="language-js"><code class="language-js">pan <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far left</span>
pan <span class="token operator">=</span>  <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Center</span>
pan <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Far right</span></code></pre><p>As with scalars, there are few things we'd like to be able to do with them - especially to help us avoid being out-of-range.</p><p>ixfx has the <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.html">Data.Bipolar</a> for this.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Clamp an input value to -1..1 range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">1.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token comment">// Scale an input value on a specified range to -1..1</span>
<span class="token comment">// In this case, 50 is the value to scale, and 0..100 is the expected range</span>
Bipolar<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0, because it's in the middle of the 0..100 range</span></code></pre><p><a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.toScalar.html"><code>toScalar</code></a> and <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.fromScalar.html"><code>fromScalar</code></a> are used for converting between bipolar -1..1 and scalar 0..1.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// -1;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0;</span>
Bipolar<span class="token punctuation">.</span><span class="token function">fromScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 1;</span>

<span class="token comment">// Convert bipolar value into scalar 0..1 scale</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 0.5</span>
Bipolar<span class="token punctuation">.</span><span class="token function">toScalar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1</span></code></pre><p>A common need is to nudge a bipolar value toward its neutral value of zero. We may not care if it's currently above or below zero, we just want to draw it down to zero. <a href="https://clinth.github.io/ixfx/functions/Data.Bipolar.towardZero.html"><code>towardZero</code></a> helps.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Syntax:</span>
<span class="token comment">// towardZero(bipolarValue, amountToNudgeBy);</span>

<span class="token comment">// Nudge -1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -0.9</span>

<span class="token comment">// Nudge 1 toward zero by 0.1</span>
Bipolar<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.9</span></code></pre><p>If you're working with bipolar values a lot, there's also <a href="https://clinth.github.io/ixfx/modules/Data.Bipolar.immutable.html">Data.Bipolar.immutable</a>. It returns an immutable wrapper around a value, hanging the same functions off it.</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// If you don't provide an initial value, 0 is used</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 0}</span>

<span class="token comment">// Add 0.1 to the bipolar value</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get the value as a number with value property</span>
b<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 0.1</span></code></pre><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Initialise a bipolar value with a default of 1</span>
b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: 0.5 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// { value: 0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// { value: -0.05 }</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">towardZero</span><span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: -0.04 }</span>

<span class="token comment">// Interpolate to a value of 1 by 0.1</span>
b <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">interpolate</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The wrapper converts to a number when needed:</p><pre class="language-js"><code class="language-js"><span class="token comment">// repl-pad</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bipolar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'https://unpkg.com/ixfx/dist/data.js'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> Bipolar<span class="token punctuation">.</span><span class="token function">immutable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 1 }</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// x = 11</span></code></pre>` })}`;
});

export { $$metadata, $$Normalising as default, frontmatter, metadata };
