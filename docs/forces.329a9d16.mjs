import { c as createMetadata, a as createAstro, b as createComponent, r as render, d as renderComponent } from './chunks/index.7bfc2e7e.mjs';
import { $ as $$module1, a as $$MainLayout } from './chunks/MainLayout.fae6d6b7.mjs';
import 'shorthash';
import 'serialize-javascript';
import 'preact/hooks';
import 'preact/jsx-runtime';
import 'lit';

const metadata = { "headers": [{ "depth": 2, "slug": "force-settings", "text": "Force settings" }, { "depth": 2, "slug": "force-functions", "text": "Force functions" }, { "depth": 3, "slug": "velocity--acceleration", "text": "Velocity & acceleration" }, { "depth": 3, "slug": "wind-and-gravity", "text": "Wind and gravity" }, { "depth": 3, "slug": "friction--drag", "text": "Friction & drag" }, { "depth": 3, "slug": "pendulum", "text": "Pendulum" }, { "depth": 3, "slug": "targeting", "text": "Targeting" }, { "depth": 3, "slug": "attraction", "text": "Attraction" }, { "depth": 3, "slug": "orientation", "text": "Orientation" }, { "depth": 2, "slug": "applying-forces-to-many-things", "text": "Applying forces to many things" }, { "depth": 2, "slug": "dynamic-forces", "text": "Dynamic forces" }, { "depth": 3, "slug": "demos", "text": "Demos" }], "source": "\n<script type=\"module\" hoist>\n  import '/src/components/ReplPad';\n<\/script>\n\n<div class=\"tip\">\n<ul>\n<li>API Reference <a href=\"https://clinth.github.io/ixfx/modules/Modulation.Forces.html\">Modulation.Forces module</a></li>\n<li><a href=\"https://clinth.github.io/ixfx-demos/modulation/\">Demos</a></li>\n<li>Related: <a href=\"../oscillator/#springs\">Oscillator.spring</a>: spring force</li>\n</ul>\n</div>\n\nThe Forces module is a bit of an adaptation of Daniel Shiffman's [Nature of Code](https://natureofcode.com/book/) examples. If you're interested in learning the math, please see that excellent resource.\n\nThis demo below shows basic movement of gravity, drag, wind and friction. [See it online](https://clinth.github.io/ixfx-demos/modulation/forces-basic/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic)). It also demonstrates selectively applying forces, in this case, based on the position of the thing.\n\n<demo-element style=\"height:40vh\" title=\"Basic forces\" src=\"/modulation/forces-basic/\" />\n\nixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.\n\nFirst, a thing that can be affected by a force has the type [`ForceAffected`](https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html). That means it has some of these properties:\n\n```typescript\ntype ForceAffected = {\n  position?:Point\n  velocity?:Point\n  acceleration?:Point\n  mass?:number\n  angularAcceleration?:number;\n  angularVelocity?:number;\n  angle?:number;\n};\n```\n\nA basic thing, able to be force-affected can be as simple as:\n\n```js\nconst thing = {\n  position: { x: 0.5, y: 0.5 },\n  mass: 1\n}\n```\n\nVelocity and acceleration are _vectors_, capturing movement in both _x_ & _y_ directions. They are also signed. A negative _x_ value will mean that the thing is moving left, while a positive _x_ value will mean it is moving to the right.\n\nNow, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.\n\nWe first create the forces we want to use.\n\nFor example, to give our thing some acceleration we might create an [acceleration force](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html), and to slow it down, some friction based on [velocity](https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html).\n\n```js\nimport { Forces } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n\n// Accelerate to right with a force of { x:0.1, y:0 }\nconst accelForce = Forces.accelerationForce({\n  x: 0.1,\n  y: 0\n})\n\n// Reduce velocity due to friction\nconst frictionForce = Forces.velocityForce(0.00001);\n```\n\nNow that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time. \n\n[`Forces.apply`](https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html) takes an input 'thing' (ie. a [`ForceAffected`](https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html) object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.\n\n```js\n// Initialise thing\nlet thing = { position: { x: 0.5, y: 0.5 }, mass: 1 };\n\nconst loop = () => {\n  // Apply accelForce and frictionForce on to thing,\n  // setting it back again to the same variable\n  thing = Forces.apply(thing,\n    accelForce, \n    frictionForce);\n  \n  // eg. use newly calculated position\n  moveElement(el, thing.position);\n\n  // Keep loop running\n  window.requestAnimationFrame(loop);\n}\nloop();\n```\n\nAfter applying a force, properties will be updated - typically its `position` and `velocity`. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.\n\nOnce initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.\n\nThe object you pass in to `Forces.apply` could have additional properties, these are preserved.\n\n## Force settings\n\nWhen working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.\n\nFor coordinates, it's best to keep them relative (ie. _x_ and _y_ on a 0..1 scale), and map them to screen coordinates at only when necessary.\n\n\n## Force functions\n\n\n### Velocity & acceleration\n\nBefore getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via [`accelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html) and let `Forces.apply` integrate that into an updated velocity and position.\n\n<demo-element style=\"height:40vh\" title=\"Acceleration\" src=\"/modulation/forces-accel/\" />\n\n\nThis demo computes an acceleration based on the movement of the pointer (via [point tracker](../../data/trackers/#point)). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call `Forces.accelerationForce` each time we apply.\n\n```js\nthing = Forces.apply(thing, \n        Forces.accelerationForce(avg, `dampen`));\n```\n\n(don't forget you can click the 'Source' button in the demo titlebar to see the full code)\n\nNote how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.\n\nAlong with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things\n\n<demo-element style=\"height:40vh\" title=\"Acceleration of particles\" src=\"/modulation/forces-accel-particles/\" />\n\n\n### Wind and gravity\n\nWind and gravity can be modelled as affecting the acceleration of a thing with [`accelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html)\n\nFor wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:\n\n```js\nconst windForce = Forces.accelerationForce({\n   x: 0.00001, \n   y: 0 \n   }, `dampen`\n);\n```\n\nGravity won't affect the _x_ value, but rather _y_, and in this case the force is multiplied with the mass (heavier will fall faster):\n\n```js\nconst gravityForce = Forces.accelerationForce({ \n  x: 0, \n  y: 0.0001 \n  }, `multiply`\n);\n```\n\n### Friction & drag\n\nFriction reduces speed with the [`velocityForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html). This force essentially scales the current speed by the force value. By passing `multiply` as the second parameter, we can enhance the force with mass - heavier object, more friction.\n\n```js\nconst friction = Forces.velocityForce(0.00001, `multiply`);\n```\n\nDrag also reduces speed, and is based on the the _square_ of the current velocity. We can use [`magnitudeForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html). This produces a non-linear relation, compared with `velocityForce`. By passing `dampen` as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.\n\n```js\nconst drag = Forces.magnitudeForce(0.1, `dampen`)\n```\n\n### Pendulum\n\nThe [`pendulumForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html) works with angular velocity and angle of a thing.\n\n<demo-element style=\"height:40vh\" title=\"Pendulm force\" src=\"/modulation/forces-pendulum/\" />\n\nTo use, we have to define a point by which the thing is pinned, and its distance.\n\n```js\nconst thing = {\n  position: { x: 0.5, y: 1 }\n}\nconst pinnedAt = { x: 0.5, y: 0.5 };\nconst pendulumForce = Forces.pendulumForce(pinnedAt, { length: 0.4 });\n```\n\nThe other options for the pendulum force are: _damping_, an amount to reduce velocity by, and _speed_, which is the maximum swing speed.\n\n```js\nconst pendulumForce = Forces.pendulumForce(pinnedAt, { \n  length: 0.4,\n  damping: 0.5, // default 0.995, ie 0.5% loss\n  speed: 0.1    // default 0.001\n});\n```\n\nIf _length_ is not defined, the force will use the current distance between the target and thing.\n\n### Targeting\n\n[`targetForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html) is a composite force which pushes a thing toward a target position.\n\n```js\n// Target the relative position of x:0.2, y:0.4\nconst targetForce = Forces.targetForce({x: 0.2, y: 0.4 });\n```\n\nIt has some options. `diminishBy` scales the acceleration speed (default 0.0001). `range` allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.\n\n```js\nconst targetForce = Forces.targetForce(targetPos, {\n  diminishBy: 0.1,\n  range: { x: 0.01, y: 0.01} // If we're within 1% of target, that's good enough\n});\n```\n\n<demo-element style=\"height:40vh\" title=\"Target force\" src=\"/modulation/forces-target/\" />\n\n### Attraction\n\nThe [`attractionForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html) attracts (or repels) a thing based on a list of attractors.\n\n<demo-element style=\"height:40vh\" title=\"Attraction force\" src=\"/modulation/forces-attractor/\" />\n\nFor example, lets say we have earth and sun\n\n```js\nconst sun = { mass: 1000, position: Math.random() };\nconst earth = { mass: 0.01, position: Math.random() };\n```\n\nThe sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:\n\n```js\n// Init the sun's attractive force\nconst sunAttractionForce = Forces.attractionForce(sun, 0.1);\n\n// Apply the force to earth\nearth = Forces.apply(earth, sunAttractionForce);\n```\n\nThe force can take a third parameter for the range at which the force is applied:\n\n```js\n// Only apply force when distance between sun and thing is between 1-10%\nconst sunAttractionForce = Forces.attractionForce(sun, 0.1, { max: 0.1, min: 0.01});\n```\n\n### Orientation\n\nTo make objects orient in the direction of travel, use [`orientationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html). This is also demonstrated in the attraction force demo above.\n\nThe parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.\n\n```js\nconst orientationForce = Forces.orientationForce(1);\n```\n\nThe orientation force is a handy composite which applies the following forces in order:\n* [`angularForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html): updates angle and velocity based on angular acceleration & velocity\n* [`angleFromAccelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html): update angularAcceleration based on acceleration's vector,  and\n*  [`angleFromVelocityForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html): update angle based on velocity, to point in direction of travel\n\n## Applying forces to many things\n\nUse the regular Javascript constructs to apply forces to many objects.\n\n```js\n// Initial things\nlet things = [ /* lots of things */ ]\n// Things now contains a set of things after force has been applied\nthings = things.map(t => Forces.apply(t, gravityForce));\n```\n\n## Dynamic forces\n\nAt times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:\n\n```js\nconst thing = { \n  position: Points.random(),\n  smoothness: Math.random(),\n  mass: 1\n};\n\n// Init force\nconst friction = Forces.velocityForce(0.00001, `multiply`);\nconst loop() => {\n  // When applying force it will use the static values\n  thing = Forces.apply(thing, friction);\n  ...\n}\n```\n\nInstead, create the force function when we call `apply`:\n\n```js\nconst loop() => {\n  thing = Forces.apply(thing, \n    Force.velocityForce(0.00001 * thing.smoothness)\n  );\n  ...\n}\n```\n\nWe can also opt to dynamically apply a force or not, based on some state.\n\nIn this example, we assume `gravityApplies` is a property of the thing. If the value is _true_, we apply a gravity force, if not a 'null' force which does nothing:\n\n```js\nForces.apply(thing,\n  dragForce,\n  thing.gravityApplies ? gravityForce : Forces.nullForce,\n  windForce\n);\n```\n\nThis technique is used in the [basic forces demo](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic) to selectively apply forces depending on whether the thing is in 'air' or 'water'\n\n\n### Demos\n\n* [Attractor force](https://clinth.github.io/ixfx-demos/modulation/forces-attractor/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor))\n* [Basic forces](https://clinth.github.io/ixfx-demos/modulation/forces-basic/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic)): wind, gravity, drag, friction\n* [Pendulum demo](https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/)\n([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum))\n* [Target force](https://clinth.github.io/ixfx-demos/modulation/forces-target/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target))\n", "html": `<script type="module" hoist>
  import '/src/components/ReplPad';
<\/script>
<div class="tip">
<ul>
<li>API Reference <a href="https://clinth.github.io/ixfx/modules/Modulation.Forces.html">Modulation.Forces module</a></li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/">Demos</a></li>
<li>Related: <a href="../oscillator/#springs">Oscillator.spring</a>: spring force</li>
</ul>
</div>
<p>The Forces module is a bit of an adaptation of Daniel Shiffman's <a href="https://natureofcode.com/book/">Nature of Code</a> examples. If you're interested in learning the math, please see that excellent resource.</p>
<p>This demo below shows basic movement of gravity, drag, wind and friction. <a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">See it online</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>). It also demonstrates selectively applying forces, in this case, based on the position of the thing.</p>
<demo-element style="height:40vh" title="Basic forces" src="/modulation/forces-basic/" />
<p>ixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.</p>
<p>First, a thing that can be affected by a force has the type <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code is:raw>ForceAffected</code></a>. That means it has some of these properties:</p>
<pre class="language-typescript"><code is:raw class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ForceAffected</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  position<span class="token operator">?</span><span class="token operator">:</span>Point
  velocity<span class="token operator">?</span><span class="token operator">:</span>Point
  acceleration<span class="token operator">?</span><span class="token operator">:</span>Point
  mass<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>
  angularAcceleration<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angularVelocity<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angle<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>A basic thing, able to be force-affected can be as simple as:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre>
<p>Velocity and acceleration are <em>vectors</em>, capturing movement in both <em>x</em> &#x26; <em>y</em> directions. They are also signed. A negative <em>x</em> value will mean that the thing is moving left, while a positive <em>x</em> value will mean it is moving to the right.</p>
<p>Now, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.</p>
<p>We first create the forces we want to use.</p>
<p>For example, to give our thing some acceleration we might create an <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html">acceleration force</a>, and to slow it down, some friction based on <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html">velocity</a>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Forces <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://unpkg.com/ixfx/dist/modulation.js"</span>

<span class="token comment">// Accelerate to right with a force of { x:0.1, y:0 }</span>
<span class="token keyword">const</span> accelForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Reduce velocity due to friction</span>
<span class="token keyword">const</span> frictionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Now that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time.</p>
<p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html"><code is:raw>Forces.apply</code></a> takes an input 'thing' (ie. a <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code is:raw>ForceAffected</code></a> object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Initialise thing</span>
<span class="token keyword">let</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Apply accelForce and frictionForce on to thing,</span>
  <span class="token comment">// setting it back again to the same variable</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
    accelForce<span class="token punctuation">,</span> 
    frictionForce<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// eg. use newly calculated position</span>
  <span class="token function">moveElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> thing<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Keep loop running</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>After applying a force, properties will be updated - typically its <code is:raw>position</code> and <code is:raw>velocity</code>. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.</p>
<p>Once initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.</p>
<p>The object you pass in to <code is:raw>Forces.apply</code> could have additional properties, these are preserved.</p>
<h2 id="force-settings">Force settings</h2>
<p>When working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.</p>
<p>For coordinates, it's best to keep them relative (ie. <em>x</em> and <em>y</em> on a 0..1 scale), and map them to screen coordinates at only when necessary.</p>
<h2 id="force-functions">Force functions</h2>
<h3 id="velocity--acceleration">Velocity &#x26; acceleration</h3>
<p>Before getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code is:raw>accelerationForce</code></a> and let <code is:raw>Forces.apply</code> integrate that into an updated velocity and position.</p>
<demo-element style="height:40vh" title="Acceleration" src="/modulation/forces-accel/" />
<p>This demo computes an acceleration based on the movement of the pointer (via <a href="../../data/trackers/#point">point tracker</a>). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call <code is:raw>Forces.accelerationForce</code> each time we apply.</p>
<pre class="language-js"><code is:raw class="language-js">thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
        Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span>avg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>(don't forget you can click the 'Source' button in the demo titlebar to see the full code)</p>
<p>Note how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.</p>
<p>Along with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things</p>
<demo-element style="height:40vh" title="Acceleration of particles" src="/modulation/forces-accel-particles/" />
<h3 id="wind-and-gravity">Wind and gravity</h3>
<p>Wind and gravity can be modelled as affecting the acceleration of a thing with <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code is:raw>accelerationForce</code></a></p>
<p>For wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> windForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.00001</span><span class="token punctuation">,</span> 
   <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> 
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Gravity won't affect the <em>x</em> value, but rather <em>y</em>, and in this case the force is multiplied with the mass (heavier will fall faster):</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> gravityForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.0001</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="friction--drag">Friction &#x26; drag</h3>
<p>Friction reduces speed with the <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html"><code is:raw>velocityForce</code></a>. This force essentially scales the current speed by the force value. By passing <code is:raw>multiply</code> as the second parameter, we can enhance the force with mass - heavier object, more friction.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Drag also reduces speed, and is based on the the <em>square</em> of the current velocity. We can use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html"><code is:raw>magnitudeForce</code></a>. This produces a non-linear relation, compared with <code is:raw>velocityForce</code>. By passing <code is:raw>dampen</code> as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> drag <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">magnitudeForce</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></code></pre>
<h3 id="pendulum">Pendulum</h3>
<p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html"><code is:raw>pendulumForce</code></a> works with angular velocity and angle of a thing.</p>
<demo-element style="height:40vh" title="Pendulm force" src="/modulation/forces-pendulum/" />
<p>To use, we have to define a point by which the thing is pinned, and its distance.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> pinnedAt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The other options for the pendulum force are: <em>damping</em>, an amount to reduce velocity by, and <em>speed</em>, which is the maximum swing speed.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
  <span class="token literal-property property">damping</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// default 0.995, ie 0.5% loss</span>
  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">0.1</span>    <span class="token comment">// default 0.001</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If <em>length</em> is not defined, the force will use the current distance between the target and thing.</p>
<h3 id="targeting">Targeting</h3>
<p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html"><code is:raw>targetForce</code></a> is a composite force which pushes a thing toward a target position.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Target the relative position of x:0.2, y:0.4</span>
<span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It has some options. <code is:raw>diminishBy</code> scales the acceleration speed (default 0.0001). <code is:raw>range</code> allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span>targetPos<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">diminishBy</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">range</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span> <span class="token comment">// If we're within 1% of target, that's good enough</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<demo-element style="height:40vh" title="Target force" src="/modulation/forces-target/" />
<h3 id="attraction">Attraction</h3>
<p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html"><code is:raw>attractionForce</code></a> attracts (or repels) a thing based on a list of attractors.</p>
<demo-element style="height:40vh" title="Attraction force" src="/modulation/forces-attractor/" />
<p>For example, lets say we have earth and sun</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> sun <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>The sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Init the sun's attractive force</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Apply the force to earth</span>
earth <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>earth<span class="token punctuation">,</span> sunAttractionForce<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The force can take a third parameter for the range at which the force is applied:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Only apply force when distance between sun and thing is between 1-10%</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="orientation">Orientation</h3>
<p>To make objects orient in the direction of travel, use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html"><code is:raw>orientationForce</code></a>. This is also demonstrated in the attraction force demo above.</p>
<p>The parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> orientationForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">orientationForce</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The orientation force is a handy composite which applies the following forces in order:</p>
<ul>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html"><code is:raw>angularForce</code></a>: updates angle and velocity based on angular acceleration &#x26; velocity</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html"><code is:raw>angleFromAccelerationForce</code></a>: update angularAcceleration based on acceleration's vector,  and</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html"><code is:raw>angleFromVelocityForce</code></a>: update angle based on velocity, to point in direction of travel</li>
</ul>
<h2 id="applying-forces-to-many-things">Applying forces to many things</h2>
<p>Use the regular Javascript constructs to apply forces to many objects.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Initial things</span>
<span class="token keyword">let</span> things <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment">/* lots of things */</span> <span class="token punctuation">]</span>
<span class="token comment">// Things now contains a set of things after force has been applied</span>
things <span class="token operator">=</span> things<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> gravityForce<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="dynamic-forces">Dynamic forces</h2>
<p>At times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">position</span><span class="token operator">:</span> Points<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">smoothness</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Init force</span>
<span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// When applying force it will use the static values</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> friction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
<p>Instead, create the force function when we call <code is:raw>apply</code>:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
    Force<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span> <span class="token operator">*</span> thing<span class="token punctuation">.</span>smoothness<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
<p>We can also opt to dynamically apply a force or not, based on some state.</p>
<p>In this example, we assume <code is:raw>gravityApplies</code> is a property of the thing. If the value is <em>true</em>, we apply a gravity force, if not a 'null' force which does nothing:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
  dragForce<span class="token punctuation">,</span>
  thing<span class="token punctuation">.</span>gravityApplies <span class="token operator">?</span> gravityForce <span class="token operator">:</span> Forces<span class="token punctuation">.</span>nullForce<span class="token punctuation">,</span>
  windForce
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This technique is used in the <a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">basic forces demo</a> to selectively apply forces depending on whether the thing is in 'air' or 'water'</p>
<h3 id="demos">Demos</h3>
<ul>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-attractor/">Attractor force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">Basic forces</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>): wind, gravity, drag, friction</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/">Pendulum demo</a>
(<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-target/">Target force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target">source</a>)</li>
</ul>` };
const frontmatter = { "title": "Forces", "astro": { "headers": [{ "depth": 2, "slug": "force-settings", "text": "Force settings" }, { "depth": 2, "slug": "force-functions", "text": "Force functions" }, { "depth": 3, "slug": "velocity--acceleration", "text": "Velocity & acceleration" }, { "depth": 3, "slug": "wind-and-gravity", "text": "Wind and gravity" }, { "depth": 3, "slug": "friction--drag", "text": "Friction & drag" }, { "depth": 3, "slug": "pendulum", "text": "Pendulum" }, { "depth": 3, "slug": "targeting", "text": "Targeting" }, { "depth": 3, "slug": "attraction", "text": "Attraction" }, { "depth": 3, "slug": "orientation", "text": "Orientation" }, { "depth": 2, "slug": "applying-forces-to-many-things", "text": "Applying forces to many things" }, { "depth": 2, "slug": "dynamic-forces", "text": "Dynamic forces" }, { "depth": 3, "slug": "demos", "text": "Demos" }], "source": "\n<script type=\"module\" hoist>\n  import '/src/components/ReplPad';\n<\/script>\n\n<div class=\"tip\">\n<ul>\n<li>API Reference <a href=\"https://clinth.github.io/ixfx/modules/Modulation.Forces.html\">Modulation.Forces module</a></li>\n<li><a href=\"https://clinth.github.io/ixfx-demos/modulation/\">Demos</a></li>\n<li>Related: <a href=\"../oscillator/#springs\">Oscillator.spring</a>: spring force</li>\n</ul>\n</div>\n\nThe Forces module is a bit of an adaptation of Daniel Shiffman's [Nature of Code](https://natureofcode.com/book/) examples. If you're interested in learning the math, please see that excellent resource.\n\nThis demo below shows basic movement of gravity, drag, wind and friction. [See it online](https://clinth.github.io/ixfx-demos/modulation/forces-basic/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic)). It also demonstrates selectively applying forces, in this case, based on the position of the thing.\n\n<demo-element style=\"height:40vh\" title=\"Basic forces\" src=\"/modulation/forces-basic/\" />\n\nixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.\n\nFirst, a thing that can be affected by a force has the type [`ForceAffected`](https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html). That means it has some of these properties:\n\n```typescript\ntype ForceAffected = {\n  position?:Point\n  velocity?:Point\n  acceleration?:Point\n  mass?:number\n  angularAcceleration?:number;\n  angularVelocity?:number;\n  angle?:number;\n};\n```\n\nA basic thing, able to be force-affected can be as simple as:\n\n```js\nconst thing = {\n  position: { x: 0.5, y: 0.5 },\n  mass: 1\n}\n```\n\nVelocity and acceleration are _vectors_, capturing movement in both _x_ & _y_ directions. They are also signed. A negative _x_ value will mean that the thing is moving left, while a positive _x_ value will mean it is moving to the right.\n\nNow, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.\n\nWe first create the forces we want to use.\n\nFor example, to give our thing some acceleration we might create an [acceleration force](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html), and to slow it down, some friction based on [velocity](https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html).\n\n```js\nimport { Forces } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n\n// Accelerate to right with a force of { x:0.1, y:0 }\nconst accelForce = Forces.accelerationForce({\n  x: 0.1,\n  y: 0\n})\n\n// Reduce velocity due to friction\nconst frictionForce = Forces.velocityForce(0.00001);\n```\n\nNow that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time. \n\n[`Forces.apply`](https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html) takes an input 'thing' (ie. a [`ForceAffected`](https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html) object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.\n\n```js\n// Initialise thing\nlet thing = { position: { x: 0.5, y: 0.5 }, mass: 1 };\n\nconst loop = () => {\n  // Apply accelForce and frictionForce on to thing,\n  // setting it back again to the same variable\n  thing = Forces.apply(thing,\n    accelForce, \n    frictionForce);\n  \n  // eg. use newly calculated position\n  moveElement(el, thing.position);\n\n  // Keep loop running\n  window.requestAnimationFrame(loop);\n}\nloop();\n```\n\nAfter applying a force, properties will be updated - typically its `position` and `velocity`. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.\n\nOnce initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.\n\nThe object you pass in to `Forces.apply` could have additional properties, these are preserved.\n\n## Force settings\n\nWhen working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.\n\nFor coordinates, it's best to keep them relative (ie. _x_ and _y_ on a 0..1 scale), and map them to screen coordinates at only when necessary.\n\n\n## Force functions\n\n\n### Velocity & acceleration\n\nBefore getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via [`accelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html) and let `Forces.apply` integrate that into an updated velocity and position.\n\n<demo-element style=\"height:40vh\" title=\"Acceleration\" src=\"/modulation/forces-accel/\" />\n\n\nThis demo computes an acceleration based on the movement of the pointer (via [point tracker](../../data/trackers/#point)). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call `Forces.accelerationForce` each time we apply.\n\n```js\nthing = Forces.apply(thing, \n        Forces.accelerationForce(avg, `dampen`));\n```\n\n(don't forget you can click the 'Source' button in the demo titlebar to see the full code)\n\nNote how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.\n\nAlong with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things\n\n<demo-element style=\"height:40vh\" title=\"Acceleration of particles\" src=\"/modulation/forces-accel-particles/\" />\n\n\n### Wind and gravity\n\nWind and gravity can be modelled as affecting the acceleration of a thing with [`accelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html)\n\nFor wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:\n\n```js\nconst windForce = Forces.accelerationForce({\n   x: 0.00001, \n   y: 0 \n   }, `dampen`\n);\n```\n\nGravity won't affect the _x_ value, but rather _y_, and in this case the force is multiplied with the mass (heavier will fall faster):\n\n```js\nconst gravityForce = Forces.accelerationForce({ \n  x: 0, \n  y: 0.0001 \n  }, `multiply`\n);\n```\n\n### Friction & drag\n\nFriction reduces speed with the [`velocityForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html). This force essentially scales the current speed by the force value. By passing `multiply` as the second parameter, we can enhance the force with mass - heavier object, more friction.\n\n```js\nconst friction = Forces.velocityForce(0.00001, `multiply`);\n```\n\nDrag also reduces speed, and is based on the the _square_ of the current velocity. We can use [`magnitudeForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html). This produces a non-linear relation, compared with `velocityForce`. By passing `dampen` as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.\n\n```js\nconst drag = Forces.magnitudeForce(0.1, `dampen`)\n```\n\n### Pendulum\n\nThe [`pendulumForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html) works with angular velocity and angle of a thing.\n\n<demo-element style=\"height:40vh\" title=\"Pendulm force\" src=\"/modulation/forces-pendulum/\" />\n\nTo use, we have to define a point by which the thing is pinned, and its distance.\n\n```js\nconst thing = {\n  position: { x: 0.5, y: 1 }\n}\nconst pinnedAt = { x: 0.5, y: 0.5 };\nconst pendulumForce = Forces.pendulumForce(pinnedAt, { length: 0.4 });\n```\n\nThe other options for the pendulum force are: _damping_, an amount to reduce velocity by, and _speed_, which is the maximum swing speed.\n\n```js\nconst pendulumForce = Forces.pendulumForce(pinnedAt, { \n  length: 0.4,\n  damping: 0.5, // default 0.995, ie 0.5% loss\n  speed: 0.1    // default 0.001\n});\n```\n\nIf _length_ is not defined, the force will use the current distance between the target and thing.\n\n### Targeting\n\n[`targetForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html) is a composite force which pushes a thing toward a target position.\n\n```js\n// Target the relative position of x:0.2, y:0.4\nconst targetForce = Forces.targetForce({x: 0.2, y: 0.4 });\n```\n\nIt has some options. `diminishBy` scales the acceleration speed (default 0.0001). `range` allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.\n\n```js\nconst targetForce = Forces.targetForce(targetPos, {\n  diminishBy: 0.1,\n  range: { x: 0.01, y: 0.01} // If we're within 1% of target, that's good enough\n});\n```\n\n<demo-element style=\"height:40vh\" title=\"Target force\" src=\"/modulation/forces-target/\" />\n\n### Attraction\n\nThe [`attractionForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html) attracts (or repels) a thing based on a list of attractors.\n\n<demo-element style=\"height:40vh\" title=\"Attraction force\" src=\"/modulation/forces-attractor/\" />\n\nFor example, lets say we have earth and sun\n\n```js\nconst sun = { mass: 1000, position: Math.random() };\nconst earth = { mass: 0.01, position: Math.random() };\n```\n\nThe sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:\n\n```js\n// Init the sun's attractive force\nconst sunAttractionForce = Forces.attractionForce(sun, 0.1);\n\n// Apply the force to earth\nearth = Forces.apply(earth, sunAttractionForce);\n```\n\nThe force can take a third parameter for the range at which the force is applied:\n\n```js\n// Only apply force when distance between sun and thing is between 1-10%\nconst sunAttractionForce = Forces.attractionForce(sun, 0.1, { max: 0.1, min: 0.01});\n```\n\n### Orientation\n\nTo make objects orient in the direction of travel, use [`orientationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html). This is also demonstrated in the attraction force demo above.\n\nThe parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.\n\n```js\nconst orientationForce = Forces.orientationForce(1);\n```\n\nThe orientation force is a handy composite which applies the following forces in order:\n* [`angularForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html): updates angle and velocity based on angular acceleration & velocity\n* [`angleFromAccelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html): update angularAcceleration based on acceleration's vector,  and\n*  [`angleFromVelocityForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html): update angle based on velocity, to point in direction of travel\n\n## Applying forces to many things\n\nUse the regular Javascript constructs to apply forces to many objects.\n\n```js\n// Initial things\nlet things = [ /* lots of things */ ]\n// Things now contains a set of things after force has been applied\nthings = things.map(t => Forces.apply(t, gravityForce));\n```\n\n## Dynamic forces\n\nAt times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:\n\n```js\nconst thing = { \n  position: Points.random(),\n  smoothness: Math.random(),\n  mass: 1\n};\n\n// Init force\nconst friction = Forces.velocityForce(0.00001, `multiply`);\nconst loop() => {\n  // When applying force it will use the static values\n  thing = Forces.apply(thing, friction);\n  ...\n}\n```\n\nInstead, create the force function when we call `apply`:\n\n```js\nconst loop() => {\n  thing = Forces.apply(thing, \n    Force.velocityForce(0.00001 * thing.smoothness)\n  );\n  ...\n}\n```\n\nWe can also opt to dynamically apply a force or not, based on some state.\n\nIn this example, we assume `gravityApplies` is a property of the thing. If the value is _true_, we apply a gravity force, if not a 'null' force which does nothing:\n\n```js\nForces.apply(thing,\n  dragForce,\n  thing.gravityApplies ? gravityForce : Forces.nullForce,\n  windForce\n);\n```\n\nThis technique is used in the [basic forces demo](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic) to selectively apply forces depending on whether the thing is in 'air' or 'water'\n\n\n### Demos\n\n* [Attractor force](https://clinth.github.io/ixfx-demos/modulation/forces-attractor/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor))\n* [Basic forces](https://clinth.github.io/ixfx-demos/modulation/forces-basic/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic)): wind, gravity, drag, friction\n* [Pendulum demo](https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/)\n([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum))\n* [Target force](https://clinth.github.io/ixfx-demos/modulation/forces-target/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target))\n", "html": `<script type="module" hoist>
  import '/src/components/ReplPad';
<\/script>
<div class="tip">
<ul>
<li>API Reference <a href="https://clinth.github.io/ixfx/modules/Modulation.Forces.html">Modulation.Forces module</a></li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/">Demos</a></li>
<li>Related: <a href="../oscillator/#springs">Oscillator.spring</a>: spring force</li>
</ul>
</div>
<p>The Forces module is a bit of an adaptation of Daniel Shiffman's <a href="https://natureofcode.com/book/">Nature of Code</a> examples. If you're interested in learning the math, please see that excellent resource.</p>
<p>This demo below shows basic movement of gravity, drag, wind and friction. <a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">See it online</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>). It also demonstrates selectively applying forces, in this case, based on the position of the thing.</p>
<demo-element style="height:40vh" title="Basic forces" src="/modulation/forces-basic/" />
<p>ixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.</p>
<p>First, a thing that can be affected by a force has the type <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code is:raw>ForceAffected</code></a>. That means it has some of these properties:</p>
<pre class="language-typescript"><code is:raw class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ForceAffected</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  position<span class="token operator">?</span><span class="token operator">:</span>Point
  velocity<span class="token operator">?</span><span class="token operator">:</span>Point
  acceleration<span class="token operator">?</span><span class="token operator">:</span>Point
  mass<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>
  angularAcceleration<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angularVelocity<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angle<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>A basic thing, able to be force-affected can be as simple as:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre>
<p>Velocity and acceleration are <em>vectors</em>, capturing movement in both <em>x</em> &#x26; <em>y</em> directions. They are also signed. A negative <em>x</em> value will mean that the thing is moving left, while a positive <em>x</em> value will mean it is moving to the right.</p>
<p>Now, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.</p>
<p>We first create the forces we want to use.</p>
<p>For example, to give our thing some acceleration we might create an <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html">acceleration force</a>, and to slow it down, some friction based on <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html">velocity</a>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Forces <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://unpkg.com/ixfx/dist/modulation.js"</span>

<span class="token comment">// Accelerate to right with a force of { x:0.1, y:0 }</span>
<span class="token keyword">const</span> accelForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Reduce velocity due to friction</span>
<span class="token keyword">const</span> frictionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Now that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time.</p>
<p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html"><code is:raw>Forces.apply</code></a> takes an input 'thing' (ie. a <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code is:raw>ForceAffected</code></a> object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Initialise thing</span>
<span class="token keyword">let</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Apply accelForce and frictionForce on to thing,</span>
  <span class="token comment">// setting it back again to the same variable</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
    accelForce<span class="token punctuation">,</span> 
    frictionForce<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// eg. use newly calculated position</span>
  <span class="token function">moveElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> thing<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Keep loop running</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>After applying a force, properties will be updated - typically its <code is:raw>position</code> and <code is:raw>velocity</code>. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.</p>
<p>Once initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.</p>
<p>The object you pass in to <code is:raw>Forces.apply</code> could have additional properties, these are preserved.</p>
<h2 id="force-settings">Force settings</h2>
<p>When working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.</p>
<p>For coordinates, it's best to keep them relative (ie. <em>x</em> and <em>y</em> on a 0..1 scale), and map them to screen coordinates at only when necessary.</p>
<h2 id="force-functions">Force functions</h2>
<h3 id="velocity--acceleration">Velocity &#x26; acceleration</h3>
<p>Before getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code is:raw>accelerationForce</code></a> and let <code is:raw>Forces.apply</code> integrate that into an updated velocity and position.</p>
<demo-element style="height:40vh" title="Acceleration" src="/modulation/forces-accel/" />
<p>This demo computes an acceleration based on the movement of the pointer (via <a href="../../data/trackers/#point">point tracker</a>). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call <code is:raw>Forces.accelerationForce</code> each time we apply.</p>
<pre class="language-js"><code is:raw class="language-js">thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
        Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span>avg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>(don't forget you can click the 'Source' button in the demo titlebar to see the full code)</p>
<p>Note how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.</p>
<p>Along with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things</p>
<demo-element style="height:40vh" title="Acceleration of particles" src="/modulation/forces-accel-particles/" />
<h3 id="wind-and-gravity">Wind and gravity</h3>
<p>Wind and gravity can be modelled as affecting the acceleration of a thing with <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code is:raw>accelerationForce</code></a></p>
<p>For wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> windForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.00001</span><span class="token punctuation">,</span> 
   <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> 
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Gravity won't affect the <em>x</em> value, but rather <em>y</em>, and in this case the force is multiplied with the mass (heavier will fall faster):</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> gravityForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.0001</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="friction--drag">Friction &#x26; drag</h3>
<p>Friction reduces speed with the <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html"><code is:raw>velocityForce</code></a>. This force essentially scales the current speed by the force value. By passing <code is:raw>multiply</code> as the second parameter, we can enhance the force with mass - heavier object, more friction.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Drag also reduces speed, and is based on the the <em>square</em> of the current velocity. We can use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html"><code is:raw>magnitudeForce</code></a>. This produces a non-linear relation, compared with <code is:raw>velocityForce</code>. By passing <code is:raw>dampen</code> as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> drag <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">magnitudeForce</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></code></pre>
<h3 id="pendulum">Pendulum</h3>
<p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html"><code is:raw>pendulumForce</code></a> works with angular velocity and angle of a thing.</p>
<demo-element style="height:40vh" title="Pendulm force" src="/modulation/forces-pendulum/" />
<p>To use, we have to define a point by which the thing is pinned, and its distance.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> pinnedAt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The other options for the pendulum force are: <em>damping</em>, an amount to reduce velocity by, and <em>speed</em>, which is the maximum swing speed.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
  <span class="token literal-property property">damping</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// default 0.995, ie 0.5% loss</span>
  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">0.1</span>    <span class="token comment">// default 0.001</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If <em>length</em> is not defined, the force will use the current distance between the target and thing.</p>
<h3 id="targeting">Targeting</h3>
<p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html"><code is:raw>targetForce</code></a> is a composite force which pushes a thing toward a target position.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Target the relative position of x:0.2, y:0.4</span>
<span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It has some options. <code is:raw>diminishBy</code> scales the acceleration speed (default 0.0001). <code is:raw>range</code> allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span>targetPos<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">diminishBy</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">range</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span> <span class="token comment">// If we're within 1% of target, that's good enough</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<demo-element style="height:40vh" title="Target force" src="/modulation/forces-target/" />
<h3 id="attraction">Attraction</h3>
<p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html"><code is:raw>attractionForce</code></a> attracts (or repels) a thing based on a list of attractors.</p>
<demo-element style="height:40vh" title="Attraction force" src="/modulation/forces-attractor/" />
<p>For example, lets say we have earth and sun</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> sun <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>The sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Init the sun's attractive force</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Apply the force to earth</span>
earth <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>earth<span class="token punctuation">,</span> sunAttractionForce<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The force can take a third parameter for the range at which the force is applied:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Only apply force when distance between sun and thing is between 1-10%</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="orientation">Orientation</h3>
<p>To make objects orient in the direction of travel, use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html"><code is:raw>orientationForce</code></a>. This is also demonstrated in the attraction force demo above.</p>
<p>The parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> orientationForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">orientationForce</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The orientation force is a handy composite which applies the following forces in order:</p>
<ul>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html"><code is:raw>angularForce</code></a>: updates angle and velocity based on angular acceleration &#x26; velocity</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html"><code is:raw>angleFromAccelerationForce</code></a>: update angularAcceleration based on acceleration's vector,  and</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html"><code is:raw>angleFromVelocityForce</code></a>: update angle based on velocity, to point in direction of travel</li>
</ul>
<h2 id="applying-forces-to-many-things">Applying forces to many things</h2>
<p>Use the regular Javascript constructs to apply forces to many objects.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Initial things</span>
<span class="token keyword">let</span> things <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment">/* lots of things */</span> <span class="token punctuation">]</span>
<span class="token comment">// Things now contains a set of things after force has been applied</span>
things <span class="token operator">=</span> things<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> gravityForce<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="dynamic-forces">Dynamic forces</h2>
<p>At times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">position</span><span class="token operator">:</span> Points<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">smoothness</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Init force</span>
<span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// When applying force it will use the static values</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> friction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
<p>Instead, create the force function when we call <code is:raw>apply</code>:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
    Force<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span> <span class="token operator">*</span> thing<span class="token punctuation">.</span>smoothness<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
<p>We can also opt to dynamically apply a force or not, based on some state.</p>
<p>In this example, we assume <code is:raw>gravityApplies</code> is a property of the thing. If the value is <em>true</em>, we apply a gravity force, if not a 'null' force which does nothing:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
  dragForce<span class="token punctuation">,</span>
  thing<span class="token punctuation">.</span>gravityApplies <span class="token operator">?</span> gravityForce <span class="token operator">:</span> Forces<span class="token punctuation">.</span>nullForce<span class="token punctuation">,</span>
  windForce
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This technique is used in the <a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">basic forces demo</a> to selectively apply forces depending on whether the thing is in 'air' or 'water'</p>
<h3 id="demos">Demos</h3>
<ul>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-attractor/">Attractor force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">Basic forces</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>): wind, gravity, drag, friction</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/">Pendulum demo</a>
(<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-target/">Target force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target">source</a>)</li>
</ul>` } };
const $$metadata = createMetadata("/src/pages/modulation/forces.md", { modules: [{ module: $$module1, specifier: "../../layouts/MainLayout.astro", assert: {} }], hydratedComponents: [], clientOnlyComponents: [], hydrationDirectives: /* @__PURE__ */ new Set([]), hoisted: [{ type: "inline", value: `
  import '/src/components/ReplPad';
` }] });
const $$Astro = createAstro("/src/pages/modulation/forces.md", "https://clinth.github.io/ixfx-docs/", "file:///Users/af4766/repos/ixfx-docs/");
const $$Forces = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$Forces;
  const $$content = { "title": "Forces", "astro": { "headers": [{ "depth": 2, "slug": "force-settings", "text": "Force settings" }, { "depth": 2, "slug": "force-functions", "text": "Force functions" }, { "depth": 3, "slug": "velocity--acceleration", "text": "Velocity & acceleration" }, { "depth": 3, "slug": "wind-and-gravity", "text": "Wind and gravity" }, { "depth": 3, "slug": "friction--drag", "text": "Friction & drag" }, { "depth": 3, "slug": "pendulum", "text": "Pendulum" }, { "depth": 3, "slug": "targeting", "text": "Targeting" }, { "depth": 3, "slug": "attraction", "text": "Attraction" }, { "depth": 3, "slug": "orientation", "text": "Orientation" }, { "depth": 2, "slug": "applying-forces-to-many-things", "text": "Applying forces to many things" }, { "depth": 2, "slug": "dynamic-forces", "text": "Dynamic forces" }, { "depth": 3, "slug": "demos", "text": "Demos" }], "source": "\n<script type=\"module\" hoist>\n  import '/src/components/ReplPad';\n<\/script>\n\n<div class=\"tip\">\n<ul>\n<li>API Reference <a href=\"https://clinth.github.io/ixfx/modules/Modulation.Forces.html\">Modulation.Forces module</a></li>\n<li><a href=\"https://clinth.github.io/ixfx-demos/modulation/\">Demos</a></li>\n<li>Related: <a href=\"../oscillator/#springs\">Oscillator.spring</a>: spring force</li>\n</ul>\n</div>\n\nThe Forces module is a bit of an adaptation of Daniel Shiffman's [Nature of Code](https://natureofcode.com/book/) examples. If you're interested in learning the math, please see that excellent resource.\n\nThis demo below shows basic movement of gravity, drag, wind and friction. [See it online](https://clinth.github.io/ixfx-demos/modulation/forces-basic/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic)). It also demonstrates selectively applying forces, in this case, based on the position of the thing.\n\n<demo-element style=\"height:40vh\" title=\"Basic forces\" src=\"/modulation/forces-basic/\" />\n\nixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.\n\nFirst, a thing that can be affected by a force has the type [`ForceAffected`](https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html). That means it has some of these properties:\n\n```typescript\ntype ForceAffected = {\n  position?:Point\n  velocity?:Point\n  acceleration?:Point\n  mass?:number\n  angularAcceleration?:number;\n  angularVelocity?:number;\n  angle?:number;\n};\n```\n\nA basic thing, able to be force-affected can be as simple as:\n\n```js\nconst thing = {\n  position: { x: 0.5, y: 0.5 },\n  mass: 1\n}\n```\n\nVelocity and acceleration are _vectors_, capturing movement in both _x_ & _y_ directions. They are also signed. A negative _x_ value will mean that the thing is moving left, while a positive _x_ value will mean it is moving to the right.\n\nNow, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.\n\nWe first create the forces we want to use.\n\nFor example, to give our thing some acceleration we might create an [acceleration force](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html), and to slow it down, some friction based on [velocity](https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html).\n\n```js\nimport { Forces } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n\n// Accelerate to right with a force of { x:0.1, y:0 }\nconst accelForce = Forces.accelerationForce({\n  x: 0.1,\n  y: 0\n})\n\n// Reduce velocity due to friction\nconst frictionForce = Forces.velocityForce(0.00001);\n```\n\nNow that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time. \n\n[`Forces.apply`](https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html) takes an input 'thing' (ie. a [`ForceAffected`](https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html) object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.\n\n```js\n// Initialise thing\nlet thing = { position: { x: 0.5, y: 0.5 }, mass: 1 };\n\nconst loop = () => {\n  // Apply accelForce and frictionForce on to thing,\n  // setting it back again to the same variable\n  thing = Forces.apply(thing,\n    accelForce, \n    frictionForce);\n  \n  // eg. use newly calculated position\n  moveElement(el, thing.position);\n\n  // Keep loop running\n  window.requestAnimationFrame(loop);\n}\nloop();\n```\n\nAfter applying a force, properties will be updated - typically its `position` and `velocity`. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.\n\nOnce initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.\n\nThe object you pass in to `Forces.apply` could have additional properties, these are preserved.\n\n## Force settings\n\nWhen working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.\n\nFor coordinates, it's best to keep them relative (ie. _x_ and _y_ on a 0..1 scale), and map them to screen coordinates at only when necessary.\n\n\n## Force functions\n\n\n### Velocity & acceleration\n\nBefore getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via [`accelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html) and let `Forces.apply` integrate that into an updated velocity and position.\n\n<demo-element style=\"height:40vh\" title=\"Acceleration\" src=\"/modulation/forces-accel/\" />\n\n\nThis demo computes an acceleration based on the movement of the pointer (via [point tracker](../../data/trackers/#point)). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call `Forces.accelerationForce` each time we apply.\n\n```js\nthing = Forces.apply(thing, \n        Forces.accelerationForce(avg, `dampen`));\n```\n\n(don't forget you can click the 'Source' button in the demo titlebar to see the full code)\n\nNote how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.\n\nAlong with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things\n\n<demo-element style=\"height:40vh\" title=\"Acceleration of particles\" src=\"/modulation/forces-accel-particles/\" />\n\n\n### Wind and gravity\n\nWind and gravity can be modelled as affecting the acceleration of a thing with [`accelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html)\n\nFor wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:\n\n```js\nconst windForce = Forces.accelerationForce({\n   x: 0.00001, \n   y: 0 \n   }, `dampen`\n);\n```\n\nGravity won't affect the _x_ value, but rather _y_, and in this case the force is multiplied with the mass (heavier will fall faster):\n\n```js\nconst gravityForce = Forces.accelerationForce({ \n  x: 0, \n  y: 0.0001 \n  }, `multiply`\n);\n```\n\n### Friction & drag\n\nFriction reduces speed with the [`velocityForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html). This force essentially scales the current speed by the force value. By passing `multiply` as the second parameter, we can enhance the force with mass - heavier object, more friction.\n\n```js\nconst friction = Forces.velocityForce(0.00001, `multiply`);\n```\n\nDrag also reduces speed, and is based on the the _square_ of the current velocity. We can use [`magnitudeForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html). This produces a non-linear relation, compared with `velocityForce`. By passing `dampen` as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.\n\n```js\nconst drag = Forces.magnitudeForce(0.1, `dampen`)\n```\n\n### Pendulum\n\nThe [`pendulumForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html) works with angular velocity and angle of a thing.\n\n<demo-element style=\"height:40vh\" title=\"Pendulm force\" src=\"/modulation/forces-pendulum/\" />\n\nTo use, we have to define a point by which the thing is pinned, and its distance.\n\n```js\nconst thing = {\n  position: { x: 0.5, y: 1 }\n}\nconst pinnedAt = { x: 0.5, y: 0.5 };\nconst pendulumForce = Forces.pendulumForce(pinnedAt, { length: 0.4 });\n```\n\nThe other options for the pendulum force are: _damping_, an amount to reduce velocity by, and _speed_, which is the maximum swing speed.\n\n```js\nconst pendulumForce = Forces.pendulumForce(pinnedAt, { \n  length: 0.4,\n  damping: 0.5, // default 0.995, ie 0.5% loss\n  speed: 0.1    // default 0.001\n});\n```\n\nIf _length_ is not defined, the force will use the current distance between the target and thing.\n\n### Targeting\n\n[`targetForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html) is a composite force which pushes a thing toward a target position.\n\n```js\n// Target the relative position of x:0.2, y:0.4\nconst targetForce = Forces.targetForce({x: 0.2, y: 0.4 });\n```\n\nIt has some options. `diminishBy` scales the acceleration speed (default 0.0001). `range` allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.\n\n```js\nconst targetForce = Forces.targetForce(targetPos, {\n  diminishBy: 0.1,\n  range: { x: 0.01, y: 0.01} // If we're within 1% of target, that's good enough\n});\n```\n\n<demo-element style=\"height:40vh\" title=\"Target force\" src=\"/modulation/forces-target/\" />\n\n### Attraction\n\nThe [`attractionForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html) attracts (or repels) a thing based on a list of attractors.\n\n<demo-element style=\"height:40vh\" title=\"Attraction force\" src=\"/modulation/forces-attractor/\" />\n\nFor example, lets say we have earth and sun\n\n```js\nconst sun = { mass: 1000, position: Math.random() };\nconst earth = { mass: 0.01, position: Math.random() };\n```\n\nThe sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:\n\n```js\n// Init the sun's attractive force\nconst sunAttractionForce = Forces.attractionForce(sun, 0.1);\n\n// Apply the force to earth\nearth = Forces.apply(earth, sunAttractionForce);\n```\n\nThe force can take a third parameter for the range at which the force is applied:\n\n```js\n// Only apply force when distance between sun and thing is between 1-10%\nconst sunAttractionForce = Forces.attractionForce(sun, 0.1, { max: 0.1, min: 0.01});\n```\n\n### Orientation\n\nTo make objects orient in the direction of travel, use [`orientationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html). This is also demonstrated in the attraction force demo above.\n\nThe parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.\n\n```js\nconst orientationForce = Forces.orientationForce(1);\n```\n\nThe orientation force is a handy composite which applies the following forces in order:\n* [`angularForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html): updates angle and velocity based on angular acceleration & velocity\n* [`angleFromAccelerationForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html): update angularAcceleration based on acceleration's vector,  and\n*  [`angleFromVelocityForce`](https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html): update angle based on velocity, to point in direction of travel\n\n## Applying forces to many things\n\nUse the regular Javascript constructs to apply forces to many objects.\n\n```js\n// Initial things\nlet things = [ /* lots of things */ ]\n// Things now contains a set of things after force has been applied\nthings = things.map(t => Forces.apply(t, gravityForce));\n```\n\n## Dynamic forces\n\nAt times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:\n\n```js\nconst thing = { \n  position: Points.random(),\n  smoothness: Math.random(),\n  mass: 1\n};\n\n// Init force\nconst friction = Forces.velocityForce(0.00001, `multiply`);\nconst loop() => {\n  // When applying force it will use the static values\n  thing = Forces.apply(thing, friction);\n  ...\n}\n```\n\nInstead, create the force function when we call `apply`:\n\n```js\nconst loop() => {\n  thing = Forces.apply(thing, \n    Force.velocityForce(0.00001 * thing.smoothness)\n  );\n  ...\n}\n```\n\nWe can also opt to dynamically apply a force or not, based on some state.\n\nIn this example, we assume `gravityApplies` is a property of the thing. If the value is _true_, we apply a gravity force, if not a 'null' force which does nothing:\n\n```js\nForces.apply(thing,\n  dragForce,\n  thing.gravityApplies ? gravityForce : Forces.nullForce,\n  windForce\n);\n```\n\nThis technique is used in the [basic forces demo](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic) to selectively apply forces depending on whether the thing is in 'air' or 'water'\n\n\n### Demos\n\n* [Attractor force](https://clinth.github.io/ixfx-demos/modulation/forces-attractor/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor))\n* [Basic forces](https://clinth.github.io/ixfx-demos/modulation/forces-basic/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic)): wind, gravity, drag, friction\n* [Pendulum demo](https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/)\n([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum))\n* [Target force](https://clinth.github.io/ixfx-demos/modulation/forces-target/) ([source](https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target))\n", "html": `<script type="module" hoist>
  import '/src/components/ReplPad';
<\/script>
<div class="tip">
<ul>
<li>API Reference <a href="https://clinth.github.io/ixfx/modules/Modulation.Forces.html">Modulation.Forces module</a></li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/">Demos</a></li>
<li>Related: <a href="../oscillator/#springs">Oscillator.spring</a>: spring force</li>
</ul>
</div>
<p>The Forces module is a bit of an adaptation of Daniel Shiffman's <a href="https://natureofcode.com/book/">Nature of Code</a> examples. If you're interested in learning the math, please see that excellent resource.</p>
<p>This demo below shows basic movement of gravity, drag, wind and friction. <a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">See it online</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>). It also demonstrates selectively applying forces, in this case, based on the position of the thing.</p>
<demo-element style="height:40vh" title="Basic forces" src="/modulation/forces-basic/" />
<p>ixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.</p>
<p>First, a thing that can be affected by a force has the type <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code is:raw>ForceAffected</code></a>. That means it has some of these properties:</p>
<pre class="language-typescript"><code is:raw class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ForceAffected</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  position<span class="token operator">?</span><span class="token operator">:</span>Point
  velocity<span class="token operator">?</span><span class="token operator">:</span>Point
  acceleration<span class="token operator">?</span><span class="token operator">:</span>Point
  mass<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>
  angularAcceleration<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angularVelocity<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angle<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>A basic thing, able to be force-affected can be as simple as:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre>
<p>Velocity and acceleration are <em>vectors</em>, capturing movement in both <em>x</em> &#x26; <em>y</em> directions. They are also signed. A negative <em>x</em> value will mean that the thing is moving left, while a positive <em>x</em> value will mean it is moving to the right.</p>
<p>Now, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.</p>
<p>We first create the forces we want to use.</p>
<p>For example, to give our thing some acceleration we might create an <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html">acceleration force</a>, and to slow it down, some friction based on <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html">velocity</a>.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Forces <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://unpkg.com/ixfx/dist/modulation.js"</span>

<span class="token comment">// Accelerate to right with a force of { x:0.1, y:0 }</span>
<span class="token keyword">const</span> accelForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Reduce velocity due to friction</span>
<span class="token keyword">const</span> frictionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Now that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time.</p>
<p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html"><code is:raw>Forces.apply</code></a> takes an input 'thing' (ie. a <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code is:raw>ForceAffected</code></a> object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Initialise thing</span>
<span class="token keyword">let</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Apply accelForce and frictionForce on to thing,</span>
  <span class="token comment">// setting it back again to the same variable</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
    accelForce<span class="token punctuation">,</span> 
    frictionForce<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// eg. use newly calculated position</span>
  <span class="token function">moveElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> thing<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Keep loop running</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>After applying a force, properties will be updated - typically its <code is:raw>position</code> and <code is:raw>velocity</code>. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.</p>
<p>Once initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.</p>
<p>The object you pass in to <code is:raw>Forces.apply</code> could have additional properties, these are preserved.</p>
<h2 id="force-settings">Force settings</h2>
<p>When working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.</p>
<p>For coordinates, it's best to keep them relative (ie. <em>x</em> and <em>y</em> on a 0..1 scale), and map them to screen coordinates at only when necessary.</p>
<h2 id="force-functions">Force functions</h2>
<h3 id="velocity--acceleration">Velocity &#x26; acceleration</h3>
<p>Before getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code is:raw>accelerationForce</code></a> and let <code is:raw>Forces.apply</code> integrate that into an updated velocity and position.</p>
<demo-element style="height:40vh" title="Acceleration" src="/modulation/forces-accel/" />
<p>This demo computes an acceleration based on the movement of the pointer (via <a href="../../data/trackers/#point">point tracker</a>). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call <code is:raw>Forces.accelerationForce</code> each time we apply.</p>
<pre class="language-js"><code is:raw class="language-js">thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
        Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span>avg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>(don't forget you can click the 'Source' button in the demo titlebar to see the full code)</p>
<p>Note how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.</p>
<p>Along with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things</p>
<demo-element style="height:40vh" title="Acceleration of particles" src="/modulation/forces-accel-particles/" />
<h3 id="wind-and-gravity">Wind and gravity</h3>
<p>Wind and gravity can be modelled as affecting the acceleration of a thing with <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code is:raw>accelerationForce</code></a></p>
<p>For wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> windForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.00001</span><span class="token punctuation">,</span> 
   <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> 
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Gravity won't affect the <em>x</em> value, but rather <em>y</em>, and in this case the force is multiplied with the mass (heavier will fall faster):</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> gravityForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.0001</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="friction--drag">Friction &#x26; drag</h3>
<p>Friction reduces speed with the <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html"><code is:raw>velocityForce</code></a>. This force essentially scales the current speed by the force value. By passing <code is:raw>multiply</code> as the second parameter, we can enhance the force with mass - heavier object, more friction.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Drag also reduces speed, and is based on the the <em>square</em> of the current velocity. We can use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html"><code is:raw>magnitudeForce</code></a>. This produces a non-linear relation, compared with <code is:raw>velocityForce</code>. By passing <code is:raw>dampen</code> as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> drag <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">magnitudeForce</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></code></pre>
<h3 id="pendulum">Pendulum</h3>
<p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html"><code is:raw>pendulumForce</code></a> works with angular velocity and angle of a thing.</p>
<demo-element style="height:40vh" title="Pendulm force" src="/modulation/forces-pendulum/" />
<p>To use, we have to define a point by which the thing is pinned, and its distance.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> pinnedAt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The other options for the pendulum force are: <em>damping</em>, an amount to reduce velocity by, and <em>speed</em>, which is the maximum swing speed.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
  <span class="token literal-property property">damping</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// default 0.995, ie 0.5% loss</span>
  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">0.1</span>    <span class="token comment">// default 0.001</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>If <em>length</em> is not defined, the force will use the current distance between the target and thing.</p>
<h3 id="targeting">Targeting</h3>
<p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html"><code is:raw>targetForce</code></a> is a composite force which pushes a thing toward a target position.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Target the relative position of x:0.2, y:0.4</span>
<span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It has some options. <code is:raw>diminishBy</code> scales the acceleration speed (default 0.0001). <code is:raw>range</code> allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span>targetPos<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">diminishBy</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">range</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span> <span class="token comment">// If we're within 1% of target, that's good enough</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<demo-element style="height:40vh" title="Target force" src="/modulation/forces-target/" />
<h3 id="attraction">Attraction</h3>
<p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html"><code is:raw>attractionForce</code></a> attracts (or repels) a thing based on a list of attractors.</p>
<demo-element style="height:40vh" title="Attraction force" src="/modulation/forces-attractor/" />
<p>For example, lets say we have earth and sun</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> sun <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>The sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Init the sun's attractive force</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Apply the force to earth</span>
earth <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>earth<span class="token punctuation">,</span> sunAttractionForce<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The force can take a third parameter for the range at which the force is applied:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Only apply force when distance between sun and thing is between 1-10%</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="orientation">Orientation</h3>
<p>To make objects orient in the direction of travel, use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html"><code is:raw>orientationForce</code></a>. This is also demonstrated in the attraction force demo above.</p>
<p>The parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> orientationForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">orientationForce</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The orientation force is a handy composite which applies the following forces in order:</p>
<ul>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html"><code is:raw>angularForce</code></a>: updates angle and velocity based on angular acceleration &#x26; velocity</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html"><code is:raw>angleFromAccelerationForce</code></a>: update angularAcceleration based on acceleration's vector,  and</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html"><code is:raw>angleFromVelocityForce</code></a>: update angle based on velocity, to point in direction of travel</li>
</ul>
<h2 id="applying-forces-to-many-things">Applying forces to many things</h2>
<p>Use the regular Javascript constructs to apply forces to many objects.</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token comment">// Initial things</span>
<span class="token keyword">let</span> things <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment">/* lots of things */</span> <span class="token punctuation">]</span>
<span class="token comment">// Things now contains a set of things after force has been applied</span>
things <span class="token operator">=</span> things<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> gravityForce<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="dynamic-forces">Dynamic forces</h2>
<p>At times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">position</span><span class="token operator">:</span> Points<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">smoothness</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Init force</span>
<span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// When applying force it will use the static values</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> friction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
<p>Instead, create the force function when we call <code is:raw>apply</code>:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
    Force<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span> <span class="token operator">*</span> thing<span class="token punctuation">.</span>smoothness<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
<p>We can also opt to dynamically apply a force or not, based on some state.</p>
<p>In this example, we assume <code is:raw>gravityApplies</code> is a property of the thing. If the value is <em>true</em>, we apply a gravity force, if not a 'null' force which does nothing:</p>
<pre class="language-js"><code is:raw class="language-js"><span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
  dragForce<span class="token punctuation">,</span>
  thing<span class="token punctuation">.</span>gravityApplies <span class="token operator">?</span> gravityForce <span class="token operator">:</span> Forces<span class="token punctuation">.</span>nullForce<span class="token punctuation">,</span>
  windForce
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This technique is used in the <a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">basic forces demo</a> to selectively apply forces depending on whether the thing is in 'air' or 'water'</p>
<h3 id="demos">Demos</h3>
<ul>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-attractor/">Attractor force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">Basic forces</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>): wind, gravity, drag, friction</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/">Pendulum demo</a>
(<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-target/">Target force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target">source</a>)</li>
</ul>` } };
  const SCRIPTS = [
    { props: { "type": "module", "hoist": true }, children: `import '/src/components/ReplPad';` }
  ];
  for (const SCRIPT of SCRIPTS)
    $$result.scripts.add(SCRIPT);
  return render`${renderComponent($$result, "Layout", $$MainLayout, { "content": $$content }, { "default": () => render`<div class="tip">
<ul>
<li>API Reference <a href="https://clinth.github.io/ixfx/modules/Modulation.Forces.html">Modulation.Forces module</a></li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/">Demos</a></li>
<li>Related: <a href="../oscillator/#springs">Oscillator.spring</a>: spring force</li>
</ul>
</div><p>The Forces module is a bit of an adaptation of Daniel Shiffman's <a href="https://natureofcode.com/book/">Nature of Code</a> examples. If you're interested in learning the math, please see that excellent resource.</p><p>This demo below shows basic movement of gravity, drag, wind and friction. <a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">See it online</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>). It also demonstrates selectively applying forces, in this case, based on the position of the thing.</p>${renderComponent($$result, "demo-element", "demo-element", { "style": "height:40vh", "title": "Basic forces", "src": "/modulation/forces-basic/" })}<p>ixfx has a functional approach to forces. There are a range of pre-defined 'force functions' which can be combined together to manipulate data.</p><p>First, a thing that can be affected by a force has the type <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code>ForceAffected</code></a>. That means it has some of these properties:</p><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ForceAffected</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  position<span class="token operator">?</span><span class="token operator">:</span>Point
  velocity<span class="token operator">?</span><span class="token operator">:</span>Point
  acceleration<span class="token operator">?</span><span class="token operator">:</span>Point
  mass<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>
  angularAcceleration<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angularVelocity<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
  angle<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>A basic thing, able to be force-affected can be as simple as:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span></code></pre><p>Velocity and acceleration are <em>vectors</em>, capturing movement in both <em>x</em> &#x26; <em>y</em> directions. They are also signed. A negative <em>x</em> value will mean that the thing is moving left, while a positive <em>x</em> value will mean it is moving to the right.</p><p>Now, rather than changing the position or velocity yourself, update it with the supplied 'force functions'. These return a function which in turn apply the force to a thing.</p><p>We first create the forces we want to use.</p><p>For example, to give our thing some acceleration we might create an <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html">acceleration force</a>, and to slow it down, some friction based on <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html">velocity</a>.</p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Forces <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://unpkg.com/ixfx/dist/modulation.js"</span>

<span class="token comment">// Accelerate to right with a force of { x:0.1, y:0 }</span>
<span class="token keyword">const</span> accelForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Reduce velocity due to friction</span>
<span class="token keyword">const</span> frictionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Now that the forces have been created, they can be used. Typically, you do this in an animation loop, so the thing gets updated over time.</p><p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.apply.html"><code>Forces.apply</code></a> takes an input 'thing' (ie. a <a href="https://clinth.github.io/ixfx/types/Modulation.Forces.ForceAffected.html"><code>ForceAffected</code></a> object) and applies a list of forces in order, returning a copy of the input after all the changes have been made.</p><pre class="language-js"><code class="language-js"><span class="token comment">// Initialise thing</span>
<span class="token keyword">let</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">loop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Apply accelForce and frictionForce on to thing,</span>
  <span class="token comment">// setting it back again to the same variable</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
    accelForce<span class="token punctuation">,</span> 
    frictionForce<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// eg. use newly calculated position</span>
  <span class="token function">moveElement</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> thing<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Keep loop running</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>After applying a force, properties will be updated - typically its <code>position</code> and <code>velocity</code>. It's up to you to use these values somehow, for example moving a HTML element or rendering on the canvas.</p><p>Once initialised, you probably don't want to modify the thing directly, but rather do so through the application of forces.</p><p>The object you pass in to <code>Forces.apply</code> could have additional properties, these are preserved.</p><h2 id="force-settings">Force settings</h2><p>When working with forces, keep in mind that the scaling of the numbers is interdependent. Values are very much 'set to taste', and while experimenting, try orders of magnitude up and down in order to figure out its effect.</p><p>For coordinates, it's best to keep them relative (ie. <em>x</em> and <em>y</em> on a 0..1 scale), and map them to screen coordinates at only when necessary.</p><h2 id="force-functions">Force functions</h2><h3 id="velocity--acceleration">Velocity &#x26; acceleration</h3><p>Before getting too fancy, a good place to start is moving something around. Rather than set the velocity directly, it's better to affect the acceleration via <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code>accelerationForce</code></a> and let <code>Forces.apply</code> integrate that into an updated velocity and position.</p>${renderComponent($$result, "demo-element", "demo-element", { "style": "height:40vh", "title": "Acceleration", "src": "/modulation/forces-accel/" })}<p>This demo computes an acceleration based on the movement of the pointer (via <a href="../../data/trackers/#point">point tracker</a>). Since we want to apply a dynamic acceleration force depending on the pointer movement, it's not possible to initialise the force function and re-use it. Rather, we call <code>Forces.accelerationForce</code> each time we apply.</p><pre class="language-js"><code class="language-js">thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
        Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span>avg<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>(don't forget you can click the 'Source' button in the demo titlebar to see the full code)</p><p>Note how the acceleration force has the 'dampen' parameter. A few different forces use the thing's 'mass' field. With this parameter, we can choose for the mass to 'dampen' (ie reduce), 'multiply' (ie. increase) or be 'ignored'.</p><p>Along with the basic demo of acceleration above, there's a more complicated example that applies the force to an arbitary number of things</p>${renderComponent($$result, "demo-element", "demo-element", { "style": "height:40vh", "title": "Acceleration of particles", "src": "/modulation/forces-accel-particles/" })}<h3 id="wind-and-gravity">Wind and gravity</h3><p>Wind and gravity can be modelled as affecting the acceleration of a thing with <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.accelerationForce.html"><code>accelerationForce</code></a></p><p>For wind, we might make it push something to the right, with its power being dampened (ie. reduced) with greater mass of a thing:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> windForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.00001</span><span class="token punctuation">,</span> 
   <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span> 
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Gravity won't affect the <em>x</em> value, but rather <em>y</em>, and in this case the force is multiplied with the mass (heavier will fall faster):</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> gravityForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">accelerationForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
  <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.0001</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="friction--drag">Friction &#x26; drag</h3><p>Friction reduces speed with the <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.velocityForce.html"><code>velocityForce</code></a>. This force essentially scales the current speed by the force value. By passing <code>multiply</code> as the second parameter, we can enhance the force with mass - heavier object, more friction.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Drag also reduces speed, and is based on the the <em>square</em> of the current velocity. We can use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.magnitudeForce.html"><code>magnitudeForce</code></a>. This produces a non-linear relation, compared with <code>velocityForce</code>. By passing <code>dampen</code> as the second parameter, we could reduce the force according the greater the mass - heavier object, less drag. Whether that makes any sense depends ont the dynamics you are creating.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> drag <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">magnitudeForce</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">dampen</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span></code></pre><h3 id="pendulum">Pendulum</h3><p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.pendulumForce.html"><code>pendulumForce</code></a> works with angular velocity and angle of a thing.</p>${renderComponent($$result, "demo-element", "demo-element", { "style": "height:40vh", "title": "Pendulm force", "src": "/modulation/forces-pendulum/" })}<p>To use, we have to define a point by which the thing is pinned, and its distance.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> pinnedAt <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The other options for the pendulum force are: <em>damping</em>, an amount to reduce velocity by, and <em>speed</em>, which is the maximum swing speed.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> pendulumForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">pendulumForce</span><span class="token punctuation">(</span>pinnedAt<span class="token punctuation">,</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0.4</span><span class="token punctuation">,</span>
  <span class="token literal-property property">damping</span><span class="token operator">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// default 0.995, ie 0.5% loss</span>
  <span class="token literal-property property">speed</span><span class="token operator">:</span> <span class="token number">0.1</span>    <span class="token comment">// default 0.001</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>If <em>length</em> is not defined, the force will use the current distance between the target and thing.</p><h3 id="targeting">Targeting</h3><p><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.targetForce.html"><code>targetForce</code></a> is a composite force which pushes a thing toward a target position.</p><pre class="language-js"><code class="language-js"><span class="token comment">// Target the relative position of x:0.2, y:0.4</span>
<span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.4</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>It has some options. <code>diminishBy</code> scales the acceleration speed (default 0.0001). <code>range</code> allows you to skip moving if the thing is within this x/y to the target. Without range, it can easily 'overshoot' and end up bouncing back and forth around the target but never stopping.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> targetForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">targetForce</span><span class="token punctuation">(</span>targetPos<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">diminishBy</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">range</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span> <span class="token comment">// If we're within 1% of target, that's good enough</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>${renderComponent($$result, "demo-element", "demo-element", { "style": "height:40vh", "title": "Target force", "src": "/modulation/forces-target/" })}<h3 id="attraction">Attraction</h3><p>The <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.attractionForce.html"><code>attractionForce</code></a> attracts (or repels) a thing based on a list of attractors.</p>${renderComponent($$result, "demo-element", "demo-element", { "style": "height:40vh", "title": "Attraction force", "src": "/modulation/forces-attractor/" })}<p>For example, lets say we have earth and sun</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> sun <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> earth <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token literal-property property">position</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>The sun should be the thing that attracts the earth, so it is setup in the force, along with a gravity value of 0.1:</p><pre class="language-js"><code class="language-js"><span class="token comment">// Init the sun's attractive force</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Apply the force to earth</span>
earth <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>earth<span class="token punctuation">,</span> sunAttractionForce<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The force can take a third parameter for the range at which the force is applied:</p><pre class="language-js"><code class="language-js"><span class="token comment">// Only apply force when distance between sun and thing is between 1-10%</span>
<span class="token keyword">const</span> sunAttractionForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">attractionForce</span><span class="token punctuation">(</span>sun<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0.01</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="orientation">Orientation</h3><p>To make objects orient in the direction of travel, use <a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.orientationForce.html"><code>orientationForce</code></a>. This is also demonstrated in the attraction force demo above.</p><p>The parameter given to the force is the 'interpolation amount', which determines how quickly rotation happens.</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> orientationForce <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">orientationForce</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>The orientation force is a handy composite which applies the following forces in order:</p><ul>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angularForce.html"><code>angularForce</code></a>: updates angle and velocity based on angular acceleration &#x26; velocity</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromAccelerationForce.html"><code>angleFromAccelerationForce</code></a>: update angularAcceleration based on acceleration's vector,  and</li>
<li><a href="https://clinth.github.io/ixfx/functions/Modulation.Forces.angleFromVelocityForce.html"><code>angleFromVelocityForce</code></a>: update angle based on velocity, to point in direction of travel</li>
</ul><h2 id="applying-forces-to-many-things">Applying forces to many things</h2><p>Use the regular Javascript constructs to apply forces to many objects.</p><pre class="language-js"><code class="language-js"><span class="token comment">// Initial things</span>
<span class="token keyword">let</span> things <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token comment">/* lots of things */</span> <span class="token punctuation">]</span>
<span class="token comment">// Things now contains a set of things after force has been applied</span>
things <span class="token operator">=</span> things<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> gravityForce<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="dynamic-forces">Dynamic forces</h2><p>At times the pattern of initialising a force once and then reusing it repeatedly isn't appropriate. For example, if you want friction to be affected by a 'smoothness' property you have defined, this won't work:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> thing <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">position</span><span class="token operator">:</span> Points<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">smoothness</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Init force</span>
<span class="token keyword">const</span> friction <span class="token operator">=</span> Forces<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">multiply</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// When applying force it will use the static values</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> friction<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre><p>Instead, create the force function when we call <code>apply</code>:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  thing <span class="token operator">=</span> <span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span> 
    Force<span class="token punctuation">.</span><span class="token function">velocityForce</span><span class="token punctuation">(</span><span class="token number">0.00001</span> <span class="token operator">*</span> thing<span class="token punctuation">.</span>smoothness<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre><p>We can also opt to dynamically apply a force or not, based on some state.</p><p>In this example, we assume <code>gravityApplies</code> is a property of the thing. If the value is <em>true</em>, we apply a gravity force, if not a 'null' force which does nothing:</p><pre class="language-js"><code class="language-js"><span class="token function">Forces</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>thing<span class="token punctuation">,</span>
  dragForce<span class="token punctuation">,</span>
  thing<span class="token punctuation">.</span>gravityApplies <span class="token operator">?</span> gravityForce <span class="token operator">:</span> Forces<span class="token punctuation">.</span>nullForce<span class="token punctuation">,</span>
  windForce
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>This technique is used in the <a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">basic forces demo</a> to selectively apply forces depending on whether the thing is in 'air' or 'water'</p><h3 id="demos">Demos</h3><ul>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-attractor/">Attractor force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-attractor">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-basic/">Basic forces</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-basic">source</a>): wind, gravity, drag, friction</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-pendulum/">Pendulum demo</a>
(<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-pendulum">source</a>)</li>
<li><a href="https://clinth.github.io/ixfx-demos/modulation/forces-target/">Target force</a> (<a href="https://github.com/ClintH/ixfx-demos/tree/main/modulation/forces-target">source</a>)</li>
</ul>` })}`;
});

export { $$metadata, $$Forces as default, frontmatter, metadata };
