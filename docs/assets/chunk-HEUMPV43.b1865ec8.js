import{g as U,j as S}from"./chunk-57USKCMY.8e2e6641.js";import{i as E,S as V}from"./chunk-E6FEPMVF.c62dcddf.js";import{_ as A,b as c,a as L,c as d,d as n}from"./chunk-YDTVC7MM.cb3895f8.js";import{a as Z}from"./chunk-MLAH6NN5.257adfe4.js";import{t as B,q as O}from"./chunk-GLOC4ABQ.1540f006.js";var ue=(e,t)=>{const a=q(e,t);return(...s)=>a.start(void 0,s)},he=(e,t)=>{let a=0;return async(...s)=>{const r=performance.now()-a;if(r>=t){const i=e(r,...s);typeof i=="object"&&await i,a=performance.now()}}},de=async function*(e,t){let a=!1;try{for(;!a;){if(await j(t),a)return;if(typeof e=="function")yield await e();else if(typeof e=="object")if("next"in e&&"return"in e&&"throw"in e){const s=await e.next();if(s.done)return;yield s.value}else throw new Error("interval: produce param does not seem to be a generator?");else throw new Error("produce param does not seem to return a value/Promise and is not a generator?")}}finally{a=!0}},q=(e,t)=>{if(e===void 0)throw new Error("callback parameter is undefined");E(t,"aboveZero","timeoutMs");let a=0,s=0;const r=async(v=t,...p)=>new Promise((D,u)=>{s=performance.now();try{E(v,"aboveZero","altTimeoutMs")}catch(y){u(y);return}a!==0&&i(),a=window.setTimeout(async()=>{await e(performance.now()-s,...p),a=0,D(void 0)},v)}),i=()=>{a!==0&&(s=0,window.clearTimeout(a))};return{start:r,cancel:i,get isDone(){return a!==0}}},fe=(e,t,a)=>{t!==void 0&&E(t,"positive","intervalMs");let s=!1,r=0,i=performance.now();const v=t===void 0||t===0?u=>window.requestAnimationFrame(u):u=>window.setTimeout(u,t),p=()=>{!s||(s=!1,r=0)},m=async()=>{if(!s)return;const u=e(r++,performance.now()-i);let y;if(typeof u=="object"?y=await u:y=u,y!==void 0&&!y){p();return}v(m)};return{start:()=>{if(s&&a!==void 0){const u=a(r,performance.now()-i);if(i=performance.now(),u!==void 0&&!u){p();return}}else if(s)return;s=!0,v(m)},get isDone(){return s},get ticks(){return r},get elapsedMs(){return performance.now()-i},cancel:p}},j=e=>new Promise(t=>setTimeout(t,e)),ve=async(e,t)=>(E(t,"aboveZero","timeoutMs"),await j(t),Promise.resolve(await e())),G=(e,t,a=!0)=>{let s=!1,r=1;return{mod(i){r=i},get isDone(){return s},reset:()=>{s=!1,t.reset()},get elapsed(){let i=t.elapsed/(e*r);return a&&(i=U(i)),i>=1&&(s=!0),i}}},pe=e=>()=>k(e,I()),k=(e,t=I())=>{const a=e/1e3;let s=1;return{mod:r=>{s=r},reset:()=>{t.reset()},get elapsed(){const r=t.elapsed*(a*s),i=r-Math.floor(r);if(i<0)throw new Error(`Unexpected cycle fraction less than 0. Elapsed: ${r} f: ${i}`);if(i>1)throw new Error(`Unexpected cycle fraction more than 1. Elapsed: ${r} f: ${i}`);return i}}},I=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e}}},H=()=>{let e=0;return{reset:()=>{e=0},get elapsed(){return e++}}},we=(e,t,a="slow")=>{let s=0,r,i=t;return()=>new Promise(async(v,p)=>{const m=performance.now()-s;if(r===void 0||m>i)try{s=performance.now(),r=await e(m),i=t}catch(D){a==="fast"?(r=void 0,s=0):a==="backoff"&&(i=Math.floor(i*1.2)),p(D);return}v(r)})},N={};A(N,{functions:()=>T,get:()=>W,getEasings:()=>Q,tick:()=>K,time:()=>Y});var _=Math.sqrt,o=Math.pow,$=Math.cos,g=Math.PI,b=Math.sin,Y=function(e,t){return C(e,t,I)},K=function(e,t){return C(e,t,H)},C=function(e,t,a){const s=W(e);if(s===void 0)throw new Error(`Easing function not found: ${e}`);const r=G(t,a(),!0);return{get isDone(){return r.isDone},compute:()=>{const i=r.elapsed;return s(i)},reset:()=>{r.reset()}}},W=function(e){if(e===null)throw new Error("easingName is null");if(e===void 0)throw new Error("easingName is undefined");const t=e.toLocaleLowerCase(),a=Object.entries(T).find(([s,r])=>s.toLocaleLowerCase()===t);return a===void 0?a:a[1]},Q=function(){return Array.from(Object.keys(T))},M=function(e){const t=7.5625,a=2.75;return e<1/a?t*e*e:e<2/a?t*(e-=1.5/a)*e+.75:e<2.5/a?t*(e-=2.25/a)*e+.9375:t*(e-=2.625/a)*e+.984375},T={sineIn:e=>1-$(e*g/2),sineOut:e=>b(e*g/2),quadIn:e=>e*e,quadOut:e=>1-(1-e)*(1-e),sineInOut:e=>-($(g*e)-1)/2,quadInOut:e=>e<.5?2*e*e:1-o(-2*e+2,2)/2,cubicIn:e=>e*e*e,cubicOut:e=>1-o(1-e,3),quartIn:e=>e*e*e*e,quartOut:e=>1-o(1-e,4),quintIn:e=>e*e*e*e*e,quintOut:e=>1-o(1-e,5),expoIn:e=>e===0?0:o(2,10*e-10),expoOut:e=>e===1?1:1-o(2,-10*e),quintInOut:e=>e<.5?16*e*e*e*e*e:1-o(-2*e+2,5)/2,expoInOut:e=>e===0?0:e===1?1:e<.5?o(2,20*e-10)/2:(2-o(2,-20*e+10))/2,circIn:e=>1-_(1-o(e,2)),circOut:e=>_(1-o(e-1,2)),backIn:e=>{const t=1.70158;return(t+1)*e*e*e-t*e*e},backOut:e=>{const t=1.70158,a=t+1;return 1+a*o(e-1,3)+t*o(e-1,2)},circInOut:e=>e<.5?(1-_(1-o(2*e,2)))/2:(_(1-o(-2*e+2,2))+1)/2,backInOut:e=>{const a=1.70158*1.525;return e<.5?o(2*e,2)*((a+1)*2*e-a)/2:(o(2*e-2,2)*((a+1)*(e*2-2)+a)+2)/2},elasticIn:e=>{const t=2*g/3;return e===0?0:e===1?1:-o(2,10*e-10)*b((e*10-10.75)*t)},elasticOut:e=>{const t=2*g/3;return e===0?0:e===1?1:o(2,-10*e)*b((e*10-.75)*t)+1},bounceIn:e=>1-M(1-e),bounceOut:M,elasticInOut:e=>{const t=2*g/4.5;return e===0?0:e===1?1:e<.5?-(o(2,20*e-10)*b((20*e-11.125)*t))/2:o(2,-20*e+10)*b((20*e-11.125)*t)/2+1},bounceInOut:e=>e<.5?(1-M(1-2*e))/2:(1+M(2*e-1))/2},z={};A(z,{Easings:()=>N,Oscillators:()=>R,adsr:()=>x,defaultAdsrOpts:()=>J});var J=()=>({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1}),l,P,h,w,f,X=class extends V{constructor(e){super();L(this,l,void 0),L(this,P,void 0),L(this,h,void 0),L(this,w,void 0),L(this,f,void 0),c(this,"attackDuration"),c(this,"decayDuration"),c(this,"releaseDuration"),c(this,"decayDurationTotal"),c(this,"shouldLoop"),this.attackDuration=e.attackDuration??300,this.decayDuration=e.decayDuration??500,this.releaseDuration=e.releaseDuration??1e3,this.shouldLoop=e.shouldLoop??!1;const t={attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null};d(this,l,new Z("attack",t)),n(this,l).addEventListener("change",a=>{a.newState==="release"&&n(this,f)&&n(this,h)?.reset(),super.fireEvent("change",a)}),n(this,l).addEventListener("stop",a=>{super.fireEvent("complete",a)}),d(this,P,I),d(this,w,d(this,f,!1)),this.decayDurationTotal=this.attackDuration+this.decayDuration}switchState(){if(n(this,h)===void 0)return!1;let e=n(this,h).elapsed;const t=n(this,f)&&!n(this,w);let a=!1;do switch(a=!1,n(this,l).state){case"attack":(e>this.attackDuration||t)&&(n(this,l).next(),a=!0);break;case"decay":(e>this.decayDurationTotal||t)&&(n(this,l).next(),a=!0);break;case"sustain":(!n(this,w)||t)&&(e=0,n(this,l).next(),n(this,h)?.reset(),a=!0);break;case"release":e>this.releaseDuration&&(n(this,l).next(),a=!0);break;case"complete":this.shouldLoop&&this.trigger(n(this,f))}while(a);return a}computeRaw(e=!0){if(n(this,h)===void 0)return[void 0,0,n(this,l).state];e&&this.switchState();const t=n(this,l).state,a=n(this,h).elapsed;let s=0;const r=n(this,l).state;switch(r){case"attack":s=a/this.attackDuration;break;case"decay":s=(a-this.attackDuration)/this.decayDuration;break;case"sustain":s=1;break;case"release":s=Math.min(a/this.releaseDuration,1);break;case"complete":return[void 0,1,t];default:throw new Error(`State machine in unknown state: ${r}`)}return[r,s,t]}get isDone(){return n(this,l).isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),n(this,l).reset(),d(this,h,n(this,P).call(this)),d(this,w,e),d(this,f,e)}compute(){}release(){this.isDone||!n(this,f)||(d(this,w,!1),this.compute())}};l=new WeakMap;P=new WeakMap;h=new WeakMap;w=new WeakMap;f=new WeakMap;var F=class extends X{constructor(e){super(e);c(this,"attackPath"),c(this,"decayPath"),c(this,"releasePath"),c(this,"initialLevel"),c(this,"peakLevel"),c(this,"releaseLevel"),c(this,"sustainLevel"),c(this,"attackBend"),c(this,"decayBend"),c(this,"releaseBend"),c(this,"initialLevelOverride"),c(this,"retrigger"),c(this,"releasedAt"),this.initialLevel=e.initialLevel??0,this.peakLevel=e.peakLevel??1,this.releaseLevel=e.releaseLevel??0,this.sustainLevel=e.sustainLevel??.75,this.retrigger=e.retrigger??!0,this.attackBend=e.attackBend??0,this.releaseBend=e.releaseBend??0,this.decayBend=e.decayBend??0;const t=1;this.attackPath=B(O({x:0,y:this.initialLevel},{x:t,y:this.peakLevel},-this.attackBend)),this.decayPath=B(O({x:0,y:this.peakLevel},{x:t,y:this.sustainLevel},-this.decayBend)),this.releasePath=B(O({x:0,y:this.sustainLevel},{x:t,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){const[e,t,a]=this.compute();!Number.isNaN(t)&&t>0&&(console.log(`Retrigger. Last value was: ${t}`),this.initialLevelOverride=t)}}get value(){return this.compute(!0)[1]}compute(e=!0){const[t,a]=super.computeRaw(e);if(t===void 0)return[void 0,NaN,NaN];let s;switch(t){case"attack":s=this.attackPath.interpolate(a).y,this.initialLevelOverride!==void 0&&(s=S(s,0,this.initialLevel,this.initialLevelOverride,this.initialLevel)),this.releasedAt=s;break;case"decay":s=this.decayPath.interpolate(a).y,this.releasedAt=s;break;case"sustain":s=this.sustainLevel,this.releasedAt=s;break;case"release":s=this.releasePath.interpolate(a).y,this.releasedAt!==void 0&&(s=S(s,0,this.sustainLevel,0,this.releasedAt));break;case"complete":s=this.releaseLevel,this.releasedAt=void 0;break;default:throw new Error(`Unknown state: ${t}`)}return[t,s,a]}},x=e=>new F(e),R={};A(R,{saw:()=>se,sine:()=>ee,sineBipolar:()=>te,square:()=>re,triangle:()=>ae});function*ee(e){for(typeof e=="number"&&(e=k(e));;)yield(Math.sin(e.elapsed*Math.PI*2)+1)/2}function*te(e){for(typeof e=="number"&&(e=k(e));;)yield Math.sin(e.elapsed*Math.PI*2)}function*ae(e){for(typeof e=="number"&&(e=k(e));;){let t=e.elapsed;t<.5?t*=2:t=2-t*2,yield t}}function*se(e){for(typeof e=="number"&&(e=k(e));;)yield e.elapsed}function*re(e){for(typeof e=="number"&&(e=k(e));;)yield e.elapsed<.5?0:1}export{N as E,R as O,ve as a,pe as b,fe as c,ue as d,H as e,k as f,W as g,q as h,de as i,J as j,x as k,I as m,G as r,j as s,he as t,we as u};
